var Uq=Object.create;var QE=Object.defineProperty;var Vq=Object.getOwnPropertyDescriptor;var jq=Object.getOwnPropertyNames;var Gq=Object.getPrototypeOf,Hq=Object.prototype.hasOwnProperty;var r6=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var is=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Es=(t,e)=>{for(var r in e)QE(t,r,{get:e[r],enumerable:!0})},Wq=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of jq(e))!Hq.call(t,n)&&n!==r&&QE(t,n,{get:()=>e[n],enumerable:!(i=Vq(e,n))||i.enumerable});return t};var _l=(t,e,r)=>(r=t!=null?Uq(Gq(t)):{},Wq(e||!t||!t.__esModule?QE(r,"default",{value:t,enumerable:!0}):r,t));var R2=is((JE,eC)=>{(function(t,e){typeof JE=="object"&&typeof eC<"u"?eC.exports=e():typeof define=="function"&&define.amd?define(e):(t=typeof globalThis<"u"?globalThis:t||self,t.maplibregl=e())})(JE,function(){"use strict";var t={},e={};function r(n,s,a){if(e[n]=a,n==="index"){var c="var sharedModule = {}; ("+e.shared+")(sharedModule); ("+e.worker+")(sharedModule);",h={};return e.shared(h),e.index(t,h),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([c],{type:"text/javascript"}))),t}}r("shared",["exports"],function(n){"use strict";function s(f,l,d,g){return new(d||(d=Promise))(function(w,I){function P(G){try{U(g.next(G))}catch($){I($)}}function D(G){try{U(g.throw(G))}catch($){I($)}}function U(G){var $;G.done?w(G.value):($=G.value,$ instanceof d?$:new d(function(K){K($)})).then(P,D)}U((g=g.apply(f,l||[])).next())})}function a(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var c,h;function p(){if(h)return c;function f(l,d){this.x=l,this.y=d}return h=1,c=f,f.prototype={clone:function(){return new f(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,d){return this.clone()._rotateAround(l,d)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var d=l.x-this.x,g=l.y-this.y;return d*d+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,d){return Math.atan2(this.x*d-this.y*l,this.x*l+this.y*d)},_matMult:function(l){var d=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=d,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var d=Math.cos(l),g=Math.sin(l),w=g*this.x+d*this.y;return this.x=d*this.x-g*this.y,this.y=w,this},_rotateAround:function(l,d){var g=Math.cos(l),w=Math.sin(l),I=d.y+w*(this.x-d.x)+g*(this.y-d.y);return this.x=d.x+g*(this.x-d.x)-w*(this.y-d.y),this.y=I,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},f.convert=function(l){return l instanceof f?l:Array.isArray(l)?new f(l[0],l[1]):l},c}typeof SuppressedError=="function"&&SuppressedError;var x,T,R=a(p()),k=function(){if(T)return x;function f(l,d,g,w){this.cx=3*l,this.bx=3*(g-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(w-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=d,this.p2x=g,this.p2y=w}return T=1,x=f,f.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,d){if(d===void 0&&(d=1e-6),l<0)return 0;if(l>1)return 1;for(var g=l,w=0;w<8;w++){var I=this.sampleCurveX(g)-l;if(Math.abs(I)<d)return g;var P=this.sampleCurveDerivativeX(g);if(Math.abs(P)<1e-6)break;g-=I/P}var D=0,U=1;for(g=l,w=0;w<20&&(I=this.sampleCurveX(g),!(Math.abs(I-l)<d));w++)l>I?D=g:U=g,g=.5*(U-D)+D;return g},solve:function(l,d){return this.sampleCurveY(this.solveCurveX(l,d))}},x}(),j=a(k);let q,X;function re(){return q==null&&(q=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),q}function te(){if(X==null&&(X=!1,re())){let l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let g=0;g<5*5;g++){let w=4*g;l.fillStyle=`rgb(${w},${w+1},${w+2})`,l.fillRect(g%5,Math.floor(g/5),1,1)}let d=l.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&d[g]!==g){X=!0;break}}}return X||!1}var oe,ae=1e-6,pe=typeof Float32Array<"u"?Float32Array:Array;function be(){var f=new pe(9);return pe!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f}function Fe(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function Y(){var f=new pe(3);return pe!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f}function J(f,l,d){var g=new pe(3);return g[0]=f,g[1]=l,g[2]=d,g}function Z(f,l,d){var g=l[0],w=l[1],I=l[2],P=l[3];return f[0]=d[0]*g+d[4]*w+d[8]*I+d[12]*P,f[1]=d[1]*g+d[5]*w+d[9]*I+d[13]*P,f[2]=d[2]*g+d[6]*w+d[10]*I+d[14]*P,f[3]=d[3]*g+d[7]*w+d[11]*I+d[15]*P,f}function xe(){var f=new pe(4);return pe!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f[3]=1,f}function _e(){var f=new pe(2);return pe!=Float32Array&&(f[0]=0,f[1]=0),f}function Be(f,l){var d=new pe(2);return d[0]=f,d[1]=l,d}Math.hypot||(Math.hypot=function(){for(var f=0,l=arguments.length;l--;)f+=arguments[l]*arguments[l];return Math.sqrt(f)}),Y(),oe=new pe(4),pe!=Float32Array&&(oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=0),Y(),J(1,0,0),J(0,1,0),xe(),xe(),be(),_e();let Se=8192;function ke(f,l,d){return l*(Se/(f.tileSize*Math.pow(2,d-f.tileID.overscaledZ)))}function Ye(f,l){return(f%l+l)%l}function rt(f,l,d){return f*(1-d)+l*d}function tt(f){if(f<=0)return 0;if(f>=1)return 1;let l=f*f,d=l*f;return 4*(f<.5?d:3*(f-l)+d-.75)}function _t(f,l,d,g){let w=new j(f,l,d,g);return I=>w.solve(I)}let Zt=_t(.25,.1,.25,1);function Vt(f,l,d){return Math.min(d,Math.max(l,f))}function cr(f,l,d){let g=d-l,w=((f-l)%g+g)%g+l;return w===l?d:w}function Wt(f,...l){for(let d of l)for(let g in d)f[g]=d[g];return f}let Lt=1;function vr(f,l,d){let g={};for(let w in f)g[w]=l.call(this,f[w],w,f);return g}function Pr(f,l,d){let g={};for(let w in f)l.call(this,f[w],w,f)&&(g[w]=f[w]);return g}function dr(f){return Array.isArray(f)?f.map(dr):typeof f=="object"&&f?vr(f,dr):f}let Nr={};function Ai(f){Nr[f]||(typeof console<"u"&&console.warn(f),Nr[f]=!0)}function Wr(f,l,d){return(d.y-f.y)*(l.x-f.x)>(l.y-f.y)*(d.x-f.x)}function Di(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let ui=null;function tn(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}let Ni="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function oi(f,l,d,g,w){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let I=new VideoFrame(f,{timestamp:0});try{let P=I?.format;if(!P||!P.startsWith("BGR")&&!P.startsWith("RGB"))throw new Error(`Unrecognized format ${P}`);let D=P.startsWith("BGR"),U=new Uint8ClampedArray(g*w*4);if(yield I.copyTo(U,function(G,$,K,se,ce){let he=4*Math.max(1,0),me=(Math.max(0,K)-K)*se*4+he,Ee=4*se,Oe=Math.max(0,$),et=Math.max(0,K);return{rect:{x:Oe,y:et,width:Math.min(G.width,$+se)-Oe,height:Math.min(G.height,K+ce)-et},layout:[{offset:me,stride:Ee}]}}(f,l,d,g,w)),D)for(let G=0;G<U.length;G+=4){let $=U[G];U[G]=U[G+2],U[G+2]=$}return U}finally{I.close()}})}let Eo,qs;function ls(f,l,d,g){return f.addEventListener(l,d,g),{unsubscribe:()=>{f.removeEventListener(l,d,g)}}}function Zs(f){return f/Math.PI*180}let Aa={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},_s={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},oo="AbortError";function ys(){return new Error(oo)}let Gr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Jt(f){return Gr.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}let kt="global-dispatcher";class Cr extends Error{constructor(l,d,g,w){super(`AJAXError: ${d} (${l}): ${g}`),this.status=l,this.statusText=d,this.url=g,this.body=w}}let ai=()=>Di(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Rr=function(f,l){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){let g=Jt(f.url);if(g)return g(f,l);if(Di(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,targetMapId:kt},l)}if(!(/^file:/.test(d=f.url)||/^file:/.test(ai())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,w){return s(this,void 0,void 0,function*(){let I=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:ai(),signal:w.signal}),P,D;g.type!=="json"||I.headers.has("Accept")||I.headers.set("Accept","application/json");try{P=yield fetch(I)}catch(G){throw new Cr(0,G.message,g.url,new Blob)}if(!P.ok){let G=yield P.blob();throw new Cr(P.status,P.statusText,g.url,G)}D=g.type==="arrayBuffer"||g.type==="image"?P.arrayBuffer():g.type==="json"?P.json():P.text();let U=yield D;if(w.signal.aborted)throw ys();return{data:U,cacheControl:P.headers.get("Cache-Control"),expires:P.headers.get("Expires")}})}(f,l);if(Di(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,mustQueue:!0,targetMapId:kt},l)}var d;return function(g,w){return new Promise((I,P)=>{var D;let U=new XMLHttpRequest;U.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(U.responseType="arraybuffer");for(let G in g.headers)U.setRequestHeader(G,g.headers[G]);g.type==="json"&&(U.responseType="text",!((D=g.headers)===null||D===void 0)&&D.Accept||U.setRequestHeader("Accept","application/json")),U.withCredentials=g.credentials==="include",U.onerror=()=>{P(new Error(U.statusText))},U.onload=()=>{if(!w.signal.aborted)if((U.status>=200&&U.status<300||U.status===0)&&U.response!==null){let G=U.response;if(g.type==="json")try{G=JSON.parse(U.response)}catch($){return void P($)}I({data:G,cacheControl:U.getResponseHeader("Cache-Control"),expires:U.getResponseHeader("Expires")})}else{let G=new Blob([U.response],{type:U.getResponseHeader("Content-Type")});P(new Cr(U.status,U.statusText,g.url,G))}},w.signal.addEventListener("abort",()=>{U.abort(),P(ys())}),U.send(g.body)})}(f,l)};function Xi(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;let l=new URL(f),d=window.location;return l.protocol===d.protocol&&l.host===d.host}function cs(f,l,d){d[f]&&d[f].indexOf(l)!==-1||(d[f]=d[f]||[],d[f].push(l))}function zn(f,l,d){if(d&&d[f]){let g=d[f].indexOf(l);g!==-1&&d[f].splice(g,1)}}class ot{constructor(l,d={}){Wt(this,d),this.type=l}}class Ae extends ot{constructor(l,d={}){super("error",Wt({error:l},d))}}class ye{on(l,d){return this._listeners=this._listeners||{},cs(l,d,this._listeners),{unsubscribe:()=>{this.off(l,d)}}}off(l,d){return zn(l,d,this._listeners),zn(l,d,this._oneTimeListeners),this}once(l,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},cs(l,d,this._oneTimeListeners),this):new Promise(g=>this.once(l,g))}fire(l,d){typeof l=="string"&&(l=new ot(l,d||{}));let g=l.type;if(this.listens(g)){l.target=this;let w=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(let D of w)D.call(this,l);let I=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(let D of I)zn(g,D,this._oneTimeListeners),D.call(this,l);let P=this._eventedParent;P&&(Wt(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),P.fire(l))}else l instanceof Ae&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,d){return this._eventedParent=l,this._eventedParentData=d,this}}var ue={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Ve=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ke(f,l){let d={};for(let g in f)g!=="ref"&&(d[g]=f[g]);return Ve.forEach(g=>{g in l&&(d[g]=l[g])}),d}function Qe(f,l){if(Array.isArray(f)){if(!Array.isArray(l)||f.length!==l.length)return!1;for(let d=0;d<f.length;d++)if(!Qe(f[d],l[d]))return!1;return!0}if(typeof f=="object"&&f!==null&&l!==null){if(typeof l!="object"||Object.keys(f).length!==Object.keys(l).length)return!1;for(let d in f)if(!Qe(f[d],l[d]))return!1;return!0}return f===l}function dt(f,l){f.push(l)}function it(f,l,d){dt(d,{command:"addSource",args:[f,l[f]]})}function Bt(f,l,d){dt(l,{command:"removeSource",args:[f]}),d[f]=!0}function Mt(f,l,d,g){Bt(f,d,g),it(f,l,d)}function ut(f,l,d){let g;for(g in f[d])if(Object.prototype.hasOwnProperty.call(f[d],g)&&g!=="data"&&!Qe(f[d][g],l[d][g]))return!1;for(g in l[d])if(Object.prototype.hasOwnProperty.call(l[d],g)&&g!=="data"&&!Qe(f[d][g],l[d][g]))return!1;return!0}function zt(f,l,d,g,w,I){f=f||{},l=l||{};for(let P in f)Object.prototype.hasOwnProperty.call(f,P)&&(Qe(f[P],l[P])||d.push({command:I,args:[g,P,l[P],w]}));for(let P in l)Object.prototype.hasOwnProperty.call(l,P)&&!Object.prototype.hasOwnProperty.call(f,P)&&(Qe(f[P],l[P])||d.push({command:I,args:[g,P,l[P],w]}))}function rr(f){return f.id}function nr(f,l){return f[l.id]=l,f}class $e{constructor(l,d,g,w){this.message=(l?`${l}: `:"")+g,w&&(this.identifier=w),d!=null&&d.__line__&&(this.line=d.__line__)}}function Fr(f,...l){for(let d of l)for(let g in d)f[g]=d[g];return f}class Sr extends Error{constructor(l,d){super(d),this.message=d,this.key=l}}class kr{constructor(l,d=[]){this.parent=l,this.bindings={};for(let[g,w]of d)this.bindings[g]=w}concat(l){return new kr(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}let _i={kind:"null"},Gt={kind:"number"},pr={kind:"string"},tr={kind:"boolean"},Vr={kind:"color"},xn={kind:"projectionDefinition"},ma={kind:"object"},Br={kind:"value"},Kn={kind:"collator"},rn={kind:"formatted"},nh={kind:"padding"},Wl={kind:"resolvedImage"},Ct={kind:"variableAnchorOffsetCollection"};function Kr(f,l){return{kind:"array",itemType:f,N:l}}function ii(f){if(f.kind==="array"){let l=ii(f.itemType);return typeof f.N=="number"?`array<${l}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${l}>`}return f.kind}let Xs=[_i,Gt,pr,tr,Vr,xn,rn,ma,Kr(Br),nh,Wl,Ct];function Qn(f,l){if(l.kind==="error")return null;if(f.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Qn(f.itemType,l.itemType))&&(typeof f.N!="number"||f.N===l.N))return null}else{if(f.kind===l.kind)return null;if(f.kind==="value"){for(let d of Xs)if(!Qn(d,l))return null}}return`Expected ${ii(f)} but found ${ii(l)} instead.`}function Co(f,l){return l.some(d=>d.kind===f.kind)}function us(f,l){return l.some(d=>d==="null"?f===null:d==="array"?Array.isArray(f):d==="object"?f&&!Array.isArray(f)&&typeof f=="object":d===typeof f)}function Ti(f,l){return f.kind==="array"&&l.kind==="array"?f.itemType.kind===l.itemType.kind&&typeof f.N=="number":f.kind===l.kind}let $l=.96422,ao=.82521,sh=4/29,lo=6/29,lf=3*lo*lo,qc=lo*lo*lo,Hd=Math.PI/180,Fa=180/Math.PI;function ql(f){return(f%=360)<0&&(f+=360),f}function Jn([f,l,d,g]){let w,I,P=QA((.2225045*(f=Zc(f))+.7168786*(l=Zc(l))+.0606169*(d=Zc(d)))/1);f===l&&l===d?w=I=P:(w=QA((.4360747*f+.3850649*l+.1430804*d)/$l),I=QA((.0139322*f+.0971045*l+.7141733*d)/ao));let D=116*P-16;return[D<0?0:D,500*(w-P),200*(P-I),g]}function Zc(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function QA(f){return f>qc?Math.pow(f,1/3):f/lf+sh}function Dg([f,l,d,g]){let w=(f+16)/116,I=isNaN(l)?w:w+l/500,P=isNaN(d)?w:w-d/200;return w=1*Wd(w),I=$l*Wd(I),P=ao*Wd(P),[JA(3.1338561*I-1.6168667*w-.4906146*P),JA(-.9787684*I+1.9161415*w+.033454*P),JA(.0719453*I-.2289914*w+1.4052427*P),g]}function JA(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function Wd(f){return f>lo?f*f*f:lf*(f-sh)}function cf(f){return parseInt(f.padEnd(2,f),16)/255}function ga(f,l){return hi(l?f/100:f,0,1)}function hi(f,l,d){return Math.min(Math.max(l,f),d)}function Xc(f){return!f.some(Number.isNaN)}let Zl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function cl(f,l,d){return f+d*(l-f)}function oh(f,l,d){return f.map((g,w)=>cl(g,l[w],d))}class Ei{constructor(l,d,g,w=1,I=!0){this.r=l,this.g=d,this.b=g,this.a=w,I||(this.r*=w,this.g*=w,this.b*=w,w||this.overwriteGetter("rgb",[l,d,g,w]))}static parse(l){if(l instanceof Ei)return l;if(typeof l!="string")return;let d=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];let w=Zl[g];if(w){let[P,D,U]=w;return[P/255,D/255,U/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){let P=g.length<6?1:2,D=1;return[cf(g.slice(D,D+=P)),cf(g.slice(D,D+=P)),cf(g.slice(D,D+=P)),cf(g.slice(D,D+P)||"ff")]}if(g.startsWith("rgb")){let P=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(P){let[D,U,G,$,K,se,ce,he,me,Ee,Oe,et]=P,Ue=[$||" ",ce||" ",Ee].join("");if(Ue==="  "||Ue==="  /"||Ue===",,"||Ue===",,,"){let le=[G,se,me].join(""),ve=le==="%%%"?100:le===""?255:0;if(ve){let We=[hi(+U/ve,0,1),hi(+K/ve,0,1),hi(+he/ve,0,1),Oe?ga(+Oe,et):1];if(Xc(We))return We}}return}}let I=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(I){let[P,D,U,G,$,K,se,ce,he]=I,me=[U||" ",$||" ",se].join("");if(me==="  "||me==="  /"||me===",,"||me===",,,"){let Ee=[+D,hi(+G,0,100),hi(+K,0,100),ce?ga(+ce,he):1];if(Xc(Ee))return function([Oe,et,Ue,le]){function ve(We){let xt=(We+Oe/30)%12,Ht=et*Math.min(Ue,1-Ue);return Ue-Ht*Math.max(-1,Math.min(xt-3,9-xt,1))}return Oe=ql(Oe),et/=100,Ue/=100,[ve(0),ve(8),ve(4),le]}(Ee)}}}(l);return d?new Ei(...d,!1):void 0}get rgb(){let{r:l,g:d,b:g,a:w}=this,I=w||1/0;return this.overwriteGetter("rgb",[l/I,d/I,g/I,w])}get hcl(){return this.overwriteGetter("hcl",function(l){let[d,g,w,I]=Jn(l),P=Math.sqrt(g*g+w*w);return[Math.round(1e4*P)?ql(Math.atan2(w,g)*Fa):NaN,P,d,I]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Jn(this.rgb))}overwriteGetter(l,d){return Object.defineProperty(this,l,{value:d}),d}toString(){let[l,d,g,w]=this.rgb;return`rgba(${[l,d,g].map(I=>Math.round(255*I)).join(",")},${w})`}static interpolate(l,d,g,w="rgb"){switch(w){case"rgb":{let[I,P,D,U]=oh(l.rgb,d.rgb,g);return new Ei(I,P,D,U,!1)}case"hcl":{let[I,P,D,U]=l.hcl,[G,$,K,se]=d.hcl,ce,he;if(isNaN(I)||isNaN(G))isNaN(I)?isNaN(G)?ce=NaN:(ce=G,D!==1&&D!==0||(he=$)):(ce=I,K!==1&&K!==0||(he=P));else{let Ue=G-I;G>I&&Ue>180?Ue-=360:G<I&&I-G>180&&(Ue+=360),ce=I+g*Ue}let[me,Ee,Oe,et]=function([Ue,le,ve,We]){return Ue=isNaN(Ue)?0:Ue*Hd,Dg([ve,Math.cos(Ue)*le,Math.sin(Ue)*le,We])}([ce,he??cl(P,$,g),cl(D,K,g),cl(U,se,g)]);return new Ei(me,Ee,Oe,et,!1)}case"lab":{let[I,P,D,U]=Dg(oh(l.lab,d.lab,g));return new Ei(I,P,D,U,!1)}}}}Ei.black=new Ei(0,0,0,1),Ei.white=new Ei(1,1,1,1),Ei.transparent=new Ei(0,0,0,0),Ei.red=new Ei(1,0,0,1);class Jo{constructor(l,d,g){this.sensitivity=l?d?"variant":"case":d?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,d){return this.collator.compare(l,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let uf=["bottom","center","top"];class ah{constructor(l,d,g,w,I,P){this.text=l,this.image=d,this.scale=g,this.fontStack=w,this.textColor=I,this.verticalAlign=P}}class co{constructor(l){this.sections=l}static fromString(l){return new co([new ah(l,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof co?l:co.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class Ds{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Ds)return l;if(typeof l=="number")return new Ds([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(let d of l)if(typeof d!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new Ds(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,d,g){return new Ds(oh(l.values,d.values,g))}}class bn{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}let $d=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class uo{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof uo)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let d=0;d<l.length;d+=2){let g=l[d],w=l[d+1];if(typeof g!="string"||!$d.has(g)||!Array.isArray(w)||w.length!==2||typeof w[0]!="number"||typeof w[1]!="number")return}return new uo(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,d,g){let w=l.values,I=d.values;if(w.length!==I.length)throw new bn(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${d.toString()}`);let P=[];for(let D=0;D<w.length;D+=2){if(w[D]!==I[D])throw new bn(`Cannot interpolate values containing mismatched anchors. from[${D}]: ${w[D]}, to[${D}]: ${I[D]}`);P.push(w[D]);let[U,G]=w[D+1],[$,K]=I[D+1];P.push([cl(U,$,g),cl(G,K,g)])}return new uo(P)}}class So{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new So({name:l,available:!1}):null}}class hs{constructor(l,d,g){this.from=l,this.to=d,this.transition=g}static interpolate(l,d,g){return new hs(l,d,g)}static parse(l){return l instanceof hs?l:Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"?new hs(l[0],l[1],l[2]):typeof l=="object"&&typeof l.from=="string"&&typeof l.to=="string"&&typeof l.transition=="number"?new hs(l.from,l.to,l.transition):typeof l=="string"?new hs(l,l,1):void 0}}function Fg(f,l,d,g){return typeof f=="number"&&f>=0&&f<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof d=="number"&&d>=0&&d<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[f,l,d,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[f,l,d,g]:[f,l,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xl(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof hs||f instanceof Ei||f instanceof Jo||f instanceof co||f instanceof Ds||f instanceof uo||f instanceof So)return!0;if(Array.isArray(f)){for(let l of f)if(!Xl(l))return!1;return!0}if(typeof f=="object"){for(let l in f)if(!Xl(f[l]))return!1;return!0}return!1}function vn(f){if(f===null)return _i;if(typeof f=="string")return pr;if(typeof f=="boolean")return tr;if(typeof f=="number")return Gt;if(f instanceof Ei)return Vr;if(f instanceof hs)return xn;if(f instanceof Jo)return Kn;if(f instanceof co)return rn;if(f instanceof Ds)return nh;if(f instanceof uo)return Ct;if(f instanceof So)return Wl;if(Array.isArray(f)){let l=f.length,d;for(let g of f){let w=vn(g);if(d){if(d===w)continue;d=Br;break}d=w}return Kr(d||Br,l)}return ma}function lh(f){let l=typeof f;return f===null?"":l==="string"||l==="number"||l==="boolean"?String(f):f instanceof Ei||f instanceof hs||f instanceof co||f instanceof Ds||f instanceof uo||f instanceof So?f.toString():JSON.stringify(f)}class Yl{constructor(l,d){this.type=l,this.value=d}static parse(l,d){if(l.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Xl(l[1]))return d.error("invalid value");let g=l[1],w=vn(g),I=d.expectedType;return w.kind!=="array"||w.N!==0||!I||I.kind!=="array"||typeof I.N=="number"&&I.N!==0||(w=I),new Yl(w,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let hf={string:pr,number:Gt,boolean:tr,object:ma};class Io{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g,w=1,I=l[0];if(I==="array"){let D,U;if(l.length>2){let G=l[1];if(typeof G!="string"||!(G in hf)||G==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);D=hf[G],w++}else D=Br;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return d.error('The length argument to "array" must be a positive integer literal',2);U=l[2],w++}g=Kr(D,U)}else{if(!hf[I])throw new Error(`Types doesn't contain name = ${I}`);g=hf[I]}let P=[];for(;w<l.length;w++){let D=d.parse(l[w],w,Br);if(!D)return null;P.push(D)}return new Io(g,P)}evaluate(l){for(let d=0;d<this.args.length;d++){let g=this.args[d].evaluate(l);if(!Qn(this.type,vn(g)))return g;if(d===this.args.length-1)throw new bn(`Expected value to be of type ${ii(this.type)}, but found ${ii(vn(g))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}let mn={"to-boolean":tr,"to-color":Vr,"to-number":Gt,"to-string":pr};class ka{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g=l[0];if(!mn[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&l.length!==2)return d.error("Expected one argument.");let w=mn[g],I=[];for(let P=1;P<l.length;P++){let D=d.parse(l[P],P,Br);if(!D)return null;I.push(D)}return new ka(w,I)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let d,g;for(let w of this.args){if(d=w.evaluate(l),g=null,d instanceof Ei)return d;if(typeof d=="string"){let I=l.parseColor(d);if(I)return I}else if(Array.isArray(d)&&(g=d.length<3||d.length>4?`Invalid rgba value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:Fg(d[0],d[1],d[2],d[3]),!g))return new Ei(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new bn(g||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(let g of this.args){d=g.evaluate(l);let w=Ds.parse(d);if(w)return w}throw new bn(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(let g of this.args){d=g.evaluate(l);let w=uo.parse(d);if(w)return w}throw new bn(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(let g of this.args){if(d=g.evaluate(l),d===null)return 0;let w=Number(d);if(!isNaN(w))return w}throw new bn(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return co.fromString(lh(this.args[0].evaluate(l)));case"resolvedImage":return So.fromString(lh(this.args[0].evaluate(l)));case"projectionDefinition":return this.args[0].evaluate(l);default:return lh(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}let Fi=["Unknown","Point","LineString","Polygon"];class ti{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let d=this._parseColorCache[l];return d||(d=this._parseColorCache[l]=Ei.parse(l)),d}}class ch{constructor(l,d,g=[],w,I=new kr,P=[]){this.registry=l,this.path=g,this.key=g.map(D=>`[${D}]`).join(""),this.scope=I,this.errors=P,this.expectedType=w,this._isConstant=d}parse(l,d,g,w,I={}){return d?this.concat(d,g,w)._parse(l,I):this._parse(l,I)}_parse(l,d){function g(w,I,P){return P==="assert"?new Io(I,[w]):P==="coerce"?new ka(I,[w]):w}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let w=l[0];if(typeof w!="string")return this.error(`Expression name must be a string, but found ${typeof w} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let I=this.registry[w];if(I){let P=I.parse(l,this);if(!P)return null;if(this.expectedType){let D=this.expectedType,U=P.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||U.kind!=="value")if(D.kind!=="projectionDefinition"||U.kind!=="string"&&U.kind!=="array")if(D.kind!=="color"&&D.kind!=="formatted"&&D.kind!=="resolvedImage"||U.kind!=="value"&&U.kind!=="string")if(D.kind!=="padding"||U.kind!=="value"&&U.kind!=="number"&&U.kind!=="array")if(D.kind!=="variableAnchorOffsetCollection"||U.kind!=="value"&&U.kind!=="array"){if(this.checkSubtype(D,U))return null}else P=g(P,D,d.typeAnnotation||"coerce");else P=g(P,D,d.typeAnnotation||"coerce");else P=g(P,D,d.typeAnnotation||"coerce");else P=g(P,D,d.typeAnnotation||"coerce");else P=g(P,D,d.typeAnnotation||"assert")}if(!(P instanceof Yl)&&P.type.kind!=="resolvedImage"&&this._isConstant(P)){let D=new ti;try{P=new Yl(P.type,P.evaluate(D))}catch(U){return this.error(U.message),null}}return P}return this.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,d,g){let w=typeof l=="number"?this.path.concat(l):this.path,I=g?this.scope.concat(g):this.scope;return new ch(this.registry,this._isConstant,w,d||null,I,this.errors)}error(l,...d){let g=`${this.key}${d.map(w=>`[${w}]`).join("")}`;this.errors.push(new Sr(g,l))}checkSubtype(l,d){let g=Qn(l,d);return g&&this.error(g),g}}class vi{constructor(l,d){this.type=d.type,this.bindings=[].concat(l),this.result=d}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(let d of this.bindings)l(d[1]);l(this.result)}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);let g=[];for(let I=1;I<l.length-1;I+=2){let P=l[I];if(typeof P!="string")return d.error(`Expected string, but found ${typeof P} instead.`,I);if(/[^a-zA-Z0-9_]/.test(P))return d.error("Variable names must contain only alphanumeric characters or '_'.",I);let D=d.parse(l[I+1],I+1);if(!D)return null;g.push([P,D])}let w=d.parse(l[l.length-1],l.length-1,d.expectedType,g);return w?new vi(g,w):null}outputDefined(){return this.result.outputDefined()}}class uh{constructor(l,d){this.type=d.type,this.name=l,this.boundExpression=d}static parse(l,d){if(l.length!==2||typeof l[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");let g=l[1];return d.scope.has(g)?new uh(g,d.scope.get(g)):d.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class _a{constructor(l,d,g){this.type=l,this.index=d,this.input=g}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,Gt),w=d.parse(l[2],2,Kr(d.expectedType||Br));return g&&w?new _a(w.type.itemType,g,w):null}evaluate(l){let d=this.index.evaluate(l),g=this.input.evaluate(l);if(d<0)throw new bn(`Array index out of bounds: ${d} < 0.`);if(d>=g.length)throw new bn(`Array index out of bounds: ${d} > ${g.length-1}.`);if(d!==Math.floor(d))throw new bn(`Array index must be an integer, but found ${d} instead.`);return g[d]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class ff{constructor(l,d){this.type=tr,this.needle=l,this.haystack=d}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,Br),w=d.parse(l[2],2,Br);return g&&w?Co(g.type,[tr,pr,Gt,_i,Br])?new ff(g,w):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(g.type)} instead`):null}evaluate(l){let d=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!g)return!1;if(!us(d,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${ii(vn(d))} instead.`);if(!us(g,["string","array"]))throw new bn(`Expected second argument to be of type array or string, but found ${ii(vn(g))} instead.`);return g.indexOf(d)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class df{constructor(l,d,g){this.type=Gt,this.needle=l,this.haystack=d,this.fromIndex=g}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,Br),w=d.parse(l[2],2,Br);if(!g||!w)return null;if(!Co(g.type,[tr,pr,Gt,_i,Br]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(g.type)} instead`);if(l.length===4){let I=d.parse(l[3],3,Gt);return I?new df(g,w,I):null}return new df(g,w)}evaluate(l){let d=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!us(d,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${ii(vn(d))} instead.`);let w;if(this.fromIndex&&(w=this.fromIndex.evaluate(l)),us(g,["string"])){let I=g.indexOf(d,w);return I===-1?-1:[...g.slice(0,I)].length}if(us(g,["array"]))return g.indexOf(d,w);throw new bn(`Expected second argument to be of type array or string, but found ${ii(vn(g))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class qd{constructor(l,d,g,w,I,P){this.inputType=l,this.type=d,this.input=g,this.cases=w,this.outputs=I,this.otherwise=P}static parse(l,d){if(l.length<5)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return d.error("Expected an even number of arguments.");let g,w;d.expectedType&&d.expectedType.kind!=="value"&&(w=d.expectedType);let I={},P=[];for(let G=2;G<l.length-1;G+=2){let $=l[G],K=l[G+1];Array.isArray($)||($=[$]);let se=d.concat(G);if($.length===0)return se.error("Expected at least one branch label.");for(let he of $){if(typeof he!="number"&&typeof he!="string")return se.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return se.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof he=="number"&&Math.floor(he)!==he)return se.error("Numeric branch labels must be integer values.");if(g){if(se.checkSubtype(g,vn(he)))return null}else g=vn(he);if(I[String(he)]!==void 0)return se.error("Branch labels must be unique.");I[String(he)]=P.length}let ce=d.parse(K,G,w);if(!ce)return null;w=w||ce.type,P.push(ce)}let D=d.parse(l[1],1,Br);if(!D)return null;let U=d.parse(l[l.length-1],l.length-1,w);return U?D.type.kind!=="value"&&d.concat(1).checkSubtype(g,D.type)?null:new qd(g,w,D,I,P,U):null}evaluate(l){let d=this.input.evaluate(l);return(vn(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class pf{constructor(l,d,g){this.type=l,this.branches=d,this.otherwise=g}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return d.error("Expected an odd number of arguments.");let g;d.expectedType&&d.expectedType.kind!=="value"&&(g=d.expectedType);let w=[];for(let P=1;P<l.length-1;P+=2){let D=d.parse(l[P],P,tr);if(!D)return null;let U=d.parse(l[P+1],P+1,g);if(!U)return null;w.push([D,U]),g=g||U.type}let I=d.parse(l[l.length-1],l.length-1,g);if(!I)return null;if(!g)throw new Error("Can't infer output type");return new pf(g,w,I)}evaluate(l){for(let[d,g]of this.branches)if(d.evaluate(l))return g.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(let[d,g]of this.branches)l(d),l(g);l(this.otherwise)}outputDefined(){return this.branches.every(([l,d])=>d.outputDefined())&&this.otherwise.outputDefined()}}class Af{constructor(l,d,g,w){this.type=l,this.input=d,this.beginIndex=g,this.endIndex=w}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,Br),w=d.parse(l[2],2,Gt);if(!g||!w)return null;if(!Co(g.type,[Kr(Br),pr,Br]))return d.error(`Expected first argument to be of type array or string, but found ${ii(g.type)} instead`);if(l.length===4){let I=d.parse(l[3],3,Gt);return I?new Af(g.type,g,w,I):null}return new Af(g.type,g,w)}evaluate(l){let d=this.input.evaluate(l),g=this.beginIndex.evaluate(l),w;if(this.endIndex&&(w=this.endIndex.evaluate(l)),us(d,["string"]))return[...d].slice(g,w).join("");if(us(d,["array"]))return d.slice(g,w);throw new bn(`Expected first argument to be of type array or string, but found ${ii(vn(d))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Zd(f,l){let d=f.length-1,g,w,I=0,P=d,D=0;for(;I<=P;)if(D=Math.floor((I+P)/2),g=f[D],w=f[D+1],g<=l){if(D===d||l<w)return D;I=D+1}else{if(!(g>l))throw new bn("Input is not a number.");P=D-1}return 0}class hh{constructor(l,d,g){this.type=l,this.input=d,this.labels=[],this.outputs=[];for(let[w,I]of g)this.labels.push(w),this.outputs.push(I)}static parse(l,d){if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");let g=d.parse(l[1],1,Gt);if(!g)return null;let w=[],I=null;d.expectedType&&d.expectedType.kind!=="value"&&(I=d.expectedType);for(let P=1;P<l.length;P+=2){let D=P===1?-1/0:l[P],U=l[P+1],G=P,$=P+1;if(typeof D!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(w.length&&w[w.length-1][0]>=D)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',G);let K=d.parse(U,$,I);if(!K)return null;I=I||K.type,w.push([D,K])}return new hh(I,g,w)}evaluate(l){let d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(l);let w=this.input.evaluate(l);if(w<=d[0])return g[0].evaluate(l);let I=d.length;return w>=d[I-1]?g[I-1].evaluate(l):g[Zd(d,w)].evaluate(l)}eachChild(l){l(this.input);for(let d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function kg(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Yc,Fs,Xd=function(){if(Fs)return Yc;function f(l,d,g,w){this.cx=3*l,this.bx=3*(g-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(w-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=d,this.p2x=g,this.p2y=w}return Fs=1,Yc=f,f.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,d){if(d===void 0&&(d=1e-6),l<0)return 0;if(l>1)return 1;for(var g=l,w=0;w<8;w++){var I=this.sampleCurveX(g)-l;if(Math.abs(I)<d)return g;var P=this.sampleCurveDerivativeX(g);if(Math.abs(P)<1e-6)break;g-=I/P}var D=0,U=1;for(g=l,w=0;w<20&&(I=this.sampleCurveX(g),!(Math.abs(I-l)<d));w++)l>I?D=g:U=g,g=.5*(U-D)+D;return g},solve:function(l,d){return this.sampleCurveY(this.solveCurveX(l,d))}},Yc}(),Ng=kg(Xd);class Ys{constructor(l,d,g,w,I){this.type=l,this.operator=d,this.interpolation=g,this.input=w,this.labels=[],this.outputs=[];for(let[P,D]of I)this.labels.push(P),this.outputs.push(D)}static interpolationFactor(l,d,g,w){let I=0;if(l.name==="exponential")I=es(d,l.base,g,w);else if(l.name==="linear")I=es(d,1,g,w);else if(l.name==="cubic-bezier"){let P=l.controlPoints;I=new Ng(P[0],P[1],P[2],P[3]).solve(es(d,1,g,w))}return I}static parse(l,d){let[g,w,I,...P]=l;if(!Array.isArray(w)||w.length===0)return d.error("Expected an interpolation type expression.",1);if(w[0]==="linear")w={name:"linear"};else if(w[0]==="exponential"){let G=w[1];if(typeof G!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);w={name:"exponential",base:G}}else{if(w[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(w[0])}`,1,0);{let G=w.slice(1);if(G.length!==4||G.some($=>typeof $!="number"||$<0||$>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);w={name:"cubic-bezier",controlPoints:G}}}if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(I=d.parse(I,2,Gt),!I)return null;let D=[],U=null;g==="interpolate-hcl"||g==="interpolate-lab"?U=Vr:d.expectedType&&d.expectedType.kind!=="value"&&(U=d.expectedType);for(let G=0;G<P.length;G+=2){let $=P[G],K=P[G+1],se=G+3,ce=G+4;if(typeof $!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(D.length&&D[D.length-1][0]>=$)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);let he=d.parse(K,ce,U);if(!he)return null;U=U||he.type,D.push([$,he])}return Ti(U,Gt)||Ti(U,xn)||Ti(U,Vr)||Ti(U,nh)||Ti(U,Ct)||Ti(U,Kr(Gt))?new Ys(U,g,w,I,D):d.error(`Type ${ii(U)} is not interpolatable.`)}evaluate(l){let d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(l);let w=this.input.evaluate(l);if(w<=d[0])return g[0].evaluate(l);let I=d.length;if(w>=d[I-1])return g[I-1].evaluate(l);let P=Zd(d,w),D=Ys.interpolationFactor(this.interpolation,w,d[P],d[P+1]),U=g[P].evaluate(l),G=g[P+1].evaluate(l);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return cl(U,G,D);case"color":return Ei.interpolate(U,G,D);case"padding":return Ds.interpolate(U,G,D);case"variableAnchorOffsetCollection":return uo.interpolate(U,G,D);case"array":return oh(U,G,D);case"projectionDefinition":return hs.interpolate(U,G,D)}case"interpolate-hcl":return Ei.interpolate(U,G,D,"hcl");case"interpolate-lab":return Ei.interpolate(U,G,D,"lab")}}eachChild(l){l(this.input);for(let d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function es(f,l,d,g){let w=g-d,I=f-d;return w===0?0:l===1?I/w:(Math.pow(l,I)-1)/(Math.pow(l,w)-1)}let ya={color:Ei.interpolate,number:cl,padding:Ds.interpolate,variableAnchorOffsetCollection:uo.interpolate,array:oh};class fh{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g=null,w=d.expectedType;w&&w.kind!=="value"&&(g=w);let I=[];for(let D of l.slice(1)){let U=d.parse(D,1+I.length,g,void 0,{typeAnnotation:"omit"});if(!U)return null;g=g||U.type,I.push(U)}if(!g)throw new Error("No output type");let P=w&&I.some(D=>Qn(w,D.type));return new fh(P?Br:g,I)}evaluate(l){let d,g=null,w=0;for(let I of this.args)if(w++,g=I.evaluate(l),g&&g instanceof So&&!g.available&&(d||(d=g.name),g=null,w===this.args.length&&(g=d)),g!==null)break;return g}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function em(f,l){return f==="=="||f==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function zg(f,l,d,g){return g.compare(l,d)===0}function ul(f,l,d){let g=f!=="=="&&f!=="!=";return class i6{constructor(I,P,D){this.type=tr,this.lhs=I,this.rhs=P,this.collator=D,this.hasUntypedArgument=I.type.kind==="value"||P.type.kind==="value"}static parse(I,P){if(I.length!==3&&I.length!==4)return P.error("Expected two or three arguments.");let D=I[0],U=P.parse(I[1],1,Br);if(!U)return null;if(!em(D,U.type))return P.concat(1).error(`"${D}" comparisons are not supported for type '${ii(U.type)}'.`);let G=P.parse(I[2],2,Br);if(!G)return null;if(!em(D,G.type))return P.concat(2).error(`"${D}" comparisons are not supported for type '${ii(G.type)}'.`);if(U.type.kind!==G.type.kind&&U.type.kind!=="value"&&G.type.kind!=="value")return P.error(`Cannot compare types '${ii(U.type)}' and '${ii(G.type)}'.`);g&&(U.type.kind==="value"&&G.type.kind!=="value"?U=new Io(G.type,[U]):U.type.kind!=="value"&&G.type.kind==="value"&&(G=new Io(U.type,[G])));let $=null;if(I.length===4){if(U.type.kind!=="string"&&G.type.kind!=="string"&&U.type.kind!=="value"&&G.type.kind!=="value")return P.error("Cannot use collator to compare non-string types.");if($=P.parse(I[3],3,Kn),!$)return null}return new i6(U,G,$)}evaluate(I){let P=this.lhs.evaluate(I),D=this.rhs.evaluate(I);if(g&&this.hasUntypedArgument){let U=vn(P),G=vn(D);if(U.kind!==G.kind||U.kind!=="string"&&U.kind!=="number")throw new bn(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${U.kind}, ${G.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){let U=vn(P),G=vn(D);if(U.kind!=="string"||G.kind!=="string")return l(I,P,D)}return this.collator?d(I,P,D,this.collator.evaluate(I)):l(I,P,D)}eachChild(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)}outputDefined(){return!0}}}let tm=ul("==",function(f,l,d){return l===d},zg),rm=ul("!=",function(f,l,d){return l!==d},function(f,l,d,g){return!zg(0,l,d,g)}),mf=ul("<",function(f,l,d){return l<d},function(f,l,d,g){return g.compare(l,d)<0}),gf=ul(">",function(f,l,d){return l>d},function(f,l,d,g){return g.compare(l,d)>0}),Mo=ul("<=",function(f,l,d){return l<=d},function(f,l,d,g){return g.compare(l,d)<=0}),Yd=ul(">=",function(f,l,d){return l>=d},function(f,l,d,g){return g.compare(l,d)>=0});class hl{constructor(l,d,g){this.type=Kn,this.locale=g,this.caseSensitive=l,this.diacriticSensitive=d}static parse(l,d){if(l.length!==2)return d.error("Expected one argument.");let g=l[1];if(typeof g!="object"||Array.isArray(g))return d.error("Collator options argument must be an object.");let w=d.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,tr);if(!w)return null;let I=d.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,tr);if(!I)return null;let P=null;return g.locale&&(P=d.parse(g.locale,1,pr),!P)?null:new hl(w,I,P)}evaluate(l){return new Jo(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class _f{constructor(l,d,g,w,I){this.type=pr,this.number=l,this.locale=d,this.currency=g,this.minFractionDigits=w,this.maxFractionDigits=I}static parse(l,d){if(l.length!==3)return d.error("Expected two arguments.");let g=d.parse(l[1],1,Gt);if(!g)return null;let w=l[2];if(typeof w!="object"||Array.isArray(w))return d.error("NumberFormat options argument must be an object.");let I=null;if(w.locale&&(I=d.parse(w.locale,1,pr),!I))return null;let P=null;if(w.currency&&(P=d.parse(w.currency,1,pr),!P))return null;let D=null;if(w["min-fraction-digits"]&&(D=d.parse(w["min-fraction-digits"],1,Gt),!D))return null;let U=null;return w["max-fraction-digits"]&&(U=d.parse(w["max-fraction-digits"],1,Gt),!U)?null:new _f(g,I,P,D,U)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class Na{constructor(l){this.type=rn,this.sections=l}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g=l[1];if(!Array.isArray(g)&&typeof g=="object")return d.error("First argument must be an image or text section.");let w=[],I=!1;for(let P=1;P<=l.length-1;++P){let D=l[P];if(I&&typeof D=="object"&&!Array.isArray(D)){I=!1;let U=null;if(D["font-scale"]&&(U=d.parse(D["font-scale"],1,Gt),!U))return null;let G=null;if(D["text-font"]&&(G=d.parse(D["text-font"],1,Kr(pr)),!G))return null;let $=null;if(D["text-color"]&&($=d.parse(D["text-color"],1,Vr),!$))return null;let K=null;if(D["vertical-align"]){if(typeof D["vertical-align"]=="string"&&!uf.includes(D["vertical-align"]))return d.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${D["vertical-align"]}' instead.`);if(K=d.parse(D["vertical-align"],1,pr),!K)return null}let se=w[w.length-1];se.scale=U,se.font=G,se.textColor=$,se.verticalAlign=K}else{let U=d.parse(l[P],1,Br);if(!U)return null;let G=U.type.kind;if(G!=="string"&&G!=="value"&&G!=="null"&&G!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");I=!0,w.push({content:U,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Na(w)}evaluate(l){return new co(this.sections.map(d=>{let g=d.content.evaluate(l);return vn(g)===Wl?new ah("",g,null,null,null,d.verticalAlign?d.verticalAlign.evaluate(l):null):new ah(lh(g),null,d.scale?d.scale.evaluate(l):null,d.font?d.font.evaluate(l).join(","):null,d.textColor?d.textColor.evaluate(l):null,d.verticalAlign?d.verticalAlign.evaluate(l):null)}))}eachChild(l){for(let d of this.sections)l(d.content),d.scale&&l(d.scale),d.font&&l(d.font),d.textColor&&l(d.textColor),d.verticalAlign&&l(d.verticalAlign)}outputDefined(){return!1}}class dh{constructor(l){this.type=Wl,this.input=l}static parse(l,d){if(l.length!==2)return d.error("Expected two arguments.");let g=d.parse(l[1],1,pr);return g?new dh(g):d.error("No image name provided.")}evaluate(l){let d=this.input.evaluate(l),g=So.fromString(d);return g&&l.availableImages&&(g.available=l.availableImages.indexOf(d)>-1),g}eachChild(l){l(this.input)}outputDefined(){return!1}}class za{constructor(l){this.type=Gt,this.input=l}static parse(l,d){if(l.length!==2)return d.error(`Expected 1 argument, but found ${l.length-1} instead.`);let g=d.parse(l[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${ii(g.type)} instead.`):new za(g):null}evaluate(l){let d=this.input.evaluate(l);if(typeof d=="string")return[...d].length;if(Array.isArray(d))return d.length;throw new bn(`Expected value to be of type string or array, but found ${ii(vn(d))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}let gt=8192;function $t(f,l){let d=(180+f[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,w=Math.pow(2,l.z);return[Math.round(d*w*gt),Math.round(g*w*gt)]}function or(f,l){let d=Math.pow(2,l.z);return[(w=(f[0]/gt+l.x)/d,360*w-180),(g=(f[1]/gt+l.y)/d,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,w}function Dr(f,l){f[0]=Math.min(f[0],l[0]),f[1]=Math.min(f[1],l[1]),f[2]=Math.max(f[2],l[0]),f[3]=Math.max(f[3],l[1])}function y(f,l){return!(f[0]<=l[0]||f[2]>=l[2]||f[1]<=l[1]||f[3]>=l[3])}function Yi(f,l,d){let g=f[0]-l[0],w=f[1]-l[1],I=f[0]-d[0],P=f[1]-d[1];return g*P-I*w==0&&g*I<=0&&w*P<=0}function Mi(f,l,d,g){return(w=[g[0]-d[0],g[1]-d[1]])[0]*(I=[l[0]-f[0],l[1]-f[1]])[1]-w[1]*I[0]!=0&&!(!gn(f,l,d,g)||!gn(d,g,f,l));var w,I}function Ce(f,l,d){for(let g of d)for(let w=0;w<g.length-1;++w)if(Mi(f,l,g[w],g[w+1]))return!0;return!1}function Rn(f,l,d=!1){let g=!1;for(let D of l)for(let U=0;U<D.length-1;U++){if(Yi(f,D[U],D[U+1]))return d;(I=D[U])[1]>(w=f)[1]!=(P=D[U+1])[1]>w[1]&&w[0]<(P[0]-I[0])*(w[1]-I[1])/(P[1]-I[1])+I[0]&&(g=!g)}var w,I,P;return g}function ho(f,l){for(let d of l)if(Rn(f,d))return!0;return!1}function ts(f,l){for(let d of f)if(!Rn(d,l))return!1;for(let d=0;d<f.length-1;++d)if(Ce(f[d],f[d+1],l))return!1;return!0}function Gi(f,l){for(let d of l)if(ts(f,d))return!0;return!1}function gn(f,l,d,g){let w=g[0]-d[0],I=g[1]-d[1],P=(f[0]-d[0])*I-w*(f[1]-d[1]),D=(l[0]-d[0])*I-w*(l[1]-d[1]);return P>0&&D<0||P<0&&D>0}function Wn(f,l,d){let g=[];for(let w=0;w<f.length;w++){let I=[];for(let P=0;P<f[w].length;P++){let D=$t(f[w][P],d);Dr(l,D),I.push(D)}g.push(I)}return g}function Ci(f,l,d){let g=[];for(let w=0;w<f.length;w++){let I=Wn(f[w],l,d);g.push(I)}return g}function Pi(f,l,d,g){if(f[0]<d[0]||f[0]>d[2]){let w=.5*g,I=f[0]-d[0]>w?-g:d[0]-f[0]>w?g:0;I===0&&(I=f[0]-d[2]>w?-g:d[2]-f[0]>w?g:0),f[0]+=I}Dr(l,f)}function Kc(f,l,d,g){let w=Math.pow(2,g.z)*gt,I=[g.x*gt,g.y*gt],P=[];for(let D of f)for(let U of D){let G=[U.x+I[0],U.y+I[1]];Pi(G,l,d,w),P.push(G)}return P}function im(f,l,d,g){let w=Math.pow(2,g.z)*gt,I=[g.x*gt,g.y*gt],P=[];for(let U of f){let G=[];for(let $ of U){let K=[$.x+I[0],$.y+I[1]];Dr(l,K),G.push(K)}P.push(G)}if(l[2]-l[0]<=w/2){(D=l)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(let U of P)for(let G of U)Pi(G,l,d,w)}var D;return P}class Kl{constructor(l,d){this.type=tr,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Xl(l[1])){let g=l[1];if(g.type==="FeatureCollection"){let w=[];for(let I of g.features){let{type:P,coordinates:D}=I.geometry;P==="Polygon"&&w.push(D),P==="MultiPolygon"&&w.push(...D)}if(w.length)return new Kl(g,{type:"MultiPolygon",coordinates:w})}else if(g.type==="Feature"){let w=g.geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new Kl(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new Kl(g,g)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,g){let w=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],P=d.canonicalID();if(g.type==="Polygon"){let D=Wn(g.coordinates,I,P),U=Kc(d.geometry(),w,I,P);if(!y(w,I))return!1;for(let G of U)if(!Rn(G,D))return!1}if(g.type==="MultiPolygon"){let D=Ci(g.coordinates,I,P),U=Kc(d.geometry(),w,I,P);if(!y(w,I))return!1;for(let G of U)if(!ho(G,D))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,g){let w=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],P=d.canonicalID();if(g.type==="Polygon"){let D=Wn(g.coordinates,I,P),U=im(d.geometry(),w,I,P);if(!y(w,I))return!1;for(let G of U)if(!ts(G,D))return!1}if(g.type==="MultiPolygon"){let D=Ci(g.coordinates,I,P),U=im(d.geometry(),w,I,P);if(!y(w,I))return!1;for(let G of U)if(!Gi(G,D))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Qc=class{constructor(f=[],l=(d,g)=>d<g?-1:d>g?1:0){if(this.data=f,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(f){this.data.push(f),this._up(this.length++)}pop(){if(this.length===0)return;let f=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),f}peek(){return this.data[0]}_up(f){let{data:l,compare:d}=this,g=l[f];for(;f>0;){let w=f-1>>1,I=l[w];if(d(g,I)>=0)break;l[f]=I,f=w}l[f]=g}_down(f){let{data:l,compare:d}=this,g=this.length>>1,w=l[f];for(;f<g;){let I=1+(f<<1),P=I+1;if(P<this.length&&d(l[P],l[I])<0&&(I=P),d(l[I],w)>=0)break;l[f]=l[I],f=I}l[f]=w}};function Po(f,l,d=0,g=f.length-1,w=ba){for(;g>d;){if(g-d>600){let U=g-d+1,G=l-d+1,$=Math.log(U),K=.5*Math.exp(2*$/3),se=.5*Math.sqrt($*K*(U-K)/U)*(G-U/2<0?-1:1);Po(f,l,Math.max(d,Math.floor(l-G*K/U+se)),Math.min(g,Math.floor(l+(U-G)*K/U+se)),w)}let I=f[l],P=d,D=g;for(xa(f,d,l),w(f[g],I)>0&&xa(f,d,g);P<D;){for(xa(f,P,D),P++,D--;w(f[P],I)<0;)P++;for(;w(f[D],I)>0;)D--}w(f[d],I)===0?xa(f,d,D):(D++,xa(f,D,g)),D<=l&&(d=D+1),l<=D&&(g=D-1)}}function xa(f,l,d){let g=f[l];f[l]=f[d],f[d]=g}function ba(f,l){return f<l?-1:f>l?1:0}function Ql(f,l){if(f.length<=1)return[f];let d=[],g,w;for(let I of f){let P=Jl(I);P!==0&&(I.area=Math.abs(P),w===void 0&&(w=P<0),w===P<0?(g&&d.push(g),g=[I]):g.push(I))}if(g&&d.push(g),l>1)for(let I=0;I<d.length;I++)d[I].length<=l||(Po(d[I],l,1,d[I].length-1,nm),d[I]=d[I].slice(0,l));return d}function nm(f,l){return l.area-f.area}function Jl(f){let l=0;for(let d,g,w=0,I=f.length,P=I-1;w<I;P=w++)d=f[w],g=f[P],l+=(g.x-d.x)*(d.y+g.y);return l}let Qr=1/298.257223563,Re=Qr*(2-Qr),zr=Math.PI/180;class yf{constructor(l){let d=6378.137*zr*1e3,g=Math.cos(l*zr),w=1/(1-Re*(1-g*g)),I=Math.sqrt(w);this.kx=d*I*g,this.ky=d*I*w*(1-Re)}distance(l,d){let g=this.wrap(l[0]-d[0])*this.kx,w=(l[1]-d[1])*this.ky;return Math.sqrt(g*g+w*w)}pointOnLine(l,d){let g,w,I,P,D=1/0;for(let U=0;U<l.length-1;U++){let G=l[U][0],$=l[U][1],K=this.wrap(l[U+1][0]-G)*this.kx,se=(l[U+1][1]-$)*this.ky,ce=0;K===0&&se===0||(ce=(this.wrap(d[0]-G)*this.kx*K+(d[1]-$)*this.ky*se)/(K*K+se*se),ce>1?(G=l[U+1][0],$=l[U+1][1]):ce>0&&(G+=K/this.kx*ce,$+=se/this.ky*ce)),K=this.wrap(d[0]-G)*this.kx,se=(d[1]-$)*this.ky;let he=K*K+se*se;he<D&&(D=he,g=G,w=$,I=U,P=ce)}return{point:[g,w],index:I,t:Math.max(0,Math.min(1,P))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function sm(f,l){return l[0]-f[0]}function xf(f){return f[1]-f[0]+1}function va(f,l){return f[1]>=f[0]&&f[1]<l}function Kd(f,l){if(f[0]>f[1])return[null,null];let d=xf(f);if(l){if(d===2)return[f,null];let w=Math.floor(d/2);return[[f[0],f[0]+w],[f[0]+w,f[1]]]}if(d===1)return[f,null];let g=Math.floor(d/2)-1;return[[f[0],f[0]+g],[f[0]+g+1,f[1]]]}function we(f,l){if(!va(l,f.length))return[1/0,1/0,-1/0,-1/0];let d=[1/0,1/0,-1/0,-1/0];for(let g=l[0];g<=l[1];++g)Dr(d,f[g]);return d}function Qd(f){let l=[1/0,1/0,-1/0,-1/0];for(let d of f)for(let g of d)Dr(l,g);return l}function om(f){return f[0]!==-1/0&&f[1]!==-1/0&&f[2]!==1/0&&f[3]!==1/0}function Ri(f,l,d){if(!om(f)||!om(l))return NaN;let g=0,w=0;return f[2]<l[0]&&(g=l[0]-f[2]),f[0]>l[2]&&(g=f[0]-l[2]),f[1]>l[3]&&(w=f[1]-l[3]),f[3]<l[1]&&(w=l[1]-f[3]),d.distance([0,0],[g,w])}function ec(f,l,d){let g=d.pointOnLine(l,f);return d.distance(f,g.point)}function Jd(f,l,d,g,w){let I=Math.min(ec(f,[d,g],w),ec(l,[d,g],w)),P=Math.min(ec(d,[f,l],w),ec(g,[f,l],w));return Math.min(I,P)}function Ug(f,l,d,g,w){if(!va(l,f.length)||!va(g,d.length))return 1/0;let I=1/0;for(let P=l[0];P<l[1];++P){let D=f[P],U=f[P+1];for(let G=g[0];G<g[1];++G){let $=d[G],K=d[G+1];if(Mi(D,U,$,K))return 0;I=Math.min(I,Jd(D,U,$,K,w))}}return I}function am(f,l,d,g,w){if(!va(l,f.length)||!va(g,d.length))return NaN;let I=1/0;for(let P=l[0];P<=l[1];++P)for(let D=g[0];D<=g[1];++D)if(I=Math.min(I,w.distance(f[P],d[D])),I===0)return I;return I}function lm(f,l,d){if(Rn(f,l,!0))return 0;let g=1/0;for(let w of l){let I=w[0],P=w[w.length-1];if(I!==P&&(g=Math.min(g,ec(f,[P,I],d)),g===0))return g;let D=d.pointOnLine(w,f);if(g=Math.min(g,d.distance(f,D.point)),g===0)return g}return g}function cm(f,l,d,g){if(!va(l,f.length))return NaN;for(let I=l[0];I<=l[1];++I)if(Rn(f[I],d,!0))return 0;let w=1/0;for(let I=l[0];I<l[1];++I){let P=f[I],D=f[I+1];for(let U of d)for(let G=0,$=U.length,K=$-1;G<$;K=G++){let se=U[K],ce=U[G];if(Mi(P,D,se,ce))return 0;w=Math.min(w,Jd(P,D,se,ce,g))}}return w}function wa(f,l){for(let d of f)for(let g of d)if(Rn(g,l,!0))return!0;return!1}function fs(f,l,d,g=1/0){let w=Qd(f),I=Qd(l);if(g!==1/0&&Ri(w,I,d)>=g)return g;if(y(w,I)){if(wa(f,l))return 0}else if(wa(l,f))return 0;let P=1/0;for(let D of f)for(let U=0,G=D.length,$=G-1;U<G;$=U++){let K=D[$],se=D[U];for(let ce of l)for(let he=0,me=ce.length,Ee=me-1;he<me;Ee=he++){let Oe=ce[Ee],et=ce[he];if(Mi(K,se,Oe,et))return 0;P=Math.min(P,Jd(K,se,Oe,et,d))}}return P}function bf(f,l,d,g,w,I){if(!I)return;let P=Ri(we(g,I),w,d);P<l&&f.push([P,I,[0,0]])}function vf(f,l,d,g,w,I,P){if(!I||!P)return;let D=Ri(we(g,I),we(w,P),d);D<l&&f.push([D,I,P])}function wf(f,l,d,g,w=1/0){let I=Math.min(g.distance(f[0],d[0][0]),w);if(I===0)return I;let P=new Qc([[0,[0,f.length-1],[0,0]]],sm),D=Qd(d);for(;P.length>0;){let U=P.pop();if(U[0]>=I)continue;let G=U[1],$=l?50:100;if(xf(G)<=$){if(!va(G,f.length))return NaN;if(l){let K=cm(f,G,d,g);if(isNaN(K)||K===0)return K;I=Math.min(I,K)}else for(let K=G[0];K<=G[1];++K){let se=lm(f[K],d,g);if(I=Math.min(I,se),I===0)return 0}}else{let K=Kd(G,l);bf(P,I,g,f,D,K[0]),bf(P,I,g,f,D,K[1])}}return I}function ph(f,l,d,g,w,I=1/0){let P=Math.min(I,w.distance(f[0],d[0]));if(P===0)return P;let D=new Qc([[0,[0,f.length-1],[0,d.length-1]]],sm);for(;D.length>0;){let U=D.pop();if(U[0]>=P)continue;let G=U[1],$=U[2],K=l?50:100,se=g?50:100;if(xf(G)<=K&&xf($)<=se){if(!va(G,f.length)&&va($,d.length))return NaN;let ce;if(l&&g)ce=Ug(f,G,d,$,w),P=Math.min(P,ce);else if(l&&!g){let he=f.slice(G[0],G[1]+1);for(let me=$[0];me<=$[1];++me)if(ce=ec(d[me],he,w),P=Math.min(P,ce),P===0)return P}else if(!l&&g){let he=d.slice($[0],$[1]+1);for(let me=G[0];me<=G[1];++me)if(ce=ec(f[me],he,w),P=Math.min(P,ce),P===0)return P}else ce=am(f,G,d,$,w),P=Math.min(P,ce)}else{let ce=Kd(G,l),he=Kd($,g);vf(D,P,w,f,d,ce[0],he[0]),vf(D,P,w,f,d,ce[0],he[1]),vf(D,P,w,f,d,ce[1],he[0]),vf(D,P,w,f,d,ce[1],he[1])}}return P}function ep(f){return f.type==="MultiPolygon"?f.coordinates.map(l=>({type:"Polygon",coordinates:l})):f.type==="MultiLineString"?f.coordinates.map(l=>({type:"LineString",coordinates:l})):f.type==="MultiPoint"?f.coordinates.map(l=>({type:"Point",coordinates:l})):[f]}class tc{constructor(l,d){this.type=Gt,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Xl(l[1])){let g=l[1];if(g.type==="FeatureCollection")return new tc(g,g.features.map(w=>ep(w.geometry)).flat());if(g.type==="Feature")return new tc(g,ep(g.geometry));if("type"in g&&"coordinates"in g)return new tc(g,ep(g))}return d.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,g){let w=d.geometry(),I=w.flat().map(U=>or([U.x,U.y],d.canonical));if(w.length===0)return NaN;let P=new yf(I[0][1]),D=1/0;for(let U of g){switch(U.type){case"Point":D=Math.min(D,ph(I,!1,[U.coordinates],!1,P,D));break;case"LineString":D=Math.min(D,ph(I,!1,U.coordinates,!0,P,D));break;case"Polygon":D=Math.min(D,wf(I,!1,U.coordinates,P,D))}if(D===0)return D}return D}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,g){let w=d.geometry(),I=w.flat().map(U=>or([U.x,U.y],d.canonical));if(w.length===0)return NaN;let P=new yf(I[0][1]),D=1/0;for(let U of g){switch(U.type){case"Point":D=Math.min(D,ph(I,!0,[U.coordinates],!1,P,D));break;case"LineString":D=Math.min(D,ph(I,!0,U.coordinates,!0,P,D));break;case"Polygon":D=Math.min(D,wf(I,!0,U.coordinates,P,D))}if(D===0)return D}return D}(l,this.geometries);if(l.geometryType()==="Polygon")return function(d,g){let w=d.geometry();if(w.length===0||w[0].length===0)return NaN;let I=Ql(w,0).map(U=>U.map(G=>G.map($=>or([$.x,$.y],d.canonical)))),P=new yf(I[0][0][0][1]),D=1/0;for(let U of g)for(let G of I){switch(U.type){case"Point":D=Math.min(D,wf([U.coordinates],!1,G,P,D));break;case"LineString":D=Math.min(D,wf(U.coordinates,!0,G,P,D));break;case"Polygon":D=Math.min(D,fs(G,U.coordinates,P,D))}if(D===0)return D}return D}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}let Jc={"==":tm,"!=":rm,">":gf,"<":mf,">=":Yd,"<=":Mo,array:Io,at:_a,boolean:Io,case:pf,coalesce:fh,collator:hl,format:Na,image:dh,in:ff,"index-of":df,interpolate:Ys,"interpolate-hcl":Ys,"interpolate-lab":Ys,length:za,let:vi,literal:Yl,match:qd,number:Io,"number-format":_f,object:Io,slice:Af,step:hh,string:Io,"to-boolean":ka,"to-color":ka,"to-number":ka,"to-string":ka,var:uh,within:Kl,distance:tc};class yi{constructor(l,d,g,w){this.name=l,this.type=d,this._evaluate=g,this.args=w}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,d){let g=l[0],w=yi.definitions[g];if(!w)return d.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);let I=Array.isArray(w)?w[0]:w.type,P=Array.isArray(w)?[[w[1],w[2]]]:w.overloads,D=P.filter(([G])=>!Array.isArray(G)||G.length===l.length-1),U=null;for(let[G,$]of D){U=new ch(d.registry,Ef,d.path,null,d.scope);let K=[],se=!1;for(let ce=1;ce<l.length;ce++){let he=l[ce],me=Array.isArray(G)?G[ce-1]:G.type,Ee=U.parse(he,1+K.length,me);if(!Ee){se=!0;break}K.push(Ee)}if(!se)if(Array.isArray(G)&&G.length!==K.length)U.error(`Expected ${G.length} arguments, but found ${K.length} instead.`);else{for(let ce=0;ce<K.length;ce++){let he=Array.isArray(G)?G[ce]:G.type,me=K[ce];U.concat(ce+1).checkSubtype(he,me.type)}if(U.errors.length===0)return new yi(g,I,$,K)}}if(D.length===1)d.errors.push(...U.errors);else{let G=(D.length?D:P).map(([K])=>{return se=K,Array.isArray(se)?`(${se.map(ii).join(", ")})`:`(${ii(se.type)}...)`;var se}).join(" | "),$=[];for(let K=1;K<l.length;K++){let se=d.parse(l[K],1+$.length);if(!se)return null;$.push(ii(se.type))}d.error(`Expected arguments of type ${G}, but found (${$.join(", ")}) instead.`)}return null}static register(l,d){yi.definitions=d;for(let g in d)l[g]=yi}}function Tf(f,[l,d,g,w]){l=l.evaluate(f),d=d.evaluate(f),g=g.evaluate(f);let I=w?w.evaluate(f):1,P=Fg(l,d,g,I);if(P)throw new bn(P);return new Ei(l/255,d/255,g/255,I,!1)}function tp(f,l){return f in l}function rp(f,l){let d=l[f];return d===void 0?null:d}function rc(f){return{type:f}}function Ef(f){if(f instanceof uh)return Ef(f.boundExpression);if(f instanceof yi&&f.name==="error"||f instanceof hl||f instanceof Kl||f instanceof tc)return!1;let l=f instanceof ka||f instanceof Io,d=!0;return f.eachChild(g=>{d=l?d&&Ef(g):d&&g instanceof Yl}),!!d&&Ah(f)&&eu(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ah(f){if(f instanceof yi&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof Kl||f instanceof tc)return!1;let l=!0;return f.eachChild(d=>{l&&!Ah(d)&&(l=!1)}),l}function ic(f){if(f instanceof yi&&f.name==="feature-state")return!1;let l=!0;return f.eachChild(d=>{l&&!ic(d)&&(l=!1)}),l}function eu(f,l){if(f instanceof yi&&l.indexOf(f.name)>=0)return!1;let d=!0;return f.eachChild(g=>{d&&!eu(g,l)&&(d=!1)}),d}function um(f){return{result:"success",value:f}}function tu(f){return{result:"error",value:f}}function nc(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function ip(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function Cf(f){return!!f.expression&&f.expression.interpolated}function Si(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function Sf(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function np(f){return f}function xs(f,l){let d=l.type==="color",g=f.stops&&typeof f.stops[0][0]=="object",w=g||!(g||f.property!==void 0),I=f.type||(Cf(l)?"exponential":"interval");if(d||l.type==="padding"){let $=d?Ei.parse:Ds.parse;(f=Fr({},f)).stops&&(f.stops=f.stops.map(K=>[K[0],$(K[1])])),f.default=$(f.default?f.default:l.default)}if(f.colorSpace&&(P=f.colorSpace)!=="rgb"&&P!=="hcl"&&P!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var P;let D,U,G;if(I==="exponential")D=sp;else if(I==="interval")D=If;else if(I==="categorical"){D=Ks,U=Object.create(null);for(let $ of f.stops)U[$[0]]=$[1];G=typeof f.stops[0][0]}else{if(I!=="identity")throw new Error(`Unknown function type "${I}"`);D=Mf}if(g){let $={},K=[];for(let he=0;he<f.stops.length;he++){let me=f.stops[he],Ee=me[0].zoom;$[Ee]===void 0&&($[Ee]={zoom:Ee,type:f.type,property:f.property,default:f.default,stops:[]},K.push(Ee)),$[Ee].stops.push([me[0].value,me[1]])}let se=[];for(let he of K)se.push([$[he].zoom,xs($[he],l)]);let ce={name:"linear"};return{kind:"composite",interpolationType:ce,interpolationFactor:Ys.interpolationFactor.bind(void 0,ce),zoomStops:se.map(he=>he[0]),evaluate:({zoom:he},me)=>sp({stops:se,base:f.base},l,he).evaluate(he,me)}}if(w){let $=I==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:$,interpolationFactor:Ys.interpolationFactor.bind(void 0,$),zoomStops:f.stops.map(K=>K[0]),evaluate:({zoom:K})=>D(f,l,K,U,G)}}return{kind:"source",evaluate($,K){let se=K&&K.properties?K.properties[f.property]:void 0;return se===void 0?ea(f.default,l.default):D(f,l,se,U,G)}}}function ea(f,l,d){return f!==void 0?f:l!==void 0?l:d!==void 0?d:void 0}function Ks(f,l,d,g,w){return ea(typeof d===w?g[d]:void 0,f.default,l.default)}function If(f,l,d){if(Si(d)!=="number")return ea(f.default,l.default);let g=f.stops.length;if(g===1||d<=f.stops[0][0])return f.stops[0][1];if(d>=f.stops[g-1][0])return f.stops[g-1][1];let w=Zd(f.stops.map(I=>I[0]),d);return f.stops[w][1]}function sp(f,l,d){let g=f.base!==void 0?f.base:1;if(Si(d)!=="number")return ea(f.default,l.default);let w=f.stops.length;if(w===1||d<=f.stops[0][0])return f.stops[0][1];if(d>=f.stops[w-1][0])return f.stops[w-1][1];let I=Zd(f.stops.map($=>$[0]),d),P=function($,K,se,ce){let he=ce-se,me=$-se;return he===0?0:K===1?me/he:(Math.pow(K,me)-1)/(Math.pow(K,he)-1)}(d,g,f.stops[I][0],f.stops[I+1][0]),D=f.stops[I][1],U=f.stops[I+1][1],G=ya[l.type]||np;return typeof D.evaluate=="function"?{evaluate(...$){let K=D.evaluate.apply(void 0,$),se=U.evaluate.apply(void 0,$);if(K!==void 0&&se!==void 0)return G(K,se,P,f.colorSpace)}}:G(D,U,P,f.colorSpace)}function Mf(f,l,d){switch(l.type){case"color":d=Ei.parse(d);break;case"formatted":d=co.fromString(d.toString());break;case"resolvedImage":d=So.fromString(d.toString());break;case"padding":d=Ds.parse(d);break;default:Si(d)===l.type||l.type==="enum"&&l.values[d]||(d=void 0)}return ea(d,f.default,l.default)}yi.register(Jc,{error:[{kind:"error"},[pr],(f,[l])=>{throw new bn(l.evaluate(f))}],typeof:[pr,[Br],(f,[l])=>ii(vn(l.evaluate(f)))],"to-rgba":[Kr(Gt,4),[Vr],(f,[l])=>{let[d,g,w,I]=l.evaluate(f).rgb;return[255*d,255*g,255*w,I]}],rgb:[Vr,[Gt,Gt,Gt],Tf],rgba:[Vr,[Gt,Gt,Gt,Gt],Tf],has:{type:tr,overloads:[[[pr],(f,[l])=>tp(l.evaluate(f),f.properties())],[[pr,ma],(f,[l,d])=>tp(l.evaluate(f),d.evaluate(f))]]},get:{type:Br,overloads:[[[pr],(f,[l])=>rp(l.evaluate(f),f.properties())],[[pr,ma],(f,[l,d])=>rp(l.evaluate(f),d.evaluate(f))]]},"feature-state":[Br,[pr],(f,[l])=>rp(l.evaluate(f),f.featureState||{})],properties:[ma,[],f=>f.properties()],"geometry-type":[pr,[],f=>f.geometryType()],id:[Br,[],f=>f.id()],zoom:[Gt,[],f=>f.globals.zoom],"heatmap-density":[Gt,[],f=>f.globals.heatmapDensity||0],"line-progress":[Gt,[],f=>f.globals.lineProgress||0],accumulated:[Br,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[Gt,rc(Gt),(f,l)=>{let d=0;for(let g of l)d+=g.evaluate(f);return d}],"*":[Gt,rc(Gt),(f,l)=>{let d=1;for(let g of l)d*=g.evaluate(f);return d}],"-":{type:Gt,overloads:[[[Gt,Gt],(f,[l,d])=>l.evaluate(f)-d.evaluate(f)],[[Gt],(f,[l])=>-l.evaluate(f)]]},"/":[Gt,[Gt,Gt],(f,[l,d])=>l.evaluate(f)/d.evaluate(f)],"%":[Gt,[Gt,Gt],(f,[l,d])=>l.evaluate(f)%d.evaluate(f)],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(f,[l,d])=>Math.pow(l.evaluate(f),d.evaluate(f))],sqrt:[Gt,[Gt],(f,[l])=>Math.sqrt(l.evaluate(f))],log10:[Gt,[Gt],(f,[l])=>Math.log(l.evaluate(f))/Math.LN10],ln:[Gt,[Gt],(f,[l])=>Math.log(l.evaluate(f))],log2:[Gt,[Gt],(f,[l])=>Math.log(l.evaluate(f))/Math.LN2],sin:[Gt,[Gt],(f,[l])=>Math.sin(l.evaluate(f))],cos:[Gt,[Gt],(f,[l])=>Math.cos(l.evaluate(f))],tan:[Gt,[Gt],(f,[l])=>Math.tan(l.evaluate(f))],asin:[Gt,[Gt],(f,[l])=>Math.asin(l.evaluate(f))],acos:[Gt,[Gt],(f,[l])=>Math.acos(l.evaluate(f))],atan:[Gt,[Gt],(f,[l])=>Math.atan(l.evaluate(f))],min:[Gt,rc(Gt),(f,l)=>Math.min(...l.map(d=>d.evaluate(f)))],max:[Gt,rc(Gt),(f,l)=>Math.max(...l.map(d=>d.evaluate(f)))],abs:[Gt,[Gt],(f,[l])=>Math.abs(l.evaluate(f))],round:[Gt,[Gt],(f,[l])=>{let d=l.evaluate(f);return d<0?-Math.round(-d):Math.round(d)}],floor:[Gt,[Gt],(f,[l])=>Math.floor(l.evaluate(f))],ceil:[Gt,[Gt],(f,[l])=>Math.ceil(l.evaluate(f))],"filter-==":[tr,[pr,Br],(f,[l,d])=>f.properties()[l.value]===d.value],"filter-id-==":[tr,[Br],(f,[l])=>f.id()===l.value],"filter-type-==":[tr,[pr],(f,[l])=>f.geometryType()===l.value],"filter-<":[tr,[pr,Br],(f,[l,d])=>{let g=f.properties()[l.value],w=d.value;return typeof g==typeof w&&g<w}],"filter-id-<":[tr,[Br],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d<g}],"filter->":[tr,[pr,Br],(f,[l,d])=>{let g=f.properties()[l.value],w=d.value;return typeof g==typeof w&&g>w}],"filter-id->":[tr,[Br],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d>g}],"filter-<=":[tr,[pr,Br],(f,[l,d])=>{let g=f.properties()[l.value],w=d.value;return typeof g==typeof w&&g<=w}],"filter-id-<=":[tr,[Br],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d<=g}],"filter->=":[tr,[pr,Br],(f,[l,d])=>{let g=f.properties()[l.value],w=d.value;return typeof g==typeof w&&g>=w}],"filter-id->=":[tr,[Br],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d>=g}],"filter-has":[tr,[Br],(f,[l])=>l.value in f.properties()],"filter-has-id":[tr,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[tr,[Kr(pr)],(f,[l])=>l.value.indexOf(f.geometryType())>=0],"filter-id-in":[tr,[Kr(Br)],(f,[l])=>l.value.indexOf(f.id())>=0],"filter-in-small":[tr,[pr,Kr(Br)],(f,[l,d])=>d.value.indexOf(f.properties()[l.value])>=0],"filter-in-large":[tr,[pr,Kr(Br)],(f,[l,d])=>function(g,w,I,P){for(;I<=P;){let D=I+P>>1;if(w[D]===g)return!0;w[D]>g?P=D-1:I=D+1}return!1}(f.properties()[l.value],d.value,0,d.value.length-1)],all:{type:tr,overloads:[[[tr,tr],(f,[l,d])=>l.evaluate(f)&&d.evaluate(f)],[rc(tr),(f,l)=>{for(let d of l)if(!d.evaluate(f))return!1;return!0}]]},any:{type:tr,overloads:[[[tr,tr],(f,[l,d])=>l.evaluate(f)||d.evaluate(f)],[rc(tr),(f,l)=>{for(let d of l)if(d.evaluate(f))return!0;return!1}]]},"!":[tr,[tr],(f,[l])=>!l.evaluate(f)],"is-supported-script":[tr,[pr],(f,[l])=>{let d=f.globals&&f.globals.isSupportedScript;return!d||d(l.evaluate(f))}],upcase:[pr,[pr],(f,[l])=>l.evaluate(f).toUpperCase()],downcase:[pr,[pr],(f,[l])=>l.evaluate(f).toLowerCase()],concat:[pr,rc(Br),(f,l)=>l.map(d=>lh(d.evaluate(f))).join("")],"resolved-locale":[pr,[Kn],(f,[l])=>l.evaluate(f).resolvedLocale()]});class ru{constructor(l,d){var g;this.expression=l,this._warningHistory={},this._evaluator=new ti,this._defaultValue=d?(g=d).type==="color"&&Sf(g.default)?new Ei(0,0,0,0):g.type==="color"?Ei.parse(g.default)||null:g.type==="padding"?Ds.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?uo.parse(g.default)||null:g.type==="projectionDefinition"?hs.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(l,d,g,w,I,P){return this._evaluator.globals=l,this._evaluator.feature=d,this._evaluator.featureState=g,this._evaluator.canonical=w,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=P,this.expression.evaluate(this._evaluator)}evaluate(l,d,g,w,I,P){this._evaluator.globals=l,this._evaluator.feature=d||null,this._evaluator.featureState=g||null,this._evaluator.canonical=w,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=P||null;try{let D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new bn(`Expected value to be one of ${Object.keys(this._enumValues).map(U=>JSON.stringify(U)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function mh(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in Jc}function Pf(f,l){let d=new ch(Jc,Ef,[],l?function(w){let I={color:Vr,string:pr,number:Gt,enum:pr,boolean:tr,formatted:rn,padding:nh,projectionDefinition:xn,resolvedImage:Wl,variableAnchorOffsetCollection:Ct};return w.type==="array"?Kr(I[w.value]||Br,w.length):I[w.type]}(l):void 0),g=d.parse(f,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?um(new ru(g,l)):tu(d.errors)}class Rf{constructor(l,d){this.kind=l,this._styleExpression=d,this.isStateDependent=l!=="constant"&&!ic(d.expression)}evaluateWithoutErrorHandling(l,d,g,w,I,P){return this._styleExpression.evaluateWithoutErrorHandling(l,d,g,w,I,P)}evaluate(l,d,g,w,I,P){return this._styleExpression.evaluate(l,d,g,w,I,P)}}class iu{constructor(l,d,g,w){this.kind=l,this.zoomStops=g,this._styleExpression=d,this.isStateDependent=l!=="camera"&&!ic(d.expression),this.interpolationType=w}evaluateWithoutErrorHandling(l,d,g,w,I,P){return this._styleExpression.evaluateWithoutErrorHandling(l,d,g,w,I,P)}evaluate(l,d,g,w,I,P){return this._styleExpression.evaluate(l,d,g,w,I,P)}interpolationFactor(l,d,g){return this.interpolationType?Ys.interpolationFactor(this.interpolationType,l,d,g):0}}function fl(f,l){let d=Pf(f,l);if(d.result==="error")return d;let g=d.value.expression,w=Ah(g);if(!w&&!nc(l))return tu([new Sr("","data expressions not supported")]);let I=eu(g,["zoom"]);if(!I&&!ip(l))return tu([new Sr("","zoom expressions not supported")]);let P=nu(g);return P||I?P instanceof Sr?tu([P]):P instanceof Ys&&!Cf(l)?tu([new Sr("",'"interpolate" expressions cannot be used with this property')]):um(P?new iu(w?"camera":"composite",d.value,P.labels,P instanceof Ys?P.interpolation:void 0):new Rf(w?"constant":"source",d.value)):tu([new Sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class gh{constructor(l,d){this._parameters=l,this._specification=d,Fr(this,xs(this._parameters,this._specification))}static deserialize(l){return new gh(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function nu(f){let l=null;if(f instanceof vi)l=nu(f.result);else if(f instanceof fh){for(let d of f.args)if(l=nu(d),l)break}else(f instanceof hh||f instanceof Ys)&&f.input instanceof yi&&f.input.name==="zoom"&&(l=f);return l instanceof Sr||f.eachChild(d=>{let g=nu(d);g instanceof Sr?l=g:!l&&g?l=new Sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&g&&l!==g&&(l=new Sr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function sc(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(let l of f.slice(1))if(!sc(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}let oc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ta(f){if(f==null)return{filter:()=>!0,needGeometry:!1};sc(f)||(f=ac(f));let l=Pf(f,oc);if(l.result==="error")throw new Error(l.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,g,w)=>l.value.evaluate(d,g,{},w),needGeometry:Bf(f)}}function op(f,l){return f<l?-1:f>l?1:0}function Bf(f){if(!Array.isArray(f))return!1;if(f[0]==="within"||f[0]==="distance")return!0;for(let l=1;l<f.length;l++)if(Bf(f[l]))return!0;return!1}function ac(f){if(!f)return!0;let l=f[0];return f.length<=1?l!=="any":l==="=="?Lf(f[1],f[2],"=="):l==="!="?su(Lf(f[1],f[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Lf(f[1],f[2],l):l==="any"?(d=f.slice(1),["any"].concat(d.map(ac))):l==="all"?["all"].concat(f.slice(1).map(ac)):l==="none"?["all"].concat(f.slice(1).map(ac).map(su)):l==="in"?Of(f[1],f.slice(2)):l==="!in"?su(Of(f[1],f.slice(2))):l==="has"?_h(f[1]):l!=="!has"||su(_h(f[1]));var d}function Lf(f,l,d){switch(f){case"$type":return[`filter-type-${d}`,l];case"$id":return[`filter-id-${d}`,l];default:return[`filter-${d}`,f,l]}}function Of(f,l){if(l.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(d=>typeof d!=typeof l[0])?["filter-in-large",f,["literal",l.sort(op)]]:["filter-in-small",f,["literal",l]]}}function _h(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function su(f){return["!",f]}function ou(f){let l=typeof f;if(l==="number"||l==="boolean"||l==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let w="[";for(let I of f)w+=`${ou(I)},`;return`${w}]`}let d=Object.keys(f).sort(),g="{";for(let w=0;w<d.length;w++)g+=`${JSON.stringify(d[w])}:${ou(f[d[w]])},`;return`${g}}`}function Vg(f){let l="";for(let d of Ve)l+=`/${ou(f[d])}`;return l}function hm(f){let l=f.value;return l?[new $e(f.key,l,"constants have been deprecated as of v8")]:[]}function Un(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function lc(f){if(Array.isArray(f))return f.map(lc);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){let l={};for(let d in f)l[d]=lc(f[d]);return l}return Un(f)}function zo(f){let l=f.key,d=f.value,g=f.valueSpec||{},w=f.objectElementValidators||{},I=f.style,P=f.styleSpec,D=f.validateSpec,U=[],G=Si(d);if(G!=="object")return[new $e(l,d,`object expected, ${G} found`)];for(let $ in d){let K=$.split(".")[0],se=g[K]||g["*"],ce;if(w[K])ce=w[K];else if(g[K])ce=D;else if(w["*"])ce=w["*"];else{if(!g["*"]){U.push(new $e(l,d[$],`unknown property "${$}"`));continue}ce=D}U=U.concat(ce({key:(l&&`${l}.`)+$,value:d[$],valueSpec:se,style:I,styleSpec:P,object:d,objectKey:$,validateSpec:D},d))}for(let $ in g)w[$]||g[$].required&&g[$].default===void 0&&d[$]===void 0&&U.push(new $e(l,d,`missing required property "${$}"`));return U}function ap(f){let l=f.value,d=f.valueSpec,g=f.style,w=f.styleSpec,I=f.key,P=f.arrayElementValidator||f.validateSpec;if(Si(l)!=="array")return[new $e(I,l,`array expected, ${Si(l)} found`)];if(d.length&&l.length!==d.length)return[new $e(I,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new $e(I,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let D={type:d.value,values:d.values};w.$version<7&&(D.function=d.function),Si(d.value)==="object"&&(D=d.value);let U=[];for(let G=0;G<l.length;G++)U=U.concat(P({array:l,arrayIndex:G,value:l[G],valueSpec:D,validateSpec:f.validateSpec,style:g,styleSpec:w,key:`${I}[${G}]`}));return U}function cc(f){let l=f.key,d=f.value,g=f.valueSpec,w=Si(d);return w==="number"&&d!=d&&(w="NaN"),w!=="number"?[new $e(l,d,`number expected, ${w} found`)]:"minimum"in g&&d<g.minimum?[new $e(l,d,`${d} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&d>g.maximum?[new $e(l,d,`${d} is greater than the maximum value ${g.maximum}`)]:[]}function lp(f){let l=f.valueSpec,d=Un(f.value.type),g,w,I,P={},D=d!=="categorical"&&f.value.property===void 0,U=!D,G=Si(f.value.stops)==="array"&&Si(f.value.stops[0])==="array"&&Si(f.value.stops[0][0])==="object",$=zo({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(ce){if(d==="identity")return[new $e(ce.key,ce.value,'identity function may not have a "stops" property')];let he=[],me=ce.value;return he=he.concat(ap({key:ce.key,value:me,valueSpec:ce.valueSpec,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec,arrayElementValidator:K})),Si(me)==="array"&&me.length===0&&he.push(new $e(ce.key,me,"array must have at least one stop")),he},default:function(ce){return ce.validateSpec({key:ce.key,value:ce.value,valueSpec:l,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec})}}});return d==="identity"&&D&&$.push(new $e(f.key,f.value,'missing required property "property"')),d==="identity"||f.value.stops||$.push(new $e(f.key,f.value,'missing required property "stops"')),d==="exponential"&&f.valueSpec.expression&&!Cf(f.valueSpec)&&$.push(new $e(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(U&&!nc(f.valueSpec)?$.push(new $e(f.key,f.value,"property functions not supported")):D&&!ip(f.valueSpec)&&$.push(new $e(f.key,f.value,"zoom functions not supported"))),d!=="categorical"&&!G||f.value.property!==void 0||$.push(new $e(f.key,f.value,'"property" property is required')),$;function K(ce){let he=[],me=ce.value,Ee=ce.key;if(Si(me)!=="array")return[new $e(Ee,me,`array expected, ${Si(me)} found`)];if(me.length!==2)return[new $e(Ee,me,`array length 2 expected, length ${me.length} found`)];if(G){if(Si(me[0])!=="object")return[new $e(Ee,me,`object expected, ${Si(me[0])} found`)];if(me[0].zoom===void 0)return[new $e(Ee,me,"object stop key must have zoom")];if(me[0].value===void 0)return[new $e(Ee,me,"object stop key must have value")];if(I&&I>Un(me[0].zoom))return[new $e(Ee,me[0].zoom,"stop zoom values must appear in ascending order")];Un(me[0].zoom)!==I&&(I=Un(me[0].zoom),w=void 0,P={}),he=he.concat(zo({key:`${Ee}[0]`,value:me[0],valueSpec:{zoom:{}},validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec,objectElementValidators:{zoom:cc,value:se}}))}else he=he.concat(se({key:`${Ee}[0]`,value:me[0],validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec},me));return mh(lc(me[1]))?he.concat([new $e(`${Ee}[1]`,me[1],"expressions are not allowed in function stops.")]):he.concat(ce.validateSpec({key:`${Ee}[1]`,value:me[1],valueSpec:l,validateSpec:ce.validateSpec,style:ce.style,styleSpec:ce.styleSpec}))}function se(ce,he){let me=Si(ce.value),Ee=Un(ce.value),Oe=ce.value!==null?ce.value:he;if(g){if(me!==g)return[new $e(ce.key,Oe,`${me} stop domain type must match previous stop domain type ${g}`)]}else g=me;if(me!=="number"&&me!=="string"&&me!=="boolean")return[new $e(ce.key,Oe,"stop domain value must be a number, string, or boolean")];if(me!=="number"&&d!=="categorical"){let et=`number expected, ${me} found`;return nc(l)&&d===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(ce.key,Oe,et)]}return d!=="categorical"||me!=="number"||isFinite(Ee)&&Math.floor(Ee)===Ee?d!=="categorical"&&me==="number"&&w!==void 0&&Ee<w?[new $e(ce.key,Oe,"stop domain values must appear in ascending order")]:(w=Ee,d==="categorical"&&Ee in P?[new $e(ce.key,Oe,"stop domain values must be unique")]:(P[Ee]=!0,[])):[new $e(ce.key,Oe,`integer expected, found ${Ee}`)]}}function Ua(f){let l=(f.expressionContext==="property"?fl:Pf)(lc(f.value),f.valueSpec);if(l.result==="error")return l.value.map(g=>new $e(`${f.key}${g.key}`,f.value,g.message));let d=l.value.expression||l.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!d.outputDefined())return[new $e(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!ic(d))return[new $e(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!ic(d))return[new $e(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!eu(d,["zoom","feature-state"]))return[new $e(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!Ah(d))return[new $e(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yh(f){let l=f.key,d=f.value,g=f.valueSpec,w=[];return Array.isArray(g.values)?g.values.indexOf(Un(d))===-1&&w.push(new $e(l,d,`expected one of [${g.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(g.values).indexOf(Un(d))===-1&&w.push(new $e(l,d,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(d)} found`)),w}function dl(f){return sc(lc(f.value))?Ua(Fr({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):cp(f)}function cp(f){let l=f.value,d=f.key;if(Si(l)!=="array")return[new $e(d,l,`array expected, ${Si(l)} found`)];let g=f.styleSpec,w,I=[];if(l.length<1)return[new $e(d,l,"filter array must have at least 1 element")];switch(I=I.concat(yh({key:`${d}[0]`,value:l[0],valueSpec:g.filter_operator,style:f.style,styleSpec:f.styleSpec})),Un(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Un(l[1])==="$type"&&I.push(new $e(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&I.push(new $e(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(w=Si(l[1]),w!=="string"&&I.push(new $e(`${d}[1]`,l[1],`string expected, ${w} found`)));for(let P=2;P<l.length;P++)w=Si(l[P]),Un(l[1])==="$type"?I=I.concat(yh({key:`${d}[${P}]`,value:l[P],valueSpec:g.geometry_type,style:f.style,styleSpec:f.styleSpec})):w!=="string"&&w!=="number"&&w!=="boolean"&&I.push(new $e(`${d}[${P}]`,l[P],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let P=1;P<l.length;P++)I=I.concat(cp({key:`${d}[${P}]`,value:l[P],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":w=Si(l[1]),l.length!==2?I.push(new $e(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):w!=="string"&&I.push(new $e(`${d}[1]`,l[1],`string expected, ${w} found`))}return I}function Df(f,l){let d=f.key,g=f.validateSpec,w=f.style,I=f.styleSpec,P=f.value,D=f.objectKey,U=I[`${l}_${f.layerType}`];if(!U)return[];let G=D.match(/^(.*)-transition$/);if(l==="paint"&&G&&U[G[1]]&&U[G[1]].transition)return g({key:d,value:P,valueSpec:I.transition,style:w,styleSpec:I});let $=f.valueSpec||U[D];if(!$)return[new $e(d,P,`unknown property "${D}"`)];let K;if(Si(P)==="string"&&nc($)&&!$.tokens&&(K=/^{([^}]+)}$/.exec(P)))return[new $e(d,P,`"${D}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];let se=[];return f.layerType==="symbol"&&(D==="text-field"&&w&&!w.glyphs&&se.push(new $e(d,P,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&Sf(lc(P))&&Un(P.type)==="identity"&&se.push(new $e(d,P,'"text-font" does not support identity functions'))),se.concat(g({key:f.key,value:P,valueSpec:$,style:w,styleSpec:I,expressionContext:"property",propertyType:l,propertyKey:D}))}function Ff(f){return Df(f,"paint")}function pl(f){return Df(f,"layout")}function au(f){let l=[],d=f.value,g=f.key,w=f.style,I=f.styleSpec;d.type||d.ref||l.push(new $e(g,d,'either "type" or "ref" is required'));let P=Un(d.type),D=Un(d.ref);if(d.id){let U=Un(d.id);for(let G=0;G<f.arrayIndex;G++){let $=w.layers[G];Un($.id)===U&&l.push(new $e(g,d.id,`duplicate layer id "${d.id}", previously used at line ${$.id.__line__}`))}}if("ref"in d){let U;["type","source","source-layer","filter","layout"].forEach(G=>{G in d&&l.push(new $e(g,d[G],`"${G}" is prohibited for ref layers`))}),w.layers.forEach(G=>{Un(G.id)===D&&(U=G)}),U?U.ref?l.push(new $e(g,d.ref,"ref cannot reference another ref layer")):P=Un(U.type):l.push(new $e(g,d.ref,`ref layer "${D}" not found`))}else if(P!=="background")if(d.source){let U=w.sources&&w.sources[d.source],G=U&&Un(U.type);U?G==="vector"&&P==="raster"?l.push(new $e(g,d.source,`layer "${d.id}" requires a raster source`)):G!=="raster-dem"&&P==="hillshade"?l.push(new $e(g,d.source,`layer "${d.id}" requires a raster-dem source`)):G==="raster"&&P!=="raster"?l.push(new $e(g,d.source,`layer "${d.id}" requires a vector source`)):G!=="vector"||d["source-layer"]?G==="raster-dem"&&P!=="hillshade"?l.push(new $e(g,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!d.paint||!d.paint["line-gradient"]||G==="geojson"&&U.lineMetrics||l.push(new $e(g,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new $e(g,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new $e(g,d.source,`source "${d.source}" not found`))}else l.push(new $e(g,d,'missing required property "source"'));return l=l.concat(zo({key:g,value:d,valueSpec:I.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${g}.type`,value:d.type,valueSpec:I.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:d,objectKey:"type"}),filter:dl,layout:U=>zo({layer:d,key:U.key,value:U.value,style:U.style,styleSpec:U.styleSpec,validateSpec:U.validateSpec,objectElementValidators:{"*":G=>pl(Fr({layerType:P},G))}}),paint:U=>zo({layer:d,key:U.key,value:U.value,style:U.style,styleSpec:U.styleSpec,validateSpec:U.validateSpec,objectElementValidators:{"*":G=>Ff(Fr({layerType:P},G))}})}})),l}function Va(f){let l=f.value,d=f.key,g=Si(l);return g!=="string"?[new $e(d,l,`string expected, ${g} found`)]:[]}let up={promoteId:function({key:f,value:l}){if(Si(l)==="string")return Va({key:f,value:l});{let d=[];for(let g in l)d.push(...Va({key:`${f}.${g}`,value:l[g]}));return d}}};function fm(f){let l=f.value,d=f.key,g=f.styleSpec,w=f.style,I=f.validateSpec;if(!l.type)return[new $e(d,l,'"type" is required')];let P=Un(l.type),D;switch(P){case"vector":case"raster":return D=zo({key:d,value:l,valueSpec:g[`source_${P.replace("-","_")}`],style:f.style,styleSpec:g,objectElementValidators:up,validateSpec:I}),D;case"raster-dem":return D=function(U){var G;let $=(G=U.sourceName)!==null&&G!==void 0?G:"",K=U.value,se=U.styleSpec,ce=se.source_raster_dem,he=U.style,me=[],Ee=Si(K);if(K===void 0)return me;if(Ee!=="object")return me.push(new $e("source_raster_dem",K,`object expected, ${Ee} found`)),me;let Oe=Un(K.encoding)==="custom",et=["redFactor","greenFactor","blueFactor","baseShift"],Ue=U.value.encoding?`"${U.value.encoding}"`:"Default";for(let le in K)!Oe&&et.includes(le)?me.push(new $e(le,K[le],`In "${$}": "${le}" is only valid when "encoding" is set to "custom". ${Ue} encoding found`)):ce[le]?me=me.concat(U.validateSpec({key:le,value:K[le],valueSpec:ce[le],validateSpec:U.validateSpec,style:he,styleSpec:se})):me.push(new $e(le,K[le],`unknown property "${le}"`));return me}({sourceName:d,value:l,style:f.style,styleSpec:g,validateSpec:I}),D;case"geojson":if(D=zo({key:d,value:l,valueSpec:g.source_geojson,style:w,styleSpec:g,validateSpec:I,objectElementValidators:up}),l.cluster)for(let U in l.clusterProperties){let[G,$]=l.clusterProperties[U],K=typeof G=="string"?[G,["accumulated"],["get",U]]:G;D.push(...Ua({key:`${d}.${U}.map`,value:$,expressionContext:"cluster-map"})),D.push(...Ua({key:`${d}.${U}.reduce`,value:K,expressionContext:"cluster-reduce"}))}return D;case"video":return zo({key:d,value:l,valueSpec:g.source_video,style:w,validateSpec:I,styleSpec:g});case"image":return zo({key:d,value:l,valueSpec:g.source_image,style:w,validateSpec:I,styleSpec:g});case"canvas":return[new $e(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yh({key:`${d}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function hp(f){let l=f.value,d=f.styleSpec,g=d.light,w=f.style,I=[],P=Si(l);if(l===void 0)return I;if(P!=="object")return I=I.concat([new $e("light",l,`object expected, ${P} found`)]),I;for(let D in l){let U=D.match(/^(.*)-transition$/);I=I.concat(U&&g[U[1]]&&g[U[1]].transition?f.validateSpec({key:D,value:l[D],valueSpec:d.transition,validateSpec:f.validateSpec,style:w,styleSpec:d}):g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],validateSpec:f.validateSpec,style:w,styleSpec:d}):[new $e(D,l[D],`unknown property "${D}"`)])}return I}function kf(f){let l=f.value,d=f.styleSpec,g=d.sky,w=f.style,I=Si(l);if(l===void 0)return[];if(I!=="object")return[new $e("sky",l,`object expected, ${I} found`)];let P=[];for(let D in l)P=P.concat(g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],style:w,styleSpec:d}):[new $e(D,l[D],`unknown property "${D}"`)]);return P}function Nf(f){let l=f.value,d=f.styleSpec,g=d.terrain,w=f.style,I=[],P=Si(l);if(l===void 0)return I;if(P!=="object")return I=I.concat([new $e("terrain",l,`object expected, ${P} found`)]),I;for(let D in l)I=I.concat(g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],validateSpec:f.validateSpec,style:w,styleSpec:d}):[new $e(D,l[D],`unknown property "${D}"`)]);return I}function ja(f){let l=[],d=f.value,g=f.key;if(Array.isArray(d)){let w=[],I=[];for(let P in d)d[P].id&&w.includes(d[P].id)&&l.push(new $e(g,d,`all the sprites' ids must be unique, but ${d[P].id} is duplicated`)),w.push(d[P].id),d[P].url&&I.includes(d[P].url)&&l.push(new $e(g,d,`all the sprites' URLs must be unique, but ${d[P].url} is duplicated`)),I.push(d[P].url),l=l.concat(zo({key:`${g}[${P}]`,value:d[P],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return l}return Va({key:g,value:d})}let Hi={"*":()=>[],array:ap,boolean:function(f){let l=f.value,d=f.key,g=Si(l);return g!=="boolean"?[new $e(d,l,`boolean expected, ${g} found`)]:[]},number:cc,color:function(f){let l=f.key,d=f.value,g=Si(d);return g!=="string"?[new $e(l,d,`color expected, ${g} found`)]:Ei.parse(String(d))?[]:[new $e(l,d,`color expected, "${d}" found`)]},constants:hm,enum:yh,filter:dl,function:lp,layer:au,object:zo,source:fm,light:hp,sky:kf,terrain:Nf,projection:function(f){let l=f.value,d=f.styleSpec,g=d.projection,w=f.style,I=Si(l);if(l===void 0)return[];if(I!=="object")return[new $e("projection",l,`object expected, ${I} found`)];let P=[];for(let D in l)P=P.concat(g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],style:w,styleSpec:d}):[new $e(D,l[D],`unknown property "${D}"`)]);return P},projectionDefinition:function(f){let l=f.key,d=f.value;d=d instanceof String?d.valueOf():d;let g=Si(d);return g!=="array"||function(w){return Array.isArray(w)&&w.length===3&&typeof w[0]=="string"&&typeof w[1]=="string"&&typeof w[2]=="number"}(d)||function(w){return!!["interpolate","step","literal"].includes(w[0])}(d)?["array","string"].includes(g)?[]:[new $e(l,d,`projection expected, invalid type "${g}" found`)]:[new $e(l,d,`projection expected, invalid array ${JSON.stringify(d)} found`)]},string:Va,formatted:function(f){return Va(f).length===0?[]:Ua(f)},resolvedImage:function(f){return Va(f).length===0?[]:Ua(f)},padding:function(f){let l=f.key,d=f.value;if(Si(d)==="array"){if(d.length<1||d.length>4)return[new $e(l,d,`padding requires 1 to 4 values; ${d.length} values found`)];let g={type:"number"},w=[];for(let I=0;I<d.length;I++)w=w.concat(f.validateSpec({key:`${l}[${I}]`,value:d[I],validateSpec:f.validateSpec,valueSpec:g}));return w}return cc({key:l,value:d,valueSpec:{}})},variableAnchorOffsetCollection:function(f){let l=f.key,d=f.value,g=Si(d),w=f.styleSpec;if(g!=="array"||d.length<1||d.length%2!=0)return[new $e(l,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let I=[];for(let P=0;P<d.length;P+=2)I=I.concat(yh({key:`${l}[${P}]`,value:d[P],valueSpec:w.layout_symbol["text-anchor"]})),I=I.concat(ap({key:`${l}[${P+1}]`,value:d[P+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:w}));return I},sprite:ja};function ks(f){let l=f.value,d=f.valueSpec,g=f.styleSpec;return f.validateSpec=ks,d.expression&&Sf(Un(l))?lp(f):d.expression&&mh(lc(l))?Ua(f):d.type&&Hi[d.type]?Hi[d.type](f):zo(Fr({},f,{valueSpec:d.type?g[d.type]:d}))}function lu(f){let l=f.value,d=f.key,g=Va(f);return g.length||(l.indexOf("{fontstack}")===-1&&g.push(new $e(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&g.push(new $e(d,l,'"glyphs" url must include a "{range}" token'))),g}function Uo(f,l=ue){let d=[];return d=d.concat(ks({key:"",value:f,valueSpec:l.$root,styleSpec:l,style:f,validateSpec:ks,objectElementValidators:{glyphs:lu,"*":()=>[]}})),f.constants&&(d=d.concat(hm({key:"constants",value:f.constants}))),dm(d)}function Ea(f){return function(l){return f({...l,validateSpec:ks})}}function dm(f){return[].concat(f).sort((l,d)=>l.line-d.line)}function fo(f){return function(...l){return dm(f.apply(this,l))}}Uo.source=fo(Ea(fm)),Uo.sprite=fo(Ea(ja)),Uo.glyphs=fo(Ea(lu)),Uo.light=fo(Ea(hp)),Uo.sky=fo(Ea(kf)),Uo.terrain=fo(Ea(Nf)),Uo.layer=fo(Ea(au)),Uo.filter=fo(Ea(dl)),Uo.paintProperty=fo(Ea(Ff)),Uo.layoutProperty=fo(Ea(pl));let uc=Uo,Ns=uc.light,fp=uc.sky,Ga=uc.paintProperty,jg=uc.layoutProperty;function Al(f,l){let d=!1;if(l&&l.length)for(let g of l)f.fire(new Ae(new Error(g.message))),d=!0;return d}class xh{constructor(l,d,g){let w=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;let P=new Int32Array(this.arrayBuffer);l=P[0],this.d=(d=P[1])+2*(g=P[2]);for(let U=0;U<this.d*this.d;U++){let G=P[3+U],$=P[3+U+1];w.push(G===$?null:P.subarray(G,$))}let D=P[3+w.length+1];this.keys=P.subarray(P[3+w.length],D),this.bboxes=P.subarray(D),this.insert=this._insertReadonly}else{this.d=d+2*g;for(let P=0;P<this.d*this.d;P++)w.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=l,this.padding=g,this.scale=d/l,this.uid=0;let I=g/d*l;this.min=-I,this.max=l+I}insert(l,d,g,w,I){this._forEachCell(d,g,w,I,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(w),this.bboxes.push(I)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,d,g,w,I,P){this.cells[I].push(P)}query(l,d,g,w,I){let P=this.min,D=this.max;if(l<=P&&d<=P&&D<=g&&D<=w&&!I)return Array.prototype.slice.call(this.keys);{let U=[];return this._forEachCell(l,d,g,w,this._queryCell,U,{},I),U}}_queryCell(l,d,g,w,I,P,D,U){let G=this.cells[I];if(G!==null){let $=this.keys,K=this.bboxes;for(let se=0;se<G.length;se++){let ce=G[se];if(D[ce]===void 0){let he=4*ce;(U?U(K[he+0],K[he+1],K[he+2],K[he+3]):l<=K[he+2]&&d<=K[he+3]&&g>=K[he+0]&&w>=K[he+1])?(D[ce]=!0,P.push($[ce])):D[ce]=!1}}}}_forEachCell(l,d,g,w,I,P,D,U){let G=this._convertToCellCoord(l),$=this._convertToCellCoord(d),K=this._convertToCellCoord(g),se=this._convertToCellCoord(w);for(let ce=G;ce<=K;ce++)for(let he=$;he<=se;he++){let me=this.d*he+ce;if((!U||U(this._convertFromCellCoord(ce),this._convertFromCellCoord(he),this._convertFromCellCoord(ce+1),this._convertFromCellCoord(he+1)))&&I.call(this,l,d,g,w,me,P,D,U))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let l=this.cells,d=3+this.cells.length+1+1,g=0;for(let P=0;P<this.cells.length;P++)g+=this.cells[P].length;let w=new Int32Array(d+g+this.keys.length+this.bboxes.length);w[0]=this.extent,w[1]=this.n,w[2]=this.padding;let I=d;for(let P=0;P<l.length;P++){let D=l[P];w[3+P]=I,w.set(D,I),I+=D.length}return w[3+l.length]=I,w.set(this.keys,I),I+=this.keys.length,w[3+l.length+1]=I,w.set(this.bboxes,I),I+=this.bboxes.length,w.buffer}static serialize(l,d){let g=l.toArrayBuffer();return d&&d.push(g),{buffer:g}}static deserialize(l){return new xh(l.buffer)}}let wn={};function hr(f,l,d={}){if(wn[f])throw new Error(`${f} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:f,writeable:!1}),wn[f]={klass:l,omit:d.omit||[],shallow:d.shallow||[]}}hr("Object",Object),hr("TransferableGridIndex",xh),hr("Color",Ei),hr("Error",Error),hr("AJAXError",Cr),hr("ResolvedImage",So),hr("StylePropertyFunction",gh),hr("StyleExpression",ru,{omit:["_evaluator"]}),hr("ZoomDependentExpression",iu),hr("ZoomConstantExpression",Rf),hr("CompoundExpression",yi,{omit:["_evaluate"]});for(let f in Jc)Jc[f]._classRegistryKey||hr(`Expression_${f}`,Jc[f]);function zf(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function ta(f){return f.$name||f.constructor._classRegistryKey}function cu(f){return!function(l){if(l===null||typeof l!="object")return!1;let d=ta(l);return!(!d||d==="Object")}(f)&&(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||zf(f)||tn(f)||ArrayBuffer.isView(f)||f instanceof ImageData)}function ra(f,l){if(cu(f))return(zf(f)||tn(f))&&l&&l.push(f),ArrayBuffer.isView(f)&&l&&l.push(f.buffer),f instanceof ImageData&&l&&l.push(f.data.buffer),f;if(Array.isArray(f)){let I=[];for(let P of f)I.push(ra(P,l));return I}if(typeof f!="object")throw new Error("can't serialize object of type "+typeof f);let d=ta(f);if(!d)throw new Error(`can't serialize object of unregistered class ${f.constructor.name}`);if(!wn[d])throw new Error(`${d} is not registered.`);let{klass:g}=wn[d],w=g.serialize?g.serialize(f,l):{};if(g.serialize){if(l&&w===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let I in f){if(!f.hasOwnProperty(I)||wn[d].omit.indexOf(I)>=0)continue;let P=f[I];w[I]=wn[d].shallow.indexOf(I)>=0?P:ra(P,l)}f instanceof Error&&(w.message=f.message)}if(w.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(w.$name=d),w}function ml(f){if(cu(f))return f;if(Array.isArray(f))return f.map(ml);if(typeof f!="object")throw new Error("can't deserialize object of type "+typeof f);let l=ta(f)||"Object";if(!wn[l])throw new Error(`can't deserialize unregistered class ${l}`);let{klass:d}=wn[l];if(!d)throw new Error(`can't deserialize unregistered class ${l}`);if(d.deserialize)return d.deserialize(f);let g=Object.create(d.prototype);for(let w of Object.keys(f)){if(w==="$name")continue;let I=f[w];g[w]=wn[l].shallow.indexOf(w)>=0?I:ml(I)}return g}class Uf{constructor(){this.first=!0}update(l,d){let g=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=d),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=g,!0))}}let li={"Latin-1 Supplement":f=>f>=128&&f<=255,"Hangul Jamo":f=>f>=4352&&f<=4607,Khmer:f=>f>=6016&&f<=6143,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Hiragana:f=>f>=12352&&f<=12447,Katakana:f=>f>=12448&&f<=12543,Kanbun:f=>f>=12688&&f<=12703,"CJK Strokes":f=>f>=12736&&f<=12783,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"CJK Unified Ideographs":f=>f>=19968&&f<=40959,"Hangul Syllables":f=>f>=44032&&f<=55215,"Private Use Area":f=>f>=57344&&f<=63743,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function uu(f){for(let l of f)if(gl(l.charCodeAt(0)))return!0;return!1}function pm(f){for(let l of f)if(!Am(l.charCodeAt(0)))return!1;return!0}function bh(f){let l=f.map(d=>{try{return new RegExp(`\\p{sc=${d}}`,"u").source}catch{return null}}).filter(d=>d);return new RegExp(l.join("|"),"u")}let dp=bh(["Arab","Dupl","Mong","Ougr","Syrc"]);function Am(f){return!dp.test(String.fromCodePoint(f))}let hc=bh(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function gl(f){return!(f!==746&&f!==747&&(f<4352||!(li["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||li["CJK Compatibility"](f)||li["CJK Strokes"](f)||!(!li["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||li["Enclosed CJK Letters and Months"](f)||li["Ideographic Description Characters"](f)||li.Kanbun(f)||li.Katakana(f)&&f!==12540||!(!li["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!li["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||li["Vertical Forms"](f)||li["Yijing Hexagram Symbols"](f)||/\p{sc=Cans}/u.test(String.fromCodePoint(f))||/\p{sc=Hang}/u.test(String.fromCodePoint(f))||hc.test(String.fromCodePoint(f)))))}function pp(f){return!(gl(f)||function(l){return!!(li["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||li["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||li["Letterlike Symbols"](l)||li["Number Forms"](l)||li["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||li["Control Pictures"](l)&&l!==9251||li["Optical Character Recognition"](l)||li["Enclosed Alphanumerics"](l)||li["Geometric Shapes"](l)||li["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||li["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||li["CJK Symbols and Punctuation"](l)||li.Katakana(l)||li["Private Use Area"](l)||li["CJK Compatibility Forms"](l)||li["Small Form Variants"](l)||li["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(f))}let hu=bh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ap(f){return hu.test(String.fromCodePoint(f))}function Gg(f,l){return!(!l&&Ap(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||li.Khmer(f))}function Hg(f){for(let l of f)if(Ap(l.charCodeAt(0)))return!0;return!1}let Ha=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){if(Ha.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(f,l){return s(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(f.pluginStatus!=="loading")return this.setState(f),f;let d=f.pluginURL,g=new Promise(I=>{this.loadScriptResolve=I});l(d);let w=new Promise(I=>setTimeout(()=>I(),this.TIMEOUT));if(yield Promise.race([g,w]),this.isParsed()){let I={pluginStatus:"loaded",pluginURL:d};return this.setState(I),I}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${d}`)})}};class hn{constructor(l,d){this.zoom=l,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Uf,this.transition={})}isSupportedScript(l){return function(d,g){for(let w of d)if(!Gg(w.charCodeAt(0),g))return!1;return!0}(l,Ha.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let l=this.zoom,d=l-Math.floor(l),g=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*d}}}class vh{constructor(l,d){this.property=l,this.value=d,this.expression=function(g,w){if(Sf(g))return new gh(g,w);if(mh(g)){let I=fl(g,w);if(I.result==="error")throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));return I.value}{let I=g;return w.type==="color"&&typeof g=="string"?I=Ei.parse(g):w.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?w.type==="variableAnchorOffsetCollection"&&Array.isArray(g)?I=uo.parse(g):w.type==="projectionDefinition"&&typeof g=="string"&&(I=hs.parse(g)):I=Ds.parse(g),{kind:"constant",evaluate:()=>I}}}(d===void 0?l.specification.default:d,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,d,g){return this.property.possiblyEvaluate(this,l,d,g)}}class Vf{constructor(l){this.property=l,this.value=new vh(l,void 0)}transitioned(l,d){return new mp(this.property,this.value,d,Wt({},l.transition,this.transition),l.now)}untransitioned(){return new mp(this.property,this.value,null,{},0)}}class fc{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return dr(this._values[l].value.value)}setValue(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Vf(this._values[l].property)),this._values[l].value=new vh(this._values[l].property,d===null?void 0:dr(d))}getTransition(l){return dr(this._values[l].transition)}setTransition(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Vf(this._values[l].property)),this._values[l].transition=dr(d)||void 0}serialize(){let l={};for(let d of Object.keys(this._values)){let g=this.getValue(d);g!==void 0&&(l[d]=g);let w=this.getTransition(d);w!==void 0&&(l[`${d}-transition`]=w)}return l}transitioned(l,d){let g=new fu(this._properties);for(let w of Object.keys(this._values))g._values[w]=this._values[w].transitioned(l,d._values[w]);return g}untransitioned(){let l=new fu(this._properties);for(let d of Object.keys(this._values))l._values[d]=this._values[d].untransitioned();return l}}class mp{constructor(l,d,g,w,I){this.property=l,this.value=d,this.begin=I+w.delay||0,this.end=this.begin+w.duration||0,l.specification.transition&&(w.delay||w.duration)&&(this.prior=g)}possiblyEvaluate(l,d,g){let w=l.now||0,I=this.value.possiblyEvaluate(l,d,g),P=this.prior;if(P){if(w>this.end)return this.prior=null,I;if(this.value.isDataDriven())return this.prior=null,I;if(w<this.begin)return P.possiblyEvaluate(l,d,g);{let D=(w-this.begin)/(this.end-this.begin);return this.property.interpolate(P.possiblyEvaluate(l,d,g),I,tt(D))}}return I}}class fu{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,d,g){let w=new wh(this._properties);for(let I of Object.keys(this._values))w._values[I]=this._values[I].possiblyEvaluate(l,d,g);return w}hasTransition(){for(let l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Wg{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return dr(this._values[l].value)}setValue(l,d){this._values[l]=new vh(this._values[l].property,d===null?void 0:dr(d))}serialize(){let l={};for(let d of Object.keys(this._values)){let g=this.getValue(d);g!==void 0&&(l[d]=g)}return l}possiblyEvaluate(l,d,g){let w=new wh(this._properties);for(let I of Object.keys(this._values))w._values[I]=this._values[I].possiblyEvaluate(l,d,g);return w}}class Ca{constructor(l,d,g){this.property=l,this.value=d,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,d,g,w){return this.property.evaluate(this.value,this.parameters,l,d,g,w)}}class wh{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class br{constructor(l){this.specification=l}possiblyEvaluate(l,d){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(d)}interpolate(l,d,g){let w=ya[this.specification.type];return w?w(l,d,g):l}}class Lr{constructor(l,d){this.specification=l,this.overrides=d}possiblyEvaluate(l,d,g,w){return new Ca(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(d,null,{},g,w)}:l.expression,d)}interpolate(l,d,g){if(l.value.kind!=="constant"||d.value.kind!=="constant")return l;if(l.value.value===void 0||d.value.value===void 0)return new Ca(this,{kind:"constant",value:void 0},l.parameters);let w=ya[this.specification.type];if(w){let I=w(l.value.value,d.value.value,g);return new Ca(this,{kind:"constant",value:I},l.parameters)}return l}evaluate(l,d,g,w,I,P){return l.kind==="constant"?l.value:l.evaluate(d,g,w,I,P)}}class jf extends Lr{possiblyEvaluate(l,d,g,w){if(l.value===void 0)return new Ca(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){let I=l.expression.evaluate(d,null,{},g,w),P=l.property.specification.type==="resolvedImage"&&typeof I!="string"?I.name:I,D=this._calculate(P,P,P,d);return new Ca(this,{kind:"constant",value:D},d)}if(l.expression.kind==="camera"){let I=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new Ca(this,{kind:"constant",value:I},d)}return new Ca(this,l.expression,d)}evaluate(l,d,g,w,I,P){if(l.kind==="source"){let D=l.evaluate(d,g,w,I,P);return this._calculate(D,D,D,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},g,w),l.evaluate({zoom:Math.floor(d.zoom)},g,w),l.evaluate({zoom:Math.floor(d.zoom)+1},g,w),d):l.value}_calculate(l,d,g,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:g,to:d}}interpolate(l){return l}}class gp{constructor(l){this.specification=l}possiblyEvaluate(l,d,g,w){if(l.value!==void 0){if(l.expression.kind==="constant"){let I=l.expression.evaluate(d,null,{},g,w);return this._calculate(I,I,I,d)}return this._calculate(l.expression.evaluate(new hn(Math.floor(d.zoom-1),d)),l.expression.evaluate(new hn(Math.floor(d.zoom),d)),l.expression.evaluate(new hn(Math.floor(d.zoom+1),d)),d)}}_calculate(l,d,g,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:g,to:d}}interpolate(l){return l}}class Gf{constructor(l){this.specification=l}possiblyEvaluate(l,d,g,w){return!!l.expression.evaluate(d,null,{},g,w)}interpolate(){return!1}}class po{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let d in l){let g=l[d];g.specification.overridable&&this.overridableProperties.push(d);let w=this.defaultPropertyValues[d]=new vh(g,void 0),I=this.defaultTransitionablePropertyValues[d]=new Vf(g);this.defaultTransitioningPropertyValues[d]=I.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=w.possiblyEvaluate({})}}}hr("DataDrivenProperty",Lr),hr("DataConstantProperty",br),hr("CrossFadedDataDrivenProperty",jf),hr("CrossFadedProperty",gp),hr("ColorRampProperty",Gf);let _p="-transition";class Bn extends ye{constructor(l,d){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new Wg(d.layout)),d.paint)){this._transitionablePaint=new fc(d.paint);for(let g in l.paint)this.setPaintProperty(g,l.paint[g],{validate:!1});for(let g in l.layout)this.setLayoutProperty(g,l.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wh(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,d,g={}){d!=null&&this._validate(jg,`layers.${this.id}.layout.${l}`,l,d,g)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)}getPaintProperty(l){return l.endsWith(_p)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,d,g={}){if(d!=null&&this._validate(Ga,`layers.${this.id}.paint.${l}`,l,d,g))return!1;if(l.endsWith(_p))return this._transitionablePaint.setTransition(l.slice(0,-11),d||void 0),!1;{let w=this._transitionablePaint._values[l],I=w.property.specification["property-type"]==="cross-faded-data-driven",P=w.value.isDataDriven(),D=w.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);let U=this._transitionablePaint._values[l].value;return U.isDataDriven()||P||I||this._handleOverridablePaintPropertyUpdate(l,D,U)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,d,g){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)}serialize(){let l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Pr(l,(d,g)=>!(d===void 0||g==="layout"&&!Object.keys(d).length||g==="paint"&&!Object.keys(d).length))}_validate(l,d,g,w,I={}){return(!I||I.validate!==!1)&&Al(this,l.call(uc,{key:d,layerType:this.type,objectKey:g,value:w,styleSpec:ue,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let l in this.paint._values){let d=this.paint.get(l);if(d instanceof Ca&&nc(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}let mm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Th{constructor(l,d){this._structArray=l,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ln{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,d){return l._trim(),d&&(l.isTransferred=!0,d.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){let d=Object.create(this.prototype);return d.arrayBuffer=l.arrayBuffer,d.length=l.length,d.capacity=l.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Vn(f,l=1){let d=0,g=0;return{members:f.map(w=>{let I=mm[w.type].BYTES_PER_ELEMENT,P=d=gm(d,Math.max(l,I)),D=w.components||1;return g=Math.max(g,I),d+=I*D,{name:w.name,type:w.type,components:D,offset:P}}),size:gm(d,Math.max(g,l)),alignment:l}}function gm(f,l){return Math.ceil(f/l)*l}class Eh extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d){let g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){let w=2*l;return this.int16[w+0]=d,this.int16[w+1]=g,l}}Eh.prototype.bytesPerElement=4,hr("StructArrayLayout2i4",Eh);class bs extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=3*l;return this.int16[I+0]=d,this.int16[I+1]=g,this.int16[I+2]=w,l}}bs.prototype.bytesPerElement=6,hr("StructArrayLayout3i6",bs);class Ch extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w){let I=this.length;return this.resize(I+1),this.emplace(I,l,d,g,w)}emplace(l,d,g,w,I){let P=4*l;return this.int16[P+0]=d,this.int16[P+1]=g,this.int16[P+2]=w,this.int16[P+3]=I,l}}Ch.prototype.bytesPerElement=8,hr("StructArrayLayout4i8",Ch);class du extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,w,I,P)}emplace(l,d,g,w,I,P,D){let U=6*l;return this.int16[U+0]=d,this.int16[U+1]=g,this.int16[U+2]=w,this.int16[U+3]=I,this.int16[U+4]=P,this.int16[U+5]=D,l}}du.prototype.bytesPerElement=12,hr("StructArrayLayout2i4i12",du);class Hf extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,w,I,P)}emplace(l,d,g,w,I,P,D){let U=4*l,G=8*l;return this.int16[U+0]=d,this.int16[U+1]=g,this.uint8[G+4]=w,this.uint8[G+5]=I,this.uint8[G+6]=P,this.uint8[G+7]=D,l}}Hf.prototype.bytesPerElement=8,hr("StructArrayLayout2i4ub8",Hf);class dc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d){let g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){let w=2*l;return this.float32[w+0]=d,this.float32[w+1]=g,l}}dc.prototype.bytesPerElement=8,hr("StructArrayLayout2f8",dc);class yp extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G,$){let K=this.length;return this.resize(K+1),this.emplace(K,l,d,g,w,I,P,D,U,G,$)}emplace(l,d,g,w,I,P,D,U,G,$,K){let se=10*l;return this.uint16[se+0]=d,this.uint16[se+1]=g,this.uint16[se+2]=w,this.uint16[se+3]=I,this.uint16[se+4]=P,this.uint16[se+5]=D,this.uint16[se+6]=U,this.uint16[se+7]=G,this.uint16[se+8]=$,this.uint16[se+9]=K,l}}yp.prototype.bytesPerElement=20,hr("StructArrayLayout10ui20",yp);class pu extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G,$,K,se){let ce=this.length;return this.resize(ce+1),this.emplace(ce,l,d,g,w,I,P,D,U,G,$,K,se)}emplace(l,d,g,w,I,P,D,U,G,$,K,se,ce){let he=12*l;return this.int16[he+0]=d,this.int16[he+1]=g,this.int16[he+2]=w,this.int16[he+3]=I,this.uint16[he+4]=P,this.uint16[he+5]=D,this.uint16[he+6]=U,this.uint16[he+7]=G,this.int16[he+8]=$,this.int16[he+9]=K,this.int16[he+10]=se,this.int16[he+11]=ce,l}}pu.prototype.bytesPerElement=24,hr("StructArrayLayout4i4ui4i24",pu);class pc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=3*l;return this.float32[I+0]=d,this.float32[I+1]=g,this.float32[I+2]=w,l}}pc.prototype.bytesPerElement=12,hr("StructArrayLayout3f12",pc);class xp extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){let d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint32[1*l+0]=d,l}}xp.prototype.bytesPerElement=4,hr("StructArrayLayout1ul4",xp);class Wf extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G){let $=this.length;return this.resize($+1),this.emplace($,l,d,g,w,I,P,D,U,G)}emplace(l,d,g,w,I,P,D,U,G,$){let K=10*l,se=5*l;return this.int16[K+0]=d,this.int16[K+1]=g,this.int16[K+2]=w,this.int16[K+3]=I,this.int16[K+4]=P,this.int16[K+5]=D,this.uint32[se+3]=U,this.uint16[K+8]=G,this.uint16[K+9]=$,l}}Wf.prototype.bytesPerElement=20,hr("StructArrayLayout6i1ul2ui20",Wf);class Ac extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,w,I,P)}emplace(l,d,g,w,I,P,D){let U=6*l;return this.int16[U+0]=d,this.int16[U+1]=g,this.int16[U+2]=w,this.int16[U+3]=I,this.int16[U+4]=P,this.int16[U+5]=D,l}}Ac.prototype.bytesPerElement=12,hr("StructArrayLayout2i2i2i12",Ac);class bp extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I){let P=this.length;return this.resize(P+1),this.emplace(P,l,d,g,w,I)}emplace(l,d,g,w,I,P){let D=4*l,U=8*l;return this.float32[D+0]=d,this.float32[D+1]=g,this.float32[D+2]=w,this.int16[U+6]=I,this.int16[U+7]=P,l}}bp.prototype.bytesPerElement=16,hr("StructArrayLayout2f1f2i16",bp);class vp extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,w,I,P)}emplace(l,d,g,w,I,P,D){let U=16*l,G=4*l,$=8*l;return this.uint8[U+0]=d,this.uint8[U+1]=g,this.float32[G+1]=w,this.float32[G+2]=I,this.int16[$+6]=P,this.int16[$+7]=D,l}}vp.prototype.bytesPerElement=16,hr("StructArrayLayout2ub2f2i16",vp);class Sh extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=3*l;return this.uint16[I+0]=d,this.uint16[I+1]=g,this.uint16[I+2]=w,l}}Sh.prototype.bytesPerElement=6,hr("StructArrayLayout3ui6",Sh);class $f extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G,$,K,se,ce,he,me,Ee,Oe){let et=this.length;return this.resize(et+1),this.emplace(et,l,d,g,w,I,P,D,U,G,$,K,se,ce,he,me,Ee,Oe)}emplace(l,d,g,w,I,P,D,U,G,$,K,se,ce,he,me,Ee,Oe,et){let Ue=24*l,le=12*l,ve=48*l;return this.int16[Ue+0]=d,this.int16[Ue+1]=g,this.uint16[Ue+2]=w,this.uint16[Ue+3]=I,this.uint32[le+2]=P,this.uint32[le+3]=D,this.uint32[le+4]=U,this.uint16[Ue+10]=G,this.uint16[Ue+11]=$,this.uint16[Ue+12]=K,this.float32[le+7]=se,this.float32[le+8]=ce,this.uint8[ve+36]=he,this.uint8[ve+37]=me,this.uint8[ve+38]=Ee,this.uint32[le+10]=Oe,this.int16[Ue+22]=et,l}}$f.prototype.bytesPerElement=48,hr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$f);class C extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G,$,K,se,ce,he,me,Ee,Oe,et,Ue,le,ve,We,xt,Ht,Et,Rt,Yt,qt){let Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,l,d,g,w,I,P,D,U,G,$,K,se,ce,he,me,Ee,Oe,et,Ue,le,ve,We,xt,Ht,Et,Rt,Yt,qt)}emplace(l,d,g,w,I,P,D,U,G,$,K,se,ce,he,me,Ee,Oe,et,Ue,le,ve,We,xt,Ht,Et,Rt,Yt,qt,Qt){let Dt=32*l,mr=16*l;return this.int16[Dt+0]=d,this.int16[Dt+1]=g,this.int16[Dt+2]=w,this.int16[Dt+3]=I,this.int16[Dt+4]=P,this.int16[Dt+5]=D,this.int16[Dt+6]=U,this.int16[Dt+7]=G,this.uint16[Dt+8]=$,this.uint16[Dt+9]=K,this.uint16[Dt+10]=se,this.uint16[Dt+11]=ce,this.uint16[Dt+12]=he,this.uint16[Dt+13]=me,this.uint16[Dt+14]=Ee,this.uint16[Dt+15]=Oe,this.uint16[Dt+16]=et,this.uint16[Dt+17]=Ue,this.uint16[Dt+18]=le,this.uint16[Dt+19]=ve,this.uint16[Dt+20]=We,this.uint16[Dt+21]=xt,this.uint16[Dt+22]=Ht,this.uint32[mr+12]=Et,this.float32[mr+13]=Rt,this.float32[mr+14]=Yt,this.uint16[Dt+30]=qt,this.uint16[Dt+31]=Qt,l}}C.prototype.bytesPerElement=64,hr("StructArrayLayout8i15ui1ul2f2ui64",C);class o extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){let d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.float32[1*l+0]=d,l}}o.prototype.bytesPerElement=4,hr("StructArrayLayout1f4",o);class u extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=3*l;return this.uint16[6*l+0]=d,this.float32[I+1]=g,this.float32[I+2]=w,l}}u.prototype.bytesPerElement=12,hr("StructArrayLayout1ui2f12",u);class _ extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=4*l;return this.uint32[2*l+0]=d,this.uint16[I+2]=g,this.uint16[I+3]=w,l}}_.prototype.bytesPerElement=8,hr("StructArrayLayout1ul2ui8",_);class v extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d){let g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){let w=2*l;return this.uint16[w+0]=d,this.uint16[w+1]=g,l}}v.prototype.bytesPerElement=4,hr("StructArrayLayout2ui4",v);class S extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){let d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint16[1*l+0]=d,l}}S.prototype.bytesPerElement=2,hr("StructArrayLayout1ui2",S);class O extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,w){let I=this.length;return this.resize(I+1),this.emplace(I,l,d,g,w)}emplace(l,d,g,w,I){let P=4*l;return this.float32[P+0]=d,this.float32[P+1]=g,this.float32[P+2]=w,this.float32[P+3]=I,l}}O.prototype.bytesPerElement=16,hr("StructArrayLayout4f16",O);class z extends Th{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new R(this.anchorPointX,this.anchorPointY)}}z.prototype.size=20;class V extends Wf{get(l){return new z(this,l)}}hr("CollisionBoxArray",V);class H extends Th{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}H.prototype.size=48;class Q extends $f{get(l){return new H(this,l)}}hr("PlacedSymbolArray",Q);class ne extends Th{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ne.prototype.size=64;class ie extends C{get(l){return new ne(this,l)}}hr("SymbolInstanceArray",ie);class de extends o{getoffsetX(l){return this.float32[1*l+0]}}hr("GlyphOffsetArray",de);class ge extends bs{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}hr("SymbolLineVertexArray",ge);class Pe extends Th{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Pe.prototype.size=12;class Ie extends u{get(l){return new Pe(this,l)}}hr("TextAnchorOffsetArray",Ie);class Le extends Th{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Le.prototype.size=8;class Ne extends _{get(l){return new Le(this,l)}}hr("FeatureIndexArray",Ne);class Ge extends Eh{}class De extends Eh{}class Ze extends Eh{}class He extends du{}class Xe extends Hf{}class yt extends dc{}class At extends yp{}class Pt extends pu{}class Ot extends pc{}class Tt extends xp{}class er extends Ac{}class Kt extends vp{}class Ut extends Sh{}class mt extends v{}let Nt=Vn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bi}=Nt;class $r{constructor(l=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=l}prepareSegment(l,d,g,w){let I=this.segments[this.segments.length-1];return l>$r.MAX_VERTEX_ARRAY_LENGTH&&Ai(`Max vertices per segment is ${$r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${$r.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!I||I.vertexLength+l>$r.MAX_VERTEX_ARRAY_LENGTH||I.sortKey!==w?this.createNewSegment(d,g,w):I}createNewSegment(l,d,g){let w={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0,vaos:{}};return g!==void 0&&(w.sortKey=g),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(w),w}getOrCreateLatestSegment(l,d,g){return this.prepareSegment(0,l,d,g)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let l of this.segments)for(let d in l.vaos)l.vaos[d].destroy()}static simpleSegment(l,d,g,w){return new $r([{vertexOffset:l,primitiveOffset:d,vertexLength:g,primitiveLength:w,vaos:{},sortKey:0}])}}function zi(f,l){return 256*(f=Vt(Math.floor(f),0,255))+Vt(Math.floor(l),0,255)}$r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hr("SegmentVector",$r);let Zi=Vn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ui,Wi,wi,m={exports:{}},A={exports:{}},b={exports:{}},E=function(){if(wi)return m.exports;wi=1;var f=(Ui||(Ui=1,A.exports=function(d,g){var w,I,P,D,U,G,$,K;for(I=d.length-(w=3&d.length),P=g,U=3432918353,G=461845907,K=0;K<I;)$=255&d.charCodeAt(K)|(255&d.charCodeAt(++K))<<8|(255&d.charCodeAt(++K))<<16|(255&d.charCodeAt(++K))<<24,++K,P=27492+(65535&(D=5*(65535&(P=(P^=$=(65535&($=($=(65535&$)*U+((($>>>16)*U&65535)<<16)&4294967295)<<15|$>>>17))*G+((($>>>16)*G&65535)<<16)&4294967295)<<13|P>>>19))+((5*(P>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch($=0,w){case 3:$^=(255&d.charCodeAt(K+2))<<16;case 2:$^=(255&d.charCodeAt(K+1))<<8;case 1:P^=$=(65535&($=($=(65535&($^=255&d.charCodeAt(K)))*U+((($>>>16)*U&65535)<<16)&4294967295)<<15|$>>>17))*G+((($>>>16)*G&65535)<<16)&4294967295}return P^=d.length,P=2246822507*(65535&(P^=P>>>16))+((2246822507*(P>>>16)&65535)<<16)&4294967295,P=3266489909*(65535&(P^=P>>>13))+((3266489909*(P>>>16)&65535)<<16)&4294967295,(P^=P>>>16)>>>0}),A.exports),l=(Wi||(Wi=1,b.exports=function(d,g){for(var w,I=d.length,P=g^I,D=0;I>=4;)w=1540483477*(65535&(w=255&d.charCodeAt(D)|(255&d.charCodeAt(++D))<<8|(255&d.charCodeAt(++D))<<16|(255&d.charCodeAt(++D))<<24))+((1540483477*(w>>>16)&65535)<<16),P=1540483477*(65535&P)+((1540483477*(P>>>16)&65535)<<16)^(w=1540483477*(65535&(w^=w>>>24))+((1540483477*(w>>>16)&65535)<<16)),I-=4,++D;switch(I){case 3:P^=(255&d.charCodeAt(D+2))<<16;case 2:P^=(255&d.charCodeAt(D+1))<<8;case 1:P=1540483477*(65535&(P^=255&d.charCodeAt(D)))+((1540483477*(P>>>16)&65535)<<16)}return P=1540483477*(65535&(P^=P>>>13))+((1540483477*(P>>>16)&65535)<<16),(P^=P>>>15)>>>0}),b.exports);return m.exports=f,m.exports.murmur3=f,m.exports.murmur2=l,m.exports}(),M=a(E);class B{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,d,g,w){this.ids.push(F(l)),this.positions.push(d,g,w)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let d=F(l),g=0,w=this.ids.length-1;for(;g<w;){let P=g+w>>1;this.ids[P]>=d?w=P:g=P+1}let I=[];for(;this.ids[g]===d;)I.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return I}static serialize(l,d){let g=new Float64Array(l.ids),w=new Uint32Array(l.positions);return N(g,w,0,g.length-1),d&&d.push(g.buffer,w.buffer),{ids:g,positions:w}}static deserialize(l){let d=new B;return d.ids=l.ids,d.positions=l.positions,d.indexed=!0,d}}function F(f){let l=+f;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:M(String(f))}function N(f,l,d,g){for(;d<g;){let w=f[d+g>>1],I=d-1,P=g+1;for(;;){do I++;while(f[I]<w);do P--;while(f[P]>w);if(I>=P)break;W(f,I,P),W(l,3*I,3*P),W(l,3*I+1,3*P+1),W(l,3*I+2,3*P+2)}P-d<g-P?(N(f,l,d,P),d=P+1):(N(f,l,P+1,g),g=P)}}function W(f,l,d){let g=f[l];f[l]=f[d],f[d]=g}hr("FeaturePositionMap",B);class ee{constructor(l,d){this.gl=l.gl,this.location=d}}class fe extends ee{constructor(l,d){super(l,d),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Te extends ee{constructor(l,d){super(l,d),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class qe extends ee{constructor(l,d){super(l,d),this.current=Ei.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}let Je=new Float32Array(16);function je(f){return[zi(255*f.r,255*f.g),zi(255*f.b,255*f.a)]}class nt{constructor(l,d,g){this.value=l,this.uniformNames=d.map(w=>`u_${w}`),this.type=g}setUniform(l,d,g){l.set(g.constantOr(this.value))}getBinding(l,d,g){return this.type==="color"?new qe(l,d):new fe(l,d)}}class It{constructor(l,d){this.uniformNames=d.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=l.tlbr}setUniform(l,d,g,w){let I=w==="u_pattern_to"?this.patternTo:w==="u_pattern_from"?this.patternFrom:w==="u_pixel_ratio_to"?this.pixelRatioTo:w==="u_pixel_ratio_from"?this.pixelRatioFrom:null;I&&l.set(I)}getBinding(l,d,g){return g.substr(0,9)==="u_pattern"?new Te(l,d):new fe(l,d)}}class wt{constructor(l,d,g,w){this.expression=l,this.type=g,this.maxValue=0,this.paintVertexAttributes=d.map(I=>({name:`a_${I}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new w}populatePaintArray(l,d,g,w,I){let P=this.paintVertexArray.length,D=this.expression.evaluate(new hn(0),d,{},w,[],I);this.paintVertexArray.resize(l),this._setPaintValue(P,l,D)}updatePaintArray(l,d,g,w){let I=this.expression.evaluate({zoom:0},g,w);this._setPaintValue(l,d,I)}_setPaintValue(l,d,g){if(this.type==="color"){let w=je(g);for(let I=l;I<d;I++)this.paintVertexArray.emplace(I,w[0],w[1])}else{for(let w=l;w<d;w++)this.paintVertexArray.emplace(w,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class at{constructor(l,d,g,w,I,P){this.expression=l,this.uniformNames=d.map(D=>`u_${D}_t`),this.type=g,this.useIntegerZoom=w,this.zoom=I,this.maxValue=0,this.paintVertexAttributes=d.map(D=>({name:`a_${D}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new P}populatePaintArray(l,d,g,w,I){let P=this.expression.evaluate(new hn(this.zoom),d,{},w,[],I),D=this.expression.evaluate(new hn(this.zoom+1),d,{},w,[],I),U=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(U,l,P,D)}updatePaintArray(l,d,g,w){let I=this.expression.evaluate({zoom:this.zoom},g,w),P=this.expression.evaluate({zoom:this.zoom+1},g,w);this._setPaintValue(l,d,I,P)}_setPaintValue(l,d,g,w){if(this.type==="color"){let I=je(g),P=je(w);for(let D=l;D<d;D++)this.paintVertexArray.emplace(D,I[0],I[1],P[0],P[1])}else{for(let I=l;I<d;I++)this.paintVertexArray.emplace(I,g,w);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(w))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,d){let g=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,w=Vt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);l.set(w)}getBinding(l,d,g){return new fe(l,d)}}class bt{constructor(l,d,g,w,I,P){this.expression=l,this.type=d,this.useIntegerZoom=g,this.zoom=w,this.layerId=P,this.zoomInPaintVertexArray=new I,this.zoomOutPaintVertexArray=new I}populatePaintArray(l,d,g){let w=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(w,l,d.patterns&&d.patterns[this.layerId],g)}updatePaintArray(l,d,g,w,I){this._setPaintValues(l,d,g.patterns&&g.patterns[this.layerId],I)}_setPaintValues(l,d,g,w){if(!w||!g)return;let{min:I,mid:P,max:D}=g,U=w[I],G=w[P],$=w[D];if(U&&G&&$)for(let K=l;K<d;K++)this.zoomInPaintVertexArray.emplace(K,G.tl[0],G.tl[1],G.br[0],G.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],G.pixelRatio,U.pixelRatio),this.zoomOutPaintVertexArray.emplace(K,G.tl[0],G.tl[1],G.br[0],G.br[1],$.tl[0],$.tl[1],$.br[0],$.br[1],G.pixelRatio,$.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,Zi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,Zi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ft{constructor(l,d,g){this.binders={},this._buffers=[];let w=[];for(let I in l.paint._values){if(!g(I))continue;let P=l.paint.get(I);if(!(P instanceof Ca&&nc(P.property.specification)))continue;let D=gr(I,l.type),U=P.value,G=P.property.specification.type,$=P.property.useIntegerZoom,K=P.property.specification["property-type"],se=K==="cross-faded"||K==="cross-faded-data-driven";if(U.kind==="constant")this.binders[I]=se?new It(U.value,D):new nt(U.value,D,G),w.push(`/u_${I}`);else if(U.kind==="source"||se){let ce=sr(I,G,"source");this.binders[I]=se?new bt(U,G,$,d,ce,l.id):new wt(U,D,G,ce),w.push(`/a_${I}`)}else{let ce=sr(I,G,"composite");this.binders[I]=new at(U,D,G,$,d,ce),w.push(`/z_${I}`)}}this.cacheKey=w.sort().join("")}getMaxValue(l){let d=this.binders[l];return d instanceof wt||d instanceof at?d.maxValue:0}populatePaintArrays(l,d,g,w,I){for(let P in this.binders){let D=this.binders[P];(D instanceof wt||D instanceof at||D instanceof bt)&&D.populatePaintArray(l,d,g,w,I)}}setConstantPatternPositions(l,d){for(let g in this.binders){let w=this.binders[g];w instanceof It&&w.setConstantPatternPositions(l,d)}}updatePaintArrays(l,d,g,w,I){let P=!1;for(let D in l){let U=d.getPositions(D);for(let G of U){let $=g.feature(G.index);for(let K in this.binders){let se=this.binders[K];if((se instanceof wt||se instanceof at||se instanceof bt)&&se.expression.isStateDependent===!0){let ce=w.paint.get(K);se.expression=ce.value,se.updatePaintArray(G.start,G.end,$,l[D],I),P=!0}}}}return P}defines(){let l=[];for(let d in this.binders){let g=this.binders[d];(g instanceof nt||g instanceof It)&&l.push(...g.uniformNames.map(w=>`#define HAS_UNIFORM_${w}`))}return l}getBinderAttributes(){let l=[];for(let d in this.binders){let g=this.binders[d];if(g instanceof wt||g instanceof at)for(let w=0;w<g.paintVertexAttributes.length;w++)l.push(g.paintVertexAttributes[w].name);else if(g instanceof bt)for(let w=0;w<Zi.members.length;w++)l.push(Zi.members[w].name)}return l}getBinderUniforms(){let l=[];for(let d in this.binders){let g=this.binders[d];if(g instanceof nt||g instanceof It||g instanceof at)for(let w of g.uniformNames)l.push(w)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,d){let g=[];for(let w in this.binders){let I=this.binders[w];if(I instanceof nt||I instanceof It||I instanceof at){for(let P of I.uniformNames)if(d[P]){let D=I.getBinding(l,d[P],P);g.push({name:P,property:w,binding:D})}}}return g}setUniforms(l,d,g,w){for(let{name:I,property:P,binding:D}of d)this.binders[P].setUniform(D,w,g.get(P),I)}updatePaintBuffers(l){this._buffers=[];for(let d in this.binders){let g=this.binders[d];if(l&&g instanceof bt){let w=l.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;w&&this._buffers.push(w)}else(g instanceof wt||g instanceof at)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(l){for(let d in this.binders){let g=this.binders[d];(g instanceof wt||g instanceof at||g instanceof bt)&&g.upload(l)}this.updatePaintBuffers()}destroy(){for(let l in this.binders){let d=this.binders[l];(d instanceof wt||d instanceof at||d instanceof bt)&&d.destroy()}}}class ar{constructor(l,d,g=()=>!0){this.programConfigurations={};for(let w of l)this.programConfigurations[w.id]=new ft(w,d,g);this.needsUpload=!1,this._featureMap=new B,this._bufferOffset=0}populatePaintArrays(l,d,g,w,I,P){for(let D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(l,d,w,I,P);d.id!==void 0&&this._featureMap.add(d.id,g,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,d,g,w){for(let I of g)this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(l,this._featureMap,d,I,w)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(let d in this.programConfigurations)this.programConfigurations[d].upload(l);this.needsUpload=!1}}destroy(){for(let l in this.programConfigurations)this.programConfigurations[l].destroy()}}function gr(f,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${l}-`,"").replace(/-/g,"_")]}function sr(f,l,d){let g={color:{source:dc,composite:O},number:{source:o,composite:dc}},w=function(I){return{"line-pattern":{source:At,composite:At},"fill-pattern":{source:At,composite:At},"fill-extrusion-pattern":{source:At,composite:At}}[I]}(f);return w&&w[d]||g[l][d]}hr("ConstantBinder",nt),hr("CrossFadedConstantBinder",It),hr("SourceExpressionBinder",wt),hr("CrossFadedCompositeBinder",bt),hr("CompositeExpressionBinder",at),hr("ProgramConfiguration",ft,{omit:["_buffers"]}),hr("ProgramConfigurationSet",ar);let lr=Math.pow(2,14)-1,mi=-lr-1;function ri(f){let l=Se/f.extent,d=f.loadGeometry();for(let g=0;g<d.length;g++){let w=d[g];for(let I=0;I<w.length;I++){let P=w[I],D=Math.round(P.x*l),U=Math.round(P.y*l);P.x=Vt(D,mi,lr),P.y=Vt(U,mi,lr),(D<P.x||D>P.x+1||U<P.y||U>P.y+1)&&Ai("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function ni(f,l){return{type:f.type,id:f.id,properties:f.properties,geometry:l?ri(f):[]}}let qr=-32768;function jr(f,l,d,g,w){f.emplaceBack(qr+8*l+g,qr+8*d+w)}class Hr{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new De,this.indexArray=new Ut,this.segments=new $r,this.programConfigurations=new ar(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){let w=this.layers[0],I=[],P=null,D=!1,U=w.type==="heatmap";if(w.type==="circle"){let $=w;P=$.layout.get("circle-sort-key"),D=!P.isConstant(),U=U||$.paint.get("circle-pitch-alignment")==="map"}let G=U?d.subdivisionGranularity.circle:1;for(let{feature:$,id:K,index:se,sourceLayerIndex:ce}of l){let he=this.layers[0]._featureFilter.needGeometry,me=ni($,he);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),me,g))continue;let Ee=D?P.evaluate(me,{},g):void 0,Oe={id:K,properties:$.properties,type:$.type,sourceLayerIndex:ce,index:se,geometry:he?me.geometry:ri($),patterns:{},sortKey:Ee};I.push(Oe)}D&&I.sort(($,K)=>$.sortKey-K.sortKey);for(let $ of I){let{geometry:K,index:se,sourceLayerIndex:ce}=$,he=l[se].feature;this.addFeature($,K,se,g,G),d.featureIndex.insert(he,K,se,ce,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Bi),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,d,g,w,I=1){let P;switch(I){case 1:P=[0,7];break;case 3:P=[0,2,5,7];break;case 5:P=[0,1,3,4,6,7];break;case 7:P=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${I}; valid values are 1, 3, 5, 7.`)}let D=P.length;for(let U of d)for(let G of U){let $=G.x,K=G.y;if($<0||$>=Se||K<0||K>=Se)continue;let se=this.segments.prepareSegment(D*D,this.layoutVertexArray,this.indexArray,l.sortKey),ce=se.vertexLength;for(let he=0;he<D;he++)for(let me=0;me<D;me++)jr(this.layoutVertexArray,$,K,P[me],P[he]);for(let he=0;he<D-1;he++)for(let me=0;me<D-1;me++){let Ee=ce+he*D+me,Oe=ce+(he+1)*D+me;this.indexArray.emplaceBack(Ee,Oe+1,Ee+1),this.indexArray.emplaceBack(Ee,Oe,Oe+1)}se.vertexLength+=D*D,se.primitiveLength+=(D-1)*(D-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,{},w)}}function Vi(f,l){for(let d=0;d<f.length;d++)if(wp(l,f[d]))return!0;for(let d=0;d<l.length;d++)if(wp(f,l[d]))return!0;return!!_m(f,l)}function Zr(f,l,d){return!!wp(f,l)||!!hE(l,f,d)}function fn(f,l){if(f.length===1)return vR(l,f[0]);for(let d=0;d<l.length;d++){let g=l[d];for(let w=0;w<g.length;w++)if(wp(f,g[w]))return!0}for(let d=0;d<f.length;d++)if(vR(l,f[d]))return!0;for(let d=0;d<l.length;d++)if(_m(f,l[d]))return!0;return!1}function Ro(f,l,d){if(f.length>1){if(_m(f,l))return!0;for(let g=0;g<l.length;g++)if(hE(l[g],f,d))return!0}for(let g=0;g<f.length;g++)if(hE(f[g],l,d))return!0;return!1}function _m(f,l){if(f.length===0||l.length===0)return!1;for(let d=0;d<f.length-1;d++){let g=f[d],w=f[d+1];for(let I=0;I<l.length-1;I++)if(s$(g,w,l[I],l[I+1]))return!0}return!1}function s$(f,l,d,g){return Wr(f,d,g)!==Wr(l,d,g)&&Wr(f,l,d)!==Wr(f,l,g)}function hE(f,l,d){let g=d*d;if(l.length===1)return f.distSqr(l[0])<g;for(let w=1;w<l.length;w++)if(bR(f,l[w-1],l[w])<g)return!0;return!1}function bR(f,l,d){let g=l.distSqr(d);if(g===0)return f.distSqr(l);let w=((f.x-l.x)*(d.x-l.x)+(f.y-l.y)*(d.y-l.y))/g;return f.distSqr(w<0?l:w>1?d:d.sub(l)._mult(w)._add(l))}function vR(f,l){for(let d=0;d<f.length;d++)if(wp(f[d],l))return!0;return!1}function wp(f,l){let d=!1;for(let g=0,w=f.length-1;g<f.length;w=g++){let I=f[g],P=f[w];I.y>l.y!=P.y>l.y&&l.x<(P.x-I.x)*(l.y-I.y)/(P.y-I.y)+I.x&&(d=!d)}return d}function o$(f,l,d){let g=d[0],w=d[2];if(f.x<g.x&&l.x<g.x||f.x>w.x&&l.x>w.x||f.y<g.y&&l.y<g.y||f.y>w.y&&l.y>w.y)return!1;let I=Wr(f,l,d[0]);return I!==Wr(f,l,d[1])||I!==Wr(f,l,d[2])||I!==Wr(f,l,d[3])}function $g(f,l,d){let g=l.paint.get(f).value;return g.kind==="constant"?g.value:d.programConfigurations.get(l.id).getMaxValue(f)}function d2(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function p2(f,l,d,g,w){if(!l[0]&&!l[1])return f;let I=R.convert(l)._mult(w);d==="viewport"&&I._rotate(-g);let P=[];for(let D=0;D<f.length;D++)P.push(f[D].sub(I));return P}let wR,TR;hr("CircleBucket",Hr,{omit:["layers"]});var a$={get paint(){return TR=TR||new po({"circle-radius":new Lr(ue.paint_circle["circle-radius"]),"circle-color":new Lr(ue.paint_circle["circle-color"]),"circle-blur":new Lr(ue.paint_circle["circle-blur"]),"circle-opacity":new Lr(ue.paint_circle["circle-opacity"]),"circle-translate":new br(ue.paint_circle["circle-translate"]),"circle-translate-anchor":new br(ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new br(ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new br(ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Lr(ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Lr(ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Lr(ue.paint_circle["circle-stroke-opacity"])})},get layout(){return wR=wR||new po({"circle-sort-key":new Lr(ue.layout_circle["circle-sort-key"])})}};class l$ extends Bn{constructor(l){super(l,a$)}createBucket(l){return new Hr(l)}queryRadius(l){let d=l;return $g("circle-radius",this,d)+$g("circle-stroke-width",this,d)+d2(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:l,feature:d,featureState:g,geometry:w,transform:I,pixelsToTileUnits:P,unwrappedTileID:D,getElevation:U}){let G=p2(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-I.bearingInRadians,P),$=this.paint.get("circle-radius").evaluate(d,g)+this.paint.get("circle-stroke-width").evaluate(d,g),K=this.paint.get("circle-pitch-alignment")==="map",se=K?G:function(he,me,Ee,Oe){return he.map(et=>ER(et,me,Ee,Oe))}(G,I,D,U),ce=K?$*P:$;for(let he of w)for(let me of he){let Ee=K?me:ER(me,I,D,U),Oe=ce,et=I.projectTileCoordinates(me.x,me.y,D,U).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Oe*=et/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Oe*=I.cameraToCenterDistance/et),Zr(se,Ee,Oe))return!0}return!1}}function ER(f,l,d,g){let w=l.projectTileCoordinates(f.x,f.y,d,g).point;return new R((.5*w.x+.5)*l.width,(.5*-w.y+.5)*l.height)}class CR extends Hr{}let SR;hr("HeatmapBucket",CR,{omit:["layers"]});var c$={get paint(){return SR=SR||new po({"heatmap-radius":new Lr(ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Lr(ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new br(ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gf(ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new br(ue.paint_heatmap["heatmap-opacity"])})}};function fE(f,{width:l,height:d},g,w){if(w){if(w instanceof Uint8ClampedArray)w=new Uint8Array(w.buffer);else if(w.length!==l*d*g)throw new RangeError(`mismatched image size. expected: ${w.length} but got: ${l*d*g}`)}else w=new Uint8Array(l*d*g);return f.width=l,f.height=d,f.data=w,f}function IR(f,{width:l,height:d},g){if(l===f.width&&d===f.height)return;let w=fE({},{width:l,height:d},g);dE(f,w,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,l),height:Math.min(f.height,d)},g),f.width=l,f.height=d,f.data=w.data}function dE(f,l,d,g,w,I){if(w.width===0||w.height===0)return l;if(w.width>f.width||w.height>f.height||d.x>f.width-w.width||d.y>f.height-w.height)throw new RangeError("out of range source coordinates for image copy");if(w.width>l.width||w.height>l.height||g.x>l.width-w.width||g.y>l.height-w.height)throw new RangeError("out of range destination coordinates for image copy");let P=f.data,D=l.data;if(P===D)throw new Error("srcData equals dstData, so image is already copied");for(let U=0;U<w.height;U++){let G=((d.y+U)*f.width+d.x)*I,$=((g.y+U)*l.width+g.x)*I;for(let K=0;K<w.width*I;K++)D[$+K]=P[G+K]}return l}class qg{constructor(l,d){fE(this,l,1,d)}resize(l){IR(this,l,1)}clone(){return new qg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,g,w,I){dE(l,d,g,w,I,1)}}class Wa{constructor(l,d){fE(this,l,4,d)}resize(l){IR(this,l,4)}replace(l,d){d?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Wa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,g,w,I){dE(l,d,g,w,I,4)}}function MR(f){let l={},d=f.resolution||256,g=f.clips?f.clips.length:1,w=f.image||new Wa({width:d,height:g});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);let I=(P,D,U)=>{l[f.evaluationKey]=U;let G=f.expression.evaluate(l);w.data[P+D+0]=Math.floor(255*G.r/G.a),w.data[P+D+1]=Math.floor(255*G.g/G.a),w.data[P+D+2]=Math.floor(255*G.b/G.a),w.data[P+D+3]=Math.floor(255*G.a)};if(f.clips)for(let P=0,D=0;P<g;++P,D+=4*d)for(let U=0,G=0;U<d;U++,G+=4){let $=U/(d-1),{start:K,end:se}=f.clips[P];I(D,G,K*(1-$)+se*$)}else for(let P=0,D=0;P<d;P++,D+=4)I(0,D,P/(d-1));return w}hr("AlphaImage",qg),hr("RGBAImage",Wa);let pE="big-fb";class u$ extends Bn{createBucket(l){return new CR(l)}constructor(l){super(l,c$),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=MR({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(pE)&&this.heatmapFbos.delete(pE)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let PR;var h$={get paint(){return PR=PR||new po({"hillshade-illumination-direction":new br(ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new br(ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new br(ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new br(ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new br(ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new br(ue.paint_hillshade["hillshade-accent-color"])})}};class f$ extends Bn{constructor(l){super(l,h$)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let d$=Vn([{name:"a_pos",components:2,type:"Int16"}],4),{members:p$}=d$;function AE(f,l,d){let g=d.patternDependencies,w=!1;for(let I of l){let P=I.paint.get(`${f}-pattern`);P.isConstant()||(w=!0);let D=P.constantOr(null);D&&(w=!0,g[D.to]=!0,g[D.from]=!0)}return w}function mE(f,l,d,g,w){let I=w.patternDependencies;for(let P of l){let D=P.paint.get(`${f}-pattern`).value;if(D.kind!=="constant"){let U=D.evaluate({zoom:g-1},d,{},w.availableImages),G=D.evaluate({zoom:g},d,{},w.availableImages),$=D.evaluate({zoom:g+1},d,{},w.availableImages);U=U&&U.name?U.name:U,G=G&&G.name?G.name:G,$=$&&$.name?$.name:$,I[U]=!0,I[G]=!0,I[$]=!0,d.patterns[P.id]={min:U,mid:G,max:$}}}return d}function RR(f,l,d,g,w){let I;if(w===function(P,D,U,G){let $=0;for(let K=D,se=U-G;K<U;K+=G)$+=(P[se]-P[K])*(P[K+1]+P[se+1]),se=K;return $}(f,l,d,g)>0)for(let P=l;P<d;P+=g)I=DR(P/g|0,f[P],f[P+1],I);else for(let P=d-g;P>=l;P-=g)I=DR(P/g|0,f[P],f[P+1],I);return I&&ym(I,I.next)&&(Kg(I),I=I.next),I}function Tp(f,l){if(!f)return f;l||(l=f);let d,g=f;do if(d=!1,g.steiner||!ym(g,g.next)&&rs(g.prev,g,g.next)!==0)g=g.next;else{if(Kg(g),g=l=g.prev,g===g.next)break;d=!0}while(d||g!==l);return l}function Zg(f,l,d,g,w,I,P){if(!f)return;!P&&I&&function(U,G,$,K){let se=U;do se.z===0&&(se.z=gE(se.x,se.y,G,$,K)),se.prevZ=se.prev,se.nextZ=se.next,se=se.next;while(se!==U);se.prevZ.nextZ=null,se.prevZ=null,function(ce){let he,me=1;do{let Ee,Oe=ce;ce=null;let et=null;for(he=0;Oe;){he++;let Ue=Oe,le=0;for(let We=0;We<me&&(le++,Ue=Ue.nextZ,Ue);We++);let ve=me;for(;le>0||ve>0&&Ue;)le!==0&&(ve===0||!Ue||Oe.z<=Ue.z)?(Ee=Oe,Oe=Oe.nextZ,le--):(Ee=Ue,Ue=Ue.nextZ,ve--),et?et.nextZ=Ee:ce=Ee,Ee.prevZ=et,et=Ee;Oe=Ue}et.nextZ=null,me*=2}while(he>1)}(se)}(f,g,w,I);let D=f;for(;f.prev!==f.next;){let U=f.prev,G=f.next;if(I?m$(f,g,w,I):A$(f))l.push(U.i,f.i,G.i),Kg(f),f=G.next,D=G.next;else if((f=G)===D){P?P===1?Zg(f=g$(Tp(f),l),l,d,g,w,I,2):P===2&&_$(f,l,d,g,w,I):Zg(Tp(f),l,d,g,w,I,1);break}}}function A$(f){let l=f.prev,d=f,g=f.next;if(rs(l,d,g)>=0)return!1;let w=l.x,I=d.x,P=g.x,D=l.y,U=d.y,G=g.y,$=Math.min(w,I,P),K=Math.min(D,U,G),se=Math.max(w,I,P),ce=Math.max(D,U,G),he=g.next;for(;he!==l;){if(he.x>=$&&he.x<=se&&he.y>=K&&he.y<=ce&&Xg(w,D,I,U,P,G,he.x,he.y)&&rs(he.prev,he,he.next)>=0)return!1;he=he.next}return!0}function m$(f,l,d,g){let w=f.prev,I=f,P=f.next;if(rs(w,I,P)>=0)return!1;let D=w.x,U=I.x,G=P.x,$=w.y,K=I.y,se=P.y,ce=Math.min(D,U,G),he=Math.min($,K,se),me=Math.max(D,U,G),Ee=Math.max($,K,se),Oe=gE(ce,he,l,d,g),et=gE(me,Ee,l,d,g),Ue=f.prevZ,le=f.nextZ;for(;Ue&&Ue.z>=Oe&&le&&le.z<=et;){if(Ue.x>=ce&&Ue.x<=me&&Ue.y>=he&&Ue.y<=Ee&&Ue!==w&&Ue!==P&&Xg(D,$,U,K,G,se,Ue.x,Ue.y)&&rs(Ue.prev,Ue,Ue.next)>=0||(Ue=Ue.prevZ,le.x>=ce&&le.x<=me&&le.y>=he&&le.y<=Ee&&le!==w&&le!==P&&Xg(D,$,U,K,G,se,le.x,le.y)&&rs(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;Ue&&Ue.z>=Oe;){if(Ue.x>=ce&&Ue.x<=me&&Ue.y>=he&&Ue.y<=Ee&&Ue!==w&&Ue!==P&&Xg(D,$,U,K,G,se,Ue.x,Ue.y)&&rs(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.prevZ}for(;le&&le.z<=et;){if(le.x>=ce&&le.x<=me&&le.y>=he&&le.y<=Ee&&le!==w&&le!==P&&Xg(D,$,U,K,G,se,le.x,le.y)&&rs(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function g$(f,l){let d=f;do{let g=d.prev,w=d.next.next;!ym(g,w)&&LR(g,d,d.next,w)&&Yg(g,w)&&Yg(w,g)&&(l.push(g.i,d.i,w.i),Kg(d),Kg(d.next),d=f=w),d=d.next}while(d!==f);return Tp(d)}function _$(f,l,d,g,w,I){let P=f;do{let D=P.next.next;for(;D!==P.prev;){if(P.i!==D.i&&w$(P,D)){let U=OR(P,D);return P=Tp(P,P.next),U=Tp(U,U.next),Zg(P,l,d,g,w,I,0),void Zg(U,l,d,g,w,I,0)}D=D.next}P=P.next}while(P!==f)}function y$(f,l){let d=f.x-l.x;return d===0&&(d=f.y-l.y,d===0)&&(d=(f.next.y-f.y)/(f.next.x-f.x)-(l.next.y-l.y)/(l.next.x-l.x)),d}function x$(f,l){let d=function(w,I){let P=I,D=w.x,U=w.y,G,$=-1/0;if(ym(w,P))return P;do{if(ym(w,P.next))return P.next;if(U<=P.y&&U>=P.next.y&&P.next.y!==P.y){let me=P.x+(U-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(me<=D&&me>$&&($=me,G=P.x<P.next.x?P:P.next,me===D))return G}P=P.next}while(P!==I);if(!G)return null;let K=G,se=G.x,ce=G.y,he=1/0;P=G;do{if(D>=P.x&&P.x>=se&&D!==P.x&&BR(U<ce?D:$,U,se,ce,U<ce?$:D,U,P.x,P.y)){let me=Math.abs(U-P.y)/(D-P.x);Yg(P,w)&&(me<he||me===he&&(P.x>G.x||P.x===G.x&&b$(G,P)))&&(G=P,he=me)}P=P.next}while(P!==K);return G}(f,l);if(!d)return l;let g=OR(d,f);return Tp(g,g.next),Tp(d,d.next)}function b$(f,l){return rs(f.prev,f,l.prev)<0&&rs(l.next,f,f.next)<0}function gE(f,l,d,g,w){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-d)*w|0)|f<<8))|f<<4))|f<<2))|f<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-g)*w|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function v$(f){let l=f,d=f;do(l.x<d.x||l.x===d.x&&l.y<d.y)&&(d=l),l=l.next;while(l!==f);return d}function BR(f,l,d,g,w,I,P,D){return(w-P)*(l-D)>=(f-P)*(I-D)&&(f-P)*(g-D)>=(d-P)*(l-D)&&(d-P)*(I-D)>=(w-P)*(g-D)}function Xg(f,l,d,g,w,I,P,D){return!(f===P&&l===D)&&BR(f,l,d,g,w,I,P,D)}function w$(f,l){return f.next.i!==l.i&&f.prev.i!==l.i&&!function(d,g){let w=d;do{if(w.i!==d.i&&w.next.i!==d.i&&w.i!==g.i&&w.next.i!==g.i&&LR(w,w.next,d,g))return!0;w=w.next}while(w!==d);return!1}(f,l)&&(Yg(f,l)&&Yg(l,f)&&function(d,g){let w=d,I=!1,P=(d.x+g.x)/2,D=(d.y+g.y)/2;do w.y>D!=w.next.y>D&&w.next.y!==w.y&&P<(w.next.x-w.x)*(D-w.y)/(w.next.y-w.y)+w.x&&(I=!I),w=w.next;while(w!==d);return I}(f,l)&&(rs(f.prev,f,l.prev)||rs(f,l.prev,l))||ym(f,l)&&rs(f.prev,f,f.next)>0&&rs(l.prev,l,l.next)>0)}function rs(f,l,d){return(l.y-f.y)*(d.x-l.x)-(l.x-f.x)*(d.y-l.y)}function ym(f,l){return f.x===l.x&&f.y===l.y}function LR(f,l,d,g){let w=m2(rs(f,l,d)),I=m2(rs(f,l,g)),P=m2(rs(d,g,f)),D=m2(rs(d,g,l));return w!==I&&P!==D||!(w!==0||!A2(f,d,l))||!(I!==0||!A2(f,g,l))||!(P!==0||!A2(d,f,g))||!(D!==0||!A2(d,l,g))}function A2(f,l,d){return l.x<=Math.max(f.x,d.x)&&l.x>=Math.min(f.x,d.x)&&l.y<=Math.max(f.y,d.y)&&l.y>=Math.min(f.y,d.y)}function m2(f){return f>0?1:f<0?-1:0}function Yg(f,l){return rs(f.prev,f,f.next)<0?rs(f,l,f.next)>=0&&rs(f,f.prev,l)>=0:rs(f,l,f.prev)<0||rs(f,f.next,l)<0}function OR(f,l){let d=_E(f.i,f.x,f.y),g=_E(l.i,l.x,l.y),w=f.next,I=l.prev;return f.next=l,l.prev=f,d.next=w,w.prev=d,g.next=d,d.prev=g,I.next=g,g.prev=I,g}function DR(f,l,d,g){let w=_E(f,l,d);return g?(w.next=g.next,w.prev=g,g.next.prev=w,g.next=w):(w.prev=w,w.next=w),w}function Kg(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function _E(f,l,d){return{i:f,x:l,y:d,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class xm{constructor(l,d){if(d>l)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=l,this._minGranularity=d}getGranularityForZoomLevel(l){return Math.max(Math.floor(this._baseZoomGranularity/(1<<l)),this._minGranularity,1)}}class g2{constructor(l){this.fill=l.fill,this.line=l.line,this.tile=l.tile,this.stencil=l.stencil,this.circle=l.circle}}g2.noSubdivision=new g2({fill:new xm(0,0),line:new xm(0,0),tile:new xm(0,0),stencil:new xm(0,0),circle:1}),hr("SubdivisionGranularityExpression",xm),hr("SubdivisionGranularitySetting",g2);let bm=-32768,Qg=32767;class T${constructor(l,d){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=l,this._granularityCellSize=Se/l,this._canonical=d}_getKey(l,d){return(l+=32768)<<16|(d+=32768)<<0}_vertexToIndex(l,d){if(l<-32768||d<-32768||l>32767||d>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let g=0|Math.round(l),w=0|Math.round(d),I=this._getKey(g,w);if(this._vertexDictionary.has(I))return this._vertexDictionary.get(I);let P=this._vertexBuffer.length/2;return this._vertexDictionary.set(I,P),this._vertexBuffer.push(g,w),P}_subdivideTrianglesScanline(l){if(this._granularity<2)return function(w,I){let P=[];for(let D=0;D<I.length;D+=3){let U=I[D],G=I[D+1],$=I[D+2],K=w[2*U],se=w[2*U+1];(w[2*G]-K)*(w[2*$+1]-se)-(w[2*G+1]-se)*(w[2*$]-K)>0?(P.push(U),P.push($),P.push(G)):(P.push(U),P.push(G),P.push($))}return P}(this._vertexBuffer,l);let d=[],g=l.length;for(let w=0;w<g;w+=3){let I=[l[w+0],l[w+1],l[w+2]],P=[this._vertexBuffer[2*l[w+0]+0],this._vertexBuffer[2*l[w+0]+1],this._vertexBuffer[2*l[w+1]+0],this._vertexBuffer[2*l[w+1]+1],this._vertexBuffer[2*l[w+2]+0],this._vertexBuffer[2*l[w+2]+1]],D=1/0,U=1/0,G=-1/0,$=-1/0;for(let me=0;me<3;me++){let Ee=P[2*me],Oe=P[2*me+1];D=Math.min(D,Ee),G=Math.max(G,Ee),U=Math.min(U,Oe),$=Math.max($,Oe)}if(D===G||U===$)continue;let K=Math.floor(D/this._granularityCellSize),se=Math.ceil(G/this._granularityCellSize),ce=Math.floor(U/this._granularityCellSize),he=Math.ceil($/this._granularityCellSize);if(K!==se||ce!==he)for(let me=ce;me<he;me++){let Ee=this._scanlineGenerateVertexRingForCellRow(me,P,I);E$(this._vertexBuffer,Ee,d)}else d.push(...I)}return d}_scanlineGenerateVertexRingForCellRow(l,d,g){let w=l*this._granularityCellSize,I=w+this._granularityCellSize,P=[];for(let D=0;D<3;D++){let U=d[2*D],G=d[2*D+1],$=d[2*(D+1)%6],K=d[(2*(D+1)+1)%6],se=d[2*(D+2)%6],ce=d[(2*(D+2)+1)%6],he=$-U,me=K-G,Ee=he===0,Oe=me===0,et=(w-G)/me,Ue=(I-G)/me,le=Math.min(et,Ue),ve=Math.max(et,Ue);if(!Oe&&(le>=1||ve<=0)||Oe&&(G<w||G>I)){K>=w&&K<=I&&P.push(g[(D+1)%3]);continue}!Oe&&le>0&&P.push(this._vertexToIndex(U+he*le,G+me*le));let We=U+he*Math.max(le,0),xt=U+he*Math.min(ve,1);Ee||this._generateIntraEdgeVertices(P,U,G,$,K,We,xt),!Oe&&ve<1&&P.push(this._vertexToIndex(U+he*ve,G+me*ve)),(Oe||K>=w&&K<=I)&&P.push(g[(D+1)%3]),!Oe&&(K<=w||K>=I)&&this._generateInterEdgeVertices(P,U,G,$,K,se,ce,xt,w,I)}return P}_generateIntraEdgeVertices(l,d,g,w,I,P,D){let U=w-d,G=I-g,$=G===0,K=$?Math.min(d,w):Math.min(P,D),se=$?Math.max(d,w):Math.max(P,D),ce=Math.floor(K/this._granularityCellSize)+1,he=Math.ceil(se/this._granularityCellSize)-1;if($?d<w:P<D)for(let me=ce;me<=he;me++){let Ee=me*this._granularityCellSize;l.push(this._vertexToIndex(Ee,g+G*(Ee-d)/U))}else for(let me=he;me>=ce;me--){let Ee=me*this._granularityCellSize;l.push(this._vertexToIndex(Ee,g+G*(Ee-d)/U))}}_generateInterEdgeVertices(l,d,g,w,I,P,D,U,G,$){let K=I-g,se=P-w,ce=D-I,he=(G-I)/ce,me=($-I)/ce,Ee=Math.min(he,me),Oe=Math.max(he,me),et=w+se*Ee,Ue=Math.floor(Math.min(et,U)/this._granularityCellSize)+1,le=Math.ceil(Math.max(et,U)/this._granularityCellSize)-1,ve=U<et,We=ce===0;if(We&&(D===G||D===$))return;if(We||Ee>=1||Oe<=0){let Ht=g-D,Et=P+(d-P)*Math.min((G-D)/Ht,($-D)/Ht);Ue=Math.floor(Math.min(Et,U)/this._granularityCellSize)+1,le=Math.ceil(Math.max(Et,U)/this._granularityCellSize)-1,ve=U<Et}let xt=K>0?$:G;if(ve)for(let Ht=Ue;Ht<=le;Ht++)l.push(this._vertexToIndex(Ht*this._granularityCellSize,xt));else for(let Ht=le;Ht>=Ue;Ht--)l.push(this._vertexToIndex(Ht*this._granularityCellSize,xt))}_generateOutline(l){let d=[];for(let g of l){let w=Ep(g,this._granularity,!0),I=this._pointArrayToIndices(w),P=[];for(let D=1;D<I.length;D++)P.push(I[D-1]),P.push(I[D]);d.push(P)}return d}_handlePoles(l){let d=!1,g=!1;this._canonical&&(this._canonical.y===0&&(d=!0),this._canonical.y===(1<<this._canonical.z)-1&&(g=!0)),(d||g)&&this._fillPoles(l,d,g)}_ensureNoPoleVertices(){let l=this._vertexBuffer;for(let d=0;d<l.length;d+=2){let g=l[d+1];g===bm&&(l[d+1]=-32767),g===Qg&&(l[d+1]=32766)}}_generatePoleQuad(l,d,g,w,I,P){w>I!=(P===bm)?(l.push(d),l.push(g),l.push(this._vertexToIndex(w,P)),l.push(g),l.push(this._vertexToIndex(I,P)),l.push(this._vertexToIndex(w,P))):(l.push(g),l.push(d),l.push(this._vertexToIndex(w,P)),l.push(this._vertexToIndex(I,P)),l.push(g),l.push(this._vertexToIndex(w,P)))}_fillPoles(l,d,g){let w=this._vertexBuffer,I=Se,P=l.length;for(let D=2;D<P;D+=3){let U=l[D-2],G=l[D-1],$=l[D],K=w[2*U],se=w[2*U+1],ce=w[2*G],he=w[2*G+1],me=w[2*$],Ee=w[2*$+1];d&&(se===0&&he===0&&this._generatePoleQuad(l,U,G,K,ce,bm),he===0&&Ee===0&&this._generatePoleQuad(l,G,$,ce,me,bm),Ee===0&&se===0&&this._generatePoleQuad(l,$,U,me,K,bm)),g&&(se===I&&he===I&&this._generatePoleQuad(l,U,G,K,ce,Qg),he===I&&Ee===I&&this._generatePoleQuad(l,G,$,ce,me,Qg),Ee===I&&se===I&&this._generatePoleQuad(l,$,U,me,K,Qg))}}_initializeVertices(l){for(let d=0;d<l.length;d+=2)this._vertexToIndex(l[d],l[d+1])}subdividePolygonInternal(l,d){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:g,holeIndices:w}=function(D){let U=[],G=[];for(let $ of D)if($.length!==0){$!==D[0]&&U.push(G.length/2);for(let K=0;K<$.length;K++)G.push($[K].x),G.push($[K].y)}return{flattened:G,holeIndices:U}}(l),I;this._initializeVertices(g);try{let D=function(G,$,K=2){let se=$&&$.length,ce=se?$[0]*K:G.length,he=RR(G,0,ce,K,!0),me=[];if(!he||he.next===he.prev)return me;let Ee,Oe,et;if(se&&(he=function(Ue,le,ve,We){let xt=[];for(let Ht=0,Et=le.length;Ht<Et;Ht++){let Rt=RR(Ue,le[Ht]*We,Ht<Et-1?le[Ht+1]*We:Ue.length,We,!1);Rt===Rt.next&&(Rt.steiner=!0),xt.push(v$(Rt))}xt.sort(y$);for(let Ht=0;Ht<xt.length;Ht++)ve=x$(xt[Ht],ve);return ve}(G,$,he,K)),G.length>80*K){Ee=1/0,Oe=1/0;let Ue=-1/0,le=-1/0;for(let ve=K;ve<ce;ve+=K){let We=G[ve],xt=G[ve+1];We<Ee&&(Ee=We),xt<Oe&&(Oe=xt),We>Ue&&(Ue=We),xt>le&&(le=xt)}et=Math.max(Ue-Ee,le-Oe),et=et!==0?32767/et:0}return Zg(he,me,K,Ee,Oe,et,0),me}(g,w),U=this._convertIndices(g,D);I=this._subdivideTrianglesScanline(U)}catch(D){console.error(D)}let P=[];return d&&(P=this._generateOutline(l)),this._ensureNoPoleVertices(),this._handlePoles(I),{verticesFlattened:this._vertexBuffer,indicesTriangles:I,indicesLineList:P}}_convertIndices(l,d){let g=[];for(let w=0;w<d.length;w++)g.push(this._vertexToIndex(l[2*d[w]],l[2*d[w]+1]));return g}_pointArrayToIndices(l){let d=[];for(let g=0;g<l.length;g++){let w=l[g];d.push(this._vertexToIndex(w.x,w.y))}return d}}function FR(f,l,d,g=!0){return new T$(d,l).subdividePolygonInternal(f,g)}function Ep(f,l,d=!1){if(!f||f.length<1)return[];if(f.length<2)return[];let g=f[0],w=f[f.length-1],I=d&&(g.x!==w.x||g.y!==w.y);if(l<2)return I?[...f,f[0]]:[...f];let P=Math.floor(Se/l),D=[];D.push(new R(f[0].x,f[0].y));let U=f.length,G=I?U:U-1;for(let $=0;$<G;$++){let K=f[$],se=$<U-1?f[$+1]:f[0],ce=K.x,he=K.y,me=se.x,Ee=se.y,Oe=ce!==me,et=he!==Ee;if(!Oe&&!et)continue;let Ue=me-ce,le=Ee-he,ve=Math.abs(Ue),We=Math.abs(le),xt=ce,Ht=he;for(;;){let Rt=Ue>0?(Math.floor(xt/P)+1)*P:(Math.ceil(xt/P)-1)*P,Yt=le>0?(Math.floor(Ht/P)+1)*P:(Math.ceil(Ht/P)-1)*P,qt=Math.abs(xt-Rt),Qt=Math.abs(Ht-Yt),Dt=Math.abs(xt-me),mr=Math.abs(Ht-Ee),Or=Oe?qt/ve:Number.POSITIVE_INFINITY,Mr=et?Qt/We:Number.POSITIVE_INFINITY;if((Dt<=qt||!Oe)&&(mr<=Qt||!et))break;if(Or<Mr&&Oe||!et){xt=Rt,Ht+=le*Or;let xr=new R(xt,Math.round(Ht));D[D.length-1].x===xr.x&&D[D.length-1].y===xr.y||D.push(xr)}else{xt+=Ue*Mr,Ht=Yt;let xr=new R(Math.round(xt),Ht);D[D.length-1].x===xr.x&&D[D.length-1].y===xr.y||D.push(xr)}}let Et=new R(me,Ee);D[D.length-1].x===Et.x&&D[D.length-1].y===Et.y||D.push(Et)}return D}function E$(f,l,d){if(l.length===0)throw new Error("Subdivision vertex ring is empty.");let g=0,w=f[2*l[0]];for(let U=1;U<l.length;U++){let G=f[2*l[U]];G<w&&(w=G,g=U)}let I=l.length,P=g,D=(P+1)%I;for(;;){let U=P-1>=0?P-1:I-1,G=(D+1)%I,$=f[2*l[U]],K=f[2*l[G]],se=f[2*l[P]],ce=f[2*l[P]+1],he=f[2*l[D]+1],me=!1;if($<K)me=!0;else if($>K)me=!1;else{let Ee=he-ce,Oe=-(f[2*l[D]]-se),et=ce<he?1:-1;(($-se)*Ee+(f[2*l[U]+1]-ce)*Oe)*et>((K-se)*Ee+(f[2*l[G]+1]-ce)*Oe)*et&&(me=!0)}if(me){let Ee=l[U],Oe=l[P],et=l[D];Ee!==Oe&&Ee!==et&&Oe!==et&&d.push(et,Oe,Ee),P--,P<0&&(P=I-1)}else{let Ee=l[G],Oe=l[P],et=l[D];Ee!==Oe&&Ee!==et&&Oe!==et&&d.push(et,Oe,Ee),D++,D>=I&&(D=0)}if(U===G)break}}function kR(f,l,d,g,w,I,P,D,U){let G=w.length/2,$=P&&D&&U;if(G<$r.MAX_VERTEX_ARRAY_LENGTH){let K=l.prepareSegment(G,d,g),se=K.vertexLength;for(let me=0;me<I.length;me+=3)g.emplaceBack(se+I[me],se+I[me+1],se+I[me+2]);let ce,he;K.vertexLength+=G,K.primitiveLength+=I.length/3,$&&(he=P.prepareSegment(G,d,D),ce=he.vertexLength,he.vertexLength+=G);for(let me=0;me<w.length;me+=2)f(w[me],w[me+1]);if($)for(let me=0;me<U.length;me++){let Ee=U[me];for(let Oe=1;Oe<Ee.length;Oe+=2)D.emplaceBack(ce+Ee[Oe-1],ce+Ee[Oe]);he.primitiveLength+=Ee.length/2}}else(function(K,se,ce,he,me,Ee){let Oe=[];for(let We=0;We<he.length/2;We++)Oe.push(-1);let et={count:0},Ue=0,le=K.getOrCreateLatestSegment(se,ce),ve=le.vertexLength;for(let We=2;We<me.length;We+=3){let xt=me[We-2],Ht=me[We-1],Et=me[We],Rt=Oe[xt]<Ue,Yt=Oe[Ht]<Ue,qt=Oe[Et]<Ue;le.vertexLength+((Rt?1:0)+(Yt?1:0)+(qt?1:0))>$r.MAX_VERTEX_ARRAY_LENGTH&&(le=K.createNewSegment(se,ce),Ue=et.count,Rt=!0,Yt=!0,qt=!0,ve=0);let Qt=Jg(Oe,he,Ee,et,xt,Rt,le),Dt=Jg(Oe,he,Ee,et,Ht,Yt,le),mr=Jg(Oe,he,Ee,et,Et,qt,le);ce.emplaceBack(ve+Qt-Ue,ve+Dt-Ue,ve+mr-Ue),le.primitiveLength++}})(l,d,g,w,I,f),$&&function(K,se,ce,he,me,Ee){let Oe=[];for(let We=0;We<he.length/2;We++)Oe.push(-1);let et={count:0},Ue=0,le=K.getOrCreateLatestSegment(se,ce),ve=le.vertexLength;for(let We=0;We<me.length;We++){let xt=me[We];for(let Ht=1;Ht<me[We].length;Ht+=2){let Et=xt[Ht-1],Rt=xt[Ht],Yt=Oe[Et]<Ue,qt=Oe[Rt]<Ue;le.vertexLength+((Yt?1:0)+(qt?1:0))>$r.MAX_VERTEX_ARRAY_LENGTH&&(le=K.createNewSegment(se,ce),Ue=et.count,Yt=!0,qt=!0,ve=0);let Qt=Jg(Oe,he,Ee,et,Et,Yt,le),Dt=Jg(Oe,he,Ee,et,Rt,qt,le);ce.emplaceBack(ve+Qt-Ue,ve+Dt-Ue),le.primitiveLength++}}}(P,d,D,w,U,f),l.forceNewSegmentOnNextPrepare(),P?.forceNewSegmentOnNextPrepare()}function Jg(f,l,d,g,w,I,P){if(I){let D=g.count;return d(l[2*w],l[2*w+1]),f[w]=g.count,g.count++,P.vertexLength++,D}return f[w]}class yE{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ze,this.indexArray=new Ut,this.indexArray2=new mt,this.programConfigurations=new ar(l.layers,l.zoom),this.segments=new $r,this.segments2=new $r,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.hasPattern=AE("fill",this.layers,d);let w=this.layers[0].layout.get("fill-sort-key"),I=!w.isConstant(),P=[];for(let{feature:D,id:U,index:G,sourceLayerIndex:$}of l){let K=this.layers[0]._featureFilter.needGeometry,se=ni(D,K);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),se,g))continue;let ce=I?w.evaluate(se,{},g,d.availableImages):void 0,he={id:U,properties:D.properties,type:D.type,sourceLayerIndex:$,index:G,geometry:K?se.geometry:ri(D),patterns:{},sortKey:ce};P.push(he)}I&&P.sort((D,U)=>D.sortKey-U.sortKey);for(let D of P){let{geometry:U,index:G,sourceLayerIndex:$}=D;if(this.hasPattern){let K=mE("fill",this.layers,D,this.zoom,d);this.patternFeatures.push(K)}else this.addFeature(D,U,G,g,{},d.subdivisionGranularity);d.featureIndex.insert(l[G].feature,U,G,$,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}addFeatures(l,d,g){for(let w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,d,g,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,p$),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,d,g,w,I,P){for(let D of Ql(d,500)){let U=FR(D,w,P.fill.getGranularityForZoomLevel(w.z)),G=this.layoutVertexArray;kR(($,K)=>{G.emplaceBack($,K)},this.segments,this.layoutVertexArray,this.indexArray,U.verticesFlattened,U.indicesTriangles,this.segments2,this.indexArray2,U.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,I,w)}}let NR,zR;hr("FillBucket",yE,{omit:["layers","patternFeatures"]});var C$={get paint(){return zR=zR||new po({"fill-antialias":new br(ue.paint_fill["fill-antialias"]),"fill-opacity":new Lr(ue.paint_fill["fill-opacity"]),"fill-color":new Lr(ue.paint_fill["fill-color"]),"fill-outline-color":new Lr(ue.paint_fill["fill-outline-color"]),"fill-translate":new br(ue.paint_fill["fill-translate"]),"fill-translate-anchor":new br(ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new jf(ue.paint_fill["fill-pattern"])})},get layout(){return NR=NR||new po({"fill-sort-key":new Lr(ue.layout_fill["fill-sort-key"])})}};class S$ extends Bn{constructor(l){super(l,C$)}recalculate(l,d){super.recalculate(l,d);let g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new yE(l)}queryRadius(){return d2(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:l,geometry:d,transform:g,pixelsToTileUnits:w}){return fn(p2(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-g.bearingInRadians,w),d)}isTileClipped(){return!0}}let I$=Vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),M$=Vn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:P$}=I$;var xE,UR,bE,VR,vE,jR,GR,_2={};function HR(){if(UR)return xE;UR=1;var f=p();function l(w,I,P,D,U){this.properties={},this.extent=P,this.type=0,this._pbf=w,this._geometry=-1,this._keys=D,this._values=U,w.readFields(d,this,I)}function d(w,I,P){w==1?I.id=P.readVarint():w==2?function(D,U){for(var G=D.readVarint()+D.pos;D.pos<G;){var $=U._keys[D.readVarint()],K=U._values[D.readVarint()];U.properties[$]=K}}(P,I):w==3?I.type=P.readVarint():w==4&&(I._geometry=P.pos)}function g(w){for(var I,P,D=0,U=0,G=w.length,$=G-1;U<G;$=U++)D+=((P=w[$]).x-(I=w[U]).x)*(I.y+P.y);return D}return xE=l,l.types=["Unknown","Point","LineString","Polygon"],l.prototype.loadGeometry=function(){var w=this._pbf;w.pos=this._geometry;for(var I,P=w.readVarint()+w.pos,D=1,U=0,G=0,$=0,K=[];w.pos<P;){if(U<=0){var se=w.readVarint();D=7&se,U=se>>3}if(U--,D===1||D===2)G+=w.readSVarint(),$+=w.readSVarint(),D===1&&(I&&K.push(I),I=[]),I.push(new f(G,$));else{if(D!==7)throw new Error("unknown command "+D);I&&I.push(I[0].clone())}}return I&&K.push(I),K},l.prototype.bbox=function(){var w=this._pbf;w.pos=this._geometry;for(var I=w.readVarint()+w.pos,P=1,D=0,U=0,G=0,$=1/0,K=-1/0,se=1/0,ce=-1/0;w.pos<I;){if(D<=0){var he=w.readVarint();P=7&he,D=he>>3}if(D--,P===1||P===2)(U+=w.readSVarint())<$&&($=U),U>K&&(K=U),(G+=w.readSVarint())<se&&(se=G),G>ce&&(ce=G);else if(P!==7)throw new Error("unknown command "+P)}return[$,se,K,ce]},l.prototype.toGeoJSON=function(w,I,P){var D,U,G=this.extent*Math.pow(2,P),$=this.extent*w,K=this.extent*I,se=this.loadGeometry(),ce=l.types[this.type];function he(Oe){for(var et=0;et<Oe.length;et++){var Ue=Oe[et];Oe[et]=[360*(Ue.x+$)/G-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ue.y+K)/G)*Math.PI/180))-90]}}switch(this.type){case 1:var me=[];for(D=0;D<se.length;D++)me[D]=se[D][0];he(se=me);break;case 2:for(D=0;D<se.length;D++)he(se[D]);break;case 3:for(se=function(Oe){var et=Oe.length;if(et<=1)return[Oe];for(var Ue,le,ve=[],We=0;We<et;We++){var xt=g(Oe[We]);xt!==0&&(le===void 0&&(le=xt<0),le===xt<0?(Ue&&ve.push(Ue),Ue=[Oe[We]]):Ue.push(Oe[We]))}return Ue&&ve.push(Ue),ve}(se),D=0;D<se.length;D++)for(U=0;U<se[D].length;U++)he(se[D][U])}se.length===1?se=se[0]:ce="Multi"+ce;var Ee={type:"Feature",geometry:{type:ce,coordinates:se},properties:this.properties};return"id"in this&&(Ee.id=this.id),Ee},xE}function WR(){if(VR)return bE;VR=1;var f=HR();function l(g,w){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=g,this._keys=[],this._values=[],this._features=[],g.readFields(d,this,w),this.length=this._features.length}function d(g,w,I){g===15?w.version=I.readVarint():g===1?w.name=I.readString():g===5?w.extent=I.readVarint():g===2?w._features.push(I.pos):g===3?w._keys.push(I.readString()):g===4&&w._values.push(function(P){for(var D=null,U=P.readVarint()+P.pos;P.pos<U;){var G=P.readVarint()>>3;D=G===1?P.readString():G===2?P.readFloat():G===3?P.readDouble():G===4?P.readVarint64():G===5?P.readVarint():G===6?P.readSVarint():G===7?P.readBoolean():null}return D}(I))}return bE=l,l.prototype.feature=function(g){if(g<0||g>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[g];var w=this._pbf.readVarint()+this._pbf.pos;return new f(this._pbf,w,this.extent,this._keys,this._values)},bE}function $R(){return GR||(GR=1,_2.VectorTile=function(){if(jR)return vE;jR=1;var f=WR();function l(d,g,w){if(d===3){var I=new f(w,w.readVarint()+w.pos);I.length&&(g[I.name]=I)}}return vE=function(d,g){this.layers=d.readFields(l,{},g)},vE}(),_2.VectorTileFeature=HR(),_2.VectorTileLayer=WR()),_2}var e_=a($R());let R$=e_.VectorTileFeature.types,wE=Math.pow(2,13);function t_(f,l,d,g,w,I,P,D){f.emplaceBack(l,d,2*Math.floor(g*wE)+P,w*wE*2,I*wE*2,Math.round(D))}class TE{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new He,this.centroidVertexArray=new Ge,this.indexArray=new Ut,this.programConfigurations=new ar(l.layers,l.zoom),this.segments=new $r,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.features=[],this.hasPattern=AE("fill-extrusion",this.layers,d);for(let{feature:w,id:I,index:P,sourceLayerIndex:D}of l){let U=this.layers[0]._featureFilter.needGeometry,G=ni(w,U);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),G,g))continue;let $={id:I,sourceLayerIndex:D,index:P,geometry:U?G.geometry:ri(w),properties:w.properties,type:w.type,patterns:{}};this.hasPattern?this.features.push(mE("fill-extrusion",this.layers,$,this.zoom,d)):this.addFeature($,$.geometry,P,g,{},d.subdivisionGranularity),d.featureIndex.insert(w,$.geometry,P,D,this.index,!0)}}addFeatures(l,d,g){for(let w of this.features){let{geometry:I}=w;this.addFeature(w,I,w.index,d,g,l.subdivisionGranularity)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,P$),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,M$.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,d,g,w,I,P){for(let D of Ql(d,500)){let U={x:0,y:0,sampleCount:0},G=this.layoutVertexArray.length;this.processPolygon(U,w,l,D,P);let $=this.layoutVertexArray.length-G,K=Math.floor(U.x/U.sampleCount),se=Math.floor(U.y/U.sampleCount);for(let ce=0;ce<$;ce++)this.centroidVertexArray.emplaceBack(K,se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,I,w)}processPolygon(l,d,g,w,I){if(w.length<1||qR(w[0]))return;for(let K of w)K.length!==0&&B$(l,K);let P={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},D=I.fill.getGranularityForZoomLevel(d.z),U=R$[g.type]==="Polygon";for(let K of w){if(K.length===0||qR(K))continue;let se=Ep(K,D,U);this._generateSideFaces(se,P)}if(!U)return;let G=FR(w,d,D,!1),$=this.layoutVertexArray;kR((K,se)=>{t_($,K,se,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,G.verticesFlattened,G.indicesTriangles)}_generateSideFaces(l,d){let g=0;for(let w=1;w<l.length;w++){let I=l[w],P=l[w-1];if(L$(I,P))continue;d.segment.vertexLength+4>$r.MAX_VERTEX_ARRAY_LENGTH&&(d.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let D=I.sub(P)._perp()._unit(),U=P.dist(I);g+U>32768&&(g=0),t_(this.layoutVertexArray,I.x,I.y,D.x,D.y,0,0,g),t_(this.layoutVertexArray,I.x,I.y,D.x,D.y,0,1,g),g+=U,t_(this.layoutVertexArray,P.x,P.y,D.x,D.y,0,0,g),t_(this.layoutVertexArray,P.x,P.y,D.x,D.y,0,1,g);let G=d.segment.vertexLength;this.indexArray.emplaceBack(G,G+2,G+1),this.indexArray.emplaceBack(G+1,G+2,G+3),d.segment.vertexLength+=4,d.segment.primitiveLength+=2}}}function B$(f,l){for(let d=0;d<l.length;d++){let g=l[d];d===l.length-1&&l[0].x===g.x&&l[0].y===g.y||(f.x+=g.x,f.y+=g.y,f.sampleCount++)}}function L$(f,l){return f.x===l.x&&(f.x<0||f.x>Se)||f.y===l.y&&(f.y<0||f.y>Se)}function qR(f){return f.every(l=>l.x<0)||f.every(l=>l.x>Se)||f.every(l=>l.y<0)||f.every(l=>l.y>Se)}let ZR;hr("FillExtrusionBucket",TE,{omit:["layers","features"]});var O$={get paint(){return ZR=ZR||new po({"fill-extrusion-opacity":new br(ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Lr(ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new br(ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new br(ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jf(ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Lr(ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Lr(ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new br(ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class D$ extends Bn{constructor(l){super(l,O$)}createBucket(l){return new TE(l)}queryRadius(){return d2(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:l,feature:d,featureState:g,geometry:w,transform:I,pixelsToTileUnits:P,pixelPosMatrix:D}){let U=p2(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-I.bearingInRadians,P),G=this.paint.get("fill-extrusion-height").evaluate(d,g),$=this.paint.get("fill-extrusion-base").evaluate(d,g),K=function(ce,he,me){let Ee=[];for(let Oe of ce){let et=[Oe.x,Oe.y,0,1];Z(et,et,he),Ee.push(new R(et[0]/et[3],et[1]/et[3]))}return Ee}(U,D),se=function(ce,he,me,Ee){let Oe=[],et=[],Ue=Ee[8]*he,le=Ee[9]*he,ve=Ee[10]*he,We=Ee[11]*he,xt=Ee[8]*me,Ht=Ee[9]*me,Et=Ee[10]*me,Rt=Ee[11]*me;for(let Yt of ce){let qt=[],Qt=[];for(let Dt of Yt){let mr=Dt.x,Or=Dt.y,Mr=Ee[0]*mr+Ee[4]*Or+Ee[12],xr=Ee[1]*mr+Ee[5]*Or+Ee[13],xi=Ee[2]*mr+Ee[6]*Or+Ee[14],$n=Ee[3]*mr+Ee[7]*Or+Ee[15],ws=xi+ve,mo=$n+We,qa=Mr+xt,na=xr+Ht,Qs=xi+Et,jn=$n+Rt,zs=new R((Mr+Ue)/mo,(xr+le)/mo);zs.z=ws/mo,qt.push(zs);let Js=new R(qa/jn,na/jn);Js.z=Qs/jn,Qt.push(Js)}Oe.push(qt),et.push(Qt)}return[Oe,et]}(w,$,G,D);return function(ce,he,me){let Ee=1/0;fn(me,he)&&(Ee=XR(me,he[0]));for(let Oe=0;Oe<he.length;Oe++){let et=he[Oe],Ue=ce[Oe];for(let le=0;le<et.length-1;le++){let ve=et[le],We=[ve,et[le+1],Ue[le+1],Ue[le],ve];Vi(me,We)&&(Ee=Math.min(Ee,XR(me,We)))}}return Ee!==1/0&&Ee}(se[0],se[1],K)}}function r_(f,l){return f.x*l.x+f.y*l.y}function XR(f,l){if(f.length===1){let d=0,g=l[d++],w;for(;!w||g.equals(w);)if(w=l[d++],!w)return 1/0;for(;d<l.length;d++){let I=l[d],P=f[0],D=w.sub(g),U=I.sub(g),G=P.sub(g),$=r_(D,D),K=r_(D,U),se=r_(U,U),ce=r_(G,D),he=r_(G,U),me=$*se-K*K,Ee=(se*ce-K*he)/me,Oe=($*he-K*ce)/me,et=g.z*(1-Ee-Oe)+w.z*Ee+I.z*Oe;if(isFinite(et))return et}return 1/0}{let d=1/0;for(let g of l)d=Math.min(d,g.z);return d}}let F$=Vn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:k$}=F$,N$=Vn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:z$}=N$,U$=e_.VectorTileFeature.types,V$=Math.cos(Math.PI/180*37.5),YR=Math.pow(2,14)/.5;class EE{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new Xe,this.layoutVertexArray2=new yt,this.indexArray=new Ut,this.programConfigurations=new ar(l.layers,l.zoom),this.segments=new $r,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.hasPattern=AE("line",this.layers,d);let w=this.layers[0].layout.get("line-sort-key"),I=!w.isConstant(),P=[];for(let{feature:D,id:U,index:G,sourceLayerIndex:$}of l){let K=this.layers[0]._featureFilter.needGeometry,se=ni(D,K);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),se,g))continue;let ce=I?w.evaluate(se,{},g):void 0,he={id:U,properties:D.properties,type:D.type,sourceLayerIndex:$,index:G,geometry:K?se.geometry:ri(D),patterns:{},sortKey:ce};P.push(he)}I&&P.sort((D,U)=>D.sortKey-U.sortKey);for(let D of P){let{geometry:U,index:G,sourceLayerIndex:$}=D;if(this.hasPattern){let K=mE("line",this.layers,D,this.zoom,d);this.patternFeatures.push(K)}else this.addFeature(D,U,G,g,{},d.subdivisionGranularity);d.featureIndex.insert(l[G].feature,U,G,$,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}addFeatures(l,d,g){for(let w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,d,g,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,z$)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,k$),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,d,g,w,I,P){let D=this.layers[0].layout,U=D.get("line-join").evaluate(l,{}),G=D.get("line-cap"),$=D.get("line-miter-limit"),K=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(let se of d)this.addLine(se,l,U,G,$,K,w,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,I,w)}addLine(l,d,g,w,I,P,D,U){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,l=Ep(l,D?U.line.getGranularityForZoomLevel(D.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ue=0;Ue<l.length-1;Ue++)this.totalDistance+=l[Ue].dist(l[Ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let G=U$[d.type]==="Polygon",$=l.length;for(;$>=2&&l[$-1].equals(l[$-2]);)$--;let K=0;for(;K<$-1&&l[K].equals(l[K+1]);)K++;if($<(G?3:2))return;g==="bevel"&&(I=1.05);let se=this.overscaling<=16?15*Se/(512*this.overscaling):0,ce=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray),he,me,Ee,Oe,et;this.e1=this.e2=-1,G&&(he=l[$-2],et=l[K].sub(he)._unit()._perp());for(let Ue=K;Ue<$;Ue++){if(Ee=Ue===$-1?G?l[K+1]:void 0:l[Ue+1],Ee&&l[Ue].equals(Ee))continue;et&&(Oe=et),he&&(me=he),he=l[Ue],et=Ee?Ee.sub(he)._unit()._perp():Oe,Oe=Oe||et;let le=Oe.add(et);le.x===0&&le.y===0||le._unit();let ve=Oe.x*et.x+Oe.y*et.y,We=le.x*et.x+le.y*et.y,xt=We!==0?1/We:1/0,Ht=2*Math.sqrt(2-2*We),Et=We<V$&&me&&Ee,Rt=Oe.x*et.y-Oe.y*et.x>0;if(Et&&Ue>K){let Qt=he.dist(me);if(Qt>2*se){let Dt=he.sub(he.sub(me)._mult(se/Qt)._round());this.updateDistance(me,Dt),this.addCurrentVertex(Dt,Oe,0,0,ce),me=Dt}}let Yt=me&&Ee,qt=Yt?g:G?"butt":w;if(Yt&&qt==="round"&&(xt<P?qt="miter":xt<=2&&(qt="fakeround")),qt==="miter"&&xt>I&&(qt="bevel"),qt==="bevel"&&(xt>2&&(qt="flipbevel"),xt<I&&(qt="miter")),me&&this.updateDistance(me,he),qt==="miter")le._mult(xt),this.addCurrentVertex(he,le,0,0,ce);else if(qt==="flipbevel"){if(xt>100)le=et.mult(-1);else{let Qt=xt*Oe.add(et).mag()/Oe.sub(et).mag();le._perp()._mult(Qt*(Rt?-1:1))}this.addCurrentVertex(he,le,0,0,ce),this.addCurrentVertex(he,le.mult(-1),0,0,ce)}else if(qt==="bevel"||qt==="fakeround"){let Qt=-Math.sqrt(xt*xt-1),Dt=Rt?Qt:0,mr=Rt?0:Qt;if(me&&this.addCurrentVertex(he,Oe,Dt,mr,ce),qt==="fakeround"){let Or=Math.round(180*Ht/Math.PI/20);for(let Mr=1;Mr<Or;Mr++){let xr=Mr/Or;if(xr!==.5){let $n=xr-.5;xr+=xr*$n*(xr-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*$n*$n+(.848013+ve*(.215638*ve-1.06021)))}let xi=et.sub(Oe)._mult(xr)._add(Oe)._unit()._mult(Rt?-1:1);this.addHalfVertex(he,xi.x,xi.y,!1,Rt,0,ce)}}Ee&&this.addCurrentVertex(he,et,-Dt,-mr,ce)}else if(qt==="butt")this.addCurrentVertex(he,le,0,0,ce);else if(qt==="square"){let Qt=me?1:-1;this.addCurrentVertex(he,le,Qt,Qt,ce)}else qt==="round"&&(me&&(this.addCurrentVertex(he,Oe,0,0,ce),this.addCurrentVertex(he,Oe,1,1,ce,!0)),Ee&&(this.addCurrentVertex(he,et,-1,-1,ce,!0),this.addCurrentVertex(he,et,0,0,ce)));if(Et&&Ue<$-1){let Qt=he.dist(Ee);if(Qt>2*se){let Dt=he.add(Ee.sub(he)._mult(se/Qt)._round());this.updateDistance(he,Dt),this.addCurrentVertex(Dt,et,0,0,ce),he=Dt}}}}addCurrentVertex(l,d,g,w,I,P=!1){let D=d.y*w-d.x,U=-d.y-d.x*w;this.addHalfVertex(l,d.x+d.y*g,d.y-d.x*g,P,!1,g,I),this.addHalfVertex(l,D,U,P,!0,-w,I),this.distance>YR/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,d,g,w,I,P))}addHalfVertex({x:l,y:d},g,w,I,P,D,U){let G=.5*(this.lineClips?this.scaledDistance*(YR-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(I?1:0),(d<<1)+(P?1:0),Math.round(63*g)+128,Math.round(63*w)+128,1+(D===0?0:D<0?-1:1)|(63&G)<<2,G>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let $=U.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,$,this.e2),U.primitiveLength++),P?this.e2=$:this.e1=$}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,d){this.distance+=l.dist(d),this.updateScaledDistance()}}let KR,QR;hr("LineBucket",EE,{omit:["layers","patternFeatures"]});var JR={get paint(){return QR=QR||new po({"line-opacity":new Lr(ue.paint_line["line-opacity"]),"line-color":new Lr(ue.paint_line["line-color"]),"line-translate":new br(ue.paint_line["line-translate"]),"line-translate-anchor":new br(ue.paint_line["line-translate-anchor"]),"line-width":new Lr(ue.paint_line["line-width"]),"line-gap-width":new Lr(ue.paint_line["line-gap-width"]),"line-offset":new Lr(ue.paint_line["line-offset"]),"line-blur":new Lr(ue.paint_line["line-blur"]),"line-dasharray":new gp(ue.paint_line["line-dasharray"]),"line-pattern":new jf(ue.paint_line["line-pattern"]),"line-gradient":new Gf(ue.paint_line["line-gradient"])})},get layout(){return KR=KR||new po({"line-cap":new br(ue.layout_line["line-cap"]),"line-join":new Lr(ue.layout_line["line-join"]),"line-miter-limit":new br(ue.layout_line["line-miter-limit"]),"line-round-limit":new br(ue.layout_line["line-round-limit"]),"line-sort-key":new Lr(ue.layout_line["line-sort-key"])})}};class j$ extends Lr{possiblyEvaluate(l,d){return d=new hn(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(l,d)}evaluate(l,d,g,w){return d=Wt({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(l,d,g,w)}}let y2;class G$ extends Bn{constructor(l){super(l,JR),this.gradientVersion=0,y2||(y2=new j$(JR.paint.properties["line-width"].specification),y2.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){let d=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(d)&&d._styleExpression.expression instanceof hh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,d){super.recalculate(l,d),this.paint._values["line-floorwidth"]=y2.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new EE(l)}queryRadius(l){let d=l,g=eB($g("line-width",this,d),$g("line-gap-width",this,d)),w=$g("line-offset",this,d);return g/2+Math.abs(w)+d2(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:l,feature:d,featureState:g,geometry:w,transform:I,pixelsToTileUnits:P}){let D=p2(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-I.bearingInRadians,P),U=P/2*eB(this.paint.get("line-width").evaluate(d,g),this.paint.get("line-gap-width").evaluate(d,g)),G=this.paint.get("line-offset").evaluate(d,g);return G&&(w=function($,K){let se=[];for(let ce=0;ce<$.length;ce++){let he=$[ce],me=[];for(let Ee=0;Ee<he.length;Ee++){let Oe=he[Ee-1],et=he[Ee],Ue=he[Ee+1],le=Ee===0?new R(0,0):et.sub(Oe)._unit()._perp(),ve=Ee===he.length-1?new R(0,0):Ue.sub(et)._unit()._perp(),We=le._add(ve)._unit(),xt=We.x*ve.x+We.y*ve.y;xt!==0&&We._mult(1/xt),me.push(We._mult(K)._add(et))}se.push(me)}return se}(w,G*P)),function($,K,se){for(let ce=0;ce<K.length;ce++){let he=K[ce];if($.length>=3){for(let me=0;me<he.length;me++)if(wp($,he[me]))return!0}if(Ro($,he,se))return!0}return!1}(D,w,U)}isTileClipped(){return!0}}function eB(f,l){return l>0?l+2*f:f}let H$=Vn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),W$=Vn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Vn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let $$=Vn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Vn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let tB=Vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),q$=Vn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Z$(f,l,d){return f.sections.forEach(g=>{g.text=function(w,I,P){let D=I.layout.get("text-transform").evaluate(P,{});return D==="uppercase"?w=w.toLocaleUpperCase():D==="lowercase"&&(w=w.toLocaleLowerCase()),Ha.applyArabicShaping&&(w=Ha.applyArabicShaping(w)),w}(g.text,l,d)}),f}Vn([{name:"triangle",components:3,type:"Uint16"}]),Vn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Vn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Vn([{type:"Float32",name:"offsetX"}]),Vn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Vn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let i_={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var rB,CE,iB,vs=24,SE={};function X$(){return rB||(rB=1,SE.read=function(f,l,d,g,w){var I,P,D=8*w-g-1,U=(1<<D)-1,G=U>>1,$=-7,K=d?w-1:0,se=d?-1:1,ce=f[l+K];for(K+=se,I=ce&(1<<-$)-1,ce>>=-$,$+=D;$>0;I=256*I+f[l+K],K+=se,$-=8);for(P=I&(1<<-$)-1,I>>=-$,$+=g;$>0;P=256*P+f[l+K],K+=se,$-=8);if(I===0)I=1-G;else{if(I===U)return P?NaN:1/0*(ce?-1:1);P+=Math.pow(2,g),I-=G}return(ce?-1:1)*P*Math.pow(2,I-g)},SE.write=function(f,l,d,g,w,I){var P,D,U,G=8*I-w-1,$=(1<<G)-1,K=$>>1,se=w===23?Math.pow(2,-24)-Math.pow(2,-77):0,ce=g?0:I-1,he=g?1:-1,me=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(D=isNaN(l)?1:0,P=$):(P=Math.floor(Math.log(l)/Math.LN2),l*(U=Math.pow(2,-P))<1&&(P--,U*=2),(l+=P+K>=1?se/U:se*Math.pow(2,1-K))*U>=2&&(P++,U/=2),P+K>=$?(D=0,P=$):P+K>=1?(D=(l*U-1)*Math.pow(2,w),P+=K):(D=l*Math.pow(2,K-1)*Math.pow(2,w),P=0));w>=8;f[d+ce]=255&D,ce+=he,D/=256,w-=8);for(P=P<<w|D,G+=w;G>0;f[d+ce]=255&P,ce+=he,P/=256,G-=8);f[d+ce-he]|=128*me}),SE}function nB(){if(iB)return CE;iB=1,CE=l;var f=X$();function l(le){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(le)?le:new Uint8Array(le||0),this.pos=0,this.type=0,this.length=this.buf.length}l.Varint=0,l.Fixed64=1,l.Bytes=2,l.Fixed32=5;var d=4294967296,g=1/d,w=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function I(le){return le.type===l.Bytes?le.readVarint()+le.pos:le.pos+1}function P(le,ve,We){return We?4294967296*ve+(le>>>0):4294967296*(ve>>>0)+(le>>>0)}function D(le,ve,We){var xt=ve<=16383?1:ve<=2097151?2:ve<=268435455?3:Math.floor(Math.log(ve)/(7*Math.LN2));We.realloc(xt);for(var Ht=We.pos-1;Ht>=le;Ht--)We.buf[Ht+xt]=We.buf[Ht]}function U(le,ve){for(var We=0;We<le.length;We++)ve.writeVarint(le[We])}function G(le,ve){for(var We=0;We<le.length;We++)ve.writeSVarint(le[We])}function $(le,ve){for(var We=0;We<le.length;We++)ve.writeFloat(le[We])}function K(le,ve){for(var We=0;We<le.length;We++)ve.writeDouble(le[We])}function se(le,ve){for(var We=0;We<le.length;We++)ve.writeBoolean(le[We])}function ce(le,ve){for(var We=0;We<le.length;We++)ve.writeFixed32(le[We])}function he(le,ve){for(var We=0;We<le.length;We++)ve.writeSFixed32(le[We])}function me(le,ve){for(var We=0;We<le.length;We++)ve.writeFixed64(le[We])}function Ee(le,ve){for(var We=0;We<le.length;We++)ve.writeSFixed64(le[We])}function Oe(le,ve){return(le[ve]|le[ve+1]<<8|le[ve+2]<<16)+16777216*le[ve+3]}function et(le,ve,We){le[We]=ve,le[We+1]=ve>>>8,le[We+2]=ve>>>16,le[We+3]=ve>>>24}function Ue(le,ve){return(le[ve]|le[ve+1]<<8|le[ve+2]<<16)+(le[ve+3]<<24)}return l.prototype={destroy:function(){this.buf=null},readFields:function(le,ve,We){for(We=We||this.length;this.pos<We;){var xt=this.readVarint(),Ht=xt>>3,Et=this.pos;this.type=7&xt,le(Ht,ve,this),this.pos===Et&&this.skip(xt)}return ve},readMessage:function(le,ve){return this.readFields(le,ve,this.readVarint()+this.pos)},readFixed32:function(){var le=Oe(this.buf,this.pos);return this.pos+=4,le},readSFixed32:function(){var le=Ue(this.buf,this.pos);return this.pos+=4,le},readFixed64:function(){var le=Oe(this.buf,this.pos)+Oe(this.buf,this.pos+4)*d;return this.pos+=8,le},readSFixed64:function(){var le=Oe(this.buf,this.pos)+Ue(this.buf,this.pos+4)*d;return this.pos+=8,le},readFloat:function(){var le=f.read(this.buf,this.pos,!0,23,4);return this.pos+=4,le},readDouble:function(){var le=f.read(this.buf,this.pos,!0,52,8);return this.pos+=8,le},readVarint:function(le){var ve,We,xt=this.buf;return ve=127&(We=xt[this.pos++]),We<128?ve:(ve|=(127&(We=xt[this.pos++]))<<7,We<128?ve:(ve|=(127&(We=xt[this.pos++]))<<14,We<128?ve:(ve|=(127&(We=xt[this.pos++]))<<21,We<128?ve:function(Ht,Et,Rt){var Yt,qt,Qt=Rt.buf;if(Yt=(112&(qt=Qt[Rt.pos++]))>>4,qt<128||(Yt|=(127&(qt=Qt[Rt.pos++]))<<3,qt<128)||(Yt|=(127&(qt=Qt[Rt.pos++]))<<10,qt<128)||(Yt|=(127&(qt=Qt[Rt.pos++]))<<17,qt<128)||(Yt|=(127&(qt=Qt[Rt.pos++]))<<24,qt<128)||(Yt|=(1&(qt=Qt[Rt.pos++]))<<31,qt<128))return P(Ht,Yt,Et);throw new Error("Expected varint not more than 10 bytes")}(ve|=(15&(We=xt[this.pos]))<<28,le,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var le=this.readVarint();return le%2==1?(le+1)/-2:le/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var le=this.readVarint()+this.pos,ve=this.pos;return this.pos=le,le-ve>=12&&w?function(We,xt,Ht){return w.decode(We.subarray(xt,Ht))}(this.buf,ve,le):function(We,xt,Ht){for(var Et="",Rt=xt;Rt<Ht;){var Yt,qt,Qt,Dt=We[Rt],mr=null,Or=Dt>239?4:Dt>223?3:Dt>191?2:1;if(Rt+Or>Ht)break;Or===1?Dt<128&&(mr=Dt):Or===2?(192&(Yt=We[Rt+1]))==128&&(mr=(31&Dt)<<6|63&Yt)<=127&&(mr=null):Or===3?(qt=We[Rt+2],(192&(Yt=We[Rt+1]))==128&&(192&qt)==128&&((mr=(15&Dt)<<12|(63&Yt)<<6|63&qt)<=2047||mr>=55296&&mr<=57343)&&(mr=null)):Or===4&&(qt=We[Rt+2],Qt=We[Rt+3],(192&(Yt=We[Rt+1]))==128&&(192&qt)==128&&(192&Qt)==128&&((mr=(15&Dt)<<18|(63&Yt)<<12|(63&qt)<<6|63&Qt)<=65535||mr>=1114112)&&(mr=null)),mr===null?(mr=65533,Or=1):mr>65535&&(mr-=65536,Et+=String.fromCharCode(mr>>>10&1023|55296),mr=56320|1023&mr),Et+=String.fromCharCode(mr),Rt+=Or}return Et}(this.buf,ve,le)},readBytes:function(){var le=this.readVarint()+this.pos,ve=this.buf.subarray(this.pos,le);return this.pos=le,ve},readPackedVarint:function(le,ve){if(this.type!==l.Bytes)return le.push(this.readVarint(ve));var We=I(this);for(le=le||[];this.pos<We;)le.push(this.readVarint(ve));return le},readPackedSVarint:function(le){if(this.type!==l.Bytes)return le.push(this.readSVarint());var ve=I(this);for(le=le||[];this.pos<ve;)le.push(this.readSVarint());return le},readPackedBoolean:function(le){if(this.type!==l.Bytes)return le.push(this.readBoolean());var ve=I(this);for(le=le||[];this.pos<ve;)le.push(this.readBoolean());return le},readPackedFloat:function(le){if(this.type!==l.Bytes)return le.push(this.readFloat());var ve=I(this);for(le=le||[];this.pos<ve;)le.push(this.readFloat());return le},readPackedDouble:function(le){if(this.type!==l.Bytes)return le.push(this.readDouble());var ve=I(this);for(le=le||[];this.pos<ve;)le.push(this.readDouble());return le},readPackedFixed32:function(le){if(this.type!==l.Bytes)return le.push(this.readFixed32());var ve=I(this);for(le=le||[];this.pos<ve;)le.push(this.readFixed32());return le},readPackedSFixed32:function(le){if(this.type!==l.Bytes)return le.push(this.readSFixed32());var ve=I(this);for(le=le||[];this.pos<ve;)le.push(this.readSFixed32());return le},readPackedFixed64:function(le){if(this.type!==l.Bytes)return le.push(this.readFixed64());var ve=I(this);for(le=le||[];this.pos<ve;)le.push(this.readFixed64());return le},readPackedSFixed64:function(le){if(this.type!==l.Bytes)return le.push(this.readSFixed64());var ve=I(this);for(le=le||[];this.pos<ve;)le.push(this.readSFixed64());return le},skip:function(le){var ve=7&le;if(ve===l.Varint)for(;this.buf[this.pos++]>127;);else if(ve===l.Bytes)this.pos=this.readVarint()+this.pos;else if(ve===l.Fixed32)this.pos+=4;else{if(ve!==l.Fixed64)throw new Error("Unimplemented type: "+ve);this.pos+=8}},writeTag:function(le,ve){this.writeVarint(le<<3|ve)},realloc:function(le){for(var ve=this.length||16;ve<this.pos+le;)ve*=2;if(ve!==this.length){var We=new Uint8Array(ve);We.set(this.buf),this.buf=We,this.length=ve}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(le){this.realloc(4),et(this.buf,le,this.pos),this.pos+=4},writeSFixed32:function(le){this.realloc(4),et(this.buf,le,this.pos),this.pos+=4},writeFixed64:function(le){this.realloc(8),et(this.buf,-1&le,this.pos),et(this.buf,Math.floor(le*g),this.pos+4),this.pos+=8},writeSFixed64:function(le){this.realloc(8),et(this.buf,-1&le,this.pos),et(this.buf,Math.floor(le*g),this.pos+4),this.pos+=8},writeVarint:function(le){(le=+le||0)>268435455||le<0?function(ve,We){var xt,Ht;if(ve>=0?(xt=ve%4294967296|0,Ht=ve/4294967296|0):(Ht=~(-ve/4294967296),4294967295^(xt=~(-ve%4294967296))?xt=xt+1|0:(xt=0,Ht=Ht+1|0)),ve>=18446744073709552e3||ve<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");We.realloc(10),function(Et,Rt,Yt){Yt.buf[Yt.pos++]=127&Et|128,Et>>>=7,Yt.buf[Yt.pos++]=127&Et|128,Et>>>=7,Yt.buf[Yt.pos++]=127&Et|128,Et>>>=7,Yt.buf[Yt.pos++]=127&Et|128,Yt.buf[Yt.pos]=127&(Et>>>=7)}(xt,0,We),function(Et,Rt){var Yt=(7&Et)<<4;Rt.buf[Rt.pos++]|=Yt|((Et>>>=3)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et)))))}(Ht,We)}(le,this):(this.realloc(4),this.buf[this.pos++]=127&le|(le>127?128:0),le<=127||(this.buf[this.pos++]=127&(le>>>=7)|(le>127?128:0),le<=127||(this.buf[this.pos++]=127&(le>>>=7)|(le>127?128:0),le<=127||(this.buf[this.pos++]=le>>>7&127))))},writeSVarint:function(le){this.writeVarint(le<0?2*-le-1:2*le)},writeBoolean:function(le){this.writeVarint(!!le)},writeString:function(le){le=String(le),this.realloc(4*le.length),this.pos++;var ve=this.pos;this.pos=function(xt,Ht,Et){for(var Rt,Yt,qt=0;qt<Ht.length;qt++){if((Rt=Ht.charCodeAt(qt))>55295&&Rt<57344){if(!Yt){Rt>56319||qt+1===Ht.length?(xt[Et++]=239,xt[Et++]=191,xt[Et++]=189):Yt=Rt;continue}if(Rt<56320){xt[Et++]=239,xt[Et++]=191,xt[Et++]=189,Yt=Rt;continue}Rt=Yt-55296<<10|Rt-56320|65536,Yt=null}else Yt&&(xt[Et++]=239,xt[Et++]=191,xt[Et++]=189,Yt=null);Rt<128?xt[Et++]=Rt:(Rt<2048?xt[Et++]=Rt>>6|192:(Rt<65536?xt[Et++]=Rt>>12|224:(xt[Et++]=Rt>>18|240,xt[Et++]=Rt>>12&63|128),xt[Et++]=Rt>>6&63|128),xt[Et++]=63&Rt|128)}return Et}(this.buf,le,this.pos);var We=this.pos-ve;We>=128&&D(ve,We,this),this.pos=ve-1,this.writeVarint(We),this.pos+=We},writeFloat:function(le){this.realloc(4),f.write(this.buf,le,this.pos,!0,23,4),this.pos+=4},writeDouble:function(le){this.realloc(8),f.write(this.buf,le,this.pos,!0,52,8),this.pos+=8},writeBytes:function(le){var ve=le.length;this.writeVarint(ve),this.realloc(ve);for(var We=0;We<ve;We++)this.buf[this.pos++]=le[We]},writeRawMessage:function(le,ve){this.pos++;var We=this.pos;le(ve,this);var xt=this.pos-We;xt>=128&&D(We,xt,this),this.pos=We-1,this.writeVarint(xt),this.pos+=xt},writeMessage:function(le,ve,We){this.writeTag(le,l.Bytes),this.writeRawMessage(ve,We)},writePackedVarint:function(le,ve){ve.length&&this.writeMessage(le,U,ve)},writePackedSVarint:function(le,ve){ve.length&&this.writeMessage(le,G,ve)},writePackedBoolean:function(le,ve){ve.length&&this.writeMessage(le,se,ve)},writePackedFloat:function(le,ve){ve.length&&this.writeMessage(le,$,ve)},writePackedDouble:function(le,ve){ve.length&&this.writeMessage(le,K,ve)},writePackedFixed32:function(le,ve){ve.length&&this.writeMessage(le,ce,ve)},writePackedSFixed32:function(le,ve){ve.length&&this.writeMessage(le,he,ve)},writePackedFixed64:function(le,ve){ve.length&&this.writeMessage(le,me,ve)},writePackedSFixed64:function(le,ve){ve.length&&this.writeMessage(le,Ee,ve)},writeBytesField:function(le,ve){this.writeTag(le,l.Bytes),this.writeBytes(ve)},writeFixed32Field:function(le,ve){this.writeTag(le,l.Fixed32),this.writeFixed32(ve)},writeSFixed32Field:function(le,ve){this.writeTag(le,l.Fixed32),this.writeSFixed32(ve)},writeFixed64Field:function(le,ve){this.writeTag(le,l.Fixed64),this.writeFixed64(ve)},writeSFixed64Field:function(le,ve){this.writeTag(le,l.Fixed64),this.writeSFixed64(ve)},writeVarintField:function(le,ve){this.writeTag(le,l.Varint),this.writeVarint(ve)},writeSVarintField:function(le,ve){this.writeTag(le,l.Varint),this.writeSVarint(ve)},writeStringField:function(le,ve){this.writeTag(le,l.Bytes),this.writeString(ve)},writeFloatField:function(le,ve){this.writeTag(le,l.Fixed32),this.writeFloat(ve)},writeDoubleField:function(le,ve){this.writeTag(le,l.Fixed64),this.writeDouble(ve)},writeBooleanField:function(le,ve){this.writeVarintField(le,!!ve)}},CE}var IE=a(nB());let ME=3;function Y$(f,l,d){f===1&&d.readMessage(K$,l)}function K$(f,l,d){if(f===3){let{id:g,bitmap:w,width:I,height:P,left:D,top:U,advance:G}=d.readMessage(Q$,{});l.push({id:g,bitmap:new qg({width:I+2*ME,height:P+2*ME},w),metrics:{width:I,height:P,left:D,top:U,advance:G}})}}function Q$(f,l,d){f===1?l.id=d.readVarint():f===2?l.bitmap=d.readBytes():f===3?l.width=d.readVarint():f===4?l.height=d.readVarint():f===5?l.left=d.readSVarint():f===6?l.top=d.readSVarint():f===7&&(l.advance=d.readVarint())}let J$=ME;function sB(f){let l=0,d=0;for(let P of f)l+=P.w*P.h,d=Math.max(d,P.w);f.sort((P,D)=>D.h-P.h);let g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),d),h:1/0}],w=0,I=0;for(let P of f)for(let D=g.length-1;D>=0;D--){let U=g[D];if(!(P.w>U.w||P.h>U.h)){if(P.x=U.x,P.y=U.y,I=Math.max(I,P.y+P.h),w=Math.max(w,P.x+P.w),P.w===U.w&&P.h===U.h){let G=g.pop();D<g.length&&(g[D]=G)}else P.h===U.h?(U.x+=P.w,U.w-=P.w):P.w===U.w?(U.y+=P.h,U.h-=P.h):(g.push({x:U.x+P.w,y:U.y,w:U.w-P.w,h:P.h}),U.y+=P.h,U.h-=P.h);break}}return{w,h:I,fill:l/(w*I)||0}}let ia=1;class PE{constructor(l,{pixelRatio:d,version:g,stretchX:w,stretchY:I,content:P,textFitWidth:D,textFitHeight:U}){this.paddedRect=l,this.pixelRatio=d,this.stretchX=w,this.stretchY=I,this.content=P,this.version=g,this.textFitWidth=D,this.textFitHeight=U}get tl(){return[this.paddedRect.x+ia,this.paddedRect.y+ia]}get br(){return[this.paddedRect.x+this.paddedRect.w-ia,this.paddedRect.y+this.paddedRect.h-ia]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ia)/this.pixelRatio,(this.paddedRect.h-2*ia)/this.pixelRatio]}}class oB{constructor(l,d){let g={},w={};this.haveRenderCallbacks=[];let I=[];this.addImages(l,g,I),this.addImages(d,w,I);let{w:P,h:D}=sB(I),U=new Wa({width:P||1,height:D||1});for(let G in l){let $=l[G],K=g[G].paddedRect;Wa.copy($.data,U,{x:0,y:0},{x:K.x+ia,y:K.y+ia},$.data)}for(let G in d){let $=d[G],K=w[G].paddedRect,se=K.x+ia,ce=K.y+ia,he=$.data.width,me=$.data.height;Wa.copy($.data,U,{x:0,y:0},{x:se,y:ce},$.data),Wa.copy($.data,U,{x:0,y:me-1},{x:se,y:ce-1},{width:he,height:1}),Wa.copy($.data,U,{x:0,y:0},{x:se,y:ce+me},{width:he,height:1}),Wa.copy($.data,U,{x:he-1,y:0},{x:se-1,y:ce},{width:1,height:me}),Wa.copy($.data,U,{x:0,y:0},{x:se+he,y:ce},{width:1,height:me})}this.image=U,this.iconPositions=g,this.patternPositions=w}addImages(l,d,g){for(let w in l){let I=l[w],P={x:0,y:0,w:I.data.width+2*ia,h:I.data.height+2*ia};g.push(P),d[w]=new PE(P,I),I.hasRenderCallback&&this.haveRenderCallbacks.push(w)}}patchUpdatedImages(l,d){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let g in l.updatedImages)this.patchUpdatedImage(this.iconPositions[g],l.getImage(g),d),this.patchUpdatedImage(this.patternPositions[g],l.getImage(g),d)}patchUpdatedImage(l,d,g){if(!l||!d||l.version===d.version)return;l.version=d.version;let[w,I]=l.tl;g.update(d.data,void 0,{x:w,y:I})}}var qf;hr("ImagePosition",PE),hr("ImageAtlas",oB),n.ah=void 0,(qf=n.ah||(n.ah={}))[qf.none=0]="none",qf[qf.horizontal=1]="horizontal",qf[qf.vertical=2]="vertical",qf[qf.horizontalOnly=3]="horizontalOnly";let x2=-17;class n_{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(l,d,g){let w=new n_;return w.scale=l||1,w.fontStack=d,w.verticalAlign=g||"bottom",w}static forImage(l,d){let g=new n_;return g.imageName=l,g.verticalAlign=d||"bottom",g}}class vm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,d){let g=new vm;for(let w=0;w<l.sections.length;w++){let I=l.sections[w];I.image?g.addImageSection(I):g.addTextSection(I,d)}return g}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let d="";for(let g=0;g<l.length;g++){let w=l.charCodeAt(g+1)||null,I=l.charCodeAt(g-1)||null;d+=w&&pp(w)&&!i_[l[g+1]]||I&&pp(I)&&!i_[l[g-1]]||!i_[l[g]]?l[g]:i_[l[g]]}return d}(this.text)}trim(){let l=0;for(let g=0;g<this.text.length&&v2[this.text.charCodeAt(g)];g++)l++;let d=this.text.length;for(let g=this.text.length-1;g>=0&&g>=l&&v2[this.text.charCodeAt(g)];g--)d--;this.text=this.text.substring(l,d),this.sectionIndex=this.sectionIndex.slice(l,d)}substring(l,d){let g=new vm;return g.text=this.text.substring(l,d),g.sectionIndex=this.sectionIndex.slice(l,d),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,d)=>Math.max(l,this.sections[d].scale),0)}getMaxImageSize(l){let d=0,g=0;for(let w=0;w<this.length();w++){let I=this.getSection(w);if(I.imageName){let P=l[I.imageName];if(!P)continue;let D=P.displaySize;d=Math.max(d,D[0]),g=Math.max(g,D[1])}}return{maxImageWidth:d,maxImageHeight:g}}addTextSection(l,d){this.text+=l.text,this.sections.push(n_.forText(l.scale,l.fontStack||d,l.verticalAlign));let g=this.sections.length-1;for(let w=0;w<l.text.length;++w)this.sectionIndex.push(g)}addImageSection(l){let d=l.image?l.image.name:"";if(d.length===0)return void Ai("Can't add FormattedSection with an empty image.");let g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(n_.forImage(d,l.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ai("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function b2(f,l,d,g,w,I,P,D,U,G,$,K,se,ce,he){let me=vm.fromFeature(f,w),Ee;K===n.ah.vertical&&me.verticalizePunctuation();let{processBidirectionalText:Oe,processStyledBidirectionalText:et}=Ha;if(Oe&&me.sections.length===1){Ee=[];let ve=Oe(me.toString(),RE(me,G,I,l,g,ce));for(let We of ve){let xt=new vm;xt.text=We,xt.sections=me.sections;for(let Ht=0;Ht<We.length;Ht++)xt.sectionIndex.push(0);Ee.push(xt)}}else if(et){Ee=[];let ve=et(me.text,me.sectionIndex,RE(me,G,I,l,g,ce));for(let We of ve){let xt=new vm;xt.text=We[0],xt.sectionIndex=We[1],xt.sections=me.sections,Ee.push(xt)}}else Ee=function(ve,We){let xt=[],Ht=ve.text,Et=0;for(let Rt of We)xt.push(ve.substring(Et,Rt)),Et=Rt;return Et<Ht.length&&xt.push(ve.substring(Et,Ht.length)),xt}(me,RE(me,G,I,l,g,ce));let Ue=[],le={positionedLines:Ue,text:me.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(ve,We,xt,Ht,Et,Rt,Yt,qt,Qt,Dt,mr,Or){let Mr=0,xr=0,xi=0,$n=0,ws=qt==="right"?1:qt==="left"?0:.5,mo=vs/Or,qa=0;for(let jn of Et){jn.trim();let zs=jn.getMaxScale(),Js={positionedGlyphs:[],lineOffset:0};ve.positionedLines[qa]=Js;let eo=Js.positionedGlyphs,Vo=0;if(!jn.length()){xr+=Rt,++qa;continue}let Za=iq(Ht,jn,mo);for(let sa=0;sa<jn.length();sa++){let Ts=jn.getSection(sa),Vs=jn.getSectionIndex(sa),js=jn.getCharCode(sa),ds=nq(Qt,mr,js),Tn;if(Ts.imageName){if(ve.iconsInText=!0,Ts.scale=Ts.scale*mo,Tn=oq(Ts,ds,zs,Za,Ht),!Tn)continue;Vo=Math.max(Vo,Tn.imageOffset)}else if(Tn=sq(Ts,js,ds,Za,We,xt),!Tn)continue;let{rect:mc,metrics:Cm,baselineOffset:gc}=Tn;eo.push({glyph:js,imageName:Ts.imageName,x:Mr,y:xr+gc+x2,vertical:ds,scale:Ts.scale,fontStack:Ts.fontStack,sectionIndex:Vs,metrics:Cm,rect:mc}),ds?(ve.verticalizable=!0,Mr+=(Ts.imageName?Cm.advance:vs)*Ts.scale+Dt):Mr+=Cm.advance*Ts.scale+Dt}eo.length!==0&&(xi=Math.max(Mr-Dt,xi),aq(eo,0,eo.length-1,ws)),Mr=0,Js.lineOffset=Math.max(Vo,(zs-1)*vs);let Us=Rt*zs+Vo;xr+=Us,$n=Math.max(Us,$n),++qa}let{horizontalAlign:na,verticalAlign:Qs}=BE(Yt);(function(jn,zs,Js,eo,Vo,Za,Us,sa,Ts){let Vs=(zs-Js)*Vo,js=0;js=Za!==Us?-sa*eo-x2:-eo*Ts*Us+.5*Us;for(let ds of jn)for(let Tn of ds.positionedGlyphs)Tn.x+=Vs,Tn.y+=js})(ve.positionedLines,ws,na,Qs,xi,$n,Rt,xr,Et.length),ve.top+=-Qs*xr,ve.bottom=ve.top+xr,ve.left+=-na*xi,ve.right=ve.left+xi}(le,l,d,g,Ee,P,D,U,K,G,se,he),!function(ve){for(let We of ve)if(We.positionedGlyphs.length!==0)return!1;return!0}(Ue)&&le}let v2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},eq={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},tq={40:!0};function aB(f,l,d,g,w,I){if(l.imageName){let P=g[l.imageName];return P?P.displaySize[0]*l.scale*vs/I+w:0}{let P=d[l.fontStack],D=P&&P[f];return D?D.metrics.advance*l.scale+w:0}}function lB(f,l,d,g){let w=Math.pow(f-l,2);return g?f<l?w/2:2*w:w+Math.abs(d)*d}function rq(f,l,d){let g=0;return f===10&&(g-=1e4),d&&(g+=150),f!==40&&f!==65288||(g+=50),l!==41&&l!==65289||(g+=50),g}function cB(f,l,d,g,w,I){let P=null,D=lB(l,d,w,I);for(let U of g){let G=lB(l-U.x,d,w,I)+U.badness;G<=D&&(P=U,D=G)}return{index:f,x:l,priorBreak:P,badness:D}}function uB(f){return f?uB(f.priorBreak).concat(f.index):[]}function RE(f,l,d,g,w,I){if(!f)return[];let P=[],D=function(K,se,ce,he,me,Ee){let Oe=0;for(let et=0;et<K.length();et++){let Ue=K.getSection(et);Oe+=aB(K.getCharCode(et),Ue,he,me,se,Ee)}return Oe/Math.max(1,Math.ceil(Oe/ce))}(f,l,d,g,w,I),U=f.text.indexOf("\u200B")>=0,G=0;for(let K=0;K<f.length();K++){let se=f.getSection(K),ce=f.getCharCode(K);if(v2[ce]||(G+=aB(ce,se,g,w,l,I)),K<f.length()-1){let he=!(($=ce)<11904)&&(!!li["CJK Compatibility Forms"]($)||!!li["CJK Compatibility"]($)||!!li["CJK Strokes"]($)||!!li["CJK Symbols and Punctuation"]($)||!!li["Enclosed CJK Letters and Months"]($)||!!li["Halfwidth and Fullwidth Forms"]($)||!!li["Ideographic Description Characters"]($)||!!li["Vertical Forms"]($)||hc.test(String.fromCodePoint($)));(eq[ce]||he||se.imageName||K!==f.length()-2&&tq[f.getCharCode(K+1)])&&P.push(cB(K+1,G,D,P,rq(ce,f.getCharCode(K+1),he&&U),!1))}}var $;return uB(cB(f.length(),G,D,P,0,!0))}function BE(f){let l=.5,d=.5;switch(f){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:l,verticalAlign:d}}function iq(f,l,d){let g=l.getMaxScale()*vs,{maxImageWidth:w,maxImageHeight:I}=l.getMaxImageSize(f),P=Math.max(g,I*d);return{verticalLineContentWidth:Math.max(g,w*d),horizontalLineContentHeight:P}}function hB(f){switch(f){case"top":return 0;case"center":return .5;default:return 1}}function nq(f,l,d){return!(f===n.ah.horizontal||!l&&!gl(d)||l&&(v2[d]||(g=d,/\p{sc=Arab}/u.test(String.fromCodePoint(g)))));var g}function sq(f,l,d,g,w,I){let P=I[f.fontStack],D=function(G,$,K,se){if(G&&G.rect)return G;let ce=$[K.fontStack],he=ce&&ce[se];return he?{rect:null,metrics:he.metrics}:null}(P&&P[l],w,f,l);if(D===null)return null;let U;if(d)U=g.verticalLineContentWidth-f.scale*vs;else{let G=hB(f.verticalAlign);U=(g.horizontalLineContentHeight-f.scale*vs)*G}return{rect:D.rect,metrics:D.metrics,baselineOffset:U}}function oq(f,l,d,g,w){let I=w[f.imageName];if(!I)return null;let P=I.paddedRect,D=I.displaySize,U={width:D[0],height:D[1],left:ia,top:-3,advance:l?D[1]:D[0]},G;if(l)G=g.verticalLineContentWidth-D[1]*f.scale;else{let $=hB(f.verticalAlign);G=(g.horizontalLineContentHeight-D[1]*f.scale)*$}return{rect:P,metrics:U,baselineOffset:G,imageOffset:(l?D[0]:D[1])*f.scale-vs*d}}function aq(f,l,d,g){if(g===0)return;let w=f[d],I=(f[d].x+w.metrics.advance*w.scale)*g;for(let P=l;P<=d;P++)f[P].x-=I}function lq(f,l,d){let{horizontalAlign:g,verticalAlign:w}=BE(d),I=l[0]-f.displaySize[0]*g,P=l[1]-f.displaySize[1]*w;return{image:f,top:P,bottom:P+f.displaySize[1],left:I,right:I+f.displaySize[0]}}function fB(f){var l,d;let g=f.left,w=f.top,I=f.right-g,P=f.bottom-w,D=(l=f.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",U=(d=f.image.textFitHeight)!==null&&d!==void 0?d:"stretchOrShrink",G=(f.image.content[2]-f.image.content[0])/(f.image.content[3]-f.image.content[1]);if(U==="proportional"){if(D==="stretchOnly"&&I/P<G||D==="proportional"){let $=Math.ceil(P*G);g*=$/I,I=$}}else if(D==="proportional"&&U==="stretchOnly"&&G!==0&&I/P>G){let $=Math.ceil(I/G);w*=$/P,P=$}return{x1:g,y1:w,x2:g+I,y2:w+P}}function dB(f,l,d,g,w,I){let P=f.image,D;if(P.content){let Ee=P.content,Oe=P.pixelRatio||1;D=[Ee[0]/Oe,Ee[1]/Oe,P.displaySize[0]-Ee[2]/Oe,P.displaySize[1]-Ee[3]/Oe]}let U=l.left*I,G=l.right*I,$,K,se,ce;d==="width"||d==="both"?(ce=w[0]+U-g[3],K=w[0]+G+g[1]):(ce=w[0]+(U+G-P.displaySize[0])/2,K=ce+P.displaySize[0]);let he=l.top*I,me=l.bottom*I;return d==="height"||d==="both"?($=w[1]+he-g[0],se=w[1]+me+g[2]):($=w[1]+(he+me-P.displaySize[1])/2,se=$+P.displaySize[1]),{image:P,top:$,right:K,bottom:se,left:ce,collisionPadding:D}}let s_=255,Au=128,Zf=s_*Au;function pB(f,l){let{expression:d}=l;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new hn(f+1))};if(d.kind==="source")return{kind:"source"};{let{zoomStops:g,interpolationType:w}=d,I=0;for(;I<g.length&&g[I]<=f;)I++;I=Math.max(0,I-1);let P=I;for(;P<g.length&&g[P]<f+1;)P++;P=Math.min(g.length-1,P);let D=g[I],U=g[P];return d.kind==="composite"?{kind:"composite",minZoom:D,maxZoom:U,interpolationType:w}:{kind:"camera",minZoom:D,maxZoom:U,minSize:d.evaluate(new hn(D)),maxSize:d.evaluate(new hn(U)),interpolationType:w}}}function LE(f,l,d){let g="never",w=f.get(l);return w?g=w:f.get(d)&&(g="always"),g}let cq=e_.VectorTileFeature.types,uq=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function w2(f,l,d,g,w,I,P,D,U,G,$,K,se){let ce=D?Math.min(Zf,Math.round(D[0])):0,he=D?Math.min(Zf,Math.round(D[1])):0;f.emplaceBack(l,d,Math.round(32*g),Math.round(32*w),I,P,(ce<<1)+(U?1:0),he,16*G,16*$,256*K,256*se)}function OE(f,l,d){f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d)}function hq(f){for(let l of f.sections)if(Hg(l.text))return!0;return!1}class DE{constructor(l){this.layoutVertexArray=new Pt,this.indexArray=new Ut,this.programConfigurations=l,this.segments=new $r,this.dynamicLayoutVertexArray=new Ot,this.opacityVertexArray=new Tt,this.hasVisibleVertices=!1,this.placedSymbolArray=new Q}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,d,g,w){this.isEmpty()||(g&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,H$.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,W$.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,uq,!0),this.opacityVertexBuffer.itemSize=1),(g||w)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}hr("SymbolBuffers",DE);class FE{constructor(l,d,g){this.layoutVertexArray=new l,this.layoutAttributes=d,this.indexArray=new g,this.segments=new $r,this.collisionVertexArray=new Kt}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,$$.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}hr("CollisionBuffers",FE);class wm{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(P=>P.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=pB(this.zoom,d["text-size"]),this.iconSizeData=pB(this.zoom,d["icon-size"]);let g=this.layers[0].layout,w=g.get("symbol-sort-key"),I=g.get("symbol-z-order");this.canOverlap=LE(g,"text-overlap","text-allow-overlap")!=="never"||LE(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=I!=="viewport-y"&&!w.isConstant(),this.sortFeaturesByY=(I==="viewport-y"||I==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(P=>n.ah[P])),this.stateDependentLayerIds=this.layers.filter(P=>P.isStateDependent()).map(P=>P.id),this.sourceID=l.sourceID}createArrays(){this.text=new DE(new ar(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new DE(new ar(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new de,this.lineVertexArray=new ge,this.symbolInstances=new ie,this.textAnchorOffsets=new Ie}calculateGlyphDependencies(l,d,g,w,I){for(let P=0;P<l.length;P++)if(d[l.charCodeAt(P)]=!0,(g||w)&&I){let D=i_[l.charAt(P)];D&&(d[D.charCodeAt(0)]=!0)}}populate(l,d,g){let w=this.layers[0],I=w.layout,P=I.get("text-font"),D=I.get("text-field"),U=I.get("icon-image"),G=(D.value.kind!=="constant"||D.value.value instanceof co&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),$=U.value.kind!=="constant"||!!U.value.value||Object.keys(U.parameters).length>0,K=I.get("symbol-sort-key");if(this.features=[],!G&&!$)return;let se=d.iconDependencies,ce=d.glyphDependencies,he=d.availableImages,me=new hn(this.zoom);for(let{feature:Ee,id:Oe,index:et,sourceLayerIndex:Ue}of l){let le=w._featureFilter.needGeometry,ve=ni(Ee,le);if(!w._featureFilter.filter(me,ve,g))continue;let We,xt;if(le||(ve.geometry=ri(Ee)),G){let Et=w.getValueAndResolveTokens("text-field",ve,g,he),Rt=co.factory(Et),Yt=this.hasRTLText=this.hasRTLText||hq(Rt);(!Yt||Ha.getRTLTextPluginStatus()==="unavailable"||Yt&&Ha.isParsed())&&(We=Z$(Rt,w,ve))}if($){let Et=w.getValueAndResolveTokens("icon-image",ve,g,he);xt=Et instanceof So?Et:So.fromString(Et)}if(!We&&!xt)continue;let Ht=this.sortFeaturesByKey?K.evaluate(ve,{},g):void 0;if(this.features.push({id:Oe,text:We,icon:xt,index:et,sourceLayerIndex:Ue,geometry:ve.geometry,properties:Ee.properties,type:cq[Ee.type],sortKey:Ht}),xt&&(se[xt.name]=!0),We){let Et=P.evaluate(ve,{},g).join(","),Rt=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(n.ah.vertical)>=0;for(let Yt of We.sections)if(Yt.image)se[Yt.image.name]=!0;else{let qt=uu(We.toString()),Qt=Yt.fontStack||Et,Dt=ce[Qt]=ce[Qt]||{};this.calculateGlyphDependencies(Yt.text,Dt,Rt,this.allowVerticalPlacement,qt)}}}I.get("symbol-placement")==="line"&&(this.features=function(Ee){let Oe={},et={},Ue=[],le=0;function ve(Et){Ue.push(Ee[Et]),le++}function We(Et,Rt,Yt){let qt=et[Et];return delete et[Et],et[Rt]=qt,Ue[qt].geometry[0].pop(),Ue[qt].geometry[0]=Ue[qt].geometry[0].concat(Yt[0]),qt}function xt(Et,Rt,Yt){let qt=Oe[Rt];return delete Oe[Rt],Oe[Et]=qt,Ue[qt].geometry[0].shift(),Ue[qt].geometry[0]=Yt[0].concat(Ue[qt].geometry[0]),qt}function Ht(Et,Rt,Yt){let qt=Yt?Rt[0][Rt[0].length-1]:Rt[0][0];return`${Et}:${qt.x}:${qt.y}`}for(let Et=0;Et<Ee.length;Et++){let Rt=Ee[Et],Yt=Rt.geometry,qt=Rt.text?Rt.text.toString():null;if(!qt){ve(Et);continue}let Qt=Ht(qt,Yt),Dt=Ht(qt,Yt,!0);if(Qt in et&&Dt in Oe&&et[Qt]!==Oe[Dt]){let mr=xt(Qt,Dt,Yt),Or=We(Qt,Dt,Ue[mr].geometry);delete Oe[Qt],delete et[Dt],et[Ht(qt,Ue[Or].geometry,!0)]=Or,Ue[mr].geometry=null}else Qt in et?We(Qt,Dt,Yt):Dt in Oe?xt(Qt,Dt,Yt):(ve(Et),Oe[Qt]=le-1,et[Dt]=le-1)}return Ue.filter(Et=>Et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ee,Oe)=>Ee.sortKey-Oe.sortKey)}update(l,d,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,d,this.layers,g),this.icon.programConfigurations.updatePaintArrays(l,d,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,d){let g=this.lineVertexArray.length;if(l.segment!==void 0){let w=l.dist(d[l.segment+1]),I=l.dist(d[l.segment]),P={};for(let D=l.segment+1;D<d.length;D++)P[D]={x:d[D].x,y:d[D].y,tileUnitDistanceFromAnchor:w},D<d.length-1&&(w+=d[D+1].dist(d[D]));for(let D=l.segment||0;D>=0;D--)P[D]={x:d[D].x,y:d[D].y,tileUnitDistanceFromAnchor:I},D>0&&(I+=d[D-1].dist(d[D]));for(let D=0;D<d.length;D++){let U=P[D];this.lineVertexArray.emplaceBack(U.x,U.y,U.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(l,d,g,w,I,P,D,U,G,$,K,se){let ce=l.indexArray,he=l.layoutVertexArray,me=l.segments.prepareSegment(4*d.length,he,ce,this.canOverlap?P.sortKey:void 0),Ee=this.glyphOffsetArray.length,Oe=me.vertexLength,et=this.allowVerticalPlacement&&D===n.ah.vertical?Math.PI/2:0,Ue=P.text&&P.text.sections;for(let le=0;le<d.length;le++){let{tl:ve,tr:We,bl:xt,br:Ht,tex:Et,pixelOffsetTL:Rt,pixelOffsetBR:Yt,minFontScaleX:qt,minFontScaleY:Qt,glyphOffset:Dt,isSDF:mr,sectionIndex:Or}=d[le],Mr=me.vertexLength,xr=Dt[1];w2(he,U.x,U.y,ve.x,xr+ve.y,Et.x,Et.y,g,mr,Rt.x,Rt.y,qt,Qt),w2(he,U.x,U.y,We.x,xr+We.y,Et.x+Et.w,Et.y,g,mr,Yt.x,Rt.y,qt,Qt),w2(he,U.x,U.y,xt.x,xr+xt.y,Et.x,Et.y+Et.h,g,mr,Rt.x,Yt.y,qt,Qt),w2(he,U.x,U.y,Ht.x,xr+Ht.y,Et.x+Et.w,Et.y+Et.h,g,mr,Yt.x,Yt.y,qt,Qt),OE(l.dynamicLayoutVertexArray,U,et),ce.emplaceBack(Mr,Mr+2,Mr+1),ce.emplaceBack(Mr+1,Mr+2,Mr+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),le!==d.length-1&&Or===d[le+1].sectionIndex||l.programConfigurations.populatePaintArrays(he.length,P,P.index,{},se,Ue&&Ue[Or])}l.placedSymbolArray.emplaceBack(U.x,U.y,Ee,this.glyphOffsetArray.length-Ee,Oe,G,$,U.segment,g?g[0]:0,g?g[1]:0,w[0],w[1],D,0,!1,0,K)}_addCollisionDebugVertex(l,d,g,w,I,P){return d.emplaceBack(0,0),l.emplaceBack(g.x,g.y,w,I,Math.round(P.x),Math.round(P.y))}addCollisionDebugVertices(l,d,g,w,I,P,D){let U=I.segments.prepareSegment(4,I.layoutVertexArray,I.indexArray),G=U.vertexLength,$=I.layoutVertexArray,K=I.collisionVertexArray,se=D.anchorX,ce=D.anchorY;this._addCollisionDebugVertex($,K,P,se,ce,new R(l,d)),this._addCollisionDebugVertex($,K,P,se,ce,new R(g,d)),this._addCollisionDebugVertex($,K,P,se,ce,new R(g,w)),this._addCollisionDebugVertex($,K,P,se,ce,new R(l,w)),U.vertexLength+=4;let he=I.indexArray;he.emplaceBack(G,G+1),he.emplaceBack(G+1,G+2),he.emplaceBack(G+2,G+3),he.emplaceBack(G+3,G),U.primitiveLength+=4}addDebugCollisionBoxes(l,d,g,w){for(let I=l;I<d;I++){let P=this.collisionBoxArray.get(I);this.addCollisionDebugVertices(P.x1,P.y1,P.x2,P.y2,w?this.textCollisionBox:this.iconCollisionBox,P.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new FE(er,tB.members,mt),this.iconCollisionBox=new FE(er,tB.members,mt);for(let l=0;l<this.symbolInstances.length;l++){let d=this.symbolInstances.get(l);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(l,d,g,w,I,P,D,U,G){let $={};for(let K=d;K<g;K++){let se=l.get(K);$.textBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},$.textFeatureIndex=se.featureIndex;break}for(let K=w;K<I;K++){let se=l.get(K);$.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},$.verticalTextFeatureIndex=se.featureIndex;break}for(let K=P;K<D;K++){let se=l.get(K);$.iconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},$.iconFeatureIndex=se.featureIndex;break}for(let K=U;K<G;K++){let se=l.get(K);$.verticalIconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},$.verticalIconFeatureIndex=se.featureIndex;break}return $}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){let g=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,d){let g=l.placedSymbolArray.get(d),w=g.vertexStartIndex+4*g.numGlyphs;for(let I=g.vertexStartIndex;I<w;I+=4)l.indexArray.emplaceBack(I,I+2,I+1),l.indexArray.emplaceBack(I+1,I+2,I+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let d=Math.sin(l),g=Math.cos(l),w=[],I=[],P=[];for(let D=0;D<this.symbolInstances.length;++D){P.push(D);let U=this.symbolInstances.get(D);w.push(0|Math.round(d*U.anchorX+g*U.anchorY)),I.push(U.featureIndex)}return P.sort((D,U)=>w[D]-w[U]||I[U]-I[D]),P}addToSortKeyRanges(l,d){let g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===d?g.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let d of this.symbolInstanceIndexes){let g=this.symbolInstances.get(d);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((w,I,P)=>{w>=0&&P.indexOf(w)===I&&this.addIndicesForPlacedSymbol(this.text,w)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let AB,mB;hr("SymbolBucket",wm,{omit:["layers","collisionBoxArray","features","compareText"]}),wm.MAX_GLYPHS=65535,wm.addDynamicAttributes=OE;var kE={get paint(){return mB=mB||new po({"icon-opacity":new Lr(ue.paint_symbol["icon-opacity"]),"icon-color":new Lr(ue.paint_symbol["icon-color"]),"icon-halo-color":new Lr(ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new Lr(ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Lr(ue.paint_symbol["icon-halo-blur"]),"icon-translate":new br(ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new br(ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new Lr(ue.paint_symbol["text-opacity"]),"text-color":new Lr(ue.paint_symbol["text-color"],{runtimeType:Vr,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new Lr(ue.paint_symbol["text-halo-color"]),"text-halo-width":new Lr(ue.paint_symbol["text-halo-width"]),"text-halo-blur":new Lr(ue.paint_symbol["text-halo-blur"]),"text-translate":new br(ue.paint_symbol["text-translate"]),"text-translate-anchor":new br(ue.paint_symbol["text-translate-anchor"])})},get layout(){return AB=AB||new po({"symbol-placement":new br(ue.layout_symbol["symbol-placement"]),"symbol-spacing":new br(ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new br(ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Lr(ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new br(ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new br(ue.layout_symbol["icon-allow-overlap"]),"icon-overlap":new br(ue.layout_symbol["icon-overlap"]),"icon-ignore-placement":new br(ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new br(ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new br(ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new Lr(ue.layout_symbol["icon-size"]),"icon-text-fit":new br(ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new br(ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new Lr(ue.layout_symbol["icon-image"]),"icon-rotate":new Lr(ue.layout_symbol["icon-rotate"]),"icon-padding":new Lr(ue.layout_symbol["icon-padding"]),"icon-keep-upright":new br(ue.layout_symbol["icon-keep-upright"]),"icon-offset":new Lr(ue.layout_symbol["icon-offset"]),"icon-anchor":new Lr(ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new br(ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new br(ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new br(ue.layout_symbol["text-rotation-alignment"]),"text-field":new Lr(ue.layout_symbol["text-field"]),"text-font":new Lr(ue.layout_symbol["text-font"]),"text-size":new Lr(ue.layout_symbol["text-size"]),"text-max-width":new Lr(ue.layout_symbol["text-max-width"]),"text-line-height":new br(ue.layout_symbol["text-line-height"]),"text-letter-spacing":new Lr(ue.layout_symbol["text-letter-spacing"]),"text-justify":new Lr(ue.layout_symbol["text-justify"]),"text-radial-offset":new Lr(ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new br(ue.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Lr(ue.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Lr(ue.layout_symbol["text-anchor"]),"text-max-angle":new br(ue.layout_symbol["text-max-angle"]),"text-writing-mode":new br(ue.layout_symbol["text-writing-mode"]),"text-rotate":new Lr(ue.layout_symbol["text-rotate"]),"text-padding":new br(ue.layout_symbol["text-padding"]),"text-keep-upright":new br(ue.layout_symbol["text-keep-upright"]),"text-transform":new Lr(ue.layout_symbol["text-transform"]),"text-offset":new Lr(ue.layout_symbol["text-offset"]),"text-allow-overlap":new br(ue.layout_symbol["text-allow-overlap"]),"text-overlap":new br(ue.layout_symbol["text-overlap"]),"text-ignore-placement":new br(ue.layout_symbol["text-ignore-placement"]),"text-optional":new br(ue.layout_symbol["text-optional"])})}};class gB{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:_i,this.defaultValue=l}evaluate(l){if(l.formattedSection){let d=this.defaultValue.property.overrides;if(d&&d.hasOverride(l.formattedSection))return d.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hr("FormatSectionOverride",gB,{omit:["defaultValue"]});class T2 extends Bn{constructor(l){super(l,kE)}recalculate(l,d){if(super.recalculate(l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let g=this.layout.get("text-writing-mode");if(g){let w=[];for(let I of g)w.indexOf(I)<0&&w.push(I);this.layout._values["text-writing-mode"]=w}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,d,g,w){let I=this.layout.get(l).evaluate(d,{},g,w),P=this._unevaluatedLayout._values[l];return P.isDataDriven()||mh(P.value)||!I?I:function(D,U){return U.replace(/{([^{}]+)}/g,(G,$)=>D&&$ in D?String(D[$]):"")}(d.properties,I)}createBucket(l){return new wm(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let l of kE.paint.overridableProperties){if(!T2.hasPaintOverride(this.layout,l))continue;let d=this.paint.get(l),g=new gB(d),w=new ru(g,d.property.specification),I=null;I=d.value.kind==="constant"||d.value.kind==="source"?new Rf("source",w):new iu("composite",w,d.value.zoomStops),this.paint._values[l]=new Ca(d.property,I,d.parameters)}}_handleOverridablePaintPropertyUpdate(l,d,g){return!(!this.layout||d.isDataDriven()||g.isDataDriven())&&T2.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,d){let g=l.get("text-field"),w=kE.paint.properties[d],I=!1,P=D=>{for(let U of D)if(w.overrides&&w.overrides.hasOverride(U))return void(I=!0)};if(g.value.kind==="constant"&&g.value.value instanceof co)P(g.value.value.sections);else if(g.value.kind==="source"){let D=G=>{I||(G instanceof Yl&&vn(G.value)===rn?P(G.value.sections):G instanceof Na?P(G.sections):G.eachChild(D))},U=g.value;U._styleExpression&&D(U._styleExpression.expression)}return I}}let _B;var fq={get paint(){return _B=_B||new po({"background-color":new br(ue.paint_background["background-color"]),"background-pattern":new gp(ue.paint_background["background-pattern"]),"background-opacity":new br(ue.paint_background["background-opacity"])})}};class dq extends Bn{constructor(l){super(l,fq)}}let yB;var pq={get paint(){return yB=yB||new po({"raster-opacity":new br(ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new br(ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new br(ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new br(ue.paint_raster["raster-brightness-max"]),"raster-saturation":new br(ue.paint_raster["raster-saturation"]),"raster-contrast":new br(ue.paint_raster["raster-contrast"]),"raster-resampling":new br(ue.paint_raster["raster-resampling"]),"raster-fade-duration":new br(ue.paint_raster["raster-fade-duration"])})}};class Aq extends Bn{constructor(l){super(l,pq)}}class mq extends Bn{constructor(l){super(l,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class gq{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let _q={once:!0},NE=63710088e-1;class Xf{constructor(l,d){if(isNaN(l)||isNaN(d))throw new Error(`Invalid LngLat object: (${l}, ${d})`);if(this.lng=+l,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xf(cr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){let d=Math.PI/180,g=this.lat*d,w=l.lat*d,I=Math.sin(g)*Math.sin(w)+Math.cos(g)*Math.cos(w)*Math.cos((l.lng-this.lng)*d);return NE*Math.acos(Math.min(I,1))}static convert(l){if(l instanceof Xf)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Xf(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Xf(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let xB=2*Math.PI*NE;function bB(f){return xB*Math.cos(f*Math.PI/180)}function vB(f){return(180+f)/360}function wB(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function TB(f,l){return f/bB(l)}function zE(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}function EB(f,l){return f*bB(zE(l))}class o_{constructor(l,d,g=0){this.x=+l,this.y=+d,this.z=+g}static fromLngLat(l,d=0){let g=Xf.convert(l);return new o_(vB(g.lng),wB(g.lat),TB(d,g.lat))}toLngLat(){return new Xf(360*this.x-180,zE(this.y))}toAltitude(){return EB(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xB*(l=zE(this.y),1/Math.cos(l*Math.PI/180));var l}}function CB(f,l,d){var g=2*Math.PI*6378137/256/Math.pow(2,d);return[f*g-2*Math.PI*6378137/2,l*g-2*Math.PI*6378137/2]}class UE{constructor(l,d,g){if(!function(w,I,P){return!(w<0||w>25||P<0||P>=Math.pow(2,w)||I<0||I>=Math.pow(2,w))}(l,d,g))throw new Error(`x=${d}, y=${g}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=d,this.y=g,this.key=Tm(0,l,l,d,g)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,d,g){let w=(P=this.y,D=this.z,U=CB(256*(I=this.x),256*(P=Math.pow(2,D)-P-1),D),G=CB(256*(I+1),256*(P+1),D),U[0]+","+U[1]+","+G[0]+","+G[1]);var I,P,D,U,G;let $=function(K,se,ce){let he,me="";for(let Ee=K;Ee>0;Ee--)he=1<<Ee-1,me+=(se&he?1:0)+(ce&he?2:0);return me}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,$).replace(/{bbox-epsg-3857}/g,w)}isChildOf(l){let d=this.z-l.z;return d>0&&l.x===this.x>>d&&l.y===this.y>>d}getTilePoint(l){let d=Math.pow(2,this.z);return new R((l.x*d-this.x)*Se,(l.y*d-this.y)*Se)}toString(){return`${this.z}/${this.x}/${this.y}`}}class SB{constructor(l,d){this.wrap=l,this.canonical=d,this.key=Tm(l,d.z,d.z,d.x,d.y)}}class $a{constructor(l,d,g,w,I){if(this.terrainRttPosMatrix32f=null,l<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${g}`);this.overscaledZ=l,this.wrap=d,this.canonical=new UE(g,+w,+I),this.key=Tm(d,l,g,w,I)}clone(){return new $a(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);let d=this.canonical.z-l;return l>this.canonical.z?new $a(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $a(l,this.wrap,l,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(l,d){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);let g=this.canonical.z-l;return l>this.canonical.z?Tm(this.wrap*+d,l,this.canonical.z,this.canonical.x,this.canonical.y):Tm(this.wrap*+d,l,l,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(l){if(l.wrap!==this.wrap)return!1;let d=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>d&&l.canonical.y===this.canonical.y>>d}children(l){if(this.overscaledZ>=l)return[new $a(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let d=this.canonical.z+1,g=2*this.canonical.x,w=2*this.canonical.y;return[new $a(d,this.wrap,d,g,w),new $a(d,this.wrap,d,g+1,w),new $a(d,this.wrap,d,g,w+1),new $a(d,this.wrap,d,g+1,w+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new $a(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new $a(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new SB(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new o_(l.x-this.wrap,l.y))}}function Tm(f,l,d,g,w){(f*=2)<0&&(f=-1*f-1);let I=1<<d;return(I*I*f+I*w+g).toString(36)+d.toString(36)+l.toString(36)}hr("CanonicalTileID",UE),hr("OverscaledTileID",$a,{omit:["terrainRttPosMatrix32f"]});class IB{constructor(l,d,g,w=1,I=1,P=1,D=0){if(this.uid=l,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void Ai(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=d.height;let U=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=w,this.greenFactor=I,this.blueFactor=P,this.baseShift=D;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let G=0;G<U;G++)this.data[this._idx(-1,G)]=this.data[this._idx(0,G)],this.data[this._idx(U,G)]=this.data[this._idx(U-1,G)],this.data[this._idx(G,-1)]=this.data[this._idx(G,0)],this.data[this._idx(G,U)]=this.data[this._idx(G,U-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(U,-1)]=this.data[this._idx(U-1,0)],this.data[this._idx(-1,U)]=this.data[this._idx(0,U-1)],this.data[this._idx(U,U)]=this.data[this._idx(U-1,U-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let G=0;G<U;G++)for(let $=0;$<U;$++){let K=this.get(G,$);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(l,d){let g=new Uint8Array(this.data.buffer),w=4*this._idx(l,d);return this.unpack(g[w],g[w+1],g[w+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,d){if(l<-1||l>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(l+1)}unpack(l,d,g){return l*this.redFactor+d*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new Wa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,d,g){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let w=d*this.dim,I=d*this.dim+this.dim,P=g*this.dim,D=g*this.dim+this.dim;switch(d){case-1:w=I-1;break;case 1:I=w+1}switch(g){case-1:P=D-1;break;case 1:D=P+1}let U=-d*this.dim,G=-g*this.dim;for(let $=P;$<D;$++)for(let K=w;K<I;K++)this.data[this._idx(K,$)]=l.data[this._idx(K+U,$+G)]}}hr("DEMData",IB);class MB{constructor(l){this._stringToNumber={},this._numberToString=[];for(let d=0;d<l.length;d++){let g=l[d];this._stringToNumber[g]=d,this._numberToString[d]=g}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class PB{constructor(l,d,g,w,I){this.type="Feature",this._vectorTileFeature=l,l._z=d,l._x=g,l._y=w,this.properties=l.properties,this.id=I}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){let l={geometry:this.geometry};for(let d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(l[d]=this[d]);return l}}class RB{constructor(l,d){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new xh(Se,16,0),this.grid3D=new xh(Se,16,0),this.featureIndexArray=new Ne,this.promoteId=d}insert(l,d,g,w,I,P){let D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,w,I);let U=P?this.grid3D:this.grid;for(let G=0;G<d.length;G++){let $=d[G],K=[1/0,1/0,-1/0,-1/0];for(let se=0;se<$.length;se++){let ce=$[se];K[0]=Math.min(K[0],ce.x),K[1]=Math.min(K[1],ce.y),K[2]=Math.max(K[2],ce.x),K[3]=Math.max(K[3],ce.y)}K[0]<Se&&K[1]<Se&&K[2]>=0&&K[3]>=0&&U.insert(D,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new e_.VectorTile(new IE(this.rawTileData)).layers,this.sourceLayerCoder=new MB(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,d,g,w){this.loadVTLayers();let I=l.params,P=Se/l.tileSize/l.scale,D=Ta(I.filter),U=l.queryGeometry,G=l.queryPadding*P,$=LB(U),K=this.grid.query($.minX-G,$.minY-G,$.maxX+G,$.maxY+G),se=LB(l.cameraQueryGeometry),ce=this.grid3D.query(se.minX-G,se.minY-G,se.maxX+G,se.maxY+G,(Ee,Oe,et,Ue)=>function(le,ve,We,xt,Ht){for(let Rt of le)if(ve<=Rt.x&&We<=Rt.y&&xt>=Rt.x&&Ht>=Rt.y)return!0;let Et=[new R(ve,We),new R(ve,Ht),new R(xt,Ht),new R(xt,We)];if(le.length>2){for(let Rt of Et)if(wp(le,Rt))return!0}for(let Rt=0;Rt<le.length-1;Rt++)if(o$(le[Rt],le[Rt+1],Et))return!0;return!1}(l.cameraQueryGeometry,Ee-G,Oe-G,et+G,Ue+G));for(let Ee of ce)K.push(Ee);K.sort(yq);let he={},me;for(let Ee=0;Ee<K.length;Ee++){let Oe=K[Ee];if(Oe===me)continue;me=Oe;let et=this.featureIndexArray.get(Oe),Ue=null;this.loadMatchingFeature(he,et.bucketIndex,et.sourceLayerIndex,et.featureIndex,D,I.layers,I.availableImages,d,g,w,(le,ve,We)=>(Ue||(Ue=ri(le)),ve.queryIntersectsFeature({queryGeometry:U,feature:le,featureState:We,geometry:Ue,zoom:this.z,transform:l.transform,pixelsToTileUnits:P,pixelPosMatrix:l.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:l.getElevation})))}return he}loadMatchingFeature(l,d,g,w,I,P,D,U,G,$,K){let se=this.bucketLayerIDs[d];if(P&&!se.some(Ee=>P.has(Ee)))return;let ce=this.sourceLayerCoder.decode(g),he=this.vtLayers[ce].feature(w);if(I.needGeometry){let Ee=ni(he,!0);if(!I.filter(new hn(this.tileID.overscaledZ),Ee,this.tileID.canonical))return}else if(!I.filter(new hn(this.tileID.overscaledZ),he))return;let me=this.getId(he,ce);for(let Ee=0;Ee<se.length;Ee++){let Oe=se[Ee];if(P&&!P.has(Oe))continue;let et=U[Oe];if(!et)continue;let Ue={};me&&$&&(Ue=$.getState(et.sourceLayer||"_geojsonTileLayer",me));let le=Wt({},G[Oe]);le.paint=BB(le.paint,et.paint,he,Ue,D),le.layout=BB(le.layout,et.layout,he,Ue,D);let ve=!K||K(he,et,Ue);if(!ve)continue;let We=new PB(he,this.z,this.x,this.y,me);We.layer=le;let xt=l[Oe];xt===void 0&&(xt=l[Oe]=[]),xt.push({featureIndex:w,feature:We,intersectionZ:ve})}}lookupSymbolFeatures(l,d,g,w,I,P,D,U){let G={};this.loadVTLayers();let $=Ta(I);for(let K of l)this.loadMatchingFeature(G,g,w,K,$,P,D,U,d);return G}hasLayer(l){for(let d of this.bucketLayerIDs)for(let g of d)if(l===g)return!0;return!1}getId(l,d){var g;let w=l.id;return this.promoteId&&(w=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof w=="boolean"&&(w=Number(w)),w===void 0&&(!((g=l.properties)===null||g===void 0)&&g.cluster)&&this.promoteId&&(w=Number(l.properties.cluster_id))),w}}function BB(f,l,d,g,w){return vr(f,(I,P)=>{let D=l instanceof wh?l.get(P):null;return D&&D.evaluate?D.evaluate(d,g,w):D})}function LB(f){let l=1/0,d=1/0,g=-1/0,w=-1/0;for(let I of f)l=Math.min(l,I.x),d=Math.min(d,I.y),g=Math.max(g,I.x),w=Math.max(w,I.y);return{minX:l,minY:d,maxX:g,maxY:w}}function yq(f,l){return l-f}function OB(f,l,d,g,w){let I=[];for(let P=0;P<f.length;P++){let D=f[P],U;for(let G=0;G<D.length-1;G++){let $=D[G],K=D[G+1];$.x<l&&K.x<l||($.x<l?$=new R(l,$.y+(l-$.x)/(K.x-$.x)*(K.y-$.y))._round():K.x<l&&(K=new R(l,$.y+(l-$.x)/(K.x-$.x)*(K.y-$.y))._round()),$.y<d&&K.y<d||($.y<d?$=new R($.x+(d-$.y)/(K.y-$.y)*(K.x-$.x),d)._round():K.y<d&&(K=new R($.x+(d-$.y)/(K.y-$.y)*(K.x-$.x),d)._round()),$.x>=g&&K.x>=g||($.x>=g?$=new R(g,$.y+(g-$.x)/(K.x-$.x)*(K.y-$.y))._round():K.x>=g&&(K=new R(g,$.y+(g-$.x)/(K.x-$.x)*(K.y-$.y))._round()),$.y>=w&&K.y>=w||($.y>=w?$=new R($.x+(w-$.y)/(K.y-$.y)*(K.x-$.x),w)._round():K.y>=w&&(K=new R($.x+(w-$.y)/(K.y-$.y)*(K.x-$.x),w)._round()),U&&$.equals(U[U.length-1])||(U=[$],I.push(U)),U.push(K)))))}}return I}hr("FeatureIndex",RB,{omit:["rawTileData","sourceLayerCoder"]});class Yf extends R{constructor(l,d,g,w){super(l,d),this.angle=g,w!==void 0&&(this.segment=w)}clone(){return new Yf(this.x,this.y,this.angle,this.segment)}}function DB(f,l,d,g,w){if(l.segment===void 0||d===0)return!0;let I=l,P=l.segment+1,D=0;for(;D>-d/2;){if(P--,P<0)return!1;D-=f[P].dist(I),I=f[P]}D+=f[P].dist(f[P+1]),P++;let U=[],G=0;for(;D<d/2;){let $=f[P],K=f[P+1];if(!K)return!1;let se=f[P-1].angleTo($)-$.angleTo(K);for(se=Math.abs((se+3*Math.PI)%(2*Math.PI)-Math.PI),U.push({distance:D,angleDelta:se}),G+=se;D-U[0].distance>g;)G-=U.shift().angleDelta;if(G>w)return!1;P++,D+=$.dist(K)}return!0}function FB(f){let l=0;for(let d=0;d<f.length-1;d++)l+=f[d].dist(f[d+1]);return l}function kB(f,l,d){return f?.6*l*d:0}function NB(f,l){return Math.max(f?f.right-f.left:0,l?l.right-l.left:0)}function xq(f,l,d,g,w,I){let P=kB(d,w,I),D=NB(d,g)*I,U=0,G=FB(f)/2;for(let $=0;$<f.length-1;$++){let K=f[$],se=f[$+1],ce=K.dist(se);if(U+ce>G){let he=(G-U)/ce,me=ya.number(K.x,se.x,he),Ee=ya.number(K.y,se.y,he),Oe=new Yf(me,Ee,se.angleTo(K),$);return Oe._round(),!P||DB(f,Oe,D,P,l)?Oe:void 0}U+=ce}}function bq(f,l,d,g,w,I,P,D,U){let G=kB(g,I,P),$=NB(g,w),K=$*P,se=f[0].x===0||f[0].x===U||f[0].y===0||f[0].y===U;return l-K<l/4&&(l=K+l/4),zB(f,se?l/2*D%l:($/2+2*I)*P*D%l,l,G,d,K,se,!1,U)}function zB(f,l,d,g,w,I,P,D,U){let G=I/2,$=FB(f),K=0,se=l-d,ce=[];for(let he=0;he<f.length-1;he++){let me=f[he],Ee=f[he+1],Oe=me.dist(Ee),et=Ee.angleTo(me);for(;se+d<K+Oe;){se+=d;let Ue=(se-K)/Oe,le=ya.number(me.x,Ee.x,Ue),ve=ya.number(me.y,Ee.y,Ue);if(le>=0&&le<U&&ve>=0&&ve<U&&se-G>=0&&se+G<=$){let We=new Yf(le,ve,et,he);We._round(),g&&!DB(f,We,I,g,w)||ce.push(We)}}K+=Oe}return D||ce.length||P||(ce=zB(f,K/2,d,g,w,I,P,!0,U)),ce}hr("Anchor",Yf);let a_=ia;function UB(f,l,d,g){let w=[],I=f.image,P=I.pixelRatio,D=I.paddedRect.w-2*a_,U=I.paddedRect.h-2*a_,G={x1:f.left,y1:f.top,x2:f.right,y2:f.bottom},$=I.stretchX||[[0,D]],K=I.stretchY||[[0,U]],se=(Dt,mr)=>Dt+mr[1]-mr[0],ce=$.reduce(se,0),he=K.reduce(se,0),me=D-ce,Ee=U-he,Oe=0,et=ce,Ue=0,le=he,ve=0,We=me,xt=0,Ht=Ee;if(I.content&&g){let Dt=I.content,mr=Dt[2]-Dt[0],Or=Dt[3]-Dt[1];(I.textFitWidth||I.textFitHeight)&&(G=fB(f)),Oe=E2($,0,Dt[0]),Ue=E2(K,0,Dt[1]),et=E2($,Dt[0],Dt[2]),le=E2(K,Dt[1],Dt[3]),ve=Dt[0]-Oe,xt=Dt[1]-Ue,We=mr-et,Ht=Or-le}let Et=G.x1,Rt=G.y1,Yt=G.x2-Et,qt=G.y2-Rt,Qt=(Dt,mr,Or,Mr)=>{let xr=C2(Dt.stretch-Oe,et,Yt,Et),xi=S2(Dt.fixed-ve,We,Dt.stretch,ce),$n=C2(mr.stretch-Ue,le,qt,Rt),ws=S2(mr.fixed-xt,Ht,mr.stretch,he),mo=C2(Or.stretch-Oe,et,Yt,Et),qa=S2(Or.fixed-ve,We,Or.stretch,ce),na=C2(Mr.stretch-Ue,le,qt,Rt),Qs=S2(Mr.fixed-xt,Ht,Mr.stretch,he),jn=new R(xr,$n),zs=new R(mo,$n),Js=new R(mo,na),eo=new R(xr,na),Vo=new R(xi/P,ws/P),Za=new R(qa/P,Qs/P),Us=l*Math.PI/180;if(Us){let Vs=Math.sin(Us),js=Math.cos(Us),ds=[js,-Vs,Vs,js];jn._matMult(ds),zs._matMult(ds),eo._matMult(ds),Js._matMult(ds)}let sa=Dt.stretch+Dt.fixed,Ts=mr.stretch+mr.fixed;return{tl:jn,tr:zs,bl:eo,br:Js,tex:{x:I.paddedRect.x+a_+sa,y:I.paddedRect.y+a_+Ts,w:Or.stretch+Or.fixed-sa,h:Mr.stretch+Mr.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vo,pixelOffsetBR:Za,minFontScaleX:We/P/Yt,minFontScaleY:Ht/P/qt,isSDF:d}};if(g&&(I.stretchX||I.stretchY)){let Dt=VB($,me,ce),mr=VB(K,Ee,he);for(let Or=0;Or<Dt.length-1;Or++){let Mr=Dt[Or],xr=Dt[Or+1];for(let xi=0;xi<mr.length-1;xi++)w.push(Qt(Mr,mr[xi],xr,mr[xi+1]))}}else w.push(Qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:U+1}));return w}function E2(f,l,d){let g=0;for(let w of f)g+=Math.max(l,Math.min(d,w[1]))-Math.max(l,Math.min(d,w[0]));return g}function VB(f,l,d){let g=[{fixed:-1,stretch:0}];for(let[w,I]of f){let P=g[g.length-1];g.push({fixed:w-P.stretch,stretch:P.stretch}),g.push({fixed:w-P.stretch,stretch:P.stretch+(I-w)})}return g.push({fixed:l+a_,stretch:d}),g}function C2(f,l,d,g){return f/l*d+g}function S2(f,l,d,g){return f-l*d/g}class I2{constructor(l,d,g,w,I,P,D,U,G,$){var K;if(this.boxStartIndex=l.length,G){let se=P.top,ce=P.bottom,he=P.collisionPadding;he&&(se-=he[1],ce+=he[3]);let me=ce-se;me>0&&(me=Math.max(10,me),this.circleDiameter=me)}else{let se=!((K=P.image)===null||K===void 0)&&K.content&&(P.image.textFitWidth||P.image.textFitHeight)?fB(P):{x1:P.left,y1:P.top,x2:P.right,y2:P.bottom};se.y1=se.y1*D-U[0],se.y2=se.y2*D+U[2],se.x1=se.x1*D-U[3],se.x2=se.x2*D+U[1];let ce=P.collisionPadding;if(ce&&(se.x1-=ce[0]*D,se.y1-=ce[1]*D,se.x2+=ce[2]*D,se.y2+=ce[3]*D),$){let he=new R(se.x1,se.y1),me=new R(se.x2,se.y1),Ee=new R(se.x1,se.y2),Oe=new R(se.x2,se.y2),et=$*Math.PI/180;he._rotate(et),me._rotate(et),Ee._rotate(et),Oe._rotate(et),se.x1=Math.min(he.x,me.x,Ee.x,Oe.x),se.x2=Math.max(he.x,me.x,Ee.x,Oe.x),se.y1=Math.min(he.y,me.y,Ee.y,Oe.y),se.y2=Math.max(he.y,me.y,Ee.y,Oe.y)}l.emplaceBack(d.x,d.y,se.x1,se.y1,se.x2,se.y2,g,w,I)}this.boxEndIndex=l.length}}class vq{constructor(l=[],d=(g,w)=>g<w?-1:g>w?1:0){if(this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;let l=this.data[0],d=this.data.pop();return--this.length>0&&(this.data[0]=d,this._down(0)),l}peek(){return this.data[0]}_up(l){let{data:d,compare:g}=this,w=d[l];for(;l>0;){let I=l-1>>1,P=d[I];if(g(w,P)>=0)break;d[l]=P,l=I}d[l]=w}_down(l){let{data:d,compare:g}=this,w=this.length>>1,I=d[l];for(;l<w;){let P=1+(l<<1),D=P+1;if(D<this.length&&g(d[D],d[P])<0&&(P=D),g(d[P],I)>=0)break;d[l]=d[P],l=P}d[l]=I}}function wq(f,l=1,d=!1){let g=1/0,w=1/0,I=-1/0,P=-1/0,D=f[0];for(let ce=0;ce<D.length;ce++){let he=D[ce];(!ce||he.x<g)&&(g=he.x),(!ce||he.y<w)&&(w=he.y),(!ce||he.x>I)&&(I=he.x),(!ce||he.y>P)&&(P=he.y)}let U=Math.min(I-g,P-w),G=U/2,$=new vq([],Tq);if(U===0)return new R(g,w);for(let ce=g;ce<I;ce+=U)for(let he=w;he<P;he+=U)$.push(new Em(ce+G,he+G,G,f));let K=function(ce){let he=0,me=0,Ee=0,Oe=ce[0];for(let et=0,Ue=Oe.length,le=Ue-1;et<Ue;le=et++){let ve=Oe[et],We=Oe[le],xt=ve.x*We.y-We.x*ve.y;me+=(ve.x+We.x)*xt,Ee+=(ve.y+We.y)*xt,he+=3*xt}return new Em(me/he,Ee/he,0,ce)}(f),se=$.length;for(;$.length;){let ce=$.pop();(ce.d>K.d||!K.d)&&(K=ce,d&&console.log("found best %d after %d probes",Math.round(1e4*ce.d)/1e4,se)),ce.max-K.d<=l||(G=ce.h/2,$.push(new Em(ce.p.x-G,ce.p.y-G,G,f)),$.push(new Em(ce.p.x+G,ce.p.y-G,G,f)),$.push(new Em(ce.p.x-G,ce.p.y+G,G,f)),$.push(new Em(ce.p.x+G,ce.p.y+G,G,f)),se+=4)}return d&&(console.log(`num probes: ${se}`),console.log(`best distance: ${K.d}`)),K.p}function Tq(f,l){return l.max-f.max}function Em(f,l,d,g){this.p=new R(f,l),this.h=d,this.d=function(w,I){let P=!1,D=1/0;for(let U=0;U<I.length;U++){let G=I[U];for(let $=0,K=G.length,se=K-1;$<K;se=$++){let ce=G[$],he=G[se];ce.y>w.y!=he.y>w.y&&w.x<(he.x-ce.x)*(w.y-ce.y)/(he.y-ce.y)+ce.x&&(P=!P),D=Math.min(D,bR(w,ce,he))}}return(P?1:-1)*Math.sqrt(D)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var Ao;n.ay=void 0,(Ao=n.ay||(n.ay={}))[Ao.center=1]="center",Ao[Ao.left=2]="left",Ao[Ao.right=3]="right",Ao[Ao.top=4]="top",Ao[Ao.bottom=5]="bottom",Ao[Ao["top-left"]=6]="top-left",Ao[Ao["top-right"]=7]="top-right",Ao[Ao["bottom-left"]=8]="bottom-left",Ao[Ao["bottom-right"]=9]="bottom-right";let Kf=7,VE=Number.POSITIVE_INFINITY;function jB(f,l){return l[1]!==VE?function(d,g,w){let I=0,P=0;switch(g=Math.abs(g),w=Math.abs(w),d){case"top-right":case"top-left":case"top":P=w-Kf;break;case"bottom-right":case"bottom-left":case"bottom":P=-w+Kf}switch(d){case"top-right":case"bottom-right":case"right":I=-g;break;case"top-left":case"bottom-left":case"left":I=g}return[I,P]}(f,l[0],l[1]):function(d,g){let w=0,I=0;g<0&&(g=0);let P=g/Math.SQRT2;switch(d){case"top-right":case"top-left":I=P-Kf;break;case"bottom-right":case"bottom-left":I=-P+Kf;break;case"bottom":I=-g+Kf;break;case"top":I=g-Kf}switch(d){case"top-right":case"bottom-right":w=-P;break;case"top-left":case"bottom-left":w=P;break;case"left":w=g;break;case"right":w=-g}return[w,I]}(f,l[0])}function GB(f,l,d){var g;let w=f.layout,I=(g=w.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(l,{},d);if(I){let D=I.values,U=[];for(let G=0;G<D.length;G+=2){let $=U[G]=D[G],K=D[G+1].map(se=>se*vs);$.startsWith("top")?K[1]-=Kf:$.startsWith("bottom")&&(K[1]+=Kf),U[G+1]=K}return new uo(U)}let P=w.get("text-variable-anchor");if(P){let D;D=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[w.get("text-radial-offset").evaluate(l,{},d)*vs,VE]:w.get("text-offset").evaluate(l,{},d).map(G=>G*vs);let U=[];for(let G of P)U.push(G,jB(G,D));return new uo(U)}return null}function jE(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Eq(f,l,d,g,w,I,P,D,U,G,$,K){let se=I.textMaxSize.evaluate(l,{});se===void 0&&(se=P);let ce=f.layers[0].layout,he=ce.get("icon-offset").evaluate(l,{},$),me=WB(d.horizontal),Ee=P/24,Oe=f.tilePixelRatio*Ee,et=f.tilePixelRatio*se/24,Ue=f.tilePixelRatio*D,le=f.tilePixelRatio*ce.get("symbol-spacing"),ve=ce.get("text-padding")*f.tilePixelRatio,We=function(Or,Mr,xr,xi=1){let $n=Or.get("icon-padding").evaluate(Mr,{},xr),ws=$n&&$n.values;return[ws[0]*xi,ws[1]*xi,ws[2]*xi,ws[3]*xi]}(ce,l,$,f.tilePixelRatio),xt=ce.get("text-max-angle")/180*Math.PI,Ht=ce.get("text-rotation-alignment")!=="viewport"&&ce.get("symbol-placement")!=="point",Et=ce.get("icon-rotation-alignment")==="map"&&ce.get("symbol-placement")!=="point",Rt=ce.get("symbol-placement"),Yt=le/2,qt=ce.get("icon-text-fit"),Qt;g&&qt!=="none"&&(f.allowVerticalPlacement&&d.vertical&&(Qt=dB(g,d.vertical,qt,ce.get("icon-text-fit-padding"),he,Ee)),me&&(g=dB(g,me,qt,ce.get("icon-text-fit-padding"),he,Ee)));let Dt=$?K.line.getGranularityForZoomLevel($.z):1,mr=(Or,Mr)=>{Mr.x<0||Mr.x>=Se||Mr.y<0||Mr.y>=Se||function(xr,xi,$n,ws,mo,qa,na,Qs,jn,zs,Js,eo,Vo,Za,Us,sa,Ts,Vs,js,ds,Tn,mc,Cm,gc,Iq){let Sm=xr.addToLineVertexArray(xi,$n),Cp,Im,Mm,Pm,XB=0,YB=0,KB=0,QB=0,YE=-1,KE=-1,Ih={},JB=M("");if(xr.allowVerticalPlacement&&ws.vertical){let Bo=Qs.layout.get("text-rotate").evaluate(Tn,{},gc)+90;Mm=new I2(jn,xi,zs,Js,eo,ws.vertical,Vo,Za,Us,Bo),na&&(Pm=new I2(jn,xi,zs,Js,eo,na,Ts,Vs,Us,Bo))}if(mo){let Bo=Qs.layout.get("icon-rotate").evaluate(Tn,{}),Xa=Qs.layout.get("icon-text-fit")!=="none",Sp=UB(mo,Bo,Cm,Xa),yc=na?UB(na,Bo,Cm,Xa):void 0;Im=new I2(jn,xi,zs,Js,eo,mo,Ts,Vs,!1,Bo),XB=4*Sp.length;let Ip=xr.iconSizeData,mu=null;Ip.kind==="source"?(mu=[Au*Qs.layout.get("icon-size").evaluate(Tn,{})],mu[0]>Zf&&Ai(`${xr.layerIds[0]}: Value for "icon-size" is >= ${s_}. Reduce your "icon-size".`)):Ip.kind==="composite"&&(mu=[Au*mc.compositeIconSizes[0].evaluate(Tn,{},gc),Au*mc.compositeIconSizes[1].evaluate(Tn,{},gc)],(mu[0]>Zf||mu[1]>Zf)&&Ai(`${xr.layerIds[0]}: Value for "icon-size" is >= ${s_}. Reduce your "icon-size".`)),xr.addSymbols(xr.icon,Sp,mu,ds,js,Tn,n.ah.none,xi,Sm.lineStartIndex,Sm.lineLength,-1,gc),YE=xr.icon.placedSymbolArray.length-1,yc&&(YB=4*yc.length,xr.addSymbols(xr.icon,yc,mu,ds,js,Tn,n.ah.vertical,xi,Sm.lineStartIndex,Sm.lineLength,-1,gc),KE=xr.icon.placedSymbolArray.length-1)}let e6=Object.keys(ws.horizontal);for(let Bo of e6){let Xa=ws.horizontal[Bo];if(!Cp){JB=M(Xa.text);let yc=Qs.layout.get("text-rotate").evaluate(Tn,{},gc);Cp=new I2(jn,xi,zs,Js,eo,Xa,Vo,Za,Us,yc)}let Sp=Xa.positionedLines.length===1;if(KB+=HB(xr,xi,Xa,qa,Qs,Us,Tn,sa,Sm,ws.vertical?n.ah.horizontal:n.ah.horizontalOnly,Sp?e6:[Bo],Ih,YE,mc,gc),Sp)break}ws.vertical&&(QB+=HB(xr,xi,ws.vertical,qa,Qs,Us,Tn,sa,Sm,n.ah.vertical,["vertical"],Ih,KE,mc,gc));let Mq=Cp?Cp.boxStartIndex:xr.collisionBoxArray.length,Pq=Cp?Cp.boxEndIndex:xr.collisionBoxArray.length,Rq=Mm?Mm.boxStartIndex:xr.collisionBoxArray.length,Bq=Mm?Mm.boxEndIndex:xr.collisionBoxArray.length,Lq=Im?Im.boxStartIndex:xr.collisionBoxArray.length,Oq=Im?Im.boxEndIndex:xr.collisionBoxArray.length,Dq=Pm?Pm.boxStartIndex:xr.collisionBoxArray.length,Fq=Pm?Pm.boxEndIndex:xr.collisionBoxArray.length,_c=-1,P2=(Bo,Xa)=>Bo&&Bo.circleDiameter?Math.max(Bo.circleDiameter,Xa):Xa;_c=P2(Cp,_c),_c=P2(Mm,_c),_c=P2(Im,_c),_c=P2(Pm,_c);let t6=_c>-1?1:0;t6&&(_c*=Iq/vs),xr.glyphOffsetArray.length>=wm.MAX_GLYPHS&&Ai("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tn.sortKey!==void 0&&xr.addToSortKeyRanges(xr.symbolInstances.length,Tn.sortKey);let kq=GB(Qs,Tn,gc),[Nq,zq]=function(Bo,Xa){let Sp=Bo.length,yc=Xa?.values;if(yc?.length>0)for(let Ip=0;Ip<yc.length;Ip+=2){let mu=yc[Ip+1];Bo.emplaceBack(n.ay[yc[Ip]],mu[0],mu[1])}return[Sp,Bo.length]}(xr.textAnchorOffsets,kq);xr.symbolInstances.emplaceBack(xi.x,xi.y,Ih.right>=0?Ih.right:-1,Ih.center>=0?Ih.center:-1,Ih.left>=0?Ih.left:-1,Ih.vertical||-1,YE,KE,JB,Mq,Pq,Rq,Bq,Lq,Oq,Dq,Fq,zs,KB,QB,XB,YB,t6,0,Vo,_c,Nq,zq)}(f,Mr,Or,d,g,w,Qt,f.layers[0],f.collisionBoxArray,l.index,l.sourceLayerIndex,f.index,Oe,[ve,ve,ve,ve],Ht,U,Ue,We,Et,he,l,I,G,$,P)};if(Rt==="line")for(let Or of OB(l.geometry,0,0,Se,Se)){let Mr=Ep(Or,Dt),xr=bq(Mr,le,xt,d.vertical||me,g,24,et,f.overscaling,Se);for(let xi of xr)me&&Cq(f,me.text,Yt,xi)||mr(Mr,xi)}else if(Rt==="line-center"){for(let Or of l.geometry)if(Or.length>1){let Mr=Ep(Or,Dt),xr=xq(Mr,xt,d.vertical||me,g,24,et);xr&&mr(Mr,xr)}}else if(l.type==="Polygon")for(let Or of Ql(l.geometry,0)){let Mr=wq(Or,16);mr(Ep(Or[0],Dt,!0),new Yf(Mr.x,Mr.y,0))}else if(l.type==="LineString")for(let Or of l.geometry){let Mr=Ep(Or,Dt);mr(Mr,new Yf(Mr[0].x,Mr[0].y,0))}else if(l.type==="Point")for(let Or of l.geometry)for(let Mr of Or)mr([Mr],new Yf(Mr.x,Mr.y,0))}function HB(f,l,d,g,w,I,P,D,U,G,$,K,se,ce,he){let me=function(et,Ue,le,ve,We,xt,Ht,Et){let Rt=ve.layout.get("text-rotate").evaluate(xt,{})*Math.PI/180,Yt=[];for(let qt of Ue.positionedLines)for(let Qt of qt.positionedGlyphs){if(!Qt.rect)continue;let Dt=Qt.rect||{},mr=J$+1,Or=!0,Mr=1,xr=0,xi=(We||Et)&&Qt.vertical,$n=Qt.metrics.advance*Qt.scale/2;if(Et&&Ue.verticalizable&&(xr=qt.lineOffset/2-(Qt.imageName?-(vs-Qt.metrics.width*Qt.scale)/2:(Qt.scale-1)*vs)),Qt.imageName){let Vs=Ht[Qt.imageName];Or=Vs.sdf,Mr=Vs.pixelRatio,mr=ia/Mr}let ws=We?[Qt.x+$n,Qt.y]:[0,0],mo=We?[0,0]:[Qt.x+$n+le[0],Qt.y+le[1]-xr],qa=[0,0];xi&&(qa=mo,mo=[0,0]);let na=Qt.metrics.isDoubleResolution?2:1,Qs=(Qt.metrics.left-mr)*Qt.scale-$n+mo[0],jn=(-Qt.metrics.top-mr)*Qt.scale+mo[1],zs=Qs+Dt.w/na*Qt.scale/Mr,Js=jn+Dt.h/na*Qt.scale/Mr,eo=new R(Qs,jn),Vo=new R(zs,jn),Za=new R(Qs,Js),Us=new R(zs,Js);if(xi){let Vs=new R(-$n,$n-x2),js=-Math.PI/2,ds=vs/2-$n,Tn=new R(5-x2-ds,-(Qt.imageName?ds:0)),mc=new R(...qa);eo._rotateAround(js,Vs)._add(Tn)._add(mc),Vo._rotateAround(js,Vs)._add(Tn)._add(mc),Za._rotateAround(js,Vs)._add(Tn)._add(mc),Us._rotateAround(js,Vs)._add(Tn)._add(mc)}if(Rt){let Vs=Math.sin(Rt),js=Math.cos(Rt),ds=[js,-Vs,Vs,js];eo._matMult(ds),Vo._matMult(ds),Za._matMult(ds),Us._matMult(ds)}let sa=new R(0,0),Ts=new R(0,0);Yt.push({tl:eo,tr:Vo,bl:Za,br:Us,tex:Dt,writingMode:Ue.writingMode,glyphOffset:ws,sectionIndex:Qt.sectionIndex,isSDF:Or,pixelOffsetTL:sa,pixelOffsetBR:Ts,minFontScaleX:0,minFontScaleY:0})}return Yt}(0,d,D,w,I,P,g,f.allowVerticalPlacement),Ee=f.textSizeData,Oe=null;Ee.kind==="source"?(Oe=[Au*w.layout.get("text-size").evaluate(P,{})],Oe[0]>Zf&&Ai(`${f.layerIds[0]}: Value for "text-size" is >= ${s_}. Reduce your "text-size".`)):Ee.kind==="composite"&&(Oe=[Au*ce.compositeTextSizes[0].evaluate(P,{},he),Au*ce.compositeTextSizes[1].evaluate(P,{},he)],(Oe[0]>Zf||Oe[1]>Zf)&&Ai(`${f.layerIds[0]}: Value for "text-size" is >= ${s_}. Reduce your "text-size".`)),f.addSymbols(f.text,me,Oe,D,I,P,G,l,U.lineStartIndex,U.lineLength,se,he);for(let et of $)K[et]=f.text.placedSymbolArray.length-1;return 4*me.length}function WB(f){for(let l in f)return f[l];return null}function Cq(f,l,d,g){let w=f.compareText;if(l in w){let I=w[l];for(let P=I.length-1;P>=0;P--)if(g.dist(I[P])<d)return!0}else w[l]=[];return w[l].push(g),!1}let $B=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class GE{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[d,g]=new Uint8Array(l,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");let w=g>>4;if(w!==1)throw new Error(`Got v${w} data when expected v1.`);let I=$B[15&g];if(!I)throw new Error("Unrecognized array type.");let[P]=new Uint16Array(l,2,1),[D]=new Uint32Array(l,4,1);return new GE(D,P,I,l)}constructor(l,d=64,g=Float64Array,w){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=g,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;let I=$B.indexOf(this.ArrayType),P=2*l*this.ArrayType.BYTES_PER_ELEMENT,D=l*this.IndexArrayType.BYTES_PER_ELEMENT,U=(8-D%8)%8;if(I<0)throw new Error(`Unexpected typed array class: ${g}.`);w&&w instanceof ArrayBuffer?(this.data=w,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+D+U,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+P+D+U),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+D+U,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+I]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=l)}add(l,d){let g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=l,this.coords[this._pos++]=d,g}finish(){let l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return HE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,d,g,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:I,coords:P,nodeSize:D}=this,U=[0,I.length-1,0],G=[];for(;U.length;){let $=U.pop()||0,K=U.pop()||0,se=U.pop()||0;if(K-se<=D){for(let Ee=se;Ee<=K;Ee++){let Oe=P[2*Ee],et=P[2*Ee+1];Oe>=l&&Oe<=g&&et>=d&&et<=w&&G.push(I[Ee])}continue}let ce=se+K>>1,he=P[2*ce],me=P[2*ce+1];he>=l&&he<=g&&me>=d&&me<=w&&G.push(I[ce]),($===0?l<=he:d<=me)&&(U.push(se),U.push(ce-1),U.push(1-$)),($===0?g>=he:w>=me)&&(U.push(ce+1),U.push(K),U.push(1-$))}return G}within(l,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:w,coords:I,nodeSize:P}=this,D=[0,w.length-1,0],U=[],G=g*g;for(;D.length;){let $=D.pop()||0,K=D.pop()||0,se=D.pop()||0;if(K-se<=P){for(let Ee=se;Ee<=K;Ee++)ZB(I[2*Ee],I[2*Ee+1],l,d)<=G&&U.push(w[Ee]);continue}let ce=se+K>>1,he=I[2*ce],me=I[2*ce+1];ZB(he,me,l,d)<=G&&U.push(w[ce]),($===0?l-g<=he:d-g<=me)&&(D.push(se),D.push(ce-1),D.push(1-$)),($===0?l+g>=he:d+g>=me)&&(D.push(ce+1),D.push(K),D.push(1-$))}return U}}function HE(f,l,d,g,w,I){if(w-g<=d)return;let P=g+w>>1;qB(f,l,P,g,w,I),HE(f,l,d,g,P-1,1-I),HE(f,l,d,P+1,w,1-I)}function qB(f,l,d,g,w,I){for(;w>g;){if(w-g>600){let G=w-g+1,$=d-g+1,K=Math.log(G),se=.5*Math.exp(2*K/3),ce=.5*Math.sqrt(K*se*(G-se)/G)*($-G/2<0?-1:1);qB(f,l,d,Math.max(g,Math.floor(d-$*se/G+ce)),Math.min(w,Math.floor(d+(G-$)*se/G+ce)),I)}let P=l[2*d+I],D=g,U=w;for(l_(f,l,g,d),l[2*w+I]>P&&l_(f,l,g,w);D<U;){for(l_(f,l,D,U),D++,U--;l[2*D+I]<P;)D++;for(;l[2*U+I]>P;)U--}l[2*g+I]===P?l_(f,l,g,U):(U++,l_(f,l,U,w)),U<=d&&(g=U+1),d<=U&&(w=U-1)}}function l_(f,l,d,g){WE(f,d,g),WE(l,2*d,2*g),WE(l,2*d+1,2*g+1)}function WE(f,l,d){let g=f[l];f[l]=f[d],f[d]=g}function ZB(f,l,d,g){let w=f-d,I=l-g;return w*w+I*I}var $E;n.ck=void 0,($E=n.ck||(n.ck={})).create="create",$E.load="load",$E.fullLoad="fullLoad";let M2=null,c_=[],qE=1e3/60,ZE="loadTime",XE="fullLoadTime",Sq={mark(f){performance.mark(f)},frame(f){let l=f;M2!=null&&c_.push(l-M2),M2=l},clearMetrics(){M2=null,c_=[],performance.clearMeasures(ZE),performance.clearMeasures(XE);for(let f in n.ck)performance.clearMarks(n.ck[f])},getPerformanceMetrics(){performance.measure(ZE,n.ck.create,n.ck.load),performance.measure(XE,n.ck.create,n.ck.fullLoad);let f=performance.getEntriesByName(ZE)[0].duration,l=performance.getEntriesByName(XE)[0].duration,d=c_.length,g=1/(c_.reduce((I,P)=>I+P,0)/d/1e3),w=c_.filter(I=>I>qE).reduce((I,P)=>I+(P-qE)/qE,0);return{loadTime:f,fullLoadTime:l,fps:g,percentDroppedFrames:w/(d+w)*100,totalFrames:d}}};n.$=o_,n.A=pe,n.B=ya,n.C=hn,n.D=br,n.E=ye,n.F=fp,n.G=function(f){if(ui==null){let l=f.navigator?f.navigator.userAgent:null;ui=!!f.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return ui},n.H=class{constructor(f,l){this.target=f,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new gq(()=>this.process()),this.subscription=ls(this.target,"message",d=>this.receive(d),!1),this.globalScope=Di(self)?f:window}registerMessageHandler(f,l){this.messageHandlers[f]=l}sendAsync(f,l){return new Promise((d,g)=>{let w=Math.round(1e18*Math.random()).toString(36).substring(0,10),I=l?ls(l.signal,"abort",()=>{I?.unsubscribe(),delete this.resolveRejects[w];let U={id:w,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(U)},_q):null;this.resolveRejects[w]={resolve:U=>{I?.unsubscribe(),d(U)},reject:U=>{I?.unsubscribe(),g(U)}};let P=[],D=Object.assign(Object.assign({},f),{id:w,sourceMapId:this.mapId,origin:location.origin,data:ra(f.data,P)});this.target.postMessage(D,{transfer:P})})}receive(f){let l=f.data,d=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[d];let g=this.abortControllers[d];return delete this.abortControllers[d],void(g&&g.abort())}if(Di(self)||l.mustQueue)return this.tasks[d]=l,this.taskQueue.push(d),void this.invoker.trigger();this.processTask(d,l)}}process(){if(this.taskQueue.length===0)return;let f=this.taskQueue.shift(),l=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(f,l)}processTask(f,l){return s(this,void 0,void 0,function*(){if(l.type==="<response>"){let w=this.resolveRejects[f];return delete this.resolveRejects[f],w?void(l.error?w.reject(ml(l.error)):w.resolve(ml(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let d=ml(l.data),g=new AbortController;this.abortControllers[f]=g;try{let w=yield this.messageHandlers[l.type](l.sourceMapId,d,g);this.completeTask(f,null,w)}catch(w){this.completeTask(f,w)}})}completeTask(f,l,d){let g=[];delete this.abortControllers[f];let w={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?ra(l):null,data:ra(d,g)};this.target.postMessage(w,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},n.I=PE,n.J=kt,n.K=function(){var f=new pe(16);return pe!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},n.L=function(f,l,d){var g,w,I,P,D,U,G,$,K,se,ce,he,me=d[0],Ee=d[1],Oe=d[2];return l===f?(f[12]=l[0]*me+l[4]*Ee+l[8]*Oe+l[12],f[13]=l[1]*me+l[5]*Ee+l[9]*Oe+l[13],f[14]=l[2]*me+l[6]*Ee+l[10]*Oe+l[14],f[15]=l[3]*me+l[7]*Ee+l[11]*Oe+l[15]):(w=l[1],I=l[2],P=l[3],D=l[4],U=l[5],G=l[6],$=l[7],K=l[8],se=l[9],ce=l[10],he=l[11],f[0]=g=l[0],f[1]=w,f[2]=I,f[3]=P,f[4]=D,f[5]=U,f[6]=G,f[7]=$,f[8]=K,f[9]=se,f[10]=ce,f[11]=he,f[12]=g*me+D*Ee+K*Oe+l[12],f[13]=w*me+U*Ee+se*Oe+l[13],f[14]=I*me+G*Ee+ce*Oe+l[14],f[15]=P*me+$*Ee+he*Oe+l[15]),f},n.M=function(f,l,d){var g=d[0],w=d[1],I=d[2];return f[0]=l[0]*g,f[1]=l[1]*g,f[2]=l[2]*g,f[3]=l[3]*g,f[4]=l[4]*w,f[5]=l[5]*w,f[6]=l[6]*w,f[7]=l[7]*w,f[8]=l[8]*I,f[9]=l[9]*I,f[10]=l[10]*I,f[11]=l[11]*I,f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},n.N=function(f,l,d){var g=l[0],w=l[1],I=l[2],P=l[3],D=l[4],U=l[5],G=l[6],$=l[7],K=l[8],se=l[9],ce=l[10],he=l[11],me=l[12],Ee=l[13],Oe=l[14],et=l[15],Ue=d[0],le=d[1],ve=d[2],We=d[3];return f[0]=Ue*g+le*D+ve*K+We*me,f[1]=Ue*w+le*U+ve*se+We*Ee,f[2]=Ue*I+le*G+ve*ce+We*Oe,f[3]=Ue*P+le*$+ve*he+We*et,f[4]=(Ue=d[4])*g+(le=d[5])*D+(ve=d[6])*K+(We=d[7])*me,f[5]=Ue*w+le*U+ve*se+We*Ee,f[6]=Ue*I+le*G+ve*ce+We*Oe,f[7]=Ue*P+le*$+ve*he+We*et,f[8]=(Ue=d[8])*g+(le=d[9])*D+(ve=d[10])*K+(We=d[11])*me,f[9]=Ue*w+le*U+ve*se+We*Ee,f[10]=Ue*I+le*G+ve*ce+We*Oe,f[11]=Ue*P+le*$+ve*he+We*et,f[12]=(Ue=d[12])*g+(le=d[13])*D+(ve=d[14])*K+(We=d[15])*me,f[13]=Ue*w+le*U+ve*se+We*Ee,f[14]=Ue*I+le*G+ve*ce+We*Oe,f[15]=Ue*P+le*$+ve*he+We*et,f},n.O=function(f,l){let d={};for(let g=0;g<l.length;g++){let w=l[g];w in f&&(d[w]=f[w])}return d},n.P=R,n.Q=Xf,n.R=Wa,n.S=wB,n.T=fc,n.U=vB,n.V=re,n.W=te,n.X=oi,n.Y=$a,n.Z=Se,n._=s,n.a=Gr,n.a$=function(f,l,d){var g=Math.sin(d),w=Math.cos(d),I=l[4],P=l[5],D=l[6],U=l[7],G=l[8],$=l[9],K=l[10],se=l[11];return l!==f&&(f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[4]=I*w+G*g,f[5]=P*w+$*g,f[6]=D*w+K*g,f[7]=U*w+se*g,f[8]=G*w-I*g,f[9]=$*w-P*g,f[10]=K*w-D*g,f[11]=se*w-U*g,f},n.a0=25,n.a1=UE,n.a2=f=>{let l=window.document.createElement("video");return l.muted=!0,new Promise(d=>{l.onloadstart=()=>{d(l)};for(let g of f){let w=window.document.createElement("source");Xi(g)||(l.crossOrigin="Anonymous"),w.src=g,l.appendChild(w)}})},n.a3=$e,n.a4=function(){return Lt++},n.a5=V,n.a6=wm,n.a7=Ta,n.a8=ni,n.a9=PB,n.aA=jE,n.aB=BE,n.aC=GE,n.aD=Vn,n.aE=g2,n.aF=Ge,n.aG=$r,n.aH=Ut,n.aI=function(f){return Math.pow(2,f)},n.aJ=85.051129,n.aK=TB,n.aL=cr,n.aM=Zs,n.aN=EB,n.aO=function(f,l,d){return f[0]=l[0]*d,f[1]=l[1]*d,f[2]=l[2]*d,f},n.aP=function(f,l,d){return f[0]=l[0]+d[0],f[1]=l[1]+d[1],f[2]=l[2]+d[2],f},n.aQ=function(f){var l=new pe(3);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l},n.aR=function(f,l,d){return f[0]=l[0]*d[0],f[1]=l[1]*d[1],f[2]=l[2]*d[2],f[3]=l[3]*d[3],f},n.aS=function(f,l,d){return f[0]=l[0]-d[0],f[1]=l[1]-d[1],f[2]=l[2]-d[2],f},n.aT=function(f,l){var d=l[0],g=l[1],w=l[2],I=d*d+g*g+w*w;return I>0&&(I=1/Math.sqrt(I)),f[0]=l[0]*I,f[1]=l[1]*I,f[2]=l[2]*I,f},n.aU=function(f,l,d){var g=l[0],w=l[1],I=l[2],P=d[0],D=d[1],U=d[2];return f[0]=w*U-I*D,f[1]=I*P-g*U,f[2]=g*D-w*P,f},n.aV=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]},n.aW=SB,n.aX=Tm,n.aY=function(f,l,d,g,w){var I,P=1/Math.tan(l/2);return f[0]=P/d,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=P,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,w!=null&&w!==1/0?(f[10]=(w+g)*(I=1/(g-w)),f[14]=2*w*g*I):(f[10]=-1,f[14]=-2*g),f},n.aZ=function(f){var l=new pe(16);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l[9]=f[9],l[10]=f[10],l[11]=f[11],l[12]=f[12],l[13]=f[13],l[14]=f[14],l[15]=f[15],l},n.a_=function(f,l,d){var g=Math.sin(d),w=Math.cos(d),I=l[0],P=l[1],D=l[2],U=l[3],G=l[4],$=l[5],K=l[6],se=l[7];return l!==f&&(f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=I*w+G*g,f[1]=P*w+$*g,f[2]=D*w+K*g,f[3]=U*w+se*g,f[4]=G*w-I*g,f[5]=$*w-P*g,f[6]=K*w-D*g,f[7]=se*w-U*g,f},n.aa=function(f){let l={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,g,w,I)=>{let P=w||I;return l[g]=!P||P.toLowerCase(),""}),l["max-age"]){let d=parseInt(l["max-age"],10);isNaN(d)?delete l["max-age"]:l["max-age"]=d}return l},n.ab=function(f){return Math.log(f)/Math.LN2},n.ac=function(f){var l=f[0],d=f[1];return l*l+d*d},n.ad=function(f){return f*Math.PI/180},n.ae=Vt,n.af=function(f,l){let d=[];for(let g in f)g in l||d.push(g);return d},n.ag=function(f,l){let d=0,g=0;if(f.kind==="constant")g=f.layoutSize;else if(f.kind!=="source"){let{interpolationType:w,minZoom:I,maxZoom:P}=f,D=w?Vt(Ys.interpolationFactor(w,l,I,P),0,1):0;f.kind==="camera"?g=ya.number(f.minSize,f.maxSize,D):d=D}return{uSizeT:d,uSize:g}},n.ai=function(f,{uSize:l,uSizeT:d},{lowerSize:g,upperSize:w}){return f.kind==="source"?g/Au:f.kind==="composite"?ya.number(g/Au,w/Au,d):l},n.aj=function(f,l){var d=l[0],g=l[1],w=l[2],I=l[3],P=l[4],D=l[5],U=l[6],G=l[7],$=l[8],K=l[9],se=l[10],ce=l[11],he=l[12],me=l[13],Ee=l[14],Oe=l[15],et=d*D-g*P,Ue=d*U-w*P,le=d*G-I*P,ve=g*U-w*D,We=g*G-I*D,xt=w*G-I*U,Ht=$*me-K*he,Et=$*Ee-se*he,Rt=$*Oe-ce*he,Yt=K*Ee-se*me,qt=K*Oe-ce*me,Qt=se*Oe-ce*Ee,Dt=et*Qt-Ue*qt+le*Yt+ve*Rt-We*Et+xt*Ht;return Dt?(f[0]=(D*Qt-U*qt+G*Yt)*(Dt=1/Dt),f[1]=(w*qt-g*Qt-I*Yt)*Dt,f[2]=(me*xt-Ee*We+Oe*ve)*Dt,f[3]=(se*We-K*xt-ce*ve)*Dt,f[4]=(U*Rt-P*Qt-G*Et)*Dt,f[5]=(d*Qt-w*Rt+I*Et)*Dt,f[6]=(Ee*le-he*xt-Oe*Ue)*Dt,f[7]=($*xt-se*le+ce*Ue)*Dt,f[8]=(P*qt-D*Rt+G*Ht)*Dt,f[9]=(g*Rt-d*qt-I*Ht)*Dt,f[10]=(he*We-me*le+Oe*et)*Dt,f[11]=(K*le-$*We-ce*et)*Dt,f[12]=(D*Et-P*Yt-U*Ht)*Dt,f[13]=(d*Yt-g*Et+w*Ht)*Dt,f[14]=(me*Ue-he*ve-Ee*et)*Dt,f[15]=($*ve-K*Ue+se*et)*Dt,f):null},n.ak=_e,n.al=function(f){return Math.hypot(f[0],f[1])},n.am=function(f){return f[0]=0,f[1]=0,f},n.an=function(f,l,d){return f[0]=l[0]*d,f[1]=l[1]*d,f},n.ao=OE,n.ap=Z,n.aq=function(f,l,d,g){let w=l.y-f.y,I=l.x-f.x,P=g.y-d.y,D=g.x-d.x,U=P*I-D*w;if(U===0)return null;let G=(D*(f.y-d.y)-P*(f.x-d.x))/U;return new R(f.x+G*I,f.y+G*w)},n.ar=OB,n.as=Vi,n.at=Fe,n.au=function(f){let l=1/0,d=1/0,g=-1/0,w=-1/0;for(let I of f)l=Math.min(l,I.x),d=Math.min(d,I.y),g=Math.max(g,I.x),w=Math.max(w,I.y);return[l,d,g,w]},n.av=vs,n.aw=ke,n.ax=function(f,l,d,g,w=!1){if(!d[0]&&!d[1])return[0,0];let I=w?g==="map"?-f.bearingInRadians:0:g==="viewport"?f.bearingInRadians:0;if(I){let P=Math.sin(I),D=Math.cos(I);d=[d[0]*D-d[1]*P,d[0]*P+d[1]*D]}return[w?d[0]:ke(l,d[0],f.zoom),w?d[1]:ke(l,d[1],f.zoom)]},n.az=LE,n.b=tn,n.b$=f=>f.type==="symbol",n.b0=function(){let f=new Float32Array(16);return Fe(f),f},n.b1=function(){let f=new Float64Array(16);return Fe(f),f},n.b2=function(){return new Float64Array(16)},n.b3=function(f,l,d){let g=new Float64Array(4);return function(w,I,P,D){var U=.5*Math.PI/180;I*=U,P*=U,D*=U;var G=Math.sin(I),$=Math.cos(I),K=Math.sin(P),se=Math.cos(P),ce=Math.sin(D),he=Math.cos(D);w[0]=G*se*he-$*K*ce,w[1]=$*K*he+G*se*ce,w[2]=$*se*ce-G*K*he,w[3]=$*se*he+G*K*ce}(g,f,l-90,d),g},n.b4=function(f,l,d,g){var w,I,P,D,U,G=l[0],$=l[1],K=l[2],se=l[3],ce=d[0],he=d[1],me=d[2],Ee=d[3];return(I=G*ce+$*he+K*me+se*Ee)<0&&(I=-I,ce=-ce,he=-he,me=-me,Ee=-Ee),1-I>ae?(w=Math.acos(I),P=Math.sin(w),D=Math.sin((1-g)*w)/P,U=Math.sin(g*w)/P):(D=1-g,U=g),f[0]=D*G+U*ce,f[1]=D*$+U*he,f[2]=D*K+U*me,f[3]=D*se+U*Ee,f},n.b5=function(f){let l=new Float64Array(9);var d,g,w,I,P,D,U,G,$,K,se,ce,he,me,Ee,Oe,et,Ue;K=(w=(g=f)[0])*(U=w+w),se=(I=g[1])*U,he=(P=g[2])*U,me=P*(G=I+I),Oe=(D=g[3])*U,et=D*G,Ue=D*($=P+P),(d=l)[0]=1-(ce=I*G)-(Ee=P*$),d[3]=se-Ue,d[6]=he+et,d[1]=se+Ue,d[4]=1-K-Ee,d[7]=me-Oe,d[2]=he-et,d[5]=me+Oe,d[8]=1-K-ce;let le=Zs(-Math.asin(Vt(l[2],-1,1))),ve,We;return Math.hypot(l[5],l[8])<.001?(ve=0,We=-Zs(Math.atan2(l[3],l[4]))):(ve=Zs(l[5]===0&&l[8]===0?0:Math.atan2(l[5],l[8])),We=Zs(l[1]===0&&l[0]===0?0:Math.atan2(l[1],l[0]))),{roll:ve,pitch:le+90,bearing:We}},n.b6=function(f,l){return f.roll==l.roll&&f.pitch==l.pitch&&f.bearing==l.bearing},n.b7=Ei,n.b8=fe,n.b9=bm,n.bA=function(f,l){if(!f)return[{command:"setStyle",args:[l]}];let d=[];try{if(!Qe(f.version,l.version))return[{command:"setStyle",args:[l]}];Qe(f.center,l.center)||d.push({command:"setCenter",args:[l.center]}),Qe(f.centerAltitude,l.centerAltitude)||d.push({command:"setCenterAltitude",args:[l.centerAltitude]}),Qe(f.zoom,l.zoom)||d.push({command:"setZoom",args:[l.zoom]}),Qe(f.bearing,l.bearing)||d.push({command:"setBearing",args:[l.bearing]}),Qe(f.pitch,l.pitch)||d.push({command:"setPitch",args:[l.pitch]}),Qe(f.roll,l.roll)||d.push({command:"setRoll",args:[l.roll]}),Qe(f.sprite,l.sprite)||d.push({command:"setSprite",args:[l.sprite]}),Qe(f.glyphs,l.glyphs)||d.push({command:"setGlyphs",args:[l.glyphs]}),Qe(f.transition,l.transition)||d.push({command:"setTransition",args:[l.transition]}),Qe(f.light,l.light)||d.push({command:"setLight",args:[l.light]}),Qe(f.terrain,l.terrain)||d.push({command:"setTerrain",args:[l.terrain]}),Qe(f.sky,l.sky)||d.push({command:"setSky",args:[l.sky]}),Qe(f.projection,l.projection)||d.push({command:"setProjection",args:[l.projection]});let g={},w=[];(function(P,D,U,G){let $;for($ in D=D||{},P=P||{})Object.prototype.hasOwnProperty.call(P,$)&&(Object.prototype.hasOwnProperty.call(D,$)||Bt($,U,G));for($ in D)Object.prototype.hasOwnProperty.call(D,$)&&(Object.prototype.hasOwnProperty.call(P,$)?Qe(P[$],D[$])||(P[$].type==="geojson"&&D[$].type==="geojson"&&ut(P,D,$)?dt(U,{command:"setGeoJSONSourceData",args:[$,D[$].data]}):Mt($,D,U,G)):it($,D,U))})(f.sources,l.sources,w,g);let I=[];f.layers&&f.layers.forEach(P=>{"source"in P&&g[P.source]?d.push({command:"removeLayer",args:[P.id]}):I.push(P)}),d=d.concat(w),function(P,D,U){D=D||[];let G=(P=P||[]).map(rr),$=D.map(rr),K=P.reduce(nr,{}),se=D.reduce(nr,{}),ce=G.slice(),he=Object.create(null),me,Ee,Oe,et,Ue;for(let le=0,ve=0;le<G.length;le++)me=G[le],Object.prototype.hasOwnProperty.call(se,me)?ve++:(dt(U,{command:"removeLayer",args:[me]}),ce.splice(ce.indexOf(me,ve),1));for(let le=0,ve=0;le<$.length;le++)me=$[$.length-1-le],ce[ce.length-1-le]!==me&&(Object.prototype.hasOwnProperty.call(K,me)?(dt(U,{command:"removeLayer",args:[me]}),ce.splice(ce.lastIndexOf(me,ce.length-ve),1)):ve++,et=ce[ce.length-le],dt(U,{command:"addLayer",args:[se[me],et]}),ce.splice(ce.length-le,0,me),he[me]=!0);for(let le=0;le<$.length;le++)if(me=$[le],Ee=K[me],Oe=se[me],!he[me]&&!Qe(Ee,Oe))if(Qe(Ee.source,Oe.source)&&Qe(Ee["source-layer"],Oe["source-layer"])&&Qe(Ee.type,Oe.type)){for(Ue in zt(Ee.layout,Oe.layout,U,me,null,"setLayoutProperty"),zt(Ee.paint,Oe.paint,U,me,null,"setPaintProperty"),Qe(Ee.filter,Oe.filter)||dt(U,{command:"setFilter",args:[me,Oe.filter]}),Qe(Ee.minzoom,Oe.minzoom)&&Qe(Ee.maxzoom,Oe.maxzoom)||dt(U,{command:"setLayerZoomRange",args:[me,Oe.minzoom,Oe.maxzoom]}),Ee)Object.prototype.hasOwnProperty.call(Ee,Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&(Ue.indexOf("paint.")===0?zt(Ee[Ue],Oe[Ue],U,me,Ue.slice(6),"setPaintProperty"):Qe(Ee[Ue],Oe[Ue])||dt(U,{command:"setLayerProperty",args:[me,Ue,Oe[Ue]]}));for(Ue in Oe)Object.prototype.hasOwnProperty.call(Oe,Ue)&&!Object.prototype.hasOwnProperty.call(Ee,Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&(Ue.indexOf("paint.")===0?zt(Ee[Ue],Oe[Ue],U,me,Ue.slice(6),"setPaintProperty"):Qe(Ee[Ue],Oe[Ue])||dt(U,{command:"setLayerProperty",args:[me,Ue,Oe[Ue]]}))}else dt(U,{command:"removeLayer",args:[me]}),et=ce[ce.lastIndexOf(me)+1],dt(U,{command:"addLayer",args:[Oe,et]})}(I,l.layers,d)}catch(g){console.warn("Unable to compute style diff:",g),d=[{command:"setStyle",args:[l]}]}return d},n.bB=function(f){let l=[],d=f.id;return d===void 0&&l.push({message:`layers.${d}: missing required property "id"`}),f.render===void 0&&l.push({message:`layers.${d}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&l.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),l},n.bC=function f(l,d){if(Array.isArray(l)){if(!Array.isArray(d)||l.length!==d.length)return!1;for(let g=0;g<l.length;g++)if(!f(l[g],d[g]))return!1;return!0}if(typeof l=="object"&&l!==null&&d!==null){if(typeof d!="object"||Object.keys(l).length!==Object.keys(d).length)return!1;for(let g in l)if(!f(l[g],d[g]))return!1;return!0}return l===d},n.bD=vr,n.bE=Pr,n.bF=class extends ee{constructor(f,l){super(f,l),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},n.bG=qe,n.bH=class extends ee{constructor(f,l){super(f,l),this.current=Je}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let l=1;l<16;l++)if(f[l]!==this.current[l]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},n.bI=Te,n.bJ=class extends ee{constructor(f,l){super(f,l),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},n.bK=class extends ee{constructor(f,l){super(f,l),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},n.bL=be,n.bM=function(f,l){var d=Math.sin(l),g=Math.cos(l);return f[0]=g,f[1]=d,f[2]=0,f[3]=-d,f[4]=g,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},n.bN=function(f,l,d){var g=l[0],w=l[1],I=l[2];return f[0]=g*d[0]+w*d[3]+I*d[6],f[1]=g*d[1]+w*d[4]+I*d[7],f[2]=g*d[2]+w*d[5]+I*d[8],f},n.bO=function(f,l,d,g,w,I,P){var D=1/(l-d),U=1/(g-w),G=1/(I-P);return f[0]=-2*D,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*U,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*G,f[11]=0,f[12]=(l+d)*D,f[13]=(w+g)*U,f[14]=(P+I)*G,f[15]=1,f},n.bP=class extends bp{},n.bQ=q$,n.bR=class extends Sh{},n.bS=pE,n.bT=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},n.bU=MR,n.bV=function(f,l,d){var g=l[0],w=l[1],I=l[2],P=d[3]*g+d[7]*w+d[11]*I+d[15];return f[0]=(d[0]*g+d[4]*w+d[8]*I+d[12])/(P=P||1),f[1]=(d[1]*g+d[5]*w+d[9]*I+d[13])/P,f[2]=(d[2]*g+d[6]*w+d[10]*I+d[14])/P,f},n.bW=class extends Ch{},n.bX=class extends S{},n.bY=function(f,l){return f[0]===l[0]&&f[1]===l[1]&&f[2]===l[2]&&f[3]===l[3]&&f[4]===l[4]&&f[5]===l[5]&&f[6]===l[6]&&f[7]===l[7]&&f[8]===l[8]&&f[9]===l[9]&&f[10]===l[10]&&f[11]===l[11]&&f[12]===l[12]&&f[13]===l[13]&&f[14]===l[14]&&f[15]===l[15]},n.bZ=function(f,l){var d=f[0],g=f[1],w=f[2],I=f[3],P=f[4],D=f[5],U=f[6],G=f[7],$=f[8],K=f[9],se=f[10],ce=f[11],he=f[12],me=f[13],Ee=f[14],Oe=f[15],et=l[0],Ue=l[1],le=l[2],ve=l[3],We=l[4],xt=l[5],Ht=l[6],Et=l[7],Rt=l[8],Yt=l[9],qt=l[10],Qt=l[11],Dt=l[12],mr=l[13],Or=l[14],Mr=l[15];return Math.abs(d-et)<=ae*Math.max(1,Math.abs(d),Math.abs(et))&&Math.abs(g-Ue)<=ae*Math.max(1,Math.abs(g),Math.abs(Ue))&&Math.abs(w-le)<=ae*Math.max(1,Math.abs(w),Math.abs(le))&&Math.abs(I-ve)<=ae*Math.max(1,Math.abs(I),Math.abs(ve))&&Math.abs(P-We)<=ae*Math.max(1,Math.abs(P),Math.abs(We))&&Math.abs(D-xt)<=ae*Math.max(1,Math.abs(D),Math.abs(xt))&&Math.abs(U-Ht)<=ae*Math.max(1,Math.abs(U),Math.abs(Ht))&&Math.abs(G-Et)<=ae*Math.max(1,Math.abs(G),Math.abs(Et))&&Math.abs($-Rt)<=ae*Math.max(1,Math.abs($),Math.abs(Rt))&&Math.abs(K-Yt)<=ae*Math.max(1,Math.abs(K),Math.abs(Yt))&&Math.abs(se-qt)<=ae*Math.max(1,Math.abs(se),Math.abs(qt))&&Math.abs(ce-Qt)<=ae*Math.max(1,Math.abs(ce),Math.abs(Qt))&&Math.abs(he-Dt)<=ae*Math.max(1,Math.abs(he),Math.abs(Dt))&&Math.abs(me-mr)<=ae*Math.max(1,Math.abs(me),Math.abs(mr))&&Math.abs(Ee-Or)<=ae*Math.max(1,Math.abs(Ee),Math.abs(Or))&&Math.abs(Oe-Mr)<=ae*Math.max(1,Math.abs(Oe),Math.abs(Mr))},n.b_=function(f,l){return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},n.ba=Qg,n.bb=xm,n.bc=rt,n.bd=tt,n.be=hs,n.bf=function(f,l,d,g,w){return rt(g,w,Vt((f-l)/(d-l),0,1))},n.bg=Ye,n.bh=function(){return new Float64Array(4)},n.bi=function(){return new Float64Array(3)},n.bj=function(f,l,d,g){var w=[],I=[];return w[0]=l[0]-d[0],w[1]=l[1]-d[1],w[2]=l[2]-d[2],I[0]=w[0]*Math.cos(g)-w[1]*Math.sin(g),I[1]=w[0]*Math.sin(g)+w[1]*Math.cos(g),I[2]=w[2],f[0]=I[0]+d[0],f[1]=I[1]+d[1],f[2]=I[2]+d[2],f},n.bk=function(f,l,d,g){var w=[],I=[];return w[0]=l[0]-d[0],w[1]=l[1]-d[1],w[2]=l[2]-d[2],I[0]=w[0],I[1]=w[1]*Math.cos(g)-w[2]*Math.sin(g),I[2]=w[1]*Math.sin(g)+w[2]*Math.cos(g),f[0]=I[0]+d[0],f[1]=I[1]+d[1],f[2]=I[2]+d[2],f},n.bl=function(f,l,d,g){var w=[],I=[];return w[0]=l[0]-d[0],w[1]=l[1]-d[1],w[2]=l[2]-d[2],I[0]=w[2]*Math.sin(g)+w[0]*Math.cos(g),I[1]=w[1],I[2]=w[2]*Math.cos(g)-w[0]*Math.sin(g),f[0]=I[0]+d[0],f[1]=I[1]+d[1],f[2]=I[2]+d[2],f},n.bm=function(f,l,d){var g=Math.sin(d),w=Math.cos(d),I=l[0],P=l[1],D=l[2],U=l[3],G=l[8],$=l[9],K=l[10],se=l[11];return l!==f&&(f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=I*w-G*g,f[1]=P*w-$*g,f[2]=D*w-K*g,f[3]=U*w-se*g,f[8]=I*g+G*w,f[9]=P*g+$*w,f[10]=D*g+K*w,f[11]=U*g+se*w,f},n.bn=function(f,l){let d=Ye(f,360),g=Ye(l,360),w=g-d,I=g>d?w-360:w+360;return Math.abs(w)<Math.abs(I)?w:I},n.bo=function(f){return f[0]=0,f[1]=0,f[2]=0,f},n.bp=function(f,l,d,g){let w=Math.sqrt(f*f+l*l),I=Math.sqrt(d*d+g*g);f/=w,l/=w,d/=I,g/=I;let P=Math.acos(f*d+l*g);return-l*d+f*g>0?P:-P},n.bq=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]+f[3]},n.br=NE,n.bs=function(f,l){let d=Ye(f,2*Math.PI),g=Ye(l,2*Math.PI);return Math.min(Math.abs(d-g),Math.abs(d-g+2*Math.PI),Math.abs(d-g-2*Math.PI))},n.bt=function(f){return Math.hypot(f[0],f[1],f[2])},n.bu=function(){let f={},l=ue.$version;for(let d in ue.$root){let g=ue.$root[d];if(g.required){let w=null;w=d==="version"?l:g.type==="array"?[]:{},w!=null&&(f[d]=w)}}return f},n.bv=Uf,n.bw=ai,n.bx=function(f){f=f.slice();let l=Object.create(null);for(let d=0;d<f.length;d++)l[f[d].id]=f[d];for(let d=0;d<f.length;d++)"ref"in f[d]&&(f[d]=Ke(f[d],l[f[d].ref]));return f},n.by=function(f){if(f.type==="custom")return new mq(f);switch(f.type){case"background":return new dq(f);case"circle":return new l$(f);case"fill":return new S$(f);case"fill-extrusion":return new D$(f);case"heatmap":return new u$(f);case"hillshade":return new f$(f);case"line":return new G$(f);case"raster":return new Aq(f);case"symbol":return new T2(f)}},n.bz=dr,n.c=ys,n.c0=f=>f.type==="circle",n.c1=f=>f.type==="heatmap",n.c2=f=>f.type==="line",n.c3=f=>f.type==="fill",n.c4=f=>f.type==="fill-extrusion",n.c5=f=>f.type==="hillshade",n.c6=f=>f.type==="raster",n.c7=f=>f.type==="background",n.c8=f=>f.type==="custom",n.c9=_t,n.cA=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},n.cB=function(f,l,d,g,w){return s(this,void 0,void 0,function*(){if(te())try{return yield oi(f,l,d,g,w)}catch{}return function(I,P,D,U,G){let $=I.width,K=I.height;Eo&&qs||(Eo=new OffscreenCanvas($,K),qs=Eo.getContext("2d",{willReadFrequently:!0})),Eo.width=$,Eo.height=K,qs.drawImage(I,0,0,$,K);let se=qs.getImageData(P,D,U,G);return qs.clearRect(0,0,$,K),se.data}(f,l,d,g,w)})},n.cC=IB,n.cD=a,n.cE=p,n.cF=$R,n.cG=nB,n.cH=Pf,n.cI=Ha,n.ca=function(f,l,d){let g=Be(l.x-d.x,l.y-d.y),w=Be(f.x-d.x,f.y-d.y);var I,P;return Zs(Math.atan2(g[0]*w[1]-g[1]*w[0],(I=g)[0]*(P=w)[0]+I[1]*P[1]))},n.cb=Zt,n.cc=function(f,l){return _s[l]&&(f instanceof MouseEvent||f instanceof WheelEvent)},n.cd=function(f,l){return Aa[l]&&"touches"in f},n.ce=function(f){return Aa[f]||_s[f]},n.cf=function(f,l,d){var g=l[0],w=l[1];return f[0]=d[0]*g+d[4]*w+d[12],f[1]=d[1]*g+d[5]*w+d[13],f},n.cg=function(f,l){let{x:d,y:g}=o_.fromLngLat(l);return!(f<0||f>25||g<0||g>=1||d<0||d>=1)},n.ch=function(f,l){return f[0]=l[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=l[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=l[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},n.ci=class extends bs{},n.cj=Sq,n.cl=function(f){return f.message===oo},n.cm=Cr,n.cn=function(f,l){Gr.REGISTERED_PROTOCOLS[f]=l},n.co=function(f){delete Gr.REGISTERED_PROTOCOLS[f]},n.cp=function(f,l){let d={};for(let w=0;w<f.length;w++){let I=l&&l[f[w].id]||Vg(f[w]);l&&(l[f[w].id]=I);let P=d[I];P||(P=d[I]=[]),P.push(f[w])}let g=[];for(let w in d)g.push(d[w]);return g},n.cq=hr,n.cr=MB,n.cs=RB,n.ct=oB,n.cu=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=Se/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;let l=f.bucket.layers[0],d=l.layout,g=l._unevaluatedLayout._values,w={layoutIconSize:g["icon-size"].possiblyEvaluate(new hn(f.bucket.zoom+1),f.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new hn(f.bucket.zoom+1),f.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new hn(18))};if(f.bucket.textSizeData.kind==="composite"){let{minZoom:G,maxZoom:$}=f.bucket.textSizeData;w.compositeTextSizes=[g["text-size"].possiblyEvaluate(new hn(G),f.canonical),g["text-size"].possiblyEvaluate(new hn($),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){let{minZoom:G,maxZoom:$}=f.bucket.iconSizeData;w.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new hn(G),f.canonical),g["icon-size"].possiblyEvaluate(new hn($),f.canonical)]}let I=d.get("text-line-height")*vs,P=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",D=d.get("text-keep-upright"),U=d.get("text-size");for(let G of f.bucket.features){let $=d.get("text-font").evaluate(G,{},f.canonical).join(","),K=U.evaluate(G,{},f.canonical),se=w.layoutTextSize.evaluate(G,{},f.canonical),ce=w.layoutIconSize.evaluate(G,{},f.canonical),he={horizontal:{},vertical:void 0},me=G.text,Ee,Oe=[0,0];if(me){let le=me.toString(),ve=d.get("text-letter-spacing").evaluate(G,{},f.canonical)*vs,We=pm(le)?ve:0,xt=d.get("text-anchor").evaluate(G,{},f.canonical),Ht=GB(l,G,f.canonical);if(!Ht){let qt=d.get("text-radial-offset").evaluate(G,{},f.canonical);Oe=qt?jB(xt,[qt*vs,VE]):d.get("text-offset").evaluate(G,{},f.canonical).map(Qt=>Qt*vs)}let Et=P?"center":d.get("text-justify").evaluate(G,{},f.canonical),Rt=d.get("symbol-placement")==="point"?d.get("text-max-width").evaluate(G,{},f.canonical)*vs:1/0,Yt=()=>{f.bucket.allowVerticalPlacement&&uu(le)&&(he.vertical=b2(me,f.glyphMap,f.glyphPositions,f.imagePositions,$,Rt,I,xt,"left",We,Oe,n.ah.vertical,!0,se,K))};if(!P&&Ht){let qt=new Set;if(Et==="auto")for(let Dt=0;Dt<Ht.values.length;Dt+=2)qt.add(jE(Ht.values[Dt]));else qt.add(Et);let Qt=!1;for(let Dt of qt)if(!he.horizontal[Dt])if(Qt)he.horizontal[Dt]=he.horizontal[0];else{let mr=b2(me,f.glyphMap,f.glyphPositions,f.imagePositions,$,Rt,I,"center",Dt,We,Oe,n.ah.horizontal,!1,se,K);mr&&(he.horizontal[Dt]=mr,Qt=mr.positionedLines.length===1)}Yt()}else{Et==="auto"&&(Et=jE(xt));let qt=b2(me,f.glyphMap,f.glyphPositions,f.imagePositions,$,Rt,I,xt,Et,We,Oe,n.ah.horizontal,!1,se,K);qt&&(he.horizontal[Et]=qt),Yt(),uu(le)&&P&&D&&(he.vertical=b2(me,f.glyphMap,f.glyphPositions,f.imagePositions,$,Rt,I,xt,Et,We,Oe,n.ah.vertical,!1,se,K))}}let et=!1;if(G.icon&&G.icon.name){let le=f.imageMap[G.icon.name];le&&(Ee=lq(f.imagePositions[G.icon.name],d.get("icon-offset").evaluate(G,{},f.canonical),d.get("icon-anchor").evaluate(G,{},f.canonical)),et=!!le.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=et:f.bucket.sdfIcons!==et&&Ai("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(le.pixelRatio!==f.bucket.pixelRatio||d.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}let Ue=WB(he.horizontal)||he.vertical;f.bucket.iconsInText=!!Ue&&Ue.iconsInText,(Ue||Ee)&&Eq(f.bucket,G,he,Ee,f.imageMap,w,se,ce,Oe,et,f.canonical,f.subdivisionGranularity)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},n.cv=EE,n.cw=yE,n.cx=TE,n.cy=e_,n.cz=IE,n.d=Xi,n.e=Wt,n.f=f=>s(void 0,void 0,void 0,function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));let l=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(l)}catch(d){throw new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),n.g=Jt,n.h=f=>new Promise((l,d)=>{let g=new Image;g.onload=()=>{l(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=Ni})},g.onerror=()=>d(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let w=new Blob([new Uint8Array(f)],{type:"image/png"});g.src=f.byteLength?URL.createObjectURL(w):Ni}),n.i=Di,n.j=(f,l)=>Rr(Wt(f,{type:"json"}),l),n.k=Ae,n.l=ot,n.m=Rr,n.n=(f,l)=>Rr(Wt(f,{type:"arrayBuffer"}),l),n.o=function(f){return new IE(f).readFields(Y$,[])},n.p=sB,n.q=qg,n.r=po,n.s=ls,n.t=Ns,n.u=li,n.v=ue,n.w=Ai,n.x=Al,n.y=uc,n.z=function([f,l,d]){return l+=90,l*=Math.PI/180,d*=Math.PI/180,{x:f*Math.cos(l)*Math.sin(d),y:f*Math.sin(l)*Math.sin(d),z:f*Math.cos(d)}}}),r("worker",["./shared"],function(n){"use strict";class s{constructor(Ae){this.keyCache={},Ae&&this.replace(Ae)}replace(Ae){this._layerConfigs={},this._layers={},this.update(Ae,[])}update(Ae,ye){for(let Ve of Ae){this._layerConfigs[Ve.id]=Ve;let Ke=this._layers[Ve.id]=n.by(Ve);Ke._featureFilter=n.a7(Ke.filter),this.keyCache[Ve.id]&&delete this.keyCache[Ve.id]}for(let Ve of ye)delete this.keyCache[Ve],delete this._layerConfigs[Ve],delete this._layers[Ve];this.familiesBySource={};let ue=n.cp(Object.values(this._layerConfigs),this.keyCache);for(let Ve of ue){let Ke=Ve.map(ut=>this._layers[ut.id]),Qe=Ke[0];if(Qe.visibility==="none")continue;let dt=Qe.source||"",it=this.familiesBySource[dt];it||(it=this.familiesBySource[dt]={});let Bt=Qe.sourceLayer||"_geojsonTileLayer",Mt=it[Bt];Mt||(Mt=it[Bt]=[]),Mt.push(Ke)}}}class a{constructor(Ae){let ye={},ue=[];for(let dt in Ae){let it=Ae[dt],Bt=ye[dt]={};for(let Mt in it){let ut=it[+Mt];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;let zt={x:0,y:0,w:ut.bitmap.width+2,h:ut.bitmap.height+2};ue.push(zt),Bt[Mt]={rect:zt,metrics:ut.metrics}}}let{w:Ve,h:Ke}=n.p(ue),Qe=new n.q({width:Ve||1,height:Ke||1});for(let dt in Ae){let it=Ae[dt];for(let Bt in it){let Mt=it[+Bt];if(!Mt||Mt.bitmap.width===0||Mt.bitmap.height===0)continue;let ut=ye[dt][Bt].rect;n.q.copy(Mt.bitmap,Qe,{x:0,y:0},{x:ut.x+1,y:ut.y+1},Mt.bitmap)}}this.image=Qe,this.positions=ye}}n.cq("GlyphAtlas",a);class c{constructor(Ae){this.tileID=new n.Y(Ae.tileID.overscaledZ,Ae.tileID.wrap,Ae.tileID.canonical.z,Ae.tileID.canonical.x,Ae.tileID.canonical.y),this.uid=Ae.uid,this.zoom=Ae.zoom,this.pixelRatio=Ae.pixelRatio,this.tileSize=Ae.tileSize,this.source=Ae.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ae.showCollisionBoxes,this.collectResourceTiming=!!Ae.collectResourceTiming,this.returnDependencies=!!Ae.returnDependencies,this.promoteId=Ae.promoteId,this.inFlightDependencies=[]}parse(Ae,ye,ue,Ve,Ke){return n._(this,void 0,void 0,function*(){this.status="parsing",this.data=Ae,this.collisionBoxArray=new n.a5;let Qe=new n.cr(Object.keys(Ae.layers).sort()),dt=new n.cs(this.tileID,this.promoteId);dt.bucketLayerIDs=[];let it={},Bt={featureIndex:dt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ue,subdivisionGranularity:Ke},Mt=ye.familiesBySource[this.source];for(let tr in Mt){let Vr=Ae.layers[tr];if(!Vr)continue;Vr.version===1&&n.w(`Vector tile source "${this.source}" layer "${tr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let xn=Qe.encode(tr),ma=[];for(let Br=0;Br<Vr.length;Br++){let Kn=Vr.feature(Br),rn=dt.getId(Kn,tr);ma.push({feature:Kn,id:rn,index:Br,sourceLayerIndex:xn})}for(let Br of Mt[tr]){let Kn=Br[0];Kn.source!==this.source&&n.w(`layer.source = ${Kn.source} does not equal this.source = ${this.source}`),Kn.minzoom&&this.zoom<Math.floor(Kn.minzoom)||Kn.maxzoom&&this.zoom>=Kn.maxzoom||Kn.visibility!=="none"&&(h(Br,this.zoom,ue),(it[Kn.id]=Kn.createBucket({index:dt.bucketLayerIDs.length,layers:Br,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xn,sourceID:this.source})).populate(ma,Bt,this.tileID.canonical),dt.bucketLayerIDs.push(Br.map(rn=>rn.id)))}}let ut=n.bD(Bt.glyphDependencies,tr=>Object.keys(tr).map(Number));this.inFlightDependencies.forEach(tr=>tr?.abort()),this.inFlightDependencies=[];let zt=Promise.resolve({});if(Object.keys(ut).length){let tr=new AbortController;this.inFlightDependencies.push(tr),zt=Ve.sendAsync({type:"GG",data:{stacks:ut,source:this.source,tileID:this.tileID,type:"glyphs"}},tr)}let rr=Object.keys(Bt.iconDependencies),nr=Promise.resolve({});if(rr.length){let tr=new AbortController;this.inFlightDependencies.push(tr),nr=Ve.sendAsync({type:"GI",data:{icons:rr,source:this.source,tileID:this.tileID,type:"icons"}},tr)}let $e=Object.keys(Bt.patternDependencies),Fr=Promise.resolve({});if($e.length){let tr=new AbortController;this.inFlightDependencies.push(tr),Fr=Ve.sendAsync({type:"GI",data:{icons:$e,source:this.source,tileID:this.tileID,type:"patterns"}},tr)}let[Sr,kr,_i]=yield Promise.all([zt,nr,Fr]),Gt=new a(Sr),pr=new n.ct(kr,_i);for(let tr in it){let Vr=it[tr];Vr instanceof n.a6?(h(Vr.layers,this.zoom,ue),n.cu({bucket:Vr,glyphMap:Sr,glyphPositions:Gt.positions,imageMap:kr,imagePositions:pr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Bt.subdivisionGranularity})):Vr.hasPattern&&(Vr instanceof n.cv||Vr instanceof n.cw||Vr instanceof n.cx)&&(h(Vr.layers,this.zoom,ue),Vr.addFeatures(Bt,this.tileID.canonical,pr.patternPositions))}return this.status="done",{buckets:Object.values(it).filter(tr=>!tr.isEmpty()),featureIndex:dt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gt.image,imageAtlas:pr,glyphMap:this.returnDependencies?Sr:null,iconMap:this.returnDependencies?kr:null,glyphPositions:this.returnDependencies?Gt.positions:null}})}}function h(ot,Ae,ye){let ue=new n.C(Ae);for(let Ve of ot)Ve.recalculate(ue,ye)}class p{constructor(Ae,ye,ue){this.actor=Ae,this.layerIndex=ye,this.availableImages=ue,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Ae,ye){return n._(this,void 0,void 0,function*(){let ue=yield n.n(Ae.request,ye);try{return{vectorTile:new n.cy.VectorTile(new n.cz(ue.data)),rawData:ue.data,cacheControl:ue.cacheControl,expires:ue.expires}}catch(Ve){let Ke=new Uint8Array(ue.data),Qe=`Unable to parse the tile at ${Ae.request.url}, `;throw Qe+=Ke[0]===31&&Ke[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ve.message}`,new Error(Qe)}})}loadTile(Ae){return n._(this,void 0,void 0,function*(){let ye=Ae.uid,ue=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new n.cA(Ae.request),Ve=new c(Ae);this.loading[ye]=Ve;let Ke=new AbortController;Ve.abort=Ke;try{let Qe=yield this.loadVectorTile(Ae,Ke);if(delete this.loading[ye],!Qe)return null;let dt=Qe.rawData,it={};Qe.expires&&(it.expires=Qe.expires),Qe.cacheControl&&(it.cacheControl=Qe.cacheControl);let Bt={};if(ue){let ut=ue.finish();ut&&(Bt.resourceTiming=JSON.parse(JSON.stringify(ut)))}Ve.vectorTile=Qe.vectorTile;let Mt=Ve.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,Ae.subdivisionGranularity);this.loaded[ye]=Ve,this.fetching[ye]={rawTileData:dt,cacheControl:it,resourceTiming:Bt};try{let ut=yield Mt;return n.e({rawTileData:dt.slice(0)},ut,it,Bt)}finally{delete this.fetching[ye]}}catch(Qe){throw delete this.loading[ye],Ve.status="done",this.loaded[ye]=Ve,Qe}})}reloadTile(Ae){return n._(this,void 0,void 0,function*(){let ye=Ae.uid;if(!this.loaded||!this.loaded[ye])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let ue=this.loaded[ye];if(ue.showCollisionBoxes=Ae.showCollisionBoxes,ue.status==="parsing"){let Ve=yield ue.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor,Ae.subdivisionGranularity),Ke;if(this.fetching[ye]){let{rawTileData:Qe,cacheControl:dt,resourceTiming:it}=this.fetching[ye];delete this.fetching[ye],Ke=n.e({rawTileData:Qe.slice(0)},Ve,dt,it)}else Ke=Ve;return Ke}if(ue.status==="done"&&ue.vectorTile)return ue.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor,Ae.subdivisionGranularity)})}abortTile(Ae){return n._(this,void 0,void 0,function*(){let ye=this.loading,ue=Ae.uid;ye&&ye[ue]&&ye[ue].abort&&(ye[ue].abort.abort(),delete ye[ue])})}removeTile(Ae){return n._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Ae.uid]&&delete this.loaded[Ae.uid]})}}class x{constructor(){this.loaded={}}loadTile(Ae){return n._(this,void 0,void 0,function*(){let{uid:ye,encoding:ue,rawImageData:Ve,redFactor:Ke,greenFactor:Qe,blueFactor:dt,baseShift:it}=Ae,Bt=Ve.width+2,Mt=Ve.height+2,ut=n.b(Ve)?new n.R({width:Bt,height:Mt},yield n.cB(Ve,-1,-1,Bt,Mt)):Ve,zt=new n.cC(ye,ut,ue,Ke,Qe,dt,it);return this.loaded=this.loaded||{},this.loaded[ye]=zt,zt})}removeTile(Ae){let ye=this.loaded,ue=Ae.uid;ye&&ye[ue]&&delete ye[ue]}}var T,R,k=function(){if(R)return T;function ot(ye,ue){if(ye.length!==0){Ae(ye[0],ue);for(var Ve=1;Ve<ye.length;Ve++)Ae(ye[Ve],!ue)}}function Ae(ye,ue){for(var Ve=0,Ke=0,Qe=0,dt=ye.length,it=dt-1;Qe<dt;it=Qe++){var Bt=(ye[Qe][0]-ye[it][0])*(ye[it][1]+ye[Qe][1]),Mt=Ve+Bt;Ke+=Math.abs(Ve)>=Math.abs(Bt)?Ve-Mt+Bt:Bt-Mt+Ve,Ve=Mt}Ve+Ke>=0!=!!ue&&ye.reverse()}return R=1,T=function ye(ue,Ve){var Ke,Qe=ue&&ue.type;if(Qe==="FeatureCollection")for(Ke=0;Ke<ue.features.length;Ke++)ye(ue.features[Ke],Ve);else if(Qe==="GeometryCollection")for(Ke=0;Ke<ue.geometries.length;Ke++)ye(ue.geometries[Ke],Ve);else if(Qe==="Feature")ye(ue.geometry,Ve);else if(Qe==="Polygon")ot(ue.coordinates,Ve);else if(Qe==="MultiPolygon")for(Ke=0;Ke<ue.coordinates.length;Ke++)ot(ue.coordinates[Ke],Ve);return ue}}(),j=n.cD(k);let q=n.cy.VectorTileFeature.prototype.toGeoJSON;class X{constructor(Ae){this._feature=Ae,this.extent=n.Z,this.type=Ae.type,this.properties=Ae.tags,"id"in Ae&&!isNaN(Ae.id)&&(this.id=parseInt(Ae.id,10))}loadGeometry(){if(this._feature.type===1){let Ae=[];for(let ye of this._feature.geometry)Ae.push([new n.P(ye[0],ye[1])]);return Ae}{let Ae=[];for(let ye of this._feature.geometry){let ue=[];for(let Ve of ye)ue.push(new n.P(Ve[0],Ve[1]));Ae.push(ue)}return Ae}}toGeoJSON(Ae,ye,ue){return q.call(this,Ae,ye,ue)}}class re{constructor(Ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.Z,this.length=Ae.length,this._features=Ae}feature(Ae){return new X(this._features[Ae])}}var te,oe,ae,pe={exports:{}},be=function(){if(ae)return pe.exports;ae=1;var ot=n.cG(),Ae=function(){if(oe)return te;oe=1;var Mt=n.cE(),ut=n.cF().VectorTileFeature;function zt(nr,$e){this.options=$e||{},this.features=nr,this.length=nr.length}function rr(nr,$e){this.id=typeof nr.id=="number"?nr.id:void 0,this.type=nr.type,this.rawGeometry=nr.type===1?[nr.geometry]:nr.geometry,this.properties=nr.tags,this.extent=$e||4096}return te=zt,zt.prototype.feature=function(nr){return new rr(this.features[nr],this.options.extent)},rr.prototype.loadGeometry=function(){var nr=this.rawGeometry;this.geometry=[];for(var $e=0;$e<nr.length;$e++){for(var Fr=nr[$e],Sr=[],kr=0;kr<Fr.length;kr++)Sr.push(new Mt(Fr[kr][0],Fr[kr][1]));this.geometry.push(Sr)}return this.geometry},rr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var nr=this.geometry,$e=1/0,Fr=-1/0,Sr=1/0,kr=-1/0,_i=0;_i<nr.length;_i++)for(var Gt=nr[_i],pr=0;pr<Gt.length;pr++){var tr=Gt[pr];$e=Math.min($e,tr.x),Fr=Math.max(Fr,tr.x),Sr=Math.min(Sr,tr.y),kr=Math.max(kr,tr.y)}return[$e,Sr,Fr,kr]},rr.prototype.toGeoJSON=ut.prototype.toGeoJSON,te}();function ye(Mt){var ut=new ot;return function(zt,rr){for(var nr in zt.layers)rr.writeMessage(3,ue,zt.layers[nr])}(Mt,ut),ut.finish()}function ue(Mt,ut){var zt;ut.writeVarintField(15,Mt.version||1),ut.writeStringField(1,Mt.name||""),ut.writeVarintField(5,Mt.extent||4096);var rr={keys:[],values:[],keycache:{},valuecache:{}};for(zt=0;zt<Mt.length;zt++)rr.feature=Mt.feature(zt),ut.writeMessage(2,Ve,rr);var nr=rr.keys;for(zt=0;zt<nr.length;zt++)ut.writeStringField(3,nr[zt]);var $e=rr.values;for(zt=0;zt<$e.length;zt++)ut.writeMessage(4,Bt,$e[zt])}function Ve(Mt,ut){var zt=Mt.feature;zt.id!==void 0&&ut.writeVarintField(1,zt.id),ut.writeMessage(2,Ke,Mt),ut.writeVarintField(3,zt.type),ut.writeMessage(4,it,zt)}function Ke(Mt,ut){var zt=Mt.feature,rr=Mt.keys,nr=Mt.values,$e=Mt.keycache,Fr=Mt.valuecache;for(var Sr in zt.properties){var kr=zt.properties[Sr],_i=$e[Sr];if(kr!==null){_i===void 0&&(rr.push(Sr),$e[Sr]=_i=rr.length-1),ut.writeVarint(_i);var Gt=typeof kr;Gt!=="string"&&Gt!=="boolean"&&Gt!=="number"&&(kr=JSON.stringify(kr));var pr=Gt+":"+kr,tr=Fr[pr];tr===void 0&&(nr.push(kr),Fr[pr]=tr=nr.length-1),ut.writeVarint(tr)}}}function Qe(Mt,ut){return(ut<<3)+(7&Mt)}function dt(Mt){return Mt<<1^Mt>>31}function it(Mt,ut){for(var zt=Mt.loadGeometry(),rr=Mt.type,nr=0,$e=0,Fr=zt.length,Sr=0;Sr<Fr;Sr++){var kr=zt[Sr],_i=1;rr===1&&(_i=kr.length),ut.writeVarint(Qe(1,_i));for(var Gt=rr===3?kr.length-1:kr.length,pr=0;pr<Gt;pr++){pr===1&&rr!==1&&ut.writeVarint(Qe(2,Gt-1));var tr=kr[pr].x-nr,Vr=kr[pr].y-$e;ut.writeVarint(dt(tr)),ut.writeVarint(dt(Vr)),nr+=tr,$e+=Vr}rr===3&&ut.writeVarint(Qe(7,1))}}function Bt(Mt,ut){var zt=typeof Mt;zt==="string"?ut.writeStringField(1,Mt):zt==="boolean"?ut.writeBooleanField(7,Mt):zt==="number"&&(Mt%1!=0?ut.writeDoubleField(3,Mt):Mt<0?ut.writeSVarintField(6,Mt):ut.writeVarintField(5,Mt))}return pe.exports=ye,pe.exports.fromVectorTileJs=ye,pe.exports.fromGeojsonVt=function(Mt,ut){ut=ut||{};var zt={};for(var rr in Mt)zt[rr]=new Ae(Mt[rr].features,ut),zt[rr].name=rr,zt[rr].version=ut.version,zt[rr].extent=ut.extent;return ye({layers:zt})},pe.exports.GeoJSONWrapper=Ae,pe.exports}(),Fe=n.cD(be);let Y={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ot=>ot},J=Math.fround||(Z=new Float32Array(1),ot=>(Z[0]=+ot,Z[0]));var Z;let xe=3,_e=5,Be=6;class Se{constructor(Ae){this.options=Object.assign(Object.create(Y),Ae),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ae){let{log:ye,minZoom:ue,maxZoom:Ve}=this.options;ye&&console.time("total time");let Ke=`prepare ${Ae.length} points`;ye&&console.time(Ke),this.points=Ae;let Qe=[];for(let it=0;it<Ae.length;it++){let Bt=Ae[it];if(!Bt.geometry)continue;let[Mt,ut]=Bt.geometry.coordinates,zt=J(rt(Mt)),rr=J(tt(ut));Qe.push(zt,rr,1/0,it,-1,1),this.options.reduce&&Qe.push(0)}let dt=this.trees[Ve+1]=this._createTree(Qe);ye&&console.timeEnd(Ke);for(let it=Ve;it>=ue;it--){let Bt=+Date.now();dt=this.trees[it]=this._createTree(this._cluster(dt,it)),ye&&console.log("z%d: %d clusters in %dms",it,dt.numItems,+Date.now()-Bt)}return ye&&console.timeEnd("total time"),this}getClusters(Ae,ye){let ue=((Ae[0]+180)%360+360)%360-180,Ve=Math.max(-90,Math.min(90,Ae[1])),Ke=Ae[2]===180?180:((Ae[2]+180)%360+360)%360-180,Qe=Math.max(-90,Math.min(90,Ae[3]));if(Ae[2]-Ae[0]>=360)ue=-180,Ke=180;else if(ue>Ke){let ut=this.getClusters([ue,Ve,180,Qe],ye),zt=this.getClusters([-180,Ve,Ke,Qe],ye);return ut.concat(zt)}let dt=this.trees[this._limitZoom(ye)],it=dt.range(rt(ue),tt(Qe),rt(Ke),tt(Ve)),Bt=dt.data,Mt=[];for(let ut of it){let zt=this.stride*ut;Mt.push(Bt[zt+_e]>1?ke(Bt,zt,this.clusterProps):this.points[Bt[zt+xe]])}return Mt}getChildren(Ae){let ye=this._getOriginId(Ae),ue=this._getOriginZoom(Ae),Ve="No cluster with the specified id.",Ke=this.trees[ue];if(!Ke)throw new Error(Ve);let Qe=Ke.data;if(ye*this.stride>=Qe.length)throw new Error(Ve);let dt=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),it=Ke.within(Qe[ye*this.stride],Qe[ye*this.stride+1],dt),Bt=[];for(let Mt of it){let ut=Mt*this.stride;Qe[ut+4]===Ae&&Bt.push(Qe[ut+_e]>1?ke(Qe,ut,this.clusterProps):this.points[Qe[ut+xe]])}if(Bt.length===0)throw new Error(Ve);return Bt}getLeaves(Ae,ye,ue){let Ve=[];return this._appendLeaves(Ve,Ae,ye=ye||10,ue=ue||0,0),Ve}getTile(Ae,ye,ue){let Ve=this.trees[this._limitZoom(Ae)],Ke=Math.pow(2,Ae),{extent:Qe,radius:dt}=this.options,it=dt/Qe,Bt=(ue-it)/Ke,Mt=(ue+1+it)/Ke,ut={features:[]};return this._addTileFeatures(Ve.range((ye-it)/Ke,Bt,(ye+1+it)/Ke,Mt),Ve.data,ye,ue,Ke,ut),ye===0&&this._addTileFeatures(Ve.range(1-it/Ke,Bt,1,Mt),Ve.data,Ke,ue,Ke,ut),ye===Ke-1&&this._addTileFeatures(Ve.range(0,Bt,it/Ke,Mt),Ve.data,-1,ue,Ke,ut),ut.features.length?ut:null}getClusterExpansionZoom(Ae){let ye=this._getOriginZoom(Ae)-1;for(;ye<=this.options.maxZoom;){let ue=this.getChildren(Ae);if(ye++,ue.length!==1)break;Ae=ue[0].properties.cluster_id}return ye}_appendLeaves(Ae,ye,ue,Ve,Ke){let Qe=this.getChildren(ye);for(let dt of Qe){let it=dt.properties;if(it&&it.cluster?Ke+it.point_count<=Ve?Ke+=it.point_count:Ke=this._appendLeaves(Ae,it.cluster_id,ue,Ve,Ke):Ke<Ve?Ke++:Ae.push(dt),Ae.length===ue)break}return Ke}_createTree(Ae){let ye=new n.aC(Ae.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<Ae.length;ue+=this.stride)ye.add(Ae[ue],Ae[ue+1]);return ye.finish(),ye.data=Ae,ye}_addTileFeatures(Ae,ye,ue,Ve,Ke,Qe){for(let dt of Ae){let it=dt*this.stride,Bt=ye[it+_e]>1,Mt,ut,zt;if(Bt)Mt=Ye(ye,it,this.clusterProps),ut=ye[it],zt=ye[it+1];else{let $e=this.points[ye[it+xe]];Mt=$e.properties;let[Fr,Sr]=$e.geometry.coordinates;ut=rt(Fr),zt=tt(Sr)}let rr={type:1,geometry:[[Math.round(this.options.extent*(ut*Ke-ue)),Math.round(this.options.extent*(zt*Ke-Ve))]],tags:Mt},nr;nr=Bt||this.options.generateId?ye[it+xe]:this.points[ye[it+xe]].id,nr!==void 0&&(rr.id=nr),Qe.features.push(rr)}}_limitZoom(Ae){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ae),this.options.maxZoom+1))}_cluster(Ae,ye){let{radius:ue,extent:Ve,reduce:Ke,minPoints:Qe}=this.options,dt=ue/(Ve*Math.pow(2,ye)),it=Ae.data,Bt=[],Mt=this.stride;for(let ut=0;ut<it.length;ut+=Mt){if(it[ut+2]<=ye)continue;it[ut+2]=ye;let zt=it[ut],rr=it[ut+1],nr=Ae.within(it[ut],it[ut+1],dt),$e=it[ut+_e],Fr=$e;for(let Sr of nr){let kr=Sr*Mt;it[kr+2]>ye&&(Fr+=it[kr+_e])}if(Fr>$e&&Fr>=Qe){let Sr,kr=zt*$e,_i=rr*$e,Gt=-1,pr=((ut/Mt|0)<<5)+(ye+1)+this.points.length;for(let tr of nr){let Vr=tr*Mt;if(it[Vr+2]<=ye)continue;it[Vr+2]=ye;let xn=it[Vr+_e];kr+=it[Vr]*xn,_i+=it[Vr+1]*xn,it[Vr+4]=pr,Ke&&(Sr||(Sr=this._map(it,ut,!0),Gt=this.clusterProps.length,this.clusterProps.push(Sr)),Ke(Sr,this._map(it,Vr)))}it[ut+4]=pr,Bt.push(kr/Fr,_i/Fr,1/0,pr,-1,Fr),Ke&&Bt.push(Gt)}else{for(let Sr=0;Sr<Mt;Sr++)Bt.push(it[ut+Sr]);if(Fr>1)for(let Sr of nr){let kr=Sr*Mt;if(!(it[kr+2]<=ye)){it[kr+2]=ye;for(let _i=0;_i<Mt;_i++)Bt.push(it[kr+_i])}}}}return Bt}_getOriginId(Ae){return Ae-this.points.length>>5}_getOriginZoom(Ae){return(Ae-this.points.length)%32}_map(Ae,ye,ue){if(Ae[ye+_e]>1){let Qe=this.clusterProps[Ae[ye+Be]];return ue?Object.assign({},Qe):Qe}let Ve=this.points[Ae[ye+xe]].properties,Ke=this.options.map(Ve);return ue&&Ke===Ve?Object.assign({},Ke):Ke}}function ke(ot,Ae,ye){return{type:"Feature",id:ot[Ae+xe],properties:Ye(ot,Ae,ye),geometry:{type:"Point",coordinates:[(ue=ot[Ae],360*(ue-.5)),_t(ot[Ae+1])]}};var ue}function Ye(ot,Ae,ye){let ue=ot[Ae+_e],Ve=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,Ke=ot[Ae+Be],Qe=Ke===-1?{}:Object.assign({},ye[Ke]);return Object.assign(Qe,{cluster:!0,cluster_id:ot[Ae+xe],point_count:ue,point_count_abbreviated:Ve})}function rt(ot){return ot/360+.5}function tt(ot){let Ae=Math.sin(ot*Math.PI/180),ye=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return ye<0?0:ye>1?1:ye}function _t(ot){let Ae=(180-360*ot)*Math.PI/180;return 360*Math.atan(Math.exp(Ae))/Math.PI-90}function Zt(ot,Ae,ye,ue){let Ve=ue,Ke=Ae+(ye-Ae>>1),Qe,dt=ye-Ae,it=ot[Ae],Bt=ot[Ae+1],Mt=ot[ye],ut=ot[ye+1];for(let zt=Ae+3;zt<ye;zt+=3){let rr=Vt(ot[zt],ot[zt+1],it,Bt,Mt,ut);if(rr>Ve)Qe=zt,Ve=rr;else if(rr===Ve){let nr=Math.abs(zt-Ke);nr<dt&&(Qe=zt,dt=nr)}}Ve>ue&&(Qe-Ae>3&&Zt(ot,Ae,Qe,ue),ot[Qe+2]=Ve,ye-Qe>3&&Zt(ot,Qe,ye,ue))}function Vt(ot,Ae,ye,ue,Ve,Ke){let Qe=Ve-ye,dt=Ke-ue;if(Qe!==0||dt!==0){let it=((ot-ye)*Qe+(Ae-ue)*dt)/(Qe*Qe+dt*dt);it>1?(ye=Ve,ue=Ke):it>0&&(ye+=Qe*it,ue+=dt*it)}return Qe=ot-ye,dt=Ae-ue,Qe*Qe+dt*dt}function cr(ot,Ae,ye,ue){let Ve={id:ot??null,type:Ae,geometry:ye,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")Wt(Ve,ye);else if(Ae==="Polygon")Wt(Ve,ye[0]);else if(Ae==="MultiLineString")for(let Ke of ye)Wt(Ve,Ke);else if(Ae==="MultiPolygon")for(let Ke of ye)Wt(Ve,Ke[0]);return Ve}function Wt(ot,Ae){for(let ye=0;ye<Ae.length;ye+=3)ot.minX=Math.min(ot.minX,Ae[ye]),ot.minY=Math.min(ot.minY,Ae[ye+1]),ot.maxX=Math.max(ot.maxX,Ae[ye]),ot.maxY=Math.max(ot.maxY,Ae[ye+1])}function Lt(ot,Ae,ye,ue){if(!Ae.geometry)return;let Ve=Ae.geometry.coordinates;if(Ve&&Ve.length===0)return;let Ke=Ae.geometry.type,Qe=Math.pow(ye.tolerance/((1<<ye.maxZoom)*ye.extent),2),dt=[],it=Ae.id;if(ye.promoteId?it=Ae.properties[ye.promoteId]:ye.generateId&&(it=ue||0),Ke==="Point")vr(Ve,dt);else if(Ke==="MultiPoint")for(let Bt of Ve)vr(Bt,dt);else if(Ke==="LineString")Pr(Ve,dt,Qe,!1);else if(Ke==="MultiLineString"){if(ye.lineMetrics){for(let Bt of Ve)dt=[],Pr(Bt,dt,Qe,!1),ot.push(cr(it,"LineString",dt,Ae.properties));return}dr(Ve,dt,Qe,!1)}else if(Ke==="Polygon")dr(Ve,dt,Qe,!0);else{if(Ke!=="MultiPolygon"){if(Ke==="GeometryCollection"){for(let Bt of Ae.geometry.geometries)Lt(ot,{id:it,geometry:Bt,properties:Ae.properties},ye,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Bt of Ve){let Mt=[];dr(Bt,Mt,Qe,!0),dt.push(Mt)}}ot.push(cr(it,Ke,dt,Ae.properties))}function vr(ot,Ae){Ae.push(Nr(ot[0]),Ai(ot[1]),0)}function Pr(ot,Ae,ye,ue){let Ve,Ke,Qe=0;for(let it=0;it<ot.length;it++){let Bt=Nr(ot[it][0]),Mt=Ai(ot[it][1]);Ae.push(Bt,Mt,0),it>0&&(Qe+=ue?(Ve*Mt-Bt*Ke)/2:Math.sqrt(Math.pow(Bt-Ve,2)+Math.pow(Mt-Ke,2))),Ve=Bt,Ke=Mt}let dt=Ae.length-3;Ae[2]=1,Zt(Ae,0,dt,ye),Ae[dt+2]=1,Ae.size=Math.abs(Qe),Ae.start=0,Ae.end=Ae.size}function dr(ot,Ae,ye,ue){for(let Ve=0;Ve<ot.length;Ve++){let Ke=[];Pr(ot[Ve],Ke,ye,ue),Ae.push(Ke)}}function Nr(ot){return ot/360+.5}function Ai(ot){let Ae=Math.sin(ot*Math.PI/180),ye=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return ye<0?0:ye>1?1:ye}function Wr(ot,Ae,ye,ue,Ve,Ke,Qe,dt){if(ue/=Ae,Ke>=(ye/=Ae)&&Qe<ue)return ot;if(Qe<ye||Ke>=ue)return null;let it=[];for(let Bt of ot){let Mt=Bt.geometry,ut=Bt.type,zt=Ve===0?Bt.minX:Bt.minY,rr=Ve===0?Bt.maxX:Bt.maxY;if(zt>=ye&&rr<ue){it.push(Bt);continue}if(rr<ye||zt>=ue)continue;let nr=[];if(ut==="Point"||ut==="MultiPoint")Di(Mt,nr,ye,ue,Ve);else if(ut==="LineString")ui(Mt,nr,ye,ue,Ve,!1,dt.lineMetrics);else if(ut==="MultiLineString")Ni(Mt,nr,ye,ue,Ve,!1);else if(ut==="Polygon")Ni(Mt,nr,ye,ue,Ve,!0);else if(ut==="MultiPolygon")for(let $e of Mt){let Fr=[];Ni($e,Fr,ye,ue,Ve,!0),Fr.length&&nr.push(Fr)}if(nr.length){if(dt.lineMetrics&&ut==="LineString"){for(let $e of nr)it.push(cr(Bt.id,ut,$e,Bt.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(nr.length===1?(ut="LineString",nr=nr[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=nr.length===3?"Point":"MultiPoint"),it.push(cr(Bt.id,ut,nr,Bt.tags))}}return it.length?it:null}function Di(ot,Ae,ye,ue,Ve){for(let Ke=0;Ke<ot.length;Ke+=3){let Qe=ot[Ke+Ve];Qe>=ye&&Qe<=ue&&oi(Ae,ot[Ke],ot[Ke+1],ot[Ke+2])}}function ui(ot,Ae,ye,ue,Ve,Ke,Qe){let dt=tn(ot),it=Ve===0?Eo:qs,Bt,Mt,ut=ot.start;for(let Fr=0;Fr<ot.length-3;Fr+=3){let Sr=ot[Fr],kr=ot[Fr+1],_i=ot[Fr+2],Gt=ot[Fr+3],pr=ot[Fr+4],tr=Ve===0?Sr:kr,Vr=Ve===0?Gt:pr,xn=!1;Qe&&(Bt=Math.sqrt(Math.pow(Sr-Gt,2)+Math.pow(kr-pr,2))),tr<ye?Vr>ye&&(Mt=it(dt,Sr,kr,Gt,pr,ye),Qe&&(dt.start=ut+Bt*Mt)):tr>ue?Vr<ue&&(Mt=it(dt,Sr,kr,Gt,pr,ue),Qe&&(dt.start=ut+Bt*Mt)):oi(dt,Sr,kr,_i),Vr<ye&&tr>=ye&&(Mt=it(dt,Sr,kr,Gt,pr,ye),xn=!0),Vr>ue&&tr<=ue&&(Mt=it(dt,Sr,kr,Gt,pr,ue),xn=!0),!Ke&&xn&&(Qe&&(dt.end=ut+Bt*Mt),Ae.push(dt),dt=tn(ot)),Qe&&(ut+=Bt)}let zt=ot.length-3,rr=ot[zt],nr=ot[zt+1],$e=Ve===0?rr:nr;$e>=ye&&$e<=ue&&oi(dt,rr,nr,ot[zt+2]),zt=dt.length-3,Ke&&zt>=3&&(dt[zt]!==dt[0]||dt[zt+1]!==dt[1])&&oi(dt,dt[0],dt[1],dt[2]),dt.length&&Ae.push(dt)}function tn(ot){let Ae=[];return Ae.size=ot.size,Ae.start=ot.start,Ae.end=ot.end,Ae}function Ni(ot,Ae,ye,ue,Ve,Ke){for(let Qe of ot)ui(Qe,Ae,ye,ue,Ve,Ke,!1)}function oi(ot,Ae,ye,ue){ot.push(Ae,ye,ue)}function Eo(ot,Ae,ye,ue,Ve,Ke){let Qe=(Ke-Ae)/(ue-Ae);return oi(ot,Ke,ye+(Ve-ye)*Qe,1),Qe}function qs(ot,Ae,ye,ue,Ve,Ke){let Qe=(Ke-ye)/(Ve-ye);return oi(ot,Ae+(ue-Ae)*Qe,Ke,1),Qe}function ls(ot,Ae){let ye=[];for(let ue=0;ue<ot.length;ue++){let Ve=ot[ue],Ke=Ve.type,Qe;if(Ke==="Point"||Ke==="MultiPoint"||Ke==="LineString")Qe=Zs(Ve.geometry,Ae);else if(Ke==="MultiLineString"||Ke==="Polygon"){Qe=[];for(let dt of Ve.geometry)Qe.push(Zs(dt,Ae))}else if(Ke==="MultiPolygon"){Qe=[];for(let dt of Ve.geometry){let it=[];for(let Bt of dt)it.push(Zs(Bt,Ae));Qe.push(it)}}ye.push(cr(Ve.id,Ke,Qe,Ve.tags))}return ye}function Zs(ot,Ae){let ye=[];ye.size=ot.size,ot.start!==void 0&&(ye.start=ot.start,ye.end=ot.end);for(let ue=0;ue<ot.length;ue+=3)ye.push(ot[ue]+Ae,ot[ue+1],ot[ue+2]);return ye}function Aa(ot,Ae){if(ot.transformed)return ot;let ye=1<<ot.z,ue=ot.x,Ve=ot.y;for(let Ke of ot.features){let Qe=Ke.geometry,dt=Ke.type;if(Ke.geometry=[],dt===1)for(let it=0;it<Qe.length;it+=2)Ke.geometry.push(_s(Qe[it],Qe[it+1],Ae,ye,ue,Ve));else for(let it=0;it<Qe.length;it++){let Bt=[];for(let Mt=0;Mt<Qe[it].length;Mt+=2)Bt.push(_s(Qe[it][Mt],Qe[it][Mt+1],Ae,ye,ue,Ve));Ke.geometry.push(Bt)}}return ot.transformed=!0,ot}function _s(ot,Ae,ye,ue,Ve,Ke){return[Math.round(ye*(ot*ue-Ve)),Math.round(ye*(Ae*ue-Ke))]}function oo(ot,Ae,ye,ue,Ve){let Ke=Ae===Ve.maxZoom?0:Ve.tolerance/((1<<Ae)*Ve.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:ot.length,source:null,x:ye,y:ue,z:Ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let dt of ot)ys(Qe,dt,Ke,Ve);return Qe}function ys(ot,Ae,ye,ue){let Ve=Ae.geometry,Ke=Ae.type,Qe=[];if(ot.minX=Math.min(ot.minX,Ae.minX),ot.minY=Math.min(ot.minY,Ae.minY),ot.maxX=Math.max(ot.maxX,Ae.maxX),ot.maxY=Math.max(ot.maxY,Ae.maxY),Ke==="Point"||Ke==="MultiPoint")for(let dt=0;dt<Ve.length;dt+=3)Qe.push(Ve[dt],Ve[dt+1]),ot.numPoints++,ot.numSimplified++;else if(Ke==="LineString")Gr(Qe,Ve,ot,ye,!1,!1);else if(Ke==="MultiLineString"||Ke==="Polygon")for(let dt=0;dt<Ve.length;dt++)Gr(Qe,Ve[dt],ot,ye,Ke==="Polygon",dt===0);else if(Ke==="MultiPolygon")for(let dt=0;dt<Ve.length;dt++){let it=Ve[dt];for(let Bt=0;Bt<it.length;Bt++)Gr(Qe,it[Bt],ot,ye,!0,Bt===0)}if(Qe.length){let dt=Ae.tags||null;if(Ke==="LineString"&&ue.lineMetrics){dt={};for(let Bt in Ae.tags)dt[Bt]=Ae.tags[Bt];dt.mapbox_clip_start=Ve.start/Ve.size,dt.mapbox_clip_end=Ve.end/Ve.size}let it={geometry:Qe,type:Ke==="Polygon"||Ke==="MultiPolygon"?3:Ke==="LineString"||Ke==="MultiLineString"?2:1,tags:dt};Ae.id!==null&&(it.id=Ae.id),ot.features.push(it)}}function Gr(ot,Ae,ye,ue,Ve,Ke){let Qe=ue*ue;if(ue>0&&Ae.size<(Ve?Qe:ue))return void(ye.numPoints+=Ae.length/3);let dt=[];for(let it=0;it<Ae.length;it+=3)(ue===0||Ae[it+2]>Qe)&&(ye.numSimplified++,dt.push(Ae[it],Ae[it+1])),ye.numPoints++;Ve&&function(it,Bt){let Mt=0;for(let ut=0,zt=it.length,rr=zt-2;ut<zt;rr=ut,ut+=2)Mt+=(it[ut]-it[rr])*(it[ut+1]+it[rr+1]);if(Mt>0===Bt)for(let ut=0,zt=it.length;ut<zt/2;ut+=2){let rr=it[ut],nr=it[ut+1];it[ut]=it[zt-2-ut],it[ut+1]=it[zt-1-ut],it[zt-2-ut]=rr,it[zt-1-ut]=nr}}(dt,Ke),ot.push(dt)}let Jt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class kt{constructor(Ae,ye){let ue=(ye=this.options=function(Ke,Qe){for(let dt in Qe)Ke[dt]=Qe[dt];return Ke}(Object.create(Jt),ye)).debug;if(ue&&console.time("preprocess data"),ye.maxZoom<0||ye.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ye.promoteId&&ye.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ve=function(Ke,Qe){let dt=[];if(Ke.type==="FeatureCollection")for(let it=0;it<Ke.features.length;it++)Lt(dt,Ke.features[it],Qe,it);else Lt(dt,Ke.type==="Feature"?Ke:{geometry:Ke},Qe);return dt}(Ae,ye);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ye.indexMaxZoom,ye.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ve=function(Ke,Qe){let dt=Qe.buffer/Qe.extent,it=Ke,Bt=Wr(Ke,1,-1-dt,dt,0,-1,2,Qe),Mt=Wr(Ke,1,1-dt,2+dt,0,-1,2,Qe);return(Bt||Mt)&&(it=Wr(Ke,1,-dt,1+dt,0,-1,2,Qe)||[],Bt&&(it=ls(Bt,1).concat(it)),Mt&&(it=it.concat(ls(Mt,-1)))),it}(Ve,ye),Ve.length&&this.splitTile(Ve,0,0,0),ue&&(Ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Ae,ye,ue,Ve,Ke,Qe,dt){let it=[Ae,ye,ue,Ve],Bt=this.options,Mt=Bt.debug;for(;it.length;){Ve=it.pop(),ue=it.pop(),ye=it.pop(),Ae=it.pop();let ut=1<<ye,zt=Cr(ye,ue,Ve),rr=this.tiles[zt];if(!rr&&(Mt>1&&console.time("creation"),rr=this.tiles[zt]=oo(Ae,ye,ue,Ve,Bt),this.tileCoords.push({z:ye,x:ue,y:Ve}),Mt)){Mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ye,ue,Ve,rr.numFeatures,rr.numPoints,rr.numSimplified),console.timeEnd("creation"));let xn=`z${ye}`;this.stats[xn]=(this.stats[xn]||0)+1,this.total++}if(rr.source=Ae,Ke==null){if(ye===Bt.indexMaxZoom||rr.numPoints<=Bt.indexMaxPoints)continue}else{if(ye===Bt.maxZoom||ye===Ke)continue;if(Ke!=null){let xn=Ke-ye;if(ue!==Qe>>xn||Ve!==dt>>xn)continue}}if(rr.source=null,Ae.length===0)continue;Mt>1&&console.time("clipping");let nr=.5*Bt.buffer/Bt.extent,$e=.5-nr,Fr=.5+nr,Sr=1+nr,kr=null,_i=null,Gt=null,pr=null,tr=Wr(Ae,ut,ue-nr,ue+Fr,0,rr.minX,rr.maxX,Bt),Vr=Wr(Ae,ut,ue+$e,ue+Sr,0,rr.minX,rr.maxX,Bt);Ae=null,tr&&(kr=Wr(tr,ut,Ve-nr,Ve+Fr,1,rr.minY,rr.maxY,Bt),_i=Wr(tr,ut,Ve+$e,Ve+Sr,1,rr.minY,rr.maxY,Bt),tr=null),Vr&&(Gt=Wr(Vr,ut,Ve-nr,Ve+Fr,1,rr.minY,rr.maxY,Bt),pr=Wr(Vr,ut,Ve+$e,Ve+Sr,1,rr.minY,rr.maxY,Bt),Vr=null),Mt>1&&console.timeEnd("clipping"),it.push(kr||[],ye+1,2*ue,2*Ve),it.push(_i||[],ye+1,2*ue,2*Ve+1),it.push(Gt||[],ye+1,2*ue+1,2*Ve),it.push(pr||[],ye+1,2*ue+1,2*Ve+1)}}getTile(Ae,ye,ue){Ae=+Ae,ye=+ye,ue=+ue;let Ve=this.options,{extent:Ke,debug:Qe}=Ve;if(Ae<0||Ae>24)return null;let dt=1<<Ae,it=Cr(Ae,ye=ye+dt&dt-1,ue);if(this.tiles[it])return Aa(this.tiles[it],Ke);Qe>1&&console.log("drilling down to z%d-%d-%d",Ae,ye,ue);let Bt,Mt=Ae,ut=ye,zt=ue;for(;!Bt&&Mt>0;)Mt--,ut>>=1,zt>>=1,Bt=this.tiles[Cr(Mt,ut,zt)];return Bt&&Bt.source?(Qe>1&&(console.log("found parent tile z%d-%d-%d",Mt,ut,zt),console.time("drilling down")),this.splitTile(Bt.source,Mt,ut,zt,Ae,ye,ue),Qe>1&&console.timeEnd("drilling down"),this.tiles[it]?Aa(this.tiles[it],Ke):null):null}}function Cr(ot,Ae,ye){return 32*((1<<ot)*ye+Ae)+ot}function ai(ot,Ae){return Ae?ot.properties[Ae]:ot.id}function Rr(ot,Ae){if(ot==null)return!0;if(ot.type==="Feature")return ai(ot,Ae)!=null;if(ot.type==="FeatureCollection"){let ye=new Set;for(let ue of ot.features){let Ve=ai(ue,Ae);if(Ve==null||ye.has(Ve))return!1;ye.add(Ve)}return!0}return!1}function Xi(ot,Ae){let ye=new Map;if(ot!=null)if(ot.type==="Feature")ye.set(ai(ot,Ae),ot);else for(let ue of ot.features)ye.set(ai(ue,Ae),ue);return ye}class cs extends p{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Ae,ye){return n._(this,void 0,void 0,function*(){let ue=Ae.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let Ve=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!Ve)return null;let Ke=new re(Ve.features),Qe=Fe(Ke);return Qe.byteOffset===0&&Qe.byteLength===Qe.buffer.byteLength||(Qe=new Uint8Array(Qe)),{vectorTile:Ke,rawData:Qe.buffer}})}loadData(Ae){return n._(this,void 0,void 0,function*(){var ye;(ye=this._pendingRequest)===null||ye===void 0||ye.abort();let ue=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new n.cA(Ae.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Ae,this._pendingRequest),this._geoJSONIndex=Ae.cluster?new Se(function({superclusterOptions:Qe,clusterProperties:dt}){if(!dt||!Qe)return Qe;let it={},Bt={},Mt={accumulated:null,zoom:0},ut={properties:null},zt=Object.keys(dt);for(let rr of zt){let[nr,$e]=dt[rr],Fr=n.cH($e),Sr=n.cH(typeof nr=="string"?[nr,["accumulated"],["get",rr]]:nr);it[rr]=Fr.value,Bt[rr]=Sr.value}return Qe.map=rr=>{ut.properties=rr;let nr={};for(let $e of zt)nr[$e]=it[$e].evaluate(Mt,ut);return nr},Qe.reduce=(rr,nr)=>{ut.properties=nr;for(let $e of zt)Mt.accumulated=rr[$e],rr[$e]=Bt[$e].evaluate(Mt,ut)},Qe}(Ae)).load((yield this._pendingData).features):(Ve=yield this._pendingData,new kt(Ve,Ae.geojsonVtOptions)),this.loaded={};let Ke={};if(ue){let Qe=ue.finish();Qe&&(Ke.resourceTiming={},Ke.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(Qe)))}return Ke}catch(Ke){if(delete this._pendingRequest,n.cl(Ke))return{abandoned:!0};throw Ke}var Ve})}getData(){return n._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Ae){let ye=this.loaded;return ye&&ye[Ae.uid]?super.reloadTile(Ae):this.loadTile(Ae)}loadAndProcessGeoJSON(Ae,ye){return n._(this,void 0,void 0,function*(){let ue=yield this.loadGeoJSON(Ae,ye);if(delete this._pendingRequest,typeof ue!="object")throw new Error(`Input data given to '${Ae.source}' is not a valid GeoJSON object.`);if(j(ue,!0),Ae.filter){let Ve=n.cH(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));ue={type:"FeatureCollection",features:ue.features.filter(Qe=>Ve.value.evaluate({zoom:0},Qe))}}return ue})}loadGeoJSON(Ae,ye){return n._(this,void 0,void 0,function*(){let{promoteId:ue}=Ae;if(Ae.request){let Ve=yield n.j(Ae.request,ye);return this._dataUpdateable=Rr(Ve.data,ue)?Xi(Ve.data,ue):void 0,Ve.data}if(typeof Ae.data=="string")try{let Ve=JSON.parse(Ae.data);return this._dataUpdateable=Rr(Ve,ue)?Xi(Ve,ue):void 0,Ve}catch{throw new Error(`Input data given to '${Ae.source}' is not a valid GeoJSON object.`)}if(!Ae.dataDiff)throw new Error(`Input data given to '${Ae.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Ae.source}`);return function(Ve,Ke,Qe){var dt,it,Bt,Mt;if(Ke.removeAll&&Ve.clear(),Ke.remove)for(let ut of Ke.remove)Ve.delete(ut);if(Ke.add)for(let ut of Ke.add){let zt=ai(ut,Qe);zt!=null&&Ve.set(zt,ut)}if(Ke.update)for(let ut of Ke.update){let zt=Ve.get(ut.id);if(zt==null)continue;let rr=!ut.removeAllProperties&&(((dt=ut.removeProperties)===null||dt===void 0?void 0:dt.length)>0||((it=ut.addOrUpdateProperties)===null||it===void 0?void 0:it.length)>0);if((ut.newGeometry||ut.removeAllProperties||rr)&&(zt=Object.assign({},zt),Ve.set(ut.id,zt),rr&&(zt.properties=Object.assign({},zt.properties))),ut.newGeometry&&(zt.geometry=ut.newGeometry),ut.removeAllProperties)zt.properties={};else if(((Bt=ut.removeProperties)===null||Bt===void 0?void 0:Bt.length)>0)for(let nr of ut.removeProperties)Object.prototype.hasOwnProperty.call(zt.properties,nr)&&delete zt.properties[nr];if(((Mt=ut.addOrUpdateProperties)===null||Mt===void 0?void 0:Mt.length)>0)for(let{key:nr,value:$e}of ut.addOrUpdateProperties)zt.properties[nr]=$e}}(this._dataUpdateable,Ae.dataDiff,ue),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Ae){return n._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Ae){return this._geoJSONIndex.getClusterExpansionZoom(Ae.clusterId)}getClusterChildren(Ae){return this._geoJSONIndex.getChildren(Ae.clusterId)}getClusterLeaves(Ae){return this._geoJSONIndex.getLeaves(Ae.clusterId,Ae.limit,Ae.offset)}}class zn{constructor(Ae){this.self=Ae,this.actor=new n.H(Ae),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ye,ue)=>{if(this.externalWorkerSourceTypes[ye])throw new Error(`Worker source with name "${ye}" already registered.`);this.externalWorkerSourceTypes[ye]=ue},this.self.addProtocol=n.cn,this.self.removeProtocol=n.co,this.self.registerRTLTextPlugin=ye=>{n.cI.setMethods(ye)},this.actor.registerMessageHandler("LDT",(ye,ue)=>this._getDEMWorkerSource(ye,ue.source).loadTile(ue)),this.actor.registerMessageHandler("RDT",(ye,ue)=>n._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ye,ue.source).removeTile(ue)})),this.actor.registerMessageHandler("GCEZ",(ye,ue)=>n._(this,void 0,void 0,function*(){return this._getWorkerSource(ye,ue.type,ue.source).getClusterExpansionZoom(ue)})),this.actor.registerMessageHandler("GCC",(ye,ue)=>n._(this,void 0,void 0,function*(){return this._getWorkerSource(ye,ue.type,ue.source).getClusterChildren(ue)})),this.actor.registerMessageHandler("GCL",(ye,ue)=>n._(this,void 0,void 0,function*(){return this._getWorkerSource(ye,ue.type,ue.source).getClusterLeaves(ue)})),this.actor.registerMessageHandler("LD",(ye,ue)=>this._getWorkerSource(ye,ue.type,ue.source).loadData(ue)),this.actor.registerMessageHandler("GD",(ye,ue)=>this._getWorkerSource(ye,ue.type,ue.source).getData()),this.actor.registerMessageHandler("LT",(ye,ue)=>this._getWorkerSource(ye,ue.type,ue.source).loadTile(ue)),this.actor.registerMessageHandler("RT",(ye,ue)=>this._getWorkerSource(ye,ue.type,ue.source).reloadTile(ue)),this.actor.registerMessageHandler("AT",(ye,ue)=>this._getWorkerSource(ye,ue.type,ue.source).abortTile(ue)),this.actor.registerMessageHandler("RMT",(ye,ue)=>this._getWorkerSource(ye,ue.type,ue.source).removeTile(ue)),this.actor.registerMessageHandler("RS",(ye,ue)=>n._(this,void 0,void 0,function*(){if(!this.workerSources[ye]||!this.workerSources[ye][ue.type]||!this.workerSources[ye][ue.type][ue.source])return;let Ve=this.workerSources[ye][ue.type][ue.source];delete this.workerSources[ye][ue.type][ue.source],Ve.removeSource!==void 0&&Ve.removeSource(ue)})),this.actor.registerMessageHandler("RM",ye=>n._(this,void 0,void 0,function*(){delete this.layerIndexes[ye],delete this.availableImages[ye],delete this.workerSources[ye],delete this.demWorkerSources[ye]})),this.actor.registerMessageHandler("SR",(ye,ue)=>n._(this,void 0,void 0,function*(){this.referrer=ue})),this.actor.registerMessageHandler("SRPS",(ye,ue)=>this._syncRTLPluginState(ye,ue)),this.actor.registerMessageHandler("IS",(ye,ue)=>n._(this,void 0,void 0,function*(){this.self.importScripts(ue)})),this.actor.registerMessageHandler("SI",(ye,ue)=>this._setImages(ye,ue)),this.actor.registerMessageHandler("UL",(ye,ue)=>n._(this,void 0,void 0,function*(){this._getLayerIndex(ye).update(ue.layers,ue.removedIds)})),this.actor.registerMessageHandler("SL",(ye,ue)=>n._(this,void 0,void 0,function*(){this._getLayerIndex(ye).replace(ue)}))}_setImages(Ae,ye){return n._(this,void 0,void 0,function*(){this.availableImages[Ae]=ye;for(let ue in this.workerSources[Ae]){let Ve=this.workerSources[Ae][ue];for(let Ke in Ve)Ve[Ke].availableImages=ye}})}_syncRTLPluginState(Ae,ye){return n._(this,void 0,void 0,function*(){return yield n.cI.syncState(ye,this.self.importScripts)})}_getAvailableImages(Ae){let ye=this.availableImages[Ae];return ye||(ye=[]),ye}_getLayerIndex(Ae){let ye=this.layerIndexes[Ae];return ye||(ye=this.layerIndexes[Ae]=new s),ye}_getWorkerSource(Ae,ye,ue){if(this.workerSources[Ae]||(this.workerSources[Ae]={}),this.workerSources[Ae][ye]||(this.workerSources[Ae][ye]={}),!this.workerSources[Ae][ye][ue]){let Ve={sendAsync:(Ke,Qe)=>(Ke.targetMapId=Ae,this.actor.sendAsync(Ke,Qe))};switch(ye){case"vector":this.workerSources[Ae][ye][ue]=new p(Ve,this._getLayerIndex(Ae),this._getAvailableImages(Ae));break;case"geojson":this.workerSources[Ae][ye][ue]=new cs(Ve,this._getLayerIndex(Ae),this._getAvailableImages(Ae));break;default:this.workerSources[Ae][ye][ue]=new this.externalWorkerSourceTypes[ye](Ve,this._getLayerIndex(Ae),this._getAvailableImages(Ae))}}return this.workerSources[Ae][ye][ue]}_getDEMWorkerSource(Ae,ye){return this.demWorkerSources[Ae]||(this.demWorkerSources[Ae]={}),this.demWorkerSources[Ae][ye]||(this.demWorkerSources[Ae][ye]=new x),this.demWorkerSources[Ae][ye]}}return n.i(self)&&(self.worker=new zn(self)),zn}),r("index",["exports","./shared"],function(n,s){"use strict";var a="5.3.1";function c(){var C=new s.A(4);return s.A!=Float32Array&&(C[1]=0,C[2]=0),C[0]=1,C[3]=1,C}let h,p,x={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(C,o,u){let _=requestAnimationFrame(S=>{v(),o(S)}),{unsubscribe:v}=s.s(C.signal,"abort",()=>{v(),cancelAnimationFrame(_),u(s.c())},!1)},frameAsync(C){return new Promise((o,u)=>{this.frame(C,o,u)})},getImageData(C,o=0){return this.getImageCanvasContext(C).getImageData(-o,-o,C.width+2*o,C.height+2*o)},getImageCanvasContext(C){let o=window.document.createElement("canvas"),u=o.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return o.width=C.width,o.height=C.height,u.drawImage(C,0,0,C.width,C.height),u},resolveURL:C=>(h||(h=document.createElement("a")),h.href=C,h.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(p==null&&(p=matchMedia("(prefers-reduced-motion: reduce)")),p.matches)}};class T{static testProp(o){if(!T.docStyle)return o[0];for(let u=0;u<o.length;u++)if(o[u]in T.docStyle)return o[u];return o[0]}static create(o,u,_){let v=window.document.createElement(o);return u!==void 0&&(v.className=u),_&&_.appendChild(v),v}static createNS(o,u){return window.document.createElementNS(o,u)}static disableDrag(){T.docStyle&&T.selectProp&&(T.userSelect=T.docStyle[T.selectProp],T.docStyle[T.selectProp]="none")}static enableDrag(){T.docStyle&&T.selectProp&&(T.docStyle[T.selectProp]=T.userSelect)}static setTransform(o,u){o.style[T.transformProp]=u}static addEventListener(o,u,_,v={}){o.addEventListener(u,_,"passive"in v?v:v.capture)}static removeEventListener(o,u,_,v={}){o.removeEventListener(u,_,"passive"in v?v:v.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",T.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",T.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",T.suppressClickInternal,!0)},0)}static getScale(o){let u=o.getBoundingClientRect();return{x:u.width/o.offsetWidth||1,y:u.height/o.offsetHeight||1,boundingClientRect:u}}static getPoint(o,u,_){let v=u.boundingClientRect;return new s.P((_.clientX-v.left)/u.x-o.clientLeft,(_.clientY-v.top)/u.y-o.clientTop)}static mousePos(o,u){let _=T.getScale(o);return T.getPoint(o,_,u)}static touchPos(o,u){let _=[],v=T.getScale(o);for(let S=0;S<u.length;S++)_.push(T.getPoint(o,v,u[S]));return _}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}static sanitize(o){let u=new DOMParser().parseFromString(o,"text/html").body||document.createElement("body"),_=u.querySelectorAll("script");for(let v of _)v.remove();return T.clean(u),u.innerHTML}static isPossiblyDangerous(o,u){let _=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(o)||!_.includes("javascript:")&&!_.includes("data:"))||!!o.startsWith("on")||void 0}static clean(o){let u=o.children;for(let _ of u)T.removeAttributes(_),T.clean(_)}static removeAttributes(o){for(let{name:u,value:_}of o.attributes)T.isPossiblyDangerous(u,_)&&o.removeAttribute(u)}}T.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,T.selectProp=T.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),T.transformProp=T.testProp(["transform","WebkitTransform"]);let R={supported:!1,testSupport:function(C){!q&&j&&(X?re(C):k=C)}},k,j,q=!1,X=!1;function re(C){let o=C.createTexture();C.bindTexture(C.TEXTURE_2D,o);try{if(C.texImage2D(C.TEXTURE_2D,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,j),C.isContextLost())return;R.supported=!0}catch{}C.deleteTexture(o),q=!0}var te;typeof document<"u"&&(j=document.createElement("img"),j.onload=()=>{k&&re(k),k=null,X=!0},j.onerror=()=>{q=!0,k=null},j.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(C){let o,u,_,v;C.resetRequestQueue=()=>{o=[],u=0,_=0,v={}},C.addThrottleControl=V=>{let H=_++;return v[H]=V,H},C.removeThrottleControl=V=>{delete v[V],O()},C.getImage=(V,H,Q=!0)=>new Promise((ne,ie)=>{R.supported&&(V.headers||(V.headers={}),V.headers.accept="image/webp,*/*"),s.e(V,{type:"image"}),o.push({abortController:H,requestParameters:V,supportImageRefresh:Q,state:"queued",onError:de=>{ie(de)},onSuccess:de=>{ne(de)}}),O()});let S=V=>s._(this,void 0,void 0,function*(){V.state="running";let{requestParameters:H,supportImageRefresh:Q,onError:ne,onSuccess:ie,abortController:de}=V,ge=Q===!1&&!s.i(self)&&!s.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce((Le,Ne)=>Le&&Ne==="accept",!0));u++;let Pe=ge?z(H,de):s.m(H,de);try{let Le=yield Pe;delete V.abortController,V.state="completed",Le.data instanceof HTMLImageElement||s.b(Le.data)?ie(Le):Le.data&&ie({data:yield(Ie=Le.data,typeof createImageBitmap=="function"?s.f(Ie):s.h(Ie)),cacheControl:Le.cacheControl,expires:Le.expires})}catch(Le){delete V.abortController,ne(Le)}finally{u--,O()}var Ie}),O=()=>{let V=(()=>{for(let H of Object.keys(v))if(v[H]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=u;H<V&&o.length>0;H++){let Q=o.shift();Q.abortController.signal.aborted?H--:S(Q)}},z=(V,H)=>new Promise((Q,ne)=>{let ie=new Image,de=V.url,ge=V.credentials;ge&&ge==="include"?ie.crossOrigin="use-credentials":(ge&&ge==="same-origin"||!s.d(de))&&(ie.crossOrigin="anonymous"),H.signal.addEventListener("abort",()=>{ie.src="",ne(s.c())}),ie.fetchPriority="high",ie.onload=()=>{ie.onerror=ie.onload=null,Q({data:ie})},ie.onerror=()=>{ie.onerror=ie.onload=null,H.signal.aborted||ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ie.src=de})}(te||(te={})),te.resetRequestQueue();class oe{constructor(o){this._transformRequestFn=o}transformRequest(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function ae(C){let o=[];if(typeof C=="string")o.push({id:"default",url:C});else if(C&&C.length>0){let u=[];for(let{id:_,url:v}of C){let S=`${_}${v}`;u.indexOf(S)===-1&&(u.push(S),o.push({id:_,url:v}))}}return o}function pe(C,o,u){try{let _=new URL(C);return _.pathname+=`${o}${u}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${C}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class be{constructor(o,u,_,v){this.context=o,this.format=_,this.texture=o.gl.createTexture(),this.update(u,v)}update(o,u,_){let{width:v,height:S}=o,O=!(this.size&&this.size[0]===v&&this.size[1]===S||_),{context:z}=this,{gl:V}=z;if(this.useMipmap=!!(u&&u.useMipmap),V.bindTexture(V.TEXTURE_2D,this.texture),z.pixelStoreUnpackFlipY.set(!1),z.pixelStoreUnpack.set(1),z.pixelStoreUnpackPremultiplyAlpha.set(this.format===V.RGBA&&(!u||u.premultiply!==!1)),O)this.size=[v,S],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||s.b(o)?V.texImage2D(V.TEXTURE_2D,0,this.format,this.format,V.UNSIGNED_BYTE,o):V.texImage2D(V.TEXTURE_2D,0,this.format,v,S,0,this.format,V.UNSIGNED_BYTE,o.data);else{let{x:H,y:Q}=_||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||s.b(o)?V.texSubImage2D(V.TEXTURE_2D,0,H,Q,V.RGBA,V.UNSIGNED_BYTE,o):V.texSubImage2D(V.TEXTURE_2D,0,H,Q,v,S,V.RGBA,V.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&V.generateMipmap(V.TEXTURE_2D),z.pixelStoreUnpackFlipY.setDefault(),z.pixelStoreUnpack.setDefault(),z.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(o,u,_){let{context:v}=this,{gl:S}=v;S.bindTexture(S.TEXTURE_2D,this.texture),_!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=S.LINEAR),o!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,o),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,_||o),this.filter=o),u!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,u),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function Fe(C){let{userImage:o}=C;return!!(o&&o.render&&o.render())&&(C.data.replace(new Uint8Array(o.data.buffer)),!0)}class Y extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(let{ids:u,promiseResolve:_}of this.requestors)_(this._getImagesForIds(u));this.requestors=[]}}getImage(o){let u=this.images[o];if(u&&!u.data&&u.spriteData){let _=u.spriteData;u.data=new s.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),u.spriteData=null}return u}addImage(o,u){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let _=!0,v=u.data||u.spriteData;return this._validateStretch(u.stretchX,v&&v.width)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,v&&v.height)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "content" value`))),_=!1),_}_validateStretch(o,u){if(!o)return!0;let _=0;for(let v of o){if(v[0]<_||v[1]<v[0]||u<v[1])return!1;_=v[1]}return!0}_validateContent(o,u){if(!o)return!0;if(o.length!==4)return!1;let _=u.spriteData,v=_&&_.width||u.data.width,S=_&&_.height||u.data.height;return!(o[0]<0||v<o[0]||o[1]<0||S<o[1]||o[2]<0||v<o[2]||o[3]<0||S<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,u,_=!0){let v=this.getImage(o);if(_&&(v.data.width!==u.data.width||v.data.height!==u.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=v.version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){let u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((u,_)=>{let v=!0;if(!this.isLoaded())for(let S of o)this.images[S]||(v=!1);this.isLoaded()||v?u(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:u})})}_getImagesForIds(o){let u={};for(let _ of o){let v=this.getImage(_);v||(this.fire(new s.l("styleimagemissing",{id:_})),v=this.getImage(_)),v?u[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,textFitWidth:v.textFitWidth,textFitHeight:v.textFitHeight,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){let{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){let u=this.patterns[o],_=this.getImage(o);if(!_)return null;if(u&&u.position.version===_.version)return u.position;if(u)u.position.version=_.version;else{let v={w:_.data.width+2,h:_.data.height+2,x:0,y:0},S=new s.I(v,_);this.patterns[o]={bin:v,position:S}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){let u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new be(o,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){let o=[];for(let S in this.patterns)o.push(this.patterns[S].bin);let{w:u,h:_}=s.p(o),v=this.atlasImage;v.resize({width:u||1,height:_||1});for(let S in this.patterns){let{bin:O}=this.patterns[S],z=O.x+1,V=O.y+1,H=this.getImage(S).data,Q=H.width,ne=H.height;s.R.copy(H,v,{x:0,y:0},{x:z,y:V},{width:Q,height:ne}),s.R.copy(H,v,{x:0,y:ne-1},{x:z,y:V-1},{width:Q,height:1}),s.R.copy(H,v,{x:0,y:0},{x:z,y:V+ne},{width:Q,height:1}),s.R.copy(H,v,{x:Q-1,y:0},{x:z-1,y:V},{width:1,height:ne}),s.R.copy(H,v,{x:0,y:0},{x:z+Q,y:V},{width:1,height:ne})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(let u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;let _=this.getImage(u);_||s.w(`Image with ID: "${u}" was not found`),Fe(_)&&this.updateImage(u,_)}}}let J=1e20;function Z(C,o,u,_,v,S,O,z,V){for(let H=o;H<o+_;H++)xe(C,u*S+H,S,v,O,z,V);for(let H=u;H<u+v;H++)xe(C,H*S+o,1,_,O,z,V)}function xe(C,o,u,_,v,S,O){S[0]=0,O[0]=-1e20,O[1]=J,v[0]=C[o];for(let z=1,V=0,H=0;z<_;z++){v[z]=C[o+z*u];let Q=z*z;do{let ne=S[V];H=(v[z]-v[ne]+Q-ne*ne)/(z-ne)/2}while(H<=O[V]&&--V>-1);V++,S[V]=z,O[V]=H,O[V+1]=J}for(let z=0,V=0;z<_;z++){for(;O[V+1]<z;)V++;let H=S[V],Q=z-H;C[o+z*u]=v[H]+Q*Q}}class _e{constructor(o,u){this.requestManager=o,this.localIdeographFontFamily=u,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return s._(this,void 0,void 0,function*(){let u=[];for(let S in o)for(let O of o[S])u.push(this._getAndCacheGlyphsPromise(S,O));let _=yield Promise.all(u),v={};for(let{stack:S,id:O,glyph:z}of _)v[S]||(v[S]={}),v[S][O]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};return v})}_getAndCacheGlyphsPromise(o,u){return s._(this,void 0,void 0,function*(){let _=this.entries[o];_||(_=this.entries[o]={glyphs:{},requests:{},ranges:{}});let v=_.glyphs[u];if(v!==void 0)return{stack:o,id:u,glyph:v};if(v=this._tinySDF(_,o,u),v)return _.glyphs[u]=v,{stack:o,id:u,glyph:v};let S=Math.floor(u/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[S])return{stack:o,id:u,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[S]){let z=_e.loadGlyphRange(o,S,this.url,this.requestManager);_.requests[S]=z}let O=yield _.requests[S];for(let z in O)this._doesCharSupportLocalGlyph(+z)||(_.glyphs[+z]=O[+z]);return _.ranges[S]=!0,{stack:o,id:u,glyph:O[u]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(o))||s.u["CJK Unified Ideographs"](o)||s.u["Hangul Syllables"](o)||s.u.Hiragana(o)||s.u.Katakana(o)||s.u["CJK Symbols and Punctuation"](o)||s.u["Halfwidth and Fullwidth Forms"](o))}_tinySDF(o,u,_){let v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(_))return;let S=o.tinySDF;if(!S){let z="400";/bold/i.test(u)?z="900":/medium/i.test(u)?z="500":/light/i.test(u)&&(z="200"),S=o.tinySDF=new _e.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:z})}let O=S.draw(String.fromCharCode(_));return{id:_,bitmap:new s.q({width:O.width||60,height:O.height||60},O.data),metrics:{width:O.glyphWidth/2||24,height:O.glyphHeight/2||24,left:O.glyphLeft/2+.5||0,top:O.glyphTop/2-27.5||-8,advance:O.glyphAdvance/2||24,isDoubleResolution:!0}}}}_e.loadGlyphRange=function(C,o,u,_){return s._(this,void 0,void 0,function*(){let v=256*o,S=v+255,O=_.transformRequest(u.replace("{fontstack}",C).replace("{range}",`${v}-${S}`),"Glyphs"),z=yield s.n(O,new AbortController);if(!z||!z.data)throw new Error(`Could not load glyph range. range: ${o}, ${v}-${S}`);let V={};for(let H of s.o(z.data))V[H.id]=H;return V})},_e.TinySDF=class{constructor({fontSize:C=24,buffer:o=3,radius:u=8,cutoff:_=.25,fontFamily:v="sans-serif",fontWeight:S="normal",fontStyle:O="normal"}={}){this.buffer=o,this.cutoff=_,this.radius=u;let z=this.size=C+4*o,V=this._createCanvas(z),H=this.ctx=V.getContext("2d",{willReadFrequently:!0});H.font=`${O} ${S} ${C}px ${v}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(z*z),this.gridInner=new Float64Array(z*z),this.f=new Float64Array(z),this.z=new Float64Array(z+1),this.v=new Uint16Array(z)}_createCanvas(C){let o=document.createElement("canvas");return o.width=o.height=C,o}draw(C){let{width:o,actualBoundingBoxAscent:u,actualBoundingBoxDescent:_,actualBoundingBoxLeft:v,actualBoundingBoxRight:S}=this.ctx.measureText(C),O=Math.ceil(u),z=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-v))),V=Math.min(this.size-this.buffer,O+Math.ceil(_)),H=z+2*this.buffer,Q=V+2*this.buffer,ne=Math.max(H*Q,0),ie=new Uint8ClampedArray(ne),de={data:ie,width:H,height:Q,glyphWidth:z,glyphHeight:V,glyphTop:O,glyphLeft:0,glyphAdvance:o};if(z===0||V===0)return de;let{ctx:ge,buffer:Pe,gridInner:Ie,gridOuter:Le}=this;ge.clearRect(Pe,Pe,z,V),ge.fillText(C,Pe,Pe+O);let Ne=ge.getImageData(Pe,Pe,z,V);Le.fill(J,0,ne),Ie.fill(0,0,ne);for(let Ge=0;Ge<V;Ge++)for(let De=0;De<z;De++){let Ze=Ne.data[4*(Ge*z+De)+3]/255;if(Ze===0)continue;let He=(Ge+Pe)*H+De+Pe;if(Ze===1)Le[He]=0,Ie[He]=J;else{let Xe=.5-Ze;Le[He]=Xe>0?Xe*Xe:0,Ie[He]=Xe<0?Xe*Xe:0}}Z(Le,0,0,H,Q,H,this.f,this.v,this.z),Z(Ie,Pe,Pe,z,V,H,this.f,this.v,this.z);for(let Ge=0;Ge<ne;Ge++){let De=Math.sqrt(Le[Ge])-Math.sqrt(Ie[Ge]);ie[Ge]=Math.round(255-255*(De/this.radius+this.cutoff))}return de}};class Be{constructor(){this.specification=s.v.light.position}possiblyEvaluate(o,u){return s.z(o.expression.evaluate(u))}interpolate(o,u,_){return{x:s.B.number(o.x,u.x,_),y:s.B.number(o.y,u.y,_),z:s.B.number(o.z,u.z,_)}}}let Se;class ke extends s.E{constructor(o){super(),Se=Se||new s.r({anchor:new s.D(s.v.light.anchor),position:new Be,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Se),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(s.t,o,u))for(let _ in o){let v=o[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),v):this._transitionable.setValue(_,v)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,_){return(!_||_.validate!==!1)&&s.x(this,o.call(s.y,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}let Ye=new s.r({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class rt extends s.E{constructor(o){super(),this._transitionable=new s.T(Ye),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.C(0))}setSky(o,u={}){if(!this._validate(s.F,o,u)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let _ in o){let v=o[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),v):this._transitionable.setValue(_,v)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,_={}){return _?.validate!==!1&&s.x(this,o.call(s.y,s.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class tt{constructor(o,u){this.width=o,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,u){let _=o.join(",")+String(u);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(o,u)),this.dashEntry[_]}getDashRanges(o,u,_){let v=[],S=o.length%2==1?-o[o.length-1]*_:0,O=o[0]*_,z=!0;v.push({left:S,right:O,isDash:z,zeroLength:o[0]===0});let V=o[0];for(let H=1;H<o.length;H++){z=!z;let Q=o[H];S=V*_,V+=Q,O=V*_,v.push({left:S,right:O,isDash:z,zeroLength:Q===0})}return v}addRoundDash(o,u,_){let v=u/2;for(let S=-_;S<=_;S++){let O=this.width*(this.nextRow+_+S),z=0,V=o[z];for(let H=0;H<this.width;H++){H/V.right>1&&(V=o[++z]);let Q=Math.abs(H-V.left),ne=Math.abs(H-V.right),ie=Math.min(Q,ne),de,ge=S/_*(v+1);if(V.isDash){let Pe=v-Math.abs(ge);de=Math.sqrt(ie*ie+Pe*Pe)}else de=v-Math.sqrt(ie*ie+ge*ge);this.data[O+H]=Math.max(0,Math.min(255,de+128))}}}addRegularDash(o){for(let z=o.length-1;z>=0;--z){let V=o[z],H=o[z+1];V.zeroLength?o.splice(z,1):H&&H.isDash===V.isDash&&(H.left=V.left,o.splice(z,1))}let u=o[0],_=o[o.length-1];u.isDash===_.isDash&&(u.left=_.left-this.width,_.right=u.right+this.width);let v=this.width*this.nextRow,S=0,O=o[S];for(let z=0;z<this.width;z++){z/O.right>1&&(O=o[++S]);let V=Math.abs(z-O.left),H=Math.abs(z-O.right),Q=Math.min(V,H);this.data[v+z]=Math.max(0,Math.min(255,(O.isDash?Q:-Q)+128))}}addDash(o,u){let _=u?7:0,v=2*_+1;if(this.nextRow+v>this.height)return s.w("LineAtlas out of space"),null;let S=0;for(let z=0;z<o.length;z++)S+=o[z];if(S!==0){let z=this.width/S,V=this.getDashRanges(o,this.width,z);u?this.addRoundDash(V,z,_):this.addRegularDash(V)}let O={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:S};return this.nextRow+=v,this.dirty=!0,O}bind(o){let u=o.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}let _t="maplibre_preloaded_worker_pool";class Zt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Zt.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_t]}numActive(){return Object.keys(this.active).length}}let Vt=Math.floor(x.hardwareConcurrency/2),cr,Wt;function Lt(){return cr||(cr=new Zt),cr}Zt.workerCount=s.G(globalThis)?Math.max(Math.min(Vt,3),1):1;class vr{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=u;let _=this.workerPool.acquire(u);for(let v=0;v<_.length;v++){let S=new s.H(_[v],u);S.name=`Worker ${v}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,u){let _=[];for(let v of this.actors)_.push(v.sendAsync({type:o,data:u}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,u){for(let _ of this.actors)_.registerMessageHandler(o,u)}}function Pr(){return Wt||(Wt=new vr(Lt(),s.J),Wt.registerMessageHandler("GR",(C,o,u)=>s.m(o,u))),Wt}function dr(C,o){let u=s.K();return s.L(u,u,[1,1,0]),s.M(u,u,[.5*C.width,.5*C.height,1]),C.calculatePosMatrix?s.N(u,u,C.calculatePosMatrix(o.toUnwrapped())):u}function Nr(C,o,u,_,v,S,O){var z;let V=function(ie,de,ge){if(ie)for(let Pe of ie){let Ie=de[Pe];if(Ie&&Ie.source===ge&&Ie.type==="fill-extrusion")return!0}else for(let Pe in de){let Ie=de[Pe];if(Ie.source===ge&&Ie.type==="fill-extrusion")return!0}return!1}((z=v?.layers)!==null&&z!==void 0?z:null,o,C.id),H=S.maxPitchScaleFactor(),Q=C.tilesIn(_,H,V);Q.sort(Ai);let ne=[];for(let ie of Q)ne.push({wrappedTileID:ie.tileID.wrapped().key,queryResults:ie.tile.queryRenderedFeatures(o,u,C._state,ie.queryGeometry,ie.cameraQueryGeometry,ie.scale,v,S,H,dr(C.transform,ie.tileID),O?(de,ge)=>O(ie.tileID,de,ge):void 0)});return function(ie,de){for(let ge in ie)for(let Pe of ie[ge])Wr(Pe,de);return ie}(function(ie){let de={},ge={};for(let Pe of ie){let Ie=Pe.queryResults,Le=Pe.wrappedTileID,Ne=ge[Le]=ge[Le]||{};for(let Ge in Ie){let De=Ie[Ge],Ze=Ne[Ge]=Ne[Ge]||{},He=de[Ge]=de[Ge]||[];for(let Xe of De)Ze[Xe.featureIndex]||(Ze[Xe.featureIndex]=!0,He.push(Xe))}}return de}(ne),C)}function Ai(C,o){let u=C.tileID,_=o.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}function Wr(C,o){let u=C.feature,_=o.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=_}function Di(C,o,u){return s._(this,void 0,void 0,function*(){let _=C;if(C.url?_=(yield s.j(o.transformRequest(C.url,"Source"),u)).data:yield x.frameAsync(u),!_)return null;let v=s.O(s.e(_,C),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(v.vectorLayerIds=_.vector_layers.map(S=>S.id)),v})}class ui{constructor(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof s.Q?new s.Q(o.lng,o.lat):s.Q.convert(o),this}setSouthWest(o){return this._sw=o instanceof s.Q?new s.Q(o.lng,o.lat):s.Q.convert(o),this}extend(o){let u=this._sw,_=this._ne,v,S;if(o instanceof s.Q)v=o,S=o;else{if(!(o instanceof ui))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(ui.convert(o)):this.extend(s.Q.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(s.Q.convert(o)):this;if(v=o._sw,S=o._ne,!v||!S)return this}return u||_?(u.lng=Math.min(v.lng,u.lng),u.lat=Math.min(v.lat,u.lat),_.lng=Math.max(S.lng,_.lng),_.lat=Math.max(S.lat,_.lat)):(this._sw=new s.Q(v.lng,v.lat),this._ne=new s.Q(S.lng,S.lat)),this}getCenter(){return new s.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.Q(this.getWest(),this.getNorth())}getSouthEast(){return new s.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){let{lng:u,lat:_}=s.Q.convert(o),v=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&v}static convert(o){return o instanceof ui?o:o&&new ui(o)}static fromLngLat(o,u=0){let _=360*u/40075017,v=_/Math.cos(Math.PI/180*o.lat);return new ui(new s.Q(o.lng-v,o.lat-_),new s.Q(o.lng+v,o.lat+_))}adjustAntiMeridian(){let o=new s.Q(this._sw.lng,this._sw.lat),u=new s.Q(this._ne.lng,this._ne.lat);return new ui(o,o.lng>u.lng?new s.Q(u.lng+360,u.lat):u)}}class tn{constructor(o,u,_){this.bounds=ui.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){let u=Math.pow(2,o.z),_=Math.floor(s.U(this.bounds.getWest())*u),v=Math.floor(s.S(this.bounds.getNorth())*u),S=Math.ceil(s.U(this.bounds.getEast())*u),O=Math.ceil(s.S(this.bounds.getSouth())*u);return o.x>=_&&o.x<S&&o.y>=v&&o.y<O}}class Ni extends s.E{constructor(o,u,_,v){if(super(),this.id=o,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.O(u,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let o=yield Di(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(s.e(this,o),o.bounds&&(this.tileBounds=new tn(o.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new s.k(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(o){return s._(this,void 0,void 0,function*(){let u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(u,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};_.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((S,O)=>{o.reloadPromise={resolve:S,reject:O}})}else o.actor=this.dispatcher.getActor(),v="LT";o.abortController=new AbortController;try{let S=yield o.actor.sendAsync({type:v,data:_},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,S)}catch(S){if(delete o.abortController,o.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,u){if(u&&u.resourceTiming&&(o.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&o.setExpiryData(u),o.loadVectorData(u,this.map.painter),o.reloadPromise){let _=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(_.resolve).catch(_.reject)}}abortTile(o){return s._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return s._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class oi extends s.E{constructor(o,u,_,v){super(),this.id=o,this.dispatcher=_,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},u),s.e(this,s.O(u,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,function*(o=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let u=yield Di(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(s.e(this,u),u.bounds&&(this.tileBounds=new tn(u.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:o})))}catch(u){this._tileJSONRequest=null,this.fire(new s.k(u))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load(!0)}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return s.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return s._(this,void 0,void 0,function*(){let u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{let _=yield te.getImage(this.map._requestManager.transformRequest(u,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&o.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});let v=this.map.painter.context,S=v.gl,O=_.data;o.texture=this.map.painter.getTileTexture(O.width),o.texture?o.texture.update(O,{useMipmap:!0}):(o.texture=new be(v,O,S.RGBA,{useMipmap:!0}),o.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(_){if(delete o.abortController,o.aborted)o.state="unloaded";else if(_)throw o.state="errored",_}})}abortTile(o){return s._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return s._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class Eo extends oi{constructor(o,u,_,v){super(o,u,_,v),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(o){return s._(this,void 0,void 0,function*(){let u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(u,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{let v=yield te.getImage(_,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(v&&v.data){let S=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&o.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});let O=s.b(S)&&s.V()?S:yield this.readImageNow(S),z={type:this.type,uid:o.uid,source:this.id,rawImageData:O,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();let V=yield o.actor.sendAsync({type:"LDT",data:z});o.dem=V,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(v){if(delete o.abortController,o.aborted)o.state="unloaded";else if(v)throw o.state="errored",v}})}readImageNow(o){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.W()){let u=o.width+2,_=o.height+2;try{return new s.R({width:u,height:_},yield s.X(o,-1,-1,u,_))}catch{}}return x.getImageData(o,1)})}_getNeighboringTiles(o){let u=o.canonical,_=Math.pow(2,u.z),v=(u.x-1+_)%_,S=u.x===0?o.wrap-1:o.wrap,O=(u.x+1+_)%_,z=u.x+1===_?o.wrap+1:o.wrap,V={};return V[new s.Y(o.overscaledZ,S,u.z,v,u.y).key]={backfilled:!1},V[new s.Y(o.overscaledZ,z,u.z,O,u.y).key]={backfilled:!1},u.y>0&&(V[new s.Y(o.overscaledZ,S,u.z,v,u.y-1).key]={backfilled:!1},V[new s.Y(o.overscaledZ,o.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},V[new s.Y(o.overscaledZ,z,u.z,O,u.y-1).key]={backfilled:!1}),u.y+1<_&&(V[new s.Y(o.overscaledZ,S,u.z,v,u.y+1).key]={backfilled:!1},V[new s.Y(o.overscaledZ,o.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},V[new s.Y(o.overscaledZ,z,u.z,O,u.y+1).key]={backfilled:!1}),V}unloadTile(o){return s._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class qs extends s.E{constructor(o,u,_,v){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(v),this._data=u.data,this._options=s.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:s.Z,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:s.Z,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(o){return o*(s.Z/this.tileSize)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}getData(){return s._(this,void 0,void 0,function*(){let o=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})})}getCoordinatesFromGeometry(o){return o.type==="GeometryCollection"?o.geometries.map(u=>u.coordinates).flat(1/0):o.coordinates.flat(1/0)}getBounds(){return s._(this,void 0,void 0,function*(){let o=new ui,u=yield this.getData(),_;switch(u.type){case"FeatureCollection":_=u.features.map(v=>this.getCoordinatesFromGeometry(v.geometry)).flat(1/0);break;case"Feature":_=this.getCoordinatesFromGeometry(u.geometry);break;default:_=this.getCoordinatesFromGeometry(u)}if(_.length==0)return o;for(let v=0;v<_.length-1;v+=2)o.extend([_[v],_[v+1]]);return o})}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(o.clusterRadius)),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,u,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:u,offset:_}})}_updateWorkerData(o){return s._(this,void 0,void 0,function*(){let u=s.e({type:this.type},this.workerOptions);o?u.dataDiff=o:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(x.resolveURL(this._data),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.l("dataloading",{dataType:"source"}));try{let _=yield this.actor.sendAsync({type:"LD",data:u});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));let v=null;_.resourceTiming&&_.resourceTiming[this.id]&&(v=_.resourceTiming[this.id].slice(0));let S={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&s.e(S,{resourceTiming:v}),this.fire(new s.l("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(_))}})}loaded(){return this._pendingLoads===0}loadTile(o){return s._(this,void 0,void 0,function*(){let u=o.actor?"RT":"LT";o.actor=this.actor;let _={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};o.abortController=new AbortController;let v=yield this.actor.sendAsync({type:u,data:_},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(v,this.map.painter,u==="RT")})}abortTile(o){return s._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return s._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ls extends s.E{constructor(o,u,_,v){super(),this.flippedWindingOrder=!1,this.id=o,this.dispatcher=_,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(o){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let u=yield te.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,o&&(this.coordinates=o),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new s.k(u))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;let u=o.map(s.$.fromLngLat);var _;return this.tileID=function(v){let S=1/0,O=1/0,z=-1/0,V=-1/0;for(let ie of v)S=Math.min(S,ie.x),O=Math.min(O,ie.y),z=Math.max(z,ie.x),V=Math.max(V,ie.y);let H=Math.max(z-S,V-O),Q=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),ne=Math.pow(2,Q);return new s.a1(Q,Math.floor((S+z)/2*ne),Math.floor((O+V)/2*ne))}(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map(v=>this.tileID.getTilePoint(v)._round()),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let o=this.map.painter.context,u=o.gl;this.texture||(this.texture=new be(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(let v in this.tiles){let S=this.tiles[v];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(o){let u=1/0,_=1/0,v=-1/0,S=-1/0;for(let z of o)u=Math.min(u,z.x),_=Math.min(_,z.y),v=Math.max(v,z.x),S=Math.max(S,z.y);let O={};for(let z=0;z<=s.a0;z++){let V=Math.pow(2,z),H=Math.floor(u*V),Q=Math.floor(_*V),ne=Math.floor(v*V),ie=Math.floor(S*V);O[z]={minTileX:H,minTileY:Q,maxTileX:ne,maxTileY:ie}}return O}}class Zs extends ls{constructor(o,u,_,v){super(o,u,_,v),this.roundZoom=!0,this.type="video",this.options=u}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;let o=this.options;this.urls=[];for(let u of o.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{let u=yield s.a2(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new s.k(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){let u=this.video.seekable;o<u.start(0)||o>u.end(0)?this.fire(new s.k(new s.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let o=this.map.painter.context,u=o.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new be(o,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(let v in this.tiles){let S=this.tiles[v];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Aa extends ls{constructor(o,u,_,v){super(o,u,_,v),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(O=>typeof O!="number"))||this.fire(new s.k(new s.a3(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.a3(`sources.${o}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new s.k(new s.a3(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.a3(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.a3(`sources.${o}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let u=this.map.painter.context,_=u.gl;this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new be(u,this.canvas,_.RGBA,{premultiply:!0});let v=!1;for(let S in this.tiles){let O=this.tiles[S];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,v=!0)}v&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}let _s={},oo=C=>{switch(C){case"geojson":return qs;case"image":return ls;case"raster":return oi;case"raster-dem":return Eo;case"vector":return Ni;case"video":return Zs;case"canvas":return Aa}return _s[C]},ys="RTLPluginLoaded";class Gr extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Pr()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return s._(this,arguments,void 0,function*(u,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=x.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(ys))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Jt=null;function kt(){return Jt||(Jt=new Gr),Jt}class Cr{constructor(o,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=s.a4(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){let u=o+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,u,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(v,S){let O={};if(!S)return O;for(let z of v){let V=z.layerIds.map(H=>S.getLayer(H)).filter(Boolean);if(V.length!==0){z.layers=V,z.stateDependentLayerIds&&(z.stateDependentLayers=z.stateDependentLayerIds.map(H=>V.filter(Q=>Q.id===H)[0]));for(let H of V)O[H.id]=z}}return O}(o.buckets,u?.style),this.hasSymbolBuckets=!1;for(let v in this.buckets){let S=this.buckets[v];if(S instanceof s.a6){if(this.hasSymbolBuckets=!0,!_)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let v in this.buckets){let S=this.buckets[v];if(S instanceof s.a6&&S.hasRTLText){this.hasRTLText=!0,kt().lazyLoad();break}}this.queryPadding=0;for(let v in this.buckets){let S=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(v).queryRadius(S))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new s.a5}unloadVectorData(){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(let _ in this.buckets){let v=this.buckets[_];v.uploadPending()&&v.upload(o)}let u=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new be(o,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new be(o,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,u,_,v,S,O,z,V,H,Q,ne){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:S,scale:O,tileSize:this.tileSize,pixelPosMatrix:Q,transform:V,params:z,queryPadding:this.queryPadding*H,getElevation:ne},o,u,_):{}}querySourceFeatures(o,u){let _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;let v=_.loadVTLayers(),S=u&&u.sourceLayer?u.sourceLayer:"",O=v._geojsonTileLayer||v[S];if(!O)return;let z=s.a7(u&&u.filter),{z:V,x:H,y:Q}=this.tileID.canonical,ne={z:V,x:H,y:Q};for(let ie=0;ie<O.length;ie++){let de=O.feature(ie);if(z.needGeometry){let Ie=s.a8(de,!0);if(!z.filter(new s.C(this.tileID.overscaledZ),Ie,this.tileID.canonical))continue}else if(!z.filter(new s.C(this.tileID.overscaledZ),de))continue;let ge=_.getId(de,S),Pe=new s.a9(de,V,H,Q,ge);Pe.tile=ne,o.push(Pe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){let u=this.expirationTime;if(o.cacheControl){let _=s.aa(o.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){let _=Date.now(),v=!1;if(this.expirationTime>_)v=!1;else if(u)if(this.expirationTime<u)v=!0;else{let S=this.expirationTime-u;S?this.expirationTime=_+Math.max(S,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;let _=this.latestFeatureIndex.loadVTLayers();for(let v in this.buckets){if(!u.style.hasLayer(v))continue;let S=this.buckets[v],O=S.layers[0].sourceLayer||"_geojsonTileLayer",z=_[O],V=o[O];if(!z||!V||Object.keys(V).length===0)continue;S.update(V,z,this.imageAtlas&&this.imageAtlas.patternPositions||{});let H=u&&u.style&&u.style.getLayer(v);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<x.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=x.now()+o}setDependencies(o,u){let _={};for(let v of u)_[v]=!0;this.dependencies[o]=_}hasDependency(o,u){for(let _ of o){let v=this.dependencies[_];if(v){for(let S of u)if(v[S])return!0}}return!1}}class ai{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(let o in this.data)for(let u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,_){let v=o.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);let S={value:u,timeout:void 0};if(_!==void 0&&(S.timeout=setTimeout(()=>{this.remove(o,S)},_)),this.data[v].push(S),this.order.push(v),this.order.length>this.max){let O=this._getAndRemoveByKey(this.order[0]);O&&this.onRemove(O)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){let u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){let u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;let _=o.wrapped().key,v=u===void 0?0:this.data[_].indexOf(u),S=this.data[_][v];return this.data[_].splice(v,1),S.timeout&&clearTimeout(S.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(S.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){let u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){let u=[];for(let _ in this.data)for(let v of this.data[_])o(v.value)||u.push(v);for(let _ of u)this.remove(_.value.tileID,_)}}class Rr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,_){let v=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][v]=this.stateChanges[o][v]||{},s.e(this.stateChanges[o][v],_),this.deletedStates[o]===null){this.deletedStates[o]={};for(let S in this.state[o])S!==v&&(this.deletedStates[o][S]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][v]===null){this.deletedStates[o][v]={};for(let S in this.state[o][v])_[S]||(this.deletedStates[o][v][S]=null)}else for(let S in _)this.deletedStates[o]&&this.deletedStates[o][v]&&this.deletedStates[o][v][S]===null&&delete this.deletedStates[o][v][S]}removeFeatureState(o,u,_){if(this.deletedStates[o]===null)return;let v=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},_&&u!==void 0)this.deletedStates[o][v]!==null&&(this.deletedStates[o][v]=this.deletedStates[o][v]||{},this.deletedStates[o][v][_]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][v])for(_ in this.deletedStates[o][v]={},this.stateChanges[o][v])this.deletedStates[o][v][_]=null;else this.deletedStates[o][v]=null;else this.deletedStates[o]=null}getState(o,u){let _=String(u),v=s.e({},(this.state[o]||{})[_],(this.stateChanges[o]||{})[_]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){let S=this.deletedStates[o][u];if(S===null)return{};for(let O in S)delete v[O]}return v}initializeTileState(o,u){o.setFeatureState(this.state,u)}coalesceChanges(o,u){let _={};for(let v in this.stateChanges){this.state[v]=this.state[v]||{};let S={};for(let O in this.stateChanges[v])this.state[v][O]||(this.state[v][O]={}),s.e(this.state[v][O],this.stateChanges[v][O]),S[O]=this.state[v][O];_[v]=S}for(let v in this.deletedStates){this.state[v]=this.state[v]||{};let S={};if(this.deletedStates[v]===null)for(let O in this.state[v])S[O]={},this.state[v][O]={};else for(let O in this.deletedStates[v]){if(this.deletedStates[v][O]===null)this.state[v][O]={};else for(let z of Object.keys(this.deletedStates[v][O]))delete this.state[v][O][z];S[O]=this.state[v][O]}_[v]=_[v]||{},s.e(_[v],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(let v in o)o[v].setFeatureState(_,u)}}function Xi(C,o,u){let _=o.intersectsFrustum(C);if(!u)return _;let v=o.intersectsPlane(u);return _===0||v===0?0:_===2&&v===2?2:1}function cs(C,o,u,_,v){let S=C,O=Math.atan(o/u),z=Math.hypot(o,u);return S=C+s.ab(_/z/Math.max(.5,Math.cos(s.ad(v/2)))),S+=1*s.ab(Math.cos(O))/2,S+=s.ae(C-S,-0,0),S}function zn(C,o){let u=(o.roundZoom?Math.round:Math.floor)(C.zoom+s.ab(C.tileSize/o.tileSize));return Math.max(0,u)}function ot(C,o){let u=C.getCameraFrustum(),_=C.getClippingPlane(),v=C.screenPointToMercatorCoordinate(C.getCameraPoint()),S=s.$.fromLngLat(C.center,C.elevation);v.z=S.z+Math.cos(C.pitchInRadians)*C.cameraToCenterDistance/C.worldSize;let O=C.getCoveringTilesDetailsProvider(),z=O.allowVariableZoom(C,o),V=zn(C,o),H=o.minzoom||0,Q=o.maxzoom!==void 0?o.maxzoom:C.maxZoom,ne=Math.min(Math.max(0,V),Q),ie=Math.pow(2,ne),de=[ie*v.x,ie*v.y,0],ge=[ie*S.x,ie*S.y,0],Pe=Math.hypot(S.x-v.x,S.y-v.y),Ie=Math.abs(S.z-v.z),Le=Math.hypot(Pe,Ie),Ne=Ze=>({zoom:0,x:0,y:0,wrap:Ze,fullyVisible:!1}),Ge=[],De=[];if(C.renderWorldCopies&&O.allowWorldCopies())for(let Ze=1;Ze<=3;Ze++)Ge.push(Ne(-Ze)),Ge.push(Ne(Ze));for(Ge.push(Ne(0));Ge.length>0;){let Ze=Ge.pop(),He=Ze.x,Xe=Ze.y,yt=Ze.fullyVisible,At={x:He,y:Xe,z:Ze.zoom},Pt=O.getTileAABB(At,Ze.wrap,C.elevation,o);if(!yt){let Kt=Xi(u,Pt,_);if(Kt===0)continue;yt=Kt===2}let Ot=O.distanceToTile2d(v.x,v.y,At,Pt),Tt=V;z&&(Tt=(o.calculateTileZoom||cs)(C.zoom+s.ab(C.tileSize/o.tileSize),Ot,Ie,Le,C.fov)),Tt=(o.roundZoom?Math.round:Math.floor)(Tt),Tt=Math.max(0,Tt);let er=Math.min(Tt,Q);if(Ze.wrap=O.getWrap(S,At,Ze.wrap),Ze.zoom>=er){if(Ze.zoom<H)continue;let Kt=ne-Ze.zoom,Ut=de[0]-.5-(He<<Kt),mt=de[1]-.5-(Xe<<Kt),Nt=o.reparseOverscaled?Math.max(Ze.zoom,Tt):Ze.zoom;De.push({tileID:new s.Y(Ze.zoom===Q?Nt:Ze.zoom,Ze.wrap,Ze.zoom,He,Xe),distanceSq:s.ac([ge[0]-.5-He,ge[1]-.5-Xe]),tileDistanceToCamera:Math.sqrt(Ut*Ut+mt*mt)})}else for(let Kt=0;Kt<4;Kt++)Ge.push({zoom:Ze.zoom+1,x:(He<<1)+Kt%2,y:(Xe<<1)+(Kt>>1),wrap:Ze.wrap,fullyVisible:yt})}return De.sort((Ze,He)=>Ze.distanceSq-He.distanceSq).map(Ze=>Ze.tileID)}class Ae extends s.E{constructor(o,u,_){super(),this.id=o,this.dispatcher=_,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,S,O,z)=>{let V=new(oo(S.type))(v,S,O,z);if(V.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${V.id}`);return V})(o,u,_,this),this._tiles={},this._cache=new ai(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Rr,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let o in this._tiles){let u=this._tiles[o];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,u,_){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,u,_)}catch(v){o.state="errored",v.status!==404?this._source.fire(new s.k(v,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new s.l("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let u in this._tiles){let _=this._tiles[u];_.upload(o),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(ye).map(o=>o.key)}getRenderableIds(o){let u=[];for(let _ in this._tiles)this._isIdRenderable(_,o)&&u.push(this._tiles[_]);return o?u.sort((_,v)=>{let S=_.tileID,O=v.tileID,z=new s.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians),V=new s.P(O.canonical.x,O.canonical.y)._rotate(-this.transform.bearingInRadians);return S.overscaledZ-O.overscaledZ||V.y-z.y||V.x-z.x}).map(_=>_.tileID.key):u.map(_=>_.tileID).sort(ye).map(_=>_.key)}hasRenderableParent(o){let u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())}reload(o){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let u in this._tiles)(o||this._tiles[u].state!=="errored")&&this._reloadTile(u,"reloading")}}_reloadTile(o,u){return s._(this,void 0,void 0,function*(){let _=this._tiles[o];_&&(_.state!=="loading"&&(_.state=u),yield this._loadTile(_,o,u))})}_tileLoaded(o,u,_){o.timeAdded=x.now(),_==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){let u=this.getRenderableIds();for(let v=0;v<u.length;v++){let S=u[v];if(o.neighboringTiles&&o.neighboringTiles[S]){let O=this.getTileByID(S);_(o,O),_(O,o)}}function _(v,S){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let O=S.tileID.canonical.x-v.tileID.canonical.x,z=S.tileID.canonical.y-v.tileID.canonical.y,V=Math.pow(2,v.tileID.canonical.z),H=S.tileID.key;O===0&&z===0||Math.abs(z)>1||(Math.abs(O)>1&&(Math.abs(O+V)===1?O+=V:Math.abs(O-V)===1&&(O-=V)),S.dem&&v.dem&&(v.dem.backfillBorder(S.dem,O,z),v.neighboringTiles&&v.neighboringTiles[H]&&(v.neighboringTiles[H].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,_,v){for(let S in this._tiles){let O=this._tiles[S];if(v[S]||!O.hasData()||O.tileID.overscaledZ<=u||O.tileID.overscaledZ>_)continue;let z=O.tileID;for(;O&&O.tileID.overscaledZ>u+1;){let H=O.tileID.scaledTo(O.tileID.overscaledZ-1);O=this._tiles[H.key],O&&O.hasData()&&(z=H)}let V=z;for(;V.overscaledZ>u;)if(V=V.scaledTo(V.overscaledZ-1),o[V.key]||o[V.canonical.key]){v[z.key]=z;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){let _=this._loadedParentTiles[o.key];return _&&_.tileID.overscaledZ>=u?_:null}for(let _=o.overscaledZ-1;_>=u;_--){let v=o.scaledTo(_),S=this._getLoadedTile(v);if(S)return S}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){let u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){let u=Math.ceil(o.width/this._source.tileSize)+1,_=Math.ceil(o.height/this._source.tileSize)+1,v=Math.floor(u*_*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(S)}handleWrapJump(o){let u=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,u){let _={};for(let v in this._tiles){let S=this._tiles[v];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),_[S.tileID.key]=S}this._tiles=_;for(let v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(let v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}_updateCoveredAndRetainedTiles(o,u,_,v,S,O){let z={},V={},H=Object.keys(o),Q=x.now();for(let ne of H){let ie=o[ne],de=this._tiles[ne];if(!de||de.fadeEndTime!==0&&de.fadeEndTime<=Q)continue;let ge=this.findLoadedParent(ie,u),Pe=this.findLoadedSibling(ie),Ie=ge||Pe||null;Ie&&(this._addTile(Ie.tileID),z[Ie.tileID.key]=Ie.tileID),V[ne]=ie}this._retainLoadedChildren(V,v,_,o);for(let ne in z)o[ne]||(this._coveredTiles[ne]=!0,o[ne]=z[ne]);if(O){let ne={},ie={};for(let de of S)this._tiles[de.key].hasData()?ne[de.key]=de:ie[de.key]=de;for(let de in ie){let ge=ie[de].children(this._source.maxzoom);this._tiles[ge[0].key]&&this._tiles[ge[1].key]&&this._tiles[ge[2].key]&&this._tiles[ge[3].key]&&(ne[ge[0].key]=o[ge[0].key]=ge[0],ne[ge[1].key]=o[ge[1].key]=ge[1],ne[ge[2].key]=o[ge[2].key]=ge[2],ne[ge[3].key]=o[ge[3].key]=ge[3],delete ie[de])}for(let de in ie){let ge=ie[de],Pe=this.findLoadedParent(ge,this._source.minzoom),Ie=this.findLoadedSibling(ge),Le=Pe||Ie||null;if(Le){ne[Le.tileID.key]=o[Le.tileID.key]=Le.tileID;for(let Ne in ne)ne[Ne].isChildOf(Le.tileID)&&delete ne[Ne]}}for(let de in this._tiles)ne[de]||(this._coveredTiles[de]=!0)}}update(o,u){if(!this._sourceLoaded||this._paused)return;let _;this.transform=o,this.terrain=u,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(Q=>new s.Y(Q.canonical.z,Q.wrap,Q.canonical.z,Q.canonical.x,Q.canonical.y)):(_=ot(o,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter(Q=>this._source.hasTile(Q)))):_=[];let v=zn(o,this._source),S=Math.max(v-Ae.maxOverzooming,this._source.minzoom),O=Math.max(v+Ae.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let Q={};for(let ne of _)if(ne.canonical.z>this._source.minzoom){let ie=ne.scaledTo(ne.canonical.z-1);Q[ie.key]=ie;let de=ne.scaledTo(Math.max(this._source.minzoom,Math.min(ne.canonical.z,5)));Q[de.key]=de}_=_.concat(Object.values(Q))}let z=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,z&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let V=this._updateRetainedTiles(_,v);ue(this._source.type)&&this._updateCoveredAndRetainedTiles(V,S,O,v,_,u);for(let Q in V)this._tiles[Q].clearFadeHold();let H=s.af(this._tiles,V);for(let Q of H){let ne=this._tiles[Q];ne.hasSymbolBuckets&&!ne.holdingForFade()?ne.setHoldDuration(this.map._fadeDuration):ne.hasSymbolBuckets&&!ne.symbolFadeFinished()||this._removeTile(Q)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,u){var _;let v={},S={},O=Math.max(u-Ae.maxOverzooming,this._source.minzoom),z=Math.max(u+Ae.maxUnderzooming,this._source.minzoom),V={};for(let H of o){let Q=this._addTile(H);v[H.key]=H,Q.hasData()||u<this._source.maxzoom&&(V[H.key]=H)}this._retainLoadedChildren(V,u,z,v);for(let H of o){let Q=this._tiles[H.key];if(Q.hasData())continue;if(u+1>this._source.maxzoom){let ie=H.children(this._source.maxzoom)[0],de=this.getTile(ie);if(de&&de.hasData()){v[ie.key]=ie;continue}}else{let ie=H.children(this._source.maxzoom);if(v[ie[0].key]&&v[ie[1].key]&&v[ie[2].key]&&v[ie[3].key])continue}let ne=Q.wasRequested();for(let ie=H.overscaledZ-1;ie>=O;--ie){let de=H.scaledTo(ie);if(S[de.key])break;if(S[de.key]=!0,Q=this.getTile(de),!Q&&ne&&(Q=this._addTile(de)),Q){let ge=Q.hasData();if((ge||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||ne)&&(v[de.key]=de),ne=Q.wasRequested(),ge)break}}}return v}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let o in this._tiles){let u=[],_,v=this._tiles[o].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){_=this._loadedParentTiles[v.key];break}u.push(v.key);let S=v.scaledTo(v.overscaledZ-1);if(_=this._getLoadedTile(S),_)break;v=S}for(let S of u)this._loadedParentTiles[S]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let o in this._tiles){let u=this._tiles[o].tileID,_=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=_}}_addTile(o){let u=this._tiles[o.key];if(u)return u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));let _=u;return u||(u=new Cr(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(u,o.key,u.state)),u.uses++,this._tiles[o.key]=u,_||this._source.fire(new s.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);let _=u.getExpiryTimeout();_&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},_))}_removeTile(o){let u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(o){let u=o.sourceDataType;o.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&u==="content"&&(this.reload(o.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,u,_){let v=[],S=this.transform;if(!S)return v;let O=_?S.getCameraQueryGeometry(o):o,z=o.map(ge=>S.screenPointToMercatorCoordinate(ge,this.terrain)),V=O.map(ge=>S.screenPointToMercatorCoordinate(ge,this.terrain)),H=this.getIds(),Q=1/0,ne=1/0,ie=-1/0,de=-1/0;for(let ge of V)Q=Math.min(Q,ge.x),ne=Math.min(ne,ge.y),ie=Math.max(ie,ge.x),de=Math.max(de,ge.y);for(let ge=0;ge<H.length;ge++){let Pe=this._tiles[H[ge]];if(Pe.holdingForFade())continue;let Ie=Pe.tileID,Le=Math.pow(2,S.zoom-Pe.tileID.overscaledZ),Ne=u*Pe.queryPadding*s.Z/Pe.tileSize/Le,Ge=[Ie.getTilePoint(new s.$(Q,ne)),Ie.getTilePoint(new s.$(ie,de))];if(Ge[0].x-Ne<s.Z&&Ge[0].y-Ne<s.Z&&Ge[1].x+Ne>=0&&Ge[1].y+Ne>=0){let De=z.map(He=>Ie.getTilePoint(He)),Ze=V.map(He=>Ie.getTilePoint(He));v.push({tile:Pe,tileID:Ie,queryGeometry:De,cameraQueryGeometry:Ze,scale:Le})}}return v}getVisibleCoordinates(o){let u=this.getRenderableIds(o).map(_=>this._tiles[_].tileID);return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(ue(this._source.type)){let o=x.now();for(let u in this._tiles)if(this._tiles[u].fadeEndTime>=o)return!0}return!1}setFeatureState(o,u,_){this._state.updateState(o=o||"_geojsonTileLayer",u,_)}removeFeatureState(o,u,_){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,_)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,_){let v=this._tiles[o];v&&v.setDependencies(u,_)}reloadTilesForDependencies(o,u){for(let _ in this._tiles)this._tiles[_].hasDependency(o,u)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(o,u))}}function ye(C,o){let u=Math.abs(2*C.wrap)-+(C.wrap<0),_=Math.abs(2*o.wrap)-+(o.wrap<0);return C.overscaledZ-o.overscaledZ||_-u||o.canonical.y-C.canonical.y||o.canonical.x-C.canonical.x}function ue(C){return C==="raster"||C==="image"||C==="video"}Ae.maxOverzooming=10,Ae.maxUnderzooming=3;class Ve{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.ae(o,0,1);let u=1,_=this._distances[u],v=o*this.paddedLength+this.padding;for(;_<v&&u<this._distances.length;)_=this._distances[++u];let S=u-1,O=this._distances[S],z=_-O,V=z>0?(v-O)/z:0;return this.points[S].mult(1-V).add(this.points[u].mult(V))}}function Ke(C,o){let u=!0;return C==="always"||C!=="never"&&o!=="never"||(u=!1),u}class Qe{constructor(o,u,_){let v=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(o/_),this.yCellCount=Math.ceil(u/_);for(let O=0;O<this.xCellCount*this.yCellCount;O++)v.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,_,v,S){this._forEachCell(u,_,v,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(v),this.bboxes.push(S)}insertCircle(o,u,_,v){this._forEachCell(u-v,_-v,u+v,_+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(_),this.circles.push(v)}_insertBoxCell(o,u,_,v,S,O){this.boxCells[S].push(O)}_insertCircleCell(o,u,_,v,S,O){this.circleCells[S].push(O)}_query(o,u,_,v,S,O,z){if(_<0||o>this.width||v<0||u>this.height)return[];let V=[];if(o<=0&&u<=0&&this.width<=_&&this.height<=v){if(S)return[{key:null,x1:o,y1:u,x2:_,y2:v}];for(let H=0;H<this.boxKeys.length;H++)V.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){let Q=this.circles[3*H],ne=this.circles[3*H+1],ie=this.circles[3*H+2];V.push({key:this.circleKeys[H],x1:Q-ie,y1:ne-ie,x2:Q+ie,y2:ne+ie})}}else this._forEachCell(o,u,_,v,this._queryCell,V,{hitTest:S,overlapMode:O,seenUids:{box:{},circle:{}}},z);return V}query(o,u,_,v){return this._query(o,u,_,v,!1,null)}hitTest(o,u,_,v,S,O){return this._query(o,u,_,v,!0,S,O).length>0}hitTestCircle(o,u,_,v,S){let O=o-_,z=o+_,V=u-_,H=u+_;if(z<0||O>this.width||H<0||V>this.height)return!1;let Q=[];return this._forEachCell(O,V,z,H,this._queryCellCircle,Q,{hitTest:!0,overlapMode:v,circle:{x:o,y:u,radius:_},seenUids:{box:{},circle:{}}},S),Q.length>0}_queryCell(o,u,_,v,S,O,z,V){let{seenUids:H,hitTest:Q,overlapMode:ne}=z,ie=this.boxCells[S];if(ie!==null){let ge=this.bboxes;for(let Pe of ie)if(!H.box[Pe]){H.box[Pe]=!0;let Ie=4*Pe,Le=this.boxKeys[Pe];if(o<=ge[Ie+2]&&u<=ge[Ie+3]&&_>=ge[Ie+0]&&v>=ge[Ie+1]&&(!V||V(Le))&&(!Q||!Ke(ne,Le.overlapMode))&&(O.push({key:Le,x1:ge[Ie],y1:ge[Ie+1],x2:ge[Ie+2],y2:ge[Ie+3]}),Q))return!0}}let de=this.circleCells[S];if(de!==null){let ge=this.circles;for(let Pe of de)if(!H.circle[Pe]){H.circle[Pe]=!0;let Ie=3*Pe,Le=this.circleKeys[Pe];if(this._circleAndRectCollide(ge[Ie],ge[Ie+1],ge[Ie+2],o,u,_,v)&&(!V||V(Le))&&(!Q||!Ke(ne,Le.overlapMode))){let Ne=ge[Ie],Ge=ge[Ie+1],De=ge[Ie+2];if(O.push({key:Le,x1:Ne-De,y1:Ge-De,x2:Ne+De,y2:Ge+De}),Q)return!0}}}return!1}_queryCellCircle(o,u,_,v,S,O,z,V){let{circle:H,seenUids:Q,overlapMode:ne}=z,ie=this.boxCells[S];if(ie!==null){let ge=this.bboxes;for(let Pe of ie)if(!Q.box[Pe]){Q.box[Pe]=!0;let Ie=4*Pe,Le=this.boxKeys[Pe];if(this._circleAndRectCollide(H.x,H.y,H.radius,ge[Ie+0],ge[Ie+1],ge[Ie+2],ge[Ie+3])&&(!V||V(Le))&&!Ke(ne,Le.overlapMode))return O.push(!0),!0}}let de=this.circleCells[S];if(de!==null){let ge=this.circles;for(let Pe of de)if(!Q.circle[Pe]){Q.circle[Pe]=!0;let Ie=3*Pe,Le=this.circleKeys[Pe];if(this._circlesCollide(ge[Ie],ge[Ie+1],ge[Ie+2],H.x,H.y,H.radius)&&(!V||V(Le))&&!Ke(ne,Le.overlapMode))return O.push(!0),!0}}}_forEachCell(o,u,_,v,S,O,z,V){let H=this._convertToXCellCoord(o),Q=this._convertToYCellCoord(u),ne=this._convertToXCellCoord(_),ie=this._convertToYCellCoord(v);for(let de=H;de<=ne;de++)for(let ge=Q;ge<=ie;ge++)if(S.call(this,o,u,_,v,this.xCellCount*ge+de,O,z,V))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,_,v,S,O){let z=v-o,V=S-u,H=_+O;return H*H>z*z+V*V}_circleAndRectCollide(o,u,_,v,S,O,z){let V=(O-v)/2,H=Math.abs(o-(v+V));if(H>V+_)return!1;let Q=(z-S)/2,ne=Math.abs(u-(S+Q));if(ne>Q+_)return!1;if(H<=V||ne<=Q)return!0;let ie=H-V,de=ne-Q;return ie*ie+de*de<=_*_}}function dt(C,o,u){let _=s.K();if(!C){let{vecSouth:ne,vecEast:ie}=Bt(o),de=c();de[0]=ie[0],de[1]=ie[1],de[2]=ne[0],de[3]=ne[1],v=de,(Q=(O=(S=de)[0])*(H=S[3])-(V=S[2])*(z=S[1]))&&(v[0]=H*(Q=1/Q),v[1]=-z*Q,v[2]=-V*Q,v[3]=O*Q),_[0]=de[0],_[1]=de[1],_[4]=de[2],_[5]=de[3]}var v,S,O,z,V,H,Q;return s.M(_,_,[1/u,1/u,1]),_}function it(C,o,u,_){if(C){let v=s.K();if(!o){let{vecSouth:S,vecEast:O}=Bt(u);v[0]=O[0],v[1]=O[1],v[4]=S[0],v[5]=S[1]}return s.M(v,v,[_,_,1]),v}return u.pixelsToClipSpaceMatrix}function Bt(C){let o=Math.cos(C.rollInRadians),u=Math.sin(C.rollInRadians),_=Math.cos(C.pitchInRadians),v=Math.cos(C.bearingInRadians),S=Math.sin(C.bearingInRadians),O=s.ak();O[0]=-v*_*u-S*o,O[1]=-S*_*u+v*o;let z=s.al(O);z<1e-9?s.am(O):s.an(O,O,1/z);let V=s.ak();V[0]=v*_*o-S*u,V[1]=S*_*o+v*u;let H=s.al(V);return H<1e-9?s.am(V):s.an(V,V,1/H),{vecEast:V,vecSouth:O}}function Mt(C,o,u,_){let v;_?(v=[C,o,_(C,o),1],s.ap(v,v,u)):(v=[C,o,0,1],Kn(v,v,u));let S=v[3];return{point:new s.P(v[0]/S,v[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function ut(C,o){return .5+C/o*.5}function zt(C,o){return C.x>=-o[0]&&C.x<=o[0]&&C.y>=-o[1]&&C.y<=o[1]}function rr(C,o,u,_,v,S,O,z,V,H,Q,ne,ie){let de=u?C.textSizeData:C.iconSizeData,ge=s.ag(de,o.transform.zoom),Pe=[256/o.width*2+1,256/o.height*2+1],Ie=u?C.text.dynamicLayoutVertexArray:C.icon.dynamicLayoutVertexArray;Ie.clear();let Le=C.lineVertexArray,Ne=u?C.text.placedSymbolArray:C.icon.placedSymbolArray,Ge=o.transform.width/o.transform.height,De=!1;for(let Ze=0;Ze<Ne.length;Ze++){let He=Ne.get(Ze);if(He.hidden||He.writingMode===s.ah.vertical&&!De){Br(He.numGlyphs,Ie);continue}De=!1;let Xe=new s.P(He.anchorX,He.anchorY),yt={getElevation:ie,pitchedLabelPlaneMatrix:_,lineVertexArray:Le,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:o.transform,tileAnchorPoint:Xe,unwrappedTileID:V,width:H,height:Q,translation:ne},At=pr(He.anchorX,He.anchorY,yt);if(!zt(At.point,Pe)){Br(He.numGlyphs,Ie);continue}let Pt=ut(o.transform.cameraToCenterDistance,At.signedDistanceFromCamera),Ot=s.ai(de,ge,He),Tt=S?Ot*o.transform.getPitchedTextCorrection(He.anchorX,He.anchorY,V)/Pt:Ot*Pt,er=Fr({projectionContext:yt,pitchedLabelPlaneMatrixInverse:v,symbol:He,fontSize:Tt,flip:!1,keepUpright:O,glyphOffsetArray:C.glyphOffsetArray,dynamicLayoutVertexArray:Ie,aspectRatio:Ge,rotateToLine:z});De=er.useVertical,(er.notEnoughRoom||De||er.needsFlipping&&Fr({projectionContext:yt,pitchedLabelPlaneMatrixInverse:v,symbol:He,fontSize:Tt,flip:!0,keepUpright:O,glyphOffsetArray:C.glyphOffsetArray,dynamicLayoutVertexArray:Ie,aspectRatio:Ge,rotateToLine:z}).notEnoughRoom)&&Br(He.numGlyphs,Ie)}u?C.text.dynamicLayoutVertexBuffer.updateData(Ie):C.icon.dynamicLayoutVertexBuffer.updateData(Ie)}function nr(C,o,u,_,v,S,O,z){let V=S.glyphStartIndex+S.numGlyphs,H=S.lineStartIndex,Q=S.lineStartIndex+S.lineLength,ne=o.getoffsetX(S.glyphStartIndex),ie=o.getoffsetX(V-1),de=xn(C*ne,u,_,v,S.segment,H,Q,z,O);if(!de)return null;let ge=xn(C*ie,u,_,v,S.segment,H,Q,z,O);return ge?z.projectionCache.anyProjectionOccluded?null:{first:de,last:ge}:null}function $e(C,o,u,_){return C===s.ah.horizontal&&Math.abs(u.y-o.y)>Math.abs(u.x-o.x)*_?{useVertical:!0}:(C===s.ah.vertical?o.y<u.y:o.x>u.x)?{needsFlipping:!0}:null}function Fr(C){let{projectionContext:o,pitchedLabelPlaneMatrixInverse:u,symbol:_,fontSize:v,flip:S,keepUpright:O,glyphOffsetArray:z,dynamicLayoutVertexArray:V,aspectRatio:H,rotateToLine:Q}=C,ne=v/24,ie=_.lineOffsetX*ne,de=_.lineOffsetY*ne,ge;if(_.numGlyphs>1){let Pe=_.glyphStartIndex+_.numGlyphs,Ie=_.lineStartIndex,Le=_.lineStartIndex+_.lineLength,Ne=nr(ne,z,ie,de,S,_,Q,o);if(!Ne)return{notEnoughRoom:!0};let Ge=Gt(Ne.first.point.x,Ne.first.point.y,o,u),De=Gt(Ne.last.point.x,Ne.last.point.y,o,u);if(O&&!S){let Ze=$e(_.writingMode,Ge,De,H);if(Ze)return Ze}ge=[Ne.first];for(let Ze=_.glyphStartIndex+1;Ze<Pe-1;Ze++)ge.push(xn(ne*z.getoffsetX(Ze),ie,de,S,_.segment,Ie,Le,o,Q));ge.push(Ne.last)}else{if(O&&!S){let Ie=_i(o.tileAnchorPoint.x,o.tileAnchorPoint.y,o).point,Le=_.lineStartIndex+_.segment+1,Ne=new s.P(o.lineVertexArray.getx(Le),o.lineVertexArray.gety(Le)),Ge=_i(Ne.x,Ne.y,o),De=Ge.signedDistanceFromCamera>0?Ge.point:Sr(o.tileAnchorPoint,Ne,Ie,1,o),Ze=Gt(Ie.x,Ie.y,o,u),He=Gt(De.x,De.y,o,u),Xe=$e(_.writingMode,Ze,He,H);if(Xe)return Xe}let Pe=xn(ne*z.getoffsetX(_.glyphStartIndex),ie,de,S,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,o,Q);if(!Pe||o.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ge=[Pe]}for(let Pe of ge)s.ao(V,Pe.point,Pe.angle);return{}}function Sr(C,o,u,_,v){let S=C.add(C.sub(o)._unit()),O=_i(S.x,S.y,v).point,z=u.sub(O);return u.add(z._mult(_/z.mag()))}function kr(C,o,u){let _=o.projectionCache;if(_.projections[C])return _.projections[C];let v=new s.P(o.lineVertexArray.getx(C),o.lineVertexArray.gety(C)),S=_i(v.x,v.y,o);if(S.signedDistanceFromCamera>0)return _.projections[C]=S.point,_.anyProjectionOccluded=_.anyProjectionOccluded||S.isOccluded,S.point;let O=C-u.direction;return Sr(u.distanceFromAnchor===0?o.tileAnchorPoint:new s.P(o.lineVertexArray.getx(O),o.lineVertexArray.gety(O)),v,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,o)}function _i(C,o,u){let _=C+u.translation[0],v=o+u.translation[1],S;return u.pitchWithMap?(S=Mt(_,v,u.pitchedLabelPlaneMatrix,u.getElevation),S.isOccluded=!1):(S=u.transform.projectTileCoordinates(_,v,u.unwrappedTileID,u.getElevation),S.point.x=(.5*S.point.x+.5)*u.width,S.point.y=(.5*-S.point.y+.5)*u.height),S}function Gt(C,o,u,_){if(u.pitchWithMap){let v=[C,o,0,1];return s.ap(v,v,_),u.transform.projectTileCoordinates(v[0]/v[3],v[1]/v[3],u.unwrappedTileID,u.getElevation).point}return{x:C/u.width*2-1,y:o/u.height*2-1}}function pr(C,o,u){return u.transform.projectTileCoordinates(C,o,u.unwrappedTileID,u.getElevation)}function tr(C,o,u){return C._unit()._perp()._mult(o*u)}function Vr(C,o,u,_,v,S,O,z,V){if(z.projectionCache.offsets[C])return z.projectionCache.offsets[C];let H=u.add(o);if(C+V.direction<_||C+V.direction>=v)return z.projectionCache.offsets[C]=H,H;let Q=kr(C+V.direction,z,V),ne=tr(Q.sub(u),O,V.direction),ie=u.add(ne),de=Q.add(ne);return z.projectionCache.offsets[C]=s.aq(S,H,ie,de)||H,z.projectionCache.offsets[C]}function xn(C,o,u,_,v,S,O,z,V){let H=_?C-o:C+o,Q=H>0?1:-1,ne=0;_&&(Q*=-1,ne=Math.PI),Q<0&&(ne+=Math.PI);let ie,de=Q>0?S+v:S+v+1;z.projectionCache.cachedAnchorPoint?ie=z.projectionCache.cachedAnchorPoint:(ie=_i(z.tileAnchorPoint.x,z.tileAnchorPoint.y,z).point,z.projectionCache.cachedAnchorPoint=ie);let ge,Pe,Ie=ie,Le=ie,Ne=0,Ge=0,De=Math.abs(H),Ze=[],He;for(;Ne+Ge<=De;){if(de+=Q,de<S||de>=O)return null;Ne+=Ge,Le=Ie,Pe=ge;let At={absOffsetX:De,direction:Q,distanceFromAnchor:Ne,previousVertex:Le};if(Ie=kr(de,z,At),u===0)Ze.push(Le),He=Ie.sub(Le);else{let Pt,Ot=Ie.sub(Le);Pt=Ot.mag()===0?tr(kr(de+Q,z,At).sub(Ie),u,Q):tr(Ot,u,Q),Pe||(Pe=Le.add(Pt)),ge=Vr(de,Pt,Ie,S,O,Pe,u,z,At),Ze.push(Pe),He=ge.sub(Pe)}Ge=He.mag()}let Xe=He._mult((De-Ne)/Ge)._add(Pe||Le),yt=ne+Math.atan2(Ie.y-Le.y,Ie.x-Le.x);return Ze.push(Xe),{point:Xe,angle:V?yt:0,path:Ze}}let ma=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Br(C,o){for(let u=0;u<C;u++){let _=o.length;o.resize(_+4),o.float32.set(ma,3*_)}}function Kn(C,o,u){let _=o[0],v=o[1];return C[0]=u[0]*_+u[4]*v+u[12],C[1]=u[1]*_+u[5]*v+u[13],C[3]=u[3]*_+u[7]*v+u[15],C}let rn=100;class nh{constructor(o,u=new Qe(o.width+200,o.height+200,25),_=new Qe(o.width+200,o.height+200,25)){this.transform=o,this.grid=u,this.ignoredGrid=_,this.pitchFactor=Math.cos(o.pitch*Math.PI/180)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+rn,this.screenBottomBoundary=o.height+rn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,u,_,v,S,O,z,V,H,Q,ne,ie){let de=this.projectAndGetPerspectiveRatio(o.anchorPointX+V[0],o.anchorPointY+V[1],S,Q,ie),ge=_*de.perspectiveRatio,Pe;if(O||z)Pe=this._projectCollisionBox(o,ge,v,S,O,z,V,de,Q,ne,ie);else{let He=de.x+(ne?ne.x*ge:0),Xe=de.y+(ne?ne.y*ge:0);Pe={allPointsOccluded:!1,box:[He+o.x1*ge,Xe+o.y1*ge,He+o.x2*ge,Xe+o.y2*ge]}}let[Ie,Le,Ne,Ge]=Pe.box,De=O?Pe.allPointsOccluded:de.isOccluded,Ze=De;return Ze||(Ze=de.perspectiveRatio<this.perspectiveRatioCutoff),Ze||(Ze=!this.isInsideGrid(Ie,Le,Ne,Ge)),Ze||u!=="always"&&this.grid.hitTest(Ie,Le,Ne,Ge,u,H)?{box:[Ie,Le,Ne,Ge],placeable:!1,offscreen:!1,occluded:De}:{box:[Ie,Le,Ne,Ge],placeable:!0,offscreen:this.isOffscreen(Ie,Le,Ne,Ge),occluded:De}}placeCollisionCircles(o,u,_,v,S,O,z,V,H,Q,ne,ie,de,ge){let Pe=[],Ie=new s.P(u.anchorX,u.anchorY),Le=this.getPerspectiveRatio(Ie.x,Ie.y,O,ge),Ne=(H?S*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,O)/Le:S*Le)/s.av,Ge={getElevation:ge,pitchedLabelPlaneMatrix:z,lineVertexArray:_,pitchWithMap:H,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Ie,unwrappedTileID:O,width:this.transform.width,height:this.transform.height,translation:de},De=nr(Ne,v,u.lineOffsetX*Ne,u.lineOffsetY*Ne,!1,u,!1,Ge),Ze=!1,He=!1,Xe=!0;if(De){let yt=.5*ne*Le+ie,At=new s.P(-100,-100),Pt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Ot=new Ve,Tt=De.first,er=De.last,Kt=[];for(let Nt=Tt.path.length-1;Nt>=1;Nt--)Kt.push(Tt.path[Nt]);for(let Nt=1;Nt<er.path.length;Nt++)Kt.push(er.path[Nt]);let Ut=2.5*yt;if(H){let Nt=this.projectPathToScreenSpace(Kt,Ge);Kt=Nt.some(Bi=>Bi.signedDistanceFromCamera<=0)?[]:Nt.map(Bi=>Bi.point)}let mt=[];if(Kt.length>0){let Nt=Kt[0].clone(),Bi=Kt[0].clone();for(let $r=1;$r<Kt.length;$r++)Nt.x=Math.min(Nt.x,Kt[$r].x),Nt.y=Math.min(Nt.y,Kt[$r].y),Bi.x=Math.max(Bi.x,Kt[$r].x),Bi.y=Math.max(Bi.y,Kt[$r].y);mt=Nt.x>=At.x&&Bi.x<=Pt.x&&Nt.y>=At.y&&Bi.y<=Pt.y?[Kt]:Bi.x<At.x||Nt.x>Pt.x||Bi.y<At.y||Nt.y>Pt.y?[]:s.ar([Kt],At.x,At.y,Pt.x,Pt.y)}for(let Nt of mt){Ot.reset(Nt,.25*yt);let Bi=0;Bi=Ot.length<=.5*yt?1:Math.ceil(Ot.paddedLength/Ut)+1;for(let $r=0;$r<Bi;$r++){let zi=$r/Math.max(Bi-1,1),Zi=Ot.lerp(zi),Ui=Zi.x+rn,Wi=Zi.y+rn;Pe.push(Ui,Wi,yt,0);let wi=Ui-yt,m=Wi-yt,A=Ui+yt,b=Wi+yt;if(Xe=Xe&&this.isOffscreen(wi,m,A,b),He=He||this.isInsideGrid(wi,m,A,b),o!=="always"&&this.grid.hitTestCircle(Ui,Wi,yt,o,Q)&&(Ze=!0,!V))return{circles:[],offscreen:!1,collisionDetected:Ze}}}}return{circles:!V&&Ze||!He||Le<this.perspectiveRatioCutoff?[]:Pe,offscreen:Xe,collisionDetected:Ze}}projectPathToScreenSpace(o,u){let _=function(v,S){let O=s.K();return s.aj(O,S.pitchedLabelPlaneMatrix),v.map(z=>{let V=Mt(z.x,z.y,O,S.getElevation),H=S.transform.projectTileCoordinates(V.point.x,V.point.y,S.unwrappedTileID,S.getElevation);return H.point.x=(.5*H.point.x+.5)*S.width,H.point.y=(.5*-H.point.y+.5)*S.height,H})}(o,u);return function(v){let S=0,O=0,z=0,V=0;for(let H=0;H<v.length;H++)v[H].isOccluded?(z=H+1,V=0):(V++,V>O&&(O=V,S=z));return v.slice(S,S+O)}(_)}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let u=[],_=1/0,v=1/0,S=-1/0,O=-1/0;for(let Q of o){let ne=new s.P(Q.x+rn,Q.y+rn);_=Math.min(_,ne.x),v=Math.min(v,ne.y),S=Math.max(S,ne.x),O=Math.max(O,ne.y),u.push(ne)}let z=this.grid.query(_,v,S,O).concat(this.ignoredGrid.query(_,v,S,O)),V={},H={};for(let Q of z){let ne=Q.key;if(V[ne.bucketInstanceId]===void 0&&(V[ne.bucketInstanceId]={}),V[ne.bucketInstanceId][ne.featureIndex])continue;let ie=[new s.P(Q.x1,Q.y1),new s.P(Q.x2,Q.y1),new s.P(Q.x2,Q.y2),new s.P(Q.x1,Q.y2)];s.as(u,ie)&&(V[ne.bucketInstanceId][ne.featureIndex]=!0,H[ne.bucketInstanceId]===void 0&&(H[ne.bucketInstanceId]=[]),H[ne.bucketInstanceId].push(ne.featureIndex))}return H}insertCollisionBox(o,u,_,v,S,O){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:S,collisionGroupID:O,overlapMode:u},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,_,v,S,O){let z=_?this.ignoredGrid:this.grid,V={bucketInstanceId:v,featureIndex:S,collisionGroupID:O,overlapMode:u};for(let H=0;H<o.length;H+=4)z.insertCircle(V,o[H],o[H+1],o[H+2])}projectAndGetPerspectiveRatio(o,u,_,v,S){if(S){let O;v?(O=[o,u,v(o,u),1],s.ap(O,O,S)):(O=[o,u,0,1],Kn(O,O,S));let z=O[3];return{x:(O[0]/z+1)/2*this.transform.width+rn,y:(-O[1]/z+1)/2*this.transform.height+rn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/z*.5,isOccluded:!1,signedDistanceFromCamera:z}}{let O=this.transform.projectTileCoordinates(o,u,_,v);return{x:(O.point.x+1)/2*this.transform.width+rn,y:(1-O.point.y)/2*this.transform.height+rn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O.signedDistanceFromCamera*.5,isOccluded:O.isOccluded,signedDistanceFromCamera:O.signedDistanceFromCamera}}}getPerspectiveRatio(o,u,_,v){let S=this.transform.projectTileCoordinates(o,u,_,v);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(o,u,_,v){return _<rn||o>=this.screenRightBoundary||v<rn||u>this.screenBottomBoundary}isInsideGrid(o,u,_,v){return _>=0&&o<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let o=s.at([]);return s.L(o,o,[-100,-100,0]),o}_projectCollisionBox(o,u,_,v,S,O,z,V,H,Q,ne){let ie=1,de=0,ge=0,Pe=1,Ie=o.anchorPointX+z[0],Le=o.anchorPointY+z[1];if(O&&!S){let Kt=this.projectAndGetPerspectiveRatio(Ie+1,Le,v,H,ne),Ut=Kt.x-V.x,mt=Math.atan((Kt.y-V.y)/Ut)+(Ut<0?Math.PI:0),Nt=Math.sin(mt),Bi=Math.cos(mt);ie=Bi,de=Nt,ge=-Nt,Pe=Bi}else if(!O&&S){let Kt=Bt(this.transform);ie=Kt.vecEast[0],de=Kt.vecEast[1],ge=Kt.vecSouth[0],Pe=Kt.vecSouth[1]}let Ne=V.x,Ge=V.y,De=u;S&&(Ne=Ie,Ge=Le,De=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),De*=this.transform.getPitchedTextCorrection(Ie,Le,v),Q||(De*=s.ae(.5+V.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),Q&&(Ne+=ie*Q.x*De+ge*Q.y*De,Ge+=de*Q.x*De+Pe*Q.y*De);let Ze=o.x1*De,He=o.x2*De,Xe=(Ze+He)/2,yt=o.y1*De,At=o.y2*De,Pt=(yt+At)/2,Ot=[{offsetX:Ze,offsetY:yt},{offsetX:Xe,offsetY:yt},{offsetX:He,offsetY:yt},{offsetX:He,offsetY:Pt},{offsetX:He,offsetY:At},{offsetX:Xe,offsetY:At},{offsetX:Ze,offsetY:At},{offsetX:Ze,offsetY:Pt}],Tt=[];for(let{offsetX:Kt,offsetY:Ut}of Ot)Tt.push(new s.P(Ne+ie*Kt+ge*Ut,Ge+de*Kt+Pe*Ut));let er=!1;if(S){let Kt=Tt.map(Ut=>this.projectAndGetPerspectiveRatio(Ut.x,Ut.y,v,H,ne));er=Kt.some(Ut=>!Ut.isOccluded),Tt=Kt.map(Ut=>new s.P(Ut.x,Ut.y))}else er=!0;return{box:s.au(Tt),allPointsOccluded:!er}}}class Wl{constructor(o,u,_,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):v&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Ct{constructor(o,u,_,v,S){this.text=new Wl(o?o.text:null,u,_,S),this.icon=new Wl(o?o.icon:null,u,v,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kr{constructor(o,u,_){this.text=o,this.icon=u,this.skipFade=_}}class ii{constructor(o,u,_,v,S){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=v,this.tileID=S}}class Xs{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[o]}}function Qn(C,o,u,_,v){let{horizontalAlign:S,verticalAlign:O}=s.aB(C);return new s.P(-(S-.5)*o+_[0]*v,-(O-.5)*u+_[1]*v)}class Co{constructor(o,u,_,v,S){this.transform=o.clone(),this.terrain=u,this.collisionIndex=new nh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Xs(v),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){let u=this.terrain;return u?(_,v)=>u.getElevation(o,_,v):null}getBucketParts(o,u,_,v){let S=_.getBucket(u),O=_.latestFeatureIndex;if(!S||!O||u.id!==S.layerIds[0])return;let z=_.collisionBoxArray,V=S.layers[0].layout,H=S.layers[0].paint,Q=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),ne=_.tileSize/s.Z,ie=_.tileID.toUnwrapped(),de=V.get("text-rotation-alignment")==="map",ge=s.aw(_,1,this.transform.zoom),Pe=s.ax(this.collisionIndex.transform,_,H.get("text-translate"),H.get("text-translate-anchor")),Ie=s.ax(this.collisionIndex.transform,_,H.get("icon-translate"),H.get("icon-translate-anchor")),Le=dt(de,this.transform,ge);this.retainedQueryData[S.bucketInstanceId]=new ii(S.bucketInstanceId,O,S.sourceLayerIndex,S.index,_.tileID);let Ne={bucket:S,layout:V,translationText:Pe,translationIcon:Ie,unwrappedTileID:ie,pitchedLabelPlaneMatrix:Le,scale:Q,textPixelRatio:ne,holdingForFade:_.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:s.ag(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(v)for(let Ge of S.sortKeyRanges){let{sortKey:De,symbolInstanceStart:Ze,symbolInstanceEnd:He}=Ge;o.push({sortKey:De,symbolInstanceStart:Ze,symbolInstanceEnd:He,parameters:Ne})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(o,u,_,v,S,O,z,V,H,Q,ne,ie,de,ge,Pe,Ie,Le,Ne,Ge,De){let Ze=s.ay[o.textAnchor],He=[o.textOffset0,o.textOffset1],Xe=Qn(Ze,_,v,He,S),yt=this.collisionIndex.placeCollisionBox(u,ie,V,H,Q,z,O,Ie,ne.predicate,Ge,Xe,De);if((!Ne||this.collisionIndex.placeCollisionBox(Ne,ie,V,H,Q,z,O,Le,ne.predicate,Ge,Xe,De).placeable)&&yt.placeable){let At;if(this.prevPlacement&&this.prevPlacement.variableOffsets[de.crossTileID]&&this.prevPlacement.placements[de.crossTileID]&&this.prevPlacement.placements[de.crossTileID].text&&(At=this.prevPlacement.variableOffsets[de.crossTileID].anchor),de.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[de.crossTileID]={textOffset:He,width:_,height:v,anchor:Ze,textBoxScale:S,prevAnchor:At},this.markUsedJustification(ge,Ze,de,Pe),ge.allowVerticalPlacement&&(this.markUsedOrientation(ge,Pe,de),this.placedOrientations[de.crossTileID]=Pe),{shift:Xe,placedGlyphBoxes:yt}}}placeLayerBucketPart(o,u,_){let{bucket:v,layout:S,translationText:O,translationIcon:z,unwrappedTileID:V,pitchedLabelPlaneMatrix:H,textPixelRatio:Q,holdingForFade:ne,collisionBoxArray:ie,partiallyEvaluatedTextSize:de,collisionGroup:ge}=o.parameters,Pe=S.get("text-optional"),Ie=S.get("icon-optional"),Le=s.az(S,"text-overlap","text-allow-overlap"),Ne=Le==="always",Ge=s.az(S,"icon-overlap","icon-allow-overlap"),De=Ge==="always",Ze=S.get("text-rotation-alignment")==="map",He=S.get("text-pitch-alignment")==="map",Xe=S.get("icon-text-fit")!=="none",yt=S.get("symbol-z-order")==="viewport-y",At=Ne&&(De||!v.hasIconData()||Ie),Pt=De&&(Ne||!v.hasTextData()||Pe);!v.collisionArrays&&ie&&v.deserializeCollisionBoxes(ie);let Ot=this.retainedQueryData[v.bucketInstanceId].tileID,Tt=this._getTerrainElevationFunc(Ot),er=this.transform.getFastPathSimpleProjectionMatrix(Ot),Kt=(Ut,mt,Nt)=>{var Bi,$r;if(u[Ut.crossTileID])return;if(ne)return void(this.placements[Ut.crossTileID]=new Kr(!1,!1,!1));let zi=!1,Zi=!1,Ui=!0,Wi=null,wi={box:null,placeable:!1,offscreen:null,occluded:!1},m={placeable:!1},A=null,b=null,E=null,M=0,B=0,F=0;mt.textFeatureIndex?M=mt.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(M=Ut.featureIndex),mt.verticalTextFeatureIndex&&(B=mt.verticalTextFeatureIndex);let N=mt.textBox;if(N){let Te=nt=>{let It=s.ah.horizontal;if(v.allowVerticalPlacement&&!nt&&this.prevPlacement){let wt=this.prevPlacement.placedOrientations[Ut.crossTileID];wt&&(this.placedOrientations[Ut.crossTileID]=wt,It=wt,this.markUsedOrientation(v,It,Ut))}return It},qe=(nt,It)=>{if(v.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&mt.verticalTextBox){for(let wt of v.writingModes)if(wt===s.ah.vertical?(wi=It(),m=wi):wi=nt(),wi&&wi.placeable)break}else wi=nt()},Je=Ut.textAnchorOffsetStartIndex,je=Ut.textAnchorOffsetEndIndex;if(je===Je){let nt=(It,wt)=>{let at=this.collisionIndex.placeCollisionBox(It,Le,Q,Ot,V,He,Ze,O,ge.predicate,Tt,void 0,er);return at&&at.placeable&&(this.markUsedOrientation(v,wt,Ut),this.placedOrientations[Ut.crossTileID]=wt),at};qe(()=>nt(N,s.ah.horizontal),()=>{let It=mt.verticalTextBox;return v.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&It?nt(It,s.ah.vertical):{box:null,offscreen:null}}),Te(wi&&wi.placeable)}else{let nt=s.ay[($r=(Bi=this.prevPlacement)===null||Bi===void 0?void 0:Bi.variableOffsets[Ut.crossTileID])===null||$r===void 0?void 0:$r.anchor],It=(at,bt,ft)=>{let ar=at.x2-at.x1,gr=at.y2-at.y1,sr=Ut.textBoxScale,lr=Xe&&Ge==="never"?bt:null,mi=null,ri=Le==="never"?1:2,ni="never";nt&&ri++;for(let qr=0;qr<ri;qr++){for(let jr=Je;jr<je;jr++){let Hr=v.textAnchorOffsets.get(jr);if(nt&&Hr.textAnchor!==nt)continue;let Vi=this.attemptAnchorPlacement(Hr,at,ar,gr,sr,Ze,He,Q,Ot,V,ge,ni,Ut,v,ft,O,z,lr,Tt);if(Vi&&(mi=Vi.placedGlyphBoxes,mi&&mi.placeable))return zi=!0,Wi=Vi.shift,mi}nt?nt=null:ni=Le}return _&&!mi&&(mi={box:this.collisionIndex.placeCollisionBox(N,"always",Q,Ot,V,He,Ze,O,ge.predicate,Tt,void 0,er).box,offscreen:!1,placeable:!1,occluded:!1}),mi};qe(()=>It(N,mt.iconBox,s.ah.horizontal),()=>{let at=mt.verticalTextBox;return v.allowVerticalPlacement&&(!wi||!wi.placeable)&&Ut.numVerticalGlyphVertices>0&&at?It(at,mt.verticalIconBox,s.ah.vertical):{box:null,occluded:!0,offscreen:null}}),wi&&(zi=wi.placeable,Ui=wi.offscreen);let wt=Te(wi&&wi.placeable);if(!zi&&this.prevPlacement){let at=this.prevPlacement.variableOffsets[Ut.crossTileID];at&&(this.variableOffsets[Ut.crossTileID]=at,this.markUsedJustification(v,at.anchor,Ut,wt))}}}if(A=wi,zi=A&&A.placeable,Ui=A&&A.offscreen,Ut.useRuntimeCollisionCircles){let Te=v.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex),qe=s.ai(v.textSizeData,de,Te),Je=S.get("text-padding");b=this.collisionIndex.placeCollisionCircles(Le,Te,v.lineVertexArray,v.glyphOffsetArray,qe,V,H,_,He,ge.predicate,Ut.collisionCircleDiameter,Je,O,Tt),b.circles.length&&b.collisionDetected&&!_&&s.w("Collisions detected, but collision boxes are not shown"),zi=Ne||b.circles.length>0&&!b.collisionDetected,Ui=Ui&&b.offscreen}if(mt.iconFeatureIndex&&(F=mt.iconFeatureIndex),mt.iconBox){let Te=qe=>this.collisionIndex.placeCollisionBox(qe,Ge,Q,Ot,V,He,Ze,z,ge.predicate,Tt,Xe&&Wi?Wi:void 0,er);m&&m.placeable&&mt.verticalIconBox?(E=Te(mt.verticalIconBox),Zi=E.placeable):(E=Te(mt.iconBox),Zi=E.placeable),Ui=Ui&&E.offscreen}let W=Pe||Ut.numHorizontalGlyphVertices===0&&Ut.numVerticalGlyphVertices===0,ee=Ie||Ut.numIconVertices===0;W||ee?ee?W||(Zi=Zi&&zi):zi=Zi&&zi:Zi=zi=Zi&&zi;let fe=Zi&&E.placeable;if(zi&&A.placeable&&this.collisionIndex.insertCollisionBox(A.box,Le,S.get("text-ignore-placement"),v.bucketInstanceId,m&&m.placeable&&B?B:M,ge.ID),fe&&this.collisionIndex.insertCollisionBox(E.box,Ge,S.get("icon-ignore-placement"),v.bucketInstanceId,F,ge.ID),b&&zi&&this.collisionIndex.insertCollisionCircles(b.circles,Le,S.get("text-ignore-placement"),v.bucketInstanceId,M,ge.ID),_&&this.storeCollisionData(v.bucketInstanceId,Nt,mt,A,E,b),Ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ut.crossTileID]=new Kr((zi||At)&&!A?.occluded,(Zi||Pt)&&!E?.occluded,Ui||v.justReloaded),u[Ut.crossTileID]=!0};if(yt){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ut=v.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let mt=Ut.length-1;mt>=0;--mt){let Nt=Ut[mt];Kt(v.symbolInstances.get(Nt),v.collisionArrays[Nt],Nt)}}else for(let Ut=o.symbolInstanceStart;Ut<o.symbolInstanceEnd;Ut++)Kt(v.symbolInstances.get(Ut),v.collisionArrays[Ut],Ut);v.justReloaded=!1}storeCollisionData(o,u,_,v,S,O){if(_.textBox||_.iconBox){let z,V;this.collisionBoxArrays.has(o)?z=this.collisionBoxArrays.get(o):(z=new Map,this.collisionBoxArrays.set(o,z)),z.has(u)?V=z.get(u):(V={text:null,icon:null},z.set(u,V)),_.textBox&&(V.text=v.box),_.iconBox&&(V.icon=S.box)}if(O){let z=this.collisionCircleArrays[o];z===void 0&&(z=this.collisionCircleArrays[o]=[]);for(let V=0;V<O.circles.length;V+=4)z.push(O.circles[V+0]-rn),z.push(O.circles[V+1]-rn),z.push(O.circles[V+2]),z.push(O.collisionDetected?1:0)}}markUsedJustification(o,u,_,v){let S;S=v===s.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[s.aA(u)];let O=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(let z of O)z>=0&&(o.text.placedSymbolArray.get(z).crossTileID=S>=0&&z!==S?0:_.crossTileID)}markUsedOrientation(o,u,_){let v=u===s.ah.horizontal||u===s.ah.horizontalOnly?u:0,S=u===s.ah.vertical?u:0,O=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(let z of O)o.text.placedSymbolArray.get(z).placedOrientation=v;_.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,_=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let v=u?u.symbolFadeChange(o):1,S=u?u.opacities:{},O=u?u.variableOffsets:{},z=u?u.placedOrientations:{};for(let V in this.placements){let H=this.placements[V],Q=S[V];Q?(this.opacities[V]=new Ct(Q,v,H.text,H.icon),_=_||H.text!==Q.text.placed||H.icon!==Q.icon.placed):(this.opacities[V]=new Ct(null,v,H.text,H.icon,H.skipFade),_=_||H.text||H.icon)}for(let V in S){let H=S[V];if(!this.opacities[V]){let Q=new Ct(H,v,!1,!1);Q.isHidden()||(this.opacities[V]=Q,_=_||H.text.placed||H.icon.placed)}}for(let V in O)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=O[V]);for(let V in z)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=z[V]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){let _={};for(let v of u){let S=v.getBucket(o);S&&v.latestFeatureIndex&&o.id===S.layerIds[0]&&this.updateBucketOpacities(S,v.tileID,_,v.collisionBoxArray)}}updateBucketOpacities(o,u,_,v){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let S=o.layers[0],O=S.layout,z=new Ct(null,0,!1,!1,!0),V=O.get("text-allow-overlap"),H=O.get("icon-allow-overlap"),Q=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ne=O.get("text-rotation-alignment")==="map",ie=O.get("text-pitch-alignment")==="map",de=O.get("icon-text-fit")!=="none",ge=new Ct(null,0,V&&(H||!o.hasIconData()||O.get("icon-optional")),H&&(V||!o.hasTextData()||O.get("text-optional")),!0);!o.collisionArrays&&v&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(v);let Pe=(Le,Ne,Ge)=>{for(let De=0;De<Ne/4;De++)Le.opacityVertexArray.emplaceBack(Ge);Le.hasVisibleVertices=Le.hasVisibleVertices||Ge!==Fa},Ie=this.collisionBoxArrays.get(o.bucketInstanceId);for(let Le=0;Le<o.symbolInstances.length;Le++){let Ne=o.symbolInstances.get(Le),{numHorizontalGlyphVertices:Ge,numVerticalGlyphVertices:De,crossTileID:Ze}=Ne,He=this.opacities[Ze];_[Ze]?He=z:He||(He=ge,this.opacities[Ze]=He),_[Ze]=!0;let Xe=Ne.numIconVertices>0,yt=this.placedOrientations[Ne.crossTileID],At=yt===s.ah.vertical,Pt=yt===s.ah.horizontal||yt===s.ah.horizontalOnly;if(Ge>0||De>0){let Tt=Hd(He.text);Pe(o.text,Ge,At?Fa:Tt),Pe(o.text,De,Pt?Fa:Tt);let er=He.text.isHidden();[Ne.rightJustifiedTextSymbolIndex,Ne.centerJustifiedTextSymbolIndex,Ne.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(o.text.placedSymbolArray.get(mt).hidden=er||At?1:0)}),Ne.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Ne.verticalPlacedTextSymbolIndex).hidden=er||Pt?1:0);let Kt=this.variableOffsets[Ne.crossTileID];Kt&&this.markUsedJustification(o,Kt.anchor,Ne,yt);let Ut=this.placedOrientations[Ne.crossTileID];Ut&&(this.markUsedJustification(o,"left",Ne,Ut),this.markUsedOrientation(o,Ut,Ne))}if(Xe){let Tt=Hd(He.icon),er=!(de&&Ne.verticalPlacedIconSymbolIndex&&At);Ne.placedIconSymbolIndex>=0&&(Pe(o.icon,Ne.numIconVertices,er?Tt:Fa),o.icon.placedSymbolArray.get(Ne.placedIconSymbolIndex).hidden=He.icon.isHidden()),Ne.verticalPlacedIconSymbolIndex>=0&&(Pe(o.icon,Ne.numVerticalIconVertices,er?Fa:Tt),o.icon.placedSymbolArray.get(Ne.verticalPlacedIconSymbolIndex).hidden=He.icon.isHidden())}let Ot=Ie&&Ie.has(Le)?Ie.get(Le):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let Tt=o.collisionArrays[Le];if(Tt){let er=new s.P(0,0);if(Tt.textBox||Tt.verticalTextBox){let Kt=!0;if(Q){let Ut=this.variableOffsets[Ze];Ut?(er=Qn(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale),ne&&er._rotate(ie?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Kt=!1}if(Tt.textBox||Tt.verticalTextBox){let Ut;Tt.textBox&&(Ut=At),Tt.verticalTextBox&&(Ut=Pt),us(o.textCollisionBox.collisionVertexArray,He.text.placed,!Kt||Ut,Ot.text,er.x,er.y)}}if(Tt.iconBox||Tt.verticalIconBox){let Kt=!!(!Pt&&Tt.verticalIconBox),Ut;Tt.iconBox&&(Ut=Kt),Tt.verticalIconBox&&(Ut=!Kt),us(o.iconCollisionBox.collisionVertexArray,He.icon.placed,Ut,Ot.icon,de?er.x:0,de?er.y:0)}}}}if(o.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);o.bucketInstanceId in this.collisionCircleArrays&&(o.collisionCircleArray=this.collisionCircleArrays[o.bucketInstanceId],delete this.collisionCircleArrays[o.bucketInstanceId])}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){let _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>o}setStale(){this.stale=!0}}function us(C,o,u,_,v,S){_&&_.length!==0||(_=[0,0,0,0]);let O=_[0]-rn,z=_[1]-rn,V=_[2]-rn,H=_[3]-rn;C.emplaceBack(o?1:0,u?1:0,v||0,S||0,O,z),C.emplaceBack(o?1:0,u?1:0,v||0,S||0,V,z),C.emplaceBack(o?1:0,u?1:0,v||0,S||0,V,H),C.emplaceBack(o?1:0,u?1:0,v||0,S||0,O,H)}let Ti=Math.pow(2,25),$l=Math.pow(2,24),ao=Math.pow(2,17),sh=Math.pow(2,16),lo=Math.pow(2,9),lf=Math.pow(2,8),qc=Math.pow(2,1);function Hd(C){if(C.opacity===0&&!C.placed)return 0;if(C.opacity===1&&C.placed)return 4294967295;let o=C.placed?1:0,u=Math.floor(127*C.opacity);return u*Ti+o*$l+u*ao+o*sh+u*lo+o*lf+u*qc+o}let Fa=0;class ql{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,u,_,v,S){let O=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(O,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((z,V)=>z.sortKey-V.sortKey));this._currentPartIndex<O.length;)if(u.placeLayerBucketPart(O[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,S())return!0;return!1}}class Jn{constructor(o,u,_,v,S,O,z,V){this.placement=new Co(o,u,O,z,V),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(o,u,_){let v=x.now(),S=()=>!this._forceFullPlacement&&x.now()-v>2;for(;this._currentPlacementIndex>=0;){let O=u[o[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=z)&&(!O.maxzoom||O.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new ql(O)),this._inProgressLayer.continuePlacement(_[O.source],this.placement,this._showCollisionBoxes,O,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let Zc=512/s.Z/2;class QA{constructor(o,u,_){this.tileID=o,this.bucketInstanceId=_,this._symbolsByKey={};let v=new Map;for(let S=0;S<u.length;S++){let O=u.get(S),z=O.key,V=v.get(z);V?V.push(O):v.set(z,[O])}for(let[S,O]of v){let z={positions:O.map(V=>({x:Math.floor(V.anchorX*Zc),y:Math.floor(V.anchorY*Zc)})),crossTileIDs:O.map(V=>V.crossTileID)};if(z.positions.length>128){let V=new s.aC(z.positions.length,16,Uint16Array);for(let{x:H,y:Q}of z.positions)V.add(H,Q);V.finish(),delete z.positions,z.index=V}this._symbolsByKey[S]=z}}getScaledCoordinates(o,u){let{x:_,y:v,z:S}=this.tileID.canonical,{x:O,y:z,z:V}=u.canonical,H=Zc/Math.pow(2,V-S),Q=(z*s.Z+o.anchorY)*H,ne=v*s.Z*Zc;return{x:Math.floor((O*s.Z+o.anchorX)*H-_*s.Z*Zc),y:Math.floor(Q-ne)}}findMatches(o,u,_){let v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let S=0;S<o.length;S++){let O=o.get(S);if(O.crossTileID)continue;let z=this._symbolsByKey[O.key];if(!z)continue;let V=this.getScaledCoordinates(O,u);if(z.index){let H=z.index.range(V.x-v,V.y-v,V.x+v,V.y+v).sort();for(let Q of H){let ne=z.crossTileIDs[Q];if(!_[ne]){_[ne]=!0,O.crossTileID=ne;break}}}else if(z.positions)for(let H=0;H<z.positions.length;H++){let Q=z.positions[H],ne=z.crossTileIDs[H];if(Math.abs(Q.x-V.x)<=v&&Math.abs(Q.y-V.y)<=v&&!_[ne]){_[ne]=!0,O.crossTileID=ne;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Dg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class JA{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let u=Math.round((o-this.lng)/360);if(u!==0)for(let _ in this.indexes){let v=this.indexes[_],S={};for(let O in v){let z=v[O];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+u),S[z.tileID.key]=z}this.indexes[_]=S}this.lng=o}addBucket(o,u,_){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let S=0;S<u.symbolInstances.length;S++)u.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});let v=this.usedCrossTileIDs[o.overscaledZ];for(let S in this.indexes){let O=this.indexes[S];if(Number(S)>o.overscaledZ)for(let z in O){let V=O[z];V.tileID.isChildOf(o)&&V.findMatches(u.symbolInstances,o,v)}else{let z=O[o.scaledTo(Number(S)).key];z&&z.findMatches(u.symbolInstances,o,v)}}for(let S=0;S<u.symbolInstances.length;S++){let O=u.symbolInstances.get(S);O.crossTileID||(O.crossTileID=_.generate(),v[O.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new QA(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(let _ of u.getCrossTileIDsLists())for(let v of _)delete this.usedCrossTileIDs[o][v]}removeStaleBuckets(o){let u=!1;for(let _ in this.indexes){let v=this.indexes[_];for(let S in v)o[v[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,v[S]),delete v[S],u=!0)}return u}}class Wd{constructor(){this.layerIndexes={},this.crossTileIDs=new Dg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,_){let v=this.layerIndexes[o.id];v===void 0&&(v=this.layerIndexes[o.id]=new JA);let S=!1,O={};v.handleWrapJump(_);for(let z of u){let V=z.getBucket(o);V&&o.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(z.tileID,V,this.crossTileIDs)&&(S=!0),O[V.bucketInstanceId]=!0)}return v.removeStaleBuckets(O)&&(S=!0),S}pruneUnusedLayers(o){let u={};o.forEach(_=>{u[_]=!0});for(let _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}var cf="void main() {fragColor=vec4(1.0);}";let ga={prelude:hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:hi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:hi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:hi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:hi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:hi(cf,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:hi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:hi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:hi(cf,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:hi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:hi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:hi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:hi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:hi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:hi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:hi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:hi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:hi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:hi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function hi(C,o){let u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=o.match(/in ([\w]+) ([\w]+)/g),v=C.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),O=S?S.concat(v):v,z={};return{fragmentSource:C=C.replace(u,(V,H,Q,ne,ie)=>(z[ie]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
in ${Q} ${ne} ${ie};
#else
uniform ${Q} ${ne} u_${ie};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ie}
    ${Q} ${ne} ${ie} = u_${ie};
#endif
`)),vertexSource:o=o.replace(u,(V,H,Q,ne,ie)=>{let de=ne==="float"?"vec2":"vec4",ge=ie.match(/color/)?"color":de;return z[ie]?H==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
in ${Q} ${de} a_${ie};
out ${Q} ${ne} ${ie};
#else
uniform ${Q} ${ne} u_${ie};
#endif
`:ge==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = a_${ie};
#else
    ${Q} ${ne} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = unpack_mix_${ge}(a_${ie}, u_${ie}_t);
#else
    ${Q} ${ne} ${ie} = u_${ie};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
in ${Q} ${de} a_${ie};
#else
uniform ${Q} ${ne} u_${ie};
#endif
`:ge==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${Q} ${ne} ${ie} = a_${ie};
#else
    ${Q} ${ne} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${Q} ${ne} ${ie} = unpack_mix_${ge}(a_${ie}, u_${ie}_t);
#else
    ${Q} ${ne} ${ie} = u_${ie};
#endif
`}),staticAttributes:_,staticUniforms:O}}class Xc{constructor(o,u,_){this.vertexBuffer=o,this.indexBuffer=u,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Zl=s.aD([{name:"a_pos",type:"Int16",components:2}]);let cl="#define PROJECTION_MERCATOR",oh="mercator";class Ei{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return oh}get shaderDefine(){return cl}get shaderPreludeCode(){return ga.projectionMercator}get vertexShaderPreludeCode(){return ga.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aE.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(o){}getMeshFromTileID(o,u,_,v,S){if(this._cachedMesh)return this._cachedMesh;let O=new s.aF;O.emplaceBack(0,0),O.emplaceBack(s.Z,0),O.emplaceBack(0,s.Z),O.emplaceBack(s.Z,s.Z);let z=o.createVertexBuffer(O,Zl.members),V=s.aG.simpleSegment(0,0,4,2),H=new s.aH;H.emplaceBack(1,0,2),H.emplaceBack(1,2,3);let Q=o.createIndexBuffer(H);return this._cachedMesh=new Xc(z,Q,V),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(o){}}function Jo(C,o){let u=s.ae(o.lat,-85.051129,s.aJ);return new s.P(s.U(o.lng)*C,s.S(u)*C)}function uf(C,o){return new s.$(o.x/C,o.y/C).toLngLat()}function ah(C){return C.cameraToCenterDistance*Math.min(.85*Math.tan(s.ad(90-C.pitch)),Math.tan(s.ad(89.25-C.pitch)))}function co(C,o){let u=C.canonical,_=o/s.aI(u.z),v=u.x+Math.pow(2,u.z)*C.wrap,S=s.at(new Float64Array(16));return s.L(S,S,[v*_,u.y*_,0]),s.M(S,S,[_/s.Z,_/s.Z,1]),S}function Ds(C,o,u,_,v){let S=s.$.fromLngLat(C,o),O=v*s.aK(1,C.lat),z=O*Math.cos(s.ad(u)),V=Math.sqrt(O*O-z*z),H=V*Math.sin(s.ad(-_)),Q=V*Math.cos(s.ad(-_));return new s.$(S.x+H,S.y+Q,S.z+z)}class bn{constructor(o=0,u=0,_=0,v=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=_,this.right=v}interpolate(o,u,_){return u.top!=null&&o.top!=null&&(this.top=s.B.number(o.top,u.top,_)),u.bottom!=null&&o.bottom!=null&&(this.bottom=s.B.number(o.bottom,u.bottom,_)),u.left!=null&&o.left!=null&&(this.left=s.B.number(o.left,u.left,_)),u.right!=null&&o.right!=null&&(this.right=s.B.number(o.right,u.right,_)),this}getCenter(o,u){let _=s.ae((this.left+o-this.right)/2,0,o),v=s.ae((this.top+u-this.bottom)/2,0,u);return new s.P(_,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new bn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function $d(C,o){if(!C.renderWorldCopies||C.lngRange)return;let u=o.lng-C.center.lng;o.lng+=u>180?-360:u<-180?360:0}function uo(C){return Math.max(0,Math.floor(C))}class So{constructor(o,u,_,v,S,O){this._callbacks=o,this._tileSize=512,this._renderWorldCopies=O===void 0||!!O,this._minZoom=u||0,this._maxZoom=_||22,this._minPitch=v??0,this._maxPitch=S??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=uo(this._zoom),this._scale=s.aI(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new bn,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(o,u,_){this._latRange=o.latRange,this._lngRange=o.lngRange,this._width=o.width,this._height=o.height,this._center=o.center,this._elevation=o.elevation,this._minElevationForCurrentTile=o.minElevationForCurrentTile,this._zoom=o.zoom,this._tileZoom=uo(this._zoom),this._scale=s.aI(this._zoom),this._bearingInRadians=o.bearingInRadians,this._fovInRadians=o.fovInRadians,this._pitchInRadians=o.pitchInRadians,this._rollInRadians=o.rollInRadians,this._unmodified=o.unmodified,this._edgeInsets=new bn(o.padding.top,o.padding.bottom,o.padding.left,o.padding.right),this._minZoom=o.minZoom,this._maxZoom=o.maxZoom,this._minPitch=o.minPitch,this._maxPitch=o.maxPitch,this._renderWorldCopies=o.renderWorldCopies,this._cameraToCenterDistance=o.cameraToCenterDistance,this._nearZ=o.nearZ,this._farZ=o.farZ,this._autoCalculateNearFarZ=!_&&o.autoCalculateNearFarZ,u&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(o){this._minElevationForCurrentTile=o}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(o){this._minZoom!==o&&(this._minZoom=o,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(o){this._minPitch!==o&&(this._minPitch=o,this.setPitch(Math.max(this.pitch,o)))}get maxPitch(){return this._maxPitch}setMaxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.setPitch(Math.min(this.pitch,o)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(o){let u=s.aL(o,-180,180)*Math.PI/180;var _,v,S,O,z,V,H,Q,ne;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=c(),_=this._rotationMatrix,S=-this._bearingInRadians,O=(v=this._rotationMatrix)[0],z=v[1],V=v[2],H=v[3],Q=Math.sin(S),ne=Math.cos(S),_[0]=O*ne+V*Q,_[1]=z*ne+H*Q,_[2]=O*-Q+V*ne,_[3]=z*-Q+H*ne)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(o){let u=s.ae(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(o){let u=o/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aM(this._fovInRadians)}setFov(o){o=s.ae(o,.1,150),this.fov!==o&&(this._unmodified=!1,this._fovInRadians=s.ad(o),this._calcMatrices())}get zoom(){return this._zoom}setZoom(o){let u=this.getConstrained(this._center,o).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=s.aI(u),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(o,u){this._autoCalculateNearFarZ=!1,this._nearZ=o,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,_){this._unmodified=!1,this._edgeInsets.interpolate(o,u,_),this._constrain(),this._calcMatrices()}resize(o,u,_=!0){this._width=o,this._height=u,_&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ui([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(o){o?(this._lngRange=[o.getWest(),o.getEast()],this._latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,s.aJ])}getConstrained(o,u){return this._callbacks.getConstrained(o,u)}getCameraQueryGeometry(o,u){if(u.length===1)return[u[0],o];{let _=o.x,v=o.y,S=o.x,O=o.y;for(let z of u)_=Math.min(_,z.x),v=Math.min(v,z.y),S=Math.max(S,z.x),O=Math.max(O,z.y);return[new s.P(_,v),new s.P(S,v),new s.P(S,O),new s.P(_,O),new s.P(_,v)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let o=this._unmodified,{center:u,zoom:_}=this.getConstrained(this.center,this.zoom);this.setCenter(u),this.setZoom(_),this._unmodified=o,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let o=s.at(new Float64Array(16));s.M(o,o,[this._width/2,-this._height/2,1]),s.L(o,o,[1,-1,0]),this._clipSpaceToPixelsMatrix=o,o=s.at(new Float64Array(16)),s.M(o,o,[1,-1,1]),s.L(o,o,[-1,-1,0]),s.M(o,o,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=o,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(o,u,_,v){let S=_!==void 0?_:this.bearing,O=v=v!==void 0?v:this.pitch,z=s.$.fromLngLat(o,u),V=-Math.cos(s.ad(O)),H=Math.sin(s.ad(O)),Q=H*Math.sin(s.ad(S)),ne=-H*Math.cos(s.ad(S)),ie=this.elevation,de=u-ie,ge;V*de>=0||Math.abs(V)<.1?(ge=1e4,ie=u+ge*V):ge=-de/V;let Pe,Ie,Le=s.aN(1,z.y),Ne=0;do{if(Ne+=1,Ne>10)break;Ie=ge/Le,Pe=new s.$(z.x+Q*Ie,z.y+ne*Ie),Le=1/Pe.meterInMercatorCoordinateUnits()}while(Math.abs(ge-Ie*Le)>1e-12);return{center:Pe.toLngLat(),elevation:ie,zoom:s.ab(this.height/2/Math.tan(this.fovInRadians/2)/Ie/this.tileSize)}}recalculateZoomAndCenter(o){if(this.elevation-o==0)return;let u=s.aK(1,this.center.lat)*this.worldSize,_=this.cameraToCenterDistance/u,v=s.$.fromLngLat(this.center,this.elevation),S=Ds(this.center,this.elevation,this.pitch,this.bearing,_);this._elevation=o;let O=this.calculateCenterFromCameraLngLatAlt(S.toLngLat(),s.aN(S.z,v.y),this.bearing,this.pitch);this._elevation=O.elevation,this._center=O.center,this.setZoom(O.zoom)}getCameraPoint(){let o=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(o*Math.sin(this.rollInRadians),o*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let o=s.aK(1,this.center.lat)*this.worldSize;return Ds(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/o).toLngLat()}getMercatorTileCoordinates(o){if(!o)return[0,0,1,1];let u=o.canonical.z>=0?1<<o.canonical.z:Math.pow(2,o.canonical.z);return[o.canonical.x/u,o.canonical.y/u,1/u/s.Z,1/u/s.Z]}}class hs{constructor(o,u){this.min=o,this.max=u,this.center=s.aO([],s.aP([],this.min,this.max),.5)}quadrant(o){let u=[o%2==0,o<2],_=s.aQ(this.min),v=s.aQ(this.max);for(let S=0;S<u.length;S++)_[S]=u[S]?this.min[S]:this.center[S],v[S]=u[S]?this.center[S]:this.max[S];return v[2]=this.max[2],new hs(_,v)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersectsFrustum(o){let u=!0;for(let _=0;_<o.planes.length;_++){let v=this.intersectsPlane(o.planes[_]);if(v===0)return 0;v===1&&(u=!1)}return u?2:o.aabb.min[0]>this.max[0]||o.aabb.min[1]>this.max[1]||o.aabb.min[2]>this.max[2]||o.aabb.max[0]<this.min[0]||o.aabb.max[1]<this.min[1]||o.aabb.max[2]<this.min[2]?0:1}intersectsPlane(o){let u=o[3],_=o[3];for(let v=0;v<3;v++)o[v]>0?(u+=o[v]*this.min[v],_+=o[v]*this.max[v]):(_+=o[v]*this.min[v],u+=o[v]*this.max[v]);return u>=0?2:_<0?0:1}}class Fg{distanceToTile2d(o,u,_,v){let S=v.distanceX([o,u]),O=v.distanceY([o,u]);return Math.hypot(S,O)}getWrap(o,u,_){return _}getTileAABB(o,u,_,v){var S,O;let z=_,V=_;if(v.terrain){let Q=new s.Y(o.z,u,o.z,o.x,o.y),ne=v.terrain.getMinMaxElevation(Q);z=(S=ne.minElevation)!==null&&S!==void 0?S:_,V=(O=ne.maxElevation)!==null&&O!==void 0?O:_}let H=1<<o.z;return new hs([u+o.x/H,o.y/H,z],[u+(o.x+1)/H,(o.y+1)/H,V])}allowVariableZoom(o,u){let _=o.fov*(Math.abs(Math.cos(o.rollInRadians))*o.height+Math.abs(Math.sin(o.rollInRadians))*o.width)/o.height,v=s.ae(78.5-_/2,0,60);return!!u.terrain||o.pitch>v}allowWorldCopies(){return!0}recalculateCache(){}}class Xl{constructor(o,u,_){this.points=o,this.planes=u,this.aabb=_}static fromInvProjectionMatrix(o,u=1,_=0){let v=Math.pow(2,_),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{let Q=1/(H=s.ap([],H,o))[3]/u*v;return s.aR(H,H,[Q,Q,1/H[3],Q])}),O=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{let Q=s.aS([],S[H[0]],S[H[1]]),ne=s.aS([],S[H[2]],S[H[1]]),ie=s.aT([],s.aU([],Q,ne)),de=-s.aV(ie,S[H[1]]);return ie.concat(de)}),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],V=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let H of S)for(let Q=0;Q<3;Q++)z[Q]=Math.min(z[Q],H[Q]),V[Q]=Math.max(V[Q],H[Q]);return new Xl(S,O,new hs(z,V))}}class vn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,_){return this._helper.interpolatePadding(o,u,_)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u,_=!0){this._helper.resize(o,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o,u){}constructor(o,u,_,v,S){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new So({calcMatrices:()=>{this._calcMatrices()},getConstrained:(O,z)=>this.getConstrained(O,z)},o,u,_,v,S),this._coveringTilesDetailsProvider=new Fg}clone(){let o=new vn;return o.apply(this),o}apply(o,u,_){this._helper.apply(o,u,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(o){let u=[new s.aW(0,o)];if(this._helper._renderWorldCopies){let _=this.screenPointToMercatorCoordinate(new s.P(0,0)),v=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),O=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),z=Math.floor(Math.min(_.x,v.x,S.x,O.x)),V=Math.floor(Math.max(_.x,v.x,S.x,O.x)),H=1;for(let Q=z-H;Q<=V+H;Q++)Q!==0&&u.push(new s.aW(Q,o))}return u}getCameraFrustum(){return Xl.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){let u=this.screenPointToLocation(this.centerPoint,o),_=o?o.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(o,u){let _=s.aK(this.elevation,this.center.lat),v=this.screenPointToMercatorCoordinateAtZ(u,_),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),O=s.$.fromLngLat(o),z=new s.$(O.x-(v.x-S.x),O.y-(v.y-S.y));this.setCenter(z?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(o,u){return u?this.coordinatePoint(s.$.fromLngLat(o),u.getElevationForLngLatZoom(o,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.$.fromLngLat(o))}screenPointToLocation(o,u){var _;return(_=this.screenPointToMercatorCoordinate(o,u))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(o,u){if(u){let _=u.pointCoordinate(o);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(o)}screenPointToMercatorCoordinateAtZ(o,u){let _=u||0,v=[o.x,o.y,0,1],S=[o.x,o.y,1,1];s.ap(v,v,this._pixelMatrixInverse),s.ap(S,S,this._pixelMatrixInverse);let O=v[3],z=S[3],V=v[1]/O,H=S[1]/z,Q=v[2]/O,ne=S[2]/z,ie=Q===ne?0:(_-Q)/(ne-Q);return new s.$(s.B.number(v[0]/O,S[0]/z,ie)/this.worldSize,s.B.number(V,H,ie)/this.worldSize,_)}coordinatePoint(o,u=0,_=this._pixelMatrix){let v=[o.x*this.worldSize,o.y*this.worldSize,u,1];return s.ap(v,v,_),new s.P(v[0]/v[3],v[1]/v[3])}getBounds(){let o=Math.max(0,this._helper._height/2-ah(this));return new ui().extend(this.screenPointToLocation(new s.P(0,o))).extend(this.screenPointToLocation(new s.P(this._helper._width,o))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(o,u){return u?u.pointCoordinate(o)!=null:o.y>this.height/2-ah(this)}calculatePosMatrix(o,u=!1,_){var v;let S=(v=o.key)!==null&&v!==void 0?v:s.aX(o.wrap,o.canonical.z,o.canonical.z,o.canonical.x,o.canonical.y),O=u?this._alignedPosMatrixCache:this._posMatrixCache;if(O.has(S)){let H=O.get(S);return _?H.f32:H.f64}let z=co(o,this.worldSize);s.N(z,u?this._alignedProjMatrix:this._viewProjMatrix,z);let V={f64:z,f32:new Float32Array(z)};return O.set(S,V),_?V.f32:V.f64}calculateFogMatrix(o){let u=o.key,_=this._fogMatrixCacheF32;if(_.has(u))return _.get(u);let v=co(o,this.worldSize);return s.N(v,this._fogMatrix,v),_.set(u,new Float32Array(v)),_.get(u)}getConstrained(o,u){u=s.ae(+u,this.minZoom,this.maxZoom);let _={center:new s.Q(o.lng,o.lat),zoom:u},v=this._helper._lngRange;this._helper._renderWorldCopies||v!==null||(v=[-179.9999999999,180-1e-10]);let S=this.tileSize*s.aI(_.zoom),O=0,z=S,V=0,H=S,Q=0,ne=0,{x:ie,y:de}=this.size;if(this._helper._latRange){let Ge=this._helper._latRange;O=s.S(Ge[1])*S,z=s.S(Ge[0])*S,z-O<de&&(Q=de/(z-O))}v&&(V=s.aL(s.U(v[0])*S,0,S),H=s.aL(s.U(v[1])*S,0,S),H<V&&(H+=S),H-V<ie&&(ne=ie/(H-V)));let{x:ge,y:Pe}=Jo(S,o),Ie,Le,Ne=Math.max(ne||0,Q||0);if(Ne){let Ge=new s.P(ne?(H+V)/2:ge,Q?(z+O)/2:Pe);return _.center=uf(S,Ge).wrap(),_.zoom+=s.ab(Ne),_}if(this._helper._latRange){let Ge=de/2;Pe-Ge<O&&(Le=O+Ge),Pe+Ge>z&&(Le=z-Ge)}if(v){let Ge=(V+H)/2,De=ge;this._helper._renderWorldCopies&&(De=s.aL(ge,Ge-S/2,Ge+S/2));let Ze=ie/2;De-Ze<V&&(Ie=V+Ze),De+Ze>H&&(Ie=H-Ze)}if(Ie!==void 0||Le!==void 0){let Ge=new s.P(Ie??ge,Le??Pe);_.center=uf(S,Ge).wrap()}return _}calculateCenterFromCameraLngLatAlt(o,u,_,v){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,_,v)}_calculateNearFarZIfNeeded(o,u,_){if(!this._helper.autoCalculateNearFarZ)return;let v=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=o-v*this._helper._pixelPerMeter/Math.cos(u),O=v<0?S:o,z=Math.PI/2+this.pitchInRadians,V=s.ad(this.fov)*(Math.abs(Math.cos(s.ad(this.roll)))*this.height+Math.abs(Math.sin(s.ad(this.roll)))*this.width)/this.height*(.5+_.y/this.height),H=Math.sin(V)*O/Math.sin(s.ae(Math.PI-z-V,.01,Math.PI-.01)),Q=ah(this),ne=Math.atan(Q/this._helper.cameraToCenterDistance),ie=s.ad(.75),de=ne>ie?2*ne*(.5+_.y/(2*Q)):ie,ge=Math.sin(de)*O/Math.sin(s.ae(Math.PI-z-de,.01,Math.PI-.01)),Pe=Math.min(H,ge);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*Pe+O),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let o=this.centerOffset,u=Jo(this.worldSize,this.center),_=u.x,v=u.y;this._helper._pixelPerMeter=s.aK(1,this.center.lat)*this.worldSize;let S=s.ad(Math.min(this.pitch,89.25)),O=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S)),z;this._calculateNearFarZIfNeeded(O,S,o),z=new Float64Array(16),s.aY(z,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aj(this._invProjMatrix,z),z[8]=2*-o.x/this._helper._width,z[9]=2*o.y/this._helper._height,this._projectionMatrix=s.aZ(z),s.M(z,z,[1,-1,1]),s.L(z,z,[0,0,-this._helper.cameraToCenterDistance]),s.a_(z,z,-this.rollInRadians),s.a$(z,z,this.pitchInRadians),s.a_(z,z,-this.bearingInRadians),s.L(z,z,[-_,-v,0]),this._mercatorMatrix=s.M([],z,[this.worldSize,this.worldSize,this.worldSize]),s.M(z,z,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,z),s.L(z,z,[0,0,-this.elevation]),this._viewProjMatrix=z,this._invViewProjMatrix=s.aj([],z);let V=[0,0,-1,1];s.ap(V,V,this._invViewProjMatrix),this._cameraPosition=[V[0]/V[3],V[1]/V[3],V[2]/V[3]],this._fogMatrix=new Float64Array(16),s.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,O,this._helper._farZ),this._fogMatrix[8]=2*-o.x/this.width,this._fogMatrix[9]=2*o.y/this.height,s.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.L(this._fogMatrix,this._fogMatrix,[-_,-v,0]),s.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,z);let H=this._helper._width%2/2,Q=this._helper._height%2/2,ne=Math.cos(this.bearingInRadians),ie=Math.sin(-this.bearingInRadians),de=_-Math.round(_)+ne*H+ie*Q,ge=v-Math.round(v)+ne*Q+ie*H,Pe=new Float64Array(z);if(s.L(Pe,Pe,[de>.5?de-1:de,ge>.5?ge-1:ge,0]),this._alignedProjMatrix=Pe,z=s.aj(new Float64Array(16),this._pixelMatrix),!z)throw new Error("failed to invert matrix");this._pixelMatrixInverse=z,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let o=this.screenPointToMercatorCoordinate(new s.P(0,0)),u=[o.x*this.worldSize,o.y*this.worldSize,0,1];return s.ap(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let o=s.aK(1,this.center.lat)*this.worldSize;return Ds(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/o).toLngLat()}lngLatToCameraDepth(o,u){let _=s.$.fromLngLat(o),v=[_.x*this.worldSize,_.y*this.worldSize,u,1];return s.ap(v,v,this._viewProjMatrix),v[2]/v[3]}getProjectionData(o){let{overscaledTileID:u,aligned:_,applyTerrainMatrix:v}=o,S=this._helper.getMercatorTileCoordinates(u),O=u?this.calculatePosMatrix(u,_,!0):null,z;return z=u&&u.terrainRttPosMatrix32f&&v?u.terrainRttPosMatrix32f:O||s.b0(),{mainMatrix:z,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:z}}isLocationOccluded(o){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(o,u,_){return 1}transformLightDirection(o){return s.aQ(o)}getRayDirectionFromPixel(o){throw new Error("Not implemented.")}projectTileCoordinates(o,u,_,v){let S=this.calculatePosMatrix(_),O;v?(O=[o,u,v(o,u),1],s.ap(O,O,S)):(O=[o,u,0,1],Kn(O,O,S));let z=O[3];return{point:new s.P(O[0]/z,O[1]/z),signedDistanceFromCamera:z,isOccluded:!1}}populateCache(o){for(let u of o)this.calculatePosMatrix(u)}getMatrixForModel(o,u){let _=s.$.fromLngLat(o,u),v=_.meterInMercatorCoordinateUnits(),S=s.b1();return s.L(S,S,[_.x,_.y,_.z]),s.a_(S,S,Math.PI),s.a$(S,S,Math.PI/2),s.M(S,S,[-v,v,v]),S}getProjectionDataForCustomLayer(o=!0){let u=new s.Y(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:o}),v=co(u,this.worldSize);s.N(v,this._viewProjMatrix,v),_.tileMercatorCoords=[0,0,1,1];let S=[s.Z,s.Z,this.worldSize/this._helper.pixelsPerMeter],O=s.b2();return s.M(O,v,S),_.fallbackMatrix=O,_.mainMatrix=O,_}getFastPathSimpleProjectionMatrix(o){return this.calculatePosMatrix(o)}}function lh(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Yl(C){if(C.useSlerp)if(C.k<1){let o=s.b3(C.startEulerAngles.roll,C.startEulerAngles.pitch,C.startEulerAngles.bearing),u=s.b3(C.endEulerAngles.roll,C.endEulerAngles.pitch,C.endEulerAngles.bearing),_=new Float64Array(4);s.b4(_,o,u,C.k);let v=s.b5(_);C.tr.setRoll(v.roll),C.tr.setPitch(v.pitch),C.tr.setBearing(v.bearing)}else C.tr.setRoll(C.endEulerAngles.roll),C.tr.setPitch(C.endEulerAngles.pitch),C.tr.setBearing(C.endEulerAngles.bearing);else C.tr.setRoll(s.B.number(C.startEulerAngles.roll,C.endEulerAngles.roll,C.k)),C.tr.setPitch(s.B.number(C.startEulerAngles.pitch,C.endEulerAngles.pitch,C.k)),C.tr.setBearing(s.B.number(C.startEulerAngles.bearing,C.endEulerAngles.bearing,C.k))}function hf(C,o,u,_,v){let S=v.padding,O=Jo(v.worldSize,u.getNorthWest()),z=Jo(v.worldSize,u.getNorthEast()),V=Jo(v.worldSize,u.getSouthEast()),H=Jo(v.worldSize,u.getSouthWest()),Q=s.ad(-_),ne=O.rotate(Q),ie=z.rotate(Q),de=V.rotate(Q),ge=H.rotate(Q),Pe=new s.P(Math.max(ne.x,ie.x,ge.x,de.x),Math.max(ne.y,ie.y,ge.y,de.y)),Ie=new s.P(Math.min(ne.x,ie.x,ge.x,de.x),Math.min(ne.y,ie.y,ge.y,de.y)),Le=Pe.sub(Ie),Ne=(v.width-(S.left+S.right+o.left+o.right))/Le.x,Ge=(v.height-(S.top+S.bottom+o.top+o.bottom))/Le.y;if(Ge<0||Ne<0)return void lh();let De=Math.min(s.ab(v.scale*Math.min(Ne,Ge)),C.maxZoom),Ze=s.P.convert(C.offset),He=new s.P((o.left-o.right)/2,(o.top-o.bottom)/2).rotate(s.ad(_)),Xe=Ze.add(He).mult(v.scale/s.aI(De));return{center:uf(v.worldSize,O.add(V).div(2).sub(Xe)),zoom:De,bearing:_}}class Io{get useGlobeControls(){return!1}handlePanInertia(o,u){return{easingOffset:o,easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(o,u){o.bearingDelta&&u.setBearing(u.bearing+o.bearingDelta),o.pitchDelta&&u.setPitch(u.pitch+o.pitchDelta),o.rollDelta&&u.setRoll(u.roll+o.rollDelta),o.zoomDelta&&u.setZoom(u.zoom+o.zoomDelta)}handleMapControlsPan(o,u,_){o.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(_,o.around)}cameraForBoxAndBearing(o,u,_,v,S){return hf(o,u,_,v,S)}handleJumpToCenterZoom(o,u){o.zoom!==(u.zoom!==void 0?+u.zoom:o.zoom)&&o.setZoom(+u.zoom),u.center!==void 0&&o.setCenter(s.Q.convert(u.center))}handleEaseTo(o,u){let _=o.zoom,v=o.padding,S={roll:o.roll,pitch:o.pitch,bearing:o.bearing},O={roll:u.roll===void 0?o.roll:u.roll,pitch:u.pitch===void 0?o.pitch:u.pitch,bearing:u.bearing===void 0?o.bearing:u.bearing},z=u.zoom!==void 0,V=!o.isPaddingEqual(u.padding),H=!1,Q=z?+u.zoom:o.zoom,ne=o.centerPoint.add(u.offsetAsPoint),ie=o.screenPointToLocation(ne),{center:de,zoom:ge}=o.getConstrained(s.Q.convert(u.center||ie),Q??_);$d(o,de);let Pe=Jo(o.worldSize,ie),Ie=Jo(o.worldSize,de).sub(Pe),Le=s.aI(ge-_);return H=ge!==_,{easeFunc:Ne=>{if(H&&o.setZoom(s.B.number(_,ge,Ne)),s.b6(S,O)||Yl({startEulerAngles:S,endEulerAngles:O,tr:o,k:Ne,useSlerp:S.roll!=O.roll}),V&&(o.interpolatePadding(v,u.padding,Ne),ne=o.centerPoint.add(u.offsetAsPoint)),u.around)o.setLocationAtPoint(u.around,u.aroundPoint);else{let Ge=s.aI(o.zoom-_),De=ge>_?Math.min(2,Le):Math.max(.5,Le),Ze=Math.pow(De,1-Ne),He=uf(o.worldSize,Pe.add(Ie.mult(Ne*Ze)).mult(Ge));o.setLocationAtPoint(o.renderWorldCopies?He.wrap():He,ne)}},isZooming:H,elevationCenter:de}}handleFlyTo(o,u){let _=u.zoom!==void 0,v=o.zoom,S=o.getConstrained(s.Q.convert(u.center||u.locationAtOffset),_?+u.zoom:v),O=S.center,z=S.zoom;$d(o,O);let V=Jo(o.worldSize,u.locationAtOffset),H=Jo(o.worldSize,O).sub(V),Q=H.mag(),ne=s.aI(z-v),ie;if(u.minZoom!==void 0){let de=Math.min(+u.minZoom,v,z),ge=o.getConstrained(O,de).zoom;ie=s.aI(ge-v)}return{easeFunc:(de,ge,Pe,Ie)=>{o.setZoom(de===1?z:v+s.ab(ge));let Le=de===1?O:uf(o.worldSize,V.add(H.mult(Pe)).mult(ge));o.setLocationAtPoint(o.renderWorldCopies?Le.wrap():Le,Ie)},scaleOfZoom:ne,targetCenter:O,scaleOfMinZoom:ie,pixelPathLength:Q}}}class mn{constructor(o,u,_){this.blendFunction=o,this.blendColor=u,this.mask=_}}mn.Replace=[1,0],mn.disabled=new mn(mn.Replace,s.b7.transparent,[!1,!1,!1,!1]),mn.unblended=new mn(mn.Replace,s.b7.transparent,[!0,!0,!0,!0]),mn.alphaBlended=new mn([1,771],s.b7.transparent,[!0,!0,!0,!0]);let ka=2305;class Fi{constructor(o,u,_){this.enable=o,this.mode=u,this.frontFace=_}}Fi.disabled=new Fi(!1,1029,ka),Fi.backCCW=new Fi(!0,1029,ka),Fi.frontCCW=new Fi(!0,1028,ka);class ti{constructor(o,u,_){this.func=o,this.mask=u,this.range=_}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);let ch=7680;class vi{constructor(o,u,_,v,S,O){this.test=o,this.ref=u,this.mask=_,this.fail=v,this.depthFail=S,this.pass=O}}vi.disabled=new vi({func:519,mask:0},0,0,ch,ch,ch);let uh=new WeakMap;function _a(C){var o;if(uh.has(C))return uh.get(C);{let u=(o=C.getParameter(C.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return uh.set(C,u),u}}class ff{get awaitingQuery(){return!!this._readbackQueue}constructor(o){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=o;let u=o.context,_=u.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;let v=new s.aF;v.emplaceBack(-1,-1),v.emplaceBack(2,-1),v.emplaceBack(-1,2);let S=new s.aH;S.emplaceBack(0,1,2),this._fullscreenTriangle=new Xc(u.createVertexBuffer(v,Zl.members),u.createIndexBuffer(S),s.aG.simpleSegment(0,0,v.length,S.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(_.TEXTURE1);let O=_.createTexture();_.bindTexture(_.TEXTURE_2D,O),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(O),_a(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){let o=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),o.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(o,u){let _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(o,u),this._updateCount++,this._measuredError}_bindFramebuffer(){let o=this._cachedRenderContext.context,u=o.gl;o.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),o.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(o,u){let _=this._cachedRenderContext.context,v=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:s.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,v.TRIANGLES,ti.disabled,vi.disabled,mn.unblended,Fi.disabled,((S,O)=>({u_input:S,u_output_expected:O}))(o,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&_a(v)){v.bindBuffer(v.PIXEL_PACK_BUFFER,this._pbo),v.readBuffer(v.COLOR_ATTACHMENT0),v.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),v.bindBuffer(v.PIXEL_PACK_BUFFER,null);let S=v.fenceSync(v.SYNC_GPU_COMMANDS_COMPLETE,0);v.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let o=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&_a(o)){let u=o.clientWaitSync(this._readbackQueue.sync,0,0);if(u===o.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===o.TIMEOUT_EXPIRED)return;o.bindBuffer(o.PIXEL_PACK_BUFFER,this._pbo),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),o.bindBuffer(o.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),o.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ff._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(o){let u=0;return u+=o[0]/256,u+=o[1]/65536,u+=o[2]/16777216,o[3]<127&&(u=-u),u/128}}let df=s.Z/128;function qd(C,o){let u=C.granularity!==void 0?Math.max(C.granularity,1):1,_=u+(C.generateBorders?2:0),v=u+(C.extendToNorthPole||C.generateBorders?1:0)+(C.extendToSouthPole||C.generateBorders?1:0),S=_+1,O=v+1,z=C.generateBorders?-1:0,V=C.generateBorders||C.extendToNorthPole?-1:0,H=u+(C.generateBorders?1:0),Q=u+(C.generateBorders||C.extendToSouthPole?1:0),ne=S*O,ie=_*v*6,de=S*O>65536;if(de&&o==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let ge=de||o==="32bit",Pe=new Int16Array(2*ne),Ie=0;for(let Ge=V;Ge<=Q;Ge++)for(let De=z;De<=H;De++){let Ze=De/u*s.Z;De===-1&&(Ze=-64),De===u+1&&(Ze=s.Z+df);let He=Ge/u*s.Z;Ge===-1&&(He=C.extendToNorthPole?s.b9:-64),Ge===u+1&&(He=C.extendToSouthPole?s.ba:s.Z+df),Pe[Ie++]=Ze,Pe[Ie++]=He}let Le=ge?new Uint32Array(ie):new Uint16Array(ie),Ne=0;for(let Ge=0;Ge<v;Ge++)for(let De=0;De<_;De++){let Ze=De+1+Ge*S,He=De+(Ge+1)*S,Xe=De+1+(Ge+1)*S;Le[Ne++]=De+Ge*S,Le[Ne++]=He,Le[Ne++]=Ze,Le[Ne++]=Ze,Le[Ne++]=He,Le[Ne++]=Xe}return{vertices:Pe.buffer.slice(0),indices:Le.buffer.slice(0),uses32bitIndices:ge}}let pf=new s.aE({fill:new s.bb(128,2),line:new s.bb(512,0),tile:new s.bb(128,32),stencil:new s.bb(128,1),circle:3});class Af{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ga.projectionGlobe}get vertexShaderPreludeCode(){return ga.projectionMercator.vertexSource}get subdivisionGranularity(){return pf}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(o){this._errorMeasurement||(this._errorMeasurement=new ff(o));let u=s.S(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,v=this._errorMeasurement.updateErrorLoop(u,_),S=x.now();v!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=v,this._errorMeasurementLastChangeTime=S);let O=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bd(O))}_getMeshKey(o){return`${o.granularity.toString(36)}_${o.generateBorders?"b":""}${o.extendToNorthPole?"n":""}${o.extendToSouthPole?"s":""}`}getMeshFromTileID(o,u,_,v,S){let O=(S==="stencil"?pf.stencil:pf.tile).getGranularityForZoomLevel(u.z);return this._getMesh(o,{granularity:O,generateBorders:_,extendToNorthPole:u.y===0&&v,extendToSouthPole:u.y===(1<<u.z)-1&&v})}_getMesh(o,u){let _=this._getMeshKey(u);if(_ in this._tileMeshCache)return this._tileMeshCache[_];let v=function(S,O){let z=qd(O,"16bit"),V=s.aF.deserialize({arrayBuffer:z.vertices,length:z.vertices.byteLength/2/2}),H=s.aH.deserialize({arrayBuffer:z.indices,length:z.indices.byteLength/2/3});return new Xc(S.createVertexBuffer(V,Zl.members),S.createIndexBuffer(H),s.aG.simpleSegment(0,0,V.length,H.length))}(o,u);return this._tileMeshCache[_]=v,v}recalculate(o){}hasTransition(){let o=x.now(),u=!1;return u=u||(o-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(o){this._errorQueryLatitudeDegrees=o}}let Zd=new s.r({type:new s.D(s.v.projection.type)});class hh extends s.E{constructor(o){super(),this._transitionable=new s.T(Zd),this.setProjection(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.C(0)),this._mercatorProjection=new Ei,this._verticalPerspectiveProjection=new Af}get transitionState(){let o=this.properties.get("type");if(typeof o=="string"&&o==="mercator")return 0;if(typeof o=="string"&&o==="vertical-perspective")return 1;if(o instanceof s.be){if(o.from==="vertical-perspective"&&o.to==="mercator")return 1-o.transition;if(o.from==="mercator"&&o.to==="vertical-perspective")return o.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(o){this._mercatorProjection.updateGPUdependent(o),this._verticalPerspectiveProjection.updateGPUdependent(o)}getMeshFromTileID(o,u,_,v,S){return this.currentProjection.getMeshFromTileID(o,u,_,v,S)}setProjection(o){this._transitionable.setValue("type",o?.type||"mercator")}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}setErrorQueryLatitudeDegrees(o){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(o),this._mercatorProjection.setErrorQueryLatitudeDegrees(o)}}function kg(C){let o=Xd(C.worldSize,C.center.lat);return 2*Math.PI*o}function Yc(C,o,u,_,v){let S=1/(1<<v),O=o/s.Z*S+_*S,z=s.bg((C/s.Z*S+u*S)*Math.PI*2+Math.PI,2*Math.PI),V=2*Math.atan(Math.exp(Math.PI-O*Math.PI*2))-.5*Math.PI,H=Math.cos(V),Q=new Float64Array(3);return Q[0]=Math.sin(z)*H,Q[1]=Math.sin(V),Q[2]=Math.cos(z)*H,Q}function Fs(C){return function(o,u){let _=Math.cos(u),v=new Float64Array(3);return v[0]=Math.sin(o)*_,v[1]=Math.sin(u),v[2]=Math.cos(o)*_,v}(C.lng*Math.PI/180,C.lat*Math.PI/180)}function Xd(C,o){return C/(2*Math.PI)/Math.cos(o*Math.PI/180)}function Ng(C){let o=Math.asin(C[1])/Math.PI*180,u=Math.sqrt(C[0]*C[0]+C[2]*C[2]);if(u>1e-6){let _=C[0]/u,v=Math.acos(C[2]/u),S=(_>0?v:-v)/Math.PI*180;return new s.Q(s.aL(S,-180,180),o)}return new s.Q(0,o)}function Ys(C){return Math.cos(C*Math.PI/180)}function es(C,o){let u=Ys(C),_=Ys(o);return s.ab(_/u)}function ya(C,o){let u=C.rotate(o.bearingInRadians),_=o.zoom+es(o.center.lat,0),v=s.bc(1/Ys(o.center.lat),1/Ys(Math.min(Math.abs(o.center.lat),60)),s.bf(_,7,3,0,1)),S=360/kg({worldSize:o.worldSize,center:{lat:o.center.lat}});return new s.Q(o.center.lng-u.x*S*v,s.ae(o.center.lat+u.y*S,-85.051129,s.aJ))}function fh(C){let o=.5*C,u=Math.sin(o),_=Math.cos(o);return Math.log(u+_)-Math.log(_-u)}function em(C,o,u,_){let v=C.lat+u*_;if(Math.abs(u)>1){let S=(Math.sign(C.lat+u)!==Math.sign(C.lat)?-Math.abs(C.lat):Math.abs(C.lat))*Math.PI/180,O=Math.abs(C.lat+u)*Math.PI/180,z=fh(S+_*(O-S)),V=fh(S),H=fh(O);return new s.Q(C.lng+o*((z-V)/(H-V)),v)}return new s.Q(C.lng+o*_,v)}class zg{constructor(o){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=o}recalculateCache(){if(!this._hadAnyChanges)return;let o=this._cachePrevious;this._cachePrevious=this._cache,this._cache=o,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(o,u,_,v){let S=`${o.z}_${o.x}_${o.y}`,O=this._cache.get(S);if(O)return O;let z=this._cachePrevious.get(S);if(z)return this._cache.set(S,z),z;let V=this._aabbFactory(o,u,_,v);return this._cache.set(S,V),this._hadAnyChanges=!0,V}}function ul(C,o,u){let _=C-o;return _<0?-_:Math.max(0,_-u)}function tm(C,o,u,_,v){let S=C-u,O;return O=S<0?Math.min(-S,1+S-v):S>1?Math.min(Math.max(S-v,0),1-S):0,Math.max(O,ul(o,_,v))}class rm{constructor(){this._aabbCache=new zg(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(o,u,_,v){let S=1<<_.z,O=1/S,z=_.x/S,V=_.y/S,H=2;return H=Math.min(H,tm(o,u,z,V,O)),H=Math.min(H,tm(o,u,z+.5,-V-O,O)),H=Math.min(H,tm(o,u,z+.5,2-V-O,O)),H}getWrap(o,u,_){let v=1<<u.z,S=1/v,O=u.x/v,z=ul(o.x,O,S),V=ul(o.x,O-1,S),H=ul(o.x,O+1,S),Q=Math.min(z,V,H);return Q===H?1:Q===V?-1:0}allowVariableZoom(o,u){return zn(o,u)>4}allowWorldCopies(){return!1}getTileAABB(o,u,_,v){return this._aabbCache.getTileAABB(o,u,_,v)}_computeTileAABB(o,u,_,v){if(o.z<=0)return new hs([-1,-1,-1],[1,1,1]);if(o.z===1)return new hs([o.x===0?-1:0,o.y===0?0:-1,-1],[o.x===0?0:1,o.y===0?1:0,1]);{let S=[Yc(0,0,o.x,o.y,o.z),Yc(s.Z,0,o.x,o.y,o.z),Yc(s.Z,s.Z,o.x,o.y,o.z),Yc(0,s.Z,o.x,o.y,o.z)],O=[1,1,1],z=[-1,-1,-1];for(let V of S)for(let H=0;H<3;H++)O[H]=Math.min(O[H],V[H]),z[H]=Math.max(z[H],V[H]);if(o.y===0||o.y===(1<<o.z)-1){let V=[0,o.y===0?1:-1,0];for(let H=0;H<3;H++)O[H]=Math.min(O[H],V[H]),z[H]=Math.max(z[H],V[H])}return new hs(O,z)}}}class mf{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,_){return this._helper.interpolatePadding(o,u,_)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u){this._helper.resize(o,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o){}constructor(){this._cachedClippingPlane=s.bh(),this._projectionMatrix=s.b1(),this._globeViewProjMatrix32f=s.b0(),this._globeViewProjMatrixNoCorrection=s.b1(),this._globeViewProjMatrixNoCorrectionInverted=s.b1(),this._globeProjMatrixInverted=s.b1(),this._cameraPosition=s.bi(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new So({calcMatrices:()=>{this._calcMatrices()},getConstrained:(o,u)=>this.getConstrained(o,u)}),this._coveringTilesDetailsProvider=new rm}clone(){let o=new mf;return o.apply(this),o}apply(o,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(o)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let o=s.bi();return o[0]=this._cameraPosition[0],o[1]=this._cameraPosition[1],o[2]=this._cameraPosition[2],o}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(o){let{overscaledTileID:u,applyGlobeMatrix:_}=o,v=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:v,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(o){let u=this.pitchInRadians,_=this.cameraToCenterDistance/o,v=Math.sin(u)*_,S=Math.cos(u)*_+1,O=1/Math.sqrt(v*v+S*S)*1,z=-v,V=S,H=Math.sqrt(z*z+V*V);z/=H,V/=H;let Q=[0,z,V];return s.bj(Q,Q,[0,0,0],-this.bearingInRadians),s.bk(Q,Q,[0,0,0],-1*this.center.lat*Math.PI/180),s.bl(Q,Q,[0,0,0],this.center.lng*Math.PI/180),s.aO(Q,Q,.25),[...Q,.25*-O]}isLocationOccluded(o){return!this.isSurfacePointVisible(Fs(o))}transformLightDirection(o){let u=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,v=Math.cos(_),S=[Math.sin(u)*v,Math.sin(_),Math.cos(u)*v],O=[S[2],0,-S[0]],z=[0,0,0];s.aU(z,O,S),s.aT(O,O),s.aT(z,z);let V=[0,0,0];return s.aT(V,[O[0]*o[0]+z[0]*o[1]+S[0]*o[2],O[1]*o[0]+z[1]*o[1]+S[1]*o[2],O[2]*o[0]+z[2]*o[1]+S[2]*o[2]]),V}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(o,u,_){let v=function(z,V,H){let Q=1/(1<<H.z);return new s.$(z/s.Z*Q+H.x*Q,V/s.Z*Q+H.y*Q)}(o,u,_.canonical),S=(O=v.y,[s.bg(v.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-O*Math.PI*2))-.5*Math.PI]);var O;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(o,u,_,v){let S=_.canonical,O=Yc(o,u,S.x,S.y,S.z),z=1+(v?v(o,u):0)/s.br,V=[O[0]*z,O[1]*z,O[2]*z,1];s.ap(V,V,this._globeViewProjMatrixNoCorrection);let H=this._cachedClippingPlane,Q=H[0]*O[0]+H[1]*O[1]+H[2]*O[2]+H[3]<0;return{point:new s.P(V[0]/V[3],V[1]/V[3]),signedDistanceFromCamera:V[3],isOccluded:Q}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let o=Xd(this.worldSize,this.center.lat),u=s.b2(),_=s.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*o),s.aY(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let v=this.centerOffset;u[8]=2*-v.x/this._helper._width,u[9]=2*v.y/this._helper._height,this._projectionMatrix=s.aZ(u),this._globeProjMatrixInverted=s.b2(),s.aj(this._globeProjMatrixInverted,u),s.L(u,u,[0,0,-this.cameraToCenterDistance]),s.a_(u,u,this.rollInRadians),s.a$(u,u,-this.pitchInRadians),s.a_(u,u,this.bearingInRadians),s.L(u,u,[0,0,-o]);let S=s.bi();S[0]=o,S[1]=o,S[2]=o,s.a$(_,u,this.center.lat*Math.PI/180),s.bm(_,_,-this.center.lng*Math.PI/180),s.M(_,_,S),this._globeViewProjMatrixNoCorrection=_,s.a$(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bm(u,u,-this.center.lng*Math.PI/180),s.M(u,u,S),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=s.b2(),s.aj(this._globeViewProjMatrixNoCorrectionInverted,_);let O=s.bi();this._cameraPosition=s.bi(),this._cameraPosition[2]=this.cameraToCenterDistance/o,s.bj(this._cameraPosition,this._cameraPosition,O,-this.rollInRadians),s.bk(this._cameraPosition,this._cameraPosition,O,this.pitchInRadians),s.bj(this._cameraPosition,this._cameraPosition,O,-this.bearingInRadians),s.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bk(this._cameraPosition,this._cameraPosition,O,-this.center.lat*Math.PI/180),s.bl(this._cameraPosition,this._cameraPosition,O,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(o);let z=s.aZ(this._globeViewProjMatrixNoCorrectionInverted);s.M(z,z,[1,1,-1]),this._cachedFrustum=Xl.fromInvProjectionMatrix(z)}calculateFogMatrix(o){s.w("calculateFogMatrix is not supported on globe projection.");let u=s.b2();return s.at(u),u}getVisibleUnwrappedCoordinates(o){return[new s.aW(0,o)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){o&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,u){if(!this._globeViewProjMatrixNoCorrection)return 1;let _=Fs(o);s.aO(_,_,1+u/s.br);let v=s.bh();return s.ap(v,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),v[2]/v[3]}populateCache(o){}getBounds(){let o=.5*this.width,u=.5*this.height,_=[new s.P(0,0),new s.P(o,0),new s.P(this.width,0),new s.P(this.width,u),new s.P(this.width,this.height),new s.P(o,this.height),new s.P(0,this.height),new s.P(0,u)],v=[];for(let ne of _)v.push(this.unprojectScreenPoint(ne));let S=0,O=0,z=0,V=0,H=this.center;for(let ne of v){let ie=s.bn(H.lng,ne.lng),de=s.bn(H.lat,ne.lat);ie<O&&(O=ie),ie>S&&(S=ie),de<V&&(V=de),de>z&&(z=de)}let Q=[H.lng+O,H.lat+V,H.lng+S,H.lat+z];return this.isSurfacePointOnScreen([0,1,0])&&(Q[3]=90,Q[0]=-180,Q[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(Q[1]=-90,Q[0]=-180,Q[2]=180),new ui(Q)}getConstrained(o,u){let _=s.ae(o.lat,-85.051129,s.aJ),v=s.ae(+u,this.minZoom+es(0,_),this.maxZoom);return{center:new s.Q(o.lng,_),zoom:v}}calculateCenterFromCameraLngLatAlt(o,u,_,v){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,_,v)}setLocationAtPoint(o,u){let _=Fs(this.unprojectScreenPoint(u)),v=Fs(o),S=s.bi();s.bo(S);let O=s.bi();s.bl(O,_,S,-this.center.lng*Math.PI/180),s.bk(O,O,S,this.center.lat*Math.PI/180);let z=v[0]*v[0]+v[2]*v[2],V=O[0]*O[0];if(z<V)return;let H=Math.sqrt(z-V),Q=-H,ne=s.bp(v[0],v[2],O[0],H),ie=s.bp(v[0],v[2],O[0],Q),de=s.bi();s.bl(de,v,S,-ne);let ge=s.bp(de[1],de[2],O[1],O[2]),Pe=s.bi();s.bl(Pe,v,S,-ie);let Ie=s.bp(Pe[1],Pe[2],O[1],O[2]),Le=.5*Math.PI,Ne=ge>=-Le&&ge<=Le,Ge=Ie>=-Le&&Ie<=Le,De,Ze;if(Ne&&Ge){let At=this.center.lng*Math.PI/180,Pt=this.center.lat*Math.PI/180;s.bs(ne,At)+s.bs(ge,Pt)<s.bs(ie,At)+s.bs(Ie,Pt)?(De=ne,Ze=ge):(De=ie,Ze=Ie)}else if(Ne)De=ne,Ze=ge;else{if(!Ge)return;De=ie,Ze=Ie}let He=De/Math.PI*180,Xe=Ze/Math.PI*180,yt=this.center.lat;this.setCenter(new s.Q(He,s.ae(Xe,-90,90))),this.setZoom(this.zoom+es(yt,this.center.lat))}locationToScreenPoint(o,u){let _=Fs(o);if(u){let v=u.getElevationForLngLatZoom(o,this._helper._tileZoom);s.aO(_,_,1+v/s.br)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(o){let u=s.bh();return s.ap(u,[...o,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new s.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(o,u){if(u){let _=u.pointCoordinate(o);if(_)return _}return s.$.fromLngLat(this.unprojectScreenPoint(o))}screenPointToLocation(o,u){var _;return(_=this.screenPointToMercatorCoordinate(o,u))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(o,u){let _=this._cameraPosition,v=this.getRayDirectionFromPixel(o);return!!this.rayPlanetIntersection(_,v)}getRayDirectionFromPixel(o){let u=s.bh();u[0]=o.x/this.width*2-1,u[1]=-1*(o.y/this.height*2-1),u[2]=1,u[3]=1,s.ap(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];let _=s.bi();_[0]=u[0]-this._cameraPosition[0],_[1]=u[1]-this._cameraPosition[1],_[2]=u[2]-this._cameraPosition[2];let v=s.bi();return s.aT(v,_),v}isSurfacePointVisible(o){let u=this._cachedClippingPlane;return u[0]*o[0]+u[1]*o[1]+u[2]*o[2]+u[3]>=0}isSurfacePointOnScreen(o){if(!this.isSurfacePointVisible(o))return!1;let u=s.bh();return s.ap(u,[...o,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(o,u){let _=s.aV(o,u),v=s.bi(),S=s.bi();s.aO(S,u,_),s.aS(v,o,S);let O=1-s.aV(v,v);if(O<0)return null;let z=s.aV(o,o)-1,V=-_+(_<0?1:-1)*Math.sqrt(O),H=z/V,Q=V;return{tMin:Math.min(H,Q),tMax:Math.max(H,Q)}}unprojectScreenPoint(o){let u=this._cameraPosition,_=this.getRayDirectionFromPixel(o),v=this.rayPlanetIntersection(u,_);if(v){let H=s.bi();s.aP(H,u,[_[0]*v.tMin,_[1]*v.tMin,_[2]*v.tMin]);let Q=s.bi();return s.aT(Q,H),Ng(Q)}let S=this._cachedClippingPlane[0]*_[0]+this._cachedClippingPlane[1]*_[1]+this._cachedClippingPlane[2]*_[2],O=-s.bq(this._cachedClippingPlane,u)/S,z=s.bi();if(O>0)s.aP(z,u,[_[0]*O,_[1]*O,_[2]*O]);else{let H=s.bi();s.aP(H,u,[2*_[0],2*_[1],2*_[2]]);let Q=s.bq(this._cachedClippingPlane,H);s.aS(z,H,[this._cachedClippingPlane[0]*Q,this._cachedClippingPlane[1]*Q,this._cachedClippingPlane[2]*Q])}let V=s.bi();return s.aT(V,z),Ng(V)}getMatrixForModel(o,u){let _=s.Q.convert(o),v=1/s.br,S=s.b1();return s.bm(S,S,_.lng/180*Math.PI),s.a$(S,S,-_.lat/180*Math.PI),s.L(S,S,[0,0,1+u/s.br]),s.a$(S,S,.5*Math.PI),s.M(S,S,[v,v,v]),S}getProjectionDataForCustomLayer(o=!0){let u=this.getProjectionData({overscaledTileID:new s.Y(0,0,0,0,0),applyGlobeMatrix:o});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(o){}}class gf{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,_){return this._helper.interpolatePadding(o,u,_)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u,_=!0){this._helper.resize(o,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(o,u){this._globeness=o,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new So({calcMatrices:()=>{this._calcMatrices()},getConstrained:(o,u)=>this.getConstrained(o,u)}),this._globeness=1,this._mercatorTransform=new vn,this._verticalPerspectiveTransform=new mf}clone(){let o=new gf;return o._globeness=this._globeness,o._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,o.apply(this),o}apply(o){this._helper.apply(o),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(o){let u=this._mercatorTransform.getProjectionData(o),_=this._verticalPerspectiveTransform.getProjectionData(o);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:u.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:o.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(o){return this.currentTransform.isLocationOccluded(o)}transformLightDirection(o){return this.currentTransform.transformLightDirection(o)}getPixelScale(){return s.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(o,u,_){let v=this._mercatorTransform.getPitchedTextCorrection(o,u,_),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(o,u,_);return s.bc(v,S,this._globeness)}projectTileCoordinates(o,u,_,v){return this.currentTransform.projectTileCoordinates(o,u,_,v)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(o){return this.currentTransform.calculateFogMatrix(o)}getVisibleUnwrappedCoordinates(o){return this.currentTransform.getVisibleUnwrappedCoordinates(o)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(o){this._mercatorTransform.recalculateZoomAndCenter(o),this._verticalPerspectiveTransform.recalculateZoomAndCenter(o)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,u){return this.currentTransform.lngLatToCameraDepth(o,u)}populateCache(o){this._mercatorTransform.populateCache(o),this._verticalPerspectiveTransform.populateCache(o)}getBounds(){return this.currentTransform.getBounds()}getConstrained(o,u){return this.currentTransform.getConstrained(o,u)}calculateCenterFromCameraLngLatAlt(o,u,_,v){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,_,v)}setLocationAtPoint(o,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(o,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(o,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(o,u){return this.currentTransform.locationToScreenPoint(o,u)}screenPointToMercatorCoordinate(o,u){return this.currentTransform.screenPointToMercatorCoordinate(o,u)}screenPointToLocation(o,u){return this.currentTransform.screenPointToLocation(o,u)}isPointOnMapSurface(o,u){return this.currentTransform.isPointOnMapSurface(o,u)}getRayDirectionFromPixel(o){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(o)}getMatrixForModel(o,u){return this.currentTransform.getMatrixForModel(o,u)}getProjectionDataForCustomLayer(o=!0){let u=this._mercatorTransform.getProjectionDataForCustomLayer(o);if(!this.isGlobeRendering)return u;let _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(o);return _.fallbackMatrix=u.mainMatrix,_}getFastPathSimpleProjectionMatrix(o){return this.currentTransform.getFastPathSimpleProjectionMatrix(o)}}class Mo{get useGlobeControls(){return!0}handlePanInertia(o,u){let _=ya(o,u);return Math.abs(_.lng-u.center.lng)>180&&(_.lng=u.center.lng+179.5*Math.sign(_.lng-u.center.lng)),{easingCenter:_,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(o,u){let _=o.around,v=u.screenPointToLocation(_);o.bearingDelta&&u.setBearing(u.bearing+o.bearingDelta),o.pitchDelta&&u.setPitch(u.pitch+o.pitchDelta),o.rollDelta&&u.setRoll(u.roll+o.rollDelta);let S=u.zoom;o.zoomDelta&&u.setZoom(u.zoom+o.zoomDelta);let O=u.zoom-S;if(O===0)return;let z=s.bn(u.center.lng,v.lng),V=z/(Math.abs(z/180)+1),H=s.bn(u.center.lat,v.lat),Q=u.getRayDirectionFromPixel(_),ne=u.cameraPosition,ie=-1*s.aV(ne,Q),de=s.bi();s.aP(de,ne,[Q[0]*ie,Q[1]*ie,Q[2]*ie]);let ge=s.bt(de)-1,Pe=Math.exp(.5*-Math.max(ge-.3,0)),Ie=Xd(u.worldSize,u.center.lat)/Math.min(u.width,u.height),Le=s.bf(Ie,.9,.5,1,.25),Ne=(1-s.aI(-O))*Math.min(Pe,Le),Ge=u.center.lat,De=u.zoom,Ze=new s.Q(u.center.lng+V*Ne,s.ae(u.center.lat+H*Ne,-85.051129,s.aJ));u.setLocationAtPoint(v,_);let He=u.center,Xe=s.bf(Math.abs(z),45,85,0,1),yt=s.bf(Ie,.75,.35,0,1),At=Math.pow(Math.max(Xe,yt),.25),Pt=s.bn(He.lng,Ze.lng),Ot=s.bn(He.lat,Ze.lat);u.setCenter(new s.Q(He.lng+Pt*At,He.lat+Ot*At).wrap()),u.setZoom(De+es(Ge,u.center.lat))}handleMapControlsPan(o,u,_){if(!o.panDelta)return;let v=u.center.lat,S=u.zoom;u.setCenter(ya(o.panDelta,u).wrap()),u.setZoom(S+es(v,u.center.lat))}cameraForBoxAndBearing(o,u,_,v,S){let O=hf(o,u,_,v,S),z=u.left/S.width*2-1,V=(S.width-u.right)/S.width*2-1,H=u.top/S.height*-2+1,Q=(S.height-u.bottom)/S.height*-2+1,ne=s.bn(_.getWest(),_.getEast())<0,ie=ne?_.getEast():_.getWest(),de=ne?_.getWest():_.getEast(),ge=Math.max(_.getNorth(),_.getSouth()),Pe=Math.min(_.getNorth(),_.getSouth()),Ie=ie+.5*s.bn(ie,de),Le=ge+.5*s.bn(ge,Pe),Ne=S.clone();Ne.setCenter(O.center),Ne.setBearing(O.bearing),Ne.setPitch(0),Ne.setRoll(0),Ne.setZoom(O.zoom);let Ge=Ne.modelViewProjectionMatrix,De=[Fs(_.getNorthWest()),Fs(_.getNorthEast()),Fs(_.getSouthWest()),Fs(_.getSouthEast()),Fs(new s.Q(de,Le)),Fs(new s.Q(ie,Le)),Fs(new s.Q(Ie,ge)),Fs(new s.Q(Ie,Pe))],Ze=Fs(O.center),He=Number.POSITIVE_INFINITY;for(let Xe of De)z<0&&(He=Mo.getLesserNonNegativeNonNull(He,Mo.solveVectorScale(Xe,Ze,Ge,"x",z))),V>0&&(He=Mo.getLesserNonNegativeNonNull(He,Mo.solveVectorScale(Xe,Ze,Ge,"x",V))),H>0&&(He=Mo.getLesserNonNegativeNonNull(He,Mo.solveVectorScale(Xe,Ze,Ge,"y",H))),Q<0&&(He=Mo.getLesserNonNegativeNonNull(He,Mo.solveVectorScale(Xe,Ze,Ge,"y",Q)));if(Number.isFinite(He)&&He!==0)return O.zoom=Ne.zoom+s.ab(He),O;lh()}handleJumpToCenterZoom(o,u){let _=o.center.lat,v=o.getConstrained(u.center?s.Q.convert(u.center):o.center,o.zoom).center;o.setCenter(v.wrap());let S=u.zoom!==void 0?+u.zoom:o.zoom+es(_,v.lat);o.zoom!==S&&o.setZoom(S)}handleEaseTo(o,u){let _=o.zoom,v=o.center,S=o.padding,O={roll:o.roll,pitch:o.pitch,bearing:o.bearing},z={roll:u.roll===void 0?o.roll:u.roll,pitch:u.pitch===void 0?o.pitch:u.pitch,bearing:u.bearing===void 0?o.bearing:u.bearing},V=u.zoom!==void 0,H=!o.isPaddingEqual(u.padding),Q=!1,ne=u.center?s.Q.convert(u.center):v,ie=o.getConstrained(ne,_).center;$d(o,ie);let de=o.clone();de.setCenter(ie),de.setZoom(V?+u.zoom:_+es(v.lat,ne.lat)),de.setBearing(u.bearing);let ge=new s.P(s.ae(o.centerPoint.x+u.offsetAsPoint.x,0,o.width),s.ae(o.centerPoint.y+u.offsetAsPoint.y,0,o.height));de.setLocationAtPoint(ie,ge);let Pe=(u.offset&&u.offsetAsPoint.mag())>0?de.center:ie,Ie=V?+u.zoom:_+es(v.lat,Pe.lat),Le=_+es(v.lat,0),Ne=Ie+es(Pe.lat,0),Ge=s.bn(v.lng,Pe.lng),De=s.bn(v.lat,Pe.lat),Ze=s.aI(Ne-Le);return Q=Ie!==_,{easeFunc:He=>{if(s.b6(O,z)||Yl({startEulerAngles:O,endEulerAngles:z,tr:o,k:He,useSlerp:O.roll!=z.roll}),H&&o.interpolatePadding(S,u.padding,He),u.around)s.w("Easing around a point is not supported under globe projection."),o.setLocationAtPoint(u.around,u.aroundPoint);else{let Xe=Ne>Le?Math.min(2,Ze):Math.max(.5,Ze),yt=Math.pow(Xe,1-He),At=em(v,Ge,De,He*yt);o.setCenter(At.wrap())}if(Q){let Xe=s.B.number(Le,Ne,He)+es(0,o.center.lat);o.setZoom(Xe)}},isZooming:Q,elevationCenter:Pe}}handleFlyTo(o,u){let _=u.zoom!==void 0,v=o.center,S=o.zoom,O=o.padding,z=!o.isPaddingEqual(u.padding),V=o.getConstrained(s.Q.convert(u.center||u.locationAtOffset),S).center,H=_?+u.zoom:o.zoom+es(o.center.lat,V.lat),Q=o.clone();Q.setCenter(V),Q.setZoom(H),Q.setBearing(u.bearing);let ne=new s.P(s.ae(o.centerPoint.x+u.offsetAsPoint.x,0,o.width),s.ae(o.centerPoint.y+u.offsetAsPoint.y,0,o.height));Q.setLocationAtPoint(V,ne);let ie=Q.center;$d(o,ie);let de=function(De,Ze,He){let Xe=Fs(Ze),yt=Fs(He),At=s.aV(Xe,yt),Pt=Math.acos(At),Ot=kg(De);return Pt/(2*Math.PI)*Ot}(o,v,ie),ge=S+es(v.lat,0),Pe=H+es(ie.lat,0),Ie=s.aI(Pe-ge),Le;if(typeof u.minZoom=="number"){let De=+u.minZoom+es(ie.lat,0),Ze=Math.min(De,ge,Pe)+es(0,ie.lat),He=o.getConstrained(ie,Ze).zoom+es(ie.lat,0);Le=s.aI(He-ge)}let Ne=s.bn(v.lng,ie.lng),Ge=s.bn(v.lat,ie.lat);return{easeFunc:(De,Ze,He,Xe)=>{let yt=em(v,Ne,Ge,He);z&&o.interpolatePadding(O,u.padding,De);let At=De===1?ie:yt;o.setCenter(At.wrap());let Pt=ge+s.ab(Ze);o.setZoom(De===1?H:Pt+es(0,At.lat))},scaleOfZoom:Ie,targetCenter:ie,scaleOfMinZoom:Le,pixelPathLength:de}}static solveVectorScale(o,u,_,v,S){let O=v==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],z=[_[3],_[7],_[11],_[15]],V=o[0]*O[0]+o[1]*O[1]+o[2]*O[2],H=o[0]*z[0]+o[1]*z[1]+o[2]*z[2],Q=u[0]*O[0]+u[1]*O[1]+u[2]*O[2],ne=u[0]*z[0]+u[1]*z[1]+u[2]*z[2];return Q+S*H===V+S*ne||z[3]*(V-Q)+O[3]*(ne-H)+V*ne==Q*H?null:(Q+O[3]-S*ne-S*z[3])/(Q-V-S*ne+S*H)}static getLesserNonNegativeNonNull(o,u){return u!==null&&u>=0&&u<o?u:o}}class Yd{constructor(o){this._globe=o,this._mercatorCameraHelper=new Io,this._verticalPerspectiveCameraHelper=new Mo}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(o,u){return this.currentHelper.handlePanInertia(o,u)}handleMapControlsRollPitchBearingZoom(o,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(o,u)}handleMapControlsPan(o,u,_){this.currentHelper.handleMapControlsPan(o,u,_)}cameraForBoxAndBearing(o,u,_,v,S){return this.currentHelper.cameraForBoxAndBearing(o,u,_,v,S)}handleJumpToCenterZoom(o,u){this.currentHelper.handleJumpToCenterZoom(o,u)}handleEaseTo(o,u){return this.currentHelper.handleEaseTo(o,u)}handleFlyTo(o,u){return this.currentHelper.handleFlyTo(o,u)}}let hl=(C,o)=>s.x(C,o&&o.filter(u=>u.identifier!=="source.canvas")),_f=s.bu();class Na extends s.E{constructor(o,u={}){super(),this._rtlPluginLoaded=()=>{for(let _ in this.sourceCaches){let v=this.sourceCaches[_].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[_].reload()}},this.map=o,this.dispatcher=new vr(Lt(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,v)=>this.getGlyphs(_,v)),this.dispatcher.registerMessageHandler("GI",(_,v)=>this.getImages(_,v)),this.imageManager=new Y,this.imageManager.setEventedParent(this),this.glyphManager=new _e(o._requestManager,u.localIdeographFontFamily),this.lineAtlas=new tt(256,512),this.crossTileSymbolIndex=new Wd,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bv,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.bw()),kt().on(ys,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let v=this.sourceCaches[_.sourceId];if(!v)return;let S=v.getSource();if(S&&S.vectorLayerIds)for(let O in this._layers){let z=this._layers[O];z.source===S.id&&this._validateLayer(z)}})}loadURL(o,u={},_){this.fire(new s.l("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;let v=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;let S=this._loadStyleRequest;s.j(v,this._loadStyleRequest).then(O=>{this._loadStyleRequest=null,this._load(O.data,u,_)}).catch(O=>{this._loadStyleRequest=null,O&&!S.signal.aborted&&this.fire(new s.k(O))})}loadJSON(o,u={},_){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,x.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(o,u,_)}).catch(()=>{})}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(_f,{validate:!1})}_load(o,u,_){var v,S;let O=u.transformStyle?u.transformStyle(_,o):o;if(!u.validate||!hl(this,s.y(O))){this._loaded=!0,this.stylesheet=O;for(let z in O.sources)this.addSource(z,O.sources[z],{validate:!1});O.sprite?this._loadSprite(O.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(O.glyphs),this._createLayers(),this.light=new ke(this.stylesheet.light),this._setProjectionInternal(((v=this.stylesheet.projection)===null||v===void 0?void 0:v.type)||"mercator"),this.sky=new rt(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){let o=s.bx(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(u=>u.id),this._layers={},this._serializedLayers=null;for(let u of o){let _=s.by(u);_.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=_}}_loadSprite(o,u=!1,_=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(S,O,z,V){return s._(this,void 0,void 0,function*(){let H=ae(S),Q=z>1?"@2x":"",ne={},ie={};for(let{id:de,url:ge}of H){let Pe=O.transformRequest(pe(ge,Q,".json"),"SpriteJSON");ne[de]=s.j(Pe,V);let Ie=O.transformRequest(pe(ge,Q,".png"),"SpriteImage");ie[de]=te.getImage(Ie,V)}return yield Promise.all([...Object.values(ne),...Object.values(ie)]),function(de,ge){return s._(this,void 0,void 0,function*(){let Pe={};for(let Ie in de){Pe[Ie]={};let Le=x.getImageCanvasContext((yield ge[Ie]).data),Ne=(yield de[Ie]).data;for(let Ge in Ne){let{width:De,height:Ze,x:He,y:Xe,sdf:yt,pixelRatio:At,stretchX:Pt,stretchY:Ot,content:Tt,textFitWidth:er,textFitHeight:Kt}=Ne[Ge];Pe[Ie][Ge]={data:null,pixelRatio:At,sdf:yt,stretchX:Pt,stretchY:Ot,content:Tt,textFitWidth:er,textFitHeight:Kt,spriteData:{width:De,height:Ze,x:He,y:Xe,context:Le}}}}return Pe})}(ne,ie)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(let O in S){this._spritesImagesIds[O]=[];let z=this._spritesImagesIds[O]?this._spritesImagesIds[O].filter(V=>!(V in S)):[];for(let V of z)this.imageManager.removeImage(V),this._changedImages[V]=!0;for(let V in S[O]){let H=O==="default"?V:`${O}:${V}`;this._spritesImagesIds[O].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,S[O][V],!1):this.imageManager.addImage(H,S[O][V]),u&&(this._changedImages[H]=!0)}}}).catch(S=>{this._spriteRequest=null,v=S,this.fire(new s.k(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),_&&_(v)})}_unloadSprite(){for(let o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(o){let u=this.sourceCaches[o.source];if(!u)return;let _=o.sourceLayer;if(!_)return;let v=u.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.k(new Error(`Source layer "${_}" does not exist on source "${v.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,u=!1){let _=this._serializedAllLayers();if(!o||o.length===0)return Object.values(u?s.bz(_):_);let v=[];for(let S of o)if(_[S]){let O=u?s.bz(_[S]):_[S];v.push(O)}return v}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};let u=Object.keys(this._layers);for(let _ of u){let v=this._layers[_];v.type!=="custom"&&(o[_]=v.serialize())}return o}hasTransitions(){var o,u,_;if(!((o=this.light)===null||o===void 0)&&o.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(let v in this.sourceCaches)if(this.sourceCaches[v].hasTransition())return!0;for(let v in this._layers)if(this._layers[v].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;let u=this._changed;if(u){let v=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(v.length||S.length)&&this._updateWorkerLayers(v,S);for(let O in this._updatedSources){let z=this._updatedSources[O];if(z==="reload")this._reloadSource(O);else{if(z!=="clear")throw new Error(`Invalid action ${z}`);this._clearSource(O)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let O in this._updatedPaintProps)this._layers[O].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}let _={};for(let v in this.sourceCaches){let S=this.sourceCaches[v];_[v]=S.used,S.used=!1}for(let v of this._order){let S=this._layers[v];S.recalculate(o,this._availableImages),!S.isHidden(o.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(let v in _){let S=this.sourceCaches[v];!!_[v]!=!!S.used&&S.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(o),this.sky.recalculate(o),this.projection.recalculate(o),this.z=o.zoom,u&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let o=Object.keys(this._changedImages);if(o.length){for(let u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,u={}){var _;this._checkLoaded();let v=this.serialize();if(o=u.transformStyle?u.transformStyle(v,o):o,((_=u.validate)===null||_===void 0||_)&&hl(this,s.y(o)))return!1;(o=s.bz(o)).layers=s.bx(o.layers);let S=s.bA(v,o),O=this._getOperationsToPerform(S);if(O.unimplemented.length>0)throw new Error(`Unimplemented: ${O.unimplemented.join(", ")}.`);if(O.operations.length===0)return!1;for(let z of O.operations)z();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){let u=[],_=[];for(let v of o)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":u.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":u.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setSky":u.push(()=>this.setSky.apply(this,v.args));break;case"setProjection":this.setProjection.apply(this,v.args);break;case"setTransition":u.push(()=>{});break;default:_.push(v.command)}return{operations:u,unimplemented:_}}addImage(o,u){if(this.getImage(o))return this.fire(new s.k(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,u),this._afterImageUpdated(o)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new s.k(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,u,_={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(s.y.source,`sources.${o}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let v=this.sourceCaches[o]=new Ae(o,u,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:o})),v.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===o)return this.fire(new s.k(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));let u=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],u.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,u){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);let _=this.sourceCaches[o].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(u),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,u,_={}){this._checkLoaded();let v=o.id;if(this.getLayer(v))return void this.fire(new s.k(new Error(`Layer "${v}" already exists on this map.`)));let S;if(o.type==="custom"){if(hl(this,s.bB(o)))return;S=s.by(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(v,o.source),o=s.bz(o),o=s.e(o,{source:v})),this._validate(s.y.layer,`layers.${v}`,o,{arrayIndex:-1},_))return;S=s.by(o),this._validateLayer(S),S.setEventedParent(this,{layer:{id:v}})}let O=u?this._order.indexOf(u):this._order.length;if(u&&O===-1)this.fire(new s.k(new Error(`Cannot add layer "${v}" before non-existing layer "${u}".`)));else{if(this._order.splice(O,0,v),this._layerOrderChanged=!0,this._layers[v]=S,this._removedLayers[v]&&S.source&&S.type!=="custom"){let z=this._removedLayers[v];delete this._removedLayers[v],z.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new s.k(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;let _=this._order.indexOf(o);this._order.splice(_,1);let v=u?this._order.indexOf(u):this._order.length;u&&v===-1?this.fire(new s.k(new Error(`Cannot move layer "${o}" before non-existing layer "${u}".`))):(this._order.splice(v,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();let u=this._layers[o];if(!u)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${o}".`)));u.setEventedParent(null);let _=this._order.indexOf(o);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,u,_){this._checkLoaded();let v=this.getLayer(o);v?v.minzoom===u&&v.maxzoom===_||(u!=null&&(v.minzoom=u),_!=null&&(v.maxzoom=_),this._updateLayer(v)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,u,_={}){this._checkLoaded();let v=this.getLayer(o);if(v){if(!s.bC(v.filter,u))return u==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(s.y.filter,`layers.${v.id}.filter`,u,null,_)||(v.filter=s.bz(u),this._updateLayer(v)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return s.bz(this.getLayer(o).filter)}setLayoutProperty(o,u,_,v={}){this._checkLoaded();let S=this.getLayer(o);S?s.bC(S.getLayoutProperty(u),_)||(S.setLayoutProperty(u,_,v),this._updateLayer(S)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,u){let _=this.getLayer(o);if(_)return _.getLayoutProperty(u);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,u,_,v={}){this._checkLoaded();let S=this.getLayer(o);S?s.bC(S.getPaintProperty(u),_)||(S.setPaintProperty(u,_,v)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new s.k(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,u){return this.getLayer(o).getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();let _=o.source,v=o.sourceLayer,S=this.sourceCaches[_];if(S===void 0)return void this.fire(new s.k(new Error(`The source '${_}' does not exist in the map's style.`)));let O=S.getSource().type;O==="geojson"&&v?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):O!=="vector"||v?(o.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(v,o.id,u)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,u){this._checkLoaded();let _=o.source,v=this.sourceCaches[_];if(v===void 0)return void this.fire(new s.k(new Error(`The source '${_}' does not exist in the map's style.`)));let S=v.getSource().type,O=S==="vector"?o.sourceLayer:void 0;S!=="vector"||O?u&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(O,o.id,u):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();let u=o.source,_=o.sourceLayer,v=this.sourceCaches[u];if(v!==void 0)return v.getSource().type!=="vector"||_?(o.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),v.getFeatureState(_,o.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let o=s.bD(this.sourceCaches,S=>S.serialize()),u=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,v=this.stylesheet;return s.bE({version:v.version,name:v.name,metadata:v.metadata,light:v.light,sky:v.sky,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,projection:v.projection,sources:o,layers:u,terrain:_},S=>S!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){let u=O=>this._layers[O].type==="fill-extrusion",_={},v=[];for(let O=this._order.length-1;O>=0;O--){let z=this._order[O];if(u(z)){_[z]=O;for(let V of o){let H=V[z];if(H)for(let Q of H)v.push(Q)}}}v.sort((O,z)=>z.intersectionZ-O.intersectionZ);let S=[];for(let O=this._order.length-1;O>=0;O--){let z=this._order[O];if(u(z))for(let V=v.length-1;V>=0;V--){let H=v[V].feature;if(_[H.layer.id]<O)break;S.push(H),v.pop()}else for(let V of o){let H=V[z];if(H)for(let Q of H)S.push(Q.feature)}}return S}queryRenderedFeatures(o,u,_){u&&u.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",u.filter,null,u);let v={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let H of u.layers){let Q=this._layers[H];if(!Q)return this.fire(new s.k(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];v[Q.source]=!0}}let S=[];u.availableImages=this._availableImages;let O=this._serializedAllLayers(),z=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,V=Object.assign(Object.assign({},u),{layers:z});for(let H in this.sourceCaches)u.layers&&!v[H]||S.push(Nr(this.sourceCaches[H],this._layers,O,o,V,_,this.map.terrain?(Q,ne,ie)=>this.map.terrain.getElevation(Q,ne,ie):void 0));return this.placement&&S.push(function(H,Q,ne,ie,de,ge,Pe){let Ie={},Le=ge.queryRenderedSymbols(ie),Ne=[];for(let Ge of Object.keys(Le).map(Number))Ne.push(Pe[Ge]);Ne.sort(Ai);for(let Ge of Ne){let De=Ge.featureIndex.lookupSymbolFeatures(Le[Ge.bucketInstanceId],Q,Ge.bucketIndex,Ge.sourceLayerIndex,de.filter,de.layers,de.availableImages,H);for(let Ze in De){let He=Ie[Ze]=Ie[Ze]||[],Xe=De[Ze];Xe.sort((yt,At)=>{let Pt=Ge.featureSortOrder;if(Pt){let Ot=Pt.indexOf(yt.featureIndex);return Pt.indexOf(At.featureIndex)-Ot}return At.featureIndex-yt.featureIndex});for(let yt of Xe)He.push(yt)}}return function(Ge,De,Ze){for(let He in Ge)for(let Xe of Ge[He])Wr(Xe,Ze[De[He].source]);return Ge}(Ie,H,ne)}(this._layers,O,this.sourceCaches,o,V,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(o,u){u&&u.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",u.filter,null,u);let _=this.sourceCaches[o];return _?function(v,S){let O=v.getRenderableIds().map(H=>v.getTileByID(H)),z=[],V={};for(let H=0;H<O.length;H++){let Q=O[H],ne=Q.tileID.canonical.key;V[ne]||(V[ne]=!0,Q.querySourceFeatures(z,S))}return z}(_,u):[]}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();let _=this.light.getLight(),v=!1;for(let O in o)if(!s.bC(o[O],_[O])){v=!0;break}if(!v)return;let S={now:x.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,u),this.light.updateTransitions(S)}getProjection(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.projection}setProjection(o){if(this._checkLoaded(),this.projection){if(this.projection.name===o.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=o,this._setProjectionInternal(o.type)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o,u={}){this._checkLoaded();let _=this.getSky(),v=!1;if(!o&&!_)return;if(o&&!_)v=!0;else if(!o&&_)v=!0;else for(let O in o)if(!s.bC(o[O],_[O])){v=!0;break}if(!v)return;let S={now:x.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,u),this.sky.updateTransitions(S)}_setProjectionInternal(o){let u=function(_){if(Array.isArray(_)){let v=new hh({type:_});return{projection:v,transform:new gf,cameraHelper:new Yd(v)}}switch(_){case"mercator":return{projection:new Ei,transform:new vn,cameraHelper:new Io};case"globe":{let v=new hh({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new gf,cameraHelper:new Yd(v)}}case"vertical-perspective":return{projection:new Af,transform:new mf,cameraHelper:new Mo};default:return s.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new Ei,transform:new vn,cameraHelper:new Io}}}(o);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(let _ in this.sourceCaches)this.sourceCaches[_].reload()}_validate(o,u,_,v,S={}){return(!S||S.validate!==!1)&&hl(this,o.call(s.y,s.e({key:u,style:this.serialize(),value:_,styleSpec:s.v},v)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),kt().off(ys,this._rtlPluginLoaded);for(let u in this._layers)this._layers[u].setEventedParent(null);for(let u in this.sourceCaches){let _=this.sourceCaches[u];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(let u in this.sourceCaches)this.sourceCaches[u].update(o,this.map.terrain)}_generateCollisionBoxes(){for(let o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,u,_,v,S=!1){let O=!1,z=!1,V={};for(let H of this._order){let Q=this._layers[H];if(Q.type!=="symbol")continue;if(!V[Q.source]){let ie=this.sourceCaches[Q.source];V[Q.source]=ie.getRenderableIds(!0).map(de=>ie.getTileByID(de)).sort((de,ge)=>ge.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(ge.tileID)?-1:1))}let ne=this.crossTileSymbolIndex.addLayer(Q,V[Q.source],o.center.lng);O=O||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(x.now(),o.zoom))&&(this.pauseablePlacement=new Jn(o,this.map.terrain,this._order,S,u,_,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(x.now()),z=!0),O&&this.pauseablePlacement.placement.setStale()),z||O)for(let H of this._order){let Q=this._layers[H];Q.type==="symbol"&&this.placement.updateLayerOpacities(Q,V[Q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(x.now())}_releaseSymbolFadeTiles(){for(let o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,u){return s._(this,void 0,void 0,function*(){let _=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();let v=this.sourceCaches[u.source];return v&&v.setDependencies(u.tileID.key,u.type,u.icons),_})}getGlyphs(o,u){return s._(this,void 0,void 0,function*(){let _=yield this.glyphManager.getGlyphs(u.stacks),v=this.sourceCaches[u.source];return v&&v.setDependencies(u.tileID.key,u.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,u={}){this._checkLoaded(),o&&this._validate(s.y.glyphs,"glyphs",o,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,u,_={},v){this._checkLoaded();let S=[{id:o,url:u}],O=[...ae(this.stylesheet.sprite),...S];this._validate(s.y.sprite,"sprite",O,null,_)||(this.stylesheet.sprite=O,this._loadSprite(S,!0,v))}removeSprite(o){this._checkLoaded();let u=ae(this.stylesheet.sprite);if(u.find(_=>_.id===o)){if(this._spritesImagesIds[o])for(let _ of this._spritesImagesIds[o])this.imageManager.removeImage(_),this._changedImages[_]=!0;u.splice(u.findIndex(_=>_.id===o),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return ae(this.stylesheet.sprite)}setSprite(o,u={},_){this._checkLoaded(),o&&this._validate(s.y.sprite,"sprite",o,null,u)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,_):(this._unloadSprite(),_&&_(null)))}}var dh=s.aD([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class za{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,u,_,v,S,O,z,V,H){this.context=o;let Q=this.boundPaintVertexBuffers.length!==v.length;for(let ne=0;!Q&&ne<v.length;ne++)this.boundPaintVertexBuffers[ne]!==v[ne]&&(Q=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||Q||this.boundIndexBuffer!==S||this.boundVertexOffset!==O||this.boundDynamicVertexBuffer!==z||this.boundDynamicVertexBuffer2!==V||this.boundDynamicVertexBuffer3!==H?this.freshBind(u,_,v,S,O,z,V,H):(o.bindVertexArray.set(this.vao),z&&z.bind(),S&&S.dynamicDraw&&S.bind(),V&&V.bind(),H&&H.bind())}freshBind(o,u,_,v,S,O,z,V){let H=o.numAttributes,Q=this.context,ne=Q.gl;this.vao&&this.destroy(),this.vao=Q.createVertexArray(),Q.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=v,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=O,this.boundDynamicVertexBuffer2=z,this.boundDynamicVertexBuffer3=V,u.enableAttributes(ne,o);for(let ie of _)ie.enableAttributes(ne,o);O&&O.enableAttributes(ne,o),z&&z.enableAttributes(ne,o),V&&V.enableAttributes(ne,o),u.bind(),u.setVertexAttribPointers(ne,o,S);for(let ie of _)ie.bind(),ie.setVertexAttribPointers(ne,o,S);O&&(O.bind(),O.setVertexAttribPointers(ne,o,S)),v&&v.bind(),z&&(z.bind(),z.setVertexAttribPointers(ne,o,S)),V&&(V.bind(),V.setVertexAttribPointers(ne,o,S)),Q.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let gt=(C,o,u,_,v)=>({u_texture:0,u_ele_delta:C,u_fog_matrix:o,u_fog_color:u?u.properties.get("fog-color"):s.b7.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:v?0:u?u.calculateFogBlendOpacity(_):0,u_horizon_color:u?u.properties.get("horizon-color"):s.b7.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:v?1:0}),$t={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function or(C){let o=[];for(let u=0;u<C.length;u++){if(C[u]===null)continue;let _=C[u].split(" ");o.push(_.pop())}return o}class Dr{constructor(o,u,_,v,S,O,z,V){let H=o.gl;this.program=H.createProgram();let Q=or(u.staticAttributes),ne=_?_.getBinderAttributes():[],ie=Q.concat(ne),de=ga.prelude.staticUniforms?or(ga.prelude.staticUniforms):[],ge=z.staticUniforms?or(z.staticUniforms):[],Pe=u.staticUniforms?or(u.staticUniforms):[],Ie=_?_.getBinderUniforms():[],Le=de.concat(ge).concat(Pe).concat(Ie),Ne=[];for(let At of Le)Ne.indexOf(At)<0&&Ne.push(At);let Ge=_?_.defines():[];_a(H)&&Ge.unshift("#version 300 es"),S&&Ge.push("#define OVERDRAW_INSPECTOR;"),O&&Ge.push("#define TERRAIN3D;"),V&&Ge.push(V);let De=Ge.concat(ga.prelude.fragmentSource,z.fragmentSource,u.fragmentSource).join(`
`),Ze=Ge.concat(ga.prelude.vertexSource,z.vertexSource,u.vertexSource).join(`
`);_a(H)||(De=function(At){return At.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(De),Ze=function(At){return At.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Ze));let He=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(He,De),H.compileShader(He),!H.getShaderParameter(He,H.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${H.getShaderInfoLog(He)}`);H.attachShader(this.program,He);let Xe=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(Xe,Ze),H.compileShader(Xe),!H.getShaderParameter(Xe,H.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${H.getShaderInfoLog(Xe)}`);H.attachShader(this.program,Xe),this.attributes={};let yt={};this.numAttributes=ie.length;for(let At=0;At<this.numAttributes;At++)ie[At]&&(H.bindAttribLocation(this.program,At,ie[At]),this.attributes[ie[At]]=At);if(H.linkProgram(this.program),!H.getProgramParameter(this.program,H.LINK_STATUS))throw new Error(`Program failed to link: ${H.getProgramInfoLog(this.program)}`);H.deleteShader(Xe),H.deleteShader(He);for(let At=0;At<Ne.length;At++){let Pt=Ne[At];if(Pt&&!yt[Pt]){let Ot=H.getUniformLocation(this.program,Pt);Ot&&(yt[Pt]=Ot)}}this.fixedUniforms=v(o,yt),this.terrainUniforms=((At,Pt)=>({u_depth:new s.bF(At,Pt.u_depth),u_terrain:new s.bF(At,Pt.u_terrain),u_terrain_dim:new s.b8(At,Pt.u_terrain_dim),u_terrain_matrix:new s.bH(At,Pt.u_terrain_matrix),u_terrain_unpack:new s.bI(At,Pt.u_terrain_unpack),u_terrain_exaggeration:new s.b8(At,Pt.u_terrain_exaggeration)}))(o,yt),this.projectionUniforms=((At,Pt)=>({u_projection_matrix:new s.bH(At,Pt.u_projection_matrix),u_projection_tile_mercator_coords:new s.bI(At,Pt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bI(At,Pt.u_projection_clipping_plane),u_projection_transition:new s.b8(At,Pt.u_projection_transition),u_projection_fallback_matrix:new s.bH(At,Pt.u_projection_fallback_matrix)}))(o,yt),this.binderUniforms=_?_.getUniforms(o,yt):[]}draw(o,u,_,v,S,O,z,V,H,Q,ne,ie,de,ge,Pe,Ie,Le,Ne,Ge){let De=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(_),o.setStencilMode(v),o.setColorMode(S),o.setCullFace(O),V){o.activeTexture.set(De.TEXTURE2),De.bindTexture(De.TEXTURE_2D,V.depthTexture),o.activeTexture.set(De.TEXTURE3),De.bindTexture(De.TEXTURE_2D,V.texture);for(let He in this.terrainUniforms)this.terrainUniforms[He].set(V[He])}if(H)for(let He in H)this.projectionUniforms[$t[He]].set(H[He]);if(z)for(let He in this.fixedUniforms)this.fixedUniforms[He].set(z[He]);Ie&&Ie.setUniforms(o,this.binderUniforms,ge,{zoom:Pe});let Ze=0;switch(u){case De.LINES:Ze=2;break;case De.TRIANGLES:Ze=3;break;case De.LINE_STRIP:Ze=1}for(let He of de.get()){let Xe=He.vaos||(He.vaos={});(Xe[Q]||(Xe[Q]=new za)).bind(o,this,ne,Ie?Ie.getPaintVertexBuffers():[],ie,He.vertexOffset,Le,Ne,Ge),De.drawElements(u,He.primitiveLength*Ze,De.UNSIGNED_SHORT,He.primitiveOffset*Ze*2)}}}function y(C,o,u){let _=1/s.aw(u,1,o.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),S=u.tileSize*Math.pow(2,o.transform.tileZoom)/v,O=S*(u.tileID.canonical.x+u.tileID.wrap*v),z=S*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[_,C.fromScale,C.toScale],u_fade:C.t,u_pixel_coord_upper:[O>>16,z>>16],u_pixel_coord_lower:[65535&O,65535&z]}}let Yi=(C,o,u,_)=>{let v=C.style.light,S=v.properties.get("position"),O=[S.x,S.y,S.z],z=s.bL();v.properties.get("anchor")==="viewport"&&s.bM(z,C.transform.bearingInRadians),s.bN(O,O,z);let V=C.transform.transformLightDirection(O),H=v.properties.get("color");return{u_lightpos:O,u_lightpos_globe:V,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+o,u_opacity:u,u_fill_translate:_}},Mi=(C,o,u,_,v,S,O)=>s.e(Yi(C,o,u,_),y(S,C,O),{u_height_factor:-Math.pow(2,v.overscaledZ)/O.tileSize/8}),Ce=(C,o,u,_)=>s.e(y(o,C,u),{u_fill_translate:_}),Rn=(C,o)=>({u_world:C,u_fill_translate:o}),ho=(C,o,u,_,v)=>s.e(Ce(C,o,u,v),{u_world:_}),ts=(C,o,u,_,v)=>{let S=C.transform,O,z,V=0;if(u.paint.get("circle-pitch-alignment")==="map"){let H=s.aw(o,1,S.zoom);O=!0,z=[H,H],V=H/(s.Z*Math.pow(2,o.tileID.overscaledZ))*2*Math.PI*v}else O=!1,z=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+O,u_device_pixel_ratio:C.pixelRatio,u_extrude_scale:z,u_globe_extrude_scale:V,u_translate:_}},Gi=C=>({u_pixel_extrude_scale:[1/C.width,1/C.height]}),gn=C=>({u_viewport_size:[C.width,C.height]}),Wn=(C,o=1)=>({u_color:C,u_overlay:0,u_overlay_scale:o}),Ci=(C,o,u,_)=>{let v=s.aw(C,1,o)/(s.Z*Math.pow(2,C.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:s.aw(C,1,o),u_intensity:u,u_globe_extrude_scale:v}},Pi=(C,o,u,_)=>{let v=s.K();s.bO(v,0,C.width,C.height,0,0,1);let S=C.context.gl;return{u_matrix:v,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:u,u_color_ramp:_,u_opacity:o.paint.get("heatmap-opacity")}},Kc=(C,o,u)=>{let _=u.paint.get("hillshade-shadow-color"),v=u.paint.get("hillshade-highlight-color"),S=u.paint.get("hillshade-accent-color"),O=u.paint.get("hillshade-illumination-direction")*(Math.PI/180);return u.paint.get("hillshade-illumination-anchor")==="viewport"&&(O+=C.transform.bearingInRadians),{u_image:0,u_latrange:Kl(0,o.tileID),u_light:[u.paint.get("hillshade-exaggeration"),O],u_shadow:_,u_highlight:v,u_accent:S}},im=(C,o)=>{let u=o.stride,_=s.K();return s.bO(_,0,s.Z,-8192,0,0,1),s.L(_,_,[0,-8192,0]),{u_matrix:_,u_image:1,u_dimension:[u,u],u_zoom:C.overscaledZ,u_unpack:o.getUnpackVector()}};function Kl(C,o){let u=Math.pow(2,o.canonical.z),_=o.canonical.y;return[new s.$(0,_/u).toLngLat().lat,new s.$(0,(_+1)/u).toLngLat().lat]}let Qc=(C,o,u,_)=>{let v=C.transform;return{u_translation:nm(C,o,u),u_ratio:_/s.aw(o,1,v.zoom),u_device_pixel_ratio:C.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Po=(C,o,u,_,v)=>s.e(Qc(C,o,u,_),{u_image:0,u_image_height:v}),xa=(C,o,u,_,v)=>{let S=C.transform,O=Ql(o,S);return{u_translation:nm(C,o,u),u_texsize:o.imageAtlasTexture.size,u_ratio:_/s.aw(o,1,S.zoom),u_device_pixel_ratio:C.pixelRatio,u_image:0,u_scale:[O,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},ba=(C,o,u,_,v,S)=>{let O=C.lineAtlas,z=Ql(o,C.transform),V=u.layout.get("line-cap")==="round",H=O.getDash(v.from,V),Q=O.getDash(v.to,V),ne=H.width*S.fromScale,ie=Q.width*S.toScale;return s.e(Qc(C,o,u,_),{u_patternscale_a:[z/ne,-H.height/2],u_patternscale_b:[z/ie,-Q.height/2],u_sdfgamma:O.width/(256*Math.min(ne,ie)*C.pixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:Q.y,u_mix:S.t})};function Ql(C,o){return 1/s.aw(C,1,o.tileZoom)}function nm(C,o,u){return s.ax(C.transform,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}let Jl=(C,o,u,_,v)=>{return{u_tl_parent:C,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(O=_.paint.get("raster-saturation"),O>0?1-1/(1.001-O):-O),u_contrast_factor:(S=_.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:Qr(_.paint.get("raster-hue-rotate")),u_coords_top:[v[0].x,v[0].y,v[1].x,v[1].y],u_coords_bottom:[v[3].x,v[3].y,v[2].x,v[2].y]};var S,O};function Qr(C){C*=Math.PI/180;let o=Math.sin(C),u=Math.cos(C);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}let Re=(C,o,u,_,v,S,O,z,V,H,Q,ne,ie)=>{let de=O.transform;return{u_is_size_zoom_constant:+(C==="constant"||C==="source"),u_is_size_feature_constant:+(C==="constant"||C==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:de.cameraToCenterDistance,u_pitch:de.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:de.width/de.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_label_plane_matrix:z,u_coord_matrix:V,u_is_text:+Q,u_pitch_with_map:+_,u_is_along_line:v,u_is_variable_anchor:S,u_texsize:ne,u_texture:0,u_translation:H,u_pitched_scale:ie}},zr=(C,o,u,_,v,S,O,z,V,H,Q,ne,ie,de)=>{let ge=O.transform;return s.e(Re(C,o,u,_,v,S,O,z,V,H,Q,ne,de),{u_gamma_scale:_?Math.cos(ge.pitch*Math.PI/180)*ge.cameraToCenterDistance:1,u_device_pixel_ratio:O.pixelRatio,u_is_halo:1})},yf=(C,o,u,_,v,S,O,z,V,H,Q,ne,ie)=>s.e(zr(C,o,u,_,v,S,O,z,V,H,!0,Q,0,ie),{u_texsize_icon:ne,u_texture_icon:1}),sm=(C,o)=>({u_opacity:C,u_color:o}),xf=(C,o,u,_,v)=>s.e(function(S,O,z,V){let H=z.imageManager.getPattern(S.from.toString()),Q=z.imageManager.getPattern(S.to.toString()),{width:ne,height:ie}=z.imageManager.getPixelSize(),de=Math.pow(2,V.tileID.overscaledZ),ge=V.tileSize*Math.pow(2,z.transform.tileZoom)/de,Pe=ge*(V.tileID.canonical.x+V.tileID.wrap*de),Ie=ge*V.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:Q.tl,u_pattern_br_b:Q.br,u_texsize:[ne,ie],u_mix:O.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:Q.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/s.aw(V,1,z.transform.tileZoom),u_pixel_coord_upper:[Pe>>16,Ie>>16],u_pixel_coord_lower:[65535&Pe,65535&Ie]}}(u,v,o,_),{u_opacity:C}),va=(C,o)=>{},Kd={fillExtrusion:(C,o)=>({u_lightpos:new s.bJ(C,o.u_lightpos),u_lightpos_globe:new s.bJ(C,o.u_lightpos_globe),u_lightintensity:new s.b8(C,o.u_lightintensity),u_lightcolor:new s.bJ(C,o.u_lightcolor),u_vertical_gradient:new s.b8(C,o.u_vertical_gradient),u_opacity:new s.b8(C,o.u_opacity),u_fill_translate:new s.bK(C,o.u_fill_translate)}),fillExtrusionPattern:(C,o)=>({u_lightpos:new s.bJ(C,o.u_lightpos),u_lightpos_globe:new s.bJ(C,o.u_lightpos_globe),u_lightintensity:new s.b8(C,o.u_lightintensity),u_lightcolor:new s.bJ(C,o.u_lightcolor),u_vertical_gradient:new s.b8(C,o.u_vertical_gradient),u_height_factor:new s.b8(C,o.u_height_factor),u_opacity:new s.b8(C,o.u_opacity),u_fill_translate:new s.bK(C,o.u_fill_translate),u_image:new s.bF(C,o.u_image),u_texsize:new s.bK(C,o.u_texsize),u_pixel_coord_upper:new s.bK(C,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bK(C,o.u_pixel_coord_lower),u_scale:new s.bJ(C,o.u_scale),u_fade:new s.b8(C,o.u_fade)}),fill:(C,o)=>({u_fill_translate:new s.bK(C,o.u_fill_translate)}),fillPattern:(C,o)=>({u_image:new s.bF(C,o.u_image),u_texsize:new s.bK(C,o.u_texsize),u_pixel_coord_upper:new s.bK(C,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bK(C,o.u_pixel_coord_lower),u_scale:new s.bJ(C,o.u_scale),u_fade:new s.b8(C,o.u_fade),u_fill_translate:new s.bK(C,o.u_fill_translate)}),fillOutline:(C,o)=>({u_world:new s.bK(C,o.u_world),u_fill_translate:new s.bK(C,o.u_fill_translate)}),fillOutlinePattern:(C,o)=>({u_world:new s.bK(C,o.u_world),u_image:new s.bF(C,o.u_image),u_texsize:new s.bK(C,o.u_texsize),u_pixel_coord_upper:new s.bK(C,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bK(C,o.u_pixel_coord_lower),u_scale:new s.bJ(C,o.u_scale),u_fade:new s.b8(C,o.u_fade),u_fill_translate:new s.bK(C,o.u_fill_translate)}),circle:(C,o)=>({u_camera_to_center_distance:new s.b8(C,o.u_camera_to_center_distance),u_scale_with_map:new s.bF(C,o.u_scale_with_map),u_pitch_with_map:new s.bF(C,o.u_pitch_with_map),u_extrude_scale:new s.bK(C,o.u_extrude_scale),u_device_pixel_ratio:new s.b8(C,o.u_device_pixel_ratio),u_globe_extrude_scale:new s.b8(C,o.u_globe_extrude_scale),u_translate:new s.bK(C,o.u_translate)}),collisionBox:(C,o)=>({u_pixel_extrude_scale:new s.bK(C,o.u_pixel_extrude_scale)}),collisionCircle:(C,o)=>({u_viewport_size:new s.bK(C,o.u_viewport_size)}),debug:(C,o)=>({u_color:new s.bG(C,o.u_color),u_overlay:new s.bF(C,o.u_overlay),u_overlay_scale:new s.b8(C,o.u_overlay_scale)}),depth:va,clippingMask:va,heatmap:(C,o)=>({u_extrude_scale:new s.b8(C,o.u_extrude_scale),u_intensity:new s.b8(C,o.u_intensity),u_globe_extrude_scale:new s.b8(C,o.u_globe_extrude_scale)}),heatmapTexture:(C,o)=>({u_matrix:new s.bH(C,o.u_matrix),u_world:new s.bK(C,o.u_world),u_image:new s.bF(C,o.u_image),u_color_ramp:new s.bF(C,o.u_color_ramp),u_opacity:new s.b8(C,o.u_opacity)}),hillshade:(C,o)=>({u_image:new s.bF(C,o.u_image),u_latrange:new s.bK(C,o.u_latrange),u_light:new s.bK(C,o.u_light),u_shadow:new s.bG(C,o.u_shadow),u_highlight:new s.bG(C,o.u_highlight),u_accent:new s.bG(C,o.u_accent)}),hillshadePrepare:(C,o)=>({u_matrix:new s.bH(C,o.u_matrix),u_image:new s.bF(C,o.u_image),u_dimension:new s.bK(C,o.u_dimension),u_zoom:new s.b8(C,o.u_zoom),u_unpack:new s.bI(C,o.u_unpack)}),line:(C,o)=>({u_translation:new s.bK(C,o.u_translation),u_ratio:new s.b8(C,o.u_ratio),u_device_pixel_ratio:new s.b8(C,o.u_device_pixel_ratio),u_units_to_pixels:new s.bK(C,o.u_units_to_pixels)}),lineGradient:(C,o)=>({u_translation:new s.bK(C,o.u_translation),u_ratio:new s.b8(C,o.u_ratio),u_device_pixel_ratio:new s.b8(C,o.u_device_pixel_ratio),u_units_to_pixels:new s.bK(C,o.u_units_to_pixels),u_image:new s.bF(C,o.u_image),u_image_height:new s.b8(C,o.u_image_height)}),linePattern:(C,o)=>({u_translation:new s.bK(C,o.u_translation),u_texsize:new s.bK(C,o.u_texsize),u_ratio:new s.b8(C,o.u_ratio),u_device_pixel_ratio:new s.b8(C,o.u_device_pixel_ratio),u_image:new s.bF(C,o.u_image),u_units_to_pixels:new s.bK(C,o.u_units_to_pixels),u_scale:new s.bJ(C,o.u_scale),u_fade:new s.b8(C,o.u_fade)}),lineSDF:(C,o)=>({u_translation:new s.bK(C,o.u_translation),u_ratio:new s.b8(C,o.u_ratio),u_device_pixel_ratio:new s.b8(C,o.u_device_pixel_ratio),u_units_to_pixels:new s.bK(C,o.u_units_to_pixels),u_patternscale_a:new s.bK(C,o.u_patternscale_a),u_patternscale_b:new s.bK(C,o.u_patternscale_b),u_sdfgamma:new s.b8(C,o.u_sdfgamma),u_image:new s.bF(C,o.u_image),u_tex_y_a:new s.b8(C,o.u_tex_y_a),u_tex_y_b:new s.b8(C,o.u_tex_y_b),u_mix:new s.b8(C,o.u_mix)}),raster:(C,o)=>({u_tl_parent:new s.bK(C,o.u_tl_parent),u_scale_parent:new s.b8(C,o.u_scale_parent),u_buffer_scale:new s.b8(C,o.u_buffer_scale),u_fade_t:new s.b8(C,o.u_fade_t),u_opacity:new s.b8(C,o.u_opacity),u_image0:new s.bF(C,o.u_image0),u_image1:new s.bF(C,o.u_image1),u_brightness_low:new s.b8(C,o.u_brightness_low),u_brightness_high:new s.b8(C,o.u_brightness_high),u_saturation_factor:new s.b8(C,o.u_saturation_factor),u_contrast_factor:new s.b8(C,o.u_contrast_factor),u_spin_weights:new s.bJ(C,o.u_spin_weights),u_coords_top:new s.bI(C,o.u_coords_top),u_coords_bottom:new s.bI(C,o.u_coords_bottom)}),symbolIcon:(C,o)=>({u_is_size_zoom_constant:new s.bF(C,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bF(C,o.u_is_size_feature_constant),u_size_t:new s.b8(C,o.u_size_t),u_size:new s.b8(C,o.u_size),u_camera_to_center_distance:new s.b8(C,o.u_camera_to_center_distance),u_pitch:new s.b8(C,o.u_pitch),u_rotate_symbol:new s.bF(C,o.u_rotate_symbol),u_aspect_ratio:new s.b8(C,o.u_aspect_ratio),u_fade_change:new s.b8(C,o.u_fade_change),u_label_plane_matrix:new s.bH(C,o.u_label_plane_matrix),u_coord_matrix:new s.bH(C,o.u_coord_matrix),u_is_text:new s.bF(C,o.u_is_text),u_pitch_with_map:new s.bF(C,o.u_pitch_with_map),u_is_along_line:new s.bF(C,o.u_is_along_line),u_is_variable_anchor:new s.bF(C,o.u_is_variable_anchor),u_texsize:new s.bK(C,o.u_texsize),u_texture:new s.bF(C,o.u_texture),u_translation:new s.bK(C,o.u_translation),u_pitched_scale:new s.b8(C,o.u_pitched_scale)}),symbolSDF:(C,o)=>({u_is_size_zoom_constant:new s.bF(C,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bF(C,o.u_is_size_feature_constant),u_size_t:new s.b8(C,o.u_size_t),u_size:new s.b8(C,o.u_size),u_camera_to_center_distance:new s.b8(C,o.u_camera_to_center_distance),u_pitch:new s.b8(C,o.u_pitch),u_rotate_symbol:new s.bF(C,o.u_rotate_symbol),u_aspect_ratio:new s.b8(C,o.u_aspect_ratio),u_fade_change:new s.b8(C,o.u_fade_change),u_label_plane_matrix:new s.bH(C,o.u_label_plane_matrix),u_coord_matrix:new s.bH(C,o.u_coord_matrix),u_is_text:new s.bF(C,o.u_is_text),u_pitch_with_map:new s.bF(C,o.u_pitch_with_map),u_is_along_line:new s.bF(C,o.u_is_along_line),u_is_variable_anchor:new s.bF(C,o.u_is_variable_anchor),u_texsize:new s.bK(C,o.u_texsize),u_texture:new s.bF(C,o.u_texture),u_gamma_scale:new s.b8(C,o.u_gamma_scale),u_device_pixel_ratio:new s.b8(C,o.u_device_pixel_ratio),u_is_halo:new s.bF(C,o.u_is_halo),u_translation:new s.bK(C,o.u_translation),u_pitched_scale:new s.b8(C,o.u_pitched_scale)}),symbolTextAndIcon:(C,o)=>({u_is_size_zoom_constant:new s.bF(C,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bF(C,o.u_is_size_feature_constant),u_size_t:new s.b8(C,o.u_size_t),u_size:new s.b8(C,o.u_size),u_camera_to_center_distance:new s.b8(C,o.u_camera_to_center_distance),u_pitch:new s.b8(C,o.u_pitch),u_rotate_symbol:new s.bF(C,o.u_rotate_symbol),u_aspect_ratio:new s.b8(C,o.u_aspect_ratio),u_fade_change:new s.b8(C,o.u_fade_change),u_label_plane_matrix:new s.bH(C,o.u_label_plane_matrix),u_coord_matrix:new s.bH(C,o.u_coord_matrix),u_is_text:new s.bF(C,o.u_is_text),u_pitch_with_map:new s.bF(C,o.u_pitch_with_map),u_is_along_line:new s.bF(C,o.u_is_along_line),u_is_variable_anchor:new s.bF(C,o.u_is_variable_anchor),u_texsize:new s.bK(C,o.u_texsize),u_texsize_icon:new s.bK(C,o.u_texsize_icon),u_texture:new s.bF(C,o.u_texture),u_texture_icon:new s.bF(C,o.u_texture_icon),u_gamma_scale:new s.b8(C,o.u_gamma_scale),u_device_pixel_ratio:new s.b8(C,o.u_device_pixel_ratio),u_is_halo:new s.bF(C,o.u_is_halo),u_translation:new s.bK(C,o.u_translation),u_pitched_scale:new s.b8(C,o.u_pitched_scale)}),background:(C,o)=>({u_opacity:new s.b8(C,o.u_opacity),u_color:new s.bG(C,o.u_color)}),backgroundPattern:(C,o)=>({u_opacity:new s.b8(C,o.u_opacity),u_image:new s.bF(C,o.u_image),u_pattern_tl_a:new s.bK(C,o.u_pattern_tl_a),u_pattern_br_a:new s.bK(C,o.u_pattern_br_a),u_pattern_tl_b:new s.bK(C,o.u_pattern_tl_b),u_pattern_br_b:new s.bK(C,o.u_pattern_br_b),u_texsize:new s.bK(C,o.u_texsize),u_mix:new s.b8(C,o.u_mix),u_pattern_size_a:new s.bK(C,o.u_pattern_size_a),u_pattern_size_b:new s.bK(C,o.u_pattern_size_b),u_scale_a:new s.b8(C,o.u_scale_a),u_scale_b:new s.b8(C,o.u_scale_b),u_pixel_coord_upper:new s.bK(C,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bK(C,o.u_pixel_coord_lower),u_tile_units_to_pixels:new s.b8(C,o.u_tile_units_to_pixels)}),terrain:(C,o)=>({u_texture:new s.bF(C,o.u_texture),u_ele_delta:new s.b8(C,o.u_ele_delta),u_fog_matrix:new s.bH(C,o.u_fog_matrix),u_fog_color:new s.bG(C,o.u_fog_color),u_fog_ground_blend:new s.b8(C,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.b8(C,o.u_fog_ground_blend_opacity),u_horizon_color:new s.bG(C,o.u_horizon_color),u_horizon_fog_blend:new s.b8(C,o.u_horizon_fog_blend),u_is_globe_mode:new s.b8(C,o.u_is_globe_mode)}),terrainDepth:(C,o)=>({u_ele_delta:new s.b8(C,o.u_ele_delta)}),terrainCoords:(C,o)=>({u_texture:new s.bF(C,o.u_texture),u_terrain_coords_id:new s.b8(C,o.u_terrain_coords_id),u_ele_delta:new s.b8(C,o.u_ele_delta)}),projectionErrorMeasurement:(C,o)=>({u_input:new s.b8(C,o.u_input),u_output_expected:new s.b8(C,o.u_output_expected)}),atmosphere:(C,o)=>({u_sun_pos:new s.bJ(C,o.u_sun_pos),u_atmosphere_blend:new s.b8(C,o.u_atmosphere_blend),u_globe_position:new s.bJ(C,o.u_globe_position),u_globe_radius:new s.b8(C,o.u_globe_radius),u_inv_proj_matrix:new s.bH(C,o.u_inv_proj_matrix)}),sky:(C,o)=>({u_sky_color:new s.bG(C,o.u_sky_color),u_horizon_color:new s.bG(C,o.u_horizon_color),u_horizon:new s.bK(C,o.u_horizon),u_horizon_normal:new s.bK(C,o.u_horizon_normal),u_sky_horizon_blend:new s.b8(C,o.u_sky_horizon_blend),u_sky_blend:new s.b8(C,o.u_sky_blend)})};class we{constructor(o,u,_){this.context=o;let v=o.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){let u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Qd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class om{constructor(o,u,_,v){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=o;let S=o.gl;this.buffer=S.createBuffer(),o.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let _=0;_<this.attributes.length;_++){let v=u.attributes[this.attributes[_].name];v!==void 0&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,u,_){for(let v=0;v<this.attributes.length;v++){let S=this.attributes[v],O=u.attributes[S.name];O!==void 0&&o.vertexAttribPointer(O,S.components,o[Qd[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ri{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ec extends Ri{getDefault(){return s.b7.transparent}set(o){let u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Jd extends Ri{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Ug extends Ri{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class am extends Ri{getDefault(){return[!0,!0,!0,!0]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class lm extends Ri{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class cm extends Ri{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class wa extends Ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class fs extends Ri{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class bf extends Ri{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class vf extends Ri{getDefault(){return[0,1]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class wf extends Ri{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class ph extends Ri{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ep extends Ri{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class tc extends Ri{getDefault(){let o=this.gl;return[o.ONE,o.ZERO]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Jc extends Ri{getDefault(){return s.b7.transparent}set(o){let u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class yi extends Ri{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Tf extends Ri{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class tp extends Ri{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class rp extends Ri{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class rc extends Ri{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Ef extends Ri{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ah extends Ri{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ic extends Ri{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class eu extends Ri{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class um extends Ri{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class tu extends Ri{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class nc extends Ri{getDefault(){return null}set(o){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ip extends Ri{getDefault(){return null}set(o){var u;if(o===this.current&&!this.dirty)return;let _=this.gl;_a(_)?_.bindVertexArray(o):(u=_.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Cf extends Ri{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Si extends Ri{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Sf extends Ri{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class np extends Ri{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class xs extends np{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class ea extends np{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ks extends np{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}let If="Framebuffer is not complete";class sp{constructor(o,u,_,v,S){this.context=o,this.width=u,this.height=_;let O=o.gl,z=this.framebuffer=O.createFramebuffer();if(this.colorAttachment=new xs(o,z),v)this.depthAttachment=S?new Ks(o,z):new ea(o,z);else if(S)throw new Error("Stencil cannot be set without depth");if(O.checkFramebufferStatus(O.FRAMEBUFFER)!==O.FRAMEBUFFER_COMPLETE)throw new Error(If)}destroy(){let o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){let _=this.depthAttachment.get();_&&o.deleteRenderbuffer(_)}o.deleteFramebuffer(this.framebuffer)}}class Mf{constructor(o){var u,_;if(this.gl=o,this.clearColor=new ec(this),this.clearDepth=new Jd(this),this.clearStencil=new Ug(this),this.colorMask=new am(this),this.depthMask=new lm(this),this.stencilMask=new cm(this),this.stencilFunc=new wa(this),this.stencilOp=new fs(this),this.stencilTest=new bf(this),this.depthRange=new vf(this),this.depthTest=new wf(this),this.depthFunc=new ph(this),this.blend=new ep(this),this.blendFunc=new tc(this),this.blendColor=new Jc(this),this.blendEquation=new yi(this),this.cullFace=new Tf(this),this.cullFaceSide=new tp(this),this.frontFace=new rp(this),this.program=new rc(this),this.activeTexture=new Ef(this),this.viewport=new Ah(this),this.bindFramebuffer=new ic(this),this.bindRenderbuffer=new eu(this),this.bindTexture=new um(this),this.bindVertexBuffer=new tu(this),this.bindElementBuffer=new nc(this),this.bindVertexArray=new ip(this),this.pixelStoreUnpack=new Cf(this),this.pixelStoreUnpackPremultiplyAlpha=new Si(this),this.pixelStoreUnpackFlipY=new Sf(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),_a(o)){this.HALF_FLOAT=o.HALF_FLOAT;let v=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=o.RGBA16F)!==null&&u!==void 0?u:v?.RGBA16F_EXT,this.RGB16F=(_=o.RGB16F)!==null&&_!==void 0?_:v?.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");let v=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=v?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new we(this,o,u)}createVertexBuffer(o,u,_){return new om(this,o,u,_)}createRenderbuffer(o,u,_){let v=this.gl,S=v.createRenderbuffer();return this.bindRenderbuffer.set(S),v.renderbufferStorage(v.RENDERBUFFER,o,u,_),this.bindRenderbuffer.set(null),S}createFramebuffer(o,u,_,v){return new sp(this,o,u,_,v)}clear({color:o,depth:u,stencil:_}){let v=this.gl,S=0;o&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),v.clear(S)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){s.bC(o.blendFunction,mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return _a(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var u;return _a(this.gl)?this.gl.deleteVertexArray(o):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}let ru;function mh(C,o,u,_,v){let S=C.context,O=C.transform,z=S.gl,V=C.useProgram("collisionBox"),H=[],Q=0,ne=0;for(let Le=0;Le<_.length;Le++){let Ne=_[Le],Ge=o.getTile(Ne).getBucket(u);if(!Ge)continue;let De=v?Ge.textCollisionBox:Ge.iconCollisionBox,Ze=Ge.collisionCircleArray;Ze.length>0&&(H.push({circleArray:Ze,circleOffset:ne,coord:Ne}),Q+=Ze.length/4,ne=Q),De&&V.draw(S,z.LINES,ti.disabled,vi.disabled,C.colorModeForRenderPass(),Fi.disabled,Gi(C.transform),C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ne),O.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,null,C.transform.zoom,null,null,De.collisionVertexBuffer)}if(!v||!H.length)return;let ie=C.useProgram("collisionCircle"),de=new s.bP;de.resize(4*Q),de._trim();let ge=0;for(let Le of H)for(let Ne=0;Ne<Le.circleArray.length/4;Ne++){let Ge=4*Ne,De=Le.circleArray[Ge+0],Ze=Le.circleArray[Ge+1],He=Le.circleArray[Ge+2],Xe=Le.circleArray[Ge+3];de.emplace(ge++,De,Ze,He,Xe,0),de.emplace(ge++,De,Ze,He,Xe,1),de.emplace(ge++,De,Ze,He,Xe,2),de.emplace(ge++,De,Ze,He,Xe,3)}(!ru||ru.length<2*Q)&&(ru=function(Le){let Ne=2*Le,Ge=new s.bR;Ge.resize(Ne),Ge._trim();for(let De=0;De<Ne;De++){let Ze=6*De;Ge.uint16[Ze+0]=4*De+0,Ge.uint16[Ze+1]=4*De+1,Ge.uint16[Ze+2]=4*De+2,Ge.uint16[Ze+3]=4*De+2,Ge.uint16[Ze+4]=4*De+3,Ge.uint16[Ze+5]=4*De+0}return Ge}(Q));let Pe=S.createIndexBuffer(ru,!0),Ie=S.createVertexBuffer(de,s.bQ.members,!0);for(let Le of H){let Ne=gn(C.transform);ie.draw(S,z.TRIANGLES,ti.disabled,vi.disabled,C.colorModeForRenderPass(),Fi.disabled,Ne,C.style.map.terrain&&C.style.map.terrain.getTerrainData(Le.coord),null,u.id,Ie,Pe,s.aG.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,C.transform.zoom,null,null,null)}Ie.destroy(),Pe.destroy()}let Pf=s.at(new Float32Array(16));function Rf(C,o,u,_,v,S){let{horizontalAlign:O,verticalAlign:z}=s.aB(C);return new s.P((-(O-.5)*o/v+_[0])*S,(-(z-.5)*u/v+_[1])*S)}function iu(C,o,u,_,v,S){let O=o.tileAnchorPoint.add(new s.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let z=_.mult(S);u||(z=z.rotate(-v));let V=O.add(z);return Mt(V.x,V.y,o.pitchedLabelPlaneMatrix,o.getElevation).point}if(u){let z=_i(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(C),V=Math.atan(z.y/z.x)+(z.x<0?Math.PI:0);return C.add(_.rotate(V))}return C.add(_)}function fl(C,o,u,_,v,S,O,z,V,H,Q,ne){let ie=C.text.placedSymbolArray,de=C.text.dynamicLayoutVertexArray,ge=C.icon.dynamicLayoutVertexArray,Pe={};de.clear();for(let Ie=0;Ie<ie.length;Ie++){let Le=ie.get(Ie),Ne=Le.hidden||!Le.crossTileID||C.allowVerticalPlacement&&!Le.placedOrientation?null:_[Le.crossTileID];if(Ne){let Ge=new s.P(Le.anchorX,Le.anchorY),De={getElevation:ne,width:v.width,height:v.height,pitchedLabelPlaneMatrix:S,pitchWithMap:u,transform:v,tileAnchorPoint:Ge,translation:H,unwrappedTileID:Q},Ze=u?pr(Ge.x,Ge.y,De):_i(Ge.x,Ge.y,De),He=ut(v.cameraToCenterDistance,Ze.signedDistanceFromCamera),Xe=s.ai(C.textSizeData,z,Le)*He/s.av;u&&(Xe*=C.tilePixelRatio/O);let{width:yt,height:At,anchor:Pt,textOffset:Ot,textBoxScale:Tt}=Ne,er=Rf(Pt,yt,At,Ot,Tt,Xe),Kt=v.getPitchedTextCorrection(Ge.x+H[0],Ge.y+H[1],Q),Ut=iu(Ze.point,De,o,er,-v.bearingInRadians,Kt),mt=C.allowVerticalPlacement&&Le.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let Nt=0;Nt<Le.numGlyphs;Nt++)s.ao(de,Ut,mt);V&&Le.associatedIconIndex>=0&&(Pe[Le.associatedIconIndex]={shiftedAnchor:Ut,angle:mt})}else Br(Le.numGlyphs,de)}if(V){ge.clear();let Ie=C.icon.placedSymbolArray;for(let Le=0;Le<Ie.length;Le++){let Ne=Ie.get(Le);if(Ne.hidden)Br(Ne.numGlyphs,ge);else{let Ge=Pe[Le];if(Ge)for(let De=0;De<Ne.numGlyphs;De++)s.ao(ge,Ge.shiftedAnchor,Ge.angle);else Br(Ne.numGlyphs,ge)}}C.icon.dynamicLayoutVertexBuffer.updateData(ge)}C.text.dynamicLayoutVertexBuffer.updateData(de)}function gh(C,o,u){return u.iconsInText&&o?"symbolTextAndIcon":C?"symbolSDF":"symbolIcon"}function nu(C,o,u,_,v,S,O,z,V,H,Q,ne,ie){let de=C.context,ge=de.gl,Pe=C.transform,Ie=z==="map",Le=V==="map",Ne=z!=="viewport"&&u.layout.get("symbol-placement")!=="point",Ge=Ie&&!Le&&!Ne,De=!u.layout.get("symbol-sort-key").isConstant(),Ze=!1,He=C.getDepthModeForSublayer(0,ti.ReadOnly),Xe=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),yt=[],At=Pe.getCircleRadiusCorrection();for(let Pt of _){let Ot=o.getTile(Pt),Tt=Ot.getBucket(u);if(!Tt)continue;let er=v?Tt.text:Tt.icon;if(!er||!er.segments.get().length||!er.hasVisibleVertices)continue;let Kt=er.programConfigurations.get(u.id),Ut=v||Tt.sdfIcons,mt=v?Tt.textSizeData:Tt.iconSizeData,Nt=Le||Pe.pitch!==0,Bi=C.useProgram(gh(Ut,v,Tt),Kt),$r=s.ag(mt,Pe.zoom),zi=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Pt),Zi,Ui,Wi,wi,m=[0,0],A=null;if(v)Ui=Ot.glyphAtlasTexture,Wi=ge.LINEAR,Zi=Ot.glyphAtlasTexture.size,Tt.iconsInText&&(m=Ot.imageAtlasTexture.size,A=Ot.imageAtlasTexture,wi=Nt||C.options.rotating||C.options.zooming||mt.kind==="composite"||mt.kind==="camera"?ge.LINEAR:ge.NEAREST);else{let nt=u.layout.get("icon-size").constantOr(0)!==1||Tt.iconsNeedLinear;Ui=Ot.imageAtlasTexture,Wi=Ut||C.options.rotating||C.options.zooming||nt||Nt?ge.LINEAR:ge.NEAREST,Zi=Ot.imageAtlasTexture.size}let b=s.aw(Ot,1,C.transform.zoom),E=dt(Ie,C.transform,b),M=s.K();s.aj(M,E);let B=it(Le,Ie,C.transform,b),F=s.ax(Pe,Ot,S,O),N=Pe.getProjectionData({overscaledTileID:Pt,applyGlobeMatrix:!ie,applyTerrainMatrix:!0}),W=Xe&&Tt.hasTextData(),ee=u.layout.get("icon-text-fit")!=="none"&&W&&Tt.hasIconData();if(Ne){let nt=C.style.map.terrain?(wt,at)=>C.style.map.terrain.getElevation(Pt,wt,at):null,It=u.layout.get("text-rotation-alignment")==="map";rr(Tt,C,v,E,M,Le,H,It,Pt.toUnwrapped(),Pe.width,Pe.height,F,nt)}let fe=v&&Xe||ee,Te=Ne||fe?Pf:Le?E:C.transform.clipSpaceToPixelsMatrix,qe=Ut&&u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Je;Je=Ut?Tt.iconsInText?yf(mt.kind,$r,Ge,Le,Ne,fe,C,Te,B,F,Zi,m,At):zr(mt.kind,$r,Ge,Le,Ne,fe,C,Te,B,F,v,Zi,0,At):Re(mt.kind,$r,Ge,Le,Ne,fe,C,Te,B,F,v,Zi,At);let je={program:Bi,buffers:er,uniformValues:Je,projectionData:N,atlasTexture:Ui,atlasTextureIcon:A,atlasInterpolation:Wi,atlasInterpolationIcon:wi,isSDF:Ut,hasHalo:qe};if(De&&Tt.canOverlap){Ze=!0;let nt=er.segments.get();for(let It of nt)yt.push({segments:new s.aG([It]),sortKey:It.sortKey,state:je,terrainData:zi})}else yt.push({segments:er.segments,sortKey:0,state:je,terrainData:zi})}Ze&&yt.sort((Pt,Ot)=>Pt.sortKey-Ot.sortKey);for(let Pt of yt){let Ot=Pt.state;if(de.activeTexture.set(ge.TEXTURE0),Ot.atlasTexture.bind(Ot.atlasInterpolation,ge.CLAMP_TO_EDGE),Ot.atlasTextureIcon&&(de.activeTexture.set(ge.TEXTURE1),Ot.atlasTextureIcon&&Ot.atlasTextureIcon.bind(Ot.atlasInterpolationIcon,ge.CLAMP_TO_EDGE)),Ot.isSDF){let Tt=Ot.uniformValues;Ot.hasHalo&&(Tt.u_is_halo=1,sc(Ot.buffers,Pt.segments,u,C,Ot.program,He,Q,ne,Tt,Ot.projectionData,Pt.terrainData)),Tt.u_is_halo=0}sc(Ot.buffers,Pt.segments,u,C,Ot.program,He,Q,ne,Ot.uniformValues,Ot.projectionData,Pt.terrainData)}}function sc(C,o,u,_,v,S,O,z,V,H,Q){let ne=_.context;v.draw(ne,ne.gl.TRIANGLES,S,O,z,Fi.backCCW,V,Q,H,u.id,C.layoutVertexBuffer,C.indexBuffer,o,u.paint,_.transform.zoom,C.programConfigurations.get(u.id),C.dynamicLayoutVertexBuffer,C.opacityVertexBuffer)}function oc(C,o,u,_,v){let S=C.context,O=S.gl,z=vi.disabled,V=new mn([O.ONE,O.ONE],s.b7.transparent,[!0,!0,!0,!0]),H=o.getBucket(u);if(!H)return;let Q=_.key,ne=u.heatmapFbos.get(Q);ne||(ne=op(S,o.tileSize,o.tileSize),u.heatmapFbos.set(Q,ne)),S.bindFramebuffer.set(ne.framebuffer),S.viewport.set([0,0,o.tileSize,o.tileSize]),S.clear({color:s.b7.transparent});let ie=H.programConfigurations.get(u.id),de=C.useProgram("heatmap",ie,!v),ge=C.transform.getProjectionData({overscaledTileID:o.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=C.style.map.terrain.getTerrainData(_);de.draw(S,O.TRIANGLES,ti.disabled,z,V,Fi.disabled,Ci(o,C.transform.zoom,u.paint.get("heatmap-intensity"),1),Pe,ge,u.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,u.paint,C.transform.zoom,ie)}function Ta(C,o,u,_,v){let S=C.context,O=S.gl,z=C.transform;S.setColorMode(C.colorModeForRenderPass());let V=Bf(S,o),H=u.key,Q=o.heatmapFbos.get(H);if(!Q)return;S.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,Q.colorAttachment.get()),S.activeTexture.set(O.TEXTURE1),V.bind(O.LINEAR,O.CLAMP_TO_EDGE);let ne=z.getProjectionData({overscaledTileID:u,applyTerrainMatrix:v,applyGlobeMatrix:!_});C.useProgram("heatmapTexture").draw(S,O.TRIANGLES,ti.disabled,vi.disabled,C.colorModeForRenderPass(),Fi.disabled,Pi(C,o,0,1),null,ne,o.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments,o.paint,z.zoom),Q.destroy(),o.heatmapFbos.delete(H)}function op(C,o,u){var _,v;let S=C.gl,O=S.createTexture();S.bindTexture(S.TEXTURE_2D,O),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);let z=(_=C.HALF_FLOAT)!==null&&_!==void 0?_:S.UNSIGNED_BYTE,V=(v=C.RGBA16F)!==null&&v!==void 0?v:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,V,o,u,0,S.RGBA,z,null);let H=C.createFramebuffer(o,u,!1,!1);return H.colorAttachment.set(O),H}function Bf(C,o){return o.colorRampTexture||(o.colorRampTexture=new be(C,o.colorRamp,C.gl.RGBA)),o.colorRampTexture}function ac(C,o,u,_,v){if(!u||!_||!_.imageAtlas)return;let S=_.imageAtlas.patternPositions,O=S[u.to.toString()],z=S[u.from.toString()];if(!O&&z&&(O=z),!z&&O&&(z=O),!O||!z){let V=v.getPaintProperty(o);O=S[V],z=S[V]}O&&z&&C.setConstantPatternPositions(O,z)}function Lf(C,o,u,_,v,S,O,z){let V=C.context.gl,H="fill-pattern",Q=u.paint.get(H),ne=Q&&Q.constantOr(1),ie=u.getCrossfadeParameters(),de,ge,Pe,Ie,Le,Ne=C.transform,Ge=u.paint.get("fill-translate"),De=u.paint.get("fill-translate-anchor");O?(ge=ne&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",de=V.LINES):(ge=ne?"fillPattern":"fill",de=V.TRIANGLES);let Ze=Q.constantOr(null);for(let He of _){let Xe=o.getTile(He);if(ne&&!Xe.patternsLoaded())continue;let yt=Xe.getBucket(u);if(!yt)continue;let At=yt.programConfigurations.get(u.id),Pt=C.useProgram(ge,At),Ot=C.style.map.terrain&&C.style.map.terrain.getTerrainData(He);ne&&(C.context.activeTexture.set(V.TEXTURE0),Xe.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),At.updatePaintBuffers(ie)),ac(At,H,Ze,Xe,u);let Tt=Ne.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),er=s.ax(Ne,Xe,Ge,De);if(O){Ie=yt.indexBuffer2,Le=yt.segments2;let Ut=[V.drawingBufferWidth,V.drawingBufferHeight];Pe=ge==="fillOutlinePattern"&&ne?ho(C,ie,Xe,Ut,er):Rn(Ut,er)}else Ie=yt.indexBuffer,Le=yt.segments,Pe=ne?Ce(C,ie,Xe,er):{u_fill_translate:er};let Kt;if(C.renderPass==="translucent"&&z){let[Ut]=C.getStencilConfigForOverlapAndUpdateStencilID(_);Kt=Ut[He.overscaledZ]}else Kt=C.stencilModeForClipping(He);Pt.draw(C.context,de,v,Kt,S,Fi.backCCW,Pe,Ot,Tt,u.id,yt.layoutVertexBuffer,Ie,Le,u.paint,C.transform.zoom,At)}}function Of(C,o,u,_,v,S,O,z){let V=C.context,H=V.gl,Q="fill-extrusion-pattern",ne=u.paint.get(Q),ie=ne.constantOr(1),de=u.getCrossfadeParameters(),ge=u.paint.get("fill-extrusion-opacity"),Pe=ne.constantOr(null),Ie=C.transform;for(let Le of _){let Ne=o.getTile(Le),Ge=Ne.getBucket(u);if(!Ge)continue;let De=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Le),Ze=Ge.programConfigurations.get(u.id),He=C.useProgram(ie?"fillExtrusionPattern":"fillExtrusion",Ze);ie&&(C.context.activeTexture.set(H.TEXTURE0),Ne.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Ze.updatePaintBuffers(de));let Xe=Ie.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!z,applyTerrainMatrix:!0});ac(Ze,Q,Pe,Ne,u);let yt=s.ax(Ie,Ne,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),At=u.paint.get("fill-extrusion-vertical-gradient"),Pt=ie?Mi(C,At,ge,yt,Le,de,Ne):Yi(C,At,ge,yt);He.draw(V,V.gl.TRIANGLES,v,S,O,Fi.backCCW,Pt,De,Xe,u.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,u.paint,C.transform.zoom,Ze,C.style.map.terrain&&Ge.centroidVertexBuffer)}}function _h(C,o,u,_,v,S,O,z,V){var H;let Q=C.style.projection,ne=C.context,ie=C.transform,de=ne.gl,ge=C.useProgram("hillshade"),Pe=!C.options.moving;for(let Ie of _){let Le=o.getTile(Ie),Ne=Le.fbo;if(!Ne)continue;let Ge=Q.getMeshFromTileID(ne,Ie.canonical,z,!0,"raster"),De=(H=C.style.map.terrain)===null||H===void 0?void 0:H.getTerrainData(Ie);ne.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_2D,Ne.colorAttachment.get());let Ze=ie.getProjectionData({overscaledTileID:Ie,aligned:Pe,applyGlobeMatrix:!V,applyTerrainMatrix:!0});ge.draw(ne,de.TRIANGLES,S,v[Ie.overscaledZ],O,Fi.backCCW,Kc(C,Le,u),De,Ze,u.id,Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)}}let su=[new s.P(0,0),new s.P(s.Z,0),new s.P(s.Z,s.Z),new s.P(0,s.Z)];function ou(C,o,u,_,v,S,O,z,V=!1,H=!1){let Q=_[_.length-1].overscaledZ,ne=C.context,ie=ne.gl,de=C.useProgram("raster"),ge=C.transform,Pe=C.style.projection,Ie=C.colorModeForRenderPass(),Le=!C.options.moving;for(let Ne of _){let Ge=C.getDepthModeForSublayer(Ne.overscaledZ-Q,u.paint.get("raster-opacity")===1?ti.ReadWrite:ti.ReadOnly,ie.LESS),De=o.getTile(Ne);De.registerFadeDuration(u.paint.get("raster-fade-duration"));let Ze=o.findLoadedParent(Ne,0),He=o.findLoadedSibling(Ne),Xe=Vg(De,Ze||He||null,o,u,C.transform,C.style.map.terrain),yt,At,Pt=u.paint.get("raster-resampling")==="nearest"?ie.NEAREST:ie.LINEAR;ne.activeTexture.set(ie.TEXTURE0),De.texture.bind(Pt,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),ne.activeTexture.set(ie.TEXTURE1),Ze?(Ze.texture.bind(Pt,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),yt=Math.pow(2,Ze.tileID.overscaledZ-De.tileID.overscaledZ),At=[De.tileID.canonical.x*yt%1,De.tileID.canonical.y*yt%1]):De.texture.bind(Pt,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),De.texture.useMipmap&&ne.extTextureFilterAnisotropic&&C.transform.pitch>20&&ie.texParameterf(ie.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax);let Ot=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ne),Tt=ge.getProjectionData({overscaledTileID:Ne,aligned:Le,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),er=Jl(At||[0,0],yt||1,Xe,u,z),Kt=Pe.getMeshFromTileID(ne,Ne.canonical,S,O,"raster");de.draw(ne,ie.TRIANGLES,Ge,v?v[Ne.overscaledZ]:vi.disabled,Ie,V?Fi.frontCCW:Fi.backCCW,er,Ot,Tt,u.id,Kt.vertexBuffer,Kt.indexBuffer,Kt.segments)}}function Vg(C,o,u,_,v,S){let O=_.paint.get("raster-fade-duration");if(!S&&O>0){let z=x.now(),V=(z-C.timeAdded)/O,H=o?(z-o.timeAdded)/O:-1,Q=u.getSource(),ne=zn(v,{tileSize:Q.tileSize,roundZoom:Q.roundZoom}),ie=!o||Math.abs(o.tileID.overscaledZ-ne)>Math.abs(C.tileID.overscaledZ-ne),de=ie&&C.refreshedUponExpiration?1:s.ae(ie?V:1-H,0,1);return C.refreshedUponExpiration&&V>=1&&(C.refreshedUponExpiration=!1),o?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}let hm=new s.b7(1,0,0,1),Un=new s.b7(0,1,0,1),lc=new s.b7(0,0,1,1),zo=new s.b7(1,0,1,1),ap=new s.b7(0,1,1,1);function cc(C,o,u,_){Ua(C,0,o+u/2,C.transform.width,u,_)}function lp(C,o,u,_){Ua(C,o-u/2,0,u,C.transform.height,_)}function Ua(C,o,u,_,v,S){let O=C.context,z=O.gl;z.enable(z.SCISSOR_TEST),z.scissor(o*C.pixelRatio,u*C.pixelRatio,_*C.pixelRatio,v*C.pixelRatio),O.clear({color:S}),z.disable(z.SCISSOR_TEST)}function yh(C,o,u){let _=C.context,v=_.gl,S=C.useProgram("debug"),O=ti.disabled,z=vi.disabled,V=C.colorModeForRenderPass(),H="$debug",Q=C.style.map.terrain&&C.style.map.terrain.getTerrainData(u);_.activeTexture.set(v.TEXTURE0);let ne=o.getTileByID(u.key).latestRawTileData,ie=Math.floor((ne&&ne.byteLength||0)/1024),de=o.getTile(u).tileSize,ge=512/Math.min(de,512)*(u.overscaledZ/C.transform.zoom)*.5,Pe=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Pe+=` => ${u.overscaledZ}`),function(Le,Ne){Le.initDebugOverlayCanvas();let Ge=Le.debugOverlayCanvas,De=Le.context.gl,Ze=Le.debugOverlayCanvas.getContext("2d");Ze.clearRect(0,0,Ge.width,Ge.height),Ze.shadowColor="white",Ze.shadowBlur=2,Ze.lineWidth=1.5,Ze.strokeStyle="white",Ze.textBaseline="top",Ze.font="bold 36px Open Sans, sans-serif",Ze.fillText(Ne,5,5),Ze.strokeText(Ne,5,5),Le.debugOverlayTexture.update(Ge),Le.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(C,`${Pe} ${ie}kB`);let Ie=C.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(_,v.TRIANGLES,O,z,mn.alphaBlended,Fi.disabled,Wn(s.b7.transparent,ge),null,Ie,H,C.debugBuffer,C.quadTriangleIndexBuffer,C.debugSegments),S.draw(_,v.LINE_STRIP,O,z,V,Fi.disabled,Wn(s.b7.red),Q,Ie,H,C.debugBuffer,C.tileBorderIndexBuffer,C.debugSegments)}function dl(C,o,u,_){let{isRenderingGlobe:v}=_,S=C.context,O=S.gl,z=C.transform,V=C.colorModeForRenderPass(),H=C.getDepthModeFor3D(),Q=C.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,C.width,C.height]);for(let ne of u){let ie=o.getTerrainMesh(ne.tileID),de=C.renderToTexture.getTexture(ne),ge=o.getTerrainData(ne.tileID);S.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,de.texture);let Pe=o.getMeshFrameDelta(z.zoom),Ie=z.calculateFogMatrix(ne.tileID.toUnwrapped()),Le=gt(Pe,Ie,C.style.sky,z.pitch,v),Ne=z.getProjectionData({overscaledTileID:ne.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Q.draw(S,O.TRIANGLES,H,vi.disabled,V,Fi.backCCW,Le,ge,Ne,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}}function cp(C,o){if(!o.mesh){let u=new s.aF;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);let _=new s.aH;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),o.mesh=new Xc(C.createVertexBuffer(u,Zl.members),C.createIndexBuffer(_),s.aG.simpleSegment(0,0,u.length,_.length))}return o.mesh}class Df{constructor(o,u){this.context=new Mf(o),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.at(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ae.maxUnderzooming+Ae.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wd}resize(o,u,_){if(this.width=Math.floor(o*_),this.height=Math.floor(u*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let v of this.style._order)this.style._layers[v].resize()}setup(){let o=this.context,u=new s.aF;u.emplaceBack(0,0),u.emplaceBack(s.Z,0),u.emplaceBack(0,s.Z),u.emplaceBack(s.Z,s.Z),this.tileExtentBuffer=o.createVertexBuffer(u,Zl.members),this.tileExtentSegments=s.aG.simpleSegment(0,0,4,2);let _=new s.aF;_.emplaceBack(0,0),_.emplaceBack(s.Z,0),_.emplaceBack(0,s.Z),_.emplaceBack(s.Z,s.Z),this.debugBuffer=o.createVertexBuffer(_,Zl.members),this.debugSegments=s.aG.simpleSegment(0,0,4,5);let v=new s.bW;v.emplaceBack(0,0,0,0),v.emplaceBack(s.Z,0,s.Z,0),v.emplaceBack(0,s.Z,0,s.Z),v.emplaceBack(s.Z,s.Z,s.Z,s.Z),this.rasterBoundsBuffer=o.createVertexBuffer(v,dh.members),this.rasterBoundsSegments=s.aG.simpleSegment(0,0,4,2);let S=new s.aF;S.emplaceBack(0,0),S.emplaceBack(s.Z,0),S.emplaceBack(0,s.Z),S.emplaceBack(s.Z,s.Z),this.rasterBoundsBufferPosOnly=o.createVertexBuffer(S,Zl.members),this.rasterBoundsSegmentsPosOnly=s.aG.simpleSegment(0,0,4,5);let O=new s.aF;O.emplaceBack(0,0),O.emplaceBack(1,0),O.emplaceBack(0,1),O.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(O,Zl.members),this.viewportSegments=s.aG.simpleSegment(0,0,4,2);let z=new s.bX;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(z);let V=new s.aH;V.emplaceBack(1,0,2),V.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(V);let H=this.context.gl;this.stencilClearMode=new vi({func:H.ALWAYS,mask:0},0,255,H.ZERO,H.ZERO,H.ZERO),this.tileExtentMesh=new Xc(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let _=s.K();s.bO(_,0,this.width,this.height,0,0,1),s.M(_,_,[u.drawingBufferWidth,u.drawingBufferHeight,0]);let v={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(o,u.TRIANGLES,ti.disabled,this.stencilClearMode,mn.disabled,Fi.disabled,null,null,v,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,u,_){if(this.currentStencilSource===o.source||!o.isTileClipped()||!u||!u.length)return;this.currentStencilSource=o.source,this.nextStencilID+u.length>256&&this.clearStencil();let v=this.context;v.setColorMode(mn.disabled),v.setDepthMode(ti.disabled);let S={};for(let O of u)S[O.key]=this.nextStencilID++;this._renderTileMasks(S,u,_,!0),this._renderTileMasks(S,u,_,!1),this._tileClippingMaskIDs=S}_renderTileMasks(o,u,_,v){let S=this.context,O=S.gl,z=this.style.projection,V=this.transform,H=this.useProgram("clippingMask");for(let Q of u){let ne=o[Q.key],ie=this.style.map.terrain&&this.style.map.terrain.getTerrainData(Q),de=z.getMeshFromTileID(this.context,Q.canonical,v,!0,"stencil"),ge=V.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!0,applyTerrainMatrix:!0});H.draw(S,O.TRIANGLES,ti.disabled,new vi({func:O.ALWAYS,mask:0},ne,255,O.KEEP,O.KEEP,O.REPLACE),mn.disabled,_?Fi.disabled:Fi.backCCW,null,ie,ge,"$clipping",de.vertexBuffer,de.indexBuffer,de.segments)}}_renderTilesDepthBuffer(){let o=this.context,u=o.gl,_=this.style.projection,v=this.transform,S=this.useProgram("depth"),O=this.getDepthModeFor3D(),z=ot(v,{tileSize:v.tileSize});for(let V of z){let H=this.style.map.terrain&&this.style.map.terrain.getTerrainData(V),Q=_.getMeshFromTileID(this.context,V.canonical,!0,!0,"raster"),ne=v.getProjectionData({overscaledTileID:V,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(o,u.TRIANGLES,O,vi.disabled,mn.disabled,Fi.backCCW,null,H,ne,"$clipping",Q.vertexBuffer,Q.indexBuffer,Q.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,u=this.context.gl;return new vi({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){let u=this.context.gl;return new vi({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(o){let u=this.context.gl,_=o.sort((O,z)=>z.overscaledZ-O.overscaledZ),v=_[_.length-1].overscaledZ,S=_[0].overscaledZ-v+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();let O={};for(let z=0;z<S;z++)O[z+v]=new vi({func:u.GEQUAL,mask:255},z+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=S,[O,_]}return[{[v]:vi.disabled},_]}stencilConfigForOverlapTwoPass(o){let u=this.context.gl,_=o.sort((O,z)=>z.overscaledZ-O.overscaledZ),v=_[_.length-1].overscaledZ,S=_[0].overscaledZ-v+1;if(this.clearStencil(),S>1){let O={},z={};for(let V=0;V<S;V++)O[V+v]=new vi({func:u.GREATER,mask:255},S+1+V,255,u.KEEP,u.KEEP,u.REPLACE),z[V+v]=new vi({func:u.GREATER,mask:255},1+V,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*S+1,[O,z,_]}return this.nextStencilID=3,[{[v]:new vi({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[v]:new vi({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},_]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new mn([o.CONSTANT_COLOR,o.ONE],new s.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mn.unblended:mn.alphaBlended}getDepthModeForSublayer(o,u,_){if(!this.opaquePassEnabledForLayer())return ti.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new ti(_||this.context.gl.LEQUAL,u,[v,v])}getDepthModeFor3D(){return new ti(this.context.gl.LEQUAL,ti.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){var _,v;this.style=o,this.options=u,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(x.now()),this.imageManager.beginFrame();let S=this.style._order,O=this.style.sourceCaches,z={},V={},H={},Q={isRenderingToTexture:!1,isRenderingGlobe:((_=o.projection)===null||_===void 0?void 0:_.transitionState)>0};for(let ie in O){let de=O[ie];de.used&&de.prepare(this.context),z[ie]=de.getVisibleCoordinates(!1),V[ie]=z[ie].slice().reverse(),H[ie]=de.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ie=0;ie<S.length;ie++)if(this.style._layers[S[ie]].is3D()){this.opaquePassCutoff=ie;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let ie of S){let de=this.style._layers[ie];if(!de.hasOffscreenPass()||de.isHidden(this.transform.zoom))continue;let ge=V[de.source];(de.type==="custom"||ge.length)&&this.renderLayer(this,O[de.source],de,ge,Q)}if((v=this.style.projection)===null||v===void 0||v.updateGPUdependent({context:this.context,useProgram:ie=>this.useProgram(ie)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?s.b7.black:s.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(ie,de){let ge=ie.context,Pe=ge.gl,Ie=((He,Xe,yt)=>{let At=Math.cos(Xe.rollInRadians),Pt=Math.sin(Xe.rollInRadians),Ot=ah(Xe),Tt=Xe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:He.properties.get("sky-color"),u_horizon_color:He.properties.get("horizon-color"),u_horizon:[(Xe.width/2-Ot*Pt)*yt,(Xe.height/2+Ot*At)*yt],u_horizon_normal:[-Pt,At],u_sky_horizon_blend:He.properties.get("sky-horizon-blend")*Xe.height/2*yt,u_sky_blend:Tt}})(de,ie.style.map.transform,ie.pixelRatio),Le=new ti(Pe.LEQUAL,ti.ReadWrite,[0,1]),Ne=vi.disabled,Ge=ie.colorModeForRenderPass(),De=ie.useProgram("sky"),Ze=cp(ge,de);De.draw(ge,Pe.TRIANGLES,Le,Ne,Ge,Fi.disabled,Ie,null,void 0,"sky",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)}(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){let ie=this.style._layers[S[this.currentLayer]],de=O[ie.source],ge=z[ie.source];this._renderTileClippingMasks(ie,ge,!1),this.renderLayer(this,de,ie,ge,Q)}this.renderPass="translucent";let ne=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){let ie=this.style._layers[S[this.currentLayer]],de=O[ie.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ie,Q))continue;this.opaquePassEnabledForLayer()||ne||(ne=!0,Q.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let ge=(ie.type==="symbol"?H:V)[ie.source];this._renderTileClippingMasks(ie,z[ie.source],!1),this.renderLayer(this,de,ie,ge,Q)}if(Q.isRenderingGlobe&&function(ie,de,ge){let Pe=ie.context,Ie=Pe.gl,Le=ie.useProgram("atmosphere"),Ne=new ti(Ie.LEQUAL,ti.ReadOnly,[0,1]),Ge=ie.transform,De=function(Tt,er){let Kt=Tt.properties.get("position"),Ut=[-Kt.x,-Kt.y,-Kt.z],mt=s.at(new Float64Array(16));return Tt.properties.get("anchor")==="map"&&(s.a_(mt,mt,er.rollInRadians),s.a$(mt,mt,-er.pitchInRadians),s.a_(mt,mt,er.bearingInRadians),s.a$(mt,mt,er.center.lat*Math.PI/180),s.bm(mt,mt,-er.center.lng*Math.PI/180)),s.bV(Ut,Ut,mt),Ut}(ge,ie.transform),Ze=Ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),He=de.properties.get("atmosphere-blend")*Ze.projectionTransition;if(He===0)return;let Xe=Xd(Ge.worldSize,Ge.center.lat),yt=Ge.inverseProjectionMatrix,At=new Float64Array(4);At[3]=1,s.ap(At,At,Ge.modelViewProjectionMatrix),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1,s.ap(At,At,yt),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1;let Pt=((Tt,er,Kt,Ut,mt)=>({u_sun_pos:Tt,u_atmosphere_blend:er,u_globe_position:Kt,u_globe_radius:Ut,u_inv_proj_matrix:mt}))(De,He,[At[0],At[1],At[2]],Xe,yt),Ot=cp(Pe,de);Le.draw(Pe,Ie.TRIANGLES,Ne,vi.disabled,mn.alphaBlended,Fi.disabled,Pt,null,null,"atmosphere",Ot.vertexBuffer,Ot.indexBuffer,Ot.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let ie=function(de,ge){let Pe=null,Ie=Object.values(de._layers).flatMap(De=>De.source&&!De.isHidden(ge)?[de.sourceCaches[De.source]]:[]),Le=Ie.filter(De=>De.getSource().type==="vector"),Ne=Ie.filter(De=>De.getSource().type!=="vector"),Ge=De=>{(!Pe||Pe.getSource().maxzoom<De.getSource().maxzoom)&&(Pe=De)};return Le.forEach(De=>Ge(De)),Pe||Ne.forEach(De=>Ge(De)),Pe}(this.style,this.transform.zoom);ie&&function(de,ge,Pe){for(let Ie=0;Ie<Pe.length;Ie++)yh(de,ge,Pe[Ie])}(this,ie,ie.getVisibleCoordinates())}this.options.showPadding&&function(ie){let de=ie.transform.padding;cc(ie,ie.transform.height-(de.top||0),3,hm),cc(ie,de.bottom||0,3,Un),lp(ie,de.left||0,3,lc),lp(ie,ie.transform.width-(de.right||0),3,zo);let ge=ie.transform.centerPoint;(function(Pe,Ie,Le,Ne){Ua(Pe,Ie-1,Le-10,2,20,Ne),Ua(Pe,Ie-10,Le-1,20,2,Ne)})(ie,ge.x,ie.transform.height-ge.y,ap)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;let u=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix,v=this.terrainFacilitator.dirty;v||(v=o?!s.bY(u,_):!s.bZ(u,_)),v||(v=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),v&&(s.b_(u,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,O){let z=S.context,V=z.gl,H=S.transform,Q=mn.unblended,ne=new ti(V.LEQUAL,ti.ReadWrite,[0,1]),ie=O.sourceCache.getRenderableTiles(),de=S.useProgram("terrainDepth");z.bindFramebuffer.set(O.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),z.clear({color:s.b7.transparent,depth:1});for(let ge of ie){let Pe=O.getTerrainMesh(ge.tileID),Ie=O.getTerrainData(ge.tileID),Le=H.getProjectionData({overscaledTileID:ge.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ne={u_ele_delta:O.getMeshFrameDelta(H.zoom)};de.draw(z,V.TRIANGLES,ne,vi.disabled,Q,Fi.backCCW,Ne,Ie,Le,"terrain",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,O){let z=S.context,V=z.gl,H=S.transform,Q=mn.unblended,ne=new ti(V.LEQUAL,ti.ReadWrite,[0,1]),ie=O.getCoordsTexture(),de=O.sourceCache.getRenderableTiles(),ge=S.useProgram("terrainCoords");z.bindFramebuffer.set(O.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),z.clear({color:s.b7.transparent,depth:1}),O.coordsIndex=[];for(let Pe of de){let Ie=O.getTerrainMesh(Pe.tileID),Le=O.getTerrainData(Pe.tileID);z.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,ie.texture);let Ne={u_terrain_coords_id:(255-O.coordsIndex.length)/255,u_texture:0,u_ele_delta:O.getMeshFrameDelta(H.zoom)},Ge=H.getProjectionData({overscaledTileID:Pe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ge.draw(z,V.TRIANGLES,ne,vi.disabled,Q,Fi.backCCW,Ne,Le,Ge,"terrain",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments),O.coordsIndex.push(Pe.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}renderLayer(o,u,_,v,S){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(v||[]).length)&&(this.id=_.id,s.b$(_)?function(O,z,V,H,Q,ne){if(O.renderPass!=="translucent")return;let{isRenderingToTexture:ie}=ne,de=vi.disabled,ge=O.colorModeForRenderPass();(V._unevaluatedLayout.hasValue("text-variable-anchor")||V._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Pe,Ie,Le,Ne,Ge,De,Ze,He,Xe){let yt=Ie.transform,At=Ie.style.map.terrain,Pt=Ge==="map",Ot=De==="map";for(let Tt of Pe){let er=Ne.getTile(Tt),Kt=er.getBucket(Le);if(!Kt||!Kt.text||!Kt.text.segments.get().length)continue;let Ut=s.ag(Kt.textSizeData,yt.zoom),mt=s.aw(er,1,Ie.transform.zoom),Nt=dt(Pt,Ie.transform,mt),Bi=Le.layout.get("icon-text-fit")!=="none"&&Kt.hasIconData();if(Ut){let $r=Math.pow(2,yt.zoom-er.tileID.overscaledZ),zi=At?(Zi,Ui)=>At.getElevation(Tt,Zi,Ui):null;fl(Kt,Pt,Ot,Xe,yt,Nt,$r,Ut,Bi,s.ax(yt,er,Ze,He),Tt.toUnwrapped(),zi)}}}(H,O,V,z,V.layout.get("text-rotation-alignment"),V.layout.get("text-pitch-alignment"),V.paint.get("text-translate"),V.paint.get("text-translate-anchor"),Q),V.paint.get("icon-opacity").constantOr(1)!==0&&nu(O,z,V,H,!1,V.paint.get("icon-translate"),V.paint.get("icon-translate-anchor"),V.layout.get("icon-rotation-alignment"),V.layout.get("icon-pitch-alignment"),V.layout.get("icon-keep-upright"),de,ge,ie),V.paint.get("text-opacity").constantOr(1)!==0&&nu(O,z,V,H,!0,V.paint.get("text-translate"),V.paint.get("text-translate-anchor"),V.layout.get("text-rotation-alignment"),V.layout.get("text-pitch-alignment"),V.layout.get("text-keep-upright"),de,ge,ie),z.map.showCollisionBoxes&&(mh(O,z,V,H,!0),mh(O,z,V,H,!1))}(o,u,_,v,this.style.placement.variableOffsets,S):s.c0(_)?function(O,z,V,H,Q){if(O.renderPass!=="translucent")return;let{isRenderingToTexture:ne}=Q,ie=V.paint.get("circle-opacity"),de=V.paint.get("circle-stroke-width"),ge=V.paint.get("circle-stroke-opacity"),Pe=!V.layout.get("circle-sort-key").isConstant();if(ie.constantOr(1)===0&&(de.constantOr(1)===0||ge.constantOr(1)===0))return;let Ie=O.context,Le=Ie.gl,Ne=O.transform,Ge=O.getDepthModeForSublayer(0,ti.ReadOnly),De=vi.disabled,Ze=O.colorModeForRenderPass(),He=[],Xe=Ne.getCircleRadiusCorrection();for(let yt=0;yt<H.length;yt++){let At=H[yt],Pt=z.getTile(At),Ot=Pt.getBucket(V);if(!Ot)continue;let Tt=V.paint.get("circle-translate"),er=V.paint.get("circle-translate-anchor"),Kt=s.ax(Ne,Pt,Tt,er),Ut=Ot.programConfigurations.get(V.id),mt=O.useProgram("circle",Ut),Nt=Ot.layoutVertexBuffer,Bi=Ot.indexBuffer,$r=O.style.map.terrain&&O.style.map.terrain.getTerrainData(At),zi={programConfiguration:Ut,program:mt,layoutVertexBuffer:Nt,indexBuffer:Bi,uniformValues:ts(O,Pt,V,Kt,Xe),terrainData:$r,projectionData:Ne.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!ne,applyTerrainMatrix:!0})};if(Pe){let Zi=Ot.segments.get();for(let Ui of Zi)He.push({segments:new s.aG([Ui]),sortKey:Ui.sortKey,state:zi})}else He.push({segments:Ot.segments,sortKey:0,state:zi})}Pe&&He.sort((yt,At)=>yt.sortKey-At.sortKey);for(let yt of He){let{programConfiguration:At,program:Pt,layoutVertexBuffer:Ot,indexBuffer:Tt,uniformValues:er,terrainData:Kt,projectionData:Ut}=yt.state;Pt.draw(Ie,Le.TRIANGLES,Ge,De,Ze,Fi.backCCW,er,Kt,Ut,V.id,Ot,Tt,yt.segments,V.paint,O.transform.zoom,At)}}(o,u,_,v,S):s.c1(_)?function(O,z,V,H,Q){if(V.paint.get("heatmap-opacity")===0)return;let ne=O.context,{isRenderingToTexture:ie,isRenderingGlobe:de}=Q;if(O.style.map.terrain){for(let ge of H){let Pe=z.getTile(ge);z.hasRenderableParent(ge)||(O.renderPass==="offscreen"?oc(O,Pe,V,ge,de):O.renderPass==="translucent"&&Ta(O,V,ge,ie,de))}ne.viewport.set([0,0,O.width,O.height])}else O.renderPass==="offscreen"?function(ge,Pe,Ie,Le){let Ne=ge.context,Ge=Ne.gl,De=ge.transform,Ze=vi.disabled,He=new mn([Ge.ONE,Ge.ONE],s.b7.transparent,[!0,!0,!0,!0]);(function(Xe,yt,At){let Pt=Xe.gl;Xe.activeTexture.set(Pt.TEXTURE1),Xe.viewport.set([0,0,yt.width/4,yt.height/4]);let Ot=At.heatmapFbos.get(s.bS);Ot?(Pt.bindTexture(Pt.TEXTURE_2D,Ot.colorAttachment.get()),Xe.bindFramebuffer.set(Ot.framebuffer)):(Ot=op(Xe,yt.width/4,yt.height/4),At.heatmapFbos.set(s.bS,Ot))})(Ne,ge,Ie),Ne.clear({color:s.b7.transparent});for(let Xe=0;Xe<Le.length;Xe++){let yt=Le[Xe];if(Pe.hasRenderableParent(yt))continue;let At=Pe.getTile(yt),Pt=At.getBucket(Ie);if(!Pt)continue;let Ot=Pt.programConfigurations.get(Ie.id),Tt=ge.useProgram("heatmap",Ot),er=De.getProjectionData({overscaledTileID:yt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Kt=De.getCircleRadiusCorrection();Tt.draw(Ne,Ge.TRIANGLES,ti.disabled,Ze,He,Fi.backCCW,Ci(At,De.zoom,Ie.paint.get("heatmap-intensity"),Kt),null,er,Ie.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,Ie.paint,De.zoom,Ot)}Ne.viewport.set([0,0,ge.width,ge.height])}(O,z,V,H):O.renderPass==="translucent"&&function(ge,Pe){let Ie=ge.context,Le=Ie.gl;Ie.setColorMode(ge.colorModeForRenderPass());let Ne=Pe.heatmapFbos.get(s.bS);Ne&&(Ie.activeTexture.set(Le.TEXTURE0),Le.bindTexture(Le.TEXTURE_2D,Ne.colorAttachment.get()),Ie.activeTexture.set(Le.TEXTURE1),Bf(Ie,Pe).bind(Le.LINEAR,Le.CLAMP_TO_EDGE),ge.useProgram("heatmapTexture").draw(Ie,Le.TRIANGLES,ti.disabled,vi.disabled,ge.colorModeForRenderPass(),Fi.disabled,Pi(ge,Pe,0,1),null,null,Pe.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments,Pe.paint,ge.transform.zoom))}(O,V)}(o,u,_,v,S):s.c2(_)?function(O,z,V,H,Q){if(O.renderPass!=="translucent")return;let{isRenderingToTexture:ne}=Q,ie=V.paint.get("line-opacity"),de=V.paint.get("line-width");if(ie.constantOr(1)===0||de.constantOr(1)===0)return;let ge=O.getDepthModeForSublayer(0,ti.ReadOnly),Pe=O.colorModeForRenderPass(),Ie=V.paint.get("line-dasharray"),Le=V.paint.get("line-pattern"),Ne=Le.constantOr(1),Ge=V.paint.get("line-gradient"),De=V.getCrossfadeParameters(),Ze=Ne?"linePattern":Ie?"lineSDF":Ge?"lineGradient":"line",He=O.context,Xe=He.gl,yt=O.transform,At=!0;for(let Pt of H){let Ot=z.getTile(Pt);if(Ne&&!Ot.patternsLoaded())continue;let Tt=Ot.getBucket(V);if(!Tt)continue;let er=Tt.programConfigurations.get(V.id),Kt=O.context.program.get(),Ut=O.useProgram(Ze,er),mt=At||Ut.program!==Kt,Nt=O.style.map.terrain&&O.style.map.terrain.getTerrainData(Pt),Bi=Le.constantOr(null);if(Bi&&Ot.imageAtlas){let Wi=Ot.imageAtlas,wi=Wi.patternPositions[Bi.to.toString()],m=Wi.patternPositions[Bi.from.toString()];wi&&m&&er.setConstantPatternPositions(wi,m)}let $r=yt.getProjectionData({overscaledTileID:Pt,applyGlobeMatrix:!ne,applyTerrainMatrix:!0}),zi=yt.getPixelScale(),Zi=Ne?xa(O,Ot,V,zi,De):Ie?ba(O,Ot,V,zi,Ie,De):Ge?Po(O,Ot,V,zi,Tt.lineClipsArray.length):Qc(O,Ot,V,zi);if(Ne)He.activeTexture.set(Xe.TEXTURE0),Ot.imageAtlasTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),er.updatePaintBuffers(De);else if(Ie&&(mt||O.lineAtlas.dirty))He.activeTexture.set(Xe.TEXTURE0),O.lineAtlas.bind(He);else if(Ge){let Wi=Tt.gradients[V.id],wi=Wi.texture;if(V.gradientVersion!==Wi.version){let m=256;if(V.stepInterpolant){let A=z.getSource().maxzoom,b=Pt.canonical.z===A?Math.ceil(1<<O.transform.maxZoom-Pt.canonical.z):1;m=s.ae(s.bT(Tt.maxLineLength/s.Z*1024*b),256,He.maxTextureSize)}Wi.gradient=s.bU({expression:V.gradientExpression(),evaluationKey:"lineProgress",resolution:m,image:Wi.gradient||void 0,clips:Tt.lineClipsArray}),Wi.texture?Wi.texture.update(Wi.gradient):Wi.texture=new be(He,Wi.gradient,Xe.RGBA),Wi.version=V.gradientVersion,wi=Wi.texture}He.activeTexture.set(Xe.TEXTURE0),wi.bind(V.stepInterpolant?Xe.NEAREST:Xe.LINEAR,Xe.CLAMP_TO_EDGE)}let Ui;if(ne){let[Wi]=O.getStencilConfigForOverlapAndUpdateStencilID(H);Ui=Wi[Pt.overscaledZ]}else Ui=O.stencilModeForClipping(Pt);Ut.draw(He,Xe.TRIANGLES,ge,Ui,Pe,Fi.disabled,Zi,Nt,$r,V.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,V.paint,O.transform.zoom,er,Tt.layoutVertexBuffer2),At=!1}}(o,u,_,v,S):s.c3(_)?function(O,z,V,H,Q){let ne=V.paint.get("fill-color"),ie=V.paint.get("fill-opacity");if(ie.constantOr(1)===0)return;let{isRenderingToTexture:de}=Q,ge=O.colorModeForRenderPass(),Pe=V.paint.get("fill-pattern"),Ie=O.opaquePassEnabledForLayer()&&!Pe.constantOr(1)&&ne.constantOr(s.b7.transparent).a===1&&ie.constantOr(0)===1?"opaque":"translucent";if(O.renderPass===Ie){let Le=O.getDepthModeForSublayer(1,O.renderPass==="opaque"?ti.ReadWrite:ti.ReadOnly);Lf(O,z,V,H,Le,ge,!1,de)}if(O.renderPass==="translucent"&&V.paint.get("fill-antialias")){let Le=O.getDepthModeForSublayer(V.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);Lf(O,z,V,H,Le,ge,!0,de)}}(o,u,_,v,S):s.c4(_)?function(O,z,V,H,Q){let ne=V.paint.get("fill-extrusion-opacity");if(ne===0)return;let{isRenderingToTexture:ie}=Q;if(O.renderPass==="translucent"){let de=new ti(O.context.gl.LEQUAL,ti.ReadWrite,O.depthRangeFor3D);if(ne!==1||V.paint.get("fill-extrusion-pattern").constantOr(1))Of(O,z,V,H,de,vi.disabled,mn.disabled,ie),Of(O,z,V,H,de,O.stencilModeFor3D(),O.colorModeForRenderPass(),ie);else{let ge=O.colorModeForRenderPass();Of(O,z,V,H,de,vi.disabled,ge,ie)}}}(o,u,_,v,S):s.c5(_)?function(O,z,V,H,Q){if(O.renderPass!=="offscreen"&&O.renderPass!=="translucent")return;let{isRenderingToTexture:ne}=Q,ie=O.context,de=O.style.projection.useSubdivision,ge=O.getDepthModeForSublayer(0,ti.ReadOnly),Pe=O.colorModeForRenderPass();if(O.renderPass==="offscreen")(function(Ie,Le,Ne,Ge,De,Ze,He){let Xe=Ie.context,yt=Xe.gl;for(let At of Ne){let Pt=Le.getTile(At),Ot=Pt.dem;if(!Ot||!Ot.data||!Pt.needsHillshadePrepare)continue;let Tt=Ot.dim,er=Ot.stride,Kt=Ot.getPixels();if(Xe.activeTexture.set(yt.TEXTURE1),Xe.pixelStoreUnpackPremultiplyAlpha.set(!1),Pt.demTexture=Pt.demTexture||Ie.getTileTexture(er),Pt.demTexture){let mt=Pt.demTexture;mt.update(Kt,{premultiply:!1}),mt.bind(yt.NEAREST,yt.CLAMP_TO_EDGE)}else Pt.demTexture=new be(Xe,Kt,yt.RGBA,{premultiply:!1}),Pt.demTexture.bind(yt.NEAREST,yt.CLAMP_TO_EDGE);Xe.activeTexture.set(yt.TEXTURE0);let Ut=Pt.fbo;if(!Ut){let mt=new be(Xe,{width:Tt,height:Tt,data:null},yt.RGBA);mt.bind(yt.LINEAR,yt.CLAMP_TO_EDGE),Ut=Pt.fbo=Xe.createFramebuffer(Tt,Tt,!0,!1),Ut.colorAttachment.set(mt.texture)}Xe.bindFramebuffer.set(Ut.framebuffer),Xe.viewport.set([0,0,Tt,Tt]),Ie.useProgram("hillshadePrepare").draw(Xe,yt.TRIANGLES,De,Ze,He,Fi.disabled,im(Pt.tileID,Ot),null,null,Ge.id,Ie.rasterBoundsBuffer,Ie.quadTriangleIndexBuffer,Ie.rasterBoundsSegments),Pt.needsHillshadePrepare=!1}})(O,z,H,V,ge,vi.disabled,Pe),ie.viewport.set([0,0,O.width,O.height]);else if(O.renderPass==="translucent")if(de){let[Ie,Le,Ne]=O.stencilConfigForOverlapTwoPass(H);_h(O,z,V,Ne,Ie,ge,Pe,!1,ne),_h(O,z,V,Ne,Le,ge,Pe,!0,ne)}else{let[Ie,Le]=O.getStencilConfigForOverlapAndUpdateStencilID(H);_h(O,z,V,Le,Ie,ge,Pe,!1,ne)}}(o,u,_,v,S):s.c6(_)?function(O,z,V,H,Q){if(O.renderPass!=="translucent"||V.paint.get("raster-opacity")===0||!H.length)return;let{isRenderingToTexture:ne}=Q,ie=z.getSource(),de=O.style.projection.useSubdivision;if(ie instanceof ls)ou(O,z,V,H,null,!1,!1,ie.tileCoords,ie.flippedWindingOrder,ne);else if(de){let[ge,Pe,Ie]=O.stencilConfigForOverlapTwoPass(H);ou(O,z,V,Ie,ge,!1,!0,su,!1,ne),ou(O,z,V,Ie,Pe,!0,!0,su,!1,ne)}else{let[ge,Pe]=O.getStencilConfigForOverlapAndUpdateStencilID(H);ou(O,z,V,Pe,ge,!1,!0,su,!1,ne)}}(o,u,_,v,S):s.c7(_)?function(O,z,V,H,Q){let ne=V.paint.get("background-color"),ie=V.paint.get("background-opacity");if(ie===0)return;let{isRenderingToTexture:de}=Q,ge=O.context,Pe=ge.gl,Ie=O.style.projection,Le=O.transform,Ne=Le.tileSize,Ge=V.paint.get("background-pattern");if(O.isPatternMissing(Ge))return;let De=!Ge&&ne.a===1&&ie===1&&O.opaquePassEnabledForLayer()?"opaque":"translucent";if(O.renderPass!==De)return;let Ze=vi.disabled,He=O.getDepthModeForSublayer(0,De==="opaque"?ti.ReadWrite:ti.ReadOnly),Xe=O.colorModeForRenderPass(),yt=O.useProgram(Ge?"backgroundPattern":"background"),At=H||ot(Le,{tileSize:Ne,terrain:O.style.map.terrain});Ge&&(ge.activeTexture.set(Pe.TEXTURE0),O.imageManager.bind(O.context));let Pt=V.getCrossfadeParameters();for(let Ot of At){let Tt=Le.getProjectionData({overscaledTileID:Ot,applyGlobeMatrix:!de,applyTerrainMatrix:!0}),er=Ge?xf(ie,O,Ge,{tileID:Ot,tileSize:Ne},Pt):sm(ie,ne),Kt=O.style.map.terrain&&O.style.map.terrain.getTerrainData(Ot),Ut=Ie.getMeshFromTileID(ge,Ot.canonical,!1,!0,"raster");yt.draw(ge,Pe.TRIANGLES,He,Ze,Xe,Fi.backCCW,er,Kt,Tt,V.id,Ut.vertexBuffer,Ut.indexBuffer,Ut.segments)}}(o,0,_,v,S):s.c8(_)&&function(O,z,V,H){let{isRenderingGlobe:Q}=H,ne=O.context,ie=V.implementation,de=O.style.projection,ge=O.transform,Pe=ge.getProjectionDataForCustomLayer(Q),Ie={farZ:ge.farZ,nearZ:ge.nearZ,fov:ge.fov*Math.PI/180,modelViewProjectionMatrix:ge.modelViewProjectionMatrix,projectionMatrix:ge.projectionMatrix,shaderData:{variantName:de.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${de.shaderPreludeCode.vertexSource}`,define:de.shaderDefine},defaultProjectionData:Pe},Le=ie.renderingMode?ie.renderingMode:"2d";if(O.renderPass==="offscreen"){let Ne=ie.prerender;Ne&&(O.setCustomLayerDefaults(),ne.setColorMode(O.colorModeForRenderPass()),Ne.call(ie,ne.gl,Ie),ne.setDirty(),O.setBaseState())}else if(O.renderPass==="translucent"){O.setCustomLayerDefaults(),ne.setColorMode(O.colorModeForRenderPass()),ne.setStencilMode(vi.disabled);let Ne=Le==="3d"?O.getDepthModeFor3D():O.getDepthModeForSublayer(0,ti.ReadOnly);ne.setDepthMode(Ne),ie.render(ne.gl,Ie),ne.setDirty(),O.setBaseState(),ne.bindFramebuffer.set(null)}}(o,0,_,S))}saveTileTexture(o){let u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){let u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;let u=this.imageManager.getPattern(o.from.toString()),_=this.imageManager.getPattern(o.to.toString());return!u||!_}useProgram(o,u,_=!1){this.cache=this.cache||{};let v=!!this.style.map.terrain,S=this.style.projection,O=o+(u?u.cacheKey:"")+`/${_?oh:S.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(v?"/terrain":"");return this.cache[O]||(this.cache[O]=new Dr(this.context,ga[o],u,Kd[o],this._showOverdrawInspector,v,_?ga.projectionMercator:S.shaderPreludeCode,_?cl:S.shaderDefine)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new be(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:o,drawingBufferHeight:u}=this.context.gl;return this.width!==o||this.height!==u}}function Ff(C,o){let u,_=!1,v=null,S=null,O=()=>{v=null,_&&(C.apply(S,u),v=setTimeout(O,o),_=!1)};return(...z)=>(_=!0,S=this,u=z,v||O(),v)}class pl{constructor(o){this._getCurrentHash=()=>{let u=window.location.hash.replace("#","");if(this._hashName){let _;return u.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(_=v)}),(_&&_[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{let u=this._getCurrentHash();if(!this._isValidHash(u))return!1;let _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{let u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{let u=this._getCurrentHash();if(u.length===0)return;let _=u.join("/"),v=_;v.split("&").length>0&&(v=v.split("&")[0]),this._hashName&&(v=`${this._hashName}=${_}`);let S=window.location.hash.replace(v,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let O=window.location.href.replace(/(#.+)?$/,S);O=O.replace("&&","&"),window.history.replaceState(window.history.state,null,O)},this._updateHash=Ff(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){let u=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,v),O=Math.round(u.lng*S)/S,z=Math.round(u.lat*S)/S,V=this._map.getBearing(),H=this._map.getPitch(),Q="";if(Q+=o?`/${O}/${z}/${_}`:`${_}/${z}/${O}`,(V||H)&&(Q+="/"+Math.round(10*V)/10),H&&(Q+=`/${Math.round(H)}`),this._hashName){let ne=this._hashName,ie=!1,de=window.location.hash.slice(1).split("&").map(ge=>{let Pe=ge.split("=")[0];return Pe===ne?(ie=!0,`${Pe}=${Q}`):ge}).filter(ge=>ge);return ie||de.push(`${ne}=${Q}`),`#${de.join("&")}`}return`#${Q}`}_isValidHash(o){if(o.length<3||o.some(isNaN))return!1;try{new s.Q(+o[2],+o[1])}catch{return!1}let u=+o[0],_=+(o[3]||0),v=+(o[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&_>=-180&&_<=180&&v>=this._map.getMinPitch()&&v<=this._map.getMaxPitch()}}let au={linearity:.3,easing:s.c9(0,0,.3,1)},Va=s.e({deceleration:2500,maxSpeed:1400},au),up=s.e({deceleration:20,maxSpeed:1400},au),fm=s.e({deceleration:1e3,maxSpeed:360},au),hp=s.e({deceleration:1e3,maxSpeed:90},au),kf=s.e({deceleration:1e3,maxSpeed:360},au);class Nf{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:x.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,u=x.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let u={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:S}of this._inertiaBuffer)u.zoom+=S.zoomDelta||0,u.bearing+=S.bearingDelta||0,u.pitch+=S.pitchDelta||0,u.roll+=S.rollDelta||0,S.panDelta&&u.pan._add(S.panDelta),S.around&&(u.around=S.around),S.pinchAround&&(u.pinchAround=S.pinchAround);let _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){let S=Hi(u.pan.mag(),_,s.e({},Va,o||{})),O=u.pan.mult(S.amount/u.pan.mag()),z=this._map.cameraHelper.handlePanInertia(O,this._map.transform);v.center=z.easingCenter,v.offset=z.easingOffset,ja(v,S)}if(u.zoom){let S=Hi(u.zoom,_,up);v.zoom=this._map.transform.zoom+S.amount,ja(v,S)}if(u.bearing){let S=Hi(u.bearing,_,fm);v.bearing=this._map.transform.bearing+s.ae(S.amount,-179,179),ja(v,S)}if(u.pitch){let S=Hi(u.pitch,_,hp);v.pitch=this._map.transform.pitch+S.amount,ja(v,S)}if(u.roll){let S=Hi(u.roll,_,kf);v.roll=this._map.transform.roll+s.ae(S.amount,-179,179),ja(v,S)}if(v.zoom||v.bearing){let S=u.pinchAround===void 0?u.around:u.pinchAround;v.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),s.e(v,{noMoveStart:!0})}}function ja(C,o){(!C.duration||C.duration<o.duration)&&(C.duration=o.duration,C.easing=o.easing)}function Hi(C,o,u){let{maxSpeed:_,linearity:v,deceleration:S}=u,O=s.ae(C*v/(o/1e3),-_,_),z=Math.abs(O)/(S*v);return{easing:u.easing,duration:1e3*z,amount:O*(z/2)}}class ks extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,_,v={}){_=_ instanceof MouseEvent?_:new MouseEvent(o,_);let S=T.mousePos(u.getCanvas(),_),O=u.unproject(S);super(o,s.e({point:S,lngLat:O,originalEvent:_},v)),this._defaultPrevented=!1,this.target=u}}class lu extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,_){let v=o==="touchend"?_.changedTouches:_.touches,S=T.touchPos(u.getCanvasContainer(),v),O=S.map(V=>u.unproject(V)),z=S.reduce((V,H,Q,ne)=>V.add(H.div(ne.length)),new s.P(0,0));super(o,{points:S,point:z,lngLats:O,lngLat:u.unproject(z),originalEvent:_}),this._defaultPrevented=!1}}class Uo extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,_){super(o,{originalEvent:_}),this._defaultPrevented=!1}}class Ea{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Uo(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new ks(o.type,this._map,o))}mouseup(o){this._map.fire(new ks(o.type,this._map,o))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new ks(o.type,this._map,o))}dblclick(o){return this._firePreventable(new ks(o.type,this._map,o))}mouseover(o){this._map.fire(new ks(o.type,this._map,o))}mouseout(o){this._map.fire(new ks(o.type,this._map,o))}touchstart(o){return this._firePreventable(new lu(o.type,this._map,o))}touchmove(o){this._map.fire(new lu(o.type,this._map,o))}touchend(o){this._map.fire(new lu(o.type,this._map,o))}touchcancel(o){this._map.fire(new lu(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dm{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new ks(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ks("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new ks(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fo{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.screenPointToLocation(s.P.convert(o),this._map.terrain)}}class uc{constructor(o,u){this._map=o,this._tr=new fo(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&o.button===0&&(T.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;let _=u;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;let v=this._startPos;this._lastPos=_,this._box||(this._box=T.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));let S=Math.min(v.x,_.x),O=Math.max(v.x,_.x),z=Math.min(v.y,_.y),V=Math.max(v.y,_.y);T.setTransform(this._box,`translate(${S}px,${z}px)`),this._box.style.width=O-S+"px",this._box.style.height=V-z+"px"}mouseupWindow(o,u){if(!this._active||o.button!==0)return;let _=this._startPos,v=u;if(this.reset(),T.suppressClick(),_.x!==v.x||_.y!==v.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:o})),{cameraAnimation:S=>S.fitScreenCoordinates(_,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(T.remove(this._box),this._box=null),T.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new s.l(o,{originalEvent:u}))}}function Ns(C,o){if(C.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${C.length}, points ${o.length}`);let u={};for(let _=0;_<C.length;_++)u[C[_].identifier]=o[_];return u}class fp{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),_.length===this.numTouches&&(this.centroid=function(v){let S=new s.P(0,0);for(let O of v)S._add(O);return S.div(v.length)}(u),this.touches=Ns(_,u)))}touchmove(o,u,_){if(this.aborted||!this.centroid)return;let v=Ns(_,u);for(let S in this.touches){let O=v[S];(!O||O.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(o,u,_){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Ga{constructor(o){this.singleTap=new fp(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,u,_){this.singleTap.touchstart(o,u,_)}touchmove(o,u,_){this.singleTap.touchmove(o,u,_)}touchend(o,u,_){let v=this.singleTap.touchend(o,u,_);if(v){let S=o.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(v)<30;if(S&&O||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class jg{constructor(o){this._tr=new fo(o),this._zoomIn=new Ga({numTouches:1,numTaps:2}),this._zoomOut=new Ga({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,_){this._zoomIn.touchstart(o,u,_),this._zoomOut.touchstart(o,u,_)}touchmove(o,u,_){this._zoomIn.touchmove(o,u,_),this._zoomOut.touchmove(o,u,_)}touchend(o,u,_){let v=this._zoomIn.touchend(o,u,_),S=this._zoomOut.touchend(o,u,_),O=this._tr;return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:O.zoom+1,around:O.unproject(v)},{originalEvent:o})}):S?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:O.zoom-1,around:O.unproject(S)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Al{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){let u=this._moveFunction(...o);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(o,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,u){if(!this.isEnabled())return;let _=this._lastPoint;if(!_)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);let v=Array.isArray(u)?u[0]:u;return!this._moved&&v.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(_,v))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&T.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let xh={0:1,2:2};class wn{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){let u=T.mouseButton(o);this._eventButton=u}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(u,_){let v=xh[_];return u.buttons===void 0||(u.buttons&v)!==v}(o,this._eventButton)}isValidEndEvent(o){return T.mouseButton(o)===this._eventButton}}class hr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}class zf{constructor(o=new wn({checkCorrectEvent:()=>!0}),u=new hr){this.mouseMoveStateManager=o,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(o,u,_){return o instanceof MouseEvent?u(o):typeof TouchEvent<"u"&&o instanceof TouchEvent?_(o):void 0}startMove(o){this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.startMove(u),u=>this.oneFingerTouchMoveStateManager.startMove(u))}endMove(o){this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.endMove(u),u=>this.oneFingerTouchMoveStateManager.endMove(u))}isValidStartEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidStartEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u))}isValidMoveEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidMoveEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u))}isValidEndEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidEndEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u))}}let ta=C=>{C.mousedown=C.dragStart,C.mousemoveWindow=C.dragMove,C.mouseup=C.dragEnd,C.contextmenu=o=>{o.preventDefault()}};class cu{constructor(o,u){this._clickTolerance=o.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,u,_){return this._calculateTransform(o,u,_)}touchmove(o,u,_){if(this._active){if(!this._shouldBePrevented(_.length))return o.preventDefault(),this._calculateTransform(o,u,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,u,_){this._calculateTransform(o,u,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,_){_.length>0&&(this._active=!0);let v=Ns(_,u),S=new s.P(0,0),O=new s.P(0,0),z=0;for(let H in v){let Q=v[H],ne=this._touches[H];ne&&(S._add(Q),O._add(Q.sub(ne)),z++,v[H]=Q)}if(this._touches=v,this._shouldBePrevented(z)||!O.mag())return;let V=O.div(z);return this._sum._add(V),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(z),panDelta:V}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ra{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,_){if(!this._firstTwoTouches)return;o.preventDefault();let[v,S]=this._firstTwoTouches,O=ml(_,u,v),z=ml(_,u,S);if(!O||!z)return;let V=this._aroundCenter?null:O.add(z).div(2);return this._move([O,z],V,o)}touchend(o,u,_){if(!this._firstTwoTouches)return;let[v,S]=this._firstTwoTouches,O=ml(_,u,v),z=ml(_,u,S);O&&z||(this._active&&T.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ml(C,o,u){for(let _=0;_<C.length;_++)if(C[_].identifier===u)return o[_]}function Uf(C,o){return Math.log(C/o)/Math.LN2}class li extends ra{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){let _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Uf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uf(this._distance,_),pinchAround:u}}}function uu(C,o){return 180*C.angleWith(o)/Math.PI}class pm extends ra{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u,_){let v=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:uu(this._vector,v),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let u=25/(Math.PI*this._minDiameter)*360,_=uu(o,this._startVector);return Math.abs(_)<u}}function bh(C){return Math.abs(C.y)>Math.abs(C.x)}class dp extends ra{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,u,_){super.touchstart(o,u,_),this._currentTouchCount=_.length}_start(o){this._lastPoints=o,bh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let v=o[0].sub(this._lastPoints[0]),S=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,S,_.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(o,u,_){if(this._valid!==void 0)return this._valid;let v=o.mag()>=2,S=u.mag()>=2;if(!v&&!S)return;if(!v||!S)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;let O=o.y>0==u.y>0;return bh(o)&&bh(u)&&O}}let Am={panStep:100,bearingStep:15,pitchStep:10};class hc{constructor(o){this._tr=new fo(o);let u=Am;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,_=0,v=0,S=0,O=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?_=-1:(o.preventDefault(),S=-1);break;case 39:o.shiftKey?_=1:(o.preventDefault(),S=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),O=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(_=0,v=0),{cameraAnimation:z=>{let V=this._tr;z.easeTo({duration:300,easeId:"keyboardHandler",easing:gl,zoom:u?Math.round(V.zoom)+u*(o.shiftKey?2:1):V.zoom,bearing:V.bearing+_*this._bearingStep,pitch:V.pitch+v*this._pitchStep,offset:[-S*this._panStep,-O*this._panStep],center:V.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gl(C){return C*(2-C)}let pp=4.000244140625;class hu{constructor(o,u){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=o,this._tr=new fo(o),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let u=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,_=x.now(),v=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%pp==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=T.mousePos(this._map.getCanvas(),o),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(s.Q.convert(_.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let z=o.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=z),typeof this._targetZoom=="number"&&(this._targetZoom+=z)}if(this._delta!==0){let z=this._type==="wheel"&&Math.abs(this._delta)>pp?this._wheelZoomRate:this._defaultZoomRate,V=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&V!==0&&(V=1/V);let H=typeof this._targetZoom!="number"?o.scale:s.aI(this._targetZoom);this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,s.ab(H*V))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let u=typeof this._targetZoom!="number"?o.zoom:this._targetZoom,_=this._startZoom,v=this._easing,S,O=!1;if(this._type==="wheel"&&_&&v){let z=x.now()-this._lastWheelEventTime,V=Math.min((z+5)/200,1),H=v(V);S=s.B.number(_,u,H),V<1?this._frameId||(this._frameId=!0):O=!0}else S=u,O=!0;return this._active=!0,O&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!O,zoomDelta:S-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=s.cb;if(this._prevEase){let _=this._prevEase,v=(x.now()-_.start)/_.duration,S=_.easing(v+.01)-_.easing(v),O=.27/Math.sqrt(S*S+1e-4)*.01,z=Math.sqrt(.0729-O*O);u=s.c9(O,z,.25,1)}return this._prevEase={start:x.now(),duration:o,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ap{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gg{constructor(o){this._tr=new fo(o),this.reset()}reset(){this._active=!1}dblclick(o,u){return o.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hg{constructor(){this._tap=new Ga({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,u,_){if(!this._swipePoint)if(this._tapTime){let v=u[0],S=o.timeStamp-this._tapTime<500,O=this._tapPoint.dist(v)<30;S&&O?_.length>0&&(this._swipePoint=v,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(o,u,_)}touchmove(o,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;let v=u[0],S=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(o,u,_)}touchend(o,u,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{let v=this._tap.touchend(o,u,_);v&&(this._tapTime=o.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ha{constructor(o,u,_){this._el=o,this._mousePan=u,this._touchPan=_}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class hn{constructor(o,u,_,v){this._pitchWithRotate=o.pitchWithRotate,this._rollEnabled=o.rollEnabled,this._mouseRotate=u,this._mousePitch=_,this._mouseRoll=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class vh{constructor(o,u,_,v){this._el=o,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Vf{constructor(o,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=T.create("div","maplibregl-cooperative-gesture-screen",o);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=u,this._container.appendChild(v);let S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=_,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(T.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,u){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:o,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let fc=C=>C.zoom||C.drag||C.roll||C.pitch||C.rotate;class mp extends s.l{}function fu(C){return C.panDelta&&C.panDelta.mag()||C.zoomDelta||C.bearingDelta||C.pitchDelta||C.rollDelta}class Wg{constructor(o,u){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,S)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let O=v.type==="renderFrame"?void 0:v,z={needsRenderFrame:!1},V={},H={};for(let{handlerName:ie,handler:de,allowed:ge}of this._handlers){if(!de.isEnabled())continue;let Pe;if(this._blockedByActive(H,ge,ie))de.reset();else if(de[S||v.type]){if(s.cc(v,S||v.type)){let Ie=T.mousePos(this._map.getCanvas(),v);Pe=de[S||v.type](v,Ie)}else if(s.cd(v,S||v.type)){let Ie=this._getMapTouches(v.touches),Le=T.touchPos(this._map.getCanvas(),Ie);Pe=de[S||v.type](v,Le,Ie)}else s.ce(S||v.type)||(Pe=de[S||v.type](v));this.mergeHandlerResult(z,V,Pe,ie,O),Pe&&Pe.needsRenderFrame&&this._triggerRenderFrame()}(Pe||de.isActive())&&(H[ie]=de)}let Q={};for(let ie in this._previousActiveHandlers)H[ie]||(Q[ie]=O);this._previousActiveHandlers=H,(Object.keys(Q).length||fu(z))&&(this._changes.push([z,V,Q]),this._triggerRenderFrame()),(Object.keys(H).length||fu(z))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:ne}=z;ne&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ne(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nf(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);let _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,S,O]of this._listeners)T.addEventListener(v,S,v===document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(let[o,u,_]of this._listeners)T.removeEventListener(o,u,o===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(o){let u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new Ea(u,o));let v=u.boxZoom=new uc(u,o);this._add("boxZoom",v),o.interactive&&o.boxZoom&&v.enable();let S=u.cooperativeGestures=new Vf(u,o.cooperativeGestures);this._add("cooperativeGestures",S),o.cooperativeGestures&&S.enable();let O=new jg(u),z=new Gg(u);u.doubleClickZoom=new Ap(z,O),this._add("tapZoom",O),this._add("clickZoom",z),o.interactive&&o.doubleClickZoom&&u.doubleClickZoom.enable();let V=new Hg;this._add("tapDragZoom",V);let H=u.touchPitch=new dp(u);this._add("touchPitch",H),o.interactive&&o.touchPitch&&u.touchPitch.enable(o.touchPitch);let Q=()=>u.project(u.getCenter()),ne=function({enable:De,clickTolerance:Ze,aroundCenter:He=!0,minPixelCenterThreshold:Xe=100,rotateDegreesPerPixelMoved:yt=.8},At){let Pt=new wn({checkCorrectEvent:Ot=>T.mouseButton(Ot)===0&&Ot.ctrlKey||T.mouseButton(Ot)===2&&!Ot.ctrlKey});return new Al({clickTolerance:Ze,move:(Ot,Tt)=>{let er=At();if(He&&Math.abs(er.y-Ot.y)>Xe)return{bearingDelta:s.ca(new s.P(Ot.x,Tt.y),Tt,er)};let Kt=(Tt.x-Ot.x)*yt;return He&&Tt.y<er.y&&(Kt=-Kt),{bearingDelta:Kt}},moveStateManager:Pt,enable:De,assignEvents:ta})}(o,Q),ie=function({enable:De,clickTolerance:Ze,pitchDegreesPerPixelMoved:He=-.5}){let Xe=new wn({checkCorrectEvent:yt=>T.mouseButton(yt)===0&&yt.ctrlKey||T.mouseButton(yt)===2});return new Al({clickTolerance:Ze,move:(yt,At)=>({pitchDelta:(At.y-yt.y)*He}),moveStateManager:Xe,enable:De,assignEvents:ta})}(o),de=function({enable:De,clickTolerance:Ze,rollDegreesPerPixelMoved:He=.3},Xe){let yt=new wn({checkCorrectEvent:At=>T.mouseButton(At)===2&&At.ctrlKey});return new Al({clickTolerance:Ze,move:(At,Pt)=>{let Ot=Xe(),Tt=(Pt.x-At.x)*He;return Pt.y<Ot.y&&(Tt=-Tt),{rollDelta:Tt}},moveStateManager:yt,enable:De,assignEvents:ta})}(o,Q);u.dragRotate=new hn(o,ne,ie,de),this._add("mouseRotate",ne,["mousePitch"]),this._add("mousePitch",ie,["mouseRotate","mouseRoll"]),this._add("mouseRoll",de,["mousePitch"]),o.interactive&&o.dragRotate&&u.dragRotate.enable();let ge=function({enable:De,clickTolerance:Ze}){let He=new wn({checkCorrectEvent:Xe=>T.mouseButton(Xe)===0&&!Xe.ctrlKey});return new Al({clickTolerance:Ze,move:(Xe,yt)=>({around:yt,panDelta:yt.sub(Xe)}),activateOnStart:!0,moveStateManager:He,enable:De,assignEvents:ta})}(o),Pe=new cu(o,u);u.dragPan=new Ha(_,ge,Pe),this._add("mousePan",ge),this._add("touchPan",Pe,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&u.dragPan.enable(o.dragPan);let Ie=new pm,Le=new li;u.touchZoomRotate=new vh(_,Le,Ie,V),this._add("touchRotate",Ie,["touchPan","touchZoom"]),this._add("touchZoom",Le,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&u.touchZoomRotate.enable(o.touchZoomRotate);let Ne=u.scrollZoom=new hu(u,()=>this._triggerRenderFrame());this._add("scrollZoom",Ne,["mousePan"]),o.interactive&&o.scrollZoom&&u.scrollZoom.enable(o.scrollZoom);let Ge=u.keyboard=new hc(u);this._add("keyboard",Ge),o.interactive&&o.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new dm(u))}_add(o,u,_){this._handlers.push({handlerName:o,handler:u,allowed:_}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fc(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,u,_){for(let v in o)if(v!==_&&(!u||u.indexOf(v)<0))return!0;return!1}_getMapTouches(o){let u=[];for(let _ of o)this._el.contains(_.target)&&u.push(_);return u}mergeHandlerResult(o,u,_,v,S){if(!_)return;s.e(o,_);let O={handlerName:v,originalEvent:_.originalEvent||S};_.zoomDelta!==void 0&&(u.zoom=O),_.panDelta!==void 0&&(u.drag=O),_.rollDelta!==void 0&&(u.roll=O),_.pitchDelta!==void 0&&(u.pitch=O),_.bearingDelta!==void 0&&(u.rotate=O)}_applyChanges(){let o={},u={},_={};for(let[v,S,O]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),v.rollDelta&&(o.rollDelta=(o.rollDelta||0)+v.rollDelta),v.around!==void 0&&(o.around=v.around),v.pinchAround!==void 0&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),s.e(u,S),s.e(_,O);this._updateMapTransform(o,u,_),this._changes=[]}_updateMapTransform(o,u,_){let v=this._map,S=v._getTransformForUpdate(),O=v.terrain;if(!(fu(o)||O&&this._terrainMovement))return this._fireEvents(u,_,!0);v._stop(!0);let{panDelta:z,zoomDelta:V,bearingDelta:H,pitchDelta:Q,rollDelta:ne,around:ie,pinchAround:de}=o;de!==void 0&&(ie=de),ie=ie||v.transform.centerPoint,O&&!S.isPointOnMapSurface(ie)&&(ie=S.centerPoint);let ge={panDelta:z,zoomDelta:V,rollDelta:ne,pitchDelta:Q,bearingDelta:H,around:ie};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface(ie)&&(ie=S.centerPoint);let Pe=ie.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(z?ie.sub(z):ie);O?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ge,S),this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?S.setCenter(S.screenPointToLocation(S.centerPoint.sub(z))):this._map.cameraHelper.handleMapControlsPan(ge,S,Pe):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(ge,S,Pe))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ge,S),this._map.cameraHelper.handleMapControlsPan(ge,S,Pe)),v._applyUpdatedTransform(S),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,_,!0)}_fireEvents(o,u,_){let v=fc(this._eventsInProgress),S=fc(o),O={};for(let ne in o){let{originalEvent:ie}=o[ne];this._eventsInProgress[ne]||(O[`${ne}start`]=ie),this._eventsInProgress[ne]=o[ne]}!v&&S&&this._fireEvent("movestart",S.originalEvent);for(let ne in O)this._fireEvent(ne,O[ne]);S&&this._fireEvent("move",S.originalEvent);for(let ne in o){let{originalEvent:ie}=o[ne];this._fireEvent(ne,ie)}let z={},V;for(let ne in this._eventsInProgress){let{handlerName:ie,originalEvent:de}=this._eventsInProgress[ne];this._handlersById[ie].isActive()||(delete this._eventsInProgress[ne],V=u[ie]||de,z[`${ne}end`]=V)}for(let ne in z)this._fireEvent(ne,z[ne]);let H=fc(this._eventsInProgress),Q=(v||S)&&!H;if(Q&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let ne=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&ne.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(ne)}if(_&&Q){this._updatingCamera=!0;let ne=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ie=de=>de!==0&&-this._bearingSnap<de&&de<this._bearingSnap;!ne||!ne.essential&&x.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:V})),ie(this._map.getBearing())&&this._map.resetNorth()):(ie(ne.bearing||this._map.getBearing())&&(ne.bearing=0),ne.freezeElevation=!0,this._map.easeTo(ne,{originalEvent:V})),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new s.l(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new mp("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ca extends s.E{constructor(o,u,_){super(),this._renderFrameCallback=()=>{let v=Math.min((x.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(v)),v<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=_.bearingSnap,this.cameraHelper=u,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(o,u){o.apply(this.transform),this.transform=o,this.cameraHelper=u}getCenter(){return new s.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(o,u){return this.jumpTo({elevation:o},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(o){this._centerClampedToGround=o}panBy(o,u,_){return o=s.P.convert(o).mult(-1),this.panTo(this.transform.center,s.e({offset:o},u),_)}panTo(o,u,_){return this.easeTo(s.e({center:o},u),_)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,_){return this.easeTo(s.e({zoom:o},u),_)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(o,u){return o!=this.transform.fov&&(this.transform.setFov(o),this.fire(new s.l("movestart",u)).fire(new s.l("move",u)).fire(new s.l("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,_){return this.easeTo(s.e({bearing:o},u),_)}resetNorth(o,u){return this.rotateTo(0,s.e({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}getRoll(){return this.transform.roll}setRoll(o,u){return this.jumpTo({roll:o},u),this}cameraForBounds(o,u){o=ui.convert(o).adjustAntiMeridian();let _=u&&u.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),_,u)}_cameraForBoxAndBearing(o,u,_,v){let S={top:0,bottom:0,right:0,left:0};if(typeof(v=s.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){let H=v.padding;v.padding={top:H,bottom:H,right:H,left:H}}let O=s.e(S,v.padding);v.padding=O;let z=this.transform,V=new ui(o,u);return this.cameraHelper.cameraForBoxAndBearing(v,O,V,_,z)}fitBounds(o,u,_){return this._fitInternal(this.cameraForBounds(o,u),u,_)}fitScreenCoordinates(o,u,_,v,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(o)),this.transform.screenPointToLocation(s.P.convert(u)),_,v),v,S)}_fitInternal(o,u,_){return o?(delete(u=s.e(o,u)).padding,u.linear?this.easeTo(u,_):this.flyTo(u,_)):this}jumpTo(o,u){this.stop();let _=this._getTransformForUpdate(),v=!1,S=!1,O=!1,z=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,o);let V=_.zoom!==z;return"elevation"in o&&_.elevation!==+o.elevation&&_.setElevation(+o.elevation),"bearing"in o&&_.bearing!==+o.bearing&&(v=!0,_.setBearing(+o.bearing)),"pitch"in o&&_.pitch!==+o.pitch&&(S=!0,_.setPitch(+o.pitch)),"roll"in o&&_.roll!==+o.roll&&(O=!0,_.setRoll(+o.roll)),o.padding==null||_.isPaddingEqual(o.padding)||_.setPadding(o.padding),this._applyUpdatedTransform(_),this.fire(new s.l("movestart",u)).fire(new s.l("move",u)),V&&this.fire(new s.l("zoomstart",u)).fire(new s.l("zoom",u)).fire(new s.l("zoomend",u)),v&&this.fire(new s.l("rotatestart",u)).fire(new s.l("rotate",u)).fire(new s.l("rotateend",u)),S&&this.fire(new s.l("pitchstart",u)).fire(new s.l("pitch",u)).fire(new s.l("pitchend",u)),O&&this.fire(new s.l("rollstart",u)).fire(new s.l("roll",u)).fire(new s.l("rollend",u)),this.fire(new s.l("moveend",u))}calculateCameraOptionsFromTo(o,u,_,v=0){let S=s.$.fromLngLat(o,u),O=s.$.fromLngLat(_,v),z=O.x-S.x,V=O.y-S.y,H=O.z-S.z,Q=Math.hypot(z,V,H);if(Q===0)throw new Error("Can't calculate camera options with same From and To");let ne=Math.hypot(z,V),ie=s.ab(this.transform.cameraToCenterDistance/Q/this.transform.tileSize),de=180*Math.atan2(z,-V)/Math.PI,ge=180*Math.acos(ne/Q)/Math.PI;return ge=H<0?90-ge:90+ge,{center:O.toLngLat(),elevation:v,zoom:ie,pitch:ge,bearing:de}}calculateCameraOptionsFromCameraLngLatAltRotation(o,u,_,v,S){let O=this.transform.calculateCenterFromCameraLngLatAlt(o,u,_,v);return{center:O.center,elevation:O.elevation,zoom:O.zoom,bearing:_,pitch:v,roll:S}}easeTo(o,u){this._stop(!1,o.easeId),((o=s.e({offset:[0,0],duration:500,easing:s.cb},o)).animate===!1||!o.essential&&x.prefersReducedMotion)&&(o.duration=0);let _=this._getTransformForUpdate(),v=this.getBearing(),S=_.pitch,O=_.roll,z="bearing"in o?this._normalizeBearing(o.bearing,v):v,V="pitch"in o?+o.pitch:S,H="roll"in o?this._normalizeBearing(o.roll,O):O,Q="padding"in o?o.padding:_.padding,ne=s.P.convert(o.offset),ie,de;o.around&&(ie=s.Q.convert(o.around),de=_.locationToScreenPoint(ie));let ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Pe=this.cameraHelper.handleEaseTo(_,{bearing:z,pitch:V,roll:H,padding:Q,around:ie,aroundPoint:de,offsetAsPoint:ne,offset:o.offset,zoom:o.zoom,center:o.center});return this._rotating=this._rotating||v!==z,this._pitching=this._pitching||V!==S,this._rolling=this._rolling||H!==O,this._padding=!_.isPaddingEqual(Q),this._zooming=this._zooming||Pe.isZooming,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,ge),this.terrain&&this._prepareElevation(Pe.elevationCenter),this._ease(Ie=>{Pe.easeFunc(Ie),this.terrain&&!o.freezeElevation&&this._updateElevation(Ie),this._applyUpdatedTransform(_),this._fireMoveEvents(u)},Ie=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(u,Ie)},o),this}_prepareEase(o,u,_={}){this._moving=!0,u||_.moving||this.fire(new s.l("movestart",o)),this._zooming&&!_.zooming&&this.fire(new s.l("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new s.l("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new s.l("pitchstart",o)),this._rolling&&!_.rolling&&this.fire(new s.l("rollstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&u!==this._elevationTarget){let _=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(_-(u-(_*o+this._elevationStart))/(1-o)),this._elevationTarget=u}this.transform.setElevation(s.B.number(this._elevationStart,this._elevationTarget,o))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){if(!this.terrain&&o.elevation>=0&&o.pitch<=90)return{};let u=o.getCameraLngLat(),_=o.getCameraAltitude(),v=this.terrain?this.terrain.getElevationForLngLatZoom(u,o.zoom):0;if(_<v){let S=this.calculateCameraOptionsFromTo(u,v,o.center,o.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(o){let u=[];if(u.push(v=>this._elevateCameraIfInsideTerrain(v)),this.transformCameraUpdate&&u.push(v=>this.transformCameraUpdate(v)),!u.length)return;let _=o.clone();for(let v of u){let S=_.clone(),{center:O,zoom:z,roll:V,pitch:H,bearing:Q,elevation:ne}=v(S);O&&S.setCenter(O),ne!==void 0&&S.setElevation(ne),z!==void 0&&S.setZoom(z),V!==void 0&&S.setRoll(V),H!==void 0&&S.setPitch(H),Q!==void 0&&S.setBearing(Q),_.apply(S)}this.transform.apply(_)}_fireMoveEvents(o){this.fire(new s.l("move",o)),this._zooming&&this.fire(new s.l("zoom",o)),this._rotating&&this.fire(new s.l("rotate",o)),this._pitching&&this.fire(new s.l("pitch",o)),this._rolling&&this.fire(new s.l("roll",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;let _=this._zooming,v=this._rotating,S=this._pitching,O=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new s.l("zoomend",o)),v&&this.fire(new s.l("rotateend",o)),S&&this.fire(new s.l("pitchend",o)),O&&this.fire(new s.l("rollend",o)),this.fire(new s.l("moveend",o))}flyTo(o,u){if(!o.essential&&x.prefersReducedMotion){let Tt=s.O(o,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Tt,u)}this.stop(),o=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cb},o);let _=this._getTransformForUpdate(),v=_.bearing,S=_.pitch,O=_.roll,z=_.padding,V="bearing"in o?this._normalizeBearing(o.bearing,v):v,H="pitch"in o?+o.pitch:S,Q="roll"in o?this._normalizeBearing(o.roll,O):O,ne="padding"in o?o.padding:_.padding,ie=s.P.convert(o.offset),de=_.centerPoint.add(ie),ge=_.screenPointToLocation(de),Pe=this.cameraHelper.handleFlyTo(_,{bearing:V,pitch:H,roll:Q,padding:ne,locationAtOffset:ge,offsetAsPoint:ie,center:o.center,minZoom:o.minZoom,zoom:o.zoom}),Ie=o.curve,Le=Math.max(_.width,_.height),Ne=Le/Pe.scaleOfZoom,Ge=Pe.pixelPathLength;typeof Pe.scaleOfMinZoom=="number"&&(Ie=Math.sqrt(Le/Pe.scaleOfMinZoom/Ge*2));let De=Ie*Ie;function Ze(Tt){let er=(Ne*Ne-Le*Le+(Tt?-1:1)*De*De*Ge*Ge)/(2*(Tt?Ne:Le)*De*Ge);return Math.log(Math.sqrt(er*er+1)-er)}function He(Tt){return(Math.exp(Tt)-Math.exp(-Tt))/2}function Xe(Tt){return(Math.exp(Tt)+Math.exp(-Tt))/2}let yt=Ze(!1),At=function(Tt){return Xe(yt)/Xe(yt+Ie*Tt)},Pt=function(Tt){return Le*((Xe(yt)*(He(er=yt+Ie*Tt)/Xe(er))-He(yt))/De)/Ge;var er},Ot=(Ze(!0)-yt)/Ie;if(Math.abs(Ge)<2e-6||!isFinite(Ot)){if(Math.abs(Le-Ne)<1e-6)return this.easeTo(o,u);let Tt=Ne<Le?-1:1;Ot=Math.abs(Math.log(Ne/Le))/Ie,Pt=()=>0,At=er=>Math.exp(Tt*Ie*er)}return o.duration="duration"in o?+o.duration:1e3*Ot/("screenSpeed"in o?+o.screenSpeed/Ie:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=v!==V,this._pitching=H!==S,this._rolling=Q!==O,this._padding=!_.isPaddingEqual(ne),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(Pe.targetCenter),this._ease(Tt=>{let er=Tt*Ot,Kt=1/At(er),Ut=Pt(er);this._rotating&&_.setBearing(s.B.number(v,V,Tt)),this._pitching&&_.setPitch(s.B.number(S,H,Tt)),this._rolling&&_.setRoll(s.B.number(O,Q,Tt)),this._padding&&(_.interpolatePadding(z,ne,Tt),de=_.centerPoint.add(ie)),Pe.easeFunc(Tt,Kt,Ut,de),this.terrain&&!o.freezeElevation&&this._updateElevation(Tt),this._applyUpdatedTransform(_),this._fireMoveEvents(u)},()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,u)}return o||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(o,u,_){_.animate===!1||_.duration===0?(o(1),u()):(this._easeStart=x.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,u){o=s.aL(o,-180,180);let _=Math.abs(o-u);return Math.abs(o-360-u)<_&&(o-=360),Math.abs(o+360-u)<_&&(o+=360),o}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(s.Q.convert(o),this.transform.tileZoom):null}}let wh={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class br{constructor(o=wh){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=T.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=T.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=T.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){T.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,u){let _=this._map._getUIString(`AttributionControl.${u}`);o.title=_,o.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let u=this._map.style.sourceCaches;for(let v in u){let S=u[v];if(S.used||S.usedForTerrain){let O=S.getSource();O.attribution&&o.indexOf(O.attribution)<0&&o.push(O.attribution)}}o=o.filter(v=>String(v).trim()),o.sort((v,S)=>v.length-S.length),o=o.filter((v,S)=>{for(let O=S+1;O<o.length;O++)if(o[O].indexOf(v)>=0)return!1;return!0});let _=o.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,o.length?(this._innerContainer.innerHTML=T.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Lr{constructor(o={}){this._updateCompact=()=>{let u=this._container.children;if(u.length){let _=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=T.create("div","maplibregl-ctrl");let u=T.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){T.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class jf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){let u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(let v of _)if(v.id===o)return void(v.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let u=this._currentlyRunning=this._queue;this._queue=[];for(let _ of u)if(!_.cancelled&&(_.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var gp=s.aD([{name:"a_pos3d",type:"Int16",components:3}]);class Gf extends s.E{constructor(o){super(),this._lastTilesetChange=x.now(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=o._source.tileSize*2**this.deltaZoom,o.usedForTerrain=!0,o.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,u){this.sourceCache.update(o,u),this._renderableTilesKeys=[];let _={};for(let v of ot(o,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))_[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.terrainRttPosMatrix32f=new Float64Array(16),s.bO(v.terrainRttPosMatrix32f,0,s.Z,s.Z,0,0,1),this._tiles[v.key]=new Cr(v,this.tileSize),this._lastTilesetChange=x.now());for(let v in this._tiles)_[v]||delete this._tiles[v]}freeRtt(o){for(let u in this._tiles){let _=this._tiles[u];(!o||_.tileID.equals(o)||_.tileID.isChildOf(o)||o.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o,u){return u?this._getTerrainCoordsForTileRanges(o,u):this._getTerrainCoordsForRegularTile(o)}_getTerrainCoordsForRegularTile(o){let u={};for(let _ of this._renderableTilesKeys){let v=this._tiles[_].tileID,S=o.clone(),O=s.b2();if(v.canonical.equals(o.canonical))s.bO(O,0,s.Z,s.Z,0,0,1);else if(v.canonical.isChildOf(o.canonical)){let z=v.canonical.z-o.canonical.z,V=v.canonical.x-(v.canonical.x>>z<<z),H=v.canonical.y-(v.canonical.y>>z<<z),Q=s.Z>>z;s.bO(O,0,Q,Q,0,0,1),s.L(O,O,[-V*Q,-H*Q,0])}else{if(!o.canonical.isChildOf(v.canonical))continue;{let z=o.canonical.z-v.canonical.z,V=o.canonical.x-(o.canonical.x>>z<<z),H=o.canonical.y-(o.canonical.y>>z<<z),Q=s.Z>>z;s.bO(O,0,s.Z,s.Z,0,0,1),s.L(O,O,[V*Q,H*Q,0]),s.M(O,O,[1/2**z,1/2**z,0])}}S.terrainRttPosMatrix32f=new Float32Array(O),u[_]=S}return u}_getTerrainCoordsForTileRanges(o,u){let _={};for(let v of this._renderableTilesKeys){let S=this._tiles[v].tileID;if(!this._isWithinTileRanges(S,u))continue;let O=o.clone(),z=s.b2();if(S.canonical.z===o.canonical.z){let V=o.canonical.x-S.canonical.x,H=o.canonical.y-S.canonical.y;s.bO(z,0,s.Z,s.Z,0,0,1),s.L(z,z,[V*s.Z,H*s.Z,0])}else if(S.canonical.z>o.canonical.z){let V=S.canonical.z-o.canonical.z,H=S.canonical.x-(S.canonical.x>>V<<V),Q=S.canonical.y-(S.canonical.y>>V<<V),ne=o.canonical.x-(S.canonical.x>>V),ie=o.canonical.y-(S.canonical.y>>V),de=s.Z>>V;s.bO(z,0,de,de,0,0,1),s.L(z,z,[-H*de+ne*s.Z,-Q*de+ie*s.Z,0])}else{let V=o.canonical.z-S.canonical.z,H=o.canonical.x-(o.canonical.x>>V<<V),Q=o.canonical.y-(o.canonical.y>>V<<V),ne=(o.canonical.x>>V)-S.canonical.x,ie=(o.canonical.y>>V)-S.canonical.y,de=s.Z<<V;s.bO(z,0,de,de,0,0,1),s.L(z,z,[H*s.Z+ne*de,Q*s.Z+ie*de,0])}O.terrainRttPosMatrix32f=new Float32Array(z),_[v]=O}return _}getSourceTile(o,u){let _=this.sourceCache._source,v=o.overscaledZ-this.deltaZoom;if(v>_.maxzoom&&(v=_.maxzoom),v<_.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(v).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!S||!S.dem)&&u)for(;v>=_.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(o.scaledTo(v--).key);return S}anyTilesAfterTime(o=Date.now()){return this._lastTilesetChange>=o}_isWithinTileRanges(o,u){return u[o.canonical.z]&&o.canonical.x>=u[o.canonical.z].minTileX&&o.canonical.x<=u[o.canonical.z].maxTileX&&o.canonical.y>=u[o.canonical.z].minTileY&&o.canonical.y<=u[o.canonical.z].maxTileY}}class po{constructor(o,u,_){this._meshCache={},this.painter=o,this.sourceCache=new Gf(u),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,u,_,v=s.Z){var S;if(!(u>=0&&u<v&&_>=0&&_<v))return 0;let O=this.getTerrainData(o),z=(S=O.tile)===null||S===void 0?void 0:S.dem;if(!z)return 0;let V=s.cf([],[u/v*s.Z,_/v*s.Z],O.u_terrain_matrix),H=[V[0]*z.dim,V[1]*z.dim],Q=Math.floor(H[0]),ne=Math.floor(H[1]),ie=H[0]-Q,de=H[1]-ne;return z.get(Q,ne)*(1-ie)*(1-de)+z.get(Q+1,ne)*ie*(1-de)+z.get(Q,ne+1)*(1-ie)*de+z.get(Q+1,ne+1)*ie*de}getElevationForLngLatZoom(o,u){if(!s.cg(u,o.wrap()))return 0;let{tileID:_,mercatorX:v,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(o,u);return this.getElevation(_,v%s.Z,S%s.Z,s.Z)}getElevation(o,u,_,v=s.Z){return this.getDEMElevation(o,u,_,v)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){let v=this.painter.context,S=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new be(v,S,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new be(v,new s.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.at([])}let u=this.sourceCache.getSourceTile(o,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){let v=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new be(v,u.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),u.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}let _=u&&u+u.tileID.key+o.key;if(_&&!this._demMatrixCache[_]){let v=this.sourceCache.sourceCache._source.maxzoom,S=o.canonical.z-u.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=v?S=o.canonical.z-v:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let O=o.canonical.x-(o.canonical.x>>S<<S),z=o.canonical.y-(o.canonical.y>>S<<S),V=s.ch(new Float64Array(16),[1/(s.Z<<S),1/(s.Z<<S),0]);s.L(V,V,[O*s.Z,z*s.Z,0]),this._demMatrixCache[o.key]={matrix:V,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(o){let u=this.painter,_=u.width/devicePixelRatio,v=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new be(u.context,{width:_,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new be(u.context,{width:_,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(_,v,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,_,v))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,O=0;S<this._coordsTextureSize;S++)for(let z=0;z<this._coordsTextureSize;z++,O+=4)u[O+0]=255&z,u[O+1]=255&S,u[O+2]=z>>8<<4|S>>8,u[O+3]=0;let _=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),v=new be(o,_,o.gl.RGBA,{premultiply:!1});return v.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);let u=new Uint8Array(4),_=this.painter.context,v=_.gl,S=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),O=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),z=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(S,z-O-1,1,1,v.RGBA,v.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null);let V=u[0]+(u[2]>>4<<8),H=u[1]+((15&u[2])<<8),Q=this.coordsIndex[255-u[3]],ne=Q&&this.sourceCache.getTileByID(Q);if(!ne)return null;let ie=this._coordsTextureSize,de=(1<<ne.tileID.canonical.z)*ie;return new s.$((ne.tileID.canonical.x*ie+V)/de+ne.tileID.wrap,(ne.tileID.canonical.y*ie+H)/de,this.getElevation(ne.tileID,V,H,ie))}depthAtPoint(o){let u=new Uint8Array(4),_=this.painter.context,v=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(o){var u;let _=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,v=_&&o.canonical.y===0,S=_&&o.canonical.y===(1<<o.canonical.z)-1,O=`m_${v?"n":""}_${S?"s":""}`;if(this._meshCache[O])return this._meshCache[O];let z=this.painter.context,V=new s.ci,H=new s.aH,Q=this.meshSize,ne=s.Z/Q,ie=Q*Q;for(let Xe=0;Xe<=Q;Xe++)for(let yt=0;yt<=Q;yt++)V.emplaceBack(yt*ne,Xe*ne,0);for(let Xe=0;Xe<ie;Xe+=Q+1)for(let yt=0;yt<Q;yt++)H.emplaceBack(yt+Xe,Q+yt+Xe+1,Q+yt+Xe+2),H.emplaceBack(yt+Xe,Q+yt+Xe+2,yt+Xe+1);let de=V.length,ge=de+(Q+1),Pe=(Q+1)*Q,Ie=v?s.b9:0,Le=v?0:1,Ne=S?s.ba:s.Z,Ge=S?0:1;for(let Xe=0;Xe<=Q;Xe++)V.emplaceBack(Xe*ne,Ie,Le);for(let Xe=0;Xe<=Q;Xe++)V.emplaceBack(Xe*ne,Ne,Ge);for(let Xe=0;Xe<Q;Xe++)H.emplaceBack(Pe+Xe,ge+Xe,ge+Xe+1),H.emplaceBack(Pe+Xe,ge+Xe+1,Pe+Xe+1),H.emplaceBack(0+Xe,de+Xe+1,de+Xe),H.emplaceBack(0+Xe,0+Xe+1,de+Xe+1);let De=V.length,Ze=De+2*(Q+1);for(let Xe of[0,1])for(let yt=0;yt<=Q;yt++)for(let At of[0,1])V.emplaceBack(Xe*s.Z,yt*ne,At);for(let Xe=0;Xe<2*Q;Xe+=2)H.emplaceBack(De+Xe,De+Xe+1,De+Xe+3),H.emplaceBack(De+Xe,De+Xe+3,De+Xe+2),H.emplaceBack(Ze+Xe,Ze+Xe+3,Ze+Xe+1),H.emplaceBack(Ze+Xe,Ze+Xe+2,Ze+Xe+3);let He=new Xc(z.createVertexBuffer(V,gp.members),z.createIndexBuffer(H),s.aG.simpleSegment(0,0,V.length,H.length));return this._meshCache[O]=He,He}getMeshFrameDelta(o){return 2*Math.PI*s.br/Math.pow(2,Math.max(o,0))/5}getMinTileElevationForLngLatZoom(o,u){var _;let{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(o,u);return(_=this.getMinMaxElevation(v).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(o){let u=this.getTerrainData(o).tile,_={minElevation:null,maxElevation:null};return u&&u.dem&&(_.minElevation=u.dem.min*this.exaggeration,_.maxElevation=u.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(o,u){let _=s.$.fromLngLat(o.wrap()),v=(1<<u)*s.Z,S=_.x*v,O=_.y*v,z=Math.floor(S/s.Z),V=Math.floor(O/s.Z);return{tileID:new s.Y(u,0,u,z,V),mercatorX:S,mercatorY:O}}}class _p{constructor(o,u,_){this._context=o,this._size=u,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){let u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new be(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(_.texture),{id:o,fbo:u,texture:_,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>o.id!==u),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(let u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(let o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}let Bn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class mm{constructor(o,u){this.painter=o,this.terrain=u,this.pool=new _p(o.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(_=>!o._layers[_].isHidden(u)),this._coordsAscending={};for(let _ in o.sourceCaches){this._coordsAscending[_]={};let v=o.sourceCaches[_].getVisibleCoordinates(),S=o.sourceCaches[_].getSource(),O=S instanceof ls?S.terrainTileRanges:null;for(let z of v){let V=this.terrain.sourceCache.getTerrainCoords(z,O);for(let H in V)this._coordsAscending[_][H]||(this._coordsAscending[_][H]=[]),this._coordsAscending[_][H].push(V[H])}}this._coordsAscendingStr={};for(let _ of o._order){let v=o._layers[_],S=v.source;if(Bn[v.type]&&!this._coordsAscendingStr[S]){this._coordsAscendingStr[S]={};for(let O in this._coordsAscending[S])this._coordsAscendingStr[S][O]=this._coordsAscending[S][O].map(z=>z.key).sort().join()}}for(let _ of this._renderableTiles)for(let v in this._coordsAscendingStr){let S=this._coordsAscendingStr[v][_.tileID.key];S&&S!==_.rttCoords[v]&&(_.rtt=[])}}renderLayer(o,u){if(o.isHidden(this.painter.transform.zoom))return!1;let _=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),v=o.type,S=this.painter,O=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Bn[v]&&(this._prevType&&Bn[this._prevType]||this._stacks.push([]),this._prevType=v,this._stacks[this._stacks.length-1].push(o.id),!O))return!0;if(Bn[this._prevType]||Bn[v]&&O){this._prevType=v;let z=this._stacks.length-1,V=this._stacks[z]||[];for(let H of this._renderableTiles){if(this.pool.isFull()&&(dl(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(H),H.rtt[z]){let ne=this.pool.getObjectForId(H.rtt[z].id);if(ne.stamp===H.rtt[z].stamp){this.pool.useObject(ne);continue}}let Q=this.pool.getOrCreateFreeObject();this.pool.useObject(Q),this.pool.stampObject(Q),H.rtt[z]={id:Q.id,stamp:Q.stamp},S.context.bindFramebuffer.set(Q.fbo.framebuffer),S.context.clear({color:s.b7.transparent,stencil:0}),S.currentStencilSource=void 0;for(let ne=0;ne<V.length;ne++){let ie=S.style._layers[V[ne]],de=ie.source?this._coordsAscending[ie.source][H.tileID.key]:[H.tileID];S.context.viewport.set([0,0,Q.fbo.width,Q.fbo.height]),S._renderTileClippingMasks(ie,de,!0),S.renderLayer(S,S.style.sourceCaches[ie.source],ie,de,_),ie.source&&(H.rttCoords[ie.source]=this._coordsAscendingStr[ie.source][H.tileID.key])}}return dl(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),Bn[v]}return!1}}let Th={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ln=a,Vn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:wh,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},gm={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Eh{constructor(o,u,_=!1){this.mousedown=S=>{this.startMove(S,T.mousePos(this.element,S)),T.addEventListener(window,"mousemove",this.mousemove),T.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,T.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHanlder.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=T.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),T.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=T.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;let v=new zf;this._rotatePitchHanlder=new Al({clickTolerance:3,move:(S,O)=>{let z=u.getBoundingClientRect(),V=new s.P((z.bottom-z.top)/2,(z.right-z.left)/2);return{bearingDelta:s.ca(new s.P(S.x,O.y),O,V),pitchDelta:_?-.5*(O.y-S.y):void 0}},moveStateManager:v,enable:!0,assignEvents:()=>{}}),this.map=o,T.addEventListener(u,"mousedown",this.mousedown),T.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),T.addEventListener(u,"touchcancel",this.reset)}startMove(o,u){this._rotatePitchHanlder.dragStart(o,u),T.disableDrag()}move(o,u){let _=this.map,{bearingDelta:v,pitchDelta:S}=this._rotatePitchHanlder.dragMove(o,u)||{};v&&_.setBearing(_.getBearing()+v),S&&_.setPitch(_.getPitch()+S)}off(){let o=this.element;T.removeEventListener(o,"mousedown",this.mousedown),T.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend),T.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){T.enableDrag(),T.removeEventListener(window,"mousemove",this.mousemove),T.removeEventListener(window,"mouseup",this.mouseup),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend)}}let bs;function Ch(C,o,u){let _=new s.Q(C.lng,C.lat);if(C=new s.Q(C.lng,C.lat),o){let v=new s.Q(C.lng-360,C.lat),S=new s.Q(C.lng+360,C.lat),O=u.locationToScreenPoint(C).distSqr(o);u.locationToScreenPoint(v).distSqr(o)<O?C=v:u.locationToScreenPoint(S).distSqr(o)<O&&(C=S)}for(;Math.abs(C.lng-u.center.lng)>180;){let v=u.locationToScreenPoint(C);if(v.x>=0&&v.y>=0&&v.x<=u.width&&v.y<=u.height)break;C.lng>u.center.lng?C.lng-=360:C.lng+=360}return C.lng!==_.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(C))?C:_}let du={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hf(C,o,u){let _=C.classList;for(let v in du)_.remove(`maplibregl-${u}-anchor-${v}`);_.add(`maplibregl-${u}-anchor-${o}`)}class dc extends s.E{constructor(o){if(super(),this._onKeyPress=u=>{let _=u.code,v=u.charCode||u.keyCode;_!=="Space"&&_!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=u=>{let _=u.originalEvent.target,v=this._element;this._popup&&(_===v||v.contains(_))&&this.togglePopup()},this._update=u=>{var _;if(!this._map)return;let v=this._map.loaded()&&!this._map.isMoving();(u?.type==="terrain"||u?.type==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ch(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let S="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?S=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(S=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let O="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?O="rotateX(0deg)":this._pitchAlignment==="map"&&(O=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),T.setTransform(this._element,`${du[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${O} ${S}`),x.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){let _=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(o?.opacity,o?.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=s.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=T.create("div");let u=T.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${_}px`),u.setAttributeNS(null,"width",`${v}px`),u.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);let S=T.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");let O=T.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill-rule","nonzero");let z=T.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");let V=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let Le of V){let Ne=T.createNS("http://www.w3.org/2000/svg","ellipse");Ne.setAttributeNS(null,"opacity","0.04"),Ne.setAttributeNS(null,"cx","10.5"),Ne.setAttributeNS(null,"cy","5.80029008"),Ne.setAttributeNS(null,"rx",Le.rx),Ne.setAttributeNS(null,"ry",Le.ry),z.appendChild(Ne)}let H=T.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);let Q=T.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(Q);let ne=T.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"fill","#000000");let ie=T.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ne.appendChild(ie);let de=T.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(6.0, 7.0)"),de.setAttributeNS(null,"fill","#FFFFFF");let ge=T.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(8.0, 8.0)");let Pe=T.createNS("http://www.w3.org/2000/svg","circle");Pe.setAttributeNS(null,"fill","#000000"),Pe.setAttributeNS(null,"opacity","0.25"),Pe.setAttributeNS(null,"cx","5.5"),Pe.setAttributeNS(null,"cy","5.5"),Pe.setAttributeNS(null,"r","5.4999962");let Ie=T.createNS("http://www.w3.org/2000/svg","circle");Ie.setAttributeNS(null,"fill","#FFFFFF"),Ie.setAttributeNS(null,"cx","5.5"),Ie.setAttributeNS(null,"cy","5.5"),Ie.setAttributeNS(null,"r","5.4999962"),ge.appendChild(Pe),ge.appendChild(Ie),O.appendChild(z),O.appendChild(H),O.appendChild(ne),O.appendChild(de),O.appendChild(ge),u.appendChild(O),u.setAttributeNS(null,"height",_*this._scale+"px"),u.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(u),this._offset=s.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),Hf(this._element,this._anchor,"marker"),o&&o.className)for(let u of o.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),o.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),T.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.Q.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let v=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){let o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var u,_;if(!(!((u=this._map)===null||u===void 0)&&u.terrain)){let ne=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ne&&(this._element.style.opacity=ne))}if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let v=this._map,S=v.terrain.depthAtPoint(this._pos),O=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,O)-S<.006)return void(this._element.style.opacity=this._opacity);let z=-this._offset.y/v.transform.pixelsPerMeter,V=Math.sin(v.getPitch()*Math.PI/180)*z,H=v.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),Q=v.transform.lngLatToCameraDepth(this._lngLat,O+V)-H>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&Q&&this._popup.remove(),this._element.style.opacity=Q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=s.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,u){return(this._opacity===void 0||o===void 0&&u===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}let yp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},pu=0,pc=!1,xp={maxWidth:100,unit:"metric"};function Wf(C,o,u){let _=u&&u.maxWidth||100,v=C._container.clientHeight/2,S=C._container.clientWidth/2,O=C.unproject([S-_/2,v]),z=C.unproject([S+_/2,v]),V=Math.round(C.project(z).x-C.project(O).x),H=Math.min(_,V,C._container.clientWidth),Q=O.distanceTo(z);if(u&&u.unit==="imperial"){let ne=3.2808*Q;ne>5280?Ac(o,H,ne/5280,C._getUIString("ScaleControl.Miles")):Ac(o,H,ne,C._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Ac(o,H,Q/1852,C._getUIString("ScaleControl.NauticalMiles")):Q>=1e3?Ac(o,H,Q/1e3,C._getUIString("ScaleControl.Kilometers")):Ac(o,H,Q,C._getUIString("ScaleControl.Meters"))}function Ac(C,o,u,_){let v=function(S){let O=Math.pow(10,`${Math.floor(S)}`.length-1),z=S/O;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(V){let H=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*H)/H}(z),O*z}(u);C.style.width=o*(v/u)+"px",C.innerHTML=`${v}&nbsp;${_}`}let bp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},vp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sh(C){if(C){if(typeof C=="number"){let o=Math.round(Math.abs(C)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,C),"top-left":new s.P(o,o),"top-right":new s.P(-o,o),bottom:new s.P(0,-C),"bottom-left":new s.P(o,-o),"bottom-right":new s.P(-o,-o),left:new s.P(C,0),right:new s.P(-C,0)}}if(C instanceof s.P||Array.isArray(C)){let o=s.P.convert(C);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:s.P.convert(C.center||[0,0]),top:s.P.convert(C.top||[0,0]),"top-left":s.P.convert(C["top-left"]||[0,0]),"top-right":s.P.convert(C["top-right"]||[0,0]),bottom:s.P.convert(C.bottom||[0,0]),"bottom-left":s.P.convert(C["bottom-left"]||[0,0]),"bottom-right":s.P.convert(C["bottom-right"]||[0,0]),left:s.P.convert(C.left||[0,0]),right:s.P.convert(C.right||[0,0])}}return Sh(new s.P(0,0))}let $f=a;n.AJAXError=s.cm,n.Event=s.l,n.Evented=s.E,n.LngLat=s.Q,n.MercatorCoordinate=s.$,n.Point=s.P,n.addProtocol=s.cn,n.config=s.a,n.removeProtocol=s.co,n.AttributionControl=br,n.BoxZoomHandler=uc,n.CanvasSource=Aa,n.CooperativeGesturesHandler=Vf,n.DoubleClickZoomHandler=Ap,n.DragPanHandler=Ha,n.DragRotateHandler=hn,n.EdgeInsets=bn,n.FullscreenControl=class extends s.E{constructor(C={}){super(),this._onFullscreenChange=()=>{var o;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=u?.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,C&&C.container&&(C.container instanceof HTMLElement?this._container=C.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(C){return this._map=C,this._container||(this._container=this._map.getContainer()),this._controlContainer=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){T.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let C=this._fullscreenButton=T.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);T.create("span","maplibregl-ctrl-icon",C).setAttribute("aria-hidden","true"),C.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let C=this._getTitle();this._fullscreenButton.setAttribute("aria-label",C),this._fullscreenButton.title=C}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},n.GeoJSONSource=qs,n.GeolocateControl=class extends s.E{constructor(C){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",o)),this._finish()}},this._updateCamera=o=>{let u=new s.Q(o.coords.longitude,o.coords.latitude),_=o.coords.accuracy,v=this._map.getBearing(),S=s.e({bearing:v},this.options.fitBoundsOptions),O=ui.fromLngLat(u,_);this._map.fitBounds(O,S,{geolocateSource:!0})},this._updateMarker=o=>{if(o){let u=new s.Q(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&pc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=T.create("button","maplibregl-ctrl-geolocate",this._container),T.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{let u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=T.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new dc({element:this._dotElement}),this._circleElement=T.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))})}},this.options=s.e({},yp,C)}onAdd(C){return this._map=C,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return s._(this,arguments,void 0,function*(o=!1){if(bs!==void 0&&!o)return bs;if(window.navigator.permissions===void 0)return bs=!!window.navigator.geolocation,bs;try{bs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{bs=!!window.navigator.geolocation}return bs})}().then(o=>this._finishSetupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),T.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,pu=0,pc=!1}_isOutOfMapMaxBounds(C){let o=this._map.getMaxBounds(),u=C.coords;return o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let C=this._map.getBounds(),o=C.getSouthEast(),u=C.getNorthEast(),_=o.distanceTo(u),v=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pu--,pc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let C;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),pu++,pu>1?(C={maximumAge:6e5,timeout:0},pc=!0):(C=this.options.positionOptions,pc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,C)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},n.GlobeControl=class{constructor(){this._toggleProjection=()=>{var C;let o=(C=this._map.getProjection())===null||C===void 0?void 0:C.type;this._map.setProjection(o!=="mercator"&&o?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var C;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((C=this._map.getProjection())===null||C===void 0?void 0:C.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(C){return this._map=C,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=T.create("button","maplibregl-ctrl-globe",this._container),T.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){T.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},n.Hash=pl,n.ImageSource=ls,n.KeyboardHandler=hc,n.LngLatBounds=ui,n.LogoControl=Lr,n.Map=class extends Ca{constructor(C){var o,u;s.cj.mark(s.ck.create);let _=Object.assign(Object.assign(Object.assign({},Vn),C),{canvasContextAttributes:Object.assign(Object.assign({},Vn.canvasContextAttributes),C.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let v=new vn,S=new Io;if(_.minZoom!==void 0&&v.setMinZoom(_.minZoom),_.maxZoom!==void 0&&v.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&v.setMinPitch(_.minPitch),_.maxPitch!==void 0&&v.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&v.setRenderWorldCopies(_.renderWorldCopies),super(v,S,{bearingSnap:_.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new jf,this._controls=[],this._mapId=s.a4(),this._contextLost=z=>{z.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.l("webglcontextlost",{originalEvent:z}))},this._contextRestored=z=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:z}))},this._onMapScroll=z=>{if(z.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Th),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=te.addThrottleControl(()=>this.isMoving()),this._requestManager=new oe(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let z=!1,V=Ff(H=>{this._trackResize&&!this._removed&&(this.resize(H),this.redraw())},50);this._resizeObserver=new ResizeObserver(H=>{z?V(H):z=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Wg(this,_),this._hash=_.hash&&new pl(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,s.e({},_.fitBoundsOptions,{duration:0}))));let O=typeof _.style=="string"||((u=(o=_.style)===null||o===void 0?void 0:o.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,O),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new br(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Lr,_.logoPosition),this.on("style.load",()=>{if(O||this._resizeTransform(),this.transform.unmodified){let z=s.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(z)}}),this.on("data",z=>{this._update(z.dataType==="style"),this.fire(new s.l(`${z.dataType}data`,z))}),this.on("dataloading",z=>{this.fire(new s.l(`${z.dataType}dataloading`,z))}),this.on("dataabort",z=>{this.fire(new s.l("sourcedataabort",z))})}_getMapId(){return this._mapId}addControl(C,o){if(o===void 0&&(o=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=C.onAdd(this);this._controls.push(C);let _=this._controlPositions[o];return o.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(C){if(!C||!C.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(C);return o>-1&&this._controls.splice(o,1),C.onRemove(this),this}hasControl(C){return this._controls.indexOf(C)>-1}calculateCameraOptionsFromTo(C,o,u,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(C,o,u,_)}resize(C,o=!0){let[u,_]=this._containerDimensions(),v=this._getClampedPixelRatio(u,_);if(this._resizeCanvas(u,_,v),this.painter.resize(u,_,v),this.painter.overLimit()){let O=this.painter.context.gl;this._maxCanvasSize=[O.drawingBufferWidth,O.drawingBufferHeight];let z=this._getClampedPixelRatio(u,_);this._resizeCanvas(u,_,z),this.painter.resize(u,_,z)}this._resizeTransform(o);let S=!this._moving;return S&&(this.stop(),this.fire(new s.l("movestart",C)).fire(new s.l("move",C))),this.fire(new s.l("resize",C)),S&&this.fire(new s.l("moveend",C)),this}_resizeTransform(C=!0){var o;let[u,_]=this._containerDimensions();this.transform.resize(u,_,C),(o=this._requestedCameraState)===null||o===void 0||o.resize(u,_,C)}_getClampedPixelRatio(C,o){let{0:u,1:_}=this._maxCanvasSize,v=this.getPixelRatio(),S=C*v,O=o*v;return Math.min(S>u?u/S:1,O>_?_/O:1)*v}getPixelRatio(){var C;return(C=this._overridePixelRatio)!==null&&C!==void 0?C:devicePixelRatio}setPixelRatio(C){this._overridePixelRatio=C,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(C){return this.transform.setMaxBounds(ui.convert(C)),this._update()}setMinZoom(C){if((C=C??-2)>=-2&&C<=this.transform.maxZoom)return this.transform.setMinZoom(C),this._update(),this.getZoom()<C&&this.setZoom(C),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(C){if((C=C??22)>=this.transform.minZoom)return this.transform.setMaxZoom(C),this._update(),this.getZoom()>C&&this.setZoom(C),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(C){if((C=C??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch)return this.transform.setMinPitch(C),this._update(),this.getPitch()<C&&this.setPitch(C),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(C){if((C=C??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(C>=this.transform.minPitch)return this.transform.setMaxPitch(C),this._update(),this.getPitch()>C&&this.setPitch(C),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(C){return this.transform.setRenderWorldCopies(C),this._update()}project(C){return this.transform.locationToScreenPoint(s.Q.convert(C),this.style&&this.terrain)}unproject(C){return this.transform.screenPointToLocation(s.P.convert(C),this.terrain)}isMoving(){var C;return this._moving||((C=this.handlers)===null||C===void 0?void 0:C.isMoving())}isZooming(){var C;return this._zooming||((C=this.handlers)===null||C===void 0?void 0:C.isZooming())}isRotating(){var C;return this._rotating||((C=this.handlers)===null||C===void 0?void 0:C.isRotating())}_createDelegatedListener(C,o,u){if(C==="mouseenter"||C==="mouseover"){let _=!1;return{layers:o,listener:u,delegates:{mousemove:S=>{let O=o.filter(V=>this.getLayer(V)),z=O.length!==0?this.queryRenderedFeatures(S.point,{layers:O}):[];z.length?_||(_=!0,u.call(this,new ks(C,this,S.originalEvent,{features:z}))):_=!1},mouseout:()=>{_=!1}}}}if(C==="mouseleave"||C==="mouseout"){let _=!1;return{layers:o,listener:u,delegates:{mousemove:O=>{let z=o.filter(V=>this.getLayer(V));(z.length!==0?this.queryRenderedFeatures(O.point,{layers:z}):[]).length?_=!0:_&&(_=!1,u.call(this,new ks(C,this,O.originalEvent)))},mouseout:O=>{_&&(_=!1,u.call(this,new ks(C,this,O.originalEvent)))}}}}{let _=v=>{let S=o.filter(z=>this.getLayer(z)),O=S.length!==0?this.queryRenderedFeatures(v.point,{layers:S}):[];O.length&&(v.features=O,u.call(this,v),delete v.features)};return{layers:o,listener:u,delegates:{[C]:_}}}}_saveDelegatedListener(C,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(o)}_removeDelegatedListener(C,o,u){if(!this._delegatedListeners||!this._delegatedListeners[C])return;let _=this._delegatedListeners[C];for(let v=0;v<_.length;v++){let S=_[v];if(S.listener===u&&S.layers.length===o.length&&S.layers.every(O=>o.includes(O))){for(let O in S.delegates)this.off(O,S.delegates[O]);return void _.splice(v,1)}}}on(C,o,u){if(u===void 0)return super.on(C,o);let _=typeof o=="string"?[o]:o,v=this._createDelegatedListener(C,_,u);this._saveDelegatedListener(C,v);for(let S in v.delegates)this.on(S,v.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(C,_,u)}}}once(C,o,u){if(u===void 0)return super.once(C,o);let _=typeof o=="string"?[o]:o,v=this._createDelegatedListener(C,_,u);for(let S in v.delegates){let O=v.delegates[S];v.delegates[S]=(...z)=>{this._removeDelegatedListener(C,_,u),O(...z)}}this._saveDelegatedListener(C,v);for(let S in v.delegates)this.once(S,v.delegates[S]);return this}off(C,o,u){return u===void 0?super.off(C,o):(this._removeDelegatedListener(C,typeof o=="string"?[o]:o,u),this)}queryRenderedFeatures(C,o){if(!this.style)return[];let u,_=C instanceof s.P||Array.isArray(C),v=_?C:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(_?{}:C)||{},v instanceof s.P||typeof v[0]=="number")u=[s.P.convert(v)];else{let S=s.P.convert(v[0]),O=s.P.convert(v[1]);u=[S,new s.P(O.x,S.y),O,new s.P(S.x,O.y),S]}return this.style.queryRenderedFeatures(u,o,this.transform)}querySourceFeatures(C,o){return this.style.querySourceFeatures(C,o)}setStyle(C,o){return(o=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&C?(this._diffStyle(C,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(C,o))}setTransformRequest(C){return this._requestManager.setTransformRequest(C),this}_getUIString(C){let o=this._locale[C];if(o==null)throw new Error(`Missing UI string '${C}'`);return o}_updateStyle(C,o){var u,_;if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(C,o));let v=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!C)),C?(this.style=new Na(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C,o,v):this.style.loadJSON(C,o,v),this):((_=(u=this.style)===null||u===void 0?void 0:u.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Na(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(C,o){if(typeof C=="string"){let u=this._requestManager.transformRequest(C,"Style");s.j(u,new AbortController).then(_=>{this._updateDiff(_.data,o)}).catch(_=>{_&&this.fire(new s.k(_))})}else typeof C=="object"&&this._updateDiff(C,o)}_updateDiff(C,o){try{this.style.setState(C,o)&&this._update(!0)}catch(u){s.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(C,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(C,o){return this._lazyInitEmptyStyle(),this.style.addSource(C,o),this._update(!0)}isSourceLoaded(C){let o=this.style&&this.style.sourceCaches[C];if(o!==void 0)return o.loaded();this.fire(new s.k(new Error(`There is no source with ID '${C}'`)))}setTerrain(C){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),C){let o=this.style.sourceCaches[C.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${C.source}`);this.terrain===null&&o.reload();for(let u in this.style._layers){let _=this.style._layers[u];_.type==="hillshade"&&_.source===C.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new po(this.painter,o,C),this.painter.renderToTexture=new mm(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var _;u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==C.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=u.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:C})),this}getTerrain(){var C,o;return(o=(C=this.terrain)===null||C===void 0?void 0:C.options)!==null&&o!==void 0?o:null}areTilesLoaded(){let C=this.style&&this.style.sourceCaches;for(let o in C){let u=C[o]._tiles;for(let _ in u){let v=u[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(C){return this.style.removeSource(C),this._update(!0)}getSource(C){return this.style.getSource(C)}addImage(C,o,u={}){let{pixelRatio:_=1,sdf:v=!1,stretchX:S,stretchY:O,content:z,textFitWidth:V,textFitHeight:H}=u;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||s.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:Q,height:ne,data:ie}=o,de=o;return this.style.addImage(C,{data:new s.R({width:Q,height:ne},new Uint8Array(ie)),pixelRatio:_,stretchX:S,stretchY:O,content:z,textFitWidth:V,textFitHeight:H,sdf:v,version:0,userImage:de}),de.onAdd&&de.onAdd(this,C),this}}{let{width:Q,height:ne,data:ie}=x.getImageData(o);this.style.addImage(C,{data:new s.R({width:Q,height:ne},ie),pixelRatio:_,stretchX:S,stretchY:O,content:z,textFitWidth:V,textFitHeight:H,sdf:v,version:0})}}updateImage(C,o){let u=this.style.getImage(C);if(!u)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=o instanceof HTMLImageElement||s.b(o)?x.getImageData(o):o,{width:v,height:S,data:O}=_;if(v===void 0||S===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==u.data.width||S!==u.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let z=!(o instanceof HTMLImageElement||s.b(o));return u.data.replace(O,z),this.style.updateImage(C,u),this}getImage(C){return this.style.getImage(C)}hasImage(C){return C?!!this.style.getImage(C):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(C){this.style.removeImage(C)}loadImage(C){return te.getImage(this._requestManager.transformRequest(C,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(C,o){return this._lazyInitEmptyStyle(),this.style.addLayer(C,o),this._update(!0)}moveLayer(C,o){return this.style.moveLayer(C,o),this._update(!0)}removeLayer(C){return this.style.removeLayer(C),this._update(!0)}getLayer(C){return this.style.getLayer(C)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(C,o,u){return this.style.setLayerZoomRange(C,o,u),this._update(!0)}setFilter(C,o,u={}){return this.style.setFilter(C,o,u),this._update(!0)}getFilter(C){return this.style.getFilter(C)}setPaintProperty(C,o,u,_={}){return this.style.setPaintProperty(C,o,u,_),this._update(!0)}getPaintProperty(C,o){return this.style.getPaintProperty(C,o)}setLayoutProperty(C,o,u,_={}){return this.style.setLayoutProperty(C,o,u,_),this._update(!0)}getLayoutProperty(C,o){return this.style.getLayoutProperty(C,o)}setGlyphs(C,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(C,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(C,o,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(C,o,u,_=>{_||this._update(!0)}),this}removeSprite(C){return this._lazyInitEmptyStyle(),this.style.removeSprite(C),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(C,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(C,o,u=>{u||this._update(!0)}),this}setLight(C,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(C,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(C,o={}){return this._lazyInitEmptyStyle(),this.style.setSky(C,o),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(C,o){return this.style.setFeatureState(C,o),this._update()}removeFeatureState(C,o){return this.style.removeFeatureState(C,o),this._update()}getFeatureState(C){return this.style.getFeatureState(C)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let C=0,o=0;return this._container&&(C=this._container.clientWidth||400,o=this._container.clientHeight||300),[C,o]}_setupContainer(){let C=this._container;C.classList.add("maplibregl-map");let o=this._canvasContainer=T.create("div","maplibregl-canvas-container",C);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=T.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let u=this._containerDimensions(),_=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],_);let v=this._controlContainer=T.create("div","maplibregl-control-container",C),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(O=>{S[O]=T.create("div",`maplibregl-ctrl-${O} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(C,o,u){this._canvas.width=Math.floor(u*C),this._canvas.height=Math.floor(u*o),this._canvas.style.width=`${C}px`,this._canvas.style.height=`${o}px`}_setupPainter(){let C=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),o=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{o={requestedAttributes:C},_&&(o.statusMessage=_.statusMessage,o.type=_.type)},{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,C):this._canvas.getContext("webgl2",C)||this._canvas.getContext("webgl",C),!u){let _="Failed to initialize WebGL";throw o?(o.message=_,new Error(JSON.stringify(o))):new Error(_)}this.painter=new Df(u,this.transform),R.testSupport(u)}migrateProjection(C,o){super.migrateProjection(C,o),this.painter.transform=C,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(C){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(C){return this._update(),this._renderTaskQueue.add(C)}_cancelRenderFrame(C){this._renderTaskQueue.remove(C)}_render(C){var o,u,_,v,S;let O=this._idleTriggered?this._fadeDuration:0,z=((o=this.style.projection)===null||o===void 0?void 0:o.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),this._removed)return;let V=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let ne=this.transform.zoom,ie=x.now();this.style.zoomHistory.update(ne,ie);let de=new s.C(ne,{now:ie,fadeDuration:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ge=de.crossFadingFactor();ge===1&&ge===this._crossFadingFactor||(V=!0,this._crossFadingFactor=ge),this.style.update(de)}let H=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==z;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((v=this.style.projection)===null||v===void 0?void 0:v.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||H)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,O,this._crossSourceCollisions,H),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:O,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cj.mark(s.ck.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||V)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let Q=this._sourcesDirty||this._styleDirty||this._placementDirty;return Q||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||Q||(this._fullyLoaded=!0,s.cj.mark(s.ck.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var C;this._hash&&this._hash.remove();for(let u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),te.removeThrottleControl(this._imageQueueHandle),(C=this._resizeObserver)===null||C===void 0||C.disconnect();let o=this.painter.context.gl.getExtension("WEBGL_lose_context");o?.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),T.remove(this._canvasContainer),T.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cj.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,x.frame(this._frameRequest,C=>{s.cj.frame(C),this._frameRequest=null;try{this._render(C)}catch(o){if(!s.cl(o)&&!function(u){return u.message===If}(o))throw o}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())}get showPadding(){return!!this._showPadding}set showPadding(C){this._showPadding!==C&&(this._showPadding=C,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())}get repaint(){return!!this._repaint}set repaint(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(C){this._vertices=C,this._update()}get version(){return Ln}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(C){return this._lazyInitEmptyStyle(),this.style.setProjection(C),this._update(!0)}},n.MapMouseEvent=ks,n.MapTouchEvent=lu,n.MapWheelEvent=Uo,n.Marker=dc,n.NavigationControl=class{constructor(C){this._updateZoomButtons=()=>{let o=this._map.getZoom(),u=o===this._map.getMaxZoom(),_=o===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(o,u)=>{let _=this._map._getUIString(`NavigationControl.${u}`);o.title=_,o.setAttribute("aria-label",_)},this.options=s.e({},gm,C),this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),T.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),T.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=T.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(C){return this._map=C,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Eh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){T.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(C,o){let u=T.create("button",C,this._container);return u.type="button",u.addEventListener("click",o),u}},n.Popup=class extends s.E{constructor(C){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&T.remove(this._content),this._container&&(T.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var u;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=T.create("div","maplibregl-popup",this._map.getContainer()),this._tip=T.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let z of this.options.className.split(" "))this._container.classList.add(z);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ch(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._trackPointer&&!o)return;let _=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationToScreenPoint(this._lngLat));let v=this.options.anchor,S=Sh(this.options.offset);if(!v){let z=this._container.offsetWidth,V=this._container.offsetHeight,H;H=_.y+S.bottom.y<V?["top"]:_.y>this._map.transform.height-V?["bottom"]:[],_.x<z/2?H.push("left"):_.x>this._map.transform.width-z/2&&H.push("right"),v=H.length===0?"bottom":H.join("-")}let O=_.add(S[v]);this.options.subpixelPositioning||(O=O.round()),T.setTransform(this._container,`${du[v]} translate(${O.x}px,${O.y}px)`),Hf(this._container,v,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(bp),C)}addTo(C){return this._map&&this.remove(),this._map=C,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(C){return this._lngLat=s.Q.convert(C),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(C){return this.setDOMContent(document.createTextNode(C))}setHTML(C){let o=document.createDocumentFragment(),u=document.createElement("body"),_;for(u.innerHTML=C;_=u.firstChild,_;)o.appendChild(_);return this.setDOMContent(o)}getMaxWidth(){var C;return(C=this._container)===null||C===void 0?void 0:C.style.maxWidth}setMaxWidth(C){return this.options.maxWidth=C,this._update(),this}setDOMContent(C){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=T.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(C),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(C){return this._container&&this._container.classList.add(C),this}removeClassName(C){return this._container&&this._container.classList.remove(C),this}setOffset(C){return this.options.offset=C,this._update(),this}toggleClassName(C){if(this._container)return this._container.classList.toggle(C)}setSubpixelPositioning(C){this.options.subpixelPositioning=C}_createCloseButton(){this.options.closeButton&&(this._closeButton=T.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let C=this._container.querySelector(vp);C&&C.focus()}},n.RasterDEMTileSource=Eo,n.RasterTileSource=oi,n.ScaleControl=class{constructor(C){this._onMove=()=>{Wf(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Wf(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xp),C)}getDefaultPosition(){return"bottom-left"}onAdd(C){return this._map=C,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-scale",C.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){T.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},n.ScrollZoomHandler=hu,n.Style=Na,n.TerrainControl=class{constructor(C){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=C}onAdd(C){return this._map=C,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=T.create("button","maplibregl-ctrl-terrain",this._container),T.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){T.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},n.TwoFingersTouchPitchHandler=dp,n.TwoFingersTouchRotateHandler=pm,n.TwoFingersTouchZoomHandler=li,n.TwoFingersTouchZoomRotateHandler=vh,n.VectorTileSource=Ni,n.VideoSource=Zs,n.addSourceType=(C,o)=>s._(void 0,void 0,void 0,function*(){if(oo(C))throw new Error(`A source type called "${C}" already exists.`);((u,_)=>{_s[u]=_})(C,o)}),n.clearPrewarmedResources=function(){let C=cr;C&&(C.isPreloaded()&&C.numActive()===1?(C.release(_t),cr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.createTileMesh=qd,n.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},n.getRTLTextPluginStatus=function(){return kt().getRTLTextPluginStatus()},n.getVersion=function(){return $f},n.getWorkerCount=function(){return Zt.workerCount},n.getWorkerUrl=function(){return s.a.WORKER_URL},n.importScriptInWorkers=function(C){return Pr().broadcast("IS",C)},n.prewarm=function(){Lt().acquire(_t)},n.setMaxParallelImageRequests=function(C){s.a.MAX_PARALLEL_IMAGE_REQUESTS=C},n.setRTLTextPlugin=function(C,o){return kt().setRTLTextPlugin(C,o)},n.setWorkerCount=function(C){Zt.workerCount=C},n.setWorkerUrl=function(C){s.a.WORKER_URL=C}});var i=t;return i})});var TN=is((Cy,Lw)=>{(function(t){"use strict";var e="Compound",r="Identifier",i="MemberExpression",n="Literal",s="ThisExpression",a="CallExpression",c="UnaryExpression",h="BinaryExpression",p="LogicalExpression",x="ConditionalExpression",T="ArrayExpression",R=46,k=44,j=39,q=34,X=40,re=41,te=91,oe=93,ae=63,pe=59,be=58,Fe=function(Wt,Lt){var vr=new Error(Wt+" at character "+Lt);throw vr.index=Lt,vr.description=Wt,vr},Y=!0,J={"-":Y,"!":Y,"~":Y,"+":Y},Z={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},xe=function(Wt){var Lt=0,vr;for(var Pr in Wt)(vr=Pr.length)>Lt&&Wt.hasOwnProperty(Pr)&&(Lt=vr);return Lt},_e=xe(J),Be=xe(Z),Se={true:!0,false:!1,null:null},ke="this",Ye=function(Wt){return Z[Wt]||0},rt=function(Wt,Lt,vr){var Pr=Wt==="||"||Wt==="&&"?p:h;return{type:Pr,operator:Wt,left:Lt,right:vr}},tt=function(Wt){return Wt>=48&&Wt<=57},_t=function(Wt){return Wt===36||Wt===95||Wt>=65&&Wt<=90||Wt>=97&&Wt<=122||Wt>=128&&!Z[String.fromCharCode(Wt)]},Zt=function(Wt){return Wt===36||Wt===95||Wt>=65&&Wt<=90||Wt>=97&&Wt<=122||Wt>=48&&Wt<=57||Wt>=128&&!Z[String.fromCharCode(Wt)]},Vt=function(Wt){for(var Lt=0,vr=Wt.charAt,Pr=Wt.charCodeAt,dr=function(Jt){return vr.call(Wt,Jt)},Nr=function(Jt){return Pr.call(Wt,Jt)},Ai=Wt.length,Wr=function(){for(var Jt=Nr(Lt);Jt===32||Jt===9||Jt===10||Jt===13;)Jt=Nr(++Lt)},Di=function(){var Jt=tn(),kt,Cr;if(Wr(),Nr(Lt)===ae){if(Lt++,kt=Di(),kt||Fe("Expected expression",Lt),Wr(),Nr(Lt)===be)return Lt++,Cr=Di(),Cr||Fe("Expected expression",Lt),{type:x,test:Jt,consequent:kt,alternate:Cr};Fe("Expected :",Lt)}else return Jt},ui=function(){Wr();for(var Jt,kt=Wt.substr(Lt,Be),Cr=kt.length;Cr>0;){if(Z.hasOwnProperty(kt)&&(!_t(Nr(Lt))||Lt+kt.length<Wt.length&&!Zt(Nr(Lt+kt.length))))return Lt+=Cr,kt;kt=kt.substr(0,--Cr)}return!1},tn=function(){var Jt,kt,Cr,ai,Rr,Xi,cs,zn,ot,Ae;if(cs=Ni(),Cr=ui(),!Cr)return cs;for(Xi={value:Cr,prec:Ye(Cr)},zn=Ni(),zn||Fe("Expected expression after "+Cr,Lt),Rr=[cs,Xi,zn];(Cr=ui())&&(ai=Ye(Cr),ai!==0);){for(Xi={value:Cr,prec:ai},Ae=Cr;Rr.length>2&&ai<=Rr[Rr.length-2].prec;)zn=Rr.pop(),Cr=Rr.pop().value,cs=Rr.pop(),kt=rt(Cr,cs,zn),Rr.push(kt);kt=Ni(),kt||Fe("Expected expression after "+Ae,Lt),Rr.push(Xi,kt)}for(ot=Rr.length-1,kt=Rr[ot];ot>1;)kt=rt(Rr[ot-1].value,Rr[ot-2],kt),ot-=2;return kt},Ni=function(){var Jt,kt,Cr;if(Wr(),Jt=Nr(Lt),tt(Jt)||Jt===R)return oi();if(Jt===j||Jt===q)return Eo();if(Jt===te)return _s();for(kt=Wt.substr(Lt,_e),Cr=kt.length;Cr>0;){if(J.hasOwnProperty(kt)&&(!_t(Nr(Lt))||Lt+kt.length<Wt.length&&!Zt(Nr(Lt+kt.length))))return Lt+=Cr,{type:c,operator:kt,argument:Ni(),prefix:!0};kt=kt.substr(0,--Cr)}return _t(Jt)||Jt===X?Zs():!1},oi=function(){for(var Jt="",kt,Cr;tt(Nr(Lt));)Jt+=dr(Lt++);if(Nr(Lt)===R)for(Jt+=dr(Lt++);tt(Nr(Lt));)Jt+=dr(Lt++);if(kt=dr(Lt),kt==="e"||kt==="E"){for(Jt+=dr(Lt++),kt=dr(Lt),(kt==="+"||kt==="-")&&(Jt+=dr(Lt++));tt(Nr(Lt));)Jt+=dr(Lt++);tt(Nr(Lt-1))||Fe("Expected exponent ("+Jt+dr(Lt)+")",Lt)}return Cr=Nr(Lt),_t(Cr)?Fe("Variable names cannot start with a number ("+Jt+dr(Lt)+")",Lt):Cr===R&&Fe("Unexpected period",Lt),{type:n,value:parseFloat(Jt),raw:Jt}},Eo=function(){for(var Jt="",kt=dr(Lt++),Cr=!1,ai;Lt<Ai;)if(ai=dr(Lt++),ai===kt){Cr=!0;break}else if(ai==="\\")switch(ai=dr(Lt++),ai){case"n":Jt+=`
`;break;case"r":Jt+="\r";break;case"t":Jt+="	";break;case"b":Jt+="\b";break;case"f":Jt+="\f";break;case"v":Jt+="\v";break;default:Jt+=ai}else Jt+=ai;return Cr||Fe('Unclosed quote after "'+Jt+'"',Lt),{type:n,value:Jt,raw:kt+Jt+kt}},qs=function(){var Jt=Nr(Lt),kt=Lt,Cr;for(_t(Jt)?Lt++:Fe("Unexpected "+dr(Lt),Lt);Lt<Ai&&(Jt=Nr(Lt),Zt(Jt));)Lt++;return Cr=Wt.slice(kt,Lt),Se.hasOwnProperty(Cr)?{type:n,value:Se[Cr],raw:Cr}:Cr===ke?{type:s}:{type:r,name:Cr}},ls=function(Jt){for(var kt,Cr=[],ai,Rr=!1,Xi=0;Lt<Ai;)if(Wr(),kt=Nr(Lt),kt===Jt){Rr=!0,Lt++,Jt===re&&Xi&&Xi>=Cr.length&&Fe("Unexpected token "+String.fromCharCode(Jt),Lt);break}else if(kt===k){if(Lt++,Xi++,Xi!==Cr.length){if(Jt===re)Fe("Unexpected token ,",Lt);else if(Jt===oe)for(var cs=Cr.length;cs<Xi;cs++)Cr.push(null)}}else ai=Di(),(!ai||ai.type===e)&&Fe("Expected comma",Lt),Cr.push(ai);return Rr||Fe("Expected "+String.fromCharCode(Jt),Lt),Cr},Zs=function(){var Jt,kt;for(Jt=Nr(Lt),Jt===X?kt=Aa():kt=qs(),Wr(),Jt=Nr(Lt);Jt===R||Jt===te||Jt===X;)Lt++,Jt===R?(Wr(),kt={type:i,computed:!1,object:kt,property:qs()}):Jt===te?(kt={type:i,computed:!0,object:kt,property:Di()},Wr(),Jt=Nr(Lt),Jt!==oe&&Fe("Unclosed [",Lt),Lt++):Jt===X&&(kt={type:a,arguments:ls(re),callee:kt}),Wr(),Jt=Nr(Lt);return kt},Aa=function(){Lt++;var Jt=Di();if(Wr(),Nr(Lt)===re)return Lt++,Jt;Fe("Unclosed (",Lt)},_s=function(){return Lt++,{type:T,elements:ls(oe)}},oo=[],ys,Gr;Lt<Ai;)ys=Nr(Lt),ys===pe||ys===k?Lt++:(Gr=Di())?oo.push(Gr):Lt<Ai&&Fe('Unexpected "'+dr(Lt)+'"',Lt);return oo.length===1?oo[0]:{type:e,body:oo}};if(Vt.version="0.3.5",Vt.toString=function(){return"JavaScript Expression Parser (JSEP) v"+Vt.version},Vt.addUnaryOp=function(Wt){return _e=Math.max(Wt.length,_e),J[Wt]=Y,this},Vt.addBinaryOp=function(Wt,Lt){return Be=Math.max(Wt.length,Be),Z[Wt]=Lt,this},Vt.addLiteral=function(Wt,Lt){return Se[Wt]=Lt,this},Vt.removeUnaryOp=function(Wt){return delete J[Wt],Wt.length===_e&&(_e=xe(J)),this},Vt.removeAllUnaryOps=function(){return J={},_e=0,this},Vt.removeBinaryOp=function(Wt){return delete Z[Wt],Wt.length===Be&&(Be=xe(Z)),this},Vt.removeAllBinaryOps=function(){return Z={},Be=0,this},Vt.removeLiteral=function(Wt){return delete Se[Wt],this},Vt.removeAllLiterals=function(){return Se={},this},typeof Cy>"u"){var cr=t.jsep;t.jsep=Vt,Vt.noConflict=function(){return t.jsep===Vt&&(t.jsep=cr),Vt}}else typeof Lw<"u"&&Lw.exports?Cy=Lw.exports=Vt:Cy.parse=Vt})(Cy)});var k7=is((J7e,y4)=>{"use strict";y4.exports=Xw;y4.exports.default=Xw;function Xw(t,e,r){r=r||2;var i=e&&e.length,n=i?e[0]*r:t.length,s=O7(t,0,n,r,!0),a=[];if(!s||s.next===s.prev)return a;var c,h,p,x,T,R,k;if(i&&(s=Wae(t,e,s,r)),t.length>80*r){c=p=t[0],h=x=t[1];for(var j=r;j<n;j+=r)T=t[j],R=t[j+1],T<c&&(c=T),R<h&&(h=R),T>p&&(p=T),R>x&&(x=R);k=Math.max(p-c,x-h),k=k!==0?32767/k:0}return Yy(s,a,r,c,h,k,0),a}function O7(t,e,r,i,n){var s,a;if(n===_4(t,e,r,i)>0)for(s=e;s<r;s+=i)a=L7(s,t[s],t[s+1],a);else for(s=r-i;s>=e;s-=i)a=L7(s,t[s],t[s+1],a);return a&&Yw(a,a.next)&&(Qy(a),a=a.next),a}function mA(t,e){if(!t)return t;e||(e=t);var r=t,i;do if(i=!1,!r.steiner&&(Yw(r,r.next)||as(r.prev,r,r.next)===0)){if(Qy(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function Yy(t,e,r,i,n,s,a){if(t){!a&&s&&Yae(t,i,n,s);for(var c=t,h,p;t.prev!==t.next;){if(h=t.prev,p=t.next,s?jae(t,i,n,s):Vae(t)){e.push(h.i/r|0),e.push(t.i/r|0),e.push(p.i/r|0),Qy(t),t=p.next,c=p.next;continue}if(t=p,t===c){a?a===1?(t=Gae(mA(t),e,r),Yy(t,e,r,i,n,s,2)):a===2&&Hae(t,e,r,i,n,s):Yy(mA(t),e,r,i,n,s,1);break}}}}function Vae(t){var e=t.prev,r=t,i=t.next;if(as(e,r,i)>=0)return!1;for(var n=e.x,s=r.x,a=i.x,c=e.y,h=r.y,p=i.y,x=n<s?n<a?n:a:s<a?s:a,T=c<h?c<p?c:p:h<p?h:p,R=n>s?n>a?n:a:s>a?s:a,k=c>h?c>p?c:p:h>p?h:p,j=i.next;j!==e;){if(j.x>=x&&j.x<=R&&j.y>=T&&j.y<=k&&R0(n,c,s,h,a,p,j.x,j.y)&&as(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function jae(t,e,r,i){var n=t.prev,s=t,a=t.next;if(as(n,s,a)>=0)return!1;for(var c=n.x,h=s.x,p=a.x,x=n.y,T=s.y,R=a.y,k=c<h?c<p?c:p:h<p?h:p,j=x<T?x<R?x:R:T<R?T:R,q=c>h?c>p?c:p:h>p?h:p,X=x>T?x>R?x:R:T>R?T:R,re=m4(k,j,e,r,i),te=m4(q,X,e,r,i),oe=t.prevZ,ae=t.nextZ;oe&&oe.z>=re&&ae&&ae.z<=te;){if(oe.x>=k&&oe.x<=q&&oe.y>=j&&oe.y<=X&&oe!==n&&oe!==a&&R0(c,x,h,T,p,R,oe.x,oe.y)&&as(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ae.x>=k&&ae.x<=q&&ae.y>=j&&ae.y<=X&&ae!==n&&ae!==a&&R0(c,x,h,T,p,R,ae.x,ae.y)&&as(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;oe&&oe.z>=re;){if(oe.x>=k&&oe.x<=q&&oe.y>=j&&oe.y<=X&&oe!==n&&oe!==a&&R0(c,x,h,T,p,R,oe.x,oe.y)&&as(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ae&&ae.z<=te;){if(ae.x>=k&&ae.x<=q&&ae.y>=j&&ae.y<=X&&ae!==n&&ae!==a&&R0(c,x,h,T,p,R,ae.x,ae.y)&&as(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function Gae(t,e,r){var i=t;do{var n=i.prev,s=i.next.next;!Yw(n,s)&&D7(n,i,i.next,s)&&Ky(n,s)&&Ky(s,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(s.i/r|0),Qy(i),Qy(i.next),i=t=s),i=i.next}while(i!==t);return mA(i)}function Hae(t,e,r,i,n,s){var a=t;do{for(var c=a.next.next;c!==a.prev;){if(a.i!==c.i&&Jae(a,c)){var h=F7(a,c);a=mA(a,a.next),h=mA(h,h.next),Yy(a,e,r,i,n,s,0),Yy(h,e,r,i,n,s,0);return}c=c.next}a=a.next}while(a!==t)}function Wae(t,e,r,i){var n=[],s,a,c,h,p;for(s=0,a=e.length;s<a;s++)c=e[s]*i,h=s<a-1?e[s+1]*i:t.length,p=O7(t,c,h,i,!1),p===p.next&&(p.steiner=!0),n.push(Qae(p));for(n.sort($ae),s=0;s<n.length;s++)r=qae(n[s],r);return r}function $ae(t,e){return t.x-e.x}function qae(t,e){var r=Zae(t,e);if(!r)return e;var i=F7(r,t);return mA(i,i.next),mA(r,r.next)}function Zae(t,e){var r=e,i=t.x,n=t.y,s=-1/0,a;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var c=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(c<=i&&c>s&&(s=c,a=r.x<r.next.x?r:r.next,c===i))return a}r=r.next}while(r!==e);if(!a)return null;var h=a,p=a.x,x=a.y,T=1/0,R;r=a;do i>=r.x&&r.x>=p&&i!==r.x&&R0(n<x?i:s,n,p,x,n<x?s:i,n,r.x,r.y)&&(R=Math.abs(n-r.y)/(i-r.x),Ky(r,t)&&(R<T||R===T&&(r.x>a.x||r.x===a.x&&Xae(a,r)))&&(a=r,T=R)),r=r.next;while(r!==h);return a}function Xae(t,e){return as(t.prev,t,e.prev)<0&&as(e.next,t,t.next)<0}function Yae(t,e,r,i){var n=t;do n.z===0&&(n.z=m4(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,Kae(n)}function Kae(t){var e,r,i,n,s,a,c,h,p=1;do{for(r=t,t=null,s=null,a=0;r;){for(a++,i=r,c=0,e=0;e<p&&(c++,i=i.nextZ,!!i);e++);for(h=p;c>0||h>0&&i;)c!==0&&(h===0||!i||r.z<=i.z)?(n=r,r=r.nextZ,c--):(n=i,i=i.nextZ,h--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;r=i}s.nextZ=null,p*=2}while(a>1);return t}function m4(t,e,r,i,n){return t=(t-r)*n|0,e=(e-i)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Qae(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function R0(t,e,r,i,n,s,a,c){return(n-a)*(e-c)>=(t-a)*(s-c)&&(t-a)*(i-c)>=(r-a)*(e-c)&&(r-a)*(s-c)>=(n-a)*(i-c)}function Jae(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!ele(t,e)&&(Ky(t,e)&&Ky(e,t)&&tle(t,e)&&(as(t.prev,t,e.prev)||as(t,e.prev,e))||Yw(t,e)&&as(t.prev,t,t.next)>0&&as(e.prev,e,e.next)>0)}function as(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Yw(t,e){return t.x===e.x&&t.y===e.y}function D7(t,e,r,i){var n=Zw(as(t,e,r)),s=Zw(as(t,e,i)),a=Zw(as(r,i,t)),c=Zw(as(r,i,e));return!!(n!==s&&a!==c||n===0&&qw(t,r,e)||s===0&&qw(t,i,e)||a===0&&qw(r,t,i)||c===0&&qw(r,e,i))}function qw(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Zw(t){return t>0?1:t<0?-1:0}function ele(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&D7(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Ky(t,e){return as(t.prev,t,t.next)<0?as(t,e,t.next)>=0&&as(t,t.prev,e)>=0:as(t,e,t.prev)<0||as(t,t.next,e)<0}function tle(t,e){var r=t,i=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function F7(t,e){var r=new g4(t.i,t.x,t.y),i=new g4(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function L7(t,e,r,i){var n=new g4(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Qy(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function g4(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Xw.deviation=function(t,e,r,i){var n=e&&e.length,s=n?e[0]*r:t.length,a=Math.abs(_4(t,0,s,r));if(n)for(var c=0,h=e.length;c<h;c++){var p=e[c]*r,x=c<h-1?e[c+1]*r:t.length;a-=Math.abs(_4(t,p,x,r))}var T=0;for(c=0;c<i.length;c+=3){var R=i[c]*r,k=i[c+1]*r,j=i[c+2]*r;T+=Math.abs((t[R]-t[j])*(t[k+1]-t[R+1])-(t[R]-t[k])*(t[j+1]-t[R+1]))}return a===0&&T===0?0:Math.abs((T-a)/a)};function _4(t,e,r,i){for(var n=0,s=e,a=r-i;s<r;s+=i)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}Xw.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var a=0;a<e;a++)r.vertices.push(t[n][s][a]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r}});var S3=is(Yh=>{"use strict";var rU=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",dce=rU+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",iU="["+rU+"]["+dce+"]*",pce=new RegExp("^"+iU+"$"),Ace=function(t,e){let r=[],i=e.exec(t);for(;i;){let n=[];n.startIndex=e.lastIndex-i[0].length;let s=i.length;for(let a=0;a<s;a++)n.push(i[a]);r.push(n),i=e.exec(t)}return r},mce=function(t){let e=pce.exec(t);return!(e===null||typeof e>"u")};Yh.isExist=function(t){return typeof t<"u"};Yh.isEmptyObject=function(t){return Object.keys(t).length===0};Yh.merge=function(t,e,r){if(e){let i=Object.keys(e),n=i.length;for(let s=0;s<n;s++)r==="strict"?t[i[s]]=[e[i[s]]]:t[i[s]]=e[i[s]]}};Yh.getValue=function(t){return Yh.isExist(t)?t:""};Yh.isName=mce;Yh.getAllMatches=Ace;Yh.nameRegexp=iU});var L4=is(lU=>{"use strict";var B4=S3(),gce={allowBooleanAttributes:!1,unpairedTags:[]};lU.validate=function(t,e){e=Object.assign({},gce,e);let r=[],i=!1,n=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(let s=0;s<t.length;s++)if(t[s]==="<"&&t[s+1]==="?"){if(s+=2,s=sU(t,s),s.err)return s}else if(t[s]==="<"){let a=s;if(s++,t[s]==="!"){s=oU(t,s);continue}else{let c=!1;t[s]==="/"&&(c=!0,s++);let h="";for(;s<t.length&&t[s]!==">"&&t[s]!==" "&&t[s]!=="	"&&t[s]!==`
`&&t[s]!=="\r";s++)h+=t[s];if(h=h.trim(),h[h.length-1]==="/"&&(h=h.substring(0,h.length-1),s--),!Ece(h)){let T;return h.trim().length===0?T="Invalid space after '<'.":T="Tag '"+h+"' is an invalid name.",Bs("InvalidTag",T,ua(t,s))}let p=xce(t,s);if(p===!1)return Bs("InvalidAttr","Attributes for '"+h+"' have open quote.",ua(t,s));let x=p.value;if(s=p.index,x[x.length-1]==="/"){let T=s-x.length;x=x.substring(0,x.length-1);let R=aU(x,e);if(R===!0)i=!0;else return Bs(R.err.code,R.err.msg,ua(t,T+R.err.line))}else if(c)if(p.tagClosed){if(x.trim().length>0)return Bs("InvalidTag","Closing tag '"+h+"' can't have attributes or invalid starting.",ua(t,a));if(r.length===0)return Bs("InvalidTag","Closing tag '"+h+"' has not been opened.",ua(t,a));{let T=r.pop();if(h!==T.tagName){let R=ua(t,T.tagStartPos);return Bs("InvalidTag","Expected closing tag '"+T.tagName+"' (opened in line "+R.line+", col "+R.col+") instead of closing tag '"+h+"'.",ua(t,a))}r.length==0&&(n=!0)}}else return Bs("InvalidTag","Closing tag '"+h+"' doesn't have proper closing.",ua(t,s));else{let T=aU(x,e);if(T!==!0)return Bs(T.err.code,T.err.msg,ua(t,s-x.length+T.err.line));if(n===!0)return Bs("InvalidXml","Multiple possible root nodes found.",ua(t,s));e.unpairedTags.indexOf(h)!==-1||r.push({tagName:h,tagStartPos:a}),i=!0}for(s++;s<t.length;s++)if(t[s]==="<")if(t[s+1]==="!"){s++,s=oU(t,s);continue}else if(t[s+1]==="?"){if(s=sU(t,++s),s.err)return s}else break;else if(t[s]==="&"){let T=wce(t,s);if(T==-1)return Bs("InvalidChar","char '&' is not expected.",ua(t,s));s=T}else if(n===!0&&!nU(t[s]))return Bs("InvalidXml","Extra text at the end",ua(t,s));t[s]==="<"&&s--}}else{if(nU(t[s]))continue;return Bs("InvalidChar","char '"+t[s]+"' is not expected.",ua(t,s))}if(i){if(r.length==1)return Bs("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",ua(t,r[0].tagStartPos));if(r.length>0)return Bs("InvalidXml","Invalid '"+JSON.stringify(r.map(s=>s.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Bs("InvalidXml","Start tag expected.",1);return!0};function nU(t){return t===" "||t==="	"||t===`
`||t==="\r"}function sU(t,e){let r=e;for(;e<t.length;e++)if(t[e]=="?"||t[e]==" "){let i=t.substr(r,e-r);if(e>5&&i==="xml")return Bs("InvalidXml","XML declaration allowed only at the start of the document.",ua(t,e));if(t[e]=="?"&&t[e+1]==">"){e++;break}else continue}return e}function oU(t,e){if(t.length>e+5&&t[e+1]==="-"&&t[e+2]==="-"){for(e+=3;e<t.length;e++)if(t[e]==="-"&&t[e+1]==="-"&&t[e+2]===">"){e+=2;break}}else if(t.length>e+8&&t[e+1]==="D"&&t[e+2]==="O"&&t[e+3]==="C"&&t[e+4]==="T"&&t[e+5]==="Y"&&t[e+6]==="P"&&t[e+7]==="E"){let r=1;for(e+=8;e<t.length;e++)if(t[e]==="<")r++;else if(t[e]===">"&&(r--,r===0))break}else if(t.length>e+9&&t[e+1]==="["&&t[e+2]==="C"&&t[e+3]==="D"&&t[e+4]==="A"&&t[e+5]==="T"&&t[e+6]==="A"&&t[e+7]==="["){for(e+=8;e<t.length;e++)if(t[e]==="]"&&t[e+1]==="]"&&t[e+2]===">"){e+=2;break}}return e}var _ce='"',yce="'";function xce(t,e){let r="",i="",n=!1;for(;e<t.length;e++){if(t[e]===_ce||t[e]===yce)i===""?i=t[e]:i!==t[e]||(i="");else if(t[e]===">"&&i===""){n=!0;break}r+=t[e]}return i!==""?!1:{value:r,index:e,tagClosed:n}}var bce=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function aU(t,e){let r=B4.getAllMatches(t,bce),i={};for(let n=0;n<r.length;n++){if(r[n][1].length===0)return Bs("InvalidAttr","Attribute '"+r[n][2]+"' has no space in starting.",yx(r[n]));if(r[n][3]!==void 0&&r[n][4]===void 0)return Bs("InvalidAttr","Attribute '"+r[n][2]+"' is without value.",yx(r[n]));if(r[n][3]===void 0&&!e.allowBooleanAttributes)return Bs("InvalidAttr","boolean attribute '"+r[n][2]+"' is not allowed.",yx(r[n]));let s=r[n][2];if(!Tce(s))return Bs("InvalidAttr","Attribute '"+s+"' is an invalid name.",yx(r[n]));if(!i.hasOwnProperty(s))i[s]=1;else return Bs("InvalidAttr","Attribute '"+s+"' is repeated.",yx(r[n]))}return!0}function vce(t,e){let r=/\d/;for(t[e]==="x"&&(e++,r=/[\da-fA-F]/);e<t.length;e++){if(t[e]===";")return e;if(!t[e].match(r))break}return-1}function wce(t,e){if(e++,t[e]===";")return-1;if(t[e]==="#")return e++,vce(t,e);let r=0;for(;e<t.length;e++,r++)if(!(t[e].match(/\w/)&&r<20)){if(t[e]===";")break;return-1}return e}function Bs(t,e,r){return{err:{code:t,msg:e,line:r.line||r,col:r.col}}}function Tce(t){return B4.isName(t)}function Ece(t){return B4.isName(t)}function ua(t,e){let r=t.substring(0,e).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function yx(t){return t.startIndex+t[1].length}});var uU=is(O4=>{var cU={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,e,r){return t}},Cce=function(t){return Object.assign({},cU,t)};O4.buildOptions=Cce;O4.defaultOptions=cU});var fU=is((Eje,hU)=>{"use strict";var D4=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,r){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:r})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};hU.exports=D4});var pU=is((Cje,dU)=>{var Sce=S3();function Ice(t,e){let r={};if(t[e+3]==="O"&&t[e+4]==="C"&&t[e+5]==="T"&&t[e+6]==="Y"&&t[e+7]==="P"&&t[e+8]==="E"){e=e+9;let i=1,n=!1,s=!1,a="";for(;e<t.length;e++)if(t[e]==="<"&&!s){if(n&&Rce(t,e)){e+=7;let c,h;[c,h,e]=Mce(t,e+1),h.indexOf("&")===-1&&(r[Dce(c)]={regx:RegExp(`&${c};`,"g"),val:h})}else if(n&&Bce(t,e))e+=8;else if(n&&Lce(t,e))e+=8;else if(n&&Oce(t,e))e+=9;else if(Pce)s=!0;else throw new Error("Invalid DOCTYPE");i++,a=""}else if(t[e]===">"){if(s?t[e-1]==="-"&&t[e-2]==="-"&&(s=!1,i--):i--,i===0)break}else t[e]==="["?n=!0:a+=t[e];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:e}}function Mce(t,e){let r="";for(;e<t.length&&t[e]!=="'"&&t[e]!=='"';e++)r+=t[e];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");let i=t[e++],n="";for(;e<t.length&&t[e]!==i;e++)n+=t[e];return[r,n,e]}function Pce(t,e){return t[e+1]==="!"&&t[e+2]==="-"&&t[e+3]==="-"}function Rce(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="N"&&t[e+4]==="T"&&t[e+5]==="I"&&t[e+6]==="T"&&t[e+7]==="Y"}function Bce(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="L"&&t[e+4]==="E"&&t[e+5]==="M"&&t[e+6]==="E"&&t[e+7]==="N"&&t[e+8]==="T"}function Lce(t,e){return t[e+1]==="!"&&t[e+2]==="A"&&t[e+3]==="T"&&t[e+4]==="T"&&t[e+5]==="L"&&t[e+6]==="I"&&t[e+7]==="S"&&t[e+8]==="T"}function Oce(t,e){return t[e+1]==="!"&&t[e+2]==="N"&&t[e+3]==="O"&&t[e+4]==="T"&&t[e+5]==="A"&&t[e+6]==="T"&&t[e+7]==="I"&&t[e+8]==="O"&&t[e+9]==="N"}function Dce(t){if(Sce.isName(t))return t;throw new Error(`Invalid entity name ${t}`)}dU.exports=Ice});var mU=is((Sje,AU)=>{var Fce=/^[-+]?0x[a-fA-F0-9]+$/,kce=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,Nce={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function zce(t,e={}){if(e=Object.assign({},Nce,e),!t||typeof t!="string")return t;let r=t.trim();if(e.skipLike!==void 0&&e.skipLike.test(r))return t;if(t==="0")return 0;if(e.hex&&Fce.test(r))return Vce(r,16);if(r.search(/[eE]/)!==-1){let i=r.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(i){if(e.leadingZeros)r=(i[1]||"")+i[3];else if(!(i[2]==="0"&&i[3][0]==="."))return t;return e.eNotation?Number(r):t}else return t}else{let i=kce.exec(r);if(i){let n=i[1],s=i[2],a=Uce(i[3]);if(!e.leadingZeros&&s.length>0&&n&&r[2]!==".")return t;if(!e.leadingZeros&&s.length>0&&!n&&r[1]!==".")return t;if(e.leadingZeros&&s===t)return 0;{let c=Number(r),h=""+c;return h.search(/[eE]/)!==-1?e.eNotation?c:t:r.indexOf(".")!==-1?h==="0"&&a===""||h===a||n&&h==="-"+a?c:t:s?a===h||n+a===h?c:t:r===h||r===n+h?c:t}}else return t}}function Uce(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substr(0,t.length-1))),t}function Vce(t,e){if(parseInt)return parseInt(t,e);if(Number.parseInt)return Number.parseInt(t,e);if(window&&window.parseInt)return window.parseInt(t,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}AU.exports=zce});var F4=is((Ije,gU)=>{function jce(t){return typeof t=="function"?t:Array.isArray(t)?e=>{for(let r of t)if(typeof r=="string"&&e===r||r instanceof RegExp&&r.test(e))return!0}:()=>!1}gU.exports=jce});var xU=is((Mje,yU)=>{"use strict";var _U=S3(),xx=fU(),Gce=pU(),Hce=mU(),Wce=F4(),k4=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(r,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(r,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=$ce,this.parseXml=Kce,this.parseTextData=qce,this.resolveNameSpace=Zce,this.buildAttributesMap=Yce,this.isItStopNode=tue,this.replaceEntitiesValue=Jce,this.readStopNodeData=iue,this.saveTextToParentTag=eue,this.addChild=Qce,this.ignoreAttributesFn=Wce(this.options.ignoreAttributes)}};function $ce(t){let e=Object.keys(t);for(let r=0;r<e.length;r++){let i=e[r];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:t[i]}}}function qce(t,e,r,i,n,s,a){if(t!==void 0&&(this.options.trimValues&&!i&&(t=t.trim()),t.length>0)){a||(t=this.replaceEntitiesValue(t));let c=this.options.tagValueProcessor(e,t,r,n,s);return c==null?t:typeof c!=typeof t||c!==t?c:this.options.trimValues?z4(t,this.options.parseTagValue,this.options.numberParseOptions):t.trim()===t?z4(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function Zce(t){if(this.options.removeNSPrefix){let e=t.split(":"),r=t.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(t=r+e[1])}return t}var Xce=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Yce(t,e,r){if(this.options.ignoreAttributes!==!0&&typeof t=="string"){let i=_U.getAllMatches(t,Xce),n=i.length,s={};for(let a=0;a<n;a++){let c=this.resolveNameSpace(i[a][1]);if(this.ignoreAttributesFn(c,e))continue;let h=i[a][4],p=this.options.attributeNamePrefix+c;if(c.length)if(this.options.transformAttributeName&&(p=this.options.transformAttributeName(p)),p==="__proto__"&&(p="#__proto__"),h!==void 0){this.options.trimValues&&(h=h.trim()),h=this.replaceEntitiesValue(h);let x=this.options.attributeValueProcessor(c,h,e);x==null?s[p]=h:typeof x!=typeof h||x!==h?s[p]=x:s[p]=z4(h,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[p]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){let a={};return a[this.options.attributesGroupName]=s,a}return s}}var Kce=function(t){t=t.replace(/\r\n?/g,`
`);let e=new xx("!xml"),r=e,i="",n="";for(let s=0;s<t.length;s++)if(t[s]==="<")if(t[s+1]==="/"){let c=yA(t,">",s,"Closing Tag is not closed."),h=t.substring(s+2,c).trim();if(this.options.removeNSPrefix){let T=h.indexOf(":");T!==-1&&(h=h.substr(T+1))}this.options.transformTagName&&(h=this.options.transformTagName(h)),r&&(i=this.saveTextToParentTag(i,r,n));let p=n.substring(n.lastIndexOf(".")+1);if(h&&this.options.unpairedTags.indexOf(h)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${h}>`);let x=0;p&&this.options.unpairedTags.indexOf(p)!==-1?(x=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):x=n.lastIndexOf("."),n=n.substring(0,x),r=this.tagsNodeStack.pop(),i="",s=c}else if(t[s+1]==="?"){let c=N4(t,s,!1,"?>");if(!c)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,r,n),!(this.options.ignoreDeclaration&&c.tagName==="?xml"||this.options.ignorePiTags)){let h=new xx(c.tagName);h.add(this.options.textNodeName,""),c.tagName!==c.tagExp&&c.attrExpPresent&&(h[":@"]=this.buildAttributesMap(c.tagExp,n,c.tagName)),this.addChild(r,h,n)}s=c.closeIndex+1}else if(t.substr(s+1,3)==="!--"){let c=yA(t,"-->",s+4,"Comment is not closed.");if(this.options.commentPropName){let h=t.substring(s+4,c-2);i=this.saveTextToParentTag(i,r,n),r.add(this.options.commentPropName,[{[this.options.textNodeName]:h}])}s=c}else if(t.substr(s+1,2)==="!D"){let c=Gce(t,s);this.docTypeEntities=c.entities,s=c.i}else if(t.substr(s+1,2)==="!["){let c=yA(t,"]]>",s,"CDATA is not closed.")-2,h=t.substring(s+9,c);i=this.saveTextToParentTag(i,r,n);let p=this.parseTextData(h,r.tagname,n,!0,!1,!0,!0);p==null&&(p=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:h}]):r.add(this.options.textNodeName,p),s=c+2}else{let c=N4(t,s,this.options.removeNSPrefix),h=c.tagName,p=c.rawTagName,x=c.tagExp,T=c.attrExpPresent,R=c.closeIndex;this.options.transformTagName&&(h=this.options.transformTagName(h)),r&&i&&r.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,r,n,!1));let k=r;if(k&&this.options.unpairedTags.indexOf(k.tagname)!==-1&&(r=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),h!==e.tagname&&(n+=n?"."+h:h),this.isItStopNode(this.options.stopNodes,n,h)){let j="";if(x.length>0&&x.lastIndexOf("/")===x.length-1)h[h.length-1]==="/"?(h=h.substr(0,h.length-1),n=n.substr(0,n.length-1),x=h):x=x.substr(0,x.length-1),s=c.closeIndex;else if(this.options.unpairedTags.indexOf(h)!==-1)s=c.closeIndex;else{let X=this.readStopNodeData(t,p,R+1);if(!X)throw new Error(`Unexpected end of ${p}`);s=X.i,j=X.tagContent}let q=new xx(h);h!==x&&T&&(q[":@"]=this.buildAttributesMap(x,n,h)),j&&(j=this.parseTextData(j,h,n,!0,T,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),q.add(this.options.textNodeName,j),this.addChild(r,q,n)}else{if(x.length>0&&x.lastIndexOf("/")===x.length-1){h[h.length-1]==="/"?(h=h.substr(0,h.length-1),n=n.substr(0,n.length-1),x=h):x=x.substr(0,x.length-1),this.options.transformTagName&&(h=this.options.transformTagName(h));let j=new xx(h);h!==x&&T&&(j[":@"]=this.buildAttributesMap(x,n,h)),this.addChild(r,j,n),n=n.substr(0,n.lastIndexOf("."))}else{let j=new xx(h);this.tagsNodeStack.push(r),h!==x&&T&&(j[":@"]=this.buildAttributesMap(x,n,h)),this.addChild(r,j,n),r=j}i="",s=R}}else i+=t[s];return e.child};function Qce(t,e,r){let i=this.options.updateTag(e.tagname,r,e[":@"]);i===!1||(typeof i=="string"&&(e.tagname=i),t.addChild(e))}var Jce=function(t){if(this.options.processEntities){for(let e in this.docTypeEntities){let r=this.docTypeEntities[e];t=t.replace(r.regx,r.val)}for(let e in this.lastEntities){let r=this.lastEntities[e];t=t.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){let r=this.htmlEntities[e];t=t.replace(r.regex,r.val)}t=t.replace(this.ampEntity.regex,this.ampEntity.val)}return t};function eue(t,e,r,i){return t&&(i===void 0&&(i=e.child.length===0),t=this.parseTextData(t,e.tagname,r,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,i),t!==void 0&&t!==""&&e.add(this.options.textNodeName,t),t=""),t}function tue(t,e,r){let i="*."+r;for(let n in t){let s=t[n];if(i===s||e===s)return!0}return!1}function rue(t,e,r=">"){let i,n="";for(let s=e;s<t.length;s++){let a=t[s];if(i)a===i&&(i="");else if(a==='"'||a==="'")i=a;else if(a===r[0])if(r[1]){if(t[s+1]===r[1])return{data:n,index:s}}else return{data:n,index:s};else a==="	"&&(a=" ");n+=a}}function yA(t,e,r,i){let n=t.indexOf(e,r);if(n===-1)throw new Error(i);return n+e.length-1}function N4(t,e,r,i=">"){let n=rue(t,e+1,i);if(!n)return;let s=n.data,a=n.index,c=s.search(/\s/),h=s,p=!0;c!==-1&&(h=s.substring(0,c),s=s.substring(c+1).trimStart());let x=h;if(r){let T=h.indexOf(":");T!==-1&&(h=h.substr(T+1),p=h!==n.data.substr(T+1))}return{tagName:h,tagExp:s,closeIndex:a,attrExpPresent:p,rawTagName:x}}function iue(t,e,r){let i=r,n=1;for(;r<t.length;r++)if(t[r]==="<")if(t[r+1]==="/"){let s=yA(t,">",r,`${e} is not closed`);if(t.substring(r+2,s).trim()===e&&(n--,n===0))return{tagContent:t.substring(i,r),i:s};r=s}else if(t[r+1]==="?")r=yA(t,"?>",r+1,"StopNode is not closed.");else if(t.substr(r+1,3)==="!--")r=yA(t,"-->",r+3,"StopNode is not closed.");else if(t.substr(r+1,2)==="![")r=yA(t,"]]>",r,"StopNode is not closed.")-2;else{let s=N4(t,r,">");s&&((s&&s.tagName)===e&&s.tagExp[s.tagExp.length-1]!=="/"&&n++,r=s.closeIndex)}}function z4(t,e,r){if(e&&typeof t=="string"){let i=t.trim();return i==="true"?!0:i==="false"?!1:Hce(t,r)}else return _U.isExist(t)?t:""}yU.exports=k4});var wU=is(vU=>{"use strict";function nue(t,e){return bU(t,e)}function bU(t,e,r){let i,n={};for(let s=0;s<t.length;s++){let a=t[s],c=sue(a),h="";if(r===void 0?h=c:h=r+"."+c,c===e.textNodeName)i===void 0?i=a[c]:i+=""+a[c];else{if(c===void 0)continue;if(a[c]){let p=bU(a[c],e,h),x=aue(p,e);a[":@"]?oue(p,a[":@"],h,e):Object.keys(p).length===1&&p[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?p=p[e.textNodeName]:Object.keys(p).length===0&&(e.alwaysCreateTextNode?p[e.textNodeName]="":p=""),n[c]!==void 0&&n.hasOwnProperty(c)?(Array.isArray(n[c])||(n[c]=[n[c]]),n[c].push(p)):e.isArray(c,h,x)?n[c]=[p]:n[c]=p}}}return typeof i=="string"?i.length>0&&(n[e.textNodeName]=i):i!==void 0&&(n[e.textNodeName]=i),n}function sue(t){let e=Object.keys(t);for(let r=0;r<e.length;r++){let i=e[r];if(i!==":@")return i}}function oue(t,e,r,i){if(e){let n=Object.keys(e),s=n.length;for(let a=0;a<s;a++){let c=n[a];i.isArray(c,r+"."+c,!0,!0)?t[c]=[e[c]]:t[c]=e[c]}}}function aue(t,e){let{textNodeName:r}=e,i=Object.keys(t).length;return!!(i===0||i===1&&(t[r]||typeof t[r]=="boolean"||t[r]===0))}vU.prettify=nue});var EU=is((Rje,TU)=>{var{buildOptions:lue}=uU(),cue=xU(),{prettify:uue}=wU(),hue=L4(),U4=class{constructor(e){this.externalEntities={},this.options=lue(e)}parse(e,r){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});let s=hue.validate(e,r);if(s!==!0)throw Error(`${s.err.msg}:${s.err.line}:${s.err.col}`)}let i=new cue(this.options);i.addExternalEntities(this.externalEntities);let n=i.parseXml(e);return this.options.preserveOrder||n===void 0?n:uue(n,this.options)}addEntity(e,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=r}};TU.exports=U4});var PU=is((Bje,MU)=>{var fue=`
`;function due(t,e){let r="";return e.format&&e.indentBy.length>0&&(r=fue),SU(t,e,"",r)}function SU(t,e,r,i){let n="",s=!1;for(let a=0;a<t.length;a++){let c=t[a],h=pue(c);if(h===void 0)continue;let p="";if(r.length===0?p=h:p=`${r}.${h}`,h===e.textNodeName){let j=c[h];Aue(p,e)||(j=e.tagValueProcessor(h,j),j=IU(j,e)),s&&(n+=i),n+=j,s=!1;continue}else if(h===e.cdataPropName){s&&(n+=i),n+=`<![CDATA[${c[h][0][e.textNodeName]}]]>`,s=!1;continue}else if(h===e.commentPropName){n+=i+`<!--${c[h][0][e.textNodeName]}-->`,s=!0;continue}else if(h[0]==="?"){let j=CU(c[":@"],e),q=h==="?xml"?"":i,X=c[h][0][e.textNodeName];X=X.length!==0?" "+X:"",n+=q+`<${h}${X}${j}?>`,s=!0;continue}let x=i;x!==""&&(x+=e.indentBy);let T=CU(c[":@"],e),R=i+`<${h}${T}`,k=SU(c[h],e,p,x);e.unpairedTags.indexOf(h)!==-1?e.suppressUnpairedNode?n+=R+">":n+=R+"/>":(!k||k.length===0)&&e.suppressEmptyNode?n+=R+"/>":k&&k.endsWith(">")?n+=R+`>${k}${i}</${h}>`:(n+=R+">",k&&i!==""&&(k.includes("/>")||k.includes("</"))?n+=i+e.indentBy+k+i:n+=k,n+=`</${h}>`),s=!0}return n}function pue(t){let e=Object.keys(t);for(let r=0;r<e.length;r++){let i=e[r];if(t.hasOwnProperty(i)&&i!==":@")return i}}function CU(t,e){let r="";if(t&&!e.ignoreAttributes)for(let i in t){if(!t.hasOwnProperty(i))continue;let n=e.attributeValueProcessor(i,t[i]);n=IU(n,e),n===!0&&e.suppressBooleanAttributes?r+=` ${i.substr(e.attributeNamePrefix.length)}`:r+=` ${i.substr(e.attributeNamePrefix.length)}="${n}"`}return r}function Aue(t,e){t=t.substr(0,t.length-e.textNodeName.length-1);let r=t.substr(t.lastIndexOf(".")+1);for(let i in e.stopNodes)if(e.stopNodes[i]===t||e.stopNodes[i]==="*."+r)return!0;return!1}function IU(t,e){if(t&&t.length>0&&e.processEntities)for(let r=0;r<e.entities.length;r++){let i=e.entities[r];t=t.replace(i.regex,i.val)}return t}MU.exports=due});var BU=is((Lje,RU)=>{"use strict";var mue=PU(),gue=F4(),_ue={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Od(t){this.options=Object.assign({},_ue,t),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=gue(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=bue),this.processTextOrObjNode=yue,this.options.format?(this.indentate=xue,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Od.prototype.build=function(t){return this.options.preserveOrder?mue(t,this.options):(Array.isArray(t)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t={[this.options.arrayNodeName]:t}),this.j2x(t,0,[]).val)};Od.prototype.j2x=function(t,e,r){let i="",n="",s=r.join(".");for(let a in t)if(Object.prototype.hasOwnProperty.call(t,a))if(typeof t[a]>"u")this.isAttribute(a)&&(n+="");else if(t[a]===null)this.isAttribute(a)||a===this.options.cdataPropName?n+="":a[0]==="?"?n+=this.indentate(e)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+a+"/"+this.tagEndChar;else if(t[a]instanceof Date)n+=this.buildTextValNode(t[a],a,"",e);else if(typeof t[a]!="object"){let c=this.isAttribute(a);if(c&&!this.ignoreAttributesFn(c,s))i+=this.buildAttrPairStr(c,""+t[a]);else if(!c)if(a===this.options.textNodeName){let h=this.options.tagValueProcessor(a,""+t[a]);n+=this.replaceEntitiesValue(h)}else n+=this.buildTextValNode(t[a],a,"",e)}else if(Array.isArray(t[a])){let c=t[a].length,h="",p="";for(let x=0;x<c;x++){let T=t[a][x];if(!(typeof T>"u"))if(T===null)a[0]==="?"?n+=this.indentate(e)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+a+"/"+this.tagEndChar;else if(typeof T=="object")if(this.options.oneListGroup){let R=this.j2x(T,e+1,r.concat(a));h+=R.val,this.options.attributesGroupName&&T.hasOwnProperty(this.options.attributesGroupName)&&(p+=R.attrStr)}else h+=this.processTextOrObjNode(T,a,e,r);else if(this.options.oneListGroup){let R=this.options.tagValueProcessor(a,T);R=this.replaceEntitiesValue(R),h+=R}else h+=this.buildTextValNode(T,a,"",e)}this.options.oneListGroup&&(h=this.buildObjectNode(h,a,p,e)),n+=h}else if(this.options.attributesGroupName&&a===this.options.attributesGroupName){let c=Object.keys(t[a]),h=c.length;for(let p=0;p<h;p++)i+=this.buildAttrPairStr(c[p],""+t[a][c[p]])}else n+=this.processTextOrObjNode(t[a],a,e,r);return{attrStr:i,val:n}};Od.prototype.buildAttrPairStr=function(t,e){return e=this.options.attributeValueProcessor(t,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+t:" "+t+'="'+e+'"'};function yue(t,e,r,i){let n=this.j2x(t,r+1,i.concat(e));return t[this.options.textNodeName]!==void 0&&Object.keys(t).length===1?this.buildTextValNode(t[this.options.textNodeName],e,n.attrStr,r):this.buildObjectNode(n.val,e,n.attrStr,r)}Od.prototype.buildObjectNode=function(t,e,r,i){if(t==="")return e[0]==="?"?this.indentate(i)+"<"+e+r+"?"+this.tagEndChar:this.indentate(i)+"<"+e+r+this.closeTag(e)+this.tagEndChar;{let n="</"+e+this.tagEndChar,s="";return e[0]==="?"&&(s="?",n=""),(r||r==="")&&t.indexOf("<")===-1?this.indentate(i)+"<"+e+r+s+">"+t+n:this.options.commentPropName!==!1&&e===this.options.commentPropName&&s.length===0?this.indentate(i)+`<!--${t}-->`+this.newLine:this.indentate(i)+"<"+e+r+s+this.tagEndChar+t+this.indentate(i)+n}};Od.prototype.closeTag=function(t){let e="";return this.options.unpairedTags.indexOf(t)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${t}`,e};Od.prototype.buildTextValNode=function(t,e,r,i){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${t}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(i)+`<!--${t}-->`+this.newLine;if(e[0]==="?")return this.indentate(i)+"<"+e+r+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(e,t);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+e+r+this.closeTag(e)+this.tagEndChar:this.indentate(i)+"<"+e+r+">"+n+"</"+e+this.tagEndChar}};Od.prototype.replaceEntitiesValue=function(t){if(t&&t.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){let r=this.options.entities[e];t=t.replace(r.regex,r.val)}return t};function xue(t){return this.options.indentBy.repeat(t)}function bue(t){return t.startsWith(this.options.attributeNamePrefix)&&t!==this.options.textNodeName?t.substr(this.attrPrefixLen):!1}RU.exports=Od});var OU=is((Oje,LU)=>{"use strict";var vue=L4(),wue=EU(),Tue=BU();LU.exports={XMLParser:wue,XMLValidator:vue,XMLBuilder:Tue}});var Y4=is((WU,Cx)=>{(function(t,e){typeof define=="function"&&define.amd?define([],e):typeof r6=="function"&&typeof Cx=="object"&&Cx&&Cx.exports?Cx.exports=e():(t.dcodeIO=t.dcodeIO||{}).Long=e()})(WU,function(){"use strict";function t(J,Z,xe){this.low=J|0,this.high=Z|0,this.unsigned=!!xe}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function e(J){return(J&&J.__isLong__)===!0}t.isLong=e;var r={},i={};function n(J,Z){var xe,_e,Be;return Z?(J>>>=0,(Be=0<=J&&J<256)&&(_e=i[J],_e)?_e:(xe=a(J,(J|0)<0?-1:0,!0),Be&&(i[J]=xe),xe)):(J|=0,(Be=-128<=J&&J<128)&&(_e=r[J],_e)?_e:(xe=a(J,J<0?-1:0,!1),Be&&(r[J]=xe),xe))}t.fromInt=n;function s(J,Z){if(isNaN(J)||!isFinite(J))return Z?re:X;if(Z){if(J<0)return re;if(J>=k)return be}else{if(J<=-j)return Fe;if(J+1>=j)return pe}return J<0?s(-J,Z).neg():a(J%R|0,J/R|0,Z)}t.fromNumber=s;function a(J,Z,xe){return new t(J,Z,xe)}t.fromBits=a;var c=Math.pow;function h(J,Z,xe){if(J.length===0)throw Error("empty string");if(J==="NaN"||J==="Infinity"||J==="+Infinity"||J==="-Infinity")return X;if(typeof Z=="number"?(xe=Z,Z=!1):Z=!!Z,xe=xe||10,xe<2||36<xe)throw RangeError("radix");var _e;if((_e=J.indexOf("-"))>0)throw Error("interior hyphen");if(_e===0)return h(J.substring(1),Z,xe).neg();for(var Be=s(c(xe,8)),Se=X,ke=0;ke<J.length;ke+=8){var Ye=Math.min(8,J.length-ke),rt=parseInt(J.substring(ke,ke+Ye),xe);if(Ye<8){var tt=s(c(xe,Ye));Se=Se.mul(tt).add(s(rt))}else Se=Se.mul(Be),Se=Se.add(s(rt))}return Se.unsigned=Z,Se}t.fromString=h;function p(J){return J instanceof t?J:typeof J=="number"?s(J):typeof J=="string"?h(J):a(J.low,J.high,J.unsigned)}t.fromValue=p;var x=65536,T=1<<24,R=x*x,k=R*R,j=k/2,q=n(T),X=n(0);t.ZERO=X;var re=n(0,!0);t.UZERO=re;var te=n(1);t.ONE=te;var oe=n(1,!0);t.UONE=oe;var ae=n(-1);t.NEG_ONE=ae;var pe=a(-1,2147483647,!1);t.MAX_VALUE=pe;var be=a(-1,-1,!0);t.MAX_UNSIGNED_VALUE=be;var Fe=a(0,-2147483648,!1);t.MIN_VALUE=Fe;var Y=t.prototype;return Y.toInt=function(){return this.unsigned?this.low>>>0:this.low},Y.toNumber=function(){return this.unsigned?(this.high>>>0)*R+(this.low>>>0):this.high*R+(this.low>>>0)},Y.toString=function(Z){if(Z=Z||10,Z<2||36<Z)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Fe)){var xe=s(Z),_e=this.div(xe),Be=_e.mul(xe).sub(this);return _e.toString(Z)+Be.toInt().toString(Z)}else return"-"+this.neg().toString(Z);for(var Se=s(c(Z,6),this.unsigned),ke=this,Ye="";;){var rt=ke.div(Se),tt=ke.sub(rt.mul(Se)).toInt()>>>0,_t=tt.toString(Z);if(ke=rt,ke.isZero())return _t+Ye;for(;_t.length<6;)_t="0"+_t;Ye=""+_t+Ye}},Y.getHighBits=function(){return this.high},Y.getHighBitsUnsigned=function(){return this.high>>>0},Y.getLowBits=function(){return this.low},Y.getLowBitsUnsigned=function(){return this.low>>>0},Y.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Fe)?64:this.neg().getNumBitsAbs();for(var Z=this.high!=0?this.high:this.low,xe=31;xe>0&&!(Z&1<<xe);xe--);return this.high!=0?xe+33:xe+1},Y.isZero=function(){return this.high===0&&this.low===0},Y.isNegative=function(){return!this.unsigned&&this.high<0},Y.isPositive=function(){return this.unsigned||this.high>=0},Y.isOdd=function(){return(this.low&1)===1},Y.isEven=function(){return(this.low&1)===0},Y.equals=function(Z){return e(Z)||(Z=p(Z)),this.unsigned!==Z.unsigned&&this.high>>>31===1&&Z.high>>>31===1?!1:this.high===Z.high&&this.low===Z.low},Y.eq=Y.equals,Y.notEquals=function(Z){return!this.eq(Z)},Y.neq=Y.notEquals,Y.lessThan=function(Z){return this.comp(Z)<0},Y.lt=Y.lessThan,Y.lessThanOrEqual=function(Z){return this.comp(Z)<=0},Y.lte=Y.lessThanOrEqual,Y.greaterThan=function(Z){return this.comp(Z)>0},Y.gt=Y.greaterThan,Y.greaterThanOrEqual=function(Z){return this.comp(Z)>=0},Y.gte=Y.greaterThanOrEqual,Y.compare=function(Z){if(e(Z)||(Z=p(Z)),this.eq(Z))return 0;var xe=this.isNegative(),_e=Z.isNegative();return xe&&!_e?-1:!xe&&_e?1:this.unsigned?Z.high>>>0>this.high>>>0||Z.high===this.high&&Z.low>>>0>this.low>>>0?-1:1:this.sub(Z).isNegative()?-1:1},Y.comp=Y.compare,Y.negate=function(){return!this.unsigned&&this.eq(Fe)?Fe:this.not().add(te)},Y.neg=Y.negate,Y.add=function(Z){e(Z)||(Z=p(Z));var xe=this.high>>>16,_e=this.high&65535,Be=this.low>>>16,Se=this.low&65535,ke=Z.high>>>16,Ye=Z.high&65535,rt=Z.low>>>16,tt=Z.low&65535,_t=0,Zt=0,Vt=0,cr=0;return cr+=Se+tt,Vt+=cr>>>16,cr&=65535,Vt+=Be+rt,Zt+=Vt>>>16,Vt&=65535,Zt+=_e+Ye,_t+=Zt>>>16,Zt&=65535,_t+=xe+ke,_t&=65535,a(Vt<<16|cr,_t<<16|Zt,this.unsigned)},Y.subtract=function(Z){return e(Z)||(Z=p(Z)),this.add(Z.neg())},Y.sub=Y.subtract,Y.multiply=function(Z){if(this.isZero()||(e(Z)||(Z=p(Z)),Z.isZero()))return X;if(this.eq(Fe))return Z.isOdd()?Fe:X;if(Z.eq(Fe))return this.isOdd()?Fe:X;if(this.isNegative())return Z.isNegative()?this.neg().mul(Z.neg()):this.neg().mul(Z).neg();if(Z.isNegative())return this.mul(Z.neg()).neg();if(this.lt(q)&&Z.lt(q))return s(this.toNumber()*Z.toNumber(),this.unsigned);var xe=this.high>>>16,_e=this.high&65535,Be=this.low>>>16,Se=this.low&65535,ke=Z.high>>>16,Ye=Z.high&65535,rt=Z.low>>>16,tt=Z.low&65535,_t=0,Zt=0,Vt=0,cr=0;return cr+=Se*tt,Vt+=cr>>>16,cr&=65535,Vt+=Be*tt,Zt+=Vt>>>16,Vt&=65535,Vt+=Se*rt,Zt+=Vt>>>16,Vt&=65535,Zt+=_e*tt,_t+=Zt>>>16,Zt&=65535,Zt+=Be*rt,_t+=Zt>>>16,Zt&=65535,Zt+=Se*Ye,_t+=Zt>>>16,Zt&=65535,_t+=xe*tt+_e*rt+Be*Ye+Se*ke,_t&=65535,a(Vt<<16|cr,_t<<16|Zt,this.unsigned)},Y.mul=Y.multiply,Y.divide=function(Z){if(e(Z)||(Z=p(Z)),Z.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?re:X;var xe,_e,Be;if(this.unsigned){if(Z.unsigned||(Z=Z.toUnsigned()),Z.gt(this))return re;if(Z.gt(this.shru(1)))return oe;Be=re}else{if(this.eq(Fe)){if(Z.eq(te)||Z.eq(ae))return Fe;if(Z.eq(Fe))return te;var Se=this.shr(1);return xe=Se.div(Z).shl(1),xe.eq(X)?Z.isNegative()?te:ae:(_e=this.sub(Z.mul(xe)),Be=xe.add(_e.div(Z)),Be)}else if(Z.eq(Fe))return this.unsigned?re:X;if(this.isNegative())return Z.isNegative()?this.neg().div(Z.neg()):this.neg().div(Z).neg();if(Z.isNegative())return this.div(Z.neg()).neg();Be=X}for(_e=this;_e.gte(Z);){xe=Math.max(1,Math.floor(_e.toNumber()/Z.toNumber()));for(var ke=Math.ceil(Math.log(xe)/Math.LN2),Ye=ke<=48?1:c(2,ke-48),rt=s(xe),tt=rt.mul(Z);tt.isNegative()||tt.gt(_e);)xe-=Ye,rt=s(xe,this.unsigned),tt=rt.mul(Z);rt.isZero()&&(rt=te),Be=Be.add(rt),_e=_e.sub(tt)}return Be},Y.div=Y.divide,Y.modulo=function(Z){return e(Z)||(Z=p(Z)),this.sub(this.div(Z).mul(Z))},Y.mod=Y.modulo,Y.not=function(){return a(~this.low,~this.high,this.unsigned)},Y.and=function(Z){return e(Z)||(Z=p(Z)),a(this.low&Z.low,this.high&Z.high,this.unsigned)},Y.or=function(Z){return e(Z)||(Z=p(Z)),a(this.low|Z.low,this.high|Z.high,this.unsigned)},Y.xor=function(Z){return e(Z)||(Z=p(Z)),a(this.low^Z.low,this.high^Z.high,this.unsigned)},Y.shiftLeft=function(Z){return e(Z)&&(Z=Z.toInt()),(Z&=63)===0?this:Z<32?a(this.low<<Z,this.high<<Z|this.low>>>32-Z,this.unsigned):a(0,this.low<<Z-32,this.unsigned)},Y.shl=Y.shiftLeft,Y.shiftRight=function(Z){return e(Z)&&(Z=Z.toInt()),(Z&=63)===0?this:Z<32?a(this.low>>>Z|this.high<<32-Z,this.high>>Z,this.unsigned):a(this.high>>Z-32,this.high>=0?0:-1,this.unsigned)},Y.shr=Y.shiftRight,Y.shiftRightUnsigned=function(Z){if(e(Z)&&(Z=Z.toInt()),Z&=63,Z===0)return this;var xe=this.high;if(Z<32){var _e=this.low;return a(_e>>>Z|xe<<32-Z,xe>>>Z,this.unsigned)}else return Z===32?a(xe,0,this.unsigned):a(xe>>>Z-32,0,this.unsigned)},Y.shru=Y.shiftRightUnsigned,Y.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},Y.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},Y.toBytes=function(J){return J?this.toBytesLE():this.toBytesBE()},Y.toBytesLE=function(){var J=this.high,Z=this.low;return[Z&255,Z>>>8&255,Z>>>16&255,Z>>>24&255,J&255,J>>>8&255,J>>>16&255,J>>>24&255]},Y.toBytesBE=function(){var J=this.high,Z=this.low;return[J>>>24&255,J>>>16&255,J>>>8&255,J&255,Z>>>24&255,Z>>>16&255,Z>>>8&255,Z&255]},t})});var OH=is(U5=>{U5.read=function(t,e,r,i,n){var s,a,c=n*8-i-1,h=(1<<c)-1,p=h>>1,x=-7,T=r?n-1:0,R=r?-1:1,k=t[e+T];for(T+=R,s=k&(1<<-x)-1,k>>=-x,x+=c;x>0;s=s*256+t[e+T],T+=R,x-=8);for(a=s&(1<<-x)-1,s>>=-x,x+=i;x>0;a=a*256+t[e+T],T+=R,x-=8);if(s===0)s=1-p;else{if(s===h)return a?NaN:(k?-1:1)*(1/0);a=a+Math.pow(2,i),s=s-p}return(k?-1:1)*a*Math.pow(2,s-i)};U5.write=function(t,e,r,i,n,s){var a,c,h,p=s*8-n-1,x=(1<<p)-1,T=x>>1,R=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=i?0:s-1,j=i?1:-1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,a=x):(a=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-a))<1&&(a--,h*=2),a+T>=1?e+=R/h:e+=R*Math.pow(2,1-T),e*h>=2&&(a++,h/=2),a+T>=x?(c=0,a=x):a+T>=1?(c=(e*h-1)*Math.pow(2,n),a=a+T):(c=e*Math.pow(2,T-1)*Math.pow(2,n),a=0));n>=8;t[r+k]=c&255,k+=j,c/=256,n-=8);for(a=a<<n|c,p+=n;p>0;t[r+k]=a&255,k+=j,a/=256,p-=8);t[r+k-j]|=q*128}});var UH=is((Get,zH)=>{"use strict";zH.exports=cn;var UT=OH();function cn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}cn.Varint=0;cn.Fixed64=1;cn.Bytes=2;cn.Fixed32=5;var V5=65536*65536,DH=1/V5,H0e=12,NH=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");cn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,s=this.pos;this.type=i&7,t(n,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=VT(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=kH(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=VT(this.buf,this.pos)+VT(this.buf,this.pos+4)*V5;return this.pos+=8,t},readSFixed64:function(){var t=VT(this.buf,this.pos)+kH(this.buf,this.pos+4)*V5;return this.pos+=8,t},readFloat:function(){var t=UT.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=UT.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,r,i;return i=e[this.pos++],r=i&127,i<128||(i=e[this.pos++],r|=(i&127)<<7,i<128)||(i=e[this.pos++],r|=(i&127)<<14,i<128)||(i=e[this.pos++],r|=(i&127)<<21,i<128)?r:(i=e[this.pos],r|=(i&15)<<28,W0e(r,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=H0e&&NH?sge(this.buf,e,t):nge(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==cn.Bytes)return t.push(this.readVarint(e));var r=of(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==cn.Bytes)return t.push(this.readSVarint());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==cn.Bytes)return t.push(this.readBoolean());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==cn.Bytes)return t.push(this.readFloat());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==cn.Bytes)return t.push(this.readDouble());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==cn.Bytes)return t.push(this.readFixed32());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==cn.Bytes)return t.push(this.readSFixed32());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==cn.Bytes)return t.push(this.readFixed64());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==cn.Bytes)return t.push(this.readSFixed64());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===cn.Varint)for(;this.buf[this.pos++]>127;);else if(e===cn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===cn.Fixed32)this.pos+=4;else if(e===cn.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),xg(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),xg(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),xg(this.buf,t&-1,this.pos),xg(this.buf,Math.floor(t*DH),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),xg(this.buf,t&-1,this.pos),xg(this.buf,Math.floor(t*DH),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){$0e(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=oge(this.buf,t,this.pos);var r=this.pos-e;r>=128&&FH(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),UT.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),UT.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&FH(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,cn.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,X0e,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Y0e,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,J0e,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,K0e,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Q0e,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,ege,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,tge,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,rge,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,ige,e)},writeBytesField:function(t,e){this.writeTag(t,cn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,cn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,cn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,cn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,cn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,cn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,cn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,cn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,cn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,cn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function W0e(t,e,r){var i=r.buf,n,s;if(s=i[r.pos++],n=(s&112)>>4,s<128||(s=i[r.pos++],n|=(s&127)<<3,s<128)||(s=i[r.pos++],n|=(s&127)<<10,s<128)||(s=i[r.pos++],n|=(s&127)<<17,s<128)||(s=i[r.pos++],n|=(s&127)<<24,s<128)||(s=i[r.pos++],n|=(s&1)<<31,s<128))return yg(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function of(t){return t.type===cn.Bytes?t.readVarint()+t.pos:t.pos+1}function yg(t,e,r){return r?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function $0e(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(r=~(-t%4294967296),i=~(-t/4294967296),r^4294967295?r=r+1|0:(r=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),q0e(r,i,e),Z0e(i,e)}function q0e(t,e,r){r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos]=t&127}function Z0e(t,e){var r=(t&7)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function FH(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function X0e(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Y0e(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function K0e(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Q0e(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function J0e(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function ege(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function tge(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function rge(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function ige(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function VT(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function xg(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function kH(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function nge(t,e,r){for(var i="",n=e;n<r;){var s=t[n],a=null,c=s>239?4:s>223?3:s>191?2:1;if(n+c>r)break;var h,p,x;c===1?s<128&&(a=s):c===2?(h=t[n+1],(h&192)===128&&(a=(s&31)<<6|h&63,a<=127&&(a=null))):c===3?(h=t[n+1],p=t[n+2],(h&192)===128&&(p&192)===128&&(a=(s&15)<<12|(h&63)<<6|p&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):c===4&&(h=t[n+1],p=t[n+2],x=t[n+3],(h&192)===128&&(p&192)===128&&(x&192)===128&&(a=(s&15)<<18|(h&63)<<12|(p&63)<<6|x&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,c=1):a>65535&&(a-=65536,i+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),i+=String.fromCharCode(a),n+=c}return i}function sge(t,e,r){return NH.decode(t.subarray(e,r))}function oge(t,e,r){for(var i=0,n,s;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(s)if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||i+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):s=n;continue}else s&&(t[r++]=239,t[r++]=191,t[r++]=189,s=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=n&63|128)}return r}});var oW=is((Wtt,HT)=>{HT.exports.RADIUS=6378137;HT.exports.FLATTENING=1/298.257223563;HT.exports.POLAR_RADIUS=63567523142e-4});var uW=is(($tt,eR)=>{var aW=oW();eR.exports.geometry=cW;eR.exports.ring=J5;function cW(t){var e=0,r;switch(t.type){case"Polygon":return lW(t.coordinates);case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)e+=lW(t.coordinates[r]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<t.geometries.length;r++)e+=cW(t.geometries[r]);return e}}function lW(t){var e=0;if(t&&t.length>0){e+=Math.abs(J5(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(J5(t[r]))}return e}function J5(t){var e,r,i,n,s,a,c,h=0,p=t.length;if(p>2){for(c=0;c<p;c++)c===p-2?(n=p-2,s=p-1,a=0):c===p-1?(n=p-1,s=0,a=1):(n=c,s=c+1,a=c+2),e=t[n],r=t[s],i=t[a],h+=(Q5(i[0])-Q5(e[0]))*Math.sin(Q5(r[1]));h=h*aW.RADIUS*aW.RADIUS/2}return h}function Q5(t){return t*Math.PI/180}});var NW=is((jit,kW)=>{"use strict";kW.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var i,n,s;if(Array.isArray(e)){if(i=e.length,i!=r.length)return!1;for(n=i;n--!==0;)if(!t(e[n],r[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(s=Object.keys(e),i=s.length,i!==Object.keys(r).length)return!1;for(n=i;n--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[n]))return!1;for(n=i;n--!==0;){var a=s[n];if(!t(e[a],r[a]))return!1}return!0}return e!==e&&r!==r}});var UW=is((Git,zW)=>{zW.exports=c_e;var l_e={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function c_e(t){if(!t||!t.type)return null;var e=l_e[t.type];if(!e)return null;if(e==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]};if(e==="feature")return{type:"FeatureCollection",features:[t]};if(e==="featurecollection")return t}});var KA=_l(R2());var Lm=Math.pow,Lo=(t,e,r)=>new Promise((i,n)=>{var s=h=>{try{c(r.next(h))}catch(p){n(p)}},a=h=>{try{c(r.throw(h))}catch(p){n(p)}},c=h=>h.done?i(h.value):Promise.resolve(h.value).then(s,a);c((r=r.apply(t,e)).next())}),Ka=Uint8Array,Bm=Uint16Array,$q=Int32Array,a6=new Ka([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l6=new Ka([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qq=new Ka([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c6=function(t,e){for(var r=new Bm(31),i=0;i<31;++i)r[i]=e+=1<<t[i-1];for(var n=new $q(r[30]),i=1;i<30;++i)for(var s=r[i];s<r[i+1];++s)n[s]=s-r[i]<<5|i;return{b:r,r:n}},u6=c6(a6,2),h6=u6.b,Zq=u6.r;h6[28]=258,Zq[258]=28;var f6=c6(l6,0),Xq=f6.b,T1e=f6.r,iC=new Bm(32768);for(nn=0;nn<32768;++nn)Mh=(nn&43690)>>1|(nn&21845)<<1,Mh=(Mh&52428)>>2|(Mh&13107)<<2,Mh=(Mh&61680)>>4|(Mh&3855)<<4,iC[nn]=((Mh&65280)>>8|(Mh&255)<<8)>>1;var Mh,nn,f_=function(t,e,r){for(var i=t.length,n=0,s=new Bm(e);n<i;++n)t[n]&&++s[t[n]-1];var a=new Bm(e);for(n=1;n<e;++n)a[n]=a[n-1]+s[n-1]<<1;var c;if(r){c=new Bm(1<<e);var h=15-e;for(n=0;n<i;++n)if(t[n])for(var p=n<<4|t[n],x=e-t[n],T=a[t[n]-1]++<<x,R=T|(1<<x)-1;T<=R;++T)c[iC[T]>>h]=p}else for(c=new Bm(i),n=0;n<i;++n)t[n]&&(c[n]=iC[a[t[n]-1]++]>>15-t[n]);return c},d_=new Ka(288);for(nn=0;nn<144;++nn)d_[nn]=8;var nn;for(nn=144;nn<256;++nn)d_[nn]=9;var nn;for(nn=256;nn<280;++nn)d_[nn]=7;var nn;for(nn=280;nn<288;++nn)d_[nn]=8;var nn,d6=new Ka(32);for(nn=0;nn<32;++nn)d6[nn]=5;var nn,Yq=f_(d_,9,1),Kq=f_(d6,5,1),tC=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},xc=function(t,e,r){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(e&7)&r},rC=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},Qq=function(t){return(t+7)/8|0},Jq=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var i=new Ka(r-e);return i.set(t.subarray(e,r)),i},eZ=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ya=function(t,e,r){var i=new Error(e||eZ[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,Ya),!r)throw i;return i},oC=function(t,e,r,i){var n=t.length,s=i?i.length:0;if(!n||e.f&&!e.l)return r||new Ka(0);var a=!r||e.i!=2,c=e.i;r||(r=new Ka(n*3));var h=function(Wr){var Di=r.length;if(Wr>Di){var ui=new Ka(Math.max(Di*2,Wr));ui.set(r),r=ui}},p=e.f||0,x=e.p||0,T=e.b||0,R=e.l,k=e.d,j=e.m,q=e.n,X=n*8;do{if(!R){p=xc(t,x,1);var re=xc(t,x+1,3);if(x+=3,re)if(re==1)R=Yq,k=Kq,j=9,q=5;else if(re==2){var pe=xc(t,x,31)+257,be=xc(t,x+10,15)+4,Fe=pe+xc(t,x+5,31)+1;x+=14;for(var Y=new Ka(Fe),J=new Ka(19),Z=0;Z<be;++Z)J[qq[Z]]=xc(t,x+Z*3,7);x+=be*3;for(var xe=tC(J),_e=(1<<xe)-1,Be=f_(J,xe,1),Z=0;Z<Fe;){var Se=Be[xc(t,x,_e)];x+=Se&15;var te=Se>>4;if(te<16)Y[Z++]=te;else{var ke=0,Ye=0;for(te==16?(Ye=3+xc(t,x,3),x+=2,ke=Y[Z-1]):te==17?(Ye=3+xc(t,x,7),x+=3):te==18&&(Ye=11+xc(t,x,127),x+=7);Ye--;)Y[Z++]=ke}}var rt=Y.subarray(0,pe),tt=Y.subarray(pe);j=tC(rt),q=tC(tt),R=f_(rt,j,1),k=f_(tt,q,1)}else Ya(1);else{var te=Qq(x)+4,oe=t[te-4]|t[te-3]<<8,ae=te+oe;if(ae>n){c&&Ya(0);break}a&&h(T+oe),r.set(t.subarray(te,ae),T),e.b=T+=oe,e.p=x=ae*8,e.f=p;continue}if(x>X){c&&Ya(0);break}}a&&h(T+131072);for(var _t=(1<<j)-1,Zt=(1<<q)-1,Vt=x;;Vt=x){var ke=R[rC(t,x)&_t],cr=ke>>4;if(x+=ke&15,x>X){c&&Ya(0);break}if(ke||Ya(2),cr<256)r[T++]=cr;else if(cr==256){Vt=x,R=null;break}else{var Wt=cr-254;if(cr>264){var Z=cr-257,Lt=a6[Z];Wt=xc(t,x,(1<<Lt)-1)+h6[Z],x+=Lt}var vr=k[rC(t,x)&Zt],Pr=vr>>4;vr||Ya(3),x+=vr&15;var tt=Xq[Pr];if(Pr>3){var Lt=l6[Pr];tt+=rC(t,x)&(1<<Lt)-1,x+=Lt}if(x>X){c&&Ya(0);break}a&&h(T+131072);var dr=T+Wt;if(T<tt){var Nr=s-tt,Ai=Math.min(tt,dr);for(Nr+T<0&&Ya(3);T<Ai;++T)r[T]=i[Nr+T]}for(;T<dr;T+=4)r[T]=r[T-tt],r[T+1]=r[T+1-tt],r[T+2]=r[T+2-tt],r[T+3]=r[T+3-tt];T=dr}}e.l=R,e.p=Vt,e.b=T,e.f=p,R&&(p=1,e.m=j,e.d=k,e.n=q)}while(!p);return T==r.length?r:Jq(r,0,T)},tZ=new Ka(0),rZ=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&Ya(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[r++]);return r+(e&2)},iZ=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},nZ=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&Ya(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&Ya(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function sZ(t,e){return oC(t,{i:2},e&&e.out,e&&e.dictionary)}function oZ(t,e){var r=rZ(t);return r+8>t.length&&Ya(6,"invalid gzip data"),oC(t.subarray(r,-8),{i:2},e&&e.out||new Ka(iZ(t)),e&&e.dictionary)}function aZ(t,e){return oC(t.subarray(nZ(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function nC(t,e){return t[0]==31&&t[1]==139&&t[2]==8?oZ(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?sZ(t,e):aZ(t,e)}var lZ=typeof TextDecoder<"u"&&new TextDecoder,cZ=0;try{lZ.decode(tZ,{stream:!0}),cZ=1}catch{}var p6=(t,e)=>t*Lm(2,e),u_=(t,e)=>Math.floor(t/Lm(2,e)),B2=(t,e)=>p6(t.getUint16(e+1,!0),8)+t.getUint8(e),A6=(t,e)=>p6(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),uZ=(t,e,r,i,n)=>{if(t!==i.getUint8(n))return t-i.getUint8(n);let s=B2(i,n+1);if(e!==s)return e-s;let a=B2(i,n+4);return r!==a?r-a:0},hZ=(t,e,r,i)=>{let n=m6(t,e|128,r,i);return n?{z:e,x:r,y:i,offset:n[0],length:n[1],isDir:!0}:null},n6=(t,e,r,i)=>{let n=m6(t,e,r,i);return n?{z:e,x:r,y:i,offset:n[0],length:n[1],isDir:!1}:null},m6=(t,e,r,i)=>{let n=0,s=t.byteLength/17-1;for(;n<=s;){let a=s+n>>1,c=uZ(e,r,i,t,a*17);if(c>0)n=a+1;else if(c<0)s=a-1;else return[A6(t,a*17+7),t.getUint32(a*17+13,!0)]}return null},fZ=(t,e)=>t.isDir&&!e.isDir?1:!t.isDir&&e.isDir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,g6=(t,e)=>{let r=t.getUint8(e*17);return{z:r&127,x:B2(t,e*17+1),y:B2(t,e*17+4),offset:A6(t,e*17+7),length:t.getUint32(e*17+13,!0),isDir:r>>7===1}},s6=t=>{let e=[],r=new DataView(t);for(let i=0;i<r.byteLength/17;i++)e.push(g6(r,i));return dZ(e)},dZ=t=>{t.sort(fZ);let e=new ArrayBuffer(17*t.length),r=new Uint8Array(e);for(let i=0;i<t.length;i++){let n=t[i],s=n.z;n.isDir&&(s=s|128),r[i*17]=s,r[i*17+1]=n.x&255,r[i*17+2]=n.x>>8&255,r[i*17+3]=n.x>>16&255,r[i*17+4]=n.y&255,r[i*17+5]=n.y>>8&255,r[i*17+6]=n.y>>16&255,r[i*17+7]=n.offset&255,r[i*17+8]=u_(n.offset,8)&255,r[i*17+9]=u_(n.offset,16)&255,r[i*17+10]=u_(n.offset,24)&255,r[i*17+11]=u_(n.offset,32)&255,r[i*17+12]=u_(n.offset,48)&255,r[i*17+13]=n.length&255,r[i*17+14]=n.length>>8&255,r[i*17+15]=n.length>>16&255,r[i*17+16]=n.length>>24&255}return e},pZ=(t,e)=>{if(t.byteLength<17)return null;let r=t.byteLength/17,i=g6(t,r-1);if(i.isDir){let n=i.z,s=e.z-n,a=Math.trunc(e.x/(1<<s)),c=Math.trunc(e.y/(1<<s));return{z:n,x:a,y:c}}return null};function AZ(t){return Lo(this,null,function*(){let e=yield t.getBytes(0,512e3),r=new DataView(e.data),i=r.getUint32(4,!0),n=r.getUint16(8,!0),s=new TextDecoder("utf-8"),a=JSON.parse(s.decode(new DataView(e.data,10,i))),c=0;a.compression==="gzip"&&(c=2);let h=0;"minzoom"in a&&(h=+a.minzoom);let p=0;"maxzoom"in a&&(p=+a.maxzoom);let x=0,T=0,R=0,k=-180,j=-85,q=180,X=85;if(a.bounds){let te=a.bounds.split(",");k=+te[0],j=+te[1],q=+te[2],X=+te[3]}if(a.center){let te=a.center.split(",");x=+te[0],T=+te[1],R=+te[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:c,tileType:1,minZoom:h,maxZoom:p,minLon:k,minLat:j,maxLon:q,maxLat:X,centerZoom:R,centerLon:x,centerLat:T,etag:e.etag}})}function mZ(t,e,r,i,n,s,a){return Lo(this,null,function*(){let c=yield r.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(c=s6(c));let h=n6(new DataView(c),i,n,s);if(h){let T=(yield e.getBytes(h.offset,h.length,a)).data,R=new DataView(T);return R.getUint8(0)===31&&R.getUint8(1)===139&&(T=nC(new Uint8Array(T))),{data:T}}let p=pZ(new DataView(c),{z:i,x:n,y:s});if(p){let x=hZ(new DataView(c),p.z,p.x,p.y);if(x){let T=yield r.getArrayBuffer(e,x.offset,x.length,t);t.specVersion===1&&(T=s6(T));let R=n6(new DataView(T),i,n,s);if(R){let j=(yield e.getBytes(R.offset,R.length,a)).data,q=new DataView(j);return q.getUint8(0)===31&&q.getUint8(1)===139&&(j=nC(new Uint8Array(j))),{data:j}}}}})}var _6={getHeader:AZ,getZxy:mZ};var gZ=t=>(e,r)=>{if(r instanceof AbortController)return t(e,r);let i=new AbortController;return t(e,i).then(n=>r(void 0,n.data,n.cacheControl||"",n.expires||""),n=>r(n)).catch(n=>r(n)),{cancel:()=>i.abort()}},y6=class{constructor(t){this.tilev4=(e,r)=>Lo(this,null,function*(){if(e.type==="json"){let R=e.url.substr(10),k=this.tiles.get(R);if(k||(k=new o6(R),this.tiles.set(R,k)),this.metadata)return{data:yield k.getTileJson(e.url)};let j=yield k.getHeader();return{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:j.minZoom,maxzoom:j.maxZoom,bounds:[j.minLon,j.minLat,j.maxLon,j.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=e.url.match(i);if(!n)throw new Error("Invalid PMTiles protocol URL");let s=n[1],a=this.tiles.get(s);a||(a=new o6(s),this.tiles.set(s,a));let c=n[2],h=n[3],p=n[4],x=yield a.getHeader(),T=yield a?.getZxy(+c,+h,+p,r.signal);return T?{data:new Uint8Array(T.data),cacheControl:T.cacheControl,expires:T.expires}:x.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=gZ(this.tilev4),this.tiles=new Map,this.metadata=t?.metadata||!1}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};function Rm(t,e){return(e>>>0)*4294967296+(t>>>0)}function _Z(t,e){let r=e.buf,i=r[e.pos++],n=(i&112)>>4;if(i<128||(i=r[e.pos++],n|=(i&127)<<3,i<128)||(i=r[e.pos++],n|=(i&127)<<10,i<128)||(i=r[e.pos++],n|=(i&127)<<17,i<128)||(i=r[e.pos++],n|=(i&127)<<24,i<128)||(i=r[e.pos++],n|=(i&1)<<31,i<128))return Rm(t,n);throw new Error("Expected varint not more than 10 bytes")}function h_(t){let e=t.buf,r=e[t.pos++],i=r&127;return r<128||(r=e[t.pos++],i|=(r&127)<<7,r<128)||(r=e[t.pos++],i|=(r&127)<<14,r<128)||(r=e[t.pos++],i|=(r&127)<<21,r<128)?i:(r=e[t.pos],i|=(r&15)<<28,_Z(i,t))}function yZ(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}var xZ=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function bZ(t,e,r){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Lm(2,t)-1||r>Lm(2,t)-1)throw Error("tile x/y outside zoom level bounds");let i=xZ[t],n=Lm(2,t),s=0,a=0,c=0,h=[e,r],p=n/2;for(;p>0;)s=(h[0]&p)>0?1:0,a=(h[1]&p)>0?1:0,c+=p*p*(3*s^a),yZ(p,h,s,a),p=p/2;return i+c}function x6(t,e){return Lo(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return nC(new Uint8Array(t));let r=new Response(t).body;if(!r)throw Error("Failed to read response stream");let i=r.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw Error("Compression method not supported")})}function vZ(t){return t===1?".mvt":t===2?".png":t===3?".jpg":t===4?".webp":t===5?".avif":""}var wZ=127;function TZ(t,e){let r=0,i=t.length-1;for(;r<=i;){let n=i+r>>1,s=e-t[n].tileId;if(s>0)r=n+1;else if(s<0)i=n-1;else return t[n]}return i>=0&&(t[i].runLength===0||e-t[i].tileId<t[i].runLength)?t[i]:null}var EZ=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e,this.mustReload=!1;let r="";"navigator"in globalThis&&(r=globalThis.navigator.userAgent||"");let i=r.indexOf("Windows")>-1,n=/Chrome|Chromium|Edg|OPR|Brave/.test(r);this.chromeWindowsNoCache=!1,i&&n&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(t,e,r,i){return Lo(this,null,function*(){let n,s;r?s=r:(n=new AbortController,s=n.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${t}-${t+e-1}`);let c;this.mustReload?c="reload":this.chromeWindowsNoCache&&(c="no-store");let h=yield fetch(this.url,{signal:s,cache:c,headers:a});if(t===0&&h.status===416){let R=h.headers.get("Content-Range");if(!R||!R.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let k=+R.substr(8);h=yield fetch(this.url,{signal:s,cache:"reload",headers:{range:`bytes=0-${k-1}`}})}let p=h.headers.get("Etag");if(p?.startsWith("W/")&&(p=null),h.status===416||i&&p&&p!==i)throw this.mustReload=!0,new sC(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(h.status>=300)throw Error(`Bad response code: ${h.status}`);let x=h.headers.get("Content-Length");if(h.status===200&&(!x||+x>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield h.arrayBuffer(),etag:p||void 0,cacheControl:h.headers.get("Cache-Control")||void 0,expires:h.headers.get("Expires")||void 0}})}};function bc(t,e){let r=t.getUint32(e+4,!0),i=t.getUint32(e+0,!0);return r*Lm(2,32)+i}function CZ(t,e){let r=new DataView(t),i=r.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:bc(r,8),rootDirectoryLength:bc(r,16),jsonMetadataOffset:bc(r,24),jsonMetadataLength:bc(r,32),leafDirectoryOffset:bc(r,40),leafDirectoryLength:bc(r,48),tileDataOffset:bc(r,56),tileDataLength:bc(r,64),numAddressedTiles:bc(r,72),numTileEntries:bc(r,80),numTileContents:bc(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function b6(t){let e={buf:new Uint8Array(t),pos:0},r=h_(e),i=[],n=0;for(let s=0;s<r;s++){let a=h_(e);i.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let s=0;s<r;s++)i[s].runLength=h_(e);for(let s=0;s<r;s++)i[s].length=h_(e);for(let s=0;s<r;s++){let a=h_(e);a===0&&s>0?i[s].offset=i[s-1].offset+i[s-1].length:i[s].offset=a-1}return i}function SZ(t){let e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var sC=class extends Error{};function IZ(t,e){return Lo(this,null,function*(){let r=yield t.getBytes(0,16384);if(new DataView(r.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(SZ(r.data)<3)return[yield _6.getHeader(t)];let n=r.data.slice(0,wZ),s=CZ(n,r.etag),a=r.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),c=`${t.getKey()}|${s.etag||""}|${s.rootDirectoryOffset}|${s.rootDirectoryLength}`,h=b6(yield e(a,s.internalCompression));return[s,[c,h.length,h]]})}function MZ(t,e,r,i,n){return Lo(this,null,function*(){let s=yield t.getBytes(r,i,void 0,n.etag),a=yield e(s.data,n.internalCompression),c=b6(a);if(c.length===0)throw new Error("Empty directory is invalid");return c})}var PZ=class{constructor(t=100,e=!0,r=x6){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=r}getHeader(t){return Lo(this,null,function*(){let e=t.getKey(),r=this.cache.get(e);if(r)return r.lastUsed=this.counter++,yield r.data;let i=new Promise((n,s)=>{IZ(t,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),n(a[0]),this.prune()}).catch(a=>{s(a)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(t,e,r,i){return Lo(this,null,function*(){let n=`${t.getKey()}|${i.etag||""}|${e}|${r}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((c,h)=>{MZ(t,this.decompress,e,r,i).then(p=>{c(p),this.prune()}).catch(p=>{h(p)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}getArrayBuffer(t,e,r,i){return Lo(this,null,function*(){let n=`${t.getKey()}|${i.etag||""}|${e}|${r}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((c,h)=>{t.getBytes(e,r,void 0,i.etag).then(p=>{c(p.data),this.cache.has(n),this.prune()}).catch(p=>{h(p)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((r,i)=>{r.lastUsed<t&&(t=r.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(t){return Lo(this,null,function*(){let e=t.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(t.getKey());let r=new Promise((i,n)=>{this.getHeader(t).then(s=>{i(),this.invalidations.delete(e)}).catch(s=>{n(s)})});this.invalidations.set(e,r)})}},o6=class{constructor(t,e,r){typeof t=="string"?this.source=new EZ(t):this.source=t,r?this.decompress=r:this.decompress=x6,e?this.cache=e:this.cache=new PZ}getHeader(){return Lo(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,r,i){return Lo(this,null,function*(){let n=bZ(t,e,r),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return _6.getZxy(s,this.source,this.cache,t,e,r,i);if(t<s.minZoom||t>s.maxZoom)return;let a=s.rootDirectoryOffset,c=s.rootDirectoryLength;for(let h=0;h<=3;h++){let p=yield this.cache.getDirectory(this.source,a,c,s),x=TZ(p,n);if(x){if(x.runLength>0){let T=yield this.source.getBytes(s.tileDataOffset+x.offset,x.length,i,s.etag);return{data:yield this.decompress(T.data,s.tileCompression),cacheControl:T.cacheControl,expires:T.expires}}a=s.leafDirectoryOffset+x.offset,c=x.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,r,i){return Lo(this,null,function*(){try{return yield this.getZxyAttempt(t,e,r,i)}catch(n){if(n instanceof sC)return this.cache.invalidate(this.source),yield this.getZxyAttempt(t,e,r,i);throw n}})}getMetadataAttempt(){return Lo(this,null,function*(){let t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength,void 0,t.etag),r=yield this.decompress(e.data,t.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return Lo(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof sC)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw t}})}getTileJson(t){return Lo(this,null,function*(){let e=yield this.getHeader(),r=yield this.getMetadata(),i=vZ(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${t}/{z}/{x}/{y}${i}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};var TC=_l(R2(),1),RZ=Object.defineProperty,Q6=t=>{throw TypeError(t)},BZ=(t,e,r)=>e in t?RZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wr=(t,e,r)=>BZ(t,typeof e!="symbol"?e+"":e,r),J6=(t,e,r)=>e.has(t)||Q6("Cannot "+r),Cs=(t,e,r)=>(J6(t,e,"read from private field"),r?r.call(t):e.get(t)),aC=(t,e,r)=>e.has(t)?Q6("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),L2=(t,e,r,i)=>(J6(t,e,"write to private field"),i?i.call(t,r):e.set(t,r),r);function qn(){}function LZ(t,e){for(let r in e)t[r]=e[r];return t}function eL(t){return t()}function v6(){return Object.create(null)}function Oh(t){t.forEach(eL)}function tL(t){return typeof t=="function"}function td(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var O2;function jo(t,e){return t===e?!0:(O2||(O2=document.createElement("a")),O2.href=e,t===O2.href)}function OZ(t){return Object.keys(t).length===0}function DZ(t,e,r,i){if(t){let n=rL(t,e,r,i);return t[0](n)}}function rL(t,e,r,i){return t[1]&&i?LZ(r.ctx.slice(),t[1](i(e))):r.ctx}function FZ(t,e,r,i){return t[2],e.dirty}function kZ(t,e,r,i,n,s){if(n){let a=rL(e,r,i,s);t.p(a,n)}}function NZ(t){if(t.ctx.length>32){let e=[],r=t.ctx.length/32;for(let i=0;i<r;i++)e[i]=-1;return e}return-1}function H2(t){return t??""}function $i(t,e){t.appendChild(e)}function Zn(t,e,r){t.insertBefore(e,r||null)}function Gn(t){t.parentNode&&t.parentNode.removeChild(t)}function _n(t){return document.createElement(t)}function wc(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Jf(t){return document.createTextNode(t)}function Ja(){return Jf(" ")}function zZ(){return Jf("")}function to(t,e,r,i){return t.addEventListener(e,r,i),()=>t.removeEventListener(e,r,i)}function UZ(t){return function(e){return e.preventDefault(),t.call(this,e)}}function Ft(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function VZ(t){return Array.from(t.childNodes)}function b_(t,e){e=""+e,t.data!==e&&(t.data=e)}function w6(t,e){t.value=e??""}function yu(t,e,r){t.classList.toggle(e,!!r)}function jZ(t,e,{bubbles:r=!1,cancelable:i=!1}={}){return new CustomEvent(t,{detail:e,bubbles:r,cancelable:i})}var v_;function x_(t){v_=t}function iL(){if(!v_)throw new Error("Function called outside component initialization");return v_}function GZ(t){iL().$$.on_destroy.push(t)}function nL(){let t=iL();return(e,r,{cancelable:i=!1}={})=>{let n=t.$$.callbacks[e];if(n){let s=jZ(e,r,{cancelable:i});return n.slice().forEach(a=>{a.call(t,s)}),!s.defaultPrevented}return!0}}function HZ(t,e){let r=t.$$.callbacks[e.type];r&&r.slice().forEach(i=>i.call(this,e))}var Dm=[],hC=[],Fm=[],T6=[],WZ=Promise.resolve(),fC=!1;function $Z(){fC||(fC=!0,WZ.then(sL))}function dC(t){Fm.push(t)}var lC=new Set,Om=0;function sL(){if(Om!==0)return;let t=v_;do{try{for(;Om<Dm.length;){let e=Dm[Om];Om++,x_(e),qZ(e.$$)}}catch(e){throw Dm.length=0,Om=0,e}for(x_(null),Dm.length=0,Om=0;hC.length;)hC.pop()();for(let e=0;e<Fm.length;e+=1){let r=Fm[e];lC.has(r)||(lC.add(r),r())}Fm.length=0}while(Dm.length);for(;T6.length;)T6.pop()();fC=!1,lC.clear(),x_(t)}function qZ(t){if(t.fragment!==null){t.update(),Oh(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(dC)}}function ZZ(t){let e=[],r=[];Fm.forEach(i=>t.indexOf(i)===-1?e.push(i):r.push(i)),r.forEach(i=>i()),Fm=e}var z2=new Set,Pp;function U2(){Pp={r:0,c:[],p:Pp}}function V2(){Pp.r||Oh(Pp.c),Pp=Pp.p}function Ss(t,e){t&&t.i&&(z2.delete(t),t.i(e))}function go(t,e,r,i){if(t&&t.o){if(z2.has(t))return;z2.add(t),Pp.c.push(()=>{z2.delete(t),i&&(r&&t.d(1),i())}),t.o(e)}else i&&i()}function E6(t){return t?.length!==void 0?t:Array.from(t)}function XZ(t,e){go(t,1,1,()=>{e.delete(t.key)})}function YZ(t,e,r,i,n,s,a,c,h,p,x,T){let R=t.length,k=s.length,j=R,q={};for(;j--;)q[t[j].key]=j;let X=[],re=new Map,te=new Map,oe=[];for(j=k;j--;){let Fe=T(n,s,j),Y=r(Fe),J=a.get(Y);J?oe.push(()=>J.p(Fe,e)):(J=p(Y,Fe),J.c()),re.set(Y,X[j]=J),Y in q&&te.set(Y,Math.abs(j-q[Y]))}let ae=new Set,pe=new Set;function be(Fe){Ss(Fe,1),Fe.m(c,x),a.set(Fe.key,Fe),x=Fe.first,k--}for(;R&&k;){let Fe=X[k-1],Y=t[R-1],J=Fe.key,Z=Y.key;Fe===Y?(x=Fe.first,R--,k--):re.has(Z)?!a.has(J)||ae.has(J)?be(Fe):pe.has(Z)?R--:te.get(J)>te.get(Z)?(pe.add(J),be(Fe)):(ae.add(Z),R--):(h(Y,a),R--)}for(;R--;){let Fe=t[R];re.has(Fe.key)||h(Fe,a)}for(;k;)be(X[k-1]);return Oh(oe),X}function ed(t){t&&t.c()}function Rh(t,e,r){let{fragment:i,after_update:n}=t.$$;i&&i.m(e,r),dC(()=>{let s=t.$$.on_mount.map(eL).filter(tL);t.$$.on_destroy?t.$$.on_destroy.push(...s):Oh(s),t.$$.on_mount=[]}),n.forEach(dC)}function Bh(t,e){let r=t.$$;r.fragment!==null&&(ZZ(r.after_update),Oh(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function KZ(t,e){t.$$.dirty[0]===-1&&(Dm.push(t),$Z(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function rd(t,e,r,i,n,s,a=null,c=[-1]){let h=v_;x_(t);let p=t.$$={fragment:null,ctx:[],props:s,update:qn,not_equal:n,bound:v6(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:v6(),dirty:c,skip_bound:!1,root:e.target||h.$$.root};a&&a(p.root);let x=!1;if(p.ctx=r?r(t,e.props||{},(T,R,...k)=>{let j=k.length?k[0]:R;return p.ctx&&n(p.ctx[T],p.ctx[T]=j)&&(!p.skip_bound&&p.bound[T]&&p.bound[T](j),x&&KZ(t,T)),R}):[],p.update(),x=!0,Oh(p.before_update),p.fragment=i?i(p.ctx):!1,e.target){if(e.hydrate){let T=VZ(e.target);p.fragment&&p.fragment.l(T),T.forEach(Gn)}else p.fragment&&p.fragment.c();e.intro&&Ss(t.$$.fragment),Rh(t,e.target,e.anchor),sL()}x_(h)}var bu=class{constructor(){wr(this,"$$"),wr(this,"$$set")}$destroy(){Bh(this,1),this.$destroy=qn}$on(e,r){if(!tL(r))return qn;let i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(r),()=>{let n=i.indexOf(r);n!==-1&&i.splice(n,1)}}$set(e){this.$$set&&!OZ(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}},QZ="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(QZ);function JZ(t){let e,r;return{c(){e=wc("svg"),r=wc("path"),Ft(r,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Ft(e,"viewBox","0 0 14 14"),Ft(e,"width","13"),Ft(e,"height","13"),Ft(e,"class","svelte-en2qvf")},m(i,n){Zn(i,e,n),$i(e,r)},p:qn,i:qn,o:qn,d(i){i&&Gn(e)}}}var W2=class extends bu{constructor(e){super(),rd(this,e,null,JZ,td,{})}};function eX(t){let e,r;return{c(){e=wc("svg"),r=wc("path"),Ft(r,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Ft(e,"viewBox","0 0 30 30"),Ft(e,"fill","none"),Ft(e,"xmlns","http://www.w3.org/2000/svg"),Ft(e,"class","svelte-d2loi5")},m(i,n){Zn(i,e,n),$i(e,r)},p:qn,i:qn,o:qn,d(i){i&&Gn(e)}}}var $2=class extends bu{constructor(e){super(),rd(this,e,null,eX,td,{})}};function tX(t){let e,r;return{c(){e=_n("img"),jo(e.src,r=t[3]+"area.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!jo(e.src,r=i[3]+"area.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function rX(t){let e,r;return{c(){e=_n("img"),jo(e.src,r=t[3]+"reverse.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!jo(e.src,r=i[3]+"reverse.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function iX(t){let e,r;return{c(){e=_n("img"),jo(e.src,r=t[3]+"poi.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!jo(e.src,r=i[3]+"poi.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function nX(t){let e,r;return{c(){e=_n("img"),jo(e.src,r=t[3]+"postal_code.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!jo(e.src,r=i[3]+"postal_code.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function sX(t){let e,r;return{c(){e=_n("img"),jo(e.src,r=t[3]+"street.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!jo(e.src,r=i[3]+"street.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function oX(t){let e,r;return{c(){e=_n("img"),jo(e.src,r=t[3]+"road.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!jo(e.src,r=i[3]+"road.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function aX(t){let e,r;return{c(){e=_n("img"),jo(e.src,r=t[3]+"housenumber.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!jo(e.src,r=i[3]+"housenumber.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function lX(t){let e,r,i,n;return{c(){e=_n("img"),jo(e.src,r=t[5])||Ft(e,"src",r),Ft(e,"alt",t[4]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(s,a){Zn(s,e,a),i||(n=to(e,"error",t[14]),i=!0)},p(s,a){a&32&&!jo(e.src,r=s[5])&&Ft(e,"src",r),a&16&&Ft(e,"alt",s[4]),a&128&&Ft(e,"title",s[7])},d(s){s&&Gn(e),i=!1,n()}}}function cX(t){let e,r;return{c(){e=_n("div"),Ft(e,"class","sprite-icon svelte-w9y5n9"),Ft(e,"style",r=`
        width: ${t[6].width/yl}px;
        height: ${t[6].height/yl}px;
        background-image: url(${t[3]}sprite${pC}.png);
        background-position: -${t[6].x/yl}px -${t[6].y/yl}px;
        background-size: ${_u.width/yl}px ${_u.height/yl}px;
      `),Ft(e,"title",t[7])},m(i,n){Zn(i,e,n)},p(i,n){n&72&&r!==(r=`
        width: ${i[6].width/yl}px;
        height: ${i[6].height/yl}px;
        background-image: url(${i[3]}sprite${pC}.png);
        background-position: -${i[6].x/yl}px -${i[6].y/yl}px;
        background-size: ${_u.width/yl}px ${_u.height/yl}px;
      `)&&Ft(e,"style",r),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function C6(t){let e,r;return{c(){e=_n("span"),r=Jf(t[7]),Ft(e,"class","secondary svelte-w9y5n9")},m(i,n){Zn(i,e,n),$i(e,r)},p(i,n){n&128&&b_(r,i[7])},d(i){i&&Gn(e)}}}function uX(t){let e,r,i,n,s,a,c,h,p,x=(t[8]?t[0].place_name:t[0].place_name.replace(/,.*/,""))+"",T,R,k=t[2]==="always"||t[2]!=="never"&&!t[0].address&&!t[0].id.startsWith("road.")&&!t[0].id.startsWith("address.")&&!t[0].id.startsWith("postal_code.")&&(!t[0].id.startsWith("poi.")||!t[5])&&!t[8],j,q,X=(t[8]?"":t[0].place_name.replace(/[^,]*,?\s*/,""))+"",re,te,oe,ae,pe,be;function Fe(xe,_e){return _e&1&&(r=null),_e&1&&(i=null),_e&1&&(n=null),_e&1&&(s=null),_u&&xe[6]?cX:xe[5]?lX:xe[0].address?aX:(r==null&&(r=!!xe[0].id.startsWith("road.")),r?oX:(i==null&&(i=!!xe[0].id.startsWith("address.")),i?sX:(n==null&&(n=!!xe[0].id.startsWith("postal_code.")),n?nX:(s==null&&(s=!!xe[0].id.startsWith("poi.")),s?iX:xe[8]?rX:tX))))}let Y=Fe(t,-1),J=Y(t),Z=k&&C6(t);return{c(){e=_n("li"),J.c(),a=Ja(),c=_n("span"),h=_n("span"),p=_n("span"),T=Jf(x),R=Ja(),Z&&Z.c(),j=Ja(),q=_n("span"),re=Jf(X),Ft(p,"class","primary svelte-w9y5n9"),Ft(h,"class","svelte-w9y5n9"),Ft(q,"class","line2 svelte-w9y5n9"),Ft(c,"class","texts svelte-w9y5n9"),Ft(e,"tabindex","-1"),Ft(e,"role","option"),Ft(e,"aria-selected",te=t[1]==="selected"),Ft(e,"aria-checked",oe=t[1]==="picked"),Ft(e,"class",ae=H2(t[1])+" svelte-w9y5n9")},m(xe,_e){Zn(xe,e,_e),J.m(e,null),$i(e,a),$i(e,c),$i(c,h),$i(h,p),$i(p,T),$i(h,R),Z&&Z.m(h,null),$i(c,j),$i(c,q),$i(q,re),pe||(be=[to(e,"mouseenter",t[13]),to(e,"focus",t[15]),to(e,"click",t[16])],pe=!0)},p(xe,[_e]){Y===(Y=Fe(xe,_e))&&J?J.p(xe,_e):(J.d(1),J=Y(xe),J&&(J.c(),J.m(e,a))),_e&257&&x!==(x=(xe[8]?xe[0].place_name:xe[0].place_name.replace(/,.*/,""))+"")&&b_(T,x),_e&293&&(k=xe[2]==="always"||xe[2]!=="never"&&!xe[0].address&&!xe[0].id.startsWith("road.")&&!xe[0].id.startsWith("address.")&&!xe[0].id.startsWith("postal_code.")&&(!xe[0].id.startsWith("poi.")||!xe[5])&&!xe[8]),k?Z?Z.p(xe,_e):(Z=C6(xe),Z.c(),Z.m(h,null)):Z&&(Z.d(1),Z=null),_e&257&&X!==(X=(xe[8]?"":xe[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&b_(re,X),_e&2&&te!==(te=xe[1]==="selected")&&Ft(e,"aria-selected",te),_e&2&&oe!==(oe=xe[1]==="picked")&&Ft(e,"aria-checked",oe),_e&2&&ae!==(ae=H2(xe[1])+" svelte-w9y5n9")&&Ft(e,"class",ae)},i:qn,o:qn,d(xe){xe&&Gn(e),J.d(),Z&&Z.d(),pe=!1,Oh(be)}}}var oL=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,pC=oL?"@2x":"",yl=oL?2:1,_u,D2;function hX(t,e,r){let i,n,s,{feature:a}=e,{style:c="default"}=e,{showPlaceType:h}=e,{missingIconsCache:p}=e,{iconsBaseUrl:x}=e,T=nL(),R,k,j,q;function X(){D2??(D2=fetch(`${x}sprite${pC}.json`).then(Y=>Y.json()).then(Y=>{_u=Y}).catch(()=>{_u=null}))}function re(){k&&p.add(k),te()}function te(){_u!==void 0?oe():(X(),D2?.then(oe))}function oe(){do{if(q--,r(4,R=i?.[q]),r(6,j=R?_u?.icons[R]:void 0),j)break;r(5,k=R?x+R.replace(/ /g,"_")+".svg":void 0)}while(q>-1&&(!k||p.has(k)))}function ae(Y){HZ.call(this,t,Y)}let pe=()=>re(),be=()=>T("select",void 0),Fe=Y=>{document.activeElement!==Y.target&&T("select",void 0)};return t.$$set=Y=>{"feature"in Y&&r(0,a=Y.feature),"style"in Y&&r(1,c=Y.style),"showPlaceType"in Y&&r(2,h=Y.showPlaceType),"missingIconsCache"in Y&&r(11,p=Y.missingIconsCache),"iconsBaseUrl"in Y&&r(3,x=Y.iconsBaseUrl)},t.$$.update=()=>{var Y,J,Z,xe,_e;t.$$.dirty&1&&r(12,i=(Y=a.properties)==null?void 0:Y.categories),t.$$.dirty&1&&r(8,n=a.place_type[0]==="reverse"),t.$$.dirty&1&&r(7,s=((Z=(J=a.properties)==null?void 0:J.categories)==null?void 0:Z.join(", "))??((_e=(xe=a.properties)==null?void 0:xe.place_type_name)==null?void 0:_e[0])??a.place_type[0]),t.$$.dirty&4096&&(q=i?.length??0,te())},[a,c,h,x,R,k,j,s,n,T,re,p,i,ae,pe,be,Fe]}var AC=class extends bu{constructor(e){super(),rd(this,e,hX,uX,td,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}};function fX(t){let e;return{c(){e=_n("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Ft(e,"class","svelte-7cmwmc")},m(r,i){Zn(r,e,i)},p:qn,i:qn,o:qn,d(r){r&&Gn(e)}}}var mC=class extends bu{constructor(e){super(),rd(this,e,null,fX,td,{})}};function dX(t){let e,r,i;return{c(){e=wc("svg"),r=wc("path"),Ft(r,"stroke-width","4"),Ft(r,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Ft(r,"class","svelte-gzo3ar"),Ft(e,"width",i=t[0]==="list"?20:void 0),Ft(e,"viewBox","0 0 70 85"),Ft(e,"fill","none"),Ft(e,"class","svelte-gzo3ar"),yu(e,"in-map",t[0]!=="list"),yu(e,"list-icon",t[0]==="list")},m(n,s){Zn(n,e,s),$i(e,r)},p(n,[s]){s&1&&i!==(i=n[0]==="list"?20:void 0)&&Ft(e,"width",i),s&1&&yu(e,"in-map",n[0]!=="list"),s&1&&yu(e,"list-icon",n[0]==="list")},i:qn,o:qn,d(n){n&&Gn(e)}}}function pX(t,e,r){let{displayIn:i}=e;return t.$$set=n=>{"displayIn"in n&&r(0,i=n.displayIn)},[i]}var gC=class extends bu{constructor(e){super(),rd(this,e,pX,dX,td,{displayIn:0})}};function AX(t){let e,r;return{c(){e=wc("svg"),r=wc("path"),Ft(r,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Ft(e,"viewBox","0 0 60.006 21.412"),Ft(e,"width","14"),Ft(e,"height","20"),Ft(e,"class","svelte-en2qvf")},m(i,n){Zn(i,e,n),$i(e,r)},p:qn,i:qn,o:qn,d(i){i&&Gn(e)}}}var _C=class extends bu{constructor(e){super(),rd(this,e,null,AX,td,{})}};function mX(t){let e,r,i;return{c(){e=wc("svg"),r=wc("circle"),i=wc("path"),Ft(r,"cx","4.789"),Ft(r,"cy","4.787"),Ft(r,"r","3.85"),Ft(r,"class","svelte-1aq105l"),Ft(i,"d","M12.063 12.063 7.635 7.635"),Ft(i,"class","svelte-1aq105l"),Ft(e,"xmlns","http://www.w3.org/2000/svg"),Ft(e,"width","13"),Ft(e,"height","13"),Ft(e,"viewBox","0 0 13 13"),Ft(e,"class","svelte-1aq105l")},m(n,s){Zn(n,e,s),$i(e,r),$i(e,i)},p:qn,i:qn,o:qn,d(n){n&&Gn(e)}}}var yC=class extends bu{constructor(e){super(),rd(this,e,null,mX,td,{})}};function gX(t,e,r){let i=e[1],n=e[0],s=i-n;return t===i&&r?t:((t-n)%s+s)%s+n}function q2(t){let e=[...t];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}var p_;async function _X(t,e,r){let i=t?.getCenterAndZoom();for(let n of e??[])if(!(i&&(n.minZoom!=null&&n.minZoom>i[0]||n.maxZoom!=null&&n.maxZoom<i[0]))){if(n.type==="fixed")return n.coordinates.join(",");e:if(n.type==="client-geolocation"){if(p_&&n.cachedLocationExpiry&&p_.time+n.cachedLocationExpiry>Date.now()){if(!p_.coords)break e;return p_.coords}let s;try{return s=await new Promise((a,c)=>{r.signal.addEventListener("abort",()=>{c(Error("aborted"))}),navigator.geolocation.getCurrentPosition(h=>{a([h.coords.longitude,h.coords.latitude].map(p=>p.toFixed(6)).join(","))},h=>{c(h)},n)}),s}catch{}finally{n.cachedLocationExpiry&&(p_={time:Date.now(),coords:s})}if(r.signal.aborted)return}if(n.type==="server-geolocation")return"ip";if(i&&n.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}var yX=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,S6=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,I6=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,M6=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,P6=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,R6=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function xX(t){if(!["DMS","DM","DD"].includes(t))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){let e=this.decimalCoordinates.split(",").map(k=>Number(k.trim())),r=Number(e[0]),i=Number(e[1]),n=Math.abs(r),s=Math.abs(i),a=r>0?"N":"S",c=i>0?"E":"W",h;t=="DD"&&(h=`${n}\xB0 ${a}, ${s}\xB0 ${c}`);let p=Math.floor(n),x=Math.floor(s),T=(n-p)*60,R=(s-x)*60;if(t=="DM"){let k=B6(T,3).toFixed(3).padStart(6,"0"),j=B6(R,3).toFixed(3).padStart(6,"0");k.endsWith(".000")&&j.endsWith(".000")&&(k=k.replace(/\.000$/,""),j=j.replace(/\.000$/,"")),h=`${p}\xB0 ${k}' ${a}, ${x}\xB0 ${j}' ${c}`}if(t=="DMS"){let k=Math.floor(T),j=Math.floor(R),q=((T-k)*60).toFixed(1).padStart(4,"0"),X=((R-j)*60).toFixed(1).padStart(4,"0"),re=k.toString().padStart(2,"0"),te=j.toString().padStart(2,"0");q.endsWith(".0")&&X.endsWith(".0")&&(q=q.replace(/\.0$/,""),X=X.replace(/\.0$/,"")),h=`${p}\xB0 ${re}' ${q}" ${a}, ${x}\xB0 ${te}' ${X}" ${c}`}return h}else throw new Error("no decimal coordinates to convert")}function B6(t,e){let r=Math.pow(10,e);return Math.round((t+Number.EPSILON)*r)/r}function EC(t,e){e||(e=5),t=t.replace(/\s+/g," ").trim();let r=null,i=null,n="",s="",a=null,c=[],h=!1;if(yX.test(t))throw new Error("invalid coordinate value");if(S6.test(t))if(c=S6.exec(t),h=A_(c),h)r=Math.abs(c[1])+c[2]/60,Number(c[1])<0&&(r*=-1),i=Math.abs(c[3])+c[4]/60,Number(c[3])<0&&(i*=-1),a="DM";else throw new Error("invalid coordinate format");else if(I6.test(t))if(c=I6.exec(t),h=A_(c),h){if(r=c[2],i=c[6],r.includes(",")&&(r=r.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),a="DD",Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");c[1]?(n=c[1],s=c[5]):c[4]&&(n=c[4],s=c[8])}else throw new Error("invalid decimal coordinate format");else if(M6.test(t))if(c=M6.exec(t),h=A_(c),h)r=Math.abs(parseInt(c[2])),c[4]&&(r+=c[4]/60,a="DM"),c[6]&&(r+=c[6].replace(",",".")/3600,a="DMS"),parseInt(c[2])<0&&(r=-1*r),i=Math.abs(parseInt(c[9])),c[11]&&(i+=c[11]/60),c[13]&&(i+=c[13].replace(",",".")/3600),parseInt(c[9])<0&&(i=-1*i),c[1]?(n=c[1],s=c[8]):c[7]&&(n=c[7],s=c[14]);else throw new Error("invalid DMS coordinates format");else if(P6.test(t))if(c=P6.exec(t),h=A_(c),h)r=Math.abs(parseInt(c[2])),c[4]&&(r+=c[4]/60,a="DM"),c[6]&&(r+=c[6]/3600,a="DMS"),parseInt(c[2])<0&&(r=-1*r),i=Math.abs(parseInt(c[10])),c[12]&&(i+=c[12]/60),c[14]&&(i+=c[14]/3600),parseInt(c[10])<0&&(i=-1*i),c[1]?(n=c[1],s=c[9]):c[8]&&(n=c[8],s=c[16]);else throw new Error("invalid DMS coordinates format");else if(R6.test(t)){if(c=R6.exec(t),h=A_(c),c.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(h)r=Math.abs(parseInt(c[2])),c[4]&&(r+=c[4].replace(",",".")/60,a="DM"),c[6]&&(r+=c[6].replace(",",".")/3600,a="DMS"),parseInt(c[2])<0&&(r=-1*r),i=Math.abs(parseInt(c[10])),c[12]&&(i+=c[12].replace(",",".")/60),c[14]&&(i+=c[14].replace(",",".")/3600),parseInt(c[10])<0&&(i=-1*i),c[1]?(n=c[1],s=c[9]):c[8]&&(n=c[8],s=c[16]);else throw new Error("invalid coordinates format")}if(h){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(r)>=90)throw new Error("invalid latitude value");if(n&&!s||!n&&s)throw new Error("invalid coordinates value");if(n&&n==s)throw new Error("invalid coordinates format");r.toString().includes(",")&&(r=r.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let p=/S|SOUTH/i;p.test(n)&&r>0&&(r=-1*r),p=/W|WEST/i,p.test(s)&&i>0&&(i=-1*i);let x=c[0].trim(),T,R,k=/[,/;\u0020]/g,j=x.match(k);if(j==null){let re=Math.floor(t.length/2);T=x.substring(0,re).trim(),R=x.substring(re).trim()}else{let re;j.length%2==1?re=Math.floor(j.length/2):re=j.length/2-1;let te=0;if(re==0)te=x.indexOf(j[0]),T=x.substring(0,te).trim(),R=x.substring(te+1).trim();else{let oe=0,ae=0;for(;oe<=re;)te=x.indexOf(j[oe],ae),ae=te+1,oe++;T=x.substring(0,te).trim(),R=x.substring(te+1).trim()}}let q=T.split(".");if(q.length==2&&q[1]==0&&q[1].length!=2)throw new Error("invalid coordinates format");let X=R.split(".");if(X.length==2&&X[1]==0&&X[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(T)||/^\d+$/.test(R))throw new Error("degree only coordinate/s provided");return r=Number(Number(r).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:x,verbatimLatitude:T,verbatimLongitude:R,decimalLatitude:r,decimalLongitude:i,decimalCoordinates:`${r},${i}`,originalFormat:a,closeEnough:bX,toCoordinateFormat:xX})}else throw new Error("coordinates pattern match failed")}function A_(t){if(!isNaN(t[0]))return!1;let e=[...t];if(e.shift(),e.length%2>0)return!1;let r=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,n=e.length/2;for(let s=0;s<n;s++){let a=e[s],c=e[s+n],h=r.test(a)&&r.test(c),p=i.test(a)&&i.test(c),x=a==c;if(!(a==null&&c==null)){if(a==null||c==null)return!1;if(h||p||x)continue;return!1}}return!0}function L6(t,e){let r=Math.abs(t-e);return Number(r.toFixed(6))<=1e-5}function bX(t){if(!t)throw new Error("coords must be provided");if(t.includes(",")){let e=t.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return L6(this.decimalLatitude,Number(e[0]))&&L6(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}var vX=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});EC.to=vX;var wX=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123\xB0 N 74.123\xB0 W",verbatimLatitude:"40.123\xB0 N",verbatimLongitude:"74.123\xB0 W"},{verbatimCoordinates:"40.123\xB0 N 74.123\xB0 W",verbatimLatitude:"40.123\xB0 N",verbatimLongitude:"74.123\xB0 W"},{verbatimCoordinates:'40\xB0 7\xB4 22.8" N 74\xB0 7\xB4 22.8" W',verbatimLatitude:'40\xB0 7\xB4 22.8" N',verbatimLongitude:'74\xB0 7\xB4 22.8" W'},{verbatimCoordinates:"40\xB0 7.38\u2019 , -74\xB0 7.38\u2019",verbatimLatitude:"40\xB0 7.38\u2019",verbatimLongitude:"-74\xB0 7.38\u2019"},{verbatimCoordinates:"N40\xB07\u201922.8\u2019\u2019, W74\xB07\u201922.8\u2019\u2019",verbatimLatitude:"N40\xB07\u201922.8\u2019\u2019",verbatimLongitude:"W74\xB07\u201922.8\u2019\u2019"},{verbatimCoordinates:'40\xB07\u201922.8"N, 74\xB07\u201922.8"W',verbatimLatitude:'40\xB07\u201922.8"N',verbatimLongitude:'74\xB07\u201922.8"W'},{verbatimCoordinates:`40\xB07'22.8"N, 74\xB07'22.8"W`,verbatimLatitude:`40\xB07'22.8"N`,verbatimLongitude:`74\xB07'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123\xB0,-74.123\xB0",verbatimLatitude:"40.123\xB0",verbatimLongitude:"-74.123\xB0"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40\xB07\u201922.8"N, 74\xB07\u201922.8"W',verbatimLatitude:'40\xB07\u201922.8"N',verbatimLongitude:'74\xB07\u201922.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40\xB07\u201923"N 74\xB07\u201923"W',verbatimLatitude:'40\xB07\u201923"N',verbatimLongitude:'74\xB07\u201923"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40\xB07\u201923"S 74\xB07\u201923"E',verbatimLatitude:'40\xB07\u201923"S',verbatimLongitude:'74\xB07\u201923"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40\xB07\u201923" -74\xB07\u201923"',verbatimLatitude:'40\xB07\u201923"',verbatimLongitude:'-74\xB07\u201923"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7\u2019 23" N 74d 7\u2019 23" W',verbatimLatitude:'40d 7\u2019 23" N',verbatimLongitude:'74d 7\u2019 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40\xB0 7.38, -74\xB0 7.38",verbatimLatitude:"40\xB0 7.38",verbatimLongitude:"-74\xB0 7.38"},{verbatimCoordinates:"40\xB0 7.38, -74\xB0 7.38",verbatimLatitude:"40\xB0 7.38",verbatimLongitude:"-74\xB0 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],TX={decimalLatitude:40.123,decimalLongitude:-74.123},EX=[{verbatimCoordinates:`50\xB04'17.698"south, 14\xB024'2.826"east`,verbatimLatitude:`50\xB04'17.698"south`,verbatimLongitude:`14\xB024'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40\xB026\u203247\u2033N 79\xB058\u203236\u2033W",verbatimLatitude:"40\xB026\u203247\u2033N",verbatimLongitude:"79\xB058\u203236\u2033W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26\u2032 47\u2033 N 79d 58\u2032 36\u2033 W",verbatimLatitude:"40d 26\u2032 47\u2033 N",verbatimLongitude:"79d 58\u2032 36\u2033 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195\xB0 79,948862\xB0",verbatimLatitude:"40,446195\xB0",verbatimLongitude:"79,948862\xB0",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40\xB0 26.7717, -79\xB0 56.93172",verbatimLatitude:"40\xB0 26.7717",verbatimLongitude:"-79\xB0 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18\xB024S 22\xB045E",verbatimLatitude:"18\xB024S",verbatimLongitude:"22\xB045E",decimalLatitude:-18.4,decimalLongitude:22.75}],CX=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245\xB0 S / 28.2344\xB0 E",verbatimLatitude:"-23.3245\xB0 S",verbatimLongitude:"28.2344\xB0 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40\xB0 26.7717 -79\xB0 56.93172",verbatimLatitude:"40\xB0 26.7717",verbatimLongitude:"-79\xB0 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 \xB0  E22.45634 \xB0",verbatimLatitude:"S23.43563 \xB0",verbatimLongitude:"E22.45634 \xB0",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372\xB0 S 23,07771\xB0 E",verbatimLatitude:"27,71372\xB0 S",verbatimLongitude:"23,07771\xB0 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48\xB0 30,6410', E 18\xB0 57,4583'",verbatimLatitude:"N 48\xB0 30,6410'",verbatimLongitude:"E 18\xB0 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function SX(){let t=[];return wX.forEach(e=>{e.decimalLatitude?t.push(e):t.push({...e,...TX})}),[...t,...EX,...CX]}var IX=SX();EC.formats=IX.map(t=>t.verbatimCoordinates);var MX=EC;function O6(t,e,r){let i=t.slice();return i[97]=e[r],i[99]=r,i}function D6(t){let e,r;return e=new mC({}),{c(){ed(e.$$.fragment)},m(i,n){Rh(e,i,n),r=!0},i(i){r||(Ss(e.$$.fragment,i),r=!0)},o(i){go(e.$$.fragment,i),r=!1},d(i){Bh(e,i)}}}function F6(t){let e,r,i,n,s;return r=new _C({}),{c(){e=_n("button"),ed(r.$$.fragment),Ft(e,"type","button"),Ft(e,"title",t[10]),Ft(e,"class","svelte-bz0zu3"),yu(e,"active",t[0])},m(a,c){Zn(a,e,c),Rh(r,e,null),i=!0,n||(s=to(e,"click",t[79]),n=!0)},p(a,c){(!i||c[0]&1024)&&Ft(e,"title",a[10]),(!i||c[0]&1)&&yu(e,"active",a[0])},i(a){i||(Ss(r.$$.fragment,a),i=!0)},o(a){go(r.$$.fragment,a),i=!1},d(a){a&&Gn(e),Bh(r),n=!1,s()}}}function PX(t){let e,r=[],i=new Map,n,s,a,c=E6(t[13]),h=p=>p[97].id+(p[97].address?","+p[97].address:"");for(let p=0;p<c.length;p+=1){let x=O6(t,c,p),T=h(x);i.set(T,r[p]=k6(T,x))}return{c(){e=_n("ul");for(let p=0;p<r.length;p+=1)r[p].c();Ft(e,"class","options svelte-bz0zu3"),Ft(e,"role","listbox")},m(p,x){Zn(p,e,x);for(let T=0;T<r.length;T+=1)r[T]&&r[T].m(e,null);n=!0,s||(a=[to(e,"mouseleave",t[27]),to(e,"blur",t[83]),to(e,"keydown",t[23])],s=!0)},p(p,x){x[0]&102823936&&(c=E6(p[13]),U2(),r=YZ(r,x,h,1,p,c,i,e,XZ,k6,null,O6),V2())},i(p){if(!n){for(let x=0;x<c.length;x+=1)Ss(r[x]);n=!0}},o(p){for(let x=0;x<r.length;x+=1)go(r[x]);n=!1},d(p){p&&Gn(e);for(let x=0;x<r.length;x+=1)r[x].d();s=!1,Oh(a)}}}function RX(t){let e,r,i,n,s,a;return r=new $2({}),{c(){e=_n("div"),ed(r.$$.fragment),i=Ja(),n=_n("div"),s=Jf(t[8]),Ft(n,"class","svelte-bz0zu3"),Ft(e,"class","no-results svelte-bz0zu3")},m(c,h){Zn(c,e,h),Rh(r,e,null),$i(e,i),$i(e,n),$i(n,s),a=!0},p(c,h){(!a||h[0]&256)&&b_(s,c[8])},i(c){a||(Ss(r.$$.fragment,c),a=!0)},o(c){go(r.$$.fragment,c),a=!1},d(c){c&&Gn(e),Bh(r)}}}function BX(t){let e="",r;return{c(){r=Jf(e)},m(i,n){Zn(i,r,n)},p:qn,i:qn,o:qn,d(i){i&&Gn(r)}}}function LX(t){let e,r,i,n,s,a,c,h,p,x,T;return r=new $2({}),h=new W2({}),{c(){e=_n("div"),ed(r.$$.fragment),i=Ja(),n=_n("div"),s=Jf(t[7]),a=Ja(),c=_n("button"),ed(h.$$.fragment),Ft(n,"class","svelte-bz0zu3"),Ft(c,"class","svelte-bz0zu3"),Ft(e,"class","error svelte-bz0zu3")},m(R,k){Zn(R,e,k),Rh(r,e,null),$i(e,i),$i(e,n),$i(n,s),$i(e,a),$i(e,c),Rh(h,c,null),p=!0,x||(T=to(c,"click",t[80]),x=!0)},p(R,k){(!p||k[0]&128)&&b_(s,R[7])},i(R){p||(Ss(r.$$.fragment,R),Ss(h.$$.fragment,R),p=!0)},o(R){go(r.$$.fragment,R),go(h.$$.fragment,R),p=!1},d(R){R&&Gn(e),Bh(r),Bh(h),x=!1,T()}}}function k6(t,e){var r;let i,n,s;function a(){return e[81](e[99])}function c(){return e[82](e[97])}return n=new AC({props:{feature:e[97],showPlaceType:e[11],style:e[15]===e[99]?"selected":((r=e[14])==null?void 0:r.id)===e[97].id?"picked":"default",missingIconsCache:e[21],iconsBaseUrl:e[12]}}),n.$on("mouseenter",a),n.$on("select",c),{key:t,first:null,c(){i=zZ(),ed(n.$$.fragment),this.first=i},m(h,p){Zn(h,i,p),Rh(n,h,p),s=!0},p(h,p){var x;e=h;let T={};p[0]&8192&&(T.feature=e[97]),p[0]&2048&&(T.showPlaceType=e[11]),p[0]&57344&&(T.style=e[15]===e[99]?"selected":((x=e[14])==null?void 0:x.id)===e[97].id?"picked":"default"),p[0]&4096&&(T.iconsBaseUrl=e[12]),n.$set(T)},i(h){s||(Ss(n.$$.fragment,h),s=!0)},o(h){go(n.$$.fragment,h),s=!1},d(h){h&&Gn(i),Bh(n,h)}}}function OX(t){let e,r,i,n,s,a,c,h,p,x,T,R,k,j,q,X,re,te,oe,ae,pe,be=!1;s=new yC({}),T=new W2({});let Fe=t[20]&&D6(),Y=t[6]==="button"&&F6(t),J=t[70].default,Z=DZ(J,t,t[69],null),xe=[LX,BX,RX,PX],_e=[];function Be(Se,ke){var Ye,rt;return Se[19]?0:!Se[16]&&!Se[4]?1:((Ye=Se[13])==null?void 0:Ye.length)===0?2:(rt=Se[13])!=null&&rt.length&&(Se[16]||Se[4])?3:-1}return~(X=Be(t))&&(re=_e[X]=xe[X](t)),{c(){e=Ja(),r=_n("form"),i=_n("div"),n=_n("button"),ed(s.$$.fragment),a=Ja(),c=_n("input"),h=Ja(),p=_n("div"),x=_n("button"),ed(T.$$.fragment),R=Ja(),Fe&&Fe.c(),k=Ja(),Y&&Y.c(),j=Ja(),Z&&Z.c(),q=Ja(),re&&re.c(),Ft(n,"class","search-button svelte-bz0zu3"),Ft(n,"type","button"),Ft(c,"placeholder",t[9]),Ft(c,"aria-label",t[9]),Ft(c,"class","svelte-bz0zu3"),Ft(x,"type","button"),Ft(x,"title",t[3]),Ft(x,"class","svelte-bz0zu3"),Ft(p,"class","clear-button-container svelte-bz0zu3"),yu(p,"displayable",t[1]!==""),Ft(i,"class","input-group svelte-bz0zu3"),Ft(r,"class",te=H2(t[2])+" svelte-bz0zu3"),yu(r,"can-collapse",t[5]&&t[1]==="")},m(Se,ke){Zn(Se,e,ke),Zn(Se,r,ke),$i(r,i),$i(i,n),Rh(s,n,null),$i(i,a),$i(i,c),t[72](c),w6(c,t[1]),$i(i,h),$i(i,p),$i(p,x),Rh(T,x,null),$i(p,R),Fe&&Fe.m(p,null),$i(i,k),Y&&Y.m(i,null),$i(i,j),Z&&Z.m(i,null),$i(r,q),~X&&_e[X].m(r,null),oe=!0,ae||(pe=[to(n,"click",t[71]),to(c,"input",t[73]),to(c,"focus",t[74]),to(c,"blur",t[75]),to(c,"click",t[76]),to(c,"keydown",t[23]),to(c,"input",t[24]),to(c,"change",t[77]),to(x,"click",t[78]),to(r,"submit",UZ(t[22]))],ae=!0)},p(Se,ke){(!oe||ke[0]&512)&&Ft(c,"placeholder",Se[9]),(!oe||ke[0]&512)&&Ft(c,"aria-label",Se[9]),ke[0]&2&&c.value!==Se[1]&&w6(c,Se[1]),(!oe||ke[0]&8)&&Ft(x,"title",Se[3]),Se[20]?Fe?ke[0]&1048576&&Ss(Fe,1):(Fe=D6(),Fe.c(),Ss(Fe,1),Fe.m(p,null)):Fe&&(U2(),go(Fe,1,1,()=>{Fe=null}),V2()),(!oe||ke[0]&2)&&yu(p,"displayable",Se[1]!==""),Se[6]==="button"?Y?(Y.p(Se,ke),ke[0]&64&&Ss(Y,1)):(Y=F6(Se),Y.c(),Ss(Y,1),Y.m(i,j)):Y&&(U2(),go(Y,1,1,()=>{Y=null}),V2()),Z&&Z.p&&(!oe||ke[2]&128)&&kZ(Z,J,Se,Se[69],oe?FZ(J,Se[69],ke,null):NZ(Se[69]),null);let Ye=X;X=Be(Se),X===Ye?~X&&_e[X].p(Se,ke):(re&&(U2(),go(_e[Ye],1,1,()=>{_e[Ye]=null}),V2()),~X?(re=_e[X],re?re.p(Se,ke):(re=_e[X]=xe[X](Se),re.c()),Ss(re,1),re.m(r,null)):re=null),(!oe||ke[0]&4&&te!==(te=H2(Se[2])+" svelte-bz0zu3"))&&Ft(r,"class",te),(!oe||ke[0]&38)&&yu(r,"can-collapse",Se[5]&&Se[1]==="")},i(Se){oe||(Ss(be),Ss(s.$$.fragment,Se),Ss(T.$$.fragment,Se),Ss(Fe),Ss(Y),Ss(Z,Se),Ss(re),oe=!0)},o(Se){go(be),go(s.$$.fragment,Se),go(T.$$.fragment,Se),go(Fe),go(Y),go(Z,Se),go(re),oe=!1},d(Se){Se&&(Gn(e),Gn(r)),Bh(s),t[72](null),Bh(T),Fe&&Fe.d(),Y&&Y.d(),Z&&Z.d(Se),~X&&_e[X].d(),ae=!1,Oh(pe)}}}function DX(t,e,r){let i,n,s,{$$slots:a={},$$scope:c}=e,h={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13},{class:p=void 0}=e,{apiKey:x}=e,{bbox:T=void 0}=e,{clearButtonTitle:R="clear"}=e,{clearOnBlur:k=!1}=e,{clearListOnPick:j=!1}=e,{keepListOpen:q=!1}=e,{collapsed:X=!1}=e,{country:re=void 0}=e,{debounceSearch:te=200}=e,{enableReverse:oe="never"}=e,{errorMessage:ae="Something went wrong\u2026"}=e,{filter:pe=()=>!0}=e,{flyTo:be=!0}=e,{fuzzyMatch:Fe=!0}=e,{language:Y=void 0}=e,{limit:J=void 0}=e,Z=41415112612,{reverseGeocodingLimit:xe=Z}=e,{mapController:_e=void 0}=e,{minLength:Be=2}=e,{noResultsMessage:Se="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ke="Search"}=e,{proximity:Ye=[{type:"server-geolocation"}]}=e,{reverseActive:rt=oe==="always"}=e,{reverseButtonTitle:tt="toggle reverse geocoding"}=e,{searchValue:_t=""}=e,{pickedResultStyle:Zt="full-geometry"}=e,{showPlaceType:Vt="if-needed"}=e,{showResultsWhileTyping:cr=!0}=e,{selectFirst:Wt=!0}=e,{flyToSelected:Lt=!1}=e,{markerOnSelected:vr=!0}=e,{types:Pr=void 0}=e,dr=[],{reverseGeocodingTypes:Nr=dr}=e,{exhaustiveReverseGeocoding:Ai=!1}=e,{excludeTypes:Wr=!1}=e,Di=void 0,{reverseGeocodingExcludeTypes:ui=Di}=e,{zoom:tn=h}=e,{apiUrl:Ni="https://api.maptiler.com/geocoding"}=e,{fetchParameters:oi={}}=e,{iconsBaseUrl:Eo="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.6/icons/"}=e,{adjustUrlQuery:qs=()=>{}}=e,{adjustUrl:ls=()=>{}}=e;function Zs(Ct){ai.focus(Ct)}function Aa(){ai.blur()}function _s(Ct,Kr=!0,ii=!1){r(1,_t=Ct),Kr?(r(15,Rr=-1),Qe()):(nr(void 0,!ii,ii),setTimeout(()=>{ai.focus(),ai.select()}))}function oo(){r(13,Gr=void 0),r(14,kt=void 0),r(15,Rr=-1)}function ys(){r(64,Jt=[]),r(14,kt=void 0)}let Gr,Jt,kt,Cr="",ai,Rr=-1,Xi,cs=[],zn,ot,Ae,ye,ue=!1,Ve=new Set,Ke=nL();GZ(()=>{_e&&(_e.setEventHandler(void 0),_e.indicateReverse(!1),_e.setSelectedMarker(-1),_e.setFeatures(void 0,void 0,!1))});function Qe(Ct){if(r(17,ue=!1),ot&&(clearTimeout(ot),ot=void 0),Rr>-1&&Gr)r(14,kt=Gr[Rr]),r(1,_t=kt.place_type[0]==="reverse"?kt.place_name:kt.place_name.replace(/,.*/,"")),r(19,Xi=void 0),r(64,Jt=void 0),r(15,Rr=-1);else if(_t){let Kr=Ct||!dt(_t);it(_t,{exact:!0}).then(()=>{r(64,Jt=Gr),r(14,kt=void 0),Kr&&Bt()}).catch(ii=>r(19,Xi=ii))}}function dt(Ct){try{return MX(Ct,6)}catch{return!1}}async function it(Ct,{byId:Kr=!1,exact:ii=!1}={}){var Xs,Qn,Co;r(19,Xi=void 0),zn?.abort();let us=new AbortController;r(20,zn=us);try{let Ti=dt(Ct),$l=new URL(Ni+"/"+encodeURIComponent(Ti?Ti.decimalLongitude+","+Ti.decimalLatitude:Ct)+".json"),ao=$l.searchParams;Y!==void 0&&ao.set("language",Array.isArray(Y)?Y.join(","):Y??"");let[sh]=_e?.getCenterAndZoom()??[],lo=(Xs=!Ti||Nr===dr?Pr:Nr)==null?void 0:Xs.map(Jn=>typeof Jn=="string"?Jn:sh===void 0||(Jn[0]??0)<=sh&&sh<(Jn[1]??1/0)?Jn[2]:void 0).filter(Jn=>Jn!==void 0);lo&&(lo=[...new Set(lo)],ao.set("types",lo.join(",")));let lf=!Ti||ui===Di?Wr:ui;if(lf&&ao.set("excludeTypes",String(lf)),T&&ao.set("bbox",T.map(Jn=>Jn.toFixed(6)).join(",")),re&&ao.set("country",Array.isArray(re)?re.join(","):re),!Kr&&!Ti){let Jn=await _X(_e,Ye,us);Jn&&ao.set("proximity",Jn),(ii||!cr)&&ao.set("autocomplete","false"),ao.set("fuzzyMatch",String(Fe))}let qc=xe===Z?J:xe;qc!==void 0&&qc>1&&lo?.length!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),Ti?(qc===1||qc!==void 0&&(Ai||lo?.length===1))&&ao.set("limit",String(qc)):J!==void 0&&ao.set("limit",String(J)),x&&ao.set("key",x),qs(ao),ls($l);let Hd=$l.searchParams.get("types")===""&&$l.searchParams.get("excludeTypes")!=="true",Fa=$l.toString();if(Fa===Cr){Kr?(j&&r(13,Gr=void 0),r(14,kt=cs[0])):(r(13,Gr=cs),((Qn=Gr[Rr])==null?void 0:Qn.id)!==n?.id&&r(15,Rr=-1));return}Cr=Fa;let ql;if(Hd)ql={type:"FeatureCollection",features:[]};else{let Jn=await fetch(Fa,{signal:us.signal,...oi});if(!Jn.ok)throw new Error(await Jn.text());ql=await Jn.json()}Ke("response",{url:Fa,featureCollection:ql}),Kr?(j&&r(13,Gr=void 0),r(14,kt=ql.features[0]),cs=[kt]):(r(13,Gr=ql.features.filter(pe)),Ti&&Gr.unshift({type:"Feature",properties:{},id:"reverse_"+Ti.decimalLongitude+"_"+Ti.decimalLatitude,text:Ti.decimalLatitude+", "+Ti.decimalLongitude,place_name:Ti.decimalLatitude+", "+Ti.decimalLongitude,place_type:["reverse"],center:[Ti.decimalLongitude,Ti.decimalLatitude],bbox:[Ti.decimalLongitude,Ti.decimalLatitude,Ti.decimalLongitude,Ti.decimalLatitude],geometry:{type:"Point",coordinates:[Ti.decimalLongitude,Ti.decimalLatitude]}}),cs=Gr,((Co=Gr[Rr])==null?void 0:Co.id)!==n?.id&&r(15,Rr=-1),Ti&&ai.focus())}catch(Ti){if(Ti&&typeof Ti=="object"&&"name"in Ti&&Ti.name==="AbortError")return;throw Ti}finally{us===zn&&r(20,zn=void 0)}}function Bt(){var Ct;if(!(Jt!=null&&Jt.length)||!be)return;let Kr=[180,90,-180,-90],ii=!Jt.some(Qn=>!Qn.matching_text),Xs;for(let Qn of Jt){let Co=ut(Qn);if(Xs=Xs===void 0?Co:Co===void 0?Xs:Math.max(Xs,Co),ii||!Qn.matching_text)for(let us of[0,1,2,3])Kr[us]=Math[us<2?"min":"max"](Kr[us],((Ct=Qn.bbox)==null?void 0:Ct[us])??Qn.center[us%2])}_e&&Jt.length>0&&(kt&&Kr[0]===Kr[2]&&Kr[1]===Kr[3]?_e.flyTo(kt.center,ut(kt)):_e.fitBounds(q2(Kr),50,Xs))}function Mt(){!kt||!_e||(!kt.bbox||kt.bbox[0]===kt.bbox[2]&&kt.bbox[1]===kt.bbox[3]?_e.flyTo(kt.center,ut(kt)):_e.fitBounds(q2(kt.bbox),50,ut(kt)))}function ut(Ct){var Kr;if(!Ct.bbox||Ct.bbox[0]!==Ct.bbox[2]&&Ct.bbox[1]!==Ct.bbox[3])return;let ii=Ct.id.replace(/\..*/,"");return(Array.isArray((Kr=Ct.properties)==null?void 0:Kr.categories)?Ct.properties.categories.reduce((Xs,Qn)=>{let Co=tn[ii+"."+Qn];return Xs===void 0?Co:Co===void 0?Xs:Math.max(Xs,Co)},void 0):void 0)??tn[ii]}function zt(Ct){r(0,rt=oe==="always"),r(13,Gr=void 0),r(14,kt=void 0),r(15,Rr=-1),_s(Ct[1].toFixed(6)+", "+gX(Ct[0],[-180,180],!0).toFixed(6),!1,!0)}function rr(Ct){if(!Gr)return;let Kr=Ct.key==="ArrowDown"?1:Ct.key==="ArrowUp"?-1:0;Kr&&(ai.focus(),r(17,ue=!0),Ct.preventDefault(),kt&&Rr===-1&&r(15,Rr=Gr.findIndex(ii=>ii.id===kt?.id)),Rr===(kt||Wt?0:-1)&&Kr===-1&&r(15,Rr=Gr.length),r(15,Rr+=Kr),Rr>=Gr.length&&r(15,Rr=-1),Rr<0&&(kt||Wt)&&r(15,Rr=0))}function nr(Ct,Kr=!0,ii=!1){if(r(19,Xi=void 0),r(14,kt=void 0),r(17,ue=!0),cr||ii){if(ot&&clearTimeout(ot),_t.length<Be)return;let Xs=_t;ot=window.setTimeout(()=>{it(Xs).catch(Qn=>r(19,Xi=Qn))},Kr?te:0)}else r(13,Gr=void 0),r(19,Xi=void 0)}function $e(Ct){kt&&kt?.id===Ct?.id?Mt():(r(14,kt=Ct),r(1,_t=Ct.place_name))}function Fr(Ct){r(15,Rr=Ct)}function Sr(){(!Wt||kt)&&r(15,Rr=-1),Lt&&Mt()}let kr=()=>ai.focus();function _i(Ct){hC[Ct?"unshift":"push"](()=>{ai=Ct,r(18,ai)})}function Gt(){_t=this.value,r(1,_t),r(17,ue),r(31,k),r(16,Ae)}let pr=()=>r(17,ue=!0),tr=()=>r(17,ue=!1),Vr=()=>r(17,ue=!0),xn=()=>r(14,kt=void 0),ma=()=>{r(1,_t=""),r(14,kt=void 0),ai.focus()},Br=()=>r(0,rt=!rt),Kn=()=>r(19,Xi=void 0),rn=Ct=>Fr(Ct),nh=Ct=>$e(Ct),Wl=()=>{};return t.$$set=Ct=>{"class"in Ct&&r(2,p=Ct.class),"apiKey"in Ct&&r(29,x=Ct.apiKey),"bbox"in Ct&&r(30,T=Ct.bbox),"clearButtonTitle"in Ct&&r(3,R=Ct.clearButtonTitle),"clearOnBlur"in Ct&&r(31,k=Ct.clearOnBlur),"clearListOnPick"in Ct&&r(32,j=Ct.clearListOnPick),"keepListOpen"in Ct&&r(4,q=Ct.keepListOpen),"collapsed"in Ct&&r(5,X=Ct.collapsed),"country"in Ct&&r(33,re=Ct.country),"debounceSearch"in Ct&&r(34,te=Ct.debounceSearch),"enableReverse"in Ct&&r(6,oe=Ct.enableReverse),"errorMessage"in Ct&&r(7,ae=Ct.errorMessage),"filter"in Ct&&r(35,pe=Ct.filter),"flyTo"in Ct&&r(36,be=Ct.flyTo),"fuzzyMatch"in Ct&&r(37,Fe=Ct.fuzzyMatch),"language"in Ct&&r(38,Y=Ct.language),"limit"in Ct&&r(39,J=Ct.limit),"reverseGeocodingLimit"in Ct&&r(40,xe=Ct.reverseGeocodingLimit),"mapController"in Ct&&r(41,_e=Ct.mapController),"minLength"in Ct&&r(42,Be=Ct.minLength),"noResultsMessage"in Ct&&r(8,Se=Ct.noResultsMessage),"placeholder"in Ct&&r(9,ke=Ct.placeholder),"proximity"in Ct&&r(43,Ye=Ct.proximity),"reverseActive"in Ct&&r(0,rt=Ct.reverseActive),"reverseButtonTitle"in Ct&&r(10,tt=Ct.reverseButtonTitle),"searchValue"in Ct&&r(1,_t=Ct.searchValue),"pickedResultStyle"in Ct&&r(44,Zt=Ct.pickedResultStyle),"showPlaceType"in Ct&&r(11,Vt=Ct.showPlaceType),"showResultsWhileTyping"in Ct&&r(45,cr=Ct.showResultsWhileTyping),"selectFirst"in Ct&&r(46,Wt=Ct.selectFirst),"flyToSelected"in Ct&&r(47,Lt=Ct.flyToSelected),"markerOnSelected"in Ct&&r(48,vr=Ct.markerOnSelected),"types"in Ct&&r(49,Pr=Ct.types),"reverseGeocodingTypes"in Ct&&r(50,Nr=Ct.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in Ct&&r(51,Ai=Ct.exhaustiveReverseGeocoding),"excludeTypes"in Ct&&r(52,Wr=Ct.excludeTypes),"reverseGeocodingExcludeTypes"in Ct&&r(53,ui=Ct.reverseGeocodingExcludeTypes),"zoom"in Ct&&r(54,tn=Ct.zoom),"apiUrl"in Ct&&r(55,Ni=Ct.apiUrl),"fetchParameters"in Ct&&r(56,oi=Ct.fetchParameters),"iconsBaseUrl"in Ct&&r(12,Eo=Ct.iconsBaseUrl),"adjustUrlQuery"in Ct&&r(57,qs=Ct.adjustUrlQuery),"adjustUrl"in Ct&&r(58,ls=Ct.adjustUrl),"$$scope"in Ct&&r(69,c=Ct.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&64&&r(0,rt=oe==="always"),t.$$.dirty[0]&16384|t.$$.dirty[1]&8192&&Zt!=="marker-only"&&kt&&!kt.address&&kt.geometry.type==="Point"&&kt.place_type[0]!=="reverse"&&it(kt.id,{byId:!0}).catch(Ct=>r(19,Xi=Ct)),t.$$.dirty[0]&16384|t.$$.dirty[1]&1058|t.$$.dirty[2]&8&&(_e&&kt&&kt.id!==ye&&be&&(Mt(),j&&r(13,Gr=void 0),r(64,Jt=void 0),r(15,Rr=-1)),r(65,ye=kt?.id)),t.$$.dirty[0]&196608|t.$$.dirty[1]&1&&setTimeout(()=>{r(16,Ae=ue),k&&!Ae&&r(1,_t="")}),t.$$.dirty[0]&8194|t.$$.dirty[1]&2048&&_t.length<Be&&(r(13,Gr=void 0),r(19,Xi=void 0),r(64,Jt=Gr)),t.$$.dirty[0]&57344|t.$$.dirty[1]&32768&&Wt&&Gr!=null&&Gr.length&&Rr==-1&&!kt&&r(15,Rr=0),t.$$.dirty[0]&8192|t.$$.dirty[2]&4&&Jt!==Gr&&r(64,Jt=void 0),t.$$.dirty[0]&73729|t.$$.dirty[1]&1024|t.$$.dirty[2]&4&&_e&&_e.setEventHandler(Ct=>{switch(Ct.type){case"mapClick":rt&&zt(Ct.coordinates);break;case"markerClick":{let Kr=Gr?.find(ii=>ii.id===Ct.id);Kr&&$e(Kr)}break;case"markerMouseEnter":Jt&&r(15,Rr=Ae?Gr?.findIndex(Kr=>Kr.id===Ct.id)??-1:-1);break;case"markerMouseLeave":Jt&&r(15,Rr=-1);break}}),t.$$.dirty[0]&40960&&r(66,n=Gr?.[Rr]),t.$$.dirty[1]&66592|t.$$.dirty[2]&16&&_e&&n&&be&&Lt&&_e.flyTo(n.center,ut(n)),t.$$.dirty[1]&8192&&r(68,i=Zt==="full-geometry-including-polygon-center-marker"),t.$$.dirty[1]&132096|t.$$.dirty[2]&64&&(vr||_e==null||_e.setFeatures(void 0,void 0,i)),t.$$.dirty[0]&16384|t.$$.dirty[1]&132096|t.$$.dirty[2]&84&&_e&&vr&&!Jt&&(_e.setFeatures(n?[n]:void 0,kt,i),_e.setSelectedMarker(n?0:-1)),t.$$.dirty[0]&16384|t.$$.dirty[1]&1024|t.$$.dirty[2]&68&&_e&&_e.setFeatures(Jt,kt,i),t.$$.dirty[0]&32768|t.$$.dirty[1]&1024|t.$$.dirty[2]&4&&Jt&&_e&&_e.setSelectedMarker(Rr),t.$$.dirty[0]&2|t.$$.dirty[1]&1024&&_e){let Ct=dt(_t);_e.setReverseMarker(Ct?[Ct.decimalLongitude,Ct.decimalLatitude]:void 0)}t.$$.dirty[2]&16&&Ke("select",{feature:n}),t.$$.dirty[0]&16384&&Ke("pick",{feature:kt}),t.$$.dirty[0]&73744&&r(67,s=!!(Gr!=null&&Gr.length)&&(Ae||q)),t.$$.dirty[2]&32&&Ke("optionsvisibilitychange",{optionsVisible:s}),t.$$.dirty[0]&8192&&Ke("featureslisted",{features:Gr}),t.$$.dirty[2]&4&&Ke("featuresmarked",{features:Jt}),t.$$.dirty[0]&1&&Ke("reversetoggle",{reverse:rt}),t.$$.dirty[0]&2&&Ke("querychange",{query:_t}),t.$$.dirty[0]&1|t.$$.dirty[1]&1024&&_e&&_e.indicateReverse(rt)},[rt,_t,p,R,q,X,oe,ae,Se,ke,tt,Vt,Eo,Gr,kt,Rr,Ae,ue,ai,Xi,zn,Ve,Qe,rr,nr,$e,Fr,Sr,h,x,T,k,j,re,te,pe,be,Fe,Y,J,xe,_e,Be,Ye,Zt,cr,Wt,Lt,vr,Pr,Nr,Ai,Wr,ui,tn,Ni,oi,qs,ls,Zs,Aa,_s,oo,ys,Jt,ye,n,s,i,c,a,kr,_i,Gt,pr,tr,Vr,xn,ma,Br,Kn,rn,nh,Wl]}var FX=class extends bu{constructor(t){super(),rd(this,t,DX,OX,td,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}};function w_(t,e,r={}){let i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=e||{},i.geometry=t,i}function CC(t,e,r={}){for(let i of t){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let n=0;n<i[i.length-1].length;n++)if(i[i.length-1][n]!==i[0][n])throw new Error("First and last Position are not equivalent.")}return w_({type:"Polygon",coordinates:t},e,r)}function T_(t,e={}){let r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function aL(t,e,r={}){return w_({type:"MultiPolygon",coordinates:t},e,r)}var kX=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,cC=Math.ceil,bl=Math.floor,Sa="[BigNumber Error] ",N6=Sa+"Number primitive has more than 15 significant digits: ",vc=1e14,fi=14,z6=9007199254740991,uC=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Qf=1e7,Qa=1e9;function lL(t){var e,r,i,n=te.prototype={constructor:te,toString:null,valueOf:null},s=new te(1),a=20,c=4,h=-7,p=21,x=-1e7,T=1e7,R=!1,k=1,j=0,q={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},X="0123456789abcdefghijklmnopqrstuvwxyz",re=!0;function te(Y,J){var Z,xe,_e,Be,Se,ke,Ye,rt,tt=this;if(!(tt instanceof te))return new te(Y,J);if(J==null){if(Y&&Y._isBigNumber===!0){tt.s=Y.s,!Y.c||Y.e>T?tt.c=tt.e=null:Y.e<x?tt.c=[tt.e=0]:(tt.e=Y.e,tt.c=Y.c.slice());return}if((ke=typeof Y=="number")&&Y*0==0){if(tt.s=1/Y<0?(Y=-Y,-1):1,Y===~~Y){for(Be=0,Se=Y;Se>=10;Se/=10,Be++);Be>T?tt.c=tt.e=null:(tt.e=Be,tt.c=[Y]);return}rt=String(Y)}else{if(!kX.test(rt=String(Y)))return i(tt,rt,ke);tt.s=rt.charCodeAt(0)==45?(rt=rt.slice(1),-1):1}(Be=rt.indexOf("."))>-1&&(rt=rt.replace(".","")),(Se=rt.search(/e/i))>0?(Be<0&&(Be=Se),Be+=+rt.slice(Se+1),rt=rt.substring(0,Se)):Be<0&&(Be=rt.length)}else{if(ns(J,2,X.length,"Base"),J==10&&re)return tt=new te(Y),be(tt,a+tt.e+1,c);if(rt=String(Y),ke=typeof Y=="number"){if(Y*0!=0)return i(tt,rt,ke,J);if(tt.s=1/Y<0?(rt=rt.slice(1),-1):1,te.DEBUG&&rt.replace(/^0\.0*|\./,"").length>15)throw Error(N6+Y)}else tt.s=rt.charCodeAt(0)===45?(rt=rt.slice(1),-1):1;for(Z=X.slice(0,J),Be=Se=0,Ye=rt.length;Se<Ye;Se++)if(Z.indexOf(xe=rt.charAt(Se))<0){if(xe=="."){if(Se>Be){Be=Ye;continue}}else if(!_e&&(rt==rt.toUpperCase()&&(rt=rt.toLowerCase())||rt==rt.toLowerCase()&&(rt=rt.toUpperCase()))){_e=!0,Se=-1,Be=0;continue}return i(tt,String(Y),ke,J)}ke=!1,rt=r(rt,J,10,tt.s),(Be=rt.indexOf("."))>-1?rt=rt.replace(".",""):Be=rt.length}for(Se=0;rt.charCodeAt(Se)===48;Se++);for(Ye=rt.length;rt.charCodeAt(--Ye)===48;);if(rt=rt.slice(Se,++Ye)){if(Ye-=Se,ke&&te.DEBUG&&Ye>15&&(Y>z6||Y!==bl(Y)))throw Error(N6+tt.s*Y);if((Be=Be-Se-1)>T)tt.c=tt.e=null;else if(Be<x)tt.c=[tt.e=0];else{if(tt.e=Be,tt.c=[],Se=(Be+1)%fi,Be<0&&(Se+=fi),Se<Ye){for(Se&&tt.c.push(+rt.slice(0,Se)),Ye-=fi;Se<Ye;)tt.c.push(+rt.slice(Se,Se+=fi));Se=fi-(rt=rt.slice(Se)).length}else Se-=Ye;for(;Se--;rt+="0");tt.c.push(+rt)}}else tt.c=[tt.e=0]}te.clone=lL,te.ROUND_UP=0,te.ROUND_DOWN=1,te.ROUND_CEIL=2,te.ROUND_FLOOR=3,te.ROUND_HALF_UP=4,te.ROUND_HALF_DOWN=5,te.ROUND_HALF_EVEN=6,te.ROUND_HALF_CEIL=7,te.ROUND_HALF_FLOOR=8,te.EUCLID=9,te.config=te.set=function(Y){var J,Z;if(Y!=null)if(typeof Y=="object"){if(Y.hasOwnProperty(J="DECIMAL_PLACES")&&(Z=Y[J],ns(Z,0,Qa,J),a=Z),Y.hasOwnProperty(J="ROUNDING_MODE")&&(Z=Y[J],ns(Z,0,8,J),c=Z),Y.hasOwnProperty(J="EXPONENTIAL_AT")&&(Z=Y[J],Z&&Z.pop?(ns(Z[0],-1e9,0,J),ns(Z[1],0,Qa,J),h=Z[0],p=Z[1]):(ns(Z,-1e9,Qa,J),h=-(p=Z<0?-Z:Z))),Y.hasOwnProperty(J="RANGE"))if(Z=Y[J],Z&&Z.pop)ns(Z[0],-1e9,-1,J),ns(Z[1],1,Qa,J),x=Z[0],T=Z[1];else if(ns(Z,-1e9,Qa,J),Z)x=-(T=Z<0?-Z:Z);else throw Error(Sa+J+" cannot be zero: "+Z);if(Y.hasOwnProperty(J="CRYPTO"))if(Z=Y[J],Z===!!Z)if(Z)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))R=Z;else throw R=!Z,Error(Sa+"crypto unavailable");else R=Z;else throw Error(Sa+J+" not true or false: "+Z);if(Y.hasOwnProperty(J="MODULO_MODE")&&(Z=Y[J],ns(Z,0,9,J),k=Z),Y.hasOwnProperty(J="POW_PRECISION")&&(Z=Y[J],ns(Z,0,Qa,J),j=Z),Y.hasOwnProperty(J="FORMAT"))if(Z=Y[J],typeof Z=="object")q=Z;else throw Error(Sa+J+" not an object: "+Z);if(Y.hasOwnProperty(J="ALPHABET"))if(Z=Y[J],typeof Z=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(Z))re=Z.slice(0,10)=="0123456789",X=Z;else throw Error(Sa+J+" invalid: "+Z)}else throw Error(Sa+"Object expected: "+Y);return{DECIMAL_PLACES:a,ROUNDING_MODE:c,EXPONENTIAL_AT:[h,p],RANGE:[x,T],CRYPTO:R,MODULO_MODE:k,POW_PRECISION:j,FORMAT:q,ALPHABET:X}},te.isBigNumber=function(Y){if(!Y||Y._isBigNumber!==!0)return!1;if(!te.DEBUG)return!0;var J,Z,xe=Y.c,_e=Y.e,Be=Y.s;e:if({}.toString.call(xe)=="[object Array]"){if((Be===1||Be===-1)&&_e>=-1e9&&_e<=Qa&&_e===bl(_e)){if(xe[0]===0){if(_e===0&&xe.length===1)return!0;break e}if(J=(_e+1)%fi,J<1&&(J+=fi),String(xe[0]).length==J){for(J=0;J<xe.length;J++)if(Z=xe[J],Z<0||Z>=vc||Z!==bl(Z))break e;if(Z!==0)return!0}}}else if(xe===null&&_e===null&&(Be===null||Be===1||Be===-1))return!0;throw Error(Sa+"Invalid BigNumber: "+Y)},te.maximum=te.max=function(){return ae(arguments,-1)},te.minimum=te.min=function(){return ae(arguments,1)},te.random=function(){var Y=9007199254740992,J=Math.random()*Y&2097151?function(){return bl(Math.random()*Y)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(Z){var xe,_e,Be,Se,ke,Ye=0,rt=[],tt=new te(s);if(Z==null?Z=a:ns(Z,0,Qa),Se=cC(Z/fi),R)if(crypto.getRandomValues){for(xe=crypto.getRandomValues(new Uint32Array(Se*=2));Ye<Se;)ke=xe[Ye]*131072+(xe[Ye+1]>>>11),ke>=9e15?(_e=crypto.getRandomValues(new Uint32Array(2)),xe[Ye]=_e[0],xe[Ye+1]=_e[1]):(rt.push(ke%1e14),Ye+=2);Ye=Se/2}else if(crypto.randomBytes){for(xe=crypto.randomBytes(Se*=7);Ye<Se;)ke=(xe[Ye]&31)*281474976710656+xe[Ye+1]*1099511627776+xe[Ye+2]*4294967296+xe[Ye+3]*16777216+(xe[Ye+4]<<16)+(xe[Ye+5]<<8)+xe[Ye+6],ke>=9e15?crypto.randomBytes(7).copy(xe,Ye):(rt.push(ke%1e14),Ye+=7);Ye=Se/7}else throw R=!1,Error(Sa+"crypto unavailable");if(!R)for(;Ye<Se;)ke=J(),ke<9e15&&(rt[Ye++]=ke%1e14);for(Se=rt[--Ye],Z%=fi,Se&&Z&&(ke=uC[fi-Z],rt[Ye]=bl(Se/ke)*ke);rt[Ye]===0;rt.pop(),Ye--);if(Ye<0)rt=[Be=0];else{for(Be=-1;rt[0]===0;rt.splice(0,1),Be-=fi);for(Ye=1,ke=rt[0];ke>=10;ke/=10,Ye++);Ye<fi&&(Be-=fi-Ye)}return tt.e=Be,tt.c=rt,tt}}(),te.sum=function(){for(var Y=1,J=arguments,Z=new te(J[0]);Y<J.length;)Z=Z.plus(J[Y++]);return Z},r=function(){var Y="0123456789";function J(Z,xe,_e,Be){for(var Se,ke=[0],Ye,rt=0,tt=Z.length;rt<tt;){for(Ye=ke.length;Ye--;ke[Ye]*=xe);for(ke[0]+=Be.indexOf(Z.charAt(rt++)),Se=0;Se<ke.length;Se++)ke[Se]>_e-1&&(ke[Se+1]==null&&(ke[Se+1]=0),ke[Se+1]+=ke[Se]/_e|0,ke[Se]%=_e)}return ke.reverse()}return function(Z,xe,_e,Be,Se){var ke,Ye,rt,tt,_t,Zt,Vt,cr,Wt=Z.indexOf("."),Lt=a,vr=c;for(Wt>=0&&(tt=j,j=0,Z=Z.replace(".",""),cr=new te(xe),Zt=cr.pow(Z.length-Wt),j=tt,cr.c=J(Ph(xl(Zt.c),Zt.e,"0"),10,_e,Y),cr.e=cr.c.length),Vt=J(Z,xe,_e,Se?(ke=X,Y):(ke=Y,X)),rt=tt=Vt.length;Vt[--tt]==0;Vt.pop());if(!Vt[0])return ke.charAt(0);if(Wt<0?--rt:(Zt.c=Vt,Zt.e=rt,Zt.s=Be,Zt=e(Zt,cr,Lt,vr,_e),Vt=Zt.c,_t=Zt.r,rt=Zt.e),Ye=rt+Lt+1,Wt=Vt[Ye],tt=_e/2,_t=_t||Ye<0||Vt[Ye+1]!=null,_t=vr<4?(Wt!=null||_t)&&(vr==0||vr==(Zt.s<0?3:2)):Wt>tt||Wt==tt&&(vr==4||_t||vr==6&&Vt[Ye-1]&1||vr==(Zt.s<0?8:7)),Ye<1||!Vt[0])Z=_t?Ph(ke.charAt(1),-Lt,ke.charAt(0)):ke.charAt(0);else{if(Vt.length=Ye,_t)for(--_e;++Vt[--Ye]>_e;)Vt[Ye]=0,Ye||(++rt,Vt=[1].concat(Vt));for(tt=Vt.length;!Vt[--tt];);for(Wt=0,Z="";Wt<=tt;Z+=ke.charAt(Vt[Wt++]));Z=Ph(Z,rt,ke.charAt(0))}return Z}}(),e=function(){function Y(xe,_e,Be){var Se,ke,Ye,rt,tt=0,_t=xe.length,Zt=_e%Qf,Vt=_e/Qf|0;for(xe=xe.slice();_t--;)Ye=xe[_t]%Qf,rt=xe[_t]/Qf|0,Se=Vt*Ye+rt*Zt,ke=Zt*Ye+Se%Qf*Qf+tt,tt=(ke/Be|0)+(Se/Qf|0)+Vt*rt,xe[_t]=ke%Be;return tt&&(xe=[tt].concat(xe)),xe}function J(xe,_e,Be,Se){var ke,Ye;if(Be!=Se)Ye=Be>Se?1:-1;else for(ke=Ye=0;ke<Be;ke++)if(xe[ke]!=_e[ke]){Ye=xe[ke]>_e[ke]?1:-1;break}return Ye}function Z(xe,_e,Be,Se){for(var ke=0;Be--;)xe[Be]-=ke,ke=xe[Be]<_e[Be]?1:0,xe[Be]=ke*Se+xe[Be]-_e[Be];for(;!xe[0]&&xe.length>1;xe.splice(0,1));}return function(xe,_e,Be,Se,ke){var Ye,rt,tt,_t,Zt,Vt,cr,Wt,Lt,vr,Pr,dr,Nr,Ai,Wr,Di,ui,tn=xe.s==_e.s?1:-1,Ni=xe.c,oi=_e.c;if(!Ni||!Ni[0]||!oi||!oi[0])return new te(!xe.s||!_e.s||(Ni?oi&&Ni[0]==oi[0]:!oi)?NaN:Ni&&Ni[0]==0||!oi?tn*0:tn/0);for(Wt=new te(tn),Lt=Wt.c=[],rt=xe.e-_e.e,tn=Be+rt+1,ke||(ke=vc,rt=vl(xe.e/fi)-vl(_e.e/fi),tn=tn/fi|0),tt=0;oi[tt]==(Ni[tt]||0);tt++);if(oi[tt]>(Ni[tt]||0)&&rt--,tn<0)Lt.push(1),_t=!0;else{for(Ai=Ni.length,Di=oi.length,tt=0,tn+=2,Zt=bl(ke/(oi[0]+1)),Zt>1&&(oi=Y(oi,Zt,ke),Ni=Y(Ni,Zt,ke),Di=oi.length,Ai=Ni.length),Nr=Di,vr=Ni.slice(0,Di),Pr=vr.length;Pr<Di;vr[Pr++]=0);ui=oi.slice(),ui=[0].concat(ui),Wr=oi[0],oi[1]>=ke/2&&Wr++;do{if(Zt=0,Ye=J(oi,vr,Di,Pr),Ye<0){if(dr=vr[0],Di!=Pr&&(dr=dr*ke+(vr[1]||0)),Zt=bl(dr/Wr),Zt>1)for(Zt>=ke&&(Zt=ke-1),Vt=Y(oi,Zt,ke),cr=Vt.length,Pr=vr.length;J(Vt,vr,cr,Pr)==1;)Zt--,Z(Vt,Di<cr?ui:oi,cr,ke),cr=Vt.length,Ye=1;else Zt==0&&(Ye=Zt=1),Vt=oi.slice(),cr=Vt.length;if(cr<Pr&&(Vt=[0].concat(Vt)),Z(vr,Vt,Pr,ke),Pr=vr.length,Ye==-1)for(;J(oi,vr,Di,Pr)<1;)Zt++,Z(vr,Di<Pr?ui:oi,Pr,ke),Pr=vr.length}else Ye===0&&(Zt++,vr=[0]);Lt[tt++]=Zt,vr[0]?vr[Pr++]=Ni[Nr]||0:(vr=[Ni[Nr]],Pr=1)}while((Nr++<Ai||vr[0]!=null)&&tn--);_t=vr[0]!=null,Lt[0]||Lt.splice(0,1)}if(ke==vc){for(tt=1,tn=Lt[0];tn>=10;tn/=10,tt++);be(Wt,Be+(Wt.e=tt+rt*fi-1)+1,Se,_t)}else Wt.e=rt,Wt.r=+_t;return Wt}}();function oe(Y,J,Z,xe){var _e,Be,Se,ke,Ye;if(Z==null?Z=c:ns(Z,0,8),!Y.c)return Y.toString();if(_e=Y.c[0],Se=Y.e,J==null)Ye=xl(Y.c),Ye=xe==1||xe==2&&(Se<=h||Se>=p)?k2(Ye,Se):Ph(Ye,Se,"0");else if(Y=be(new te(Y),J,Z),Be=Y.e,Ye=xl(Y.c),ke=Ye.length,xe==1||xe==2&&(J<=Be||Be<=h)){for(;ke<J;Ye+="0",ke++);Ye=k2(Ye,Be)}else if(J-=Se,Ye=Ph(Ye,Be,"0"),Be+1>ke){if(--J>0)for(Ye+=".";J--;Ye+="0");}else if(J+=Be-ke,J>0)for(Be+1==ke&&(Ye+=".");J--;Ye+="0");return Y.s<0&&_e?"-"+Ye:Ye}function ae(Y,J){for(var Z,xe,_e=1,Be=new te(Y[0]);_e<Y.length;_e++)xe=new te(Y[_e]),(!xe.s||(Z=Mp(Be,xe))===J||Z===0&&Be.s===J)&&(Be=xe);return Be}function pe(Y,J,Z){for(var xe=1,_e=J.length;!J[--_e];J.pop());for(_e=J[0];_e>=10;_e/=10,xe++);return(Z=xe+Z*fi-1)>T?Y.c=Y.e=null:Z<x?Y.c=[Y.e=0]:(Y.e=Z,Y.c=J),Y}i=function(){var Y=/^(-?)0([xbo])(?=\w[\w.]*$)/i,J=/^([^.]+)\.$/,Z=/^\.([^.]+)$/,xe=/^-?(Infinity|NaN)$/,_e=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Be,Se,ke,Ye){var rt,tt=ke?Se:Se.replace(_e,"");if(xe.test(tt))Be.s=isNaN(tt)?null:tt<0?-1:1;else{if(!ke&&(tt=tt.replace(Y,function(_t,Zt,Vt){return rt=(Vt=Vt.toLowerCase())=="x"?16:Vt=="b"?2:8,!Ye||Ye==rt?Zt:_t}),Ye&&(rt=Ye,tt=tt.replace(J,"$1").replace(Z,"0.$1")),Se!=tt))return new te(tt,rt);if(te.DEBUG)throw Error(Sa+"Not a"+(Ye?" base "+Ye:"")+" number: "+Se);Be.s=null}Be.c=Be.e=null}}();function be(Y,J,Z,xe){var _e,Be,Se,ke,Ye,rt,tt,_t=Y.c,Zt=uC;if(_t){e:{for(_e=1,ke=_t[0];ke>=10;ke/=10,_e++);if(Be=J-_e,Be<0)Be+=fi,Se=J,Ye=_t[rt=0],tt=bl(Ye/Zt[_e-Se-1]%10);else if(rt=cC((Be+1)/fi),rt>=_t.length)if(xe){for(;_t.length<=rt;_t.push(0));Ye=tt=0,_e=1,Be%=fi,Se=Be-fi+1}else break e;else{for(Ye=ke=_t[rt],_e=1;ke>=10;ke/=10,_e++);Be%=fi,Se=Be-fi+_e,tt=Se<0?0:bl(Ye/Zt[_e-Se-1]%10)}if(xe=xe||J<0||_t[rt+1]!=null||(Se<0?Ye:Ye%Zt[_e-Se-1]),xe=Z<4?(tt||xe)&&(Z==0||Z==(Y.s<0?3:2)):tt>5||tt==5&&(Z==4||xe||Z==6&&(Be>0?Se>0?Ye/Zt[_e-Se]:0:_t[rt-1])%10&1||Z==(Y.s<0?8:7)),J<1||!_t[0])return _t.length=0,xe?(J-=Y.e+1,_t[0]=Zt[(fi-J%fi)%fi],Y.e=-J||0):_t[0]=Y.e=0,Y;if(Be==0?(_t.length=rt,ke=1,rt--):(_t.length=rt+1,ke=Zt[fi-Be],_t[rt]=Se>0?bl(Ye/Zt[_e-Se]%Zt[Se])*ke:0),xe)for(;;)if(rt==0){for(Be=1,Se=_t[0];Se>=10;Se/=10,Be++);for(Se=_t[0]+=ke,ke=1;Se>=10;Se/=10,ke++);Be!=ke&&(Y.e++,_t[0]==vc&&(_t[0]=1));break}else{if(_t[rt]+=ke,_t[rt]!=vc)break;_t[rt--]=0,ke=1}for(Be=_t.length;_t[--Be]===0;_t.pop());}Y.e>T?Y.c=Y.e=null:Y.e<x&&(Y.c=[Y.e=0])}return Y}function Fe(Y){var J,Z=Y.e;return Z===null?Y.toString():(J=xl(Y.c),J=Z<=h||Z>=p?k2(J,Z):Ph(J,Z,"0"),Y.s<0?"-"+J:J)}return n.absoluteValue=n.abs=function(){var Y=new te(this);return Y.s<0&&(Y.s=1),Y},n.comparedTo=function(Y,J){return Mp(this,new te(Y,J))},n.decimalPlaces=n.dp=function(Y,J){var Z,xe,_e,Be=this;if(Y!=null)return ns(Y,0,Qa),J==null?J=c:ns(J,0,8),be(new te(Be),Y+Be.e+1,J);if(!(Z=Be.c))return null;if(xe=((_e=Z.length-1)-vl(this.e/fi))*fi,_e=Z[_e])for(;_e%10==0;_e/=10,xe--);return xe<0&&(xe=0),xe},n.dividedBy=n.div=function(Y,J){return e(this,new te(Y,J),a,c)},n.dividedToIntegerBy=n.idiv=function(Y,J){return e(this,new te(Y,J),0,1)},n.exponentiatedBy=n.pow=function(Y,J){var Z,xe,_e,Be,Se,ke,Ye,rt,tt,_t=this;if(Y=new te(Y),Y.c&&!Y.isInteger())throw Error(Sa+"Exponent not an integer: "+Fe(Y));if(J!=null&&(J=new te(J)),ke=Y.e>14,!_t.c||!_t.c[0]||_t.c[0]==1&&!_t.e&&_t.c.length==1||!Y.c||!Y.c[0])return tt=new te(Math.pow(+Fe(_t),ke?Y.s*(2-F2(Y)):+Fe(Y))),J?tt.mod(J):tt;if(Ye=Y.s<0,J){if(J.c?!J.c[0]:!J.s)return new te(NaN);xe=!Ye&&_t.isInteger()&&J.isInteger(),xe&&(_t=_t.mod(J))}else{if(Y.e>9&&(_t.e>0||_t.e<-1||(_t.e==0?_t.c[0]>1||ke&&_t.c[1]>=24e7:_t.c[0]<8e13||ke&&_t.c[0]<=9999975e7)))return Be=_t.s<0&&F2(Y)?-0:0,_t.e>-1&&(Be=1/Be),new te(Ye?1/Be:Be);j&&(Be=cC(j/fi+2))}for(ke?(Z=new te(.5),Ye&&(Y.s=1),rt=F2(Y)):(_e=Math.abs(+Fe(Y)),rt=_e%2),tt=new te(s);;){if(rt){if(tt=tt.times(_t),!tt.c)break;Be?tt.c.length>Be&&(tt.c.length=Be):xe&&(tt=tt.mod(J))}if(_e){if(_e=bl(_e/2),_e===0)break;rt=_e%2}else if(Y=Y.times(Z),be(Y,Y.e+1,1),Y.e>14)rt=F2(Y);else{if(_e=+Fe(Y),_e===0)break;rt=_e%2}_t=_t.times(_t),Be?_t.c&&_t.c.length>Be&&(_t.c.length=Be):xe&&(_t=_t.mod(J))}return xe?tt:(Ye&&(tt=s.div(tt)),J?tt.mod(J):Be?be(tt,j,c,Se):tt)},n.integerValue=function(Y){var J=new te(this);return Y==null?Y=c:ns(Y,0,8),be(J,J.e+1,Y)},n.isEqualTo=n.eq=function(Y,J){return Mp(this,new te(Y,J))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(Y,J){return Mp(this,new te(Y,J))>0},n.isGreaterThanOrEqualTo=n.gte=function(Y,J){return(J=Mp(this,new te(Y,J)))===1||J===0},n.isInteger=function(){return!!this.c&&vl(this.e/fi)>this.c.length-2},n.isLessThan=n.lt=function(Y,J){return Mp(this,new te(Y,J))<0},n.isLessThanOrEqualTo=n.lte=function(Y,J){return(J=Mp(this,new te(Y,J)))===-1||J===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(Y,J){var Z,xe,_e,Be,Se=this,ke=Se.s;if(Y=new te(Y,J),J=Y.s,!ke||!J)return new te(NaN);if(ke!=J)return Y.s=-J,Se.plus(Y);var Ye=Se.e/fi,rt=Y.e/fi,tt=Se.c,_t=Y.c;if(!Ye||!rt){if(!tt||!_t)return tt?(Y.s=-J,Y):new te(_t?Se:NaN);if(!tt[0]||!_t[0])return _t[0]?(Y.s=-J,Y):new te(tt[0]?Se:c==3?-0:0)}if(Ye=vl(Ye),rt=vl(rt),tt=tt.slice(),ke=Ye-rt){for((Be=ke<0)?(ke=-ke,_e=tt):(rt=Ye,_e=_t),_e.reverse(),J=ke;J--;_e.push(0));_e.reverse()}else for(xe=(Be=(ke=tt.length)<(J=_t.length))?ke:J,ke=J=0;J<xe;J++)if(tt[J]!=_t[J]){Be=tt[J]<_t[J];break}if(Be&&(_e=tt,tt=_t,_t=_e,Y.s=-Y.s),J=(xe=_t.length)-(Z=tt.length),J>0)for(;J--;tt[Z++]=0);for(J=vc-1;xe>ke;){if(tt[--xe]<_t[xe]){for(Z=xe;Z&&!tt[--Z];tt[Z]=J);--tt[Z],tt[xe]+=vc}tt[xe]-=_t[xe]}for(;tt[0]==0;tt.splice(0,1),--rt);return tt[0]?pe(Y,tt,rt):(Y.s=c==3?-1:1,Y.c=[Y.e=0],Y)},n.modulo=n.mod=function(Y,J){var Z,xe,_e=this;return Y=new te(Y,J),!_e.c||!Y.s||Y.c&&!Y.c[0]?new te(NaN):!Y.c||_e.c&&!_e.c[0]?new te(_e):(k==9?(xe=Y.s,Y.s=1,Z=e(_e,Y,0,3),Y.s=xe,Z.s*=xe):Z=e(_e,Y,0,k),Y=_e.minus(Z.times(Y)),!Y.c[0]&&k==1&&(Y.s=_e.s),Y)},n.multipliedBy=n.times=function(Y,J){var Z,xe,_e,Be,Se,ke,Ye,rt,tt,_t,Zt,Vt,cr,Wt,Lt,vr=this,Pr=vr.c,dr=(Y=new te(Y,J)).c;if(!Pr||!dr||!Pr[0]||!dr[0])return!vr.s||!Y.s||Pr&&!Pr[0]&&!dr||dr&&!dr[0]&&!Pr?Y.c=Y.e=Y.s=null:(Y.s*=vr.s,!Pr||!dr?Y.c=Y.e=null:(Y.c=[0],Y.e=0)),Y;for(xe=vl(vr.e/fi)+vl(Y.e/fi),Y.s*=vr.s,Ye=Pr.length,_t=dr.length,Ye<_t&&(cr=Pr,Pr=dr,dr=cr,_e=Ye,Ye=_t,_t=_e),_e=Ye+_t,cr=[];_e--;cr.push(0));for(Wt=vc,Lt=Qf,_e=_t;--_e>=0;){for(Z=0,Zt=dr[_e]%Lt,Vt=dr[_e]/Lt|0,Se=Ye,Be=_e+Se;Be>_e;)rt=Pr[--Se]%Lt,tt=Pr[Se]/Lt|0,ke=Vt*rt+tt*Zt,rt=Zt*rt+ke%Lt*Lt+cr[Be]+Z,Z=(rt/Wt|0)+(ke/Lt|0)+Vt*tt,cr[Be--]=rt%Wt;cr[Be]=Z}return Z?++xe:cr.splice(0,1),pe(Y,cr,xe)},n.negated=function(){var Y=new te(this);return Y.s=-Y.s||null,Y},n.plus=function(Y,J){var Z,xe=this,_e=xe.s;if(Y=new te(Y,J),J=Y.s,!_e||!J)return new te(NaN);if(_e!=J)return Y.s=-J,xe.minus(Y);var Be=xe.e/fi,Se=Y.e/fi,ke=xe.c,Ye=Y.c;if(!Be||!Se){if(!ke||!Ye)return new te(_e/0);if(!ke[0]||!Ye[0])return Ye[0]?Y:new te(ke[0]?xe:_e*0)}if(Be=vl(Be),Se=vl(Se),ke=ke.slice(),_e=Be-Se){for(_e>0?(Se=Be,Z=Ye):(_e=-_e,Z=ke),Z.reverse();_e--;Z.push(0));Z.reverse()}for(_e=ke.length,J=Ye.length,_e-J<0&&(Z=Ye,Ye=ke,ke=Z,J=_e),_e=0;J;)_e=(ke[--J]=ke[J]+Ye[J]+_e)/vc|0,ke[J]=vc===ke[J]?0:ke[J]%vc;return _e&&(ke=[_e].concat(ke),++Se),pe(Y,ke,Se)},n.precision=n.sd=function(Y,J){var Z,xe,_e,Be=this;if(Y!=null&&Y!==!!Y)return ns(Y,1,Qa),J==null?J=c:ns(J,0,8),be(new te(Be),Y,J);if(!(Z=Be.c))return null;if(_e=Z.length-1,xe=_e*fi+1,_e=Z[_e]){for(;_e%10==0;_e/=10,xe--);for(_e=Z[0];_e>=10;_e/=10,xe++);}return Y&&Be.e+1>xe&&(xe=Be.e+1),xe},n.shiftedBy=function(Y){return ns(Y,-9007199254740991,z6),this.times("1e"+Y)},n.squareRoot=n.sqrt=function(){var Y,J,Z,xe,_e,Be=this,Se=Be.c,ke=Be.s,Ye=Be.e,rt=a+4,tt=new te("0.5");if(ke!==1||!Se||!Se[0])return new te(!ke||ke<0&&(!Se||Se[0])?NaN:Se?Be:1/0);if(ke=Math.sqrt(+Fe(Be)),ke==0||ke==1/0?(J=xl(Se),(J.length+Ye)%2==0&&(J+="0"),ke=Math.sqrt(+J),Ye=vl((Ye+1)/2)-(Ye<0||Ye%2),ke==1/0?J="5e"+Ye:(J=ke.toExponential(),J=J.slice(0,J.indexOf("e")+1)+Ye),Z=new te(J)):Z=new te(ke+""),Z.c[0]){for(Ye=Z.e,ke=Ye+rt,ke<3&&(ke=0);;)if(_e=Z,Z=tt.times(_e.plus(e(Be,_e,rt,1))),xl(_e.c).slice(0,ke)===(J=xl(Z.c)).slice(0,ke))if(Z.e<Ye&&--ke,J=J.slice(ke-3,ke+1),J=="9999"||!xe&&J=="4999"){if(!xe&&(be(_e,_e.e+a+2,0),_e.times(_e).eq(Be))){Z=_e;break}rt+=4,ke+=4,xe=1}else{(!+J||!+J.slice(1)&&J.charAt(0)=="5")&&(be(Z,Z.e+a+2,1),Y=!Z.times(Z).eq(Be));break}}return be(Z,Z.e+a+1,c,Y)},n.toExponential=function(Y,J){return Y!=null&&(ns(Y,0,Qa),Y++),oe(this,Y,J,1)},n.toFixed=function(Y,J){return Y!=null&&(ns(Y,0,Qa),Y=Y+this.e+1),oe(this,Y,J)},n.toFormat=function(Y,J,Z){var xe,_e=this;if(Z==null)Y!=null&&J&&typeof J=="object"?(Z=J,J=null):Y&&typeof Y=="object"?(Z=Y,Y=J=null):Z=q;else if(typeof Z!="object")throw Error(Sa+"Argument not an object: "+Z);if(xe=_e.toFixed(Y,J),_e.c){var Be,Se=xe.split("."),ke=+Z.groupSize,Ye=+Z.secondaryGroupSize,rt=Z.groupSeparator||"",tt=Se[0],_t=Se[1],Zt=_e.s<0,Vt=Zt?tt.slice(1):tt,cr=Vt.length;if(Ye&&(Be=ke,ke=Ye,Ye=Be,cr-=Be),ke>0&&cr>0){for(Be=cr%ke||ke,tt=Vt.substr(0,Be);Be<cr;Be+=ke)tt+=rt+Vt.substr(Be,ke);Ye>0&&(tt+=rt+Vt.slice(Be)),Zt&&(tt="-"+tt)}xe=_t?tt+(Z.decimalSeparator||"")+((Ye=+Z.fractionGroupSize)?_t.replace(new RegExp("\\d{"+Ye+"}\\B","g"),"$&"+(Z.fractionGroupSeparator||"")):_t):tt}return(Z.prefix||"")+xe+(Z.suffix||"")},n.toFraction=function(Y){var J,Z,xe,_e,Be,Se,ke,Ye,rt,tt,_t,Zt,Vt=this,cr=Vt.c;if(Y!=null&&(ke=new te(Y),!ke.isInteger()&&(ke.c||ke.s!==1)||ke.lt(s)))throw Error(Sa+"Argument "+(ke.isInteger()?"out of range: ":"not an integer: ")+Fe(ke));if(!cr)return new te(Vt);for(J=new te(s),rt=Z=new te(s),xe=Ye=new te(s),Zt=xl(cr),Be=J.e=Zt.length-Vt.e-1,J.c[0]=uC[(Se=Be%fi)<0?fi+Se:Se],Y=!Y||ke.comparedTo(J)>0?Be>0?J:rt:ke,Se=T,T=1/0,ke=new te(Zt),Ye.c[0]=0;tt=e(ke,J,0,1),_e=Z.plus(tt.times(xe)),_e.comparedTo(Y)!=1;)Z=xe,xe=_e,rt=Ye.plus(tt.times(_e=rt)),Ye=_e,J=ke.minus(tt.times(_e=J)),ke=_e;return _e=e(Y.minus(Z),xe,0,1),Ye=Ye.plus(_e.times(rt)),Z=Z.plus(_e.times(xe)),Ye.s=rt.s=Vt.s,Be=Be*2,_t=e(rt,xe,Be,c).minus(Vt).abs().comparedTo(e(Ye,Z,Be,c).minus(Vt).abs())<1?[rt,xe]:[Ye,Z],T=Se,_t},n.toNumber=function(){return+Fe(this)},n.toPrecision=function(Y,J){return Y!=null&&ns(Y,1,Qa),oe(this,Y,J,2)},n.toString=function(Y){var J,Z=this,xe=Z.s,_e=Z.e;return _e===null?xe?(J="Infinity",xe<0&&(J="-"+J)):J="NaN":(Y==null?J=_e<=h||_e>=p?k2(xl(Z.c),_e):Ph(xl(Z.c),_e,"0"):Y===10&&re?(Z=be(new te(Z),a+_e+1,c),J=Ph(xl(Z.c),Z.e,"0")):(ns(Y,2,X.length,"Base"),J=r(Ph(xl(Z.c),_e,"0"),10,Y,xe,!0)),xe<0&&Z.c[0]&&(J="-"+J)),J},n.valueOf=n.toJSON=function(){return Fe(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,t!=null&&te.set(t),te}function vl(t){var e=t|0;return t>0||t===e?e:e-1}function xl(t){for(var e,r,i=1,n=t.length,s=t[0]+"";i<n;){for(e=t[i++]+"",r=fi-e.length;r--;e="0"+e);s+=e}for(n=s.length;s.charCodeAt(--n)===48;);return s.slice(0,n+1||1)}function Mp(t,e){var r,i,n=t.c,s=e.c,a=t.s,c=e.s,h=t.e,p=e.e;if(!a||!c)return null;if(r=n&&!n[0],i=s&&!s[0],r||i)return r?i?0:-c:a;if(a!=c)return a;if(r=a<0,i=h==p,!n||!s)return i?0:!n^r?1:-1;if(!i)return h>p^r?1:-1;for(c=(h=n.length)<(p=s.length)?h:p,a=0;a<c;a++)if(n[a]!=s[a])return n[a]>s[a]^r?1:-1;return h==p?0:h>p^r?1:-1}function ns(t,e,r,i){if(t<e||t>r||t!==bl(t))throw Error(Sa+(i||"Argument")+(typeof t=="number"?t<e||t>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function F2(t){var e=t.c.length-1;return vl(t.e/fi)==e&&t.c[e]%2!=0}function k2(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function Ph(t,e,r){var i,n;if(e<0){for(n=r+".";++e;n+=r);t=n+t}else if(i=t.length,++e>i){for(n=r,e-=i;--e;n+=r);t+=n}else e<i&&(t=t.slice(0,e)+"."+t.slice(e));return t}var xu=lL(),NX=class{constructor(t){wr(this,"key"),wr(this,"left",null),wr(this,"right",null),this.key=t}},m_=class extends NX{constructor(t){super(t)}},zX=class{constructor(){wr(this,"size",0),wr(this,"modificationCount",0),wr(this,"splayCount",0)}splay(t){let e=this.root;if(e==null)return this.compare(t,t),-1;let r=null,i=null,n=null,s=null,a=e,c=this.compare,h;for(;;)if(h=c(a.key,t),h>0){let p=a.left;if(p==null||(h=c(p.key,t),h>0&&(a.left=p.right,p.right=a,a=p,p=a.left,p==null)))break;r==null?i=a:r.left=a,r=a,a=p}else if(h<0){let p=a.right;if(p==null||(h=c(p.key,t),h<0&&(a.right=p.left,p.left=a,a=p,p=a.right,p==null)))break;n==null?s=a:n.right=a,n=a,a=p}else break;return n!=null&&(n.right=a.left,a.left=s),r!=null&&(r.left=a.right,a.right=i),this.root!==a&&(this.root=a,this.splayCount++),h}splayMin(t){let e=t,r=e.left;for(;r!=null;){let i=r;e.left=i.right,i.right=e,e=i,r=e.left}return e}splayMax(t){let e=t,r=e.right;for(;r!=null;){let i=r;e.right=i.left,i.left=e,e=i,r=e.right}return e}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let e=this.root,r=e,i=e.left;if(this.size--,i==null)this.root=e.right;else{let n=e.right;e=this.splayMax(i),e.right=n,this.root=e}return this.modificationCount++,r}addNewRoot(t,e){this.size++,this.modificationCount++;let r=this.root;if(r==null){this.root=t;return}e<0?(t.left=r,t.right=r.right,r.right=null):(t.right=r,t.left=r.left,r.left=null),this.root=t}_first(){let t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){let t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,e)=>t<e?-1:t>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}},U6,V6,Z2=class __ extends zX{constructor(e,r){super(),wr(this,"root",null),wr(this,"compare"),wr(this,"validKey"),wr(this,U6,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=r??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(let r of e)this.delete(r)}forEach(e){let r=this[Symbol.iterator](),i;for(;i=r.next(),!i.done;)e(i.value,i.value,this)}add(e){let r=this.splay(e);return r!=0&&this.addNewRoot(new m_(e),r),this}addAndReturn(e){let r=this.splay(e);return r!=0&&this.addNewRoot(new m_(e),r),this.root.key}addAll(e){for(let r of e)this.add(r)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let r=this.root.left;if(r==null)return null;let i=r.right;for(;i!=null;)r=i,i=r.right;return r.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let r=this.root.right;if(r==null)return null;let i=r.left;for(;i!=null;)r=i,i=r.left;return r.key}retainAll(e){let r=new __(this.compare,this.validKey),i=this.modificationCount;for(let n of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(n)&&this.splay(n)==0&&r.add(this.root.key)}r.size!=this.size&&(this.root=r.root,this.size=r.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){let r=new __(this.compare,this.validKey);for(let i of this)e.has(i)&&r.add(i);return r}difference(e){let r=new __(this.compare,this.validKey);for(let i of this)e.has(i)||r.add(i);return r}union(e){let r=this.clone();return r.addAll(e),r}clone(){let e=new __(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function r(n,s){let a,c;do{if(a=n.left,c=n.right,a!=null){let h=new m_(a.key);s.left=h,r(a,h)}if(c!=null){let h=new m_(c.key);s.right=h,n=c,s=h}}while(c!=null)}let i=new m_(e.key);return r(e,i),i}toSet(){return this.clone()}entries(){return new VX(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(V6=Symbol.iterator,U6=Symbol.toStringTag,V6)](){return new UX(this.wrap())}},cL=class{constructor(t){wr(this,"tree"),wr(this,"path",new Array),wr(this,"modificationCount",null),wr(this,"splayCount"),this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let r=this.tree.getRoot();for(;r!=null;)this.path.push(r),r=r.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],e=t.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}},UX=class extends cL{getValue(t){return t.key}},VX=class extends cL{getValue(t){return[t.key,t.key]}},uL=t=>()=>t,xC=t=>{let e=t?(r,i)=>i.minus(r).abs().isLessThanOrEqualTo(t):uL(!1);return(r,i)=>e(r,i)?0:r.comparedTo(i)};function jX(t){let e=t?(r,i,n,s,a)=>r.exponentiatedBy(2).isLessThanOrEqualTo(s.minus(i).exponentiatedBy(2).plus(a.minus(n).exponentiatedBy(2)).times(t)):uL(!1);return(r,i,n)=>{let s=r.x,a=r.y,c=n.x,h=n.y,p=a.minus(h).times(i.x.minus(c)).minus(s.minus(c).times(i.y.minus(h)));return e(p,s,a,c,h)?0:p.comparedTo(0)}}var GX=t=>t,HX=t=>{if(t){let e=new Z2(xC(t)),r=new Z2(xC(t)),i=(s,a)=>a.addAndReturn(s),n=s=>({x:i(s.x,e),y:i(s.y,r)});return n({x:new xu(0),y:new xu(0)}),n}return GX},bC=t=>({set:e=>{Lh=bC(e)},reset:()=>bC(t),compare:xC(t),snap:HX(t),orient:jX(t)}),Lh=bC(),g_=(t,e)=>t.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(t.ur.x)&&t.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(t.ur.y),vC=(t,e)=>{if(e.ur.x.isLessThan(t.ll.x)||t.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(t.ll.y)||t.ur.y.isLessThan(e.ll.y))return null;let r=t.ll.x.isLessThan(e.ll.x)?e.ll.x:t.ll.x,i=t.ur.x.isLessThan(e.ur.x)?t.ur.x:e.ur.x,n=t.ll.y.isLessThan(e.ll.y)?e.ll.y:t.ll.y,s=t.ur.y.isLessThan(e.ur.y)?t.ur.y:e.ur.y;return{ll:{x:r,y:n},ur:{x:i,y:s}}},j2=(t,e)=>t.x.times(e.y).minus(t.y.times(e.x)),hL=(t,e)=>t.x.times(e.x).plus(t.y.times(e.y)),X2=t=>hL(t,t).sqrt(),WX=(t,e,r)=>{let i={x:e.x.minus(t.x),y:e.y.minus(t.y)},n={x:r.x.minus(t.x),y:r.y.minus(t.y)};return j2(n,i).div(X2(n)).div(X2(i))},$X=(t,e,r)=>{let i={x:e.x.minus(t.x),y:e.y.minus(t.y)},n={x:r.x.minus(t.x),y:r.y.minus(t.y)};return hL(n,i).div(X2(n)).div(X2(i))},j6=(t,e,r)=>e.y.isZero()?null:{x:t.x.plus(e.x.div(e.y).times(r.minus(t.y))),y:r},G6=(t,e,r)=>e.x.isZero()?null:{x:r,y:t.y.plus(e.y.div(e.x).times(r.minus(t.x)))},qX=(t,e,r,i)=>{if(e.x.isZero())return G6(r,i,t.x);if(i.x.isZero())return G6(t,e,r.x);if(e.y.isZero())return j6(r,i,t.y);if(i.y.isZero())return j6(t,e,r.y);let n=j2(e,i);if(n.isZero())return null;let s={x:r.x.minus(t.x),y:r.y.minus(t.y)},a=j2(s,e).div(n),c=j2(s,i).div(n),h=t.x.plus(c.times(e.x)),p=r.x.plus(a.times(i.x)),x=t.y.plus(c.times(e.y)),T=r.y.plus(a.times(i.y)),R=h.plus(p).div(2),k=x.plus(T).div(2);return{x:R,y:k}},gu=class fL{constructor(e,r){wr(this,"point"),wr(this,"isLeft"),wr(this,"segment"),wr(this,"otherSE"),wr(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}static compare(e,r){let i=fL.comparePoints(e.point,r.point);return i!==0?i:(e.point!==r.point&&e.link(r),e.isLeft!==r.isLeft?e.isLeft?1:-1:K2.compare(e.segment,r.segment))}static comparePoints(e,r){return e.x.isLessThan(r.x)?-1:e.x.isGreaterThan(r.x)?1:e.y.isLessThan(r.y)?-1:e.y.isGreaterThan(r.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");let r=e.point.events;for(let i=0,n=r.length;i<n;i++){let s=r[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}checkForConsuming(){let e=this.point.events.length;for(let r=0;r<e;r++){let i=this.point.events[r];if(i.segment.consumedBy===void 0)for(let n=r+1;n<e;n++){let s=this.point.events[n];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}getAvailableLinkedEvents(){let e=[];for(let r=0,i=this.point.events.length;r<i;r++){let n=this.point.events[r];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){let r=new Map,i=n=>{let s=n.otherSE;r.set(n,{sine:WX(this.point,e.point,s.point),cosine:$X(this.point,e.point,s.point)})};return(n,s)=>{r.has(n)||i(n),r.has(s)||i(s);let{sine:a,cosine:c}=r.get(n),{sine:h,cosine:p}=r.get(s);return a.isGreaterThanOrEqualTo(0)&&h.isGreaterThanOrEqualTo(0)?c.isLessThan(p)?1:c.isGreaterThan(p)?-1:0:a.isLessThan(0)&&h.isLessThan(0)?c.isLessThan(p)?-1:c.isGreaterThan(p)?1:0:h.isLessThan(a)?-1:h.isGreaterThan(a)?1:0}}},ZX=class wC{constructor(e){wr(this,"events"),wr(this,"poly"),wr(this,"_isExteriorRing"),wr(this,"_enclosingRing"),this.events=e;for(let r=0,i=e.length;r<i;r++)e[r].segment.ringOut=this;this.poly=null}static factory(e){let r=[];for(let i=0,n=e.length;i<n;i++){let s=e[i];if(!s.isInResult()||s.ringOut)continue;let a=null,c=s.leftSE,h=s.rightSE,p=[c],x=c.point,T=[];for(;a=c,c=h,p.push(c),c.point!==x;)for(;;){let R=c.getAvailableLinkedEvents();if(R.length===0){let q=p[0].point,X=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${q.x}, ${q.y}]. Last matching segment found ends at [${X.x}, ${X.y}].`)}if(R.length===1){h=R[0].otherSE;break}let k=null;for(let q=0,X=T.length;q<X;q++)if(T[q].point===c.point){k=q;break}if(k!==null){let q=T.splice(k)[0],X=p.splice(q.index);X.unshift(X[0].otherSE),r.push(new wC(X.reverse()));continue}T.push({index:p.length,point:c.point});let j=c.getLeftmostComparator(a);h=R.sort(j)[0].otherSE;break}r.push(new wC(p))}return r}getGeom(){let e=this.events[0].point,r=[e];for(let p=1,x=this.events.length-1;p<x;p++){let T=this.events[p].point,R=this.events[p+1].point;Lh.orient(T,e,R)!==0&&(r.push(T),e=T)}if(r.length===1)return null;let i=r[0],n=r[1];Lh.orient(i,e,n)===0&&r.shift(),r.push(r[0]);let s=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:r.length-1,c=this.isExteriorRing()?r.length:-1,h=[];for(let p=a;p!=c;p+=s)h.push([r[p].x.toNumber(),r[p].y.toNumber()]);return h}isExteriorRing(){if(this._isExteriorRing===void 0){let e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,r;let i=this.events[0];for(let a=1,c=this.events.length;a<c;a++){let h=this.events[a];gu.compare(i,h)>0&&(i=h)}let n=i.segment.prevInResult(),s=n?n.prevInResult():null;for(;;){if(!n)return null;if(!s)return n.ringOut;if(s.ringOut!==n.ringOut)return((e=s.ringOut)==null?void 0:e.enclosingRing())!==n.ringOut?n.ringOut:(r=n.ringOut)==null?void 0:r.enclosingRing();n=s.prevInResult(),s=n?n.prevInResult():null}}},H6=class{constructor(t){wr(this,"exteriorRing"),wr(this,"interiorRings"),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){let t=this.exteriorRing.getGeom();if(t===null)return null;let e=[t];for(let r=0,i=this.interiorRings.length;r<i;r++){let n=this.interiorRings[r].getGeom();n!==null&&e.push(n)}return e}},XX=class{constructor(t){wr(this,"rings"),wr(this,"polys"),this.rings=t,this.polys=this._composePolys(t)}getGeom(){let t=[];for(let e=0,r=this.polys.length;e<r;e++){let i=this.polys[e].getGeom();i!==null&&t.push(i)}return t}_composePolys(t){var e;let r=[];for(let i=0,n=t.length;i<n;i++){let s=t[i];if(!s.poly)if(s.isExteriorRing())r.push(new H6(s));else{let a=s.enclosingRing();a!=null&&a.poly||r.push(new H6(a)),(e=a?.poly)==null||e.addInterior(s)}}return r}},YX=class{constructor(t,e=K2.compare){wr(this,"queue"),wr(this,"tree"),wr(this,"segments"),this.queue=t,this.tree=new Z2(e),this.segments=[]}process(t){let e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(e),r;t.isLeft&&this.tree.add(e);let i=e,n=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do n=this.tree.firstAfter(n);while(n!=null&&n.consumedBy!=null);if(t.isLeft){let s=null;if(i){let c=i.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(s=c),!i.isAnEndpoint(c))){let h=this._splitSafely(i,c);for(let p=0,x=h.length;p<x;p++)r.push(h[p])}}let a=null;if(n){let c=n.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(a=c),!n.isAnEndpoint(c))){let h=this._splitSafely(n,c);for(let p=0,x=h.length;p<x;p++)r.push(h[p])}}if(s!==null||a!==null){let c=null;s===null?c=a:a===null?c=s:c=gu.comparePoints(s,a)<=0?s:a,this.queue.delete(e.rightSE),r.push(e.rightSE);let h=e.split(c);for(let p=0,x=h.length;p<x;p++)r.push(h[p])}r.length>0?(this.tree.delete(e),r.push(t)):(this.segments.push(e),e.prev=i)}else{if(i&&n){let s=i.getIntersection(n);if(s!==null){if(!i.isAnEndpoint(s)){let a=this._splitSafely(i,s);for(let c=0,h=a.length;c<h;c++)r.push(a[c])}if(!n.isAnEndpoint(s)){let a=this._splitSafely(n,s);for(let c=0,h=a.length;c<h;c++)r.push(a[c])}}}this.tree.delete(e)}return r}_splitSafely(t,e){this.tree.delete(t);let r=t.rightSE;this.queue.delete(r);let i=t.split(e);return i.push(r),t.consumedBy===void 0&&this.tree.add(t),i}},KX=class{constructor(){wr(this,"type"),wr(this,"numMultiPolys")}run(t,e,r){y_.type=t;let i=[new $6(e,!0)];for(let h=0,p=r.length;h<p;h++)i.push(new $6(r[h],!1));if(y_.numMultiPolys=i.length,y_.type==="difference"){let h=i[0],p=1;for(;p<i.length;)vC(i[p].bbox,h.bbox)!==null?p++:i.splice(p,1)}if(y_.type==="intersection")for(let h=0,p=i.length;h<p;h++){let x=i[h];for(let T=h+1,R=i.length;T<R;T++)if(vC(x.bbox,i[T].bbox)===null)return[]}let n=new Z2(gu.compare);for(let h=0,p=i.length;h<p;h++){let x=i[h].getSweepEvents();for(let T=0,R=x.length;T<R;T++)n.add(x[T])}let s=new YX(n),a=null;for(n.size!=0&&(a=n.first(),n.delete(a));a;){let h=s.process(a);for(let p=0,x=h.length;p<x;p++){let T=h[p];T.consumedBy===void 0&&n.add(T)}n.size!=0?(a=n.first(),n.delete(a)):a=null}Lh.reset();let c=ZX.factory(s.segments);return new XX(c).getGeom()}},y_=new KX,Y2=y_,QX=0,K2=class G2{constructor(e,r,i,n){wr(this,"id"),wr(this,"leftSE"),wr(this,"rightSE"),wr(this,"rings"),wr(this,"windings"),wr(this,"ringOut"),wr(this,"consumedBy"),wr(this,"prev"),wr(this,"_prevInResult"),wr(this,"_beforeState"),wr(this,"_afterState"),wr(this,"_isInResult"),this.id=++QX,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=i,this.windings=n}static compare(e,r){let i=e.leftSE.point.x,n=r.leftSE.point.x,s=e.rightSE.point.x,a=r.rightSE.point.x;if(a.isLessThan(i))return 1;if(s.isLessThan(n))return-1;let c=e.leftSE.point.y,h=r.leftSE.point.y,p=e.rightSE.point.y,x=r.rightSE.point.y;if(i.isLessThan(n)){if(h.isLessThan(c)&&h.isLessThan(p))return 1;if(h.isGreaterThan(c)&&h.isGreaterThan(p))return-1;let T=e.comparePoint(r.leftSE.point);if(T<0)return 1;if(T>0)return-1;let R=r.comparePoint(e.rightSE.point);return R!==0?R:-1}if(i.isGreaterThan(n)){if(c.isLessThan(h)&&c.isLessThan(x))return-1;if(c.isGreaterThan(h)&&c.isGreaterThan(x))return 1;let T=r.comparePoint(e.leftSE.point);if(T!==0)return T;let R=e.comparePoint(r.rightSE.point);return R<0?1:R>0?-1:1}if(c.isLessThan(h))return-1;if(c.isGreaterThan(h))return 1;if(s.isLessThan(a)){let T=r.comparePoint(e.rightSE.point);if(T!==0)return T}if(s.isGreaterThan(a)){let T=e.comparePoint(r.rightSE.point);if(T<0)return 1;if(T>0)return-1}if(!s.eq(a)){let T=p.minus(c),R=s.minus(i),k=x.minus(h),j=a.minus(n);if(T.isGreaterThan(R)&&k.isLessThan(j))return 1;if(T.isLessThan(R)&&k.isGreaterThan(j))return-1}return s.isGreaterThan(a)?1:s.isLessThan(a)||p.isLessThan(x)?-1:p.isGreaterThan(x)?1:e.id<r.id?-1:e.id>r.id?1:0}static fromRing(e,r,i){let n,s,a,c=gu.comparePoints(e,r);if(c<0)n=e,s=r,a=1;else if(c>0)n=r,s=e,a=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);let h=new gu(n,!0),p=new gu(s,!1);return new G2(h,p,[i],[a])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let e=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(r)?e:r},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(r)?e:r}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Lh.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){let r=this.bbox(),i=e.bbox(),n=vC(r,i);if(n===null)return null;let s=this.leftSE.point,a=this.rightSE.point,c=e.leftSE.point,h=e.rightSE.point,p=g_(r,c)&&this.comparePoint(c)===0,x=g_(i,s)&&e.comparePoint(s)===0,T=g_(r,h)&&this.comparePoint(h)===0,R=g_(i,a)&&e.comparePoint(a)===0;if(x&&p)return R&&!T?a:!R&&T?h:null;if(x)return T&&s.x.eq(h.x)&&s.y.eq(h.y)?null:s;if(p)return R&&a.x.eq(c.x)&&a.y.eq(c.y)?null:c;if(R&&T)return null;if(R)return a;if(T)return h;let k=qX(s,this.vector(),c,e.vector());return k===null||!g_(n,k)?null:Lh.snap(k)}split(e){let r=[],i=e.events!==void 0,n=new gu(e,!0),s=new gu(e,!1),a=this.rightSE;this.replaceRightSE(s),r.push(s),r.push(n);let c=new G2(n,a,this.rings.slice(),this.windings.slice());return gu.comparePoints(c.leftSE.point,c.rightSE.point)>0&&c.swapEvents(),gu.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),s.checkForConsuming()),r}swapEvents(){let e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}consume(e){let r=this,i=e;for(;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;let n=G2.compare(r,i);if(n!==0){if(n>0){let s=r;r=i,i=s}if(r.prev===i){let s=r;r=i,i=s}for(let s=0,a=i.rings.length;s<a;s++){let c=i.rings[s],h=i.windings[s],p=r.rings.indexOf(c);p===-1?(r.rings.push(c),r.windings.push(h)):r.windings[p]+=h}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};let r=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys;for(let c=0,h=this.rings.length;c<h;c++){let p=this.rings[c],x=this.windings[c],T=r.indexOf(p);T===-1?(r.push(p),i.push(x)):i[T]+=x}let s=[],a=[];for(let c=0,h=r.length;c<h;c++){if(i[c]===0)continue;let p=r[c],x=p.poly;if(a.indexOf(x)===-1)if(p.isExterior)s.push(x);else{a.indexOf(x)===-1&&a.push(x);let T=s.indexOf(p.poly);T!==-1&&s.splice(T,1)}}for(let c=0,h=s.length;c<h;c++){let p=s[c].multiPoly;n.indexOf(p)===-1&&n.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let e=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Y2.type){case"union":{let i=e.length===0,n=r.length===0;this._isInResult=i!==n;break}case"intersection":{let i,n;e.length<r.length?(i=e.length,n=r.length):(i=r.length,n=e.length),this._isInResult=n===Y2.numMultiPolys&&i<n;break}case"xor":{let i=Math.abs(e.length-r.length);this._isInResult=i%2===1;break}case"difference":{let i=n=>n.length===1&&n[0].isSubject;this._isInResult=i(e)!==i(r);break}}return this._isInResult}},W6=class{constructor(t,e,r){if(wr(this,"poly"),wr(this,"isExterior"),wr(this,"segments"),wr(this,"bbox"),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=r,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let i=Lh.snap({x:new xu(t[0][0]),y:new xu(t[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let n=i;for(let s=1,a=t.length;s<a;s++){if(typeof t[s][0]!="number"||typeof t[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let c=Lh.snap({x:new xu(t[s][0]),y:new xu(t[s][1])});c.x.eq(n.x)&&c.y.eq(n.y)||(this.segments.push(K2.fromRing(n,c,this)),c.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.x),c.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.y),c.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.x),c.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.y),n=c)}(!i.x.eq(n.x)||!i.y.eq(n.y))&&this.segments.push(K2.fromRing(n,i,this))}getSweepEvents(){let t=[];for(let e=0,r=this.segments.length;e<r;e++){let i=this.segments[e];t.push(i.leftSE),t.push(i.rightSE)}return t}},JX=class{constructor(t,e){if(wr(this,"multiPoly"),wr(this,"exteriorRing"),wr(this,"interiorRings"),wr(this,"bbox"),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new W6(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,i=t.length;r<i;r++){let n=new W6(t[r],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=e}getSweepEvents(){let t=this.exteriorRing.getSweepEvents();for(let e=0,r=this.interiorRings.length;e<r;e++){let i=this.interiorRings[e].getSweepEvents();for(let n=0,s=i.length;n<s;n++)t.push(i[n])}return t}},$6=class{constructor(t,e){if(wr(this,"isSubject"),wr(this,"polys"),wr(this,"bbox"),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new xu(Number.POSITIVE_INFINITY),y:new xu(Number.POSITIVE_INFINITY)},ur:{x:new xu(Number.NEGATIVE_INFINITY),y:new xu(Number.NEGATIVE_INFINITY)}};for(let r=0,i=t.length;r<i;r++){let n=new JX(t[r],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=e}getSweepEvents(){let t=[];for(let e=0,r=this.polys.length;e<r;e++){let i=this.polys[e].getSweepEvents();for(let n=0,s=i.length;n<s;n++)t.push(i[n])}return t}},eY=(t,...e)=>Y2.run("union",t,e),tY=(t,...e)=>Y2.run("difference",t,e);Lh.set;function dL(t,e,r){if(t!==null)for(var i,n,s,a,c,h,p,x=0,T=0,R,k=t.type,j=k==="FeatureCollection",q=k==="Feature",X=j?t.features.length:1,re=0;re<X;re++){p=j?t.features[re].geometry:q?t.geometry:t,R=p?p.type==="GeometryCollection":!1,c=R?p.geometries.length:1;for(var te=0;te<c;te++){var oe=0,ae=0;if(a=R?p.geometries[te]:p,a!==null){h=a.coordinates;var pe=a.type;switch(x=0,pe){case null:break;case"Point":if(e(h,T,re,oe,ae)===!1)return!1;T++,oe++;break;case"LineString":case"MultiPoint":for(i=0;i<h.length;i++){if(e(h[i],T,re,oe,ae)===!1)return!1;T++,pe==="MultiPoint"&&oe++}pe==="LineString"&&oe++;break;case"Polygon":case"MultiLineString":for(i=0;i<h.length;i++){for(n=0;n<h[i].length-x;n++){if(e(h[i][n],T,re,oe,ae)===!1)return!1;T++}pe==="MultiLineString"&&oe++,pe==="Polygon"&&ae++}pe==="Polygon"&&oe++;break;case"MultiPolygon":for(i=0;i<h.length;i++){for(ae=0,n=0;n<h[i].length;n++){for(s=0;s<h[i][n].length-x;s++){if(e(h[i][n][s],T,re,oe,ae)===!1)return!1;T++}ae++}oe++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(dL(a.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function SC(t,e){var r,i,n,s,a,c,h,p,x,T,R=0,k=t.type==="FeatureCollection",j=t.type==="Feature",q=k?t.features.length:1;for(r=0;r<q;r++){for(c=k?t.features[r].geometry:j?t.geometry:t,p=k?t.features[r].properties:j?t.properties:{},x=k?t.features[r].bbox:j?t.bbox:void 0,T=k?t.features[r].id:j?t.id:void 0,h=c?c.type==="GeometryCollection":!1,a=h?c.geometries.length:1,n=0;n<a;n++){if(s=h?c.geometries[n]:c,s===null){if(e(null,R,p,x,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(s,R,p,x,T)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<s.geometries.length;i++)if(e(s.geometries[i],R,p,x,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function rY(t,e){SC(t,function(r,i,n,s,a){var c=r===null?null:r.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return e(w_(r,n,{bbox:s,id:a}),i,0)===!1?!1:void 0}var h;switch(c){case"MultiPoint":h="Point";break;case"MultiLineString":h="LineString";break;case"MultiPolygon":h="Polygon";break}for(var p=0;p<r.coordinates.length;p++){var x=r.coordinates[p],T={type:h,coordinates:x};if(e(w_(T,n),i,p)===!1)return!1}})}function iY(t,e={}){let r=[];if(SC(t,n=>{r.push(n.coordinates)}),r.length<2)throw new Error("Must have at least 2 geometries");let i=eY(r[0],...r.slice(1));return i.length===0?null:i.length===1?CC(i[0],e.properties):aL(i,e.properties)}var pL=iY;function nY(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;let r=[1/0,1/0,-1/0,-1/0];return dL(t,i=>{r[0]>i[0]&&(r[0]=i[0]),r[1]>i[1]&&(r[1]=i[1]),r[2]<i[0]&&(r[2]=i[0]),r[3]<i[1]&&(r[3]=i[1])}),r}var q6=nY;function sY(t){let e=[];if(SC(t,n=>{e.push(n.coordinates)}),e.length<2)throw new Error("Must have at least two features");let r=t.features[0].properties||{},i=tY(e[0],...e.slice(1));return i.length===0?null:i.length===1?CC(i[0],r):aL(i,r)}var oY=sY;function aY(t){if(!t)throw new Error("geojson is required");var e=[];return rY(t,function(r){e.push(r)}),T_(e)}var lY=aY;function Z6(t,e){let r=oY(T_([CC([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),t]));if(!r)return;r.properties={isMask:!0};let i=q2(q6(t)),n=(i[2]-i[0])/360/1e3,s=i[0]<-180,a=i[2]>180,c=lY(t);if(c.features.length>1&&(s||a))for(let h of c.features){let p=q2(q6(h));if(a&&p[0]<-180+n)for(let x of h.geometry.coordinates)for(let T of x)T[0]+=360-n;if(s&&p[2]>180-n)for(let x of h.geometry.coordinates)for(let T of x)T[0]-=360-n}e(T_([c.features.length<2?t:pL(c)??t,r]))}var X6={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},N2="mtlr-gc-full-geom",Y6="mtlr-gc-full-geom-fill",K6="mtlr-gc-full-geom-line";function cY(t,e,r=!0,i=!0,n={},s={},a=X6){let c,h=[],p,x,T;function R(){if(!t.loaded){t.once("load",R);return}let X=a?a===!0?X6:a:void 0;if(!(X!=null&&X.fill)&&!(X!=null&&X.line))return;let re=t.getSource(N2);if(re)re.setData(T??T_([]));else if(T)t.addSource(N2,{type:"geojson",data:T});else return;!t.getLayer(Y6)&&X!=null&&X.fill&&t.addLayer({...X?.fill,id:Y6,type:"fill",source:N2}),!t.getLayer(K6)&&X!=null&&X.line&&t.addLayer({...X?.line,id:K6,type:"line",source:N2})}function k(X){T=X,R()}t.on("styledata",()=>{setTimeout(()=>{T&&R()})});let j=X=>{c?.({type:"mapClick",coordinates:[X.lngLat.lng,X.lngLat.lat]})};function q(X=!1){if(!e)throw new Error;let re=document.createElement("div");return X&&re.classList.add("marker-interactive"),new gC({props:{displayIn:"maplibre"},target:re}),new e.Marker({element:re,offset:[1,-13]})}return{setEventHandler(X){X?(c=X,t.on("click",j)):(c=void 0,t.off("click",j))},flyTo(X,re){t.flyTo({center:X,...re?{zoom:re}:{},...n})},fitBounds(X,re,te){t.fitBounds([[X[0],X[1]],[X[2],X[3]]],{padding:re,...te?{maxZoom:te}:{},...s})},indicateReverse(X){t.getCanvasContainer().style.cursor=X?"crosshair":""},setReverseMarker(X){!e||!r||(x?X?x.setLngLat(X):(x.remove(),x=void 0):X&&(r instanceof Function?x=r(t)??void 0:(x=(typeof r=="object"?new e.Marker(r):q()).setLngLat(X).addTo(t),x.getElement().classList.add("marker-reverse"))))},setFeatures(X,re,te){for(let oe of h)oe.remove();if(h.length=0,k(void 0),!!e){e:if(re){let oe=!1;if(re.geometry.type==="GeometryCollection"){let ae=re.geometry.geometries.filter(pe=>pe.type==="Polygon"||pe.type==="MultiPolygon");t:if(ae.length>0){let pe=pL(T_(ae.map(be=>w_(be))));if(!pe)break t;Z6({...re,geometry:pe.geometry},k),oe=!0}else{let pe=re.geometry.geometries.filter(be=>be.type==="LineString"||be.type==="MultiLineString");pe.length>0&&(k({...re,geometry:{type:"GeometryCollection",geometries:pe}}),oe=!0)}}if(!oe){if(re.geometry.type==="Polygon"||re.geometry.type==="MultiPolygon")Z6(re,k);else if(re.geometry.type==="LineString"||re.geometry.type==="MultiLineString"){k(re);break e}}if(!te&&!re.geometry.type.endsWith("Point"))break e;if(r instanceof Function){let ae=r(t,re);ae&&h.push(ae)}else r&&h.push(typeof r=="object"?new e.Marker(r):q().setLngLat(re.center).addTo(t))}if(i)for(let oe of X??[]){if(oe===re)continue;let ae;if(i instanceof Function){if(ae=i(t,oe),!ae)continue}else ae=(typeof i=="object"?new e.Marker(i):q(!0)).setLngLat(oe.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(oe.place_type[0]==="reverse"?oe.place_name:oe.place_name.replace(/,.*/,""))).addTo(t);let pe=ae.getElement();pe.addEventListener("click",be=>{be.stopPropagation(),c?.({type:"markerClick",id:oe.id})}),pe.addEventListener("mouseenter",()=>{c?.({type:"markerMouseEnter",id:oe.id}),ae.togglePopup()}),pe.addEventListener("mouseleave",()=>{c?.({type:"markerMouseLeave",id:oe.id}),ae.togglePopup()}),h.push(ae)}}},setSelectedMarker(X){p&&p.getElement().classList.toggle("marker-selected",!1),p=X>-1?h[X]:void 0,p?.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){let X=t.getCenter();return[t.getZoom(),X.lng,X.lat]}}}function uY(t,e,r){var i,n,s;class a{constructor(re,te){wr(this,"type"),wr(this,"target"),this.type=te,this.target=re}}class c extends a{constructor(re,te){super(re,"select"),wr(this,"feature"),Object.assign(this,te)}}class h extends a{constructor(re,te){super(re,"featureslisted"),wr(this,"features"),this.features=te}}class p extends a{constructor(re,te){super(re,"featuresmarked"),wr(this,"features"),this.features=te}}class x extends a{constructor(re,te){super(re,"optionsvisibilitychange"),wr(this,"optionsVisible"),this.optionsVisible=te}}class T extends a{constructor(re,te){super(re,"pick"),wr(this,"feature"),this.feature=te}}class R extends a{constructor(re,te){super(re,"querychange"),wr(this,"query"),this.query=te}}class k extends a{constructor(re,te,oe){super(re,"response"),wr(this,"url"),wr(this,"featureCollection"),this.url=te,this.featureCollection=oe}}class j extends a{constructor(re,te){super(re,"reversetoggle"),wr(this,"reverse"),this.reverse=te}}class q extends t{constructor(re={}){super(),aC(this,i),aC(this,n),aC(this,s),L2(this,n,re)}onAddInt(re){let te=document.createElement("div");te.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";let{marker:oe,showResultMarkers:ae,flyTo:pe,fullGeometryStyle:be,...Fe}=Cs(this,n),Y=typeof pe=="boolean"?{}:pe,J={mapController:cY(re,e,oe,ae,Y,Y,be),flyTo:pe===void 0?!0:!!pe,apiKey:"",...r?.(re,te),...Fe};if(!J.apiKey)throw new Error("no apiKey provided");return L2(this,i,new FX({target:te,props:J})),Cs(this,i).$on("select",Z=>{this.fire(new c(this,Z.detail))}),Cs(this,i).$on("pick",Z=>{this.fire(new T(this,Z.detail.feature))}),Cs(this,i).$on("featureslisted",Z=>{this.fire(new h(this,Z.detail.features))}),Cs(this,i).$on("featuresmarked",Z=>{this.fire(new p(this,Z.detail.features))}),Cs(this,i).$on("response",Z=>{this.fire(new k(this,Z.detail.url,Z.detail.featureCollection))}),Cs(this,i).$on("optionsvisibilitychange",Z=>{this.fire(new x(this,Z.detail.optionsVisible))}),Cs(this,i).$on("reversetoggle",Z=>{this.fire(new j(this,Z.detail.reverse))}),Cs(this,i).$on("querychange",Z=>{this.fire(new R(this,Z.detail.query))}),L2(this,s,te),te}on(re,te){return super.on(re,te)}once(re,te){return super.once(re,te)}off(re,te){return super.off(re,te)}listens(re){return super.listens(re)}setOptions(re){var te;Object.assign(Cs(this,n),re);let{marker:oe,showResultMarkers:ae,flyTo:pe,fullGeometryStyle:be,...Fe}=Cs(this,n);(te=Cs(this,i))==null||te.$set(Fe)}setQuery(re,te=!0){var oe;(oe=Cs(this,i))==null||oe.setQuery(re,te)}clearMap(){var re;(re=Cs(this,i))==null||re.clearMap()}clearList(){var re;(re=Cs(this,i))==null||re.clearList()}setReverseMode(re){var te;(te=Cs(this,i))==null||te.$set({reverseActive:re})}focus(re){var te;(te=Cs(this,i))==null||te.focus(re)}blur(){var re;(re=Cs(this,i))==null||re.blur()}onRemove(){var re,te,oe;(re=Cs(this,i))==null||re.$destroy(),L2(this,i,void 0),(oe=(te=Cs(this,s))==null?void 0:te.parentNode)==null||oe.removeChild(Cs(this,s))}}return i=new WeakMap,n=new WeakMap,s=new WeakMap,{MapLibreBasedGeocodingControl:q,events:{SelectEvent:c,FeaturesListedEvent:h,FeaturesMarkedEvent:p,OptionsVisibilityChangeEvent:x,PickEvent:T,QueryChangeEvent:R,ResponseEvent:k,ReverseToggleEvent:j}}}var{MapLibreBasedGeocodingControl:hY,events:id}=uY(TC.Evented,TC),Q2=class extends hY{onAdd(e){return super.onAddInt(e)}},D1e=id.SelectEvent,F1e=id.FeaturesListedEvent,k1e=id.FeaturesMarkedEvent,N1e=id.OptionsVisibilityChangeEvent,z1e=id.PickEvent,U1e=id.QueryChangeEvent,V1e=id.ResponseEvent,j1e=id.ReverseToggleEvent;var E_=class{constructor(e){this._container=null,this._options=e||{}}onAdd(e){return this._map=e,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.style.cssText=this._options.cssText||"padding: 10px;",this._container.innerHTML=this._options.content||"We out here.",this._container}onRemove(){var e,r;(r=(e=this._container)===null||e===void 0?void 0:e.parentNode)===null||r===void 0||r.removeChild(this._container),this._map=void 0}};var fY={default:"layer-switcher-ctrl",simple:"layer-switcher-ctrl-simple"};function dY(t,e){let r=document.createElement("a");r.id=e,r.href="#",r.textContent=e;let i=t.getLayoutProperty(e,"visibility");return(typeof i>"u"||i==="visible")&&(r.className="active"),r.onclick=function(n){let s=r.textContent,a=t.getLayoutProperty(s,"visibility");if(console.log(s,a),typeof a>"u"||a==="visible"){t.setLayoutProperty(s,"visibility","none"),r.className="";return}t.setLayoutProperty(s,"visibility","visible"),r.className="active"},r}function pY(t,e){let r=document.createElement("div");r.id="layer-switcher-menu";for(let i of e){let n=dY(t,i);r.appendChild(n)}return r}var C_=class{constructor(e){this._container=null,this._options=e}onAdd(e){this._map=e,this._container=document.createElement("div"),this._container.classList.add("maplibregl-ctrl"),this._container.classList.add(fY[this._options.theme||"default"]),this._container.style.cssText=this._options.cssText||"";let r=this._options.layerIds;return this._container.appendChild(pY(e,r)),this._container}onRemove(){var e,r;(r=(e=this._container)===null||e===void 0?void 0:e.parentNode)===null||r===void 0||r.removeChild(this._container),this._map=void 0}getDefaultPosition(){return"top-left"}};async function el(t,e,r,i){return i._parse(t,e,r,i)}function Ii(t,e){if(!t)throw new Error(e||"loader assertion failed.")}var vu={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},AY=vu.self||vu.window||vu.global||{},mY=vu.window||vu.self||vu.global||{},gY=vu.global||vu.self||vu.window||{},_Y=vu.document||{};var Dh=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser);var AL=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),yY=AL&&parseFloat(AL[1])||0;var J2=globalThis,xY=globalThis.document||{},eb=globalThis.process||{},bY=globalThis.console,mL=globalThis.navigator||{};function tb(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let e=typeof navigator<"u"&&navigator.userAgent,r=t||e;return!!(r&&r.indexOf("Electron")>=0)}function oa(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||tb()}function IC(t){return!t&&!oa()?"Node":tb(t)?"Electron":(t||mL.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var MC="4.1.0";function wY(t){try{let e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}var rb=class{constructor(e,r,i="sessionStorage"){this.storage=wY(i),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){let r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){let r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}};function gL(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function _L(t,e=8){let r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var ib;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ib||(ib={}));var TY=10;function yL(t){return typeof t!="string"?t:(t=t.toUpperCase(),ib[t]||ib.WHITE)}function xL(t,e,r){return!oa&&typeof t=="string"&&(e&&(t=`\x1B[${yL(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${yL(r)+TY}m${t}\x1B[49m`)),t}function bL(t,e=["constructor"]){let r=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(r),n=t;for(let s of i){let a=n[s];typeof a=="function"&&(e.find(c=>s===c)||(n[s]=a.bind(t)))}}function S_(t,e){if(!t)throw new Error(e||"Assertion failed")}function Rp(){let t;if(oa()&&J2.performance)t=J2?.performance?.now?.();else if("hrtime"in eb){let e=eb?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}var km={debug:oa()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},EY={enabled:!0,level:0};function Nm(){}var vL={},wL={once:!0},Ia=class{constructor({id:e}={id:""}){this.VERSION=MC,this._startTs=Rp(),this._deltaTs=Rp(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new rb(`__probe-${this.id}__`,EY),this.timeStamp(`${this.id} started`),bL(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Rp()-this._startTs).toPrecision(10))}getDelta(){return Number((Rp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,km.warn,arguments,wL)}error(e){return this._getLogFunction(0,e,km.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,km.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,km.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,km.debug||km.info,arguments,wL)}table(e,r,i){return r?this._getLogFunction(e,r,console.table||Nm,i&&[i],{tag:SY(r)}):Nm}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||Nm)}group(e,r,i={collapsed:!1}){let n=TL({logLevel:e,message:r,opts:i}),{collapsed:s}=i;return n.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,r,i={}){return this.group(e,r,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Nm)}withGroup(e,r,i){this.group(e,r)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=EL(e)}_getLogFunction(e,r,i,n,s){if(this._shouldLog(e)){s=TL({logLevel:e,message:r,args:n,opts:s}),i=i||s.method,S_(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Rp();let a=s.tag||s.message;if(s.once&&a)if(!vL[a])vL[a]=Rp();else return Nm;return r=CY(this.id,s.message,s),i.bind(console,r,...s.args)}return Nm}};Ia.VERSION=MC;function EL(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return S_(Number.isFinite(e)&&e>=0),e}function TL(t){let{logLevel:e,message:r}=t;t.logLevel=EL(e);let i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&i.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break;default:}typeof t.message=="function"&&(t.message=t.message());let n=typeof t.message;return S_(n==="string"||n==="object"),Object.assign(t,{args:i},t.opts)}function CY(t,e,r){if(typeof e=="string"){let i=r.time?_L(gL(r.total)):"";e=r.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=xL(e,r.color,r.background)}return e}function SY(t){for(let e in t)for(let r in t[e])return r||"untitled";return"empty"}globalThis.probe={};var PC=new Ia({id:"@probe.gl/log"});var RC="4.3.2",IY=RC[0]>="0"&&RC[0]<="9"?`v${RC}`:"";function MY(){let t=new Ia({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=IY,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}var I_=MY();function M_(t,e){return CL(t||{},e)}function CL(t,e,r=0){if(r>3)return e;let i={...t};for(let[n,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?i[n]=CL(i[n]||{},e[n],r+1):i[n]=e[n];return i}function BC(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function LC(t){return globalThis.loaders?.modules?.[t]||null}var SL="latest";function PY(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}var P_=PY();function Oo(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}var wu={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Kye=wu.self||wu.window||wu.global||{},Qye=wu.window||wu.self||wu.global||{},Jye=wu.global||wu.self||wu.window||{},exe=wu.document||{};var _o=typeof process!="object"||String(process)!=="[object process]"||process.browser,R_=typeof importScripts=="function",ML=typeof window<"u"&&typeof window.orientation<"u",IL=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),txe=IL&&parseFloat(IL[1])||0;var B_=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){Oo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Oo(this.isRunning),this.isRunning=!1,this._reject(e)}};var zm=class{terminate(){}};var OC=new Map;function PL(t){Oo(t.source&&!t.url||!t.source&&t.url);let e=OC.get(t.source||t.url);return e||(t.url&&(e=RY(t.url),OC.set(t.url,e)),t.source&&(e=RL(t.source),OC.set(t.source,e))),Oo(e),e}function RY(t){if(!t.startsWith("http"))return t;let e=BY(t);return RL(e)}function RL(t){let e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function BY(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function DC(t,e=!0,r){let i=r||new Set;if(t){if(BL(t))i.add(t);else if(BL(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(let n in t)DC(t[n],e,i)}}return r===void 0?Array.from(i):[]}function BL(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}var FC=()=>{},nd=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&_o||typeof zm<"u"&&!_o}constructor(e){let{name:r,source:i,url:n}=e;Oo(i||n),this.name=r,this.source=i,this.url=n,this.onMessage=FC,this.onError=s=>console.log(s),this.worker=_o?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=FC,this.onError=FC,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||DC(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=PL({source:this.source,url:this.url});let e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){let i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new zm(i,{eval:!1})}else if(this.source)e=new zm(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}};var L_=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return nd.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(n,s,a)=>n.done(a),i=(n,s)=>n.error(s)){let n=new Promise(s=>(this.jobQueue.push({name:e,onMessage:r,onError:i,onStart:s}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});let i=new B_(r.name,e);e.onMessage=n=>r.onMessage(i,n.type,n.payload),e.onError=n=>r.onError(i,n),r.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!_o||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new nd({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return ML?this.maxMobileConcurrency:this.maxConcurrency}};var LY={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Bp=class t{props;workerPools=new Map;static _workerFarm;static isSupported(){return nd.isSupported()}static getWorkerFarm(e={}){return t._workerFarm=t._workerFarm||new t({}),t._workerFarm.setProps(e),t._workerFarm}constructor(e){this.props={...LY},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(let r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:r,source:i,url:n}=e,s=this.workerPools.get(r);return s||(s=new L_({name:r,source:i,url:n}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function kC(t,e={}){let r=e[t.id]||{},i=_o?`${t.id}-worker.js`:`${t.id}-worker-node.js`,n=r.workerUrl;if(!n&&t.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(_o?n=`modules/${t.module}/dist/${i}`:n=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!n){let s=t.version;s==="latest"&&(s=SL);let a=s?`@${s}`:"";n=`https://unpkg.com/@loaders.gl/${t.module}${a}/dist/${i}`}return Oo(n),n}function NC(t,e=P_){Oo(t,"no worker provided");let r=t.version;return!(!e||!r)}var zC={};async function Tu(t,e=null,r={},i=null){return e&&(t=LL(t,e,r,i)),zC[t]=zC[t]||OY(t),await zC[t]}function LL(t,e,r={},i=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;i=i||t;let n=r.modules||{};return n[i]?n[i]:_o?r.CDN?(Oo(r.CDN.startsWith("http")),`${r.CDN}/${e}@${P_}/dist/libs/${i}`):R_?`../src/libs/${i}`:`modules/${e}/src/libs/${i}`:`modules/${e}/dist/libs/${i}`}async function OY(t){if(t.endsWith("wasm"))return await FY(t);if(!_o)try{let{requireFromFile:r}=globalThis.loaders||{};return await r?.(t)}catch(r){return console.error(r),null}if(R_)return importScripts(t);let e=await kY(t);return DY(e,t)}function DY(t,e){if(!_o){let{requireFromString:i}=globalThis.loaders||{};return i?.(t,e)}if(R_)return eval.call(globalThis,t),null;let r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function FY(t){let{readFileAsArrayBuffer:e}=globalThis.loaders||{};return _o||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function kY(t){let{readFileAsText:e}=globalThis.loaders||{};return _o||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function UC(t,e){return!Bp.isSupported()||!_o&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function VC(t,e,r,i,n){let s=t.id,a=kC(t,r),h=Bp.getWorkerFarm(r).getWorkerPool({name:s,url:a});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));let p=await h.startJob("process-on-worker",NY.bind(null,n));return p.postMessage("process",{input:e,options:r,context:i}),await(await p.result).result}async function NY(t,e,r,i){switch(r){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":let{id:n,input:s,options:a}=i;try{let c=await t(s,a);e.postMessage("done",{id:n,result:c})}catch(c){let h=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:n,error:h})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function DL(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?OL(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?OL(t,0,e):""}function OL(t,e,r){if(t.byteLength<=e+r)return"";let i=new DataView(t),n="";for(let s=0;s<r;s++)n+=String.fromCharCode(i.getUint8(e+s));return n}function jC(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${DL(t)}"`)}}function GC(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;let i=new Uint8Array(t),n=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s])return!1;return!0}function HC(...t){return FL(t)}function FL(t){let e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),r=e.reduce((s,a)=>s+a.byteLength,0),i=new Uint8Array(r),n=0;for(let s of e)i.set(s,n),n+=s.byteLength;return i.buffer}function O_(...t){let e=t,r=e&&e.length>1&&e[0].constructor||null;if(!r)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');let i=e.reduce((a,c)=>a+c.length,0),n=new r(i),s=0;for(let a of e)n.set(a,s),s+=a.length;return n}function Lp(t,e,r){let i=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function sd(t,e){return Ii(t>=0),Ii(e>0),t+(e-1)&~(e-1)}function WC(t,e,r){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{let n=t.byteOffset,s=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,n,s)}return e.set(i,r),r+sd(i.byteLength,4)}async function $C(t){let e=[];for await(let r of t)e.push(r);return HC(...e)}function D_(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){let e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}var Op=class{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=D_(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(D_()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var Go=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(let e of Object.values(this.stats))e.reset();return this}forEach(e){for(let r of Object.values(this.stats))e(r)}getTable(){let e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){let{name:r,type:i}=e,n=this.stats[r];return n||(e instanceof Op?n=e:n=new Op(r,i),this.stats[r]=n),n}};var zY="Queued Requests",UY="Active Requests",VY="Cancelled Requests",jY="Queued Requests Ever",GY="Active Requests Ever",HY={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0},od=class{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...HY,...e},this.stats=new Go({id:this.props.id}),this.stats.get(zY),this.stats.get(UY),this.stats.get(VY),this.stats.get(jY),this.stats.get(GY)}scheduleRequest(e,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);let i={handle:e,priority:0,getPriority:r},n=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){let{handle:r,resolve:i}=e,n=!1,s=()=>{n||(n=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;let e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let r=0;r<e;++r){let i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){let e=this.requestQueue;for(let r=0;r<e.length;++r){let i=e[r];this._updateRequest(i)||(e.splice(r,1),this.requestMap.delete(i.handle),r--)}e.sort((r,i)=>r.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}};var WY="",kL={};function qC(t){for(let e in kL)if(t.startsWith(e)){let r=kL[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${WY}${t}`),t}function NL(t){return t&&typeof t=="object"&&t.isBuffer}function nb(t){if(NL(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){let e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}var tl={};Es(tl,{dirname:()=>qY,filename:()=>$Y,join:()=>ZY,resolve:()=>XY});function zL(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let t=window.location?.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function $Y(t){let e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function qY(t){let e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function ZY(...t){let e="/";return t=t.map((r,i)=>(i&&(r=r.replace(new RegExp(`^${e}`),"")),i!==t.length-1&&(r=r.replace(new RegExp(`${e}$`),"")),r)),t.join(e)}function XY(...t){let e=[];for(let s=0;s<t.length;s++)e[s]=t[s];let r="",i=!1,n;for(let s=e.length-1;s>=-1&&!i;s--){let a;s>=0?a=e[s]:(n===void 0&&(n=zL()),a=n),a.length!==0&&(r=`${a}/${r}`,i=a.charCodeAt(0)===F_)}return r=YY(r,!i),i?`/${r}`:r.length>0?r:"."}var F_=47,ZC=46;function YY(t,e){let r="",i=-1,n=0,s,a=!1;for(let c=0;c<=t.length;++c){if(c<t.length)s=t.charCodeAt(c);else{if(s===F_)break;s=F_}if(s===F_){if(!(i===c-1||n===1))if(i!==c-1&&n===2){if(r.length<2||!a||r.charCodeAt(r.length-1)!==ZC||r.charCodeAt(r.length-2)!==ZC){if(r.length>2){let h=r.length-1,p=h;for(;p>=0&&r.charCodeAt(p)!==F_;--p);if(p!==h){r=p===-1?"":r.slice(0,p),i=c,n=0,a=!1;continue}}else if(r.length===2||r.length===1){r="",i=c,n=0,a=!1;continue}}e&&(r.length>0?r+="/..":r="..",a=!0)}else{let h=t.slice(i+1,c);r.length>0?r+=`/${h}`:r=h,a=!1}i=c,n=0}else s===ZC&&n!==-1?++n:n=-1}return r}var sb=class{fetch;loadOptions;_needsRefresh=!0;props;constructor(e){this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=KY(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(e=!0){let r=this._needsRefresh;return e&&(this._needsRefresh=!1),r}};function KY(t){let e=t?.fetch;if(e&&typeof e=="function")return(i,n)=>e(i,n);let r=t?.fetch;return r&&typeof r!="function"?i=>fetch(i,r):i=>fetch(i)}var Eu=class extends sb{static type="template";static testURL=e=>!1};var QY=t=>typeof t=="boolean",k_=t=>typeof t=="function",Dp=t=>t!==null&&typeof t=="object",XC=t=>Dp(t)&&t.constructor==={}.constructor;var UL=t=>!!t&&typeof t[Symbol.iterator]=="function",VL=t=>t&&typeof t[Symbol.asyncIterator]=="function";var wl=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json;var Tl=t=>typeof Blob<"u"&&t instanceof Blob,jL=t=>t&&typeof t=="object"&&t.isBuffer;var JY=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Dp(t)&&k_(t.tee)&&k_(t.cancel)&&k_(t.getReader);var eK=t=>Dp(t)&&k_(t.read)&&k_(t.pipe)&&QY(t.readable),ob=t=>JY(t)||eK(t);var ab=class extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response};var tK=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,rK=/^([-\w.]+\/[-\w.+]+)/;function YC(t,e){return t.toLowerCase()===e.toLowerCase()}function HL(t){let e=rK.exec(t);return e?e[1]:t}function KC(t){let e=tK.exec(t);return e?e[1]:""}var WL=/\?.*/;function $L(t){let e=t.match(WL);return e&&e[0]}function Um(t){return t.replace(WL,"")}function qL(t){if(t.length<50)return t;let e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Fp(t){return wl(t)?t.url:Tl(t)?t.name||"":typeof t=="string"?t:""}function N_(t){if(wl(t)){let e=t,r=e.headers.get("content-type")||"",i=Um(e.url);return HL(r)||KC(i)}return Tl(t)?t.type||"":typeof t=="string"?KC(t):""}function ZL(t){return wl(t)?t.headers["content-length"]||-1:Tl(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function lb(t){if(wl(t))return t;let e={},r=ZL(t);r>=0&&(e["content-length"]=String(r));let i=Fp(t),n=N_(t);n&&(e["content-type"]=n);let s=await nK(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));let a=new Response(t,{headers:e});return Object.defineProperty(a,"url",{value:i}),a}async function XL(t){if(!t.ok)throw await iK(t)}async function iK(t){let e=qL(t.url),r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;let i={reason:t.statusText,url:t.url,response:t};try{let n=t.headers.get("Content-Type");i.reason=!t.bodyUsed&&n?.includes("application/json")?await t.json():await t.text()}catch{}return new ab(r,i)}async function nK(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){let r=t.slice(0,5);return await new Promise(i=>{let n=new FileReader;n.onload=s=>i(s?.target?.result),n.readAsDataURL(r)})}if(t instanceof ArrayBuffer){let r=t.slice(0,5);return`data:base64,${sK(r)}`}return null}function sK(t){let e="",r=new Uint8Array(t);for(let i=0;i<r.byteLength;i++)e+=String.fromCharCode(r[i]);return btoa(e)}function oK(t){return!aK(t)&&!lK(t)}function aK(t){return t.startsWith("http:")||t.startsWith("https:")}function lK(t){return t.startsWith("data:")}async function QC(t,e){if(typeof t=="string"){let r=qC(t);return oK(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await lb(t)}var JC=new Ia({id:"loaders.gl"}),cb=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},ub=class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};var eS={fetch:null,mimeType:void 0,nothrow:!1,log:new ub,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Dh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},YL={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function tS(){globalThis.loaders=globalThis.loaders||{};let{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function rS(){let t=tS();return t.globalOptions=t.globalOptions||{...eS},t.globalOptions}function JL(t,e,r,i){return r=r||[],r=Array.isArray(r)?r:[r],cK(t,r),hK(e,t,i)}function cK(t,e){KL(t,null,eS,YL,e);for(let r of e){let i=t&&t[r.id]||{},n=r.options&&r.options[r.id]||{},s=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};KL(i,r.id,n,s,e)}}function KL(t,e,r,i,n){let s=e||"Top level",a=e?`${e}.`:"";for(let c in t){let h=!e&&Dp(t[c]),p=c==="baseUri"&&!e,x=c==="workerUrl"&&e;if(!(c in r)&&!p&&!x){if(c in i)JC.warn(`${s} loader option '${a}${c}' no longer supported, use '${i[c]}'`)();else if(!h){let T=uK(c,n);JC.warn(`${s} loader option '${a}${c}' not recognized. ${T}`)()}}}}function uK(t,e){let r=t.toLowerCase(),i="";for(let n of e)for(let s in n.options){if(t===s)return`Did you mean '${n.id}.${s}'?`;let a=s.toLowerCase();(r.startsWith(a)||a.startsWith(r))&&(i=i||`Did you mean '${n.id}.${s}'?`)}return i}function hK(t,e,r){let n={...t.options||{}};return fK(n,r),n.log===null&&(n.log=new cb),QL(n,rS()),QL(n,e),n}function QL(t,e){for(let r in e)if(r in e){let i=e[r];XC(i)&&XC(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function fK(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function z_(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function U_(t){Ii(t,"null loader"),Ii(z_(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}var eO=()=>{let t=tS();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function iS(t){let e=eO();t=Array.isArray(t)?t:[t];for(let r of t){let i=U_(r);e.find(n=>i===n)||e.unshift(i)}}function tO(){return eO()}var dK=/\.([^.]+)$/;async function nO(t,e=[],r,i){if(!sO(t))return null;let n=rO(t,e,{...r,nothrow:!0},i);if(n)return n;if(Tl(t)&&(t=await t.slice(0,10).arrayBuffer(),n=rO(t,e,r,i)),!n&&!r?.nothrow)throw new Error(oO(t));return n}function rO(t,e=[],r,i){if(!sO(t))return null;if(e&&!Array.isArray(e))return U_(e);let n=[];e&&(n=n.concat(e)),r?.ignoreRegisteredLoaders||n.push(...tO()),AK(n);let s=pK(t,n,r,i);if(!s&&!r?.nothrow)throw new Error(oO(t));return s}function pK(t,e,r,i){let n=Fp(t),s=N_(t),a=Um(n)||i?.url,c=null,h="";return r?.mimeType&&(c=nS(e,r?.mimeType),h=`match forced by supplied MIME type ${r?.mimeType}`),c=c||mK(e,a),h=h||(c?`matched url ${a}`:""),c=c||nS(e,s),h=h||(c?`matched MIME type ${s}`:""),c=c||_K(e,t),h=h||(c?`matched initial data ${aO(t)}`:""),r?.fallbackMimeType&&(c=c||nS(e,r?.fallbackMimeType),h=h||(c?`matched fallback MIME type ${s}`:"")),h&&I_.log(1,`selectLoader selected ${c?.name}: ${h}.`),c}function sO(t){return!(t instanceof Response&&t.status===204)}function oO(t){let e=Fp(t),r=N_(t),i="No valid loader found (";i+=e?`${tl.filename(e)}, `:"no url provided, ",i+=`MIME type: ${r?`"${r}"`:"not provided"}, `;let n=t?aO(t):"";return i+=n?` first bytes: "${n}"`:"first bytes: not available",i+=")",i}function AK(t){for(let e of t)U_(e)}function mK(t,e){let r=e&&dK.exec(e),i=r&&r[1];return i?gK(t,i):null}function gK(t,e){e=e.toLowerCase();for(let r of t)for(let i of r.extensions)if(i.toLowerCase()===e)return r;return null}function nS(t,e){for(let r of t)if(r.mimeTypes?.some(i=>YC(e,i))||YC(e,`application/x.${r.id}`))return r;return null}function _K(t,e){if(!e)return null;for(let r of t)if(typeof e=="string"){if(yK(e,r))return r}else if(ArrayBuffer.isView(e)){if(iO(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&iO(e,0,r))return r;return null}function yK(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function iO(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>xK(t,e,r,n))}function xK(t,e,r,i){if(i instanceof ArrayBuffer)return GC(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":let n=sS(t,e,i.length);return i===n;default:return!1}}function aO(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?sS(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?sS(t,0,e):""}function sS(t,e,r){if(t.byteLength<e+r)return"";let i=new DataView(t),n="";for(let s=0;s<r;s++)n+=String.fromCharCode(i.getUint8(e+s));return n}function*lO(t,e){let r=e?.chunkSize||262144,i=0,n=new TextEncoder;for(;i<t.length;){let s=Math.min(t.length-i,r),a=t.slice(i,i+s);i+=s,yield n.encode(a)}}function*cO(t,e={}){let{chunkSize:r=262144}=e,i=0;for(;i<t.byteLength;){let n=Math.min(t.byteLength-i,r),s=new ArrayBuffer(n),a=new Uint8Array(t,i,n);new Uint8Array(s).set(a),i+=n,yield s}}async function*uO(t,e){let r=e?.chunkSize||1048576,i=0;for(;i<t.size;){let n=i+r,s=await t.slice(i,n).arrayBuffer();i=n,yield s}}function oS(t,e){return Dh?bK(t,e):vK(t,e)}async function*bK(t,e){let r=t.getReader(),i;try{for(;;){let n=i||r.read();e?._streamReadAhead&&(i=r.read());let{done:s,value:a}=await n;if(s)return;yield nb(a)}}catch{r.releaseLock()}}async function*vK(t,e){for await(let r of t)yield nb(r)}function hO(t,e){if(typeof t=="string")return lO(t,e);if(t instanceof ArrayBuffer)return cO(t,e);if(Tl(t))return uO(t,e);if(ob(t))return oS(t,e);if(wl(t))return oS(t.body,e);throw new Error("makeIterator")}var fO="Cannot convert supplied data type";function wK(t,e,r){if(e.text&&typeof t=="string")return t;if(jL(t)&&(t=t.buffer),t instanceof ArrayBuffer){let i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer,n=t.byteLength||t.length;return(t.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+n)),i}throw new Error(fO)}async function dO(t,e,r){let i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return wK(t,e,r);if(Tl(t)&&(t=await lb(t)),wl(t)){let n=t;return await XL(n),e.binary?await n.arrayBuffer():await n.text()}if(ob(t)&&(t=hO(t,r)),UL(t)||VL(t))return $C(t);throw new Error(fO)}function hb(t,e){let r=rS(),i=t||r;return typeof i.fetch=="function"?i.fetch:Dp(i.fetch)?n=>QC(n,i.fetch):e?.fetch?e?.fetch:QC}function pO(t,e,r){if(r)return r;let i={fetch:hb(e,t),...t};if(i.url){let n=Um(i.url);i.baseUrl=n,i.queryString=$L(i.url),i.filename=tl.filename(n),i.baseUrl=tl.dirname(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function AO(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){let i=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...i]:i}return r&&r.length?r:void 0}async function V_(t,e,r,i){e&&!Array.isArray(e)&&!z_(e)&&(i=void 0,r=e,e=void 0),t=await t,r=r||{};let n=Fp(t),a=AO(e,i),c=await nO(t,a,r);return c?(r=JL(r,c,a,n),i=pO({url:n,_parse:V_,loaders:a},r,i||null),await TK(c,t,r,i)):null}async function TK(t,e,r,i){if(NC(t),r=M_(t.options,r),wl(e)){let s=e,{ok:a,redirected:c,status:h,statusText:p,type:x,url:T}=s,R=Object.fromEntries(s.headers.entries());i.response={headers:R,ok:a,redirected:c,status:h,statusText:p,type:x,url:T}}e=await dO(e,t,r);let n=t;if(n.parseTextSync&&typeof e=="string")return n.parseTextSync(e,r,i);if(UC(t,r))return await VC(t,e,r,i,V_);if(n.parseText&&typeof e=="string")return await n.parseText(e,r,i);if(n.parse)return await n.parse(e,r,i);throw Oo(!n.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function mO(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Fh(t){let e=1/0,r=1/0,i=1/0,n=-1/0,s=-1/0,a=-1/0,c=t.POSITION?t.POSITION.value:[],h=c&&c.length;for(let p=0;p<h;p+=3){let x=c[p],T=c[p+1],R=c[p+2];e=x<e?x:e,r=T<r?T:r,i=R<i?R:i,n=x>n?x:n,s=T>s?T:s,a=R>a?R:a}return[[e,r,i],[n,s,a]]}function aS(t,e,r){let i=mO(e.value),n=r||gO(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:i}]},nullable:!1,metadata:n}}function gO(t){let e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function yo(t,e,r,i){let n,s;!Array.isArray(e)&&!z_(e)?(n=[],s=e,i=void 0):(n=e,s=r);let a=hb(s),c=t;return typeof t=="string"&&(c=await a(t)),Tl(t)&&(c=await a(t)),Array.isArray(n)?await V_(c,n,s):await V_(c,n,s)}var _O="4.3.2";var EK=globalThis.loaders?.parseImageNode,lS=typeof Image<"u",cS=typeof ImageBitmap<"u",CK=!!EK,uS=Dh?!0:CK;function yO(t){switch(t){case"auto":return cS||lS||uS;case"imagebitmap":return cS;case"image":return lS;case"data":return uS;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function xO(){if(cS)return"imagebitmap";if(lS)return"image";if(uS)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function bO(t){let e=SK(t);if(!e)throw new Error("Not an image");return e}function j_(t){switch(bO(t)){case"data":return t;case"image":case"imagebitmap":let e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function SK(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}var IK=/^data:image\/svg\+xml/,MK=/\.svg((\?|#).*)?$/;function fb(t){return t&&(IK.test(t)||MK.test(t))}function vO(t,e){if(fb(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return hS(t,e)}function hS(t,e){if(fb(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function db(t,e,r){let i=vO(t,r),n=self.URL||self.webkitURL,s=typeof i!="string"&&n.createObjectURL(i);try{return await PK(s||i,e)}finally{s&&n.revokeObjectURL(s)}}async function PK(t,e){let r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((i,n)=>{try{r.onload=()=>i(r),r.onerror=s=>{let a=s instanceof Error?s.message:"error";n(new Error(a))}}catch(s){n(s)}})}var RK={},wO=!0;async function TO(t,e,r){let i;fb(r)?i=await db(t,e,r):i=hS(t,r);let n=e&&e.imagebitmap;return await BK(i,n)}async function BK(t,e=null){if((LK(e)||!wO)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),wO=!1}return await createImageBitmap(t)}function LK(t){for(let e in t||RK)return!1;return!0}function EO(t){return!kK(t,"ftyp",4)||!(t[8]&96)?null:OK(t)}function OK(t){switch(DK(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function DK(t,e,r){return String.fromCharCode(...t.slice(e,r))}function FK(t){return[...t].map(e=>e.charCodeAt(0))}function kK(t,e,r=0){let i=FK(e);for(let n=0;n<i.length;++n)if(i[n]!==t[n+r])return!1;return!0}var Cu=!1,G_=!0;function kp(t){let e=H_(t);return zK(e)||jK(e)||UK(e)||VK(e)||NK(e)}function NK(t){let e=new Uint8Array(t instanceof DataView?t.buffer:t),r=EO(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function zK(t){let e=H_(t);return e.byteLength>=24&&e.getUint32(0,Cu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Cu),height:e.getUint32(20,Cu)}:null}function UK(t){let e=H_(t);return e.byteLength>=10&&e.getUint32(0,Cu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,G_),height:e.getUint16(8,G_)}:null}function VK(t){let e=H_(t);return e.byteLength>=14&&e.getUint16(0,Cu)===16973&&e.getUint32(2,G_)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,G_),height:e.getUint32(22,G_)}:null}function jK(t){let e=H_(t);if(!(e.byteLength>=3&&e.getUint16(0,Cu)===65496&&e.getUint8(2)===255))return null;let{tableMarkers:i,sofMarkers:n}=GK(),s=2;for(;s+9<e.byteLength;){let a=e.getUint16(s,Cu);if(n.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Cu),width:e.getUint16(s+7,Cu)};if(!i.has(a))return null;s+=2,s+=e.getUint16(s,Cu)}return null}function GK(){let t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function H_(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function CO(t,e){let{mimeType:r}=kp(t)||{},i=globalThis.loaders?.parseImageNode;return Ii(i),await i(t,r)}async function SO(t,e,r){e=e||{};let n=(e.image||{}).type||"auto",{url:s}=r||{},a=HK(n),c;switch(a){case"imagebitmap":c=await TO(t,e,s);break;case"image":c=await db(t,e,s);break;case"data":c=await CO(t,e);break;default:Ii(!1)}return n==="data"&&(c=j_(c)),c}function HK(t){switch(t){case"auto":case"data":return xO();default:return yO(t),t}}var WK=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],$K=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],qK={image:{type:"auto",decode:!0}},ad={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:_O,mimeTypes:$K,extensions:WK,parse:SO,tests:[t=>!!kp(new DataView(t))],options:qK};var fS={};function dS(t){if(fS[t]===void 0){let e=Dh?XK(t):ZK(t);fS[t]=e}return fS[t]}function ZK(t){let e=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&r.includes(t)}function XK(t){switch(t){case"image/avif":case"image/webp":return YK(t);default:return!0}}function YK(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}var KK=new Ia({id:"deck"}),ur=KK;var pS={};function IO(t){pS=t}function ps(t,e,r,i){ur.level>0&&pS[t]&&pS[t].call(null,e,r,i)}function QK(t){let e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}var MO={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:QK,parseTextSync:JSON.parse};function JK(){let t="9.1.11",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ur.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ur,_registerLoggers:IO},iS([MO,[ad,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}var PO=JK();function pb(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}var AS={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function BO(t){let e={};for(let[r,i]of Object.entries(t))e[r]=eQ(i);return e}function eQ(t){let e=RO(t);if(e!=="object")return{value:t,...AS[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...AS[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=RO(t.value),{...t,...AS[e],type:e}):{type:"object",value:null};throw new Error("props")}function RO(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}var LO=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,OO=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var tQ={vertex:LO,fragment:OO},DO=/void\s+main\s*\([^)]*\)\s*\{\n?/,FO=/}\n?[^{}]*$/,mS=[],W_="__LUMA_INJECT_DECLARATIONS__";function kO(t){let e={vertex:{},fragment:{}};for(let r in t){let i=t[r],n=rQ(r);typeof i=="string"&&(i={order:0,injection:i}),e[n][r]=i}return e}function rQ(t){let e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function $_(t,e,r,i=!1){let n=e==="vertex";for(let s in r){let a=r[s];a.sort((h,p)=>h.order-p.order),mS.length=a.length;for(let h=0,p=a.length;h<p;++h)mS[h]=a[h].injection;let c=`${mS.join(`
`)}
`;switch(s){case"vs:#decl":n&&(t=t.replace(W_,c));break;case"vs:#main-start":n&&(t=t.replace(DO,h=>h+c));break;case"vs:#main-end":n&&(t=t.replace(FO,h=>c+h));break;case"fs:#decl":n||(t=t.replace(W_,c));break;case"fs:#main-start":n||(t=t.replace(DO,h=>h+c));break;case"fs:#main-end":n||(t=t.replace(FO,h=>c+h));break;default:t=t.replace(s,h=>h+c)}}return t=t.replace(W_,""),i&&(t=t.replace(/\}\s*$/,s=>s+tQ[e])),t}function Vm(t){t.map(e=>iQ(e))}function iQ(t){if(t.instance)return;Vm(t.dependencies||[]);let{propTypes:e={},deprecations:r=[],inject:i={}}=t,n={normalizedInjections:kO(i),parsedDeprecations:nQ(r)};e&&(n.propValidators=BO(e)),t.instance=n;let s={};e&&(s=Object.entries(e).reduce((a,[c,h])=>{let p=h?.value;return p&&(a[c]=p),a},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function gS(t,e,r){t.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?r.deprecated(i.old,i.new)():r.removed(i.old,i.new)())})}function nQ(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function jm(t){Vm(t);let e={},r={};NO({modules:t,level:0,moduleMap:e,moduleDepth:r});let i=Object.keys(r).sort((n,s)=>r[s]-r[n]).map(n=>e[n]);return Vm(i),i}function NO(t){let{modules:e,level:r,moduleMap:i,moduleDepth:n}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(let s of e)i[s.name]=s,(n[s.name]===void 0||n[s.name]<r)&&(n[s.name]=r);for(let s of e)s.dependencies&&NO({modules:s.dependencies,level:r+1,moduleMap:i,moduleDepth:n})}function zO(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function VO(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=UO(t,sQ),t;case"fragment":return t=UO(t,oQ),t;default:throw new Error(e)}}var jO=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],sQ=[...jO,[_S("attribute"),"in $1"],[_S("varying"),"out $1"]],oQ=[...jO,[_S("varying"),"in $1"]];function UO(t,e){for(let[r,i]of e)t=t.replace(r,i);return t}function _S(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function yS(t,e){let r="";for(let i in t){let n=t[i];if(r+=`void ${n.signature} {
`,n.header&&(r+=`  ${n.header}`),e[i]){let s=e[i];s.sort((a,c)=>a.order-c.order);for(let a of s)r+=`  ${a.injection}
`}n.footer&&(r+=`  ${n.footer}`),r+=`}
`}return r}function xS(t){let e={vertex:{},fragment:{}};for(let r of t){let i,n;typeof r!="string"?(i=r,n=i.hook):(i={},n=r),n=n.trim();let[s,a]=n.split(":"),c=n.replace(/\(.+/,""),h=Object.assign(i,{signature:a});switch(s){case"vs":e.vertex[c]=h;break;case"fs":e.fragment[c]=h;break;default:throw new Error(s)}}return e}function GO(t,e){return{name:aQ(t,e),language:"glsl",version:lQ(t)}}function aQ(t,e="unnamed"){let i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return i?i[1]:e}function lQ(t){let e=100,r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}var WO=`

${W_}
`,cQ=`precision highp float;
`;function $O(t){let e=jm(t.modules||[]);return{source:uQ(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:ZO(e)}}function qO(t){let{vs:e,fs:r}=t,i=jm(t.modules||[]);return{vs:HO(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:HO(t.platformInfo,{...t,source:r,stage:"fragment",modules:i}),getUniforms:ZO(i)}}function uQ(t,e){let{source:r,stage:i,modules:n,hookFunctions:s=[],inject:a={},log:c}=e;pb(typeof r=="string","shader source must be a string");let h=r,p="",x=xS(s),T={},R={},k={};for(let q in a){let X=typeof a[q]=="string"?{injection:a[q],order:0}:a[q],re=/^(v|f)s:(#)?([\w-]+)$/.exec(q);if(re){let te=re[2],oe=re[3];te?oe==="decl"?R[q]=[X]:k[q]=[X]:T[q]=[X]}else k[q]=[X]}let j=n;for(let q of j){c&&gS(q,h,c);let X=XO(q,"wgsl");p+=X;let re=q.injections?.[i]||{};for(let te in re){let oe=/^(v|f)s:#([\w-]+)$/.exec(te);if(oe){let pe=oe[2]==="decl"?R:k;pe[te]=pe[te]||[],pe[te].push(re[te])}else T[te]=T[te]||[],T[te].push(re[te])}}return p+=WO,p=$_(p,i,R),p+=yS(x[i],T),p+=h,p=$_(p,i,k),p}function HO(t,e){let{id:r,source:i,stage:n,language:s="glsl",modules:a,defines:c={},hookFunctions:h=[],inject:p={},prologue:x=!0,log:T}=e;pb(typeof i=="string","shader source must be a string");let R=s==="glsl"?GO(i).version:-1,k=t.shaderLanguageVersion,j=R===100?"#version 100":"#version 300 es",X=i.split(`
`).slice(1).join(`
`),re={};a.forEach(Fe=>{Object.assign(re,Fe.defines)}),Object.assign(re,c);let te="";switch(s){case"wgsl":break;case"glsl":te=x?`${j}

// ----- PROLOGUE -------------------------
${hQ({id:r,source:i,stage:n})}
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${zO(t)}
${n==="fragment"?cQ:""}

// ----- APPLICATION DEFINES -------------------------

${fQ(re)}

`:`${j}
`;break}let oe=xS(h),ae={},pe={},be={};for(let Fe in p){let Y=typeof p[Fe]=="string"?{injection:p[Fe],order:0}:p[Fe],J=/^(v|f)s:(#)?([\w-]+)$/.exec(Fe);if(J){let Z=J[2],xe=J[3];Z?xe==="decl"?pe[Fe]=[Y]:be[Fe]=[Y]:ae[Fe]=[Y]}else be[Fe]=[Y]}for(let Fe of a){T&&gS(Fe,X,T);let Y=XO(Fe,n);te+=Y;let J=Fe.instance?.normalizedInjections[n]||{};for(let Z in J){let xe=/^(v|f)s:#([\w-]+)$/.exec(Z);if(xe){let Be=xe[2]==="decl"?pe:be;Be[Z]=Be[Z]||[],Be[Z].push(J[Z])}else ae[Z]=ae[Z]||[],ae[Z].push(J[Z])}}return te+="// ----- MAIN SHADER SOURCE -------------------------",te+=WO,te=$_(te,n,pe),te+=yS(oe[n],ae),te+=X,te=$_(te,n,be),s==="glsl"&&R!==k&&(te=VO(te,n)),te.trim()}function ZO(t){return function(r){let i={};for(let n of t){let s=n.getUniforms?.(r,i);Object.assign(i,s)}return i}}function hQ(t){let{id:e,source:r,stage:i}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function fQ(t={}){let e="";for(let r in t){let i=t[r];(i||Number.isFinite(i))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}function XO(t,e){let r;switch(e){case"vertex":r=t.vs||"";break;case"fragment":r=t.fs||"";break;case"wgsl":r=t.source||"";break;default:pb(!1)}if(!t.name)throw new Error("Shader module must have a name");let i=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),n=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(n+=`#define MODULE_${i}
`),n+=`${r}
`,n}var dQ=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,pQ=/^\s*\#\s*endif\s*$/;function YO(t,e){let r=t.split(`
`),i=[],n=!0,s=null;for(let a of r){let c=a.match(dQ),h=a.match(pQ);c?(s=c[1],n=!!e?.defines?.[s]):h?n=!0:n&&i.push(a)}return i.join(`
`)}var Np=class t{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return t.defaultShaderAssembler=t.defaultShaderAssembler||new t,t.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){let r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){let r=this._getModuleList(e.modules),i=this._hookFunctions,{source:n,getUniforms:s}=$O({...e,source:e.source,modules:r,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?YO(n):n,getUniforms:s,modules:r}}assembleGLSLShaderPair(e){let r=this._getModuleList(e.modules),i=this._hookFunctions;return{...qO({...e,vs:e.vs,fs:e.fs,modules:r,hookFunctions:i}),modules:r}}_getModuleList(e=[]){let r=new Array(this._defaultModules.length+e.length),i={},n=0;for(let s=0,a=this._defaultModules.length;s<a;++s){let c=this._defaultModules[s],h=c.name;r[n++]=c,i[h]=!0}for(let s=0,a=e.length;s<a;++s){let c=e[s],h=c.name;i[h]||(r[n++]=c,i[h]=!0)}return r.length=n,Vm(r),r}};var AQ=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,mQ=`#version 300 es
${AQ}`;function q_(t){let{input:e,inputChannels:r,output:i}=t||{};if(!e)return mQ;if(!r)throw new Error("inputChannels");let n=gQ(r),s=KO(e,r);return`#version 300 es
in ${n} ${e};
out vec4 ${i};
void main() {
  ${i} = ${s};
}`}function gQ(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function KO(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}var bS=class{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Go({id:e})),this.stats.get(e)}},Ab=new bS;var jt=new Ia({id:"luma.gl"});var vS={};function ld(t="id"){vS[t]=vS[t]||1;let e=vS[t]++;return`${t}-${e}`}var ci=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,r,i){if(!e)throw new Error("no device");this._device=e,this.props=_Q(r,i);let n=this.props.id!=="undefined"?this.props.id:ld(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(let e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(e,r=this[Symbol.toStringTag]){let i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${r} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${r}s Created`).incrementCount(),e.get(`${r}s Active`).incrementCount()}};function _Q(t,e){let r={...e};for(let i in t)t[i]!==void 0&&(r[i]=t[i]);return r}var qi=class t extends ci{static defaultProps={...ci.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,r){let i={...r};(r.usage||0)&t.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,t.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,r,i){let n=ArrayBuffer.isView(e)?e.buffer:e,s=Math.min(e?e.byteLength:i,t.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(s):r===0&&i===n.byteLength?this.debugData=n.slice(0,s):this.debugData=n.slice(r,r+s)}};function mb(t){let e=QO[t],r=yQ(e),i=t.includes("norm"),n=!i&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:QO[t],byteLength:r,integer:n,signed:s,normalized:i}}function yQ(t){return xQ[t]}var QO={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},xQ={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4};var Ho="texture-compression-bc",En="texture-compression-astc",Su="texture-compression-etc2",bQ="texture-compression-etc1-webgl",gb="texture-compression-pvrtc-webgl",wS="texture-compression-atc-webgl",_b="float32-renderable-webgl",TS="float16-renderable-webgl",vQ="rgb9e5ufloat-renderable-webgl",ES="snorm8-renderable-webgl",Z_="norm16-renderable-webgl",CS="snorm16-renderable-webgl",yb="float32-filterable",JO="float16-filterable-webgl";function xb(t){let e=wQ[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}var wQ={r8unorm:{},r8snorm:{render:ES},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:ES},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:TS,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Z_},"r16snorm-webgl":{f:CS},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:ES},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:TS,filter:JO},"rg16unorm-webgl":{render:Z_},"rg16snorm-webgl":{render:CS},r32uint:{},r32sint:{},r32float:{render:_b,filter:yb},rgb9e5ufloat:{channels:"rgb",packed:!0,render:vQ},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:_b},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Z_},"rgb16snorm-webgl":{f:Z_},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:yb},rgba16uint:{},rgba16sint:{},rgba16float:{render:TS,filter:JO},"rgba16unorm-webgl":{render:Z_},"rgba16snorm-webgl":{render:CS},"rgb32float-webgl":{render:_b,filter:yb},rgba32uint:{},rgba32sint:{},rgba32float:{render:_b,filter:yb},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ho},"bc1-rgb-unorm-srgb-webgl":{f:Ho},"bc1-rgba-unorm":{f:Ho},"bc1-rgba-unorm-srgb":{f:Ho},"bc2-rgba-unorm":{f:Ho},"bc2-rgba-unorm-srgb":{f:Ho},"bc3-rgba-unorm":{f:Ho},"bc3-rgba-unorm-srgb":{f:Ho},"bc4-r-unorm":{f:Ho},"bc4-r-snorm":{f:Ho},"bc5-rg-unorm":{f:Ho},"bc5-rg-snorm":{f:Ho},"bc6h-rgb-ufloat":{f:Ho},"bc6h-rgb-float":{f:Ho},"bc7-rgba-unorm":{f:Ho},"bc7-rgba-unorm-srgb":{f:Ho},"etc2-rgb8unorm":{f:Su},"etc2-rgb8unorm-srgb":{f:Su},"etc2-rgb8a1unorm":{f:Su},"etc2-rgb8a1unorm-srgb":{f:Su},"etc2-rgba8unorm":{f:Su},"etc2-rgba8unorm-srgb":{f:Su},"eac-r11unorm":{f:Su},"eac-r11snorm":{f:Su},"eac-rg11unorm":{f:Su},"eac-rg11snorm":{f:Su},"astc-4x4-unorm":{f:En},"astc-4x4-unorm-srgb":{f:En},"astc-5x4-unorm":{f:En},"astc-5x4-unorm-srgb":{f:En},"astc-5x5-unorm":{f:En},"astc-5x5-unorm-srgb":{f:En},"astc-6x5-unorm":{f:En},"astc-6x5-unorm-srgb":{f:En},"astc-6x6-unorm":{f:En},"astc-6x6-unorm-srgb":{f:En},"astc-8x5-unorm":{f:En},"astc-8x5-unorm-srgb":{f:En},"astc-8x6-unorm":{f:En},"astc-8x6-unorm-srgb":{f:En},"astc-8x8-unorm":{f:En},"astc-8x8-unorm-srgb":{f:En},"astc-10x5-unorm":{f:En},"astc-10x5-unorm-srgb":{f:En},"astc-10x6-unorm":{f:En},"astc-10x6-unorm-srgb":{f:En},"astc-10x8-unorm":{f:En},"astc-10x8-unorm-srgb":{f:En},"astc-10x10-unorm":{f:En},"astc-10x10-unorm-srgb":{f:En},"astc-12x10-unorm":{f:En},"astc-12x10-unorm-srgb":{f:En},"astc-12x12-unorm":{f:En},"astc-12x12-unorm-srgb":{f:En},"pvrtc-rgb4unorm-webgl":{f:gb},"pvrtc-rgba4unorm-webgl":{f:gb},"pvrtc-rbg2unorm-webgl":{f:gb},"pvrtc-rgba2unorm-webgl":{f:gb},"etc1-rbg-unorm-webgl":{f:bQ},"atc-rgb-unorm-webgl":{f:wS},"atc-rgba-unorm-webgl":{f:wS},"atc-rgbai-unorm-webgl":{f:wS}};var TQ=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],EQ=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function SS(t){return TQ.some(e=>t.startsWith(e))}function Gm(t){let e=CQ(t);if(SS(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;let i=SQ(t);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}let r=EQ.exec(t);if(r){let[,i,n,s,a,c]=r,h=`${s}${n}`,p=mb(h),x=p.byteLength*8,T=i.length,R=[x,T>=2?x:0,T>=3?x:0,T>=4?x:0];e={format:t,attachment:e.attachment,dataType:p.dataType,components:T,channels:i,integer:p.integer,signed:p.signed,normalized:p.normalized,bitsPerChannel:R,bytesPerPixel:p.byteLength*i.length,packed:e.packed,srgb:e.srgb},c==="-webgl"&&(e.webgl=!0),a==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function CQ(t){let e=xb(t),r=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:r,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function SQ(t){let r=/.*-(\d+)x(\d+)-.*/.exec(t);if(r){let[,i,n]=r;return{blockWidth:Number(i),blockHeight:Number(n)}}return null}function e8(t){let e=xb(t),r={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=Gm(t),n=t.startsWith("depth")||t.startsWith("stencil"),s=i?.signed,a=i?.integer,c=i?.webgl;return r.render&&=!s,r.filter&&=!n&&!s&&!a&&!c,r}var X_=class{},Y_=class{features;disabledFeatures;constructor(e=[],r){this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}},El=class t{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>jt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:jt.get("debug")||void 0,debugShaders:jt.get("debug-shaders")||void 0,debugFramebuffers:!!jt.get("debug-framebuffers"),debugWebGL:!!jt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...t.defaultProps,...e},this.id=this.props.id||ld(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=Ab;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){let r=e8(e),i=a=>(typeof a=="string"?this.features.has(a):a)??!0,n=i(r.create),s={format:e,create:n,render:n&&i(r.render),filter:n&&i(r.filter),blend:n&&i(r.blend),store:n&&i(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,r){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return SS(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});let r={...e};return(e.usage||0)&qi.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":jt.warn("indices buffer content must be of integer type")()),r}};var IQ=oa()&&typeof document<"u",MQ=()=>IQ&&document.readyState==="complete",PQ="set luma.log.level=1 (or higher) to trace rendering",t8="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",IS=class t{static defaultProps={...El.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=RQ().then(()=>{jt.probe(2,"DOM is loaded")()});stats=Ab;log=jt;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw jt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),jt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");jt.error("This version of luma.gl has already been initialized")()}jt.log(1,`${this.VERSION} - ${PQ}`)(),globalThis.luma=this}registerAdapters(e){for(let r of e)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(e=[]){let r=this.getAdapterMap(e);return Array.from(r).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapter(e=[]){let r=this.getAdapterMap(e);return r.get("webgpu")?.isSupported?.()?"webgpu":r.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(t.defaultProps,e)}async createDevice(e={}){e={...t.defaultProps,...e},e.waitForPageLoad&&await t.pageLoaded;let r=this.getAdapterMap(e.adapters),i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);let a=await(this.getAdapterMap(e.adapters)||r).get(i)?.create?.(e);if(a)return a;throw new Error(t8)}async attachDevice(e){let r=this.getAdapterMap(e.adapters),i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await t.pageLoaded,e.handle===null&&(i="unknown");let s=await r.get(i)?.attach?.(null);if(s)return s;throw new Error(t8)}enforceWebGL2(e=!0,r=[]){let n=this.getAdapterMap(r).get("webgl");n||jt.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(e)}getAdapterMap(e=[]){let r=new Map(this.preregisteredAdapters);for(let i of e)r.set(i.type,i);return r}registerDevices(e){jt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(let r of e){let i=r.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}},Hm=new IS;function RQ(){return MQ()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}var K_=class{};var Q_=class t{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...t.defaultProps,...e},e=this.props,!oa()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=LQ(e.canvas):this.canvas=e.canvas;else{let r=OQ(e),i=BQ(e?.container||null);i.insertBefore(r,i.firstChild),this.canvas=r,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(let i of r)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){let[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){try{let[e]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return r?e/r:1}catch{return 1}}cssToDevicePixels(e,r=!0){let i=this.cssToDeviceRatio(),[n,s]=this.getDrawingBufferSize();return DQ(e,i,n,s,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let i="width"in r?r.width:this.htmlCanvas.clientWidth,n="height"in r?r.height:this.htmlCanvas.clientHeight;(!i||!n)&&(jt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,n=this.htmlCanvas.height||1);let s=this._canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==n||s.devicePixelRatio!==e){let a=e,c=Math.floor(i*a),h=Math.floor(n*a);if(this.htmlCanvas.width=c,this.htmlCanvas.height=h,this.device.gl){let[x,T]=this.getDrawingBufferSize();(x!==c||T!==h)&&(a=Math.min(x/i,T/n),this.htmlCanvas.width=Math.floor(i*a),this.htmlCanvas.height=Math.floor(n*a),jt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=n,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){let e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};function BQ(t){if(typeof t=="string"){let e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function LQ(t){let e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function OQ(t){let{width:e,height:r}=t,i=document.createElement("canvas");return i.id=ld("lumagl-auto-created-canvas"),i.width=e||1,i.height=r||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(r)?`${r}px`:"100%",i}function DQ(t,e,r,i,n){let s=t,a=r8(s[0],e,r),c=i8(s[1],e,i,n),h=r8(s[0]+1,e,r),p=h===r-1?h:h-1;h=i8(s[1]+1,e,i,n);let x;return n?(h=h===0?h:h+1,x=c,c=h):x=h===i-1?h:h-1,{x:a,y:c,width:Math.max(p-a+1,1),height:Math.max(x-c+1,1)}}function r8(t,e,r){return Math.min(Math.round(t*e),r-1)}function i8(t,e,r,i){return i?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}var sn=class t extends ci{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...ci.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,r){if(r=t.normalizeProps(e,r),super(e,r,t.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){let i=t.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?t.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){let r=e?.data;return ArrayBuffer.isView(r)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return t.getTextureDataSize(e[0]);if(t.isExternalImage(e))return t.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){let i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,r){let i;return ArrayBuffer.isView(e)?i=[{data:e,width:r.width,height:r.height}]:Array.isArray(e)?i=e:i=[e],i}static getMipLevelCount(e,r){return Math.floor(Math.log2(Math.max(e,r)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,r){let i={...r},n=e?.props?._resourceDefaults?.texture||{};Object.assign(i,n);let{width:s,height:a}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof a=="number"&&(i.height=Math.max(1,Math.ceil(a))),i}};var zp=class t extends ci{static defaultProps={...ci.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,t.defaultProps)}};function s8(t,e,r){let i="",n=e.split(/\r?\n/),s=t.slice().sort((a,c)=>a.lineNum-c.lineNum);switch(r?.showSourceCode||"no"){case"all":let a=0;for(let c=1;c<=n.length;c++)for(i+=o8(n[c-1],c,r);s.length>a&&s[a].lineNum===c;){let h=s[a++];i+=n8(h,n,h.lineNum,{...r,inlineSource:!1})}return i;case"issues":case"no":for(let c of t)i+=n8(c,n,c.lineNum,{inlineSource:r?.showSourceCode!=="no"});return i}}function n8(t,e,r,i){if(i?.inlineSource){let s=FQ(e,r),a=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${a}${t.type.toUpperCase()}: ${t.message}

`}let n=t.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${n};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function FQ(t,e,r){let i="";for(let n=e-2;n<=e;n++){let s=t[n-1];s!==void 0&&(i+=o8(s,e,r))}return i}function o8(t,e,r){let i=r?.html?NQ(t):t;return`${kQ(String(e),4)}: ${i}${r?.html?"<br/>":`
`}`}function kQ(t,e){let r="";for(let i=t.length;i<e;++i)r+=" ";return r+t}function NQ(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}var Up=class t extends ci{static defaultProps={...ci.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,r){r={...r,debugShaders:r.debugShaders||e.props.debugShaders||"errors"},super(e,{id:zQ(r),...r},t.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){let e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let r=await this.getCompilationInfo();e==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;let r=a8(this.source),i=`${this.stage} ${r}`,n=s8(e,this.source,{showSourceCode:"all",html:!0}),s=this.getTranslatedSource();s&&(n+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);let a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${n}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),a.onclick=()=>{let h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};function zQ(t){return a8(t.source)||t.id||ld(`unnamed ${t.stage}-shader`)}function a8(t,e="unnamed"){let i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return i?i[1]:e}var Vp=class t extends ci{static defaultProps={...ci.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){r=t.normalizeProps(e,r),super(e,r,t.defaultProps)}static normalizeProps(e,r){let i=e?.props?._resourceDefaults?.sampler||{};return{...r,...i}}};var jp=class t extends ci{static defaultProps={...ci.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,r={}){super(e,r,t.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){let r=this.colorAttachments.map(n=>n.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(e){let r=!e;if(e){let[i,n]=Array.isArray(e)?e:[e.width,e.height];r=r||n!==this.height||i!==this.width,this.width=i,this.height=n}r&&(jt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){let n=this.createColorTexture(r,i);return this.attachResource(n),n.view}return r instanceof sn?r.view:r});let e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){let r=this.createDepthStencilTexture(e);this.attachResource(r),this.depthStencilAttachment=r.view}else e instanceof sn?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:sn.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:sn.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){let n=this.colorAttachments[i].texture.clone({width:e,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=n.view,this.attachResource(n.view)}if(this.depthStencilAttachment){let i=this.depthStencilAttachment.texture.clone({width:e,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};var Iu=class t extends ci{static defaultProps={...ci.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,r){super(e,r,t.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}};var J_=class t extends ci{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...ci.defaultProps,framebuffer:null,parameters:void 0,clearColor:t.defaultClearColor,clearColors:void 0,clearDepth:t.defaultClearDepth,clearStencil:t.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){r=t.normalizeProps(e,r),super(e,r,t.defaultProps)}static normalizeProps(e,r){return{...e.props._resourceDefaults?.renderPass,...r}}};var Wm=class t extends ci{static defaultProps={...ci.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,r){super(e,r,t.defaultProps),this.shaderLayout=r.shaderLayout}};var e1=class t extends ci{static defaultProps={...ci.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,t.defaultProps)}};var t1=class t extends ci{static defaultProps={...ci.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,t.defaultProps)}};function l8(t){let[e,r]=VQ[t],i=e==="i32"||e==="u32",n=e!=="u32",s=jQ[e]*r,a=UQ(e,r);return{dataType:e,components:r,defaultVertexFormat:a,byteLength:s,integer:i,signed:n}}function UQ(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}var VQ={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},jQ={f32:4,f16:2,i32:4,u32:4};function MS(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);let[r,i]=t.split("x"),n=r,s=i?parseInt(i):1,a=mb(n),c={type:n,components:s,byteLength:a.byteLength*s,integer:a.integer,signed:a.signed,normalized:a.normalized};return e&&(c.webglOnly=!0),c}function bb(t,e){let r={};for(let i of t.attributes){let n=GQ(t,e,i.name);n&&(r[i.name]=n)}return r}function c8(t,e,r=16){let i=bb(t,e),n=new Array(r).fill(null);for(let s of Object.values(i))n[s.location]=s;return n}function GQ(t,e,r){let i=HQ(t,r),n=WQ(e,r);if(!i)return null;let s=l8(i.type),a=n?.vertexFormat||s.defaultVertexFormat,c=MS(a);return{attributeName:n?.attributeName||i.name,bufferName:n?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:a,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:s.integer,stepMode:n?.stepMode||i.stepMode||"vertex",byteOffset:n?.byteOffset||0,byteStride:n?.byteStride||0}}function HQ(t,e){let r=t.attributes.find(i=>i.name===e);return r||jt.warn(`shader layout attribute "${e}" not present in shader`),r||null}function WQ(t,e){$Q(t);let r=qQ(t,e);return r||(r=ZQ(t,e),r)?r:(jt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function $Q(t){for(let e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&jt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function qQ(t,e){for(let r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function ZQ(t,e){for(let r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(let s of r.attributes||[]){let a=MS(s.format);i+=a.byteLength}let n=r.attributes?.find(s=>s.attribute===e);if(n)return{attributeName:n.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:n.format,byteOffset:n.byteOffset,byteStride:i}}return null}var r1=class t extends ci{static defaultProps={...ci.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,r){super(e,r,t.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);let{shaderLayout:i,bufferLayout:n}=r.renderPipeline||{};if(!i||!n)throw new Error("VertexArray");this.attributeInfos=c8(i,n,this.maxVertexAttributes)}setConstantWebGL(e,r){this.device.reportError(new Error("constant attributes not supported"))}};var i1=class t extends ci{static defaultProps={...ci.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,t.defaultProps)}};var n1=class t extends ci{static defaultProps={...ci.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,t.defaultProps)}};var XQ={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function u8(t){return XQ[t]}function h8(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}var vb;function PS(t){return(!vb||vb.byteLength<t)&&(vb=new ArrayBuffer(t)),vb}function RS(t,e){let r=PS(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function YQ(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function $m(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":YQ(t)}var f8=1024,wb=class{layout={};byteLength;constructor(e){let r=0;for(let[n,s]of Object.entries(e)){let a=u8(s),{type:c,components:h}=a;r=h8(r,h);let p=r;r+=h,this.layout[n]={type:c,size:h,offset:p}}r+=(4-r%4)%4;let i=r*4;this.byteLength=Math.max(i,f8)}getData(e){let r=Math.max(this.byteLength,f8),i=PS(r),n={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(let[s,a]of Object.entries(e)){let c=this.layout[s];if(!c){jt.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}let{type:h,size:p,offset:x}=c,T=n[h];if(p===1){if(typeof a!="number"&&typeof a!="boolean"){jt.warn(`Supplied value for single component uniform ${s} is not a number: ${a}`)();continue}T[x]=Number(a)}else{if(!$m(a)){jt.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${a}`)();continue}T.set(a,x)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}};function d8(t,e,r=16){if(t!==e)return!1;let i=t,n=e;if(!$m(i))return!1;if($m(n)&&i.length===n.length){for(let s=0;s<i.length;++s)if(n[s]!==i[s])return!1}return!0}function p8(t){return $m(t)?t.slice():t}var Tb=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){let r=e?.shaderLayout.bindings?.find(n=>n.type==="uniform"&&n.name===e?.name);if(!r)throw new Error(e?.name);let i=r;for(let n of i.uniforms||[])this.bindingLayout[n.name]=n}}setUniforms(e){for(let[r,i]of Object.entries(e))this._setUniform(r,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){d8(this.uniforms[e],r)||(this.uniforms[e]=p8(r),this.modifiedUniforms[e]=!0,this.modified=!0)}};var s1=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(let[r,i]of Object.entries(e)){let n=r,s=new wb(i.uniformTypes||{});this.uniformBufferLayouts.set(n,s);let a=new Tb({name:r});a.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(n,a)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[r,i]of Object.entries(e))this.uniformBlocks.get(r)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){let r=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(r)}createUniformBuffer(e,r,i){i&&this.setUniforms(i);let n=this.getUniformBufferByteLength(r),s=e.createBuffer({usage:qi.UNIFORM|qi.COPY_DST,byteLength:n}),a=this.getUniformBufferData(r);return s.write(a),s}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){let i=this.getUniformBufferByteLength(r),n=e.createBuffer({usage:qi.UNIFORM|qi.COPY_DST,byteLength:i});this.uniformBuffers.set(r,n)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(let r of this.uniformBlocks.keys()){let i=this.updateUniformBuffer(r);e||=i}return e&&jt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let r=this.uniformBlocks.get(e),i=this.uniformBuffers.get(e),n=!1;if(i&&r?.needsRedraw){n||=r.needsRedraw;let s=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(s);let a=this.uniformBlocks.get(e)?.getAllUniforms();jt.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return n}};function Eb(t){let e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function o1(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function BS(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);let i=e,n=Eb(t);if(n==="uint8"&&r&&i===1)return"unorm8-webgl";if(n==="uint8"&&r&&i===3)return"unorm8x3-webgl";if(n==="uint8"||n==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}if(n==="uint16"||n==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}return i===1?n:`${n}x${i}`}var Gp=class{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(r=>r.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,r){let i=[...e];for(let n of r){let s=i.findIndex(a=>a.name===n.name);s<0?i.push(n):i[s]=n}return i}getBufferIndex(e){let r=this.bufferLayouts.findIndex(i=>i.name===e);return r===-1&&jt.warn(`BufferLayout: Missing buffer for "${e}".`)(),r}};function LS(t,e){let r=Object.fromEntries(t.attributes.map(n=>[n.name,n.location])),i=e.slice();return i.sort((n,s)=>{let a=n.attributes?n.attributes.map(x=>x.attribute):[n.name],c=s.attributes?s.attributes.map(x=>x.attribute):[s.name],h=Math.min(...a.map(x=>r[x])),p=Math.min(...c.map(x=>r[x]));return h-p}),i}var Ma=class{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}},Cb=class{constructor(e,r,i){this.name=e,this.type=r,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},Mu=class extends Ma{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},Pu=class extends Ma{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}},Nh=class extends Ma{constructor(e,r,i,n){super(e,i),this.format=r,this.access=n}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}},cd;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(cd||(cd={}));var qm=class{constructor(e,r,i,n,s,a,c){this.name=e,this.type=r,this.group=i,this.binding=n,this.attributes=s,this.resourceType=a,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},FS=class{constructor(e,r){this.name=e,this.type=r}},kS=class{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n,this.interpolation=null}},Sb=class{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n}},NS=class{constructor(e,r,i,n){this.name=e,this.type=r,this.attributes=i,this.id=n}},zS=class{constructor(e,r,i){this.name=e,this.type=r,this.attributes=i}},US=class{constructor(e,r=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r,this.attributes=i}},VS=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}},g8=new Float32Array(1),KQ=new Int32Array(g8.buffer),Wo=new Uint16Array(1);function QQ(t){g8[0]=t;let e=KQ[0],r=e>>31&1,i=e>>23&255,n=8388607&e;if(i===255)return Wo[0]=r<<15|31744|(n!==0?512:0),Wo[0];if(i===0){if(n===0)return Wo[0]=r<<15,Wo[0];n|=8388608;let s=113;for(;!(8388608&n);)n<<=1,s--;return i=127-s,n&=8388607,i>0?(n=(n>>126-i)+(n>>127-i&1),Wo[0]=r<<15|i<<10|n>>13,Wo[0]):(Wo[0]=r<<15,Wo[0])}return i=i-127+15,i>=31?(Wo[0]=r<<15|31744,Wo[0]):i<=0?i<-10?(Wo[0]=r<<15,Wo[0]):(n=(8388608|n)>>1-i,Wo[0]=r<<15|n>>13,Wo[0]):(n>>=13,Wo[0]=r<<15|i<<10|n,Wo[0])}var rI=new Uint32Array(1),_8=new Float32Array(rI.buffer,0,1);function A8(t){let e=112+(t>>6&31)<<23|(63&t)<<17;return rI[0]=e,_8[0]}function JQ(t,e,r,i,n,s,a,c,h){let p=i*(a>>=n)*(s>>=n)+r*a+e*c;switch(h){case"r8unorm":return[on(t,p,"8unorm",1)[0]];case"r8snorm":return[on(t,p,"8snorm",1)[0]];case"r8uint":return[on(t,p,"8uint",1)[0]];case"r8sint":return[on(t,p,"8sint",1)[0]];case"rg8unorm":{let x=on(t,p,"8unorm",2);return[x[0],x[1]]}case"rg8snorm":{let x=on(t,p,"8snorm",2);return[x[0],x[1]]}case"rg8uint":{let x=on(t,p,"8uint",2);return[x[0],x[1]]}case"rg8sint":{let x=on(t,p,"8sint",2);return[x[0],x[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let x=on(t,p,"8unorm",4);return[x[0],x[1],x[2],x[3]]}case"rgba8snorm":{let x=on(t,p,"8snorm",4);return[x[0],x[1],x[2],x[3]]}case"rgba8uint":{let x=on(t,p,"8uint",4);return[x[0],x[1],x[2],x[3]]}case"rgba8sint":{let x=on(t,p,"8sint",4);return[x[0],x[1],x[2],x[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let x=on(t,p,"8unorm",4);return[x[2],x[1],x[0],x[3]]}case"r16uint":return[on(t,p,"16uint",1)[0]];case"r16sint":return[on(t,p,"16sint",1)[0]];case"r16float":return[on(t,p,"16float",1)[0]];case"rg16uint":{let x=on(t,p,"16uint",2);return[x[0],x[1]]}case"rg16sint":{let x=on(t,p,"16sint",2);return[x[0],x[1]]}case"rg16float":{let x=on(t,p,"16float",2);return[x[0],x[1]]}case"rgba16uint":{let x=on(t,p,"16uint",4);return[x[0],x[1],x[2],x[3]]}case"rgba16sint":{let x=on(t,p,"16sint",4);return[x[0],x[1],x[2],x[3]]}case"rgba16float":{let x=on(t,p,"16float",4);return[x[0],x[1],x[2],x[3]]}case"r32uint":return[on(t,p,"32uint",1)[0]];case"r32sint":return[on(t,p,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[on(t,p,"32float",1)[0]];case"rg32uint":{let x=on(t,p,"32uint",2);return[x[0],x[1]]}case"rg32sint":{let x=on(t,p,"32sint",2);return[x[0],x[1]]}case"rg32float":{let x=on(t,p,"32float",2);return[x[0],x[1]]}case"rgba32uint":{let x=on(t,p,"32uint",4);return[x[0],x[1],x[2],x[3]]}case"rgba32sint":{let x=on(t,p,"32sint",4);return[x[0],x[1],x[2],x[3]]}case"rgba32float":{let x=on(t,p,"32float",4);return[x[0],x[1],x[2],x[3]]}case"rg11b10ufloat":{let x=new Uint32Array(t.buffer,p,1)[0],T=(4192256&x)>>11,R=(4290772992&x)>>22;return[A8(2047&x),A8(T),function(k){let j=112+(k>>5&31)<<23|(31&k)<<18;return rI[0]=j,_8[0]}(R),1]}}return null}function on(t,e,r,i){let n=[0,0,0,0];for(let p=0;p<i;++p)switch(r){case"8unorm":n[p]=t[e]/255,e++;break;case"8snorm":n[p]=t[e]/255*2-1,e++;break;case"8uint":n[p]=t[e],e++;break;case"8sint":n[p]=t[e]-127,e++;break;case"16uint":n[p]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":n[p]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":n[p]=(s=t[e]|t[e+1]<<8,a=void 0,c=void 0,h=void 0,a=(32768&s)>>15,h=1023&s,(c=(31744&s)>>10)==0?(a?-1:1)*Math.pow(2,-14)*(h/Math.pow(2,10)):c==31?h?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,c-15)*(1+h/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":n[p]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":n[p]=new Float32Array(t.buffer,e,1)[0],e+=4}var s,a,c,h;return n}function dn(t,e,r,i,n){for(let s=0;s<i;++s)switch(r){case"8unorm":t[e]=255*n[s],e++;break;case"8snorm":t[e]=.5*(n[s]+1)*255,e++;break;case"8uint":t[e]=n[s],e++;break;case"8sint":t[e]=n[s]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=n[s],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=n[s],e+=2;break;case"16float":{let a=QQ(n[s]);new Uint16Array(t.buffer,e,1)[0]=a,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=n[s],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=n[s],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=n[s],e+=4}return n}var OS={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}},Sl=class t{constructor(){this.id=t._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,r){if(e){r(Jm.instance);for(let i of e)i instanceof Array?this.searchBlock(i,r):i.search(r);r(e0.instance)}}constEvaluate(e,r){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}};Sl._id=0;var Jm=class extends Sl{};Jm.instance=new Jm;var e0=class extends Sl{};e0.instance=new e0;var y8=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]),Hn=class extends Sl{constructor(){super()}},Zp=class extends Hn{constructor(e,r,i,n,s,a){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=i,this.body=n,this.startLine=s,this.endLine=a}get astNodeType(){return"function"}search(e){if(this.attributes)for(let r of this.attributes)e(r);e(this);for(let r of this.args)e(r);this.searchBlock(this.body,e)}},jS=class extends Hn{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}},Ib=class extends Hn{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},c1=class extends Hn{constructor(e,r){super(),this.body=e,this.loopId=r}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}},Mb=class extends Hn{constructor(e,r,i,n){super(),this.init=e,this.condition=r,this.increment=i,this.body=n}get astNodeType(){return"for"}search(e){var r,i,n;(r=this.init)===null||r===void 0||r.search(e),(i=this.condition)===null||i===void 0||i.search(e),(n=this.increment)===null||n===void 0||n.search(e),this.searchBlock(this.body,e)}},Ec=class extends Hn{constructor(e,r,i,n,s){super(),this.attributes=null,this.name=e,this.type=r,this.storage=i,this.access=n,this.value=s}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}},u1=class extends Hn{constructor(e,r,i){super(),this.attributes=null,this.name=e,this.type=r,this.value=i}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}},Wp=class extends Hn{constructor(e,r,i,n,s){super(),this.attributes=null,this.name=e,this.type=r,this.storage=i,this.access=n,this.value=s}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}},Ym=class extends Hn{constructor(e,r,i,n,s){super(),this.attributes=null,this.name=e,this.type=r,this.storage=i,this.access=n,this.value=s}get astNodeType(){return"const"}constEvaluate(e,r){return this.value.constEvaluate(e,r)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}},Zm,a1,vt,ct;(t=>{t.increment="++",t.decrement="--"})(Zm||(Zm={})),(t=>{t.parse=function(e){let r=e;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}})(Zm||(Zm={}));var Pb=class extends Hn{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}};(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(a1||(a1={})),(t=>{t.parse=function(e){let r=e;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}})(a1||(a1={}));var Rb=class extends Hn{constructor(e,r,i){super(),this.operator=e,this.variable=r,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}},h1=class extends Hn{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}isBuiltin(){return y8.has(this.name)}search(e){for(let r of this.args)r.search(e);e(this)}},Bb=class extends Hn{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}},Lb=class extends Hn{constructor(e,r){super(),this.condition=e,this.cases=r}get astNodeType(){return"switch"}},Ob=class extends Hn{constructor(e,r,i,n){super(),this.condition=e,this.body=r,this.elseif=i,this.else=n}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}},Db=class extends Hn{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}},GS=class extends Hn{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}},HS=class extends Hn{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}},Fb=class extends Hn{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}},f1=class extends Hn{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}},WS=class extends Hn{constructor(){super()}get astNodeType(){return"discard"}},kb=class extends Hn{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}},Nb=class extends Hn{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},Xt=class t extends Hn{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let r=e[0];if(r.name==="f32")return r;for(let i=1;i<e.length;++i){let n=t._priority.get(r.name);t._priority.get(e[i].name)<n&&(r=e[i])}return r.name==="x32"?t.i32:r}getTypeName(){return this.name}};Xt.x32=new Xt("x32"),Xt.f32=new Xt("f32"),Xt.i32=new Xt("i32"),Xt.u32=new Xt("u32"),Xt.f16=new Xt("f16"),Xt.bool=new Xt("bool"),Xt.void=new Xt("void"),Xt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var zb=class extends Xt{constructor(e){super(e)}},Tc=class extends Xt{constructor(e,r,i,n){super(e),this.members=r,this.startLine=i,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}search(e){for(let r of this.members)e(r)}},pt=class extends Xt{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};pt.vec2f=new pt("vec2",Xt.f32,null),pt.vec3f=new pt("vec3",Xt.f32,null),pt.vec4f=new pt("vec4",Xt.f32,null),pt.vec2i=new pt("vec2",Xt.i32,null),pt.vec3i=new pt("vec3",Xt.i32,null),pt.vec4i=new pt("vec4",Xt.i32,null),pt.vec2u=new pt("vec2",Xt.u32,null),pt.vec3u=new pt("vec3",Xt.u32,null),pt.vec4u=new pt("vec4",Xt.u32,null),pt.vec2h=new pt("vec2",Xt.f16,null),pt.vec3h=new pt("vec3",Xt.f16,null),pt.vec4h=new pt("vec4",Xt.f16,null),pt.vec2b=new pt("vec2",Xt.bool,null),pt.vec3b=new pt("vec3",Xt.bool,null),pt.vec4b=new pt("vec4",Xt.bool,null),pt.mat2x2f=new pt("mat2x2",Xt.f32,null),pt.mat2x3f=new pt("mat2x3",Xt.f32,null),pt.mat2x4f=new pt("mat2x4",Xt.f32,null),pt.mat3x2f=new pt("mat3x2",Xt.f32,null),pt.mat3x3f=new pt("mat3x3",Xt.f32,null),pt.mat3x4f=new pt("mat3x4",Xt.f32,null),pt.mat4x2f=new pt("mat4x2",Xt.f32,null),pt.mat4x3f=new pt("mat4x3",Xt.f32,null),pt.mat4x4f=new pt("mat4x4",Xt.f32,null),pt.mat2x2h=new pt("mat2x2",Xt.f16,null),pt.mat2x3h=new pt("mat2x3",Xt.f16,null),pt.mat2x4h=new pt("mat2x4",Xt.f16,null),pt.mat3x2h=new pt("mat3x2",Xt.f16,null),pt.mat3x3h=new pt("mat3x3",Xt.f16,null),pt.mat3x4h=new pt("mat3x4",Xt.f16,null),pt.mat4x2h=new pt("mat4x2",Xt.f16,null),pt.mat4x3h=new pt("mat4x3",Xt.f16,null),pt.mat4x4h=new pt("mat4x4",Xt.f16,null),pt.mat2x2i=new pt("mat2x2",Xt.i32,null),pt.mat2x3i=new pt("mat2x3",Xt.i32,null),pt.mat2x4i=new pt("mat2x4",Xt.i32,null),pt.mat3x2i=new pt("mat3x2",Xt.i32,null),pt.mat3x3i=new pt("mat3x3",Xt.i32,null),pt.mat3x4i=new pt("mat3x4",Xt.i32,null),pt.mat4x2i=new pt("mat4x2",Xt.i32,null),pt.mat4x3i=new pt("mat4x3",Xt.i32,null),pt.mat4x4i=new pt("mat4x4",Xt.i32,null),pt.mat2x2u=new pt("mat2x2",Xt.u32,null),pt.mat2x3u=new pt("mat2x3",Xt.u32,null),pt.mat2x4u=new pt("mat2x4",Xt.u32,null),pt.mat3x2u=new pt("mat3x2",Xt.u32,null),pt.mat3x3u=new pt("mat3x3",Xt.u32,null),pt.mat3x4u=new pt("mat3x4",Xt.u32,null),pt.mat4x2u=new pt("mat4x2",Xt.u32,null),pt.mat4x3u=new pt("mat4x3",Xt.u32,null),pt.mat4x4u=new pt("mat4x4",Xt.u32,null);var l1=class extends Xt{constructor(e,r,i,n){super(e),this.storage=r,this.type=i,this.access=n}get astNodeType(){return"pointer"}},$p=class extends Xt{constructor(e,r,i,n){super(e),this.attributes=r,this.format=i,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}},Hp=class extends Xt{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"sampler"}},Il=class extends Sl{constructor(){super(),this.postfix=null}},zh=class extends Il{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}},Cl=class extends Il{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(let r of this.args)r.search(e)}constEvaluate(e,r){return r&&(r[0]=this.type),e.evalExpression(this,e.context)}},d1=class extends Il{constructor(e,r){super(),this.cachedReturnValue=null,this.name=e,this.args=r}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return y8.has(this.name)}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){for(let r of this.args)r.search(e);e(this)}},la=class extends Il{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,r){return e.evalExpression(this,e.context)}},Ub=class extends Il{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}constEvaluate(e,r){if(this.initializer){let i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}},Is=class extends Il{constructor(e,r){super(),this.value=e,this.type=r}get astNodeType(){return"literalExpr"}constEvaluate(e,r){return r!==void 0&&(r[0]=this.type),this.value}get isScalar(){return this.value instanceof ht}get isVector(){return this.value instanceof ze||this.value instanceof Xr}get scalarValue(){return this.value instanceof ht?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof ze||this.value instanceof Xr?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}},Vb=class extends Il{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}};var hd=class extends Il{constructor(e){super(),this.index=e}search(e){this.index.search(e)}},jb=class extends Il{constructor(){super()}},As=class extends jb{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}},rl=class extends jb{constructor(e,r,i){super(),this.operator=e,this.left=r,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,r){return e.name===r.name?e:e.name==="f32"||r.name==="f32"?Xt.f32:e.name==="u32"||r.name==="u32"?Xt.u32:Xt.i32}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}},Gb=class extends Sl{constructor(e){super(),this.body=e}},Km=class extends Il{constructor(){super()}get astNodeType(){return"default"}},Hb=class extends Gb{constructor(e,r){super(r),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}},Wb=class extends Gb{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}},$b=class extends Sl{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"argument"}},$S=class extends Sl{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},qb=class extends Sl{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"member"}},Zb=class extends Sl{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}},Ml=class t{constructor(e,r){this.parent=null,this.typeInfo=e,this.parent=r,this.id=t._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,r,i,n){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,r,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}};Ml._id=0;var p1=class extends Ml{constructor(){super(new Ma("void",null),null)}toString(){return"void"}};p1.void=new p1;var ud=class extends Ml{constructor(e){super(new Ma("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,r,i,n){this.reference.setDataValue(e,r,i,n)}getSubData(e,r,i){return r?this.reference.getSubData(e,r,i):this}},ht=class t extends Ml{constructor(e,r,i=null){super(r,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",r)}clone(){if(this.data instanceof Float32Array)return new t(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new t(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new t(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,r,i,n){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(r instanceof t))return void console.error("SetDataValue: Invalid value",r);let s=r.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,r,i){return r?(console.error("getSubData: Scalar data does not support postfix",r),null):this}toString(){return`${this.value}`}};function eJ(t,e,r){let i=e.length;return i===2?r==="f32"?new ze(new Float32Array(e),t.getTypeInfo("vec2f")):r==="i32"||r==="bool"?new ze(new Int32Array(e),t.getTypeInfo("vec2i")):r==="u32"?new ze(new Uint32Array(e),t.getTypeInfo("vec2u")):r==="f16"?new ze(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):i===3?r==="f32"?new ze(new Float32Array(e),t.getTypeInfo("vec3f")):r==="i32"||r==="bool"?new ze(new Int32Array(e),t.getTypeInfo("vec3i")):r==="u32"?new ze(new Uint32Array(e),t.getTypeInfo("vec3u")):r==="f16"?new ze(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):i===4?r==="f32"?new ze(new Float32Array(e),t.getTypeInfo("vec4f")):r==="i32"||r==="bool"?new ze(new Int32Array(e),t.getTypeInfo("vec4i")):r==="u32"?new ze(new Uint32Array(e),t.getTypeInfo("vec4u")):r==="f16"?new ze(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}var ze=class t extends Ml{constructor(e,r,i=null){if(super(r,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{let n=this.typeInfo.name;n==="vec2f"||n==="vec3f"||n==="vec4f"?this.data=new Float32Array(e):n==="vec2i"||n==="vec3i"||n==="vec4i"?this.data=new Int32Array(e):n==="vec2u"||n==="vec3u"||n==="vec4u"?this.data=new Uint32Array(e):n==="vec2h"||n==="vec3h"||n==="vec4h"?this.data=new Float32Array(e):n==="vec2b"||n==="vec3b"||n==="vec4b"?this.data=new Int32Array(e):n==="vec2"||n==="vec3"||n==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${n}`)}}clone(){if(this.data instanceof Float32Array)return new t(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new t(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new t(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,r,i,n){i instanceof zh?console.error("TODO: Set vector postfix"):r instanceof t?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,i){if(r===null)return this;let n=e.getTypeInfo("f32");if(this.typeInfo instanceof Nh)n=this.typeInfo.format||n;else{let a=this.typeInfo.name;a==="vec2f"||a==="vec3f"||a==="vec4f"?n=e.getTypeInfo("f32"):a==="vec2i"||a==="vec3i"||a==="vec4i"?n=e.getTypeInfo("i32"):a==="vec2b"||a==="vec3b"||a==="vec4b"?n=e.getTypeInfo("bool"):a==="vec2u"||a==="vec3u"||a==="vec4u"?n=e.getTypeInfo("u32"):a==="vec2h"||a==="vec3h"||a==="vec4h"?n=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${a}`)}let s=this;for(;r!==null&&s!==null;){if(r instanceof hd){let a=r.index,c=-1;if(a instanceof Is){if(!(a.value instanceof ht))return console.error(`GetSubData: Invalid array index ${a.value}`),null;c=a.value.value}else{let h=e.evalExpression(a,i);if(!(h instanceof ht))return console.error("GetSubData: Unknown index type",a),null;c=h.value}if(c<0||c>=s.data.length)return console.error("GetSubData: Index out of range",c),null;if(s.data instanceof Float32Array){let h=new Float32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new ht(h,n)}if(s.data instanceof Int32Array){let h=new Int32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new ht(h,n)}if(s.data instanceof Uint32Array){let h=new Uint32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new ht(h,n)}throw"GetSubData: Invalid data type"}if(!(r instanceof zh))return console.error("GetSubData: Unknown postfix",r),null;{let a=r.value.toLowerCase();if(a.length===1){let h=0;if(a==="x"||a==="r")h=0;else if(a==="y"||a==="g")h=1;else if(a==="z"||a==="b")h=2;else{if(a!=="w"&&a!=="a")return console.error(`GetSubData: Unknown member ${a}`),null;h=3}if(this.data instanceof Float32Array){let p=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ht(p,n,this)}if(this.data instanceof Int32Array){let p=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ht(p,n,this)}if(this.data instanceof Uint32Array){let p=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ht(p,n,this)}}let c=[];for(let h of a)h==="x"||h==="r"?c.push(this.data[0]):h==="y"||h==="g"?c.push(this.data[1]):h==="z"||h==="b"?c.push(this.data[2]):h==="w"||h==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);s=eJ(e,c,n.name)}r=r.postfix}return s}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}},Xr=class t extends Ml{constructor(e,r,i=null){super(r,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new t(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,r,i,n){i instanceof zh?console.error("TODO: Set matrix postfix"):r instanceof t?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,i){if(r===null)return this;let n=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Nh)this.typeInfo.format;else if(n.endsWith("f"))e.getTypeInfo("f32");else if(n.endsWith("i"))e.getTypeInfo("i32");else if(n.endsWith("u"))e.getTypeInfo("u32");else{if(!n.endsWith("h"))return console.error(`GetDataValue: Unknown type ${n}`),null;e.getTypeInfo("f16")}if(r instanceof hd){let s=r.index,a=-1;if(s instanceof Is){if(!(s.value instanceof ht))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;a=s.value.value}else{let p=e.evalExpression(s,i);if(!(p instanceof ht))return console.error("GetDataValue: Unknown index type",s),null;a=p.value}if(a<0||a>=this.data.length)return console.error("GetDataValue: Index out of range",a),null;let c=n.endsWith("h")?"h":"f",h;if(n==="mat2x2"||n==="mat2x2f"||n==="mat2x2h"||n==="mat3x2"||n==="mat3x2f"||n==="mat3x2h"||n==="mat4x2"||n==="mat4x2f"||n==="mat4x2h")h=new ze(new Float32Array(this.data.buffer,this.data.byteOffset+2*a*4,2),e.getTypeInfo(`vec2${c}`));else if(n==="mat2x3"||n==="mat2x3f"||n==="mat2x3h"||n==="mat3x3"||n==="mat3x3f"||n==="mat3x3h"||n==="mat4x3"||n==="mat4x3f"||n==="mat4x3h")h=new ze(new Float32Array(this.data.buffer,this.data.byteOffset+3*a*4,3),e.getTypeInfo(`vec3${c}`));else{if(n!=="mat2x4"&&n!=="mat2x4f"&&n!=="mat2x4h"&&n!=="mat3x4"&&n!=="mat3x4f"&&n!=="mat3x4h"&&n!=="mat4x4"&&n!=="mat4x4f"&&n!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${n}`),null;h=new ze(new Float32Array(this.data.buffer,this.data.byteOffset+4*a*4,4),e.getTypeInfo(`vec4${c}`))}return r.postfix?h.getSubData(e,r.postfix,i):h}return console.error("GetDataValue: Invalid postfix",r),null}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}},Gs=class t extends Ml{constructor(e,r,i=0,n=null){super(r,n),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){let e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new t(e.buffer,this.typeInfo,0,null)}setDataValue(e,r,i,n){if(r===null)return void console.log("setDataValue: NULL data.");let s=this.offset,a=this.typeInfo;for(;i;){if(i instanceof hd)if(a instanceof Pu){let c=i.index;if(c instanceof Is){if(!(c.value instanceof ht))return void console.error(`SetDataValue: Invalid index type ${c.value}`);s+=c.value.value*a.stride}else{let h=e.evalExpression(c,n);if(!(h instanceof ht))return void console.error("SetDataValue: Unknown index type",c);s+=h.value*a.stride}a=a.format}else console.error(`SetDataValue: Type ${a.getTypeName()} is not an array`);else{if(!(i instanceof zh))return void console.error("SetDataValue: Unknown postfix type",i);{let c=i.value;if(a instanceof Mu){let h=!1;for(let p of a.members)if(p.name===c){s+=p.offset,a=p.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${c} not found`)}else if(a instanceof Ma){let h=a.getTypeName(),p=0;if(c==="x"||c==="r")p=0;else if(c==="y"||c==="g")p=1;else if(c==="z"||c==="b")p=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);p=3}if(!(r instanceof ht))return void console.error("SetDataValue: Invalid value",r);let x=r.value;return h==="vec2f"?void(new Float32Array(this.buffer,s,2)[p]=x):h==="vec3f"?void(new Float32Array(this.buffer,s,3)[p]=x):h==="vec4f"?void(new Float32Array(this.buffer,s,4)[p]=x):h==="vec2i"?void(new Int32Array(this.buffer,s,2)[p]=x):h==="vec3i"?void(new Int32Array(this.buffer,s,3)[p]=x):h==="vec4i"?void(new Int32Array(this.buffer,s,4)[p]=x):h==="vec2u"?void(new Uint32Array(this.buffer,s,2)[p]=x):h==="vec3u"?void(new Uint32Array(this.buffer,s,3)[p]=x):h==="vec4u"?void(new Uint32Array(this.buffer,s,4)[p]=x):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}i=i.postfix}this.setData(e,r,a,s,n)}setData(e,r,i,n,s){let a=i.getTypeName();if(a!=="f32"&&a!=="f16")if(a!=="i32"&&a!=="atomic<i32>"&&a!=="x32")if(a!=="u32"&&a!=="atomic<u32>")if(a!=="bool")if(a!=="vec2f"&&a!=="vec2h")if(a!=="vec3f"&&a!=="vec3h")if(a!=="vec4f"&&a!=="vec4h")if(a!=="vec2i")if(a!=="vec3i")if(a!=="vec4i")if(a!=="vec2u")if(a!=="vec3u")if(a!=="vec4u")if(a!=="vec2b")if(a!=="vec3b")if(a!=="vec4b")if(a!=="mat2x2f"&&a!=="mat2x2h")if(a!=="mat2x3f"&&a!=="mat2x3h")if(a!=="mat2x4f"&&a!=="mat2x4h")if(a!=="mat3x2f"&&a!=="mat3x2h")if(a!=="mat3x3f"&&a!=="mat3x3h")if(a!=="mat3x4f"&&a!=="mat3x4h")if(a!=="mat4x2f"&&a!=="mat4x2h")if(a!=="mat4x3f"&&a!=="mat4x3h")if(a!=="mat4x4f"&&a!=="mat4x4h")if(r instanceof t){if(i===r.typeInfo)return void new Uint8Array(this.buffer,n,r.buffer.byteLength).set(new Uint8Array(r.buffer));console.error("SetDataValue: Type mismatch",a,r.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${a}`);else{let c=new Float32Array(this.buffer,n,16);r instanceof Xr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7],c[8]=r.data[8],c[9]=r.data[9],c[10]=r.data[10],c[11]=r.data[11],c[12]=r.data[12],c[13]=r.data[13],c[14]=r.data[14],c[15]=r.data[15]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[8]=r[8],c[9]=r[9],c[10]=r[10],c[11]=r[11],c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15])}else{let c=new Float32Array(this.buffer,n,12);r instanceof Xr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7],c[8]=r.data[8],c[9]=r.data[9],c[10]=r.data[10],c[11]=r.data[11]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[8]=r[8],c[9]=r[9],c[10]=r[10],c[11]=r[11])}else{let c=new Float32Array(this.buffer,n,8);r instanceof Xr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7])}else{let c=new Float32Array(this.buffer,n,12);r instanceof Xr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7],c[8]=r.data[8],c[9]=r.data[9],c[10]=r.data[10],c[11]=r.data[11]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[8]=r[8],c[9]=r[9],c[10]=r[10],c[11]=r[11])}else{let c=new Float32Array(this.buffer,n,9);r instanceof Xr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7],c[8]=r.data[8]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[8]=r[8])}else{let c=new Float32Array(this.buffer,n,6);r instanceof Xr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5])}else{let c=new Float32Array(this.buffer,n,8);r instanceof Xr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7])}else{let c=new Float32Array(this.buffer,n,6);r instanceof Xr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5])}else{let c=new Float32Array(this.buffer,n,4);r instanceof Xr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Uint32Array(this.buffer,n,4);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Uint32Array(this.buffer,n,3);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2]):(c[0]=r[0],c[1]=r[1],c[2]=r[2])}else{let c=new Uint32Array(this.buffer,n,2);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1]):(c[0]=r[0],c[1]=r[1])}else{let c=new Uint32Array(this.buffer,n,4);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Uint32Array(this.buffer,n,3);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2]):(c[0]=r[0],c[1]=r[1],c[2]=r[2])}else{let c=new Uint32Array(this.buffer,n,2);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1]):(c[0]=r[0],c[1]=r[1])}else{let c=new Int32Array(this.buffer,n,4);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Int32Array(this.buffer,n,3);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2]):(c[0]=r[0],c[1]=r[1],c[2]=r[2])}else{let c=new Int32Array(this.buffer,n,2);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1]):(c[0]=r[0],c[1]=r[1])}else{let c=new Float32Array(this.buffer,n,4);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Float32Array(this.buffer,n,3);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2]):(c[0]=r[0],c[1]=r[1],c[2]=r[2])}else{let c=new Float32Array(this.buffer,n,2);r instanceof ze?(c[0]=r.data[0],c[1]=r.data[1]):(c[0]=r[0],c[1]=r[1])}else r instanceof ht&&(new Int32Array(this.buffer,n,1)[0]=r.value);else r instanceof ht&&(new Uint32Array(this.buffer,n,1)[0]=r.value);else r instanceof ht&&(new Int32Array(this.buffer,n,1)[0]=r.value);else r instanceof ht&&(new Float32Array(this.buffer,n,1)[0]=r.value)}getSubData(e,r,i){var n,s,a;if(r===null)return this;let c=this.offset,h=this.typeInfo;for(;r;){if(r instanceof hd){let x=r.index,T=e.evalExpression(x,i),R=0;if(T instanceof ht?R=T.value:console.error("GetDataValue: Invalid index type",x),h instanceof Pu)c+=R*h.stride,h=h.format;else{let k=h.getTypeName();k==="mat4x4"||k==="mat4x4f"||k==="mat4x4h"?(c+=16*R,h=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(r instanceof zh))return console.error("GetDataValue: Unknown postfix type",r),null;{let x=r.value;if(h instanceof Mu){let T=!1;for(let R of h.members)if(R.name===x){c+=R.offset,h=R.type,T=!0;break}if(!T)return console.error(`GetDataValue: Member ${x} not found`),null}else if(h instanceof Ma){let T=h.getTypeName();if(T==="vec2f"||T==="vec3f"||T==="vec4f"||T==="vec2i"||T==="vec3i"||T==="vec4i"||T==="vec2u"||T==="vec3u"||T==="vec4u"||T==="vec2b"||T==="vec3b"||T==="vec4b"||T==="vec2h"||T==="vec3h"||T==="vec4h"||T==="vec2"||T==="vec3"||T==="vec4"){if(x.length>0&&x.length<5){let R="f",k=[];for(let j=0;j<x.length;++j){let q=x[j].toLowerCase(),X=0;if(q==="x"||q==="r")X=0;else if(q==="y"||q==="g")X=1;else if(q==="z"||q==="b")X=2;else{if(q!=="w"&&q!=="a")return console.error(`Unknown member ${x}`),null;X=3}if(x.length===1){if(T.endsWith("f"))return this.buffer.byteLength<c+4*X+4?(console.log("Insufficient buffer data"),null):new ht(new Float32Array(this.buffer,c+4*X,1),e.getTypeInfo("f32"),this);if(T.endsWith("h"))return new ht(new Float32Array(this.buffer,c+4*X,1),e.getTypeInfo("f16"),this);if(T.endsWith("i"))return new ht(new Int32Array(this.buffer,c+4*X,1),e.getTypeInfo("i32"),this);if(T.endsWith("b"))return new ht(new Int32Array(this.buffer,c+4*X,1),e.getTypeInfo("bool"),this);if(T.endsWith("u"))return new ht(new Uint32Array(this.buffer,c+4*X,1),e.getTypeInfo("i32"),this)}if(T==="vec2f")k.push(new Float32Array(this.buffer,c,2)[X]);else if(T==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let re=new Float32Array(this.buffer,c,3);k.push(re[X])}else if(T==="vec4f")k.push(new Float32Array(this.buffer,c,4)[X]);else if(T==="vec2i")R="i",k.push(new Int32Array(this.buffer,c,2)[X]);else if(T==="vec3i")R="i",k.push(new Int32Array(this.buffer,c,3)[X]);else if(T==="vec4i")R="i",k.push(new Int32Array(this.buffer,c,4)[X]);else if(T==="vec2u"){R="u";let re=new Uint32Array(this.buffer,c,2);k.push(re[X])}else T==="vec3u"?(R="u",k.push(new Uint32Array(this.buffer,c,3)[X])):T==="vec4u"&&(R="u",k.push(new Uint32Array(this.buffer,c,4)[X]))}return k.length===2?h=e.getTypeInfo(`vec2${R}`):k.length===3?h=e.getTypeInfo(`vec3${R}`):k.length===4?h=e.getTypeInfo(`vec4${R}`):console.error(`GetDataValue: Invalid vector length ${k.length}`),new ze(k,h,null)}return console.error(`GetDataValue: Unknown member ${x}`),null}return console.error(`GetDataValue: Type ${T} is not a struct`),null}}}r=r.postfix}let p=h.getTypeName();return p==="f32"?new ht(new Float32Array(this.buffer,c,1),h,this):p==="i32"?new ht(new Int32Array(this.buffer,c,1),h,this):p==="u32"?new ht(new Uint32Array(this.buffer,c,1),h,this):p==="vec2f"?new ze(new Float32Array(this.buffer,c,2),h,this):p==="vec3f"?new ze(new Float32Array(this.buffer,c,3),h,this):p==="vec4f"?new ze(new Float32Array(this.buffer,c,4),h,this):p==="vec2i"?new ze(new Int32Array(this.buffer,c,2),h,this):p==="vec3i"?new ze(new Int32Array(this.buffer,c,3),h,this):p==="vec4i"?new ze(new Int32Array(this.buffer,c,4),h,this):p==="vec2u"?new ze(new Uint32Array(this.buffer,c,2),h,this):p==="vec3u"?new ze(new Uint32Array(this.buffer,c,3),h,this):p==="vec4u"?new ze(new Uint32Array(this.buffer,c,4),h,this):h instanceof Nh&&h.name==="atomic"?((n=h.format)===null||n===void 0?void 0:n.name)==="u32"?new ht(new Uint32Array(this.buffer,c,1)[0],h.format,this):((s=h.format)===null||s===void 0?void 0:s.name)==="i32"?new ht(new Int32Array(this.buffer,c,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(a=h.format)===null||a===void 0?void 0:a.name}`),null):new t(this.buffer,h,c,this)}toString(){let e="";if(this.typeInfo instanceof Pu)if(this.typeInfo.format.name==="f32"){let r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let i=1;i<r.length;++i)e+=`, ${r[i]}`}else if(this.typeInfo.format.name==="i32"){let r=new Int32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let i=1;i<r.length;++i)e+=`, ${r[i]}`}else if(this.typeInfo.format.name==="u32"){let r=new Uint32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let i=1;i<r.length;++i)e+=`, ${r[i]}`}else if(this.typeInfo.format.name==="vec2f"){let r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}]`;for(let i=1;i<r.length/2;++i)e+=`, [${r[2*i]}, ${r[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){let r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}]`;for(let i=4;i<r.length;i+=4)e+=`, [${r[i]}, ${r[i+1]}, ${r[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){let r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}]`;for(let i=4;i<r.length;i+=4)e+=`, [${r[i]}, ${r[i+1]}, ${r[i+2]}, ${r[i+3]}]`}else e="[...]";else this.typeInfo instanceof Mu?e+="{...}":e="[...]";return e}},kh=class t extends Ml{constructor(e,r,i,n){super(r,null),this.data=e,this.descriptor=i,this.view=n}clone(){return new t(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,r;let i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(r=i.width)!==null&&r!==void 0?r:0}get height(){var e,r;let i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(r=i.height)!==null&&r!==void 0?r:0}get depthOrArrayLayers(){var e,r;let i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(r=i.depthOrArrayLayers)!==null&&r!==void 0?r:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];let r=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<r.length;++i)r[i]=Math.max(1,r[i]>>e);return r}get texelByteSize(){let e=this.format,r=OS[e];return r?r.isDepthStencil?4:r.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let e=this.format,r=OS[e];return!!r&&r.isDepthStencil}getGpuSize(){let e=this.format,r=OS[e],i=this.width;if(!e||i<=0||!r)return-1;let n=this.height,s=this.depthOrArrayLayers,a=this.dimension;return i/r.blockWidth*(a==="1d"?1:n/r.blockHeight)*r.bytesPerBlock*s}getPixel(e,r,i=0,n=0){let s=this.texelByteSize,a=this.bytesPerRow,c=this.height,h=this.data[n];return JQ(new Uint8Array(h),e,r,i,n,c,a,s,this.format)}setPixel(e,r,i,n,s){let a=this.texelByteSize,c=this.bytesPerRow,h=this.height,p=this.data[n];(function(x,T,R,k,j,q,X,re,te,oe){let ae=k*(X>>=j)*(q>>=j)+R*X+T*re;switch(te){case"r8unorm":return void dn(x,ae,"8unorm",1,oe);case"r8snorm":return void dn(x,ae,"8snorm",1,oe);case"r8uint":return void dn(x,ae,"8uint",1,oe);case"r8sint":return void dn(x,ae,"8sint",1,oe);case"rg8unorm":return void dn(x,ae,"8unorm",2,oe);case"rg8snorm":return void dn(x,ae,"8snorm",2,oe);case"rg8uint":return void dn(x,ae,"8uint",2,oe);case"rg8sint":return void dn(x,ae,"8sint",2,oe);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void dn(x,ae,"8unorm",4,oe);case"rgba8snorm":return void dn(x,ae,"8snorm",4,oe);case"rgba8uint":return void dn(x,ae,"8uint",4,oe);case"rgba8sint":return void dn(x,ae,"8sint",4,oe);case"r16uint":return void dn(x,ae,"16uint",1,oe);case"r16sint":return void dn(x,ae,"16sint",1,oe);case"r16float":return void dn(x,ae,"16float",1,oe);case"rg16uint":return void dn(x,ae,"16uint",2,oe);case"rg16sint":return void dn(x,ae,"16sint",2,oe);case"rg16float":return void dn(x,ae,"16float",2,oe);case"rgba16uint":return void dn(x,ae,"16uint",4,oe);case"rgba16sint":return void dn(x,ae,"16sint",4,oe);case"rgba16float":return void dn(x,ae,"16float",4,oe);case"r32uint":return void dn(x,ae,"32uint",1,oe);case"r32sint":return void dn(x,ae,"32sint",1,oe);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void dn(x,ae,"32float",1,oe);case"rg32uint":return void dn(x,ae,"32uint",2,oe);case"rg32sint":return void dn(x,ae,"32sint",2,oe);case"rg32float":return void dn(x,ae,"32float",2,oe);case"rgba32uint":return void dn(x,ae,"32uint",4,oe);case"rgba32sint":return void dn(x,ae,"32sint",4,oe);case"rgba32float":return void dn(x,ae,"32float",4,oe);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(p),e,r,i,n,h,c,a,this.format,s)}};(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(ct||(ct={}));var lt=class{constructor(e,r,i){this.name=e,this.type=r,this.rule=i}toString(){return this.name}},Me=class{};vt=Me,Me.none=new lt("",ct.reserved,""),Me.eof=new lt("EOF",ct.token,""),Me.reserved={asm:new lt("asm",ct.reserved,"asm"),bf16:new lt("bf16",ct.reserved,"bf16"),do:new lt("do",ct.reserved,"do"),enum:new lt("enum",ct.reserved,"enum"),f16:new lt("f16",ct.reserved,"f16"),f64:new lt("f64",ct.reserved,"f64"),handle:new lt("handle",ct.reserved,"handle"),i8:new lt("i8",ct.reserved,"i8"),i16:new lt("i16",ct.reserved,"i16"),i64:new lt("i64",ct.reserved,"i64"),mat:new lt("mat",ct.reserved,"mat"),premerge:new lt("premerge",ct.reserved,"premerge"),regardless:new lt("regardless",ct.reserved,"regardless"),typedef:new lt("typedef",ct.reserved,"typedef"),u8:new lt("u8",ct.reserved,"u8"),u16:new lt("u16",ct.reserved,"u16"),u64:new lt("u64",ct.reserved,"u64"),unless:new lt("unless",ct.reserved,"unless"),using:new lt("using",ct.reserved,"using"),vec:new lt("vec",ct.reserved,"vec"),void:new lt("void",ct.reserved,"void")},Me.keywords={array:new lt("array",ct.keyword,"array"),atomic:new lt("atomic",ct.keyword,"atomic"),bool:new lt("bool",ct.keyword,"bool"),f32:new lt("f32",ct.keyword,"f32"),i32:new lt("i32",ct.keyword,"i32"),mat2x2:new lt("mat2x2",ct.keyword,"mat2x2"),mat2x3:new lt("mat2x3",ct.keyword,"mat2x3"),mat2x4:new lt("mat2x4",ct.keyword,"mat2x4"),mat3x2:new lt("mat3x2",ct.keyword,"mat3x2"),mat3x3:new lt("mat3x3",ct.keyword,"mat3x3"),mat3x4:new lt("mat3x4",ct.keyword,"mat3x4"),mat4x2:new lt("mat4x2",ct.keyword,"mat4x2"),mat4x3:new lt("mat4x3",ct.keyword,"mat4x3"),mat4x4:new lt("mat4x4",ct.keyword,"mat4x4"),ptr:new lt("ptr",ct.keyword,"ptr"),sampler:new lt("sampler",ct.keyword,"sampler"),sampler_comparison:new lt("sampler_comparison",ct.keyword,"sampler_comparison"),struct:new lt("struct",ct.keyword,"struct"),texture_1d:new lt("texture_1d",ct.keyword,"texture_1d"),texture_2d:new lt("texture_2d",ct.keyword,"texture_2d"),texture_2d_array:new lt("texture_2d_array",ct.keyword,"texture_2d_array"),texture_3d:new lt("texture_3d",ct.keyword,"texture_3d"),texture_cube:new lt("texture_cube",ct.keyword,"texture_cube"),texture_cube_array:new lt("texture_cube_array",ct.keyword,"texture_cube_array"),texture_multisampled_2d:new lt("texture_multisampled_2d",ct.keyword,"texture_multisampled_2d"),texture_storage_1d:new lt("texture_storage_1d",ct.keyword,"texture_storage_1d"),texture_storage_2d:new lt("texture_storage_2d",ct.keyword,"texture_storage_2d"),texture_storage_2d_array:new lt("texture_storage_2d_array",ct.keyword,"texture_storage_2d_array"),texture_storage_3d:new lt("texture_storage_3d",ct.keyword,"texture_storage_3d"),texture_depth_2d:new lt("texture_depth_2d",ct.keyword,"texture_depth_2d"),texture_depth_2d_array:new lt("texture_depth_2d_array",ct.keyword,"texture_depth_2d_array"),texture_depth_cube:new lt("texture_depth_cube",ct.keyword,"texture_depth_cube"),texture_depth_cube_array:new lt("texture_depth_cube_array",ct.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new lt("texture_depth_multisampled_2d",ct.keyword,"texture_depth_multisampled_2d"),texture_external:new lt("texture_external",ct.keyword,"texture_external"),u32:new lt("u32",ct.keyword,"u32"),vec2:new lt("vec2",ct.keyword,"vec2"),vec3:new lt("vec3",ct.keyword,"vec3"),vec4:new lt("vec4",ct.keyword,"vec4"),bitcast:new lt("bitcast",ct.keyword,"bitcast"),block:new lt("block",ct.keyword,"block"),break:new lt("break",ct.keyword,"break"),case:new lt("case",ct.keyword,"case"),continue:new lt("continue",ct.keyword,"continue"),continuing:new lt("continuing",ct.keyword,"continuing"),default:new lt("default",ct.keyword,"default"),diagnostic:new lt("diagnostic",ct.keyword,"diagnostic"),discard:new lt("discard",ct.keyword,"discard"),else:new lt("else",ct.keyword,"else"),enable:new lt("enable",ct.keyword,"enable"),fallthrough:new lt("fallthrough",ct.keyword,"fallthrough"),false:new lt("false",ct.keyword,"false"),fn:new lt("fn",ct.keyword,"fn"),for:new lt("for",ct.keyword,"for"),function:new lt("function",ct.keyword,"function"),if:new lt("if",ct.keyword,"if"),let:new lt("let",ct.keyword,"let"),const:new lt("const",ct.keyword,"const"),loop:new lt("loop",ct.keyword,"loop"),while:new lt("while",ct.keyword,"while"),private:new lt("private",ct.keyword,"private"),read:new lt("read",ct.keyword,"read"),read_write:new lt("read_write",ct.keyword,"read_write"),return:new lt("return",ct.keyword,"return"),requires:new lt("requires",ct.keyword,"requires"),storage:new lt("storage",ct.keyword,"storage"),switch:new lt("switch",ct.keyword,"switch"),true:new lt("true",ct.keyword,"true"),alias:new lt("alias",ct.keyword,"alias"),type:new lt("type",ct.keyword,"type"),uniform:new lt("uniform",ct.keyword,"uniform"),var:new lt("var",ct.keyword,"var"),override:new lt("override",ct.keyword,"override"),workgroup:new lt("workgroup",ct.keyword,"workgroup"),write:new lt("write",ct.keyword,"write"),r8unorm:new lt("r8unorm",ct.keyword,"r8unorm"),r8snorm:new lt("r8snorm",ct.keyword,"r8snorm"),r8uint:new lt("r8uint",ct.keyword,"r8uint"),r8sint:new lt("r8sint",ct.keyword,"r8sint"),r16uint:new lt("r16uint",ct.keyword,"r16uint"),r16sint:new lt("r16sint",ct.keyword,"r16sint"),r16float:new lt("r16float",ct.keyword,"r16float"),rg8unorm:new lt("rg8unorm",ct.keyword,"rg8unorm"),rg8snorm:new lt("rg8snorm",ct.keyword,"rg8snorm"),rg8uint:new lt("rg8uint",ct.keyword,"rg8uint"),rg8sint:new lt("rg8sint",ct.keyword,"rg8sint"),r32uint:new lt("r32uint",ct.keyword,"r32uint"),r32sint:new lt("r32sint",ct.keyword,"r32sint"),r32float:new lt("r32float",ct.keyword,"r32float"),rg16uint:new lt("rg16uint",ct.keyword,"rg16uint"),rg16sint:new lt("rg16sint",ct.keyword,"rg16sint"),rg16float:new lt("rg16float",ct.keyword,"rg16float"),rgba8unorm:new lt("rgba8unorm",ct.keyword,"rgba8unorm"),rgba8unorm_srgb:new lt("rgba8unorm_srgb",ct.keyword,"rgba8unorm_srgb"),rgba8snorm:new lt("rgba8snorm",ct.keyword,"rgba8snorm"),rgba8uint:new lt("rgba8uint",ct.keyword,"rgba8uint"),rgba8sint:new lt("rgba8sint",ct.keyword,"rgba8sint"),bgra8unorm:new lt("bgra8unorm",ct.keyword,"bgra8unorm"),bgra8unorm_srgb:new lt("bgra8unorm_srgb",ct.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new lt("rgb10a2unorm",ct.keyword,"rgb10a2unorm"),rg11b10float:new lt("rg11b10float",ct.keyword,"rg11b10float"),rg32uint:new lt("rg32uint",ct.keyword,"rg32uint"),rg32sint:new lt("rg32sint",ct.keyword,"rg32sint"),rg32float:new lt("rg32float",ct.keyword,"rg32float"),rgba16uint:new lt("rgba16uint",ct.keyword,"rgba16uint"),rgba16sint:new lt("rgba16sint",ct.keyword,"rgba16sint"),rgba16float:new lt("rgba16float",ct.keyword,"rgba16float"),rgba32uint:new lt("rgba32uint",ct.keyword,"rgba32uint"),rgba32sint:new lt("rgba32sint",ct.keyword,"rgba32sint"),rgba32float:new lt("rgba32float",ct.keyword,"rgba32float"),static_assert:new lt("static_assert",ct.keyword,"static_assert")},Me.tokens={decimal_float_literal:new lt("decimal_float_literal",ct.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new lt("hex_float_literal",ct.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new lt("int_literal",ct.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new lt("uint_literal",ct.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new lt("name",ct.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new lt("ident",ct.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new lt("and",ct.token,"&"),and_and:new lt("and_and",ct.token,"&&"),arrow:new lt("arrow ",ct.token,"->"),attr:new lt("attr",ct.token,"@"),forward_slash:new lt("forward_slash",ct.token,"/"),bang:new lt("bang",ct.token,"!"),bracket_left:new lt("bracket_left",ct.token,"["),bracket_right:new lt("bracket_right",ct.token,"]"),brace_left:new lt("brace_left",ct.token,"{"),brace_right:new lt("brace_right",ct.token,"}"),colon:new lt("colon",ct.token,":"),comma:new lt("comma",ct.token,","),equal:new lt("equal",ct.token,"="),equal_equal:new lt("equal_equal",ct.token,"=="),not_equal:new lt("not_equal",ct.token,"!="),greater_than:new lt("greater_than",ct.token,">"),greater_than_equal:new lt("greater_than_equal",ct.token,">="),shift_right:new lt("shift_right",ct.token,">>"),less_than:new lt("less_than",ct.token,"<"),less_than_equal:new lt("less_than_equal",ct.token,"<="),shift_left:new lt("shift_left",ct.token,"<<"),modulo:new lt("modulo",ct.token,"%"),minus:new lt("minus",ct.token,"-"),minus_minus:new lt("minus_minus",ct.token,"--"),period:new lt("period",ct.token,"."),plus:new lt("plus",ct.token,"+"),plus_plus:new lt("plus_plus",ct.token,"++"),or:new lt("or",ct.token,"|"),or_or:new lt("or_or",ct.token,"||"),paren_left:new lt("paren_left",ct.token,"("),paren_right:new lt("paren_right",ct.token,")"),semicolon:new lt("semicolon",ct.token,";"),star:new lt("star",ct.token,"*"),tilde:new lt("tilde",ct.token,"~"),underscore:new lt("underscore",ct.token,"_"),xor:new lt("xor",ct.token,"^"),plus_equal:new lt("plus_equal",ct.token,"+="),minus_equal:new lt("minus_equal",ct.token,"-="),times_equal:new lt("times_equal",ct.token,"*="),division_equal:new lt("division_equal",ct.token,"/="),modulo_equal:new lt("modulo_equal",ct.token,"%="),and_equal:new lt("and_equal",ct.token,"&="),or_equal:new lt("or_equal",ct.token,"|="),xor_equal:new lt("xor_equal",ct.token,"^="),shift_right_equal:new lt("shift_right_equal",ct.token,">>="),shift_left_equal:new lt("shift_left_equal",ct.token,"<<=")},Me.simpleTokens={"@":vt.tokens.attr,"{":vt.tokens.brace_left,"}":vt.tokens.brace_right,":":vt.tokens.colon,",":vt.tokens.comma,"(":vt.tokens.paren_left,")":vt.tokens.paren_right,";":vt.tokens.semicolon},Me.literalTokens={"&":vt.tokens.and,"&&":vt.tokens.and_and,"->":vt.tokens.arrow,"/":vt.tokens.forward_slash,"!":vt.tokens.bang,"[":vt.tokens.bracket_left,"]":vt.tokens.bracket_right,"=":vt.tokens.equal,"==":vt.tokens.equal_equal,"!=":vt.tokens.not_equal,">":vt.tokens.greater_than,">=":vt.tokens.greater_than_equal,">>":vt.tokens.shift_right,"<":vt.tokens.less_than,"<=":vt.tokens.less_than_equal,"<<":vt.tokens.shift_left,"%":vt.tokens.modulo,"-":vt.tokens.minus,"--":vt.tokens.minus_minus,".":vt.tokens.period,"+":vt.tokens.plus,"++":vt.tokens.plus_plus,"|":vt.tokens.or,"||":vt.tokens.or_or,"*":vt.tokens.star,"~":vt.tokens.tilde,_:vt.tokens.underscore,"^":vt.tokens.xor,"+=":vt.tokens.plus_equal,"-=":vt.tokens.minus_equal,"*=":vt.tokens.times_equal,"/=":vt.tokens.division_equal,"%=":vt.tokens.modulo_equal,"&=":vt.tokens.and_equal,"|=":vt.tokens.or_equal,"^=":vt.tokens.xor_equal,">>=":vt.tokens.shift_right_equal,"<<=":vt.tokens.shift_left_equal},Me.regexTokens={decimal_float_literal:vt.tokens.decimal_float_literal,hex_float_literal:vt.tokens.hex_float_literal,int_literal:vt.tokens.int_literal,uint_literal:vt.tokens.uint_literal,ident:vt.tokens.ident},Me.storage_class=[vt.keywords.function,vt.keywords.private,vt.keywords.workgroup,vt.keywords.uniform,vt.keywords.storage],Me.access_mode=[vt.keywords.read,vt.keywords.write,vt.keywords.read_write],Me.sampler_type=[vt.keywords.sampler,vt.keywords.sampler_comparison],Me.sampled_texture_type=[vt.keywords.texture_1d,vt.keywords.texture_2d,vt.keywords.texture_2d_array,vt.keywords.texture_3d,vt.keywords.texture_cube,vt.keywords.texture_cube_array],Me.multisampled_texture_type=[vt.keywords.texture_multisampled_2d],Me.storage_texture_type=[vt.keywords.texture_storage_1d,vt.keywords.texture_storage_2d,vt.keywords.texture_storage_2d_array,vt.keywords.texture_storage_3d],Me.depth_texture_type=[vt.keywords.texture_depth_2d,vt.keywords.texture_depth_2d_array,vt.keywords.texture_depth_cube,vt.keywords.texture_depth_cube_array,vt.keywords.texture_depth_multisampled_2d],Me.texture_external_type=[vt.keywords.texture_external],Me.any_texture_type=[...vt.sampled_texture_type,...vt.multisampled_texture_type,...vt.storage_texture_type,...vt.depth_texture_type,...vt.texture_external_type],Me.texel_format=[vt.keywords.r8unorm,vt.keywords.r8snorm,vt.keywords.r8uint,vt.keywords.r8sint,vt.keywords.r16uint,vt.keywords.r16sint,vt.keywords.r16float,vt.keywords.rg8unorm,vt.keywords.rg8snorm,vt.keywords.rg8uint,vt.keywords.rg8sint,vt.keywords.r32uint,vt.keywords.r32sint,vt.keywords.r32float,vt.keywords.rg16uint,vt.keywords.rg16sint,vt.keywords.rg16float,vt.keywords.rgba8unorm,vt.keywords.rgba8unorm_srgb,vt.keywords.rgba8snorm,vt.keywords.rgba8uint,vt.keywords.rgba8sint,vt.keywords.bgra8unorm,vt.keywords.bgra8unorm_srgb,vt.keywords.rgb10a2unorm,vt.keywords.rg11b10float,vt.keywords.rg32uint,vt.keywords.rg32sint,vt.keywords.rg32float,vt.keywords.rgba16uint,vt.keywords.rgba16sint,vt.keywords.rgba16float,vt.keywords.rgba32uint,vt.keywords.rgba32sint,vt.keywords.rgba32float],Me.const_literal=[vt.tokens.int_literal,vt.tokens.uint_literal,vt.tokens.decimal_float_literal,vt.tokens.hex_float_literal,vt.keywords.true,vt.keywords.false],Me.literal_or_ident=[vt.tokens.ident,vt.tokens.int_literal,vt.tokens.uint_literal,vt.tokens.decimal_float_literal,vt.tokens.hex_float_literal,vt.tokens.name],Me.element_count_expression=[vt.tokens.int_literal,vt.tokens.uint_literal,vt.tokens.ident],Me.template_types=[vt.keywords.vec2,vt.keywords.vec3,vt.keywords.vec4,vt.keywords.mat2x2,vt.keywords.mat2x3,vt.keywords.mat2x4,vt.keywords.mat3x2,vt.keywords.mat3x3,vt.keywords.mat3x4,vt.keywords.mat4x2,vt.keywords.mat4x3,vt.keywords.mat4x4,vt.keywords.atomic,vt.keywords.bitcast,...vt.any_texture_type],Me.attribute_name=[vt.tokens.ident,vt.keywords.block,vt.keywords.diagnostic],Me.assignment_operators=[vt.tokens.equal,vt.tokens.plus_equal,vt.tokens.minus_equal,vt.tokens.times_equal,vt.tokens.division_equal,vt.tokens.modulo_equal,vt.tokens.and_equal,vt.tokens.or_equal,vt.tokens.xor_equal,vt.tokens.shift_right_equal,vt.tokens.shift_left_equal],Me.increment_operators=[vt.tokens.plus_plus,vt.tokens.minus_minus];var Xb=class{constructor(e,r,i,n,s){this.type=e,this.lexeme=r,this.line=i,this.start=n,this.end=s}toString(){return this.lexeme}isTemplateType(){return Me.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Me.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},qS=class{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Xb(Me.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let a=1;for(;a>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),a--,a==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),a++)}return!0}}let r=Me.simpleTokens[e];if(r)return this._addToken(r),!0;let i=Me.none,n=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let a=this._peekAhead();for(;this._isAlphaNumeric(a);)e+=this._advance(),a=this._peekAhead()}if(n){let a=Me.keywords[e];if(a)return this._addToken(a),!0}if(n||s)return this._addToken(Me.tokens.ident),!0;for(;;){let a=this._findType(e),c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(Me.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(Me.tokens.minus_minus),!0;let h=this._tokens.length-1;if((Me.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==Me.tokens.paren_right)&&c!=">")return this._addToken(a),!0}if(e==">"&&(c==">"||c=="=")){let h=!1,p=this._tokens.length-1;for(let x=0;x<5&&p>=0&&Me.assignment_operators.indexOf(this._tokens[p].type)===-1;++x,--p)if(this._tokens[p].type===Me.tokens.less_than){p>0&&this._tokens[p-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(a),!0}if(a===Me.none){let h=e,p=0,x=2;for(let T=0;T<x;++T)if(h+=this._peekAhead(T),a=this._findType(h),a!==Me.none){p=T;break}if(a===Me.none)return i!==Me.none&&(this._current--,this._addToken(i),!0);e=h,this._current+=p+1}if(i=a,this._isAtEnd())break;e+=this._advance()}return i!==Me.none&&(this._addToken(i),!0)}_findType(e){for(let i in Me.regexTokens){let n=Me.regexTokens[i];if(this._match(e,n.rule))return n}return Me.literalTokens[e]||Me.none}_match(e,r){let i=r.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){let r=this._source.substring(this._start,this._current);this._tokens.push(new Xb(e,r,this._line,this._start,this._current))}};function Ar(t){return Array.isArray(t)||t?.buffer instanceof ArrayBuffer}var Yb=new Float32Array(1),tJ=new Uint32Array(Yb.buffer),rJ=new Uint32Array(Yb.buffer),Kb=new Int32Array(1),iJ=new Float32Array(Kb.buffer),nJ=new Uint32Array(Kb.buffer),Qb=new Uint32Array(1),sJ=new Float32Array(Qb.buffer),oJ=new Int32Array(Qb.buffer);function m8(t,e,r){if(e===r)return t;if(e==="f32"){if(r==="i32"||r==="x32")return Yb[0]=t,tJ[0];if(r==="u32")return Yb[0]=t,rJ[0]}else if(e==="i32"||e==="x32"){if(r==="f32")return Kb[0]=t,iJ[0];if(r==="u32")return Kb[0]=t,nJ[0]}else if(e==="u32"){if(r==="f32")return Qb[0]=t,sJ[0];if(r==="i32"||r==="x32")return Qb[0]=t,oJ[0]}return console.error(`Unsupported cast from ${e} to ${r}`),t}var ZS=class{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}},Xm=class{constructor(e,r){this.align=e,this.size=r}},qp=class t{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new VS,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(let r of e)r instanceof Zp&&this._functions.set(r.name,new ZS(r));for(let r of e)if(r instanceof Tc){let i=this.getTypeInfo(r,null);i instanceof Mu&&this.structs.push(i)}for(let r of e)if(r instanceof f1)this.aliases.push(this._getAliasInfo(r));else if(r instanceof u1){let i=r,n=this._getAttributeNum(i.attributes,"id",0),s=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new NS(i.name,s,i.attributes,n))}else if(this._isUniformVar(r)){let i=r,n=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=new qm(i.name,a,n,s,i.attributes,cd.Uniform,i.access);c.access||(c.access="read"),this.uniforms.push(c)}else if(this._isStorageVar(r)){let i=r,n=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(a),h=new qm(i.name,a,n,s,i.attributes,c?cd.StorageTexture:cd.Storage,i.access);h.access||(h.access="read"),this.storage.push(h)}else if(this._isTextureVar(r)){let i=r,n=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(a),h=new qm(i.name,a,n,s,i.attributes,c?cd.StorageTexture:cd.Texture,i.access);h.access||(h.access="read"),c?this.storage.push(h):this.textures.push(h)}else if(this._isSamplerVar(r)){let i=r,n=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=new qm(i.name,a,n,s,i.attributes,cd.Sampler,i.access);this.samplers.push(c)}else if(r instanceof Zp){let i=this._getAttribute(r,"vertex"),n=this._getAttribute(r,"fragment"),s=this._getAttribute(r,"compute"),a=i||n||s,c=new US(r.name,a?.name,r.attributes);c.attributes=r.attributes,c.startLine=r.startLine,c.endLine=r.endLine,this.functions.push(c),this._functions.get(r.name).info=c,a&&(this._functions.get(r.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(r,!!a),c.inputs=this._getInputs(r.args),c.outputs=this._getOutputs(r.returnType),this.entry[a.name].push(c)),c.arguments=r.args.map(h=>new zS(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),c.returnType=r.returnType?this.getTypeInfo(r.returnType,r.attributes):null}for(let r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(let r of this._functions.values())r.node.search(i=>{var n,s,a;if(i instanceof Zb){if(i.value)if(Ar(i.value))for(let c of i.value)for(let h of this.overrides)c===h.name&&((n=r.info)===null||n===void 0||n.overrides.push(h));else for(let c of this.overrides)i.value===c.name&&((s=r.info)===null||s===void 0||s.overrides.push(c))}else if(i instanceof la)for(let c of this.overrides)i.name===c.name&&((a=r.info)===null||a===void 0||a.overrides.push(c))});for(let r of this.uniforms)this._markStructsInUse(r.type);for(let r of this.storage)this._markStructsInUse(r.type)}getStructInfo(e){for(let r of this.structs)if(r.name==e)return r;return null}getOverrideInfo(e){for(let r of this.overrides)if(r.name==e)return r;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(let r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{let r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var i;for(let n of e.calls){let s=(i=this._functions.get(n.name))===null||i===void 0?void 0:i.info;s&&r.add(s)}}findResource(e,r,i){if(i){for(let n of this.entry.compute)if(n.name===i){for(let s of n.resources)if(s.group==e&&s.binding==r)return s}for(let n of this.entry.vertex)if(n.name===i){for(let s of n.resources)if(s.group==e&&s.binding==r)return s}for(let n of this.entry.fragment)if(n.name===i){for(let s of n.resources)if(s.group==e&&s.binding==r)return s}}for(let n of this.uniforms)if(n.group==e&&n.binding==r)return n;for(let n of this.storage)if(n.group==e&&n.binding==r)return n;for(let n of this.textures)if(n.group==e&&n.binding==r)return n;for(let n of this.samplers)if(n.group==e&&n.binding==r)return n;return null}_findResource(e){for(let r of this.uniforms)if(r.name==e)return r;for(let r of this.storage)if(r.name==e)return r;for(let r of this.textures)if(r.name==e)return r;for(let r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){let r=this.getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){let i=[],n=this,s=[];return e.search(a=>{if(a instanceof Jm)s.push({});else if(a instanceof e0)s.pop();else if(a instanceof Ec){let c=a;r&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(a instanceof Cl){let c=a;r&&c.type!==null&&this._markStructsFromAST(c.type)}else if(a instanceof Wp){let c=a;r&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(a instanceof la){let c=a;if(s.length>0&&s[s.length-1][c.name])return;let h=n._findResource(c.name);h&&i.push(h)}else if(a instanceof d1){let c=a,h=n._functions.get(c.name);h&&(r&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=n._findResources(h.node,r)),i.push(...h.resources))}else if(a instanceof h1){let c=a,h=n._functions.get(c.name);h&&(r&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=n._findResources(h.node,r)),i.push(...h.resources))}}),[...new Map(i.map(a=>[a.name,a])).values()]}getBindGroups(){let e=[];function r(i,n){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),n>=e[i].length&&(e[i].length=n+1)}for(let i of this.uniforms)r(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.storage)r(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.textures)r(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.samplers)r(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Tc)this._getStructOutputs(e,r);else{let i=this._getOutputInfo(e);i!==null&&r.push(i)}return r}_getStructOutputs(e,r){for(let i of e.members)if(i.type instanceof Tc)this._getStructOutputs(i.type,r);else{let n=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(n!==null){let s=this.getTypeInfo(i.type,i.type.attributes),a=this._parseInt(n.value),c=new Sb(i.name,s,n.name,a);r.push(c)}}}_getOutputInfo(e){let r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){let i=this.getTypeInfo(e,e.attributes),n=this._parseInt(r.value);return new Sb("",i,r.name,n)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(let i of e)if(i.type instanceof Tc)this._getStructInputs(i.type,r);else{let n=this._getInputInfo(i);n!==null&&r.push(n)}return r}_getStructInputs(e,r){for(let i of e.members)if(i.type instanceof Tc)this._getStructInputs(i.type,r);else{let n=this._getInputInfo(i);n!==null&&r.push(n)}}_getInputInfo(e){let r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){let i=this._getAttribute(e,"interpolation"),n=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(r.value),a=new kS(e.name,n,r.name,s);return i!==null&&(a.interpolation=this._parseString(i.value)),a}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);let r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(let r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new FS(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(let r of this.structs)if(r.name==e)return r;for(let r of this.aliases)if(r.name==e)return r.type;return null}getTypeInfo(e,r=null){if(this._types.has(e))return this._types.get(e);if(e instanceof $p){let n=e,s=n.format?this.getTypeInfo(n.format,n.attributes):null,a=new Pu(n.name,r);return a.format=s,a.count=n.count,this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Tc){let n=e,s=new Mu(n.name,r);s.startLine=n.startLine,s.endLine=n.endLine;for(let a of n.members){let c=this.getTypeInfo(a.type,a.attributes);s.members.push(new Cb(a.name,c,a.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Hp){let n=e,s=n.format instanceof Xt,a=n.format?s?this.getTypeInfo(n.format,null):new Ma(n.format,null):null,c=new Nh(n.name,a,r,n.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof pt){let n=e,s=n.format?this.getTypeInfo(n.format,null):null,a=new Nh(n.name,s,r,n.access);return this._types.set(e,a),this._updateTypeInfo(a),a}let i=new Ma(e.name,r);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var r,i,n;let s=this._getTypeSize(e);if(e.size=(r=s?.size)!==null&&r!==void 0?r:0,e instanceof Pu&&e.format){let a=this._getTypeSize(e.format);e.stride=Math.max((i=a?.size)!==null&&i!==void 0?i:0,(n=a?.align)!==null&&n!==void 0?n:0),this._updateTypeInfo(e.format)}e instanceof Mu&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let i=0,n=0,s=0,a=0;for(let c=0,h=e.members.length;c<h;++c){let p=e.members[c],x=this._getTypeSize(p);if(!x)continue;(r=this._getAlias(p.type.name))!==null&&r!==void 0||p.type;let T=x.align,R=x.size;i=this._roundUp(T,i+n),n=R,s=i,a=Math.max(a,T),p.offset=i,p.size=R,this._updateTypeInfo(p.type)}e.size=this._roundUp(a,s+n),e.align=a}_getTypeSize(e){var r,i;if(e==null)return null;let n=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Cb&&(e=e.type),e instanceof Ma){let a=this._getAlias(e.name);a!==null&&(e=a)}{let a=t._typeInfo[e.name];if(a!==void 0){let c=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new Xm(Math.max(s,a.align/c),Math.max(n,a.size/c))}}{let a=t._typeInfo[e.name.substring(0,e.name.length-1)];if(a){let c=e.name[e.name.length-1]==="h"?2:1;return new Xm(Math.max(s,a.align/c),Math.max(n,a.size/c))}}if(e instanceof Pu){let a=e,c=8,h=8,p=this._getTypeSize(a.format);return p!==null&&(h=p.size,c=p.align),h=a.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(c,h)),n&&(h=n),new Xm(Math.max(s,c),Math.max(n,h))}if(e instanceof Mu){let a=0,c=0,h=0,p=0,x=0;for(let T of e.members){let R=this._getTypeSize(T.type);R!==null&&(a=Math.max(R.align,a),h=this._roundUp(R.align,h+p),p=R.size,x=h)}return c=this._roundUp(a,x+p),new Xm(Math.max(s,a),Math.max(n,c))}return null}_isUniformVar(e){return e instanceof Ec&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Ec&&e.storage=="storage"}_isTextureVar(e){return e instanceof Ec&&e.type!==null&&t._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Ec&&e.type!==null&&t._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){let i=e;if(!i||!i.attributes)return null;let n=i.attributes;for(let s of n)if(s.name==r)return s;return null}_getAttributeNum(e,r,i){if(e===null)return i;for(let n of e)if(n.name==r){let s=n!==null&&n.value!==null?n.value:i;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):i}return i}_roundUp(e,r){return Math.ceil(r/e)*e}};qp._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},qp._textureTypes=Me.any_texture_type.map(t=>t.name),qp._samplerTypes=Me.sampler_type.map(t=>t.name);var XS=class t{constructor(e,r,i){this.name=e,this.value=r,this.node=i}clone(){return new t(this.name,this.value,this.node)}},YS=class t{constructor(e){this.name=e.name,this.node=e}clone(){return new t(this.node)}},KS=class t{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var r;return this.variables.has(e)?(r=this.variables.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var r;return this.functions.has(e)?(r=this.functions.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getFunction(e):null}createVariable(e,r,i){this.variables.set(e,new XS(e,r,i??null))}setVariable(e,r,i){let n=this.getVariable(e);n!==null?n.value=r:this.createVariable(e,r,i)}getVariableValue(e){var r;let i=this.getVariable(e);return(r=i?.value)!==null&&r!==void 0?r:null}clone(){return new t(this)}},QS=class{evalExpression(e,r){return null}getTypeInfo(e){return null}getVariableName(e,r){return""}},JS=class{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,r){let i=this.exec.evalExpression(e.args[0],r),n=!0;if(i instanceof ze)return i.data.forEach(s=>{s||(n=!1)}),new ht(n?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze){let n=i.data.some(s=>s);return new ht(n?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,r){let i=this.exec.evalExpression(e.args[2],r);if(!(i instanceof ht))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],r):this.exec.evalExpression(e.args[0],r)}ArrayLength(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.evalExpression(i,r);if(n instanceof Gs&&n.typeInfo.size===0){let s=n.typeInfo,a=n.buffer.byteLength/s.stride;return new ht(a,this.getTypeInfo("u32"))}return new ht(n.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.abs(s)),i.typeInfo);let n=i;return new ht(Math.abs(n.value),n.typeInfo)}Acos(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.acos(s)),i.typeInfo);let n=i;return new ht(Math.acos(n.value),i.typeInfo)}Acosh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.acosh(s)),i.typeInfo);let n=i;return new ht(Math.acosh(n.value),i.typeInfo)}Asin(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.asin(s)),i.typeInfo);let n=i;return new ht(Math.asin(n.value),i.typeInfo)}Asinh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.asinh(s)),i.typeInfo);let n=i;return new ht(Math.asinh(n.value),i.typeInfo)}Atan(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.atan(s)),i.typeInfo);let n=i;return new ht(Math.atan(n.value),i.typeInfo)}Atanh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.atanh(s)),i.typeInfo);let n=i;return new ht(Math.atanh(n.value),i.typeInfo)}Atan2(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ze&&n instanceof ze)return new ze(i.data.map((c,h)=>Math.atan2(c,n.data[h])),i.typeInfo);let s=i,a=n;return new ht(Math.atan2(s.value,a.value),i.typeInfo)}Ceil(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.ceil(s)),i.typeInfo);let n=i;return new ht(Math.ceil(n.value),i.typeInfo)}_clamp(e,r,i){return Math.min(Math.max(e,r),i)}Clamp(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),s=this.exec.evalExpression(e.args[2],r);if(i instanceof ze&&n instanceof ze&&s instanceof ze)return new ze(i.data.map((p,x)=>this._clamp(p,n.data[x],s.data[x])),i.typeInfo);let a=i,c=n,h=s;return new ht(this._clamp(a.value,c.value,h.value),i.typeInfo)}Cos(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.cos(s)),i.typeInfo);let n=i;return new ht(Math.cos(n.value),i.typeInfo)}Cosh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.cosh(s)),i.typeInfo);let n=i;return new ht(Math.cos(n.value),i.typeInfo)}CountLeadingZeros(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.clz32(s)),i.typeInfo);let n=i;return new ht(Math.clz32(n.value),i.typeInfo)}_countOneBits(e){let r=0;for(;e!==0;)1&e&&r++,e>>=1;return r}CountOneBits(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>this._countOneBits(s)),i.typeInfo);let n=i;return new ht(this._countOneBits(n.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let r=0;for(;!(1&e);)e>>=1,r++;return r}CountTrailingZeros(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>this._countTrailingZeros(s)),i.typeInfo);let n=i;return new ht(this._countTrailingZeros(n.value),i.typeInfo)}Cross(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ze&&n instanceof ze){if(i.data.length!==3||n.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;let s=i.data,a=n.data;return new ze([s[1]*a[2]-a[1]*s[2],s[2]*a[0]-a[2]*s[0],s[0]*a[1]-a[0]*s[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,r){let i=this.exec.evalExpression(e.args[0],r),n=180/Math.PI;return i instanceof ze?new ze(i.data.map(s=>s*n),i.typeInfo):new ht(i.value*n,this.getTypeInfo("f32"))}Determinant(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof Xr){let n=i.data,s=i.typeInfo.getTypeName(),a=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new ht(n[0]*n[3]-n[1]*n[2],a);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new ht(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),a);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new ht(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),a);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ze&&n instanceof ze){let c=0;for(let h=0;h<i.data.length;++h)c+=(i.data[h]-n.data[h])*(i.data[h]-n.data[h]);return new ht(Math.sqrt(c),this.getTypeInfo("f32"))}let s=i,a=n;return new ht(Math.abs(s.value-a.value),i.typeInfo)}_dot(e,r){let i=0;for(let n=0;n<e.length;++n)i+=r[n]*e[n];return i}Dot(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);return i instanceof ze&&n instanceof ze?new ht(this._dot(i.data,n.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,r){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,r){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.exp(s)),i.typeInfo);let n=i;return new ht(Math.exp(n.value),i.typeInfo)}Exp2(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.pow(2,s)),i.typeInfo);let n=i;return new ht(Math.pow(2,n.value),i.typeInfo)}ExtractBits(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),s=this.exec.evalExpression(e.args[2],r);if(n.typeInfo.name!=="u32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;let a=n.value,c=s.value;if(i instanceof ze)return new ze(i.data.map(p=>p>>a&(1<<c)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;let h=i.value;return new ht(h>>a&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),s=this.exec.evalExpression(e.args[2],r);if(i instanceof ze&&n instanceof ze&&s instanceof ze){let a=this._dot(n.data,s.data);return new ze(a<0?Array.from(i.data):i.data.map(c=>-c),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>this._firstLeadingBit(s)),i.typeInfo);let n=i;return new ht(this._firstLeadingBit(n.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>this._firstTrailingBit(s)),i.typeInfo);let n=i;return new ht(this._firstTrailingBit(n.value),i.typeInfo)}Floor(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.floor(s)),i.typeInfo);let n=i;return new ht(Math.floor(n.value),i.typeInfo)}Fma(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),s=this.exec.evalExpression(e.args[2],r);if(i instanceof ze&&n instanceof ze&&s instanceof ze)return i.data.length!==n.data.length||i.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new ze(i.data.map((p,x)=>p*n.data[x]+s.data[x]),i.typeInfo);let a=i,c=n,h=s;return new ht(a.value*c.value+h.value,a.typeInfo)}Fract(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>s-Math.floor(s)),i.typeInfo);let n=i;return new ht(n.value-Math.floor(n.value),i.typeInfo)}Frexp(e,r){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),s=this.exec.evalExpression(e.args[2],r),a=this.exec.evalExpression(e.args[3],r);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;let c=s.value,h=(1<<a.value)-1<<c,p=~h;if(i instanceof ze&&n instanceof ze)return new ze(i.data.map((R,k)=>R&p|n.data[k]<<c&h),i.typeInfo);let x=i.value,T=n.value;return new ht(x&p|T<<c&h,i.typeInfo)}InverseSqrt(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>1/Math.sqrt(s)),i.typeInfo);let n=i;return new ht(1/Math.sqrt(n.value),i.typeInfo)}Ldexp(e,r){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze){let s=0;return i.data.forEach(a=>{s+=a*a}),new ht(Math.sqrt(s),this.getTypeInfo("f32"))}let n=i;return new ht(Math.abs(n.value),i.typeInfo)}Log(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.log(s)),i.typeInfo);let n=i;return new ht(Math.log(n.value),i.typeInfo)}Log2(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.log2(s)),i.typeInfo);let n=i;return new ht(Math.log2(n.value),i.typeInfo)}Max(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ze&&n instanceof ze)return new ze(i.data.map((c,h)=>Math.max(c,n.data[h])),i.typeInfo);let s=i,a=n;return new ht(Math.max(s.value,a.value),i.typeInfo)}Min(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ze&&n instanceof ze)return new ze(i.data.map((c,h)=>Math.min(c,n.data[h])),i.typeInfo);let s=i,a=n;return new ht(Math.min(s.value,a.value),i.typeInfo)}Mix(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),s=this.exec.evalExpression(e.args[2],r);if(i instanceof ze&&n instanceof ze&&s instanceof ze)return new ze(i.data.map((h,p)=>i.data[p]*(1-s.data[p])+n.data[p]*s.data[p]),i.typeInfo);let a=n,c=s;return new ht(i.value*(1-c.value)+a.value*c.value,i.typeInfo)}Modf(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ze&&n instanceof ze)return new ze(i.data.map((a,c)=>a%n.data[c]),i.typeInfo);let s=n;return new ht(i.value%s.value,i.typeInfo)}Normalize(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze){let n=this.Length(e,r).value;return new ze(i.data.map(s=>s/n),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ze&&n instanceof ze)return new ze(i.data.map((c,h)=>Math.pow(c,n.data[h])),i.typeInfo);let s=i,a=n;return new ht(Math.pow(s.value,a.value),i.typeInfo)}QuantizeToF16(e,r){let i=this.exec.evalExpression(e.args[0],r);return i instanceof ze?new ze(i.data.map(n=>n),i.typeInfo):new ht(i.value,i.typeInfo)}Radians(e,r){let i=this.exec.evalExpression(e.args[0],r);return i instanceof ze?new ze(i.data.map(n=>n*Math.PI/180),i.typeInfo):new ht(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ze&&n instanceof ze){let s=this._dot(i.data,n.data);return new ze(i.data.map((a,c)=>a-2*s*n.data[c]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),s=this.exec.evalExpression(e.args[2],r);if(i instanceof ze&&n instanceof ze&&s instanceof ht){let a=this._dot(n.data,i.data);return new ze(i.data.map((c,h)=>{let p=1-s.value*s.value*(1-a*a);if(p<0)return 0;let x=Math.sqrt(p);return s.value*c-(s.value*a+x)*n.data[h]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,r){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.round(s)),i.typeInfo);let n=i;return new ht(Math.round(n.value),i.typeInfo)}Saturate(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.min(Math.max(s,0),1)),i.typeInfo);let n=i;return new ht(Math.min(Math.max(n.value,0),1),i.typeInfo)}Sign(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.sign(s)),i.typeInfo);let n=i;return new ht(Math.sign(n.value),i.typeInfo)}Sin(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.sin(s)),i.typeInfo);let n=i;return new ht(Math.sin(n.value),i.typeInfo)}Sinh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.sinh(s)),i.typeInfo);let n=i;return new ht(Math.sinh(n.value),i.typeInfo)}_smoothstep(e,r,i){let n=Math.min(Math.max((i-e)/(r-e),0),1);return n*n*(3-2*n)}SmoothStep(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),s=this.exec.evalExpression(e.args[2],r);if(s instanceof ze&&i instanceof ze&&n instanceof ze)return new ze(s.data.map((p,x)=>this._smoothstep(i.data[x],n.data[x],p)),s.typeInfo);let a=i,c=n,h=s;return new ht(this._smoothstep(a.value,c.value,h.value),s.typeInfo)}Sqrt(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.sqrt(s)),i.typeInfo);let n=i;return new ht(Math.sqrt(n.value),i.typeInfo)}Step(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(n instanceof ze&&i instanceof ze)return new ze(n.data.map((a,c)=>a<i.data[c]?0:1),n.typeInfo);let s=i;return new ht(n.value<s.value?0:1,s.typeInfo)}Tan(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.tan(s)),i.typeInfo);let n=i;return new ht(Math.tan(n.value),i.typeInfo)}Tanh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.tanh(s)),i.typeInfo);let n=i;return new ht(Math.tanh(n.value),i.typeInfo)}_getTransposeType(e){let r=e.getTypeName();return r==="mat2x2f"||r==="mat2x2h"?e:r==="mat2x3f"?this.getTypeInfo("mat3x2f"):r==="mat2x3h"?this.getTypeInfo("mat3x2h"):r==="mat2x4f"?this.getTypeInfo("mat4x2f"):r==="mat2x4h"?this.getTypeInfo("mat4x2h"):r==="mat3x2f"?this.getTypeInfo("mat2x3f"):r==="mat3x2h"?this.getTypeInfo("mat2x3h"):r==="mat3x3f"||r==="mat3x3h"?e:r==="mat3x4f"?this.getTypeInfo("mat4x3f"):r==="mat3x4h"?this.getTypeInfo("mat4x3h"):r==="mat4x2f"?this.getTypeInfo("mat2x4f"):r==="mat4x2h"?this.getTypeInfo("mat2x4h"):r==="mat4x3f"?this.getTypeInfo("mat3x4f"):r==="mat4x3h"?this.getTypeInfo("mat3x4h"):(r==="mat4x4f"||r==="mat4x4h"||console.error(`Invalid matrix type ${r}`),e)}Transpose(e,r){let i=this.exec.evalExpression(e.args[0],r);if(!(i instanceof Xr))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;let n=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){let s=i.data;return new Xr([s[0],s[2],s[1],s[3]],n)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){let s=i.data;return new Xr([s[0],s[3],s[6],s[1],s[4],s[7]],n)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){let s=i.data;return new Xr([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],n)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){let s=i.data;return new Xr([s[0],s[3],s[1],s[4],s[2],s[5]],n)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){let s=i.data;return new Xr([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],n)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){let s=i.data;return new Xr([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],n)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){let s=i.data;return new Xr([s[0],s[4],s[1],s[5],s[2],s[6]],n)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){let s=i.data;return new Xr([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],n)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){let s=i.data;return new Xr([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],n)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ze)return new ze(i.data.map(s=>Math.trunc(s)),i.typeInfo);let n=i;return new ht(Math.trunc(n.value),i.typeInfo)}Dpdx(e,r){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,r){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,r){return console.error("TODO: dpdxFine"),null}Dpdy(e,r){return console.error("TODO: dpdy"),null}DpdyCoarse(e,r){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,r){return console.error("TODO: dpdyFine"),null}Fwidth(e,r){return console.error("TODO: fwidth"),null}FwidthCoarse(e,r){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,r){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,r){let i=e.args[0],n=e.args.length>1?this.exec.evalExpression(e.args[1],r).value:0;if(i instanceof la){let s=i.name,a=r.getVariableValue(s);if(a instanceof kh){if(n<0||n>=a.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;let c=a.getMipLevelSize(n),h=a.dimension;return h==="1d"?new ht(c[0],this.getTypeInfo("u32")):h==="3d"?new ze(c,this.getTypeInfo("vec3u")):h==="2d"?new ze(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,r){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,r){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,r){let i=e.args[0],n=this.exec.evalExpression(e.args[1],r),s=e.args.length>2?this.exec.evalExpression(e.args[2],r).value:0;if(!(n instanceof ze)||n.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof la){let a=i.name,c=r.getVariableValue(a);if(c instanceof kh){let h=Math.floor(n.data[0]),p=Math.floor(n.data[1]);if(h<0||h>=c.width||p<0||p>=c.height)return console.error(`Texture ${a} out of bounds. Line ${e.line}`),null;let x=c.getPixel(h,p,0,s);return x===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new ze(x,this.getTypeInfo("vec4f"))}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,r){let i=e.args[0];if(i instanceof la){let n=i.name,s=r.getVariableValue(n);return s instanceof kh?new ht(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,r){let i=e.args[0];if(i instanceof la){let n=i.name,s=r.getVariableValue(n);return s instanceof kh?new ht(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,r){let i=e.args[0];if(i instanceof la){let n=i.name,s=r.getVariableValue(n);return s instanceof kh?new ht(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,r){return console.error("TODO: textureSample"),null}TextureSampleBias(e,r){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,r){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,r){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,r){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,r){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,r){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,r){let i=e.args[0],n=this.exec.evalExpression(e.args[1],r),s=e.args.length===4?this.exec.evalExpression(e.args[2],r).value:0,a=e.args.length===4?this.exec.evalExpression(e.args[3],r).data:this.exec.evalExpression(e.args[2],r).data;if(a.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(n instanceof ze)||n.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof la){let c=i.name,h=r.getVariableValue(c);if(h instanceof kh){let p=h.getMipLevelSize(0),x=Math.floor(n.data[0]),T=Math.floor(n.data[1]);return x<0||x>=p[0]||T<0||T>=p[1]?(console.error(`Texture ${c} out of bounds. Line ${e.line}`),null):(h.setPixel(x,T,0,s,Array.from(a)),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r);return r.getVariable(n).value.getSubData(this.exec,i.postfix,r)}AtomicStore(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r),s=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=s.value.getSubData(this.exec,i.postfix,r);return h instanceof ht&&c instanceof ht&&(h.value=c.value),s.value instanceof Gs&&s.value.setDataValue(this.exec,h,i.postfix,r),null}AtomicAdd(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r),s=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=s.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value+=c.value),s.value instanceof Gs&&s.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicSub(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r),s=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=s.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value-=c.value),s.value instanceof Gs&&s.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicMax(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r),s=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=s.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=Math.max(h.value,c.value)),s.value instanceof Gs&&s.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicMin(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r),s=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=s.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=Math.min(h.value,c.value)),s.value instanceof Gs&&s.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicAnd(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r),s=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=s.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=h.value&c.value),s.value instanceof Gs&&s.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicOr(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r),s=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=s.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=h.value|c.value),s.value instanceof Gs&&s.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicXor(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r),s=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=s.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=h.value^c.value),s.value instanceof Gs&&s.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicExchange(e,r){let i=e.args[0];i instanceof As&&(i=i.right);let n=this.exec.getVariableName(i,r),s=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=s.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=c.value),s.value instanceof Gs&&s.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicCompareExchangeWeak(e,r){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,r){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,r){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,r){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,r){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,r){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,r){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,r){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,r){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,r){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,r){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,r){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,r){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,r){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,r){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,r){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,r){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,r){return null}TextureBarrier(e,r){return null}WorkgroupBarrier(e,r){return null}WorkgroupUniformLoad(e,r){return null}SubgroupAdd(e,r){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,r){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,r){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,r){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,r){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,r){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,r){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,r){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,r){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,r){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,r){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,r){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,r){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,r){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,r){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,r){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,r){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,r){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,r){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,r){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,r){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,r){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,r){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,r){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,r){return console.error("TODO: quadSwapY"),null}},DS={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},aa={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]},Qm=class t extends QS{constructor(e,r){var i;super(),this.ast=e??[],this.reflection=new qp,this.reflection.updateAST(this.ast),this.context=(i=r?.clone())!==null&&i!==void 0?i:new KS,this.builtins=new JS(this),this.typeInfo={bool:this.getTypeInfo(Xt.bool),i32:this.getTypeInfo(Xt.i32),u32:this.getTypeInfo(Xt.u32),f32:this.getTypeInfo(Xt.f32),f16:this.getTypeInfo(Xt.f16),vec2f:this.getTypeInfo(pt.vec2f),vec2u:this.getTypeInfo(pt.vec2u),vec2i:this.getTypeInfo(pt.vec2i),vec2h:this.getTypeInfo(pt.vec2h),vec3f:this.getTypeInfo(pt.vec3f),vec3u:this.getTypeInfo(pt.vec3u),vec3i:this.getTypeInfo(pt.vec3i),vec3h:this.getTypeInfo(pt.vec3h),vec4f:this.getTypeInfo(pt.vec4f),vec4u:this.getTypeInfo(pt.vec4u),vec4i:this.getTypeInfo(pt.vec4i),vec4h:this.getTypeInfo(pt.vec4h),mat2x2f:this.getTypeInfo(pt.mat2x2f),mat2x3f:this.getTypeInfo(pt.mat2x3f),mat2x4f:this.getTypeInfo(pt.mat2x4f),mat3x2f:this.getTypeInfo(pt.mat3x2f),mat3x3f:this.getTypeInfo(pt.mat3x3f),mat3x4f:this.getTypeInfo(pt.mat3x4f),mat4x2f:this.getTypeInfo(pt.mat4x2f),mat4x3f:this.getTypeInfo(pt.mat4x3f),mat4x4f:this.getTypeInfo(pt.mat4x4f)}}getVariableValue(e){var r,i;let n=(i=(r=this.context.getVariable(e))===null||r===void 0?void 0:r.value)!==null&&i!==void 0?i:null;if(n===null)return null;if(n instanceof ht)return n.value;if(n instanceof ze||n instanceof Xr)return Array.from(n.data);if(n instanceof Gs&&n.typeInfo instanceof Pu){if(n.typeInfo.format.name==="u32")return Array.from(new Uint32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="i32")return Array.from(new Int32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="f32")return Array.from(new Float32Array(n.buffer,n.offset,n.typeInfo.count))}return console.error(`Unsupported return variable type ${n.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,r,i,n){let s=this.context.clone();(n=n??{}).constants&&this._setOverrides(n.constants,s),this._execStatements(this.ast,s);let a=s.getFunction(e);if(!a)return void console.error(`Function ${e} not found`);if(typeof r=="number")r=[r,1,1];else{if(r.length===0)return void console.error("Invalid dispatch count");r.length===1?r=[r[0],1,1]:r.length===2?r=[r[0],r[1],1]:r.length>3&&(r=[r[0],r[1],r[2]])}let c=r[0],h=r[1],p=r[2],x=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new ze(r,x));for(let T in i)for(let R in i[T]){let k=i[T][R];s.variables.forEach(j=>{var q;let X=j.node;if(X?.attributes){let re=null,te=null;for(let oe of X.attributes)oe.name==="binding"?re=oe.value:oe.name==="group"&&(te=oe.value);if(R==re&&T==te)if(k.texture!==void 0&&k.descriptor!==void 0){let oe=new kh(k.texture,this.getTypeInfo(X.type),k.descriptor,(q=k.texture.view)!==null&&q!==void 0?q:null);j.value=oe}else k.uniform!==void 0?j.value=new Gs(k.uniform,this.getTypeInfo(X.type)):j.value=new Gs(k,this.getTypeInfo(X.type))}})}for(let T=0;T<p;++T)for(let R=0;R<h;++R)for(let k=0;k<c;++k)s.setVariable("@workgroup_id",new ze([k,R,T],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(a,[k,R,T],s)}execStatement(e,r){if(e instanceof Db)return this.evalExpression(e.value,r);if(e instanceof kb){if(e.condition){let i=this.evalExpression(e.condition,r);if(!(i instanceof ht))throw new Error("Invalid break-if condition");if(!i.value)return null}return t._breakObj}if(e instanceof Nb)return t._continueObj;if(e instanceof Wp)this._let(e,r);else if(e instanceof Ec)this._var(e,r);else if(e instanceof Ym)this._const(e,r);else if(e instanceof Zp)this._function(e,r);else{if(e instanceof Ob)return this._if(e,r);if(e instanceof Lb)return this._switch(e,r);if(e instanceof Mb)return this._for(e,r);if(e instanceof Ib)return this._while(e,r);if(e instanceof Bb)return this._loop(e,r);if(e instanceof c1){let i=r.clone();return i.currentFunctionName=r.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof Rb)this._assign(e,r);else if(e instanceof Pb)this._increment(e,r);else{if(e instanceof Tc)return null;if(e instanceof u1){let i=e.name;r.getVariable(i)===null&&r.setVariable(i,new ht(0,this.getTypeInfo("u32")))}else if(e instanceof h1)this._call(e,r);else{if(e instanceof Fb||e instanceof f1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,r){return e instanceof rl?this._evalBinaryOp(e,r):e instanceof Is?this._evalLiteral(e,r):e instanceof la?this._evalVariable(e,r):e instanceof d1?this._evalCall(e,r):e instanceof Cl?this._evalCreate(e,r):e instanceof Ub?this._evalConst(e,r):e instanceof Vb?this._evalBitcast(e,r):e instanceof As?this._evalUnaryOp(e,r):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var r;if(e instanceof Xt){let n=this.reflection.getTypeInfo(e);if(n!==null)return n}let i=(r=this.typeInfo[e])!==null&&r!==void 0?r:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,r){for(let i in e){let n=e[i],s=this.reflection.getOverrideInfo(i);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?r.setVariable(i,new ht(n,s.type)):s.type.name==="bool"?r.setVariable(i,new ht(n?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?r.setVariable(i,new ze(n,s.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,r,i){let n=[1,1,1];for(let x of e.node.attributes)if(x.name==="workgroup_size"){if(x.value.length>0){let T=i.getVariableValue(x.value[0]);n[0]=T instanceof ht?T.value:parseInt(x.value[0])}if(x.value.length>1){let T=i.getVariableValue(x.value[1]);n[1]=T instanceof ht?T.value:parseInt(x.value[1])}if(x.value.length>2){let T=i.getVariableValue(x.value[2]);n[2]=T instanceof ht?T.value:parseInt(x.value[2])}}let s=this.getTypeInfo("vec3u"),a=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new ze(n,s));let c=n[0],h=n[1],p=n[2];for(let x=0,T=0;x<p;++x)for(let R=0;R<h;++R)for(let k=0;k<c;++k,++T){let j=[k,R,x],q=[k+r[0]*n[0],R+r[1]*n[1],x+r[2]*n[2]];i.setVariable("@local_invocation_id",new ze(j,s)),i.setVariable("@global_invocation_id",new ze(q,s)),i.setVariable("@local_invocation_index",new ht(T,a)),this._dispatchExec(e,i)}}_dispatchExec(e,r){for(let i of e.node.args)for(let n of i.attributes)if(n.name==="builtin"){let s=`@${n.value}`,a=r.getVariable(s);a!==void 0&&r.variables.set(i.name,a)}this._execStatements(e.node.body,r)}getVariableName(e,r){for(;e instanceof As;)e=e.right;return e instanceof la?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,r){for(let i of e){if(i instanceof Array){let s=r.clone(),a=this._execStatements(i,s);if(a)return a;continue}let n=this.execStatement(i,r);if(n)return n}return null}_call(e,r){let i=r.clone();i.currentFunctionName=e.name;let n=r.getFunction(e.name);if(n){for(let s=0;s<n.node.args.length;++s){let a=n.node.args[s],c=this.evalExpression(e.args[s],i);i.setVariable(a.name,c,a)}this._execStatements(n.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,r)}_increment(e,r){let i=this.getVariableName(e.variable,r),n=r.getVariable(i);n?e.operator==="++"?n.value instanceof ht?n.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?n.value instanceof ht?n.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,r){if(e instanceof la){let i=this.getVariableName(e,r),n=r.getVariable(i);return n===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):n.value.getSubData(this,e.postfix,r)}if(e instanceof As){if(e.operator==="*"){let i=this._getVariableData(e.right,r);return i instanceof ud?i.reference.getSubData(this,e.postfix,r):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){let i=this._getVariableData(e.right,r);return new ud(i)}}return null}_assign(e,r){let i=null,n="<var>",s=null;if(e.variable instanceof As){let h=this._getVariableData(e.variable,r),p=this.evalExpression(e.value,r),x=e.operator;if(x==="="){if(h instanceof ht||h instanceof ze||h instanceof Xr){if(p instanceof ht||p instanceof ze||p instanceof Xr&&h.data.length===p.data.length)return void h.data.set(p.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(h instanceof Gs&&p instanceof Gs&&h.buffer.byteLength-h.offset>=p.buffer.byteLength-p.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(p.buffer,p.offset,p.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(p.buffer,p.offset,p.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(x==="+=")return h instanceof ht||h instanceof ze||h instanceof Xr?p instanceof ht||p instanceof ze||p instanceof Xr?void h.data.set(p.data.map((T,R)=>h.data[R]+T)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(x==="-=")return(h instanceof ht||h instanceof ze||h instanceof Xr)&&(p instanceof ht||p instanceof ze||p instanceof Xr)?void h.data.set(p.data.map((T,R)=>h.data[R]-T)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof As){if(e.variable.operator==="*"){n=this.getVariableName(e.variable.right,r);let h=r.getVariable(n);if(!(h&&h.value instanceof ud))return void console.error(`Variable ${n} is not a pointer. Line ${e.line}`);i=h.value.reference;let p=e.variable.postfix;if(!p){let x=e.variable.right;for(;x instanceof As;){if(x.postfix){p=x.postfix;break}x=x.right}}p&&(i=i.getSubData(this,p,r))}}else{s=e.variable.postfix,n=this.getVariableName(e.variable,r);let h=r.getVariable(n);if(h===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);i=h.value}if(i instanceof ud&&(i=i.reference),i===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);let a=this.evalExpression(e.value,r),c=e.operator;if(c==="=")if(i instanceof Gs)i.setDataValue(this,a,s,r);else if(s){if(!(i instanceof ze||i instanceof Xr))return void console.error(`Variable ${n} is not a vector or matrix. Line ${e.line}`);if(s instanceof hd){let h=this.evalExpression(s.index,r).value;if(i instanceof ze){if(!(a instanceof ht))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[h]=a.value}else{if(!(i instanceof Xr))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{let p=this.evalExpression(s.index,r).value;if(p<0)return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(a instanceof ze))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{let x=i.typeInfo.getTypeName();if(x==="mat2x2"||x==="mat2x2f"||x==="mat2x2h"){if(!(p<2&&a.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*p]=a.data[0],i.data[2*p+1]=a.data[1]}else if(x==="mat2x3"||x==="mat2x3f"||x==="mat2x3h"){if(!(p<2&&a.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*p]=a.data[0],i.data[3*p+1]=a.data[1],i.data[3*p+2]=a.data[2]}else if(x==="mat2x4"||x==="mat2x4f"||x==="mat2x4h"){if(!(p<2&&a.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*p]=a.data[0],i.data[4*p+1]=a.data[1],i.data[4*p+2]=a.data[2],i.data[4*p+3]=a.data[3]}else if(x==="mat3x2"||x==="mat3x2f"||x==="mat3x2h"){if(!(p<3&&a.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*p]=a.data[0],i.data[2*p+1]=a.data[1]}else if(x==="mat3x3"||x==="mat3x3f"||x==="mat3x3h"){if(!(p<3&&a.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*p]=a.data[0],i.data[3*p+1]=a.data[1],i.data[3*p+2]=a.data[2]}else if(x==="mat3x4"||x==="mat3x4f"||x==="mat3x4h"){if(!(p<3&&a.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*p]=a.data[0],i.data[4*p+1]=a.data[1],i.data[4*p+2]=a.data[2],i.data[4*p+3]=a.data[3]}else if(x==="mat4x2"||x==="mat4x2f"||x==="mat4x2h"){if(!(p<4&&a.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*p]=a.data[0],i.data[2*p+1]=a.data[1]}else if(x==="mat4x3"||x==="mat4x3f"||x==="mat4x3h"){if(!(p<4&&a.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*p]=a.data[0],i.data[3*p+1]=a.data[1],i.data[3*p+2]=a.data[2]}else{if(x!=="mat4x4"&&x!=="mat4x4f"&&x!=="mat4x4h")return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(p<4&&a.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*p]=a.data[0],i.data[4*p+1]=a.data[1],i.data[4*p+2]=a.data[2],i.data[4*p+3]=a.data[3]}}}}}else if(s instanceof zh){let h=s.value;if(!(i instanceof ze))return void console.error(`Invalid assignment to ${h}. Variable ${n} is not a vector. Line ${e.line}`);if(a instanceof ht){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);if(h==="x")i.data[0]=a.value;else if(h==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);i.data[1]=a.value}else if(h==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);i.data[2]=a.value}else if(h==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);i.data[3]=a.value}}else{if(!(a instanceof ze))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(h.length!==a.data.length)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);for(let p=0;p<h.length;++p){let x=h[p];if(x==="x"||x==="r")i.data[0]=a.data[p];else if(x==="y"||x==="g"){if(a.data.length<2)return void console.error(`Invalid assignment to ${x} for variable ${n}. Line ${e.line}`);i.data[1]=a.data[p]}else if(x==="z"||x==="b"){if(a.data.length<3)return void console.error(`Invalid assignment to ${x} for variable ${n}. Line ${e.line}`);i.data[2]=a.data[p]}else{if(x!=="w"&&x!=="a")return void console.error(`Invalid assignment to ${x} for variable ${n}. Line ${e.line}`);if(a.data.length<4)return void console.error(`Invalid assignment to ${x} for variable ${n}. Line ${e.line}`);i.data[3]=a.data[p]}}}}}else i instanceof ht&&a instanceof ht?i.value=a.value:i instanceof ze&&a instanceof ze||i instanceof Xr&&a instanceof Xr?i.data.set(a.data):console.error(`Invalid assignment to ${n}. Line ${e.line}`);else{let h=i.getSubData(this,s,r);if(h instanceof ze&&a instanceof ht){let p=h.data,x=a.value;if(c==="+=")for(let T=0;T<p.length;++T)p[T]+=x;else if(c==="-=")for(let T=0;T<p.length;++T)p[T]-=x;else if(c==="*=")for(let T=0;T<p.length;++T)p[T]*=x;else if(c==="/=")for(let T=0;T<p.length;++T)p[T]/=x;else if(c==="%=")for(let T=0;T<p.length;++T)p[T]%=x;else if(c==="&=")for(let T=0;T<p.length;++T)p[T]&=x;else if(c==="|=")for(let T=0;T<p.length;++T)p[T]|=x;else if(c==="^=")for(let T=0;T<p.length;++T)p[T]^=x;else if(c==="<<=")for(let T=0;T<p.length;++T)p[T]<<=x;else if(c===">>=")for(let T=0;T<p.length;++T)p[T]>>=x;else console.error(`Invalid operator ${c}. Line ${e.line}`)}else if(h instanceof ze&&a instanceof ze){let p=h.data,x=a.data;if(p.length!==x.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(c==="+=")for(let T=0;T<p.length;++T)p[T]+=x[T];else if(c==="-=")for(let T=0;T<p.length;++T)p[T]-=x[T];else if(c==="*=")for(let T=0;T<p.length;++T)p[T]*=x[T];else if(c==="/=")for(let T=0;T<p.length;++T)p[T]/=x[T];else if(c==="%=")for(let T=0;T<p.length;++T)p[T]%=x[T];else if(c==="&=")for(let T=0;T<p.length;++T)p[T]&=x[T];else if(c==="|=")for(let T=0;T<p.length;++T)p[T]|=x[T];else if(c==="^=")for(let T=0;T<p.length;++T)p[T]^=x[T];else if(c==="<<=")for(let T=0;T<p.length;++T)p[T]<<=x[T];else if(c===">>=")for(let T=0;T<p.length;++T)p[T]>>=x[T];else console.error(`Invalid operator ${c}. Line ${e.line}`)}else{if(!(h instanceof ht&&a instanceof ht))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);c==="+="?h.value+=a.value:c==="-="?h.value-=a.value:c==="*="?h.value*=a.value:c==="/="?h.value/=a.value:c==="%="?h.value%=a.value:c==="&="?h.value&=a.value:c==="|="?h.value|=a.value:c==="^="?h.value^=a.value:c==="<<="?h.value<<=a.value:c===">>="?h.value>>=a.value:console.error(`Invalid operator ${c}. Line ${e.line}`)}i instanceof Gs&&i.setDataValue(this,h,s,r)}}_function(e,r){let i=new YS(e);r.functions.set(e.name,i)}_const(e,r){let i=null;e.value!==null&&(i=this.evalExpression(e.value,r)),r.createVariable(e.name,i,e)}_let(e,r){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,r),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof As||(i=i.clone())}else{let n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||n==="array"){let s=new Cl(e.type,[]);i=this._evalCreate(s,r)}}r.createVariable(e.name,i,e)}_var(e,r){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,r),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof As||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);let n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||e.type instanceof $p||e.type instanceof Tc||e.type instanceof pt){let s=new Cl(e.type,[]);i=this._evalCreate(s,r)}}r.createVariable(e.name,i,e)}_switch(e,r){r=r.clone();let i=this.evalExpression(e.condition,r);if(!(i instanceof ht))return console.error(`Invalid if condition. Line ${e.line}`),null;let n=null;for(let s of e.cases)if(s instanceof Hb)for(let a of s.selectors){if(a instanceof Km){n=s;continue}let c=this.evalExpression(a,r);if(!(c instanceof ht))return console.error(`Invalid case selector. Line ${e.line}`),null;if(c.value===i.value)return this._execStatements(s.body,r)}else s instanceof Wb&&(n=s);return n?this._execStatements(n.body,r):null}_if(e,r){r=r.clone();let i=this.evalExpression(e.condition,r);if(!(i instanceof ht))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,r);for(let n of e.elseif){let s=this.evalExpression(n.condition,r);if(!(s instanceof ht))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(n.body,r)}return e.else?this._execStatements(e.else,r):null}_getScalarValue(e){return e instanceof ht?e.value:(console.error("Expected scalar value.",e),0)}_for(e,r){for(r=r.clone(),this.execStatement(e.init,r);this._getScalarValue(this.evalExpression(e.condition,r));){let i=this._execStatements(e.body,r);if(i===t._breakObj)break;if(i!==null&&i!==t._continueObj)return i;this.execStatement(e.increment,r)}return null}_loop(e,r){for(r=r.clone();;){let i=this._execStatements(e.body,r);if(i===t._breakObj)break;if(i===t._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,r)===t._breakObj)break}else if(i!==null)return i}return null}_while(e,r){for(r=r.clone();this._getScalarValue(this.evalExpression(e.condition,r));){let i=this._execStatements(e.body,r);if(i===t._breakObj)break;if(i!==t._continueObj&&i!==null)return i}return null}_evalBitcast(e,r){let i=this.evalExpression(e.value,r),n=e.type;if(i instanceof ht){let s=m8(i.value,i.typeInfo.name,n.name);return new ht(s,this.getTypeInfo(n))}if(i instanceof ze){let s=i.typeInfo.getTypeName(),a="";if(s.endsWith("f"))a="f32";else if(s.endsWith("i"))a="i32";else if(s.endsWith("u"))a="u32";else if(s.endsWith("b"))a="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;a="f16"}let c=n.getTypeName(),h="";if(c.endsWith("f"))h="f32";else if(c.endsWith("i"))h="i32";else if(c.endsWith("u"))h="u32";else if(c.endsWith("b"))h="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${e.line}`),null;h="f16"}let p=function(x,T,R){if(T===R)return x;let k=new Array(x.length);for(let j=0;j<x.length;j++)k[j]=m8(x[j],T,R);return k}(Array.from(i.data),a,h);return new ze(p,this.getTypeInfo(n))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,r){return r.getVariableValue(e.name).clone().getSubData(this,e.postfix,r)}_evalCreate(e,r){var i;if(e instanceof Cl){if(e.type===null)return p1.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,r);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,r);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,r)}}let n=e instanceof Cl?e.type.name:e.name,s=e instanceof Cl?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${n}. Line ${e.line}`),null;if(s.size===0)return null;let a=new Gs(new ArrayBuffer(s.size),s,0);if(s instanceof Mu){if(e.args)for(let c=0;c<e.args.length;++c){let h=s.members[c],p=e.args[c],x=this.evalExpression(p,r);a.setData(this,x,h.type,h.offset,r)}}else if(s instanceof Pu){let c=0;if(e.args)for(let h=0;h<e.args.length;++h){let p=e.args[h],x=this.evalExpression(p,r);s.format===null&&(((i=x.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=x.typeInfo),a.setData(this,x,s.format,c,r),c+=s.stride}}else console.error(`Unknown type "${n}". Line ${e.line}`);return e instanceof Cl?a.getSubData(this,e.postfix,r):a}_evalLiteral(e,r){let i=this.getTypeInfo(e.type),n=i.name;return n==="x32"||n==="u32"||n==="f32"||n==="f16"||n==="i32"||n==="bool"?new ht(e.scalarValue,i):n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"?this._callConstructorVec(e,r):n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"?this._callConstructorMatrix(e,r):e.value}_evalVariable(e,r){let i=r.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,r)}_maxFormatTypeInfo(e){let r=e[0];if(r.name==="f32")return r;for(let i=1;i<e.length;++i){let n=t._priority.get(r.name);t._priority.get(e[i].name)<n&&(r=e[i])}return r.name==="x32"?this.getTypeInfo("i32"):r}_evalUnaryOp(e,r){let i=this.evalExpression(e.right,r);if(e.operator==="&")return new ud(i);if(e.operator==="*")return i instanceof ud?i.reference.getSubData(this,e.postfix,r):(console.error(`Invalid dereference. Line ${e.line}`),null);let n=i instanceof ht?i.value:i instanceof ze?Array.from(i.data):null;switch(e.operator){case"+":{if(Ar(n)){let c=n.map((h,p)=>+h);return new ze(c,i.typeInfo)}let s=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(+s,a)}case"-":{if(Ar(n)){let c=n.map((h,p)=>-h);return new ze(c,i.typeInfo)}let s=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(-s,a)}case"!":{if(Ar(n)){let c=n.map((h,p)=>h?0:1);return new ze(c,i.typeInfo)}let s=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(s?0:1,a)}case"~":{if(Ar(n)){let c=n.map((h,p)=>~h);return new ze(c,i.typeInfo)}let s=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(~s,a)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,r){let i=this.evalExpression(e.left,r),n=this.evalExpression(e.right,r),s=i instanceof ht?i.value:i instanceof ze||i instanceof Xr?Array.from(i.data):null,a=n instanceof ht?n.value:n instanceof ze||n instanceof Xr?Array.from(n.data):null;switch(e.operator){case"+":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k+T[j]);return new ze(R,i.typeInfo)}if(Ar(s)){let x=a,T=s.map((R,k)=>R+x);return new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x+R);return new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c+h,p)}case"-":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k-T[j]);return new ze(R,i.typeInfo)}if(Ar(s)){let x=a,T=s.map((R,k)=>R-x);return new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x-R);return new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c-h,p)}case"*":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(i instanceof Xr&&n instanceof Xr){let R=function(X,re,te,oe){if(aa[re.name]===void 0||aa[oe.name]===void 0)return null;let ae=aa[re.name][0],pe=aa[re.name][1],be=aa[oe.name][0];if(ae!==aa[oe.name][1])return null;let Fe=new Array(be*pe);for(let Y=0;Y<pe;Y++)for(let J=0;J<be;J++){let Z=0;for(let xe=0;xe<ae;xe++)Z+=X[xe*pe+Y]*te[J*ae+xe];Fe[Y*be+J]=Z}return Fe}(x,i.typeInfo,T,n.typeInfo);if(R===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;let k=aa[n.typeInfo.name][0],j=aa[i.typeInfo.name][1],q=this.getTypeInfo(`mat${k}x${j}f`);return new Xr(R,q)}if(i instanceof Xr&&n instanceof ze){let R=function(k,j,q,X){if(aa[j.name]===void 0||DS[X.name]===void 0)return null;let re=aa[j.name][0],te=aa[j.name][1];if(re!==q.length)return null;let oe=new Array(te);for(let ae=0;ae<te;ae++){let pe=0;for(let be=0;be<re;be++)pe+=k[be*te+ae]*q[be];oe[ae]=pe}return oe}(x,i.typeInfo,T,n.typeInfo);return R===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ze(R,n.typeInfo)}if(i instanceof ze&&n instanceof Xr){let R=function(k,j,q,X){if(DS[j.name]===void 0||aa[X.name]===void 0)return null;let re=aa[X.name][0],te=aa[X.name][1];if(te!==k.length)return null;let oe=[];for(let ae=0;ae<re;ae++){let pe=0;for(let be=0;be<te;be++)pe+=k[be]*q[be*re+ae];oe[ae]=pe}return oe}(x,i.typeInfo,T,n.typeInfo);return R===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ze(R,i.typeInfo)}{if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k*T[j]);return new ze(R,i.typeInfo)}}if(Ar(s)){let x=a,T=s.map((R,k)=>R*x);return i instanceof Xr?new Xr(T,i.typeInfo):new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x*R);return n instanceof Xr?new Xr(T,n.typeInfo):new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c*h,p)}case"%":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k%T[j]);return new ze(R,i.typeInfo)}if(Ar(s)){let x=a,T=s.map((R,k)=>R%x);return new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x%R);return new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c%h,p)}case"/":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k/T[j]);return new ze(R,i.typeInfo)}if(Ar(s)){let x=a,T=s.map((R,k)=>R/x);return new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x/R);return new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c/h,p)}case"&":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k&T[j]);return new ze(R,i.typeInfo)}if(Ar(s)){let x=a,T=s.map((R,k)=>R&x);return new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x&R);return new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c&h,p)}case"|":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k|T[j]);return new ze(R,i.typeInfo)}if(Ar(s)){let x=a,T=s.map((R,k)=>R|x);return new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x|R);return new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c|h,p)}case"^":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k^T[j]);return new ze(R,i.typeInfo)}if(Ar(s)){let x=a,T=s.map((R,k)=>R^x);return new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x^R);return new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c^h,p)}case"<<":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k<<T[j]);return new ze(R,i.typeInfo)}if(Ar(s)){let x=a,T=s.map((R,k)=>R<<x);return new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x<<R);return new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c<<h,p)}case">>":{if(Ar(s)&&Ar(a)){let x=s,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k>>T[j]);return new ze(R,i.typeInfo)}if(Ar(s)){let x=a,T=s.map((R,k)=>R>>x);return new ze(T,i.typeInfo)}if(Ar(a)){let x=s,T=a.map((R,k)=>x>>R);return new ze(T,n.typeInfo)}let c=s,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c>>h,p)}case">":if(Ar(s)&&Ar(a)){let c=s,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x>h[T]?1:0);return new ze(p,i.typeInfo)}if(Ar(s)){let c=a,h=s.map((p,x)=>p>c?1:0);return new ze(h,i.typeInfo)}if(Ar(a)){let c=s,h=a.map((p,x)=>c>p?1:0);return new ze(h,n.typeInfo)}return new ht(s>a?1:0,this.getTypeInfo("bool"));case"<":if(Ar(s)&&Ar(a)){let c=s,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x<h[T]?1:0);return new ze(p,i.typeInfo)}if(Ar(s)){let c=a,h=s.map((p,x)=>p<c?1:0);return new ze(h,i.typeInfo)}if(Ar(a)){let c=s,h=a.map((p,x)=>c<p?1:0);return new ze(h,n.typeInfo)}return new ht(s<a?1:0,this.getTypeInfo("bool"));case"==":if(Ar(s)&&Ar(a)){let c=s,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x===h[T]?1:0);return new ze(p,i.typeInfo)}if(Ar(s)){let c=a,h=s.map((p,x)=>p==c?1:0);return new ze(h,i.typeInfo)}if(Ar(a)){let c=s,h=a.map((p,x)=>c==p?1:0);return new ze(h,n.typeInfo)}return new ht(s===a?1:0,this.getTypeInfo("bool"));case"!=":if(Ar(s)&&Ar(a)){let c=s,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x!==h[T]?1:0);return new ze(p,i.typeInfo)}if(Ar(s)){let c=a,h=s.map((p,x)=>p!==c?1:0);return new ze(h,i.typeInfo)}if(Ar(a)){let c=s,h=a.map((p,x)=>c!==p?1:0);return new ze(h,n.typeInfo)}return new ht(s!==a?1:0,this.getTypeInfo("bool"));case">=":if(Ar(s)&&Ar(a)){let c=s,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x>=h[T]?1:0);return new ze(p,i.typeInfo)}if(Ar(s)){let c=a,h=s.map((p,x)=>p>=c?1:0);return new ze(h,i.typeInfo)}if(Ar(a)){let c=s,h=a.map((p,x)=>c>=p?1:0);return new ze(h,n.typeInfo)}return new ht(s>=a?1:0,this.getTypeInfo("bool"));case"<=":if(Ar(s)&&Ar(a)){let c=s,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x<=h[T]?1:0);return new ze(p,i.typeInfo)}if(Ar(s)){let c=a,h=s.map((p,x)=>p<=c?1:0);return new ze(h,i.typeInfo)}if(Ar(a)){let c=s,h=a.map((p,x)=>c<=p?1:0);return new ze(h,n.typeInfo)}return new ht(s<=a?1:0,this.getTypeInfo("bool"));case"&&":if(Ar(s)&&Ar(a)){let c=s,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x&&h[T]?1:0);return new ze(p,i.typeInfo)}if(Ar(s)){let c=a,h=s.map((p,x)=>p&&c?1:0);return new ze(h,i.typeInfo)}if(Ar(a)){let c=s,h=a.map((p,x)=>c&&p?1:0);return new ze(h,n.typeInfo)}return new ht(s&&a?1:0,this.getTypeInfo("bool"));case"||":if(Ar(s)&&Ar(a)){let c=s,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x||h[T]?1:0);return new ze(p,i.typeInfo)}if(Ar(s)){let c=a,h=s.map((p,x)=>p||c?1:0);return new ze(h,i.typeInfo)}if(Ar(a)){let c=s,h=a.map((p,x)=>c||p?1:0);return new ze(h,n.typeInfo)}return new ht(s||a?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,r){if(e.cachedReturnValue!==null)return e.cachedReturnValue;let i=r.clone();i.currentFunctionName=e.name;let n=r.getFunction(e.name);if(!n)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,r):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<n.node.args.length;++s){let a=n.node.args[s],c=this.evalExpression(e.args[s],i);i.createVariable(a.name,c,a)}return this._execStatements(n.node.body,i)}_callBuiltinFunction(e,r){switch(e.name){case"all":return this.builtins.All(e,r);case"any":return this.builtins.Any(e,r);case"select":return this.builtins.Select(e,r);case"arrayLength":return this.builtins.ArrayLength(e,r);case"abs":return this.builtins.Abs(e,r);case"acos":return this.builtins.Acos(e,r);case"acosh":return this.builtins.Acosh(e,r);case"asin":return this.builtins.Asin(e,r);case"asinh":return this.builtins.Asinh(e,r);case"atan":return this.builtins.Atan(e,r);case"atanh":return this.builtins.Atanh(e,r);case"atan2":return this.builtins.Atan2(e,r);case"ceil":return this.builtins.Ceil(e,r);case"clamp":return this.builtins.Clamp(e,r);case"cos":return this.builtins.Cos(e,r);case"cosh":return this.builtins.Cosh(e,r);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,r);case"countOneBits":return this.builtins.CountOneBits(e,r);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,r);case"cross":return this.builtins.Cross(e,r);case"degrees":return this.builtins.Degrees(e,r);case"determinant":return this.builtins.Determinant(e,r);case"distance":return this.builtins.Distance(e,r);case"dot":return this.builtins.Dot(e,r);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,r);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,r);case"exp":return this.builtins.Exp(e,r);case"exp2":return this.builtins.Exp2(e,r);case"extractBits":return this.builtins.ExtractBits(e,r);case"faceForward":return this.builtins.FaceForward(e,r);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,r);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,r);case"floor":return this.builtins.Floor(e,r);case"fma":return this.builtins.Fma(e,r);case"fract":return this.builtins.Fract(e,r);case"frexp":return this.builtins.Frexp(e,r);case"insertBits":return this.builtins.InsertBits(e,r);case"inverseSqrt":return this.builtins.InverseSqrt(e,r);case"ldexp":return this.builtins.Ldexp(e,r);case"length":return this.builtins.Length(e,r);case"log":return this.builtins.Log(e,r);case"log2":return this.builtins.Log2(e,r);case"max":return this.builtins.Max(e,r);case"min":return this.builtins.Min(e,r);case"mix":return this.builtins.Mix(e,r);case"modf":return this.builtins.Modf(e,r);case"normalize":return this.builtins.Normalize(e,r);case"pow":return this.builtins.Pow(e,r);case"quantizeToF16":return this.builtins.QuantizeToF16(e,r);case"radians":return this.builtins.Radians(e,r);case"reflect":return this.builtins.Reflect(e,r);case"refract":return this.builtins.Refract(e,r);case"reverseBits":return this.builtins.ReverseBits(e,r);case"round":return this.builtins.Round(e,r);case"saturate":return this.builtins.Saturate(e,r);case"sign":return this.builtins.Sign(e,r);case"sin":return this.builtins.Sin(e,r);case"sinh":return this.builtins.Sinh(e,r);case"smoothStep":return this.builtins.SmoothStep(e,r);case"sqrt":return this.builtins.Sqrt(e,r);case"step":return this.builtins.Step(e,r);case"tan":return this.builtins.Tan(e,r);case"tanh":return this.builtins.Tanh(e,r);case"transpose":return this.builtins.Transpose(e,r);case"trunc":return this.builtins.Trunc(e,r);case"dpdx":return this.builtins.Dpdx(e,r);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,r);case"dpdxFine":return this.builtins.DpdxFine(e,r);case"dpdy":return this.builtins.Dpdy(e,r);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,r);case"dpdyFine":return this.builtins.DpdyFine(e,r);case"fwidth":return this.builtins.Fwidth(e,r);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,r);case"fwidthFine":return this.builtins.FwidthFine(e,r);case"textureDimensions":return this.builtins.TextureDimensions(e,r);case"textureGather":return this.builtins.TextureGather(e,r);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,r);case"textureLoad":return this.builtins.TextureLoad(e,r);case"textureNumLayers":return this.builtins.TextureNumLayers(e,r);case"textureNumLevels":return this.builtins.TextureNumLevels(e,r);case"textureNumSamples":return this.builtins.TextureNumSamples(e,r);case"textureSample":return this.builtins.TextureSample(e,r);case"textureSampleBias":return this.builtins.TextureSampleBias(e,r);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,r);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,r);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,r);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,r);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,r);case"textureStore":return this.builtins.TextureStore(e,r);case"atomicLoad":return this.builtins.AtomicLoad(e,r);case"atomicStore":return this.builtins.AtomicStore(e,r);case"atomicAdd":return this.builtins.AtomicAdd(e,r);case"atomicSub":return this.builtins.AtomicSub(e,r);case"atomicMax":return this.builtins.AtomicMax(e,r);case"atomicMin":return this.builtins.AtomicMin(e,r);case"atomicAnd":return this.builtins.AtomicAnd(e,r);case"atomicOr":return this.builtins.AtomicOr(e,r);case"atomicXor":return this.builtins.AtomicXor(e,r);case"atomicExchange":return this.builtins.AtomicExchange(e,r);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,r);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,r);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,r);case"pack4xI8":return this.builtins.Pack4xI8(e,r);case"pack4xU8":return this.builtins.Pack4xU8(e,r);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,r);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,r);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,r);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,r);case"pack2x16float":return this.builtins.Pack2x16float(e,r);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,r);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,r);case"unpack4xI8":return this.builtins.Unpack4xI8(e,r);case"unpack4xU8":return this.builtins.Unpack4xU8(e,r);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,r);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,r);case"unpack2x16float":return this.builtins.Unpack2x16float(e,r);case"storageBarrier":return this.builtins.StorageBarrier(e,r);case"textureBarrier":return this.builtins.TextureBarrier(e,r);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,r);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,r);case"subgroupAdd":return this.builtins.SubgroupAdd(e,r);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,r);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,r);case"subgroupAll":return this.builtins.SubgroupAll(e,r);case"subgroupAnd":return this.builtins.SubgroupAnd(e,r);case"subgroupAny":return this.builtins.SubgroupAny(e,r);case"subgroupBallot":return this.builtins.SubgroupBallot(e,r);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,r);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,r);case"subgroupElect":return this.builtins.SubgroupElect(e,r);case"subgroupMax":return this.builtins.SubgroupMax(e,r);case"subgroupMin":return this.builtins.SubgroupMin(e,r);case"subgroupMul":return this.builtins.SubgroupMul(e,r);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,r);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,r);case"subgroupOr":return this.builtins.SubgroupOr(e,r);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,r);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,r);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,r);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,r);case"subgroupXor":return this.builtins.SubgroupXor(e,r);case"quadBroadcast":return this.builtins.QuadBroadcast(e,r);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,r);case"quadSwapX":return this.builtins.QuadSwapX(e,r);case"quadSwapY":return this.builtins.QuadSwapY(e,r)}let i=r.getFunction(e.name);if(i){let n=r.clone();for(let s=0;s<i.node.args.length;++s){let a=i.node.args[s],c=this.evalExpression(e.args[s],n);n.setVariable(a.name,c,a)}return this._execStatements(i.node.body,n)}return null}_callConstructorValue(e,r){if(!e.args||e.args.length===0)return new ht(0,this.getTypeInfo(e.type));let i=this.evalExpression(e.args[0],r);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,r).clone()}_callConstructorVec(e,r){let i=this.getTypeInfo(e.type),n=e.type.getTypeName(),s=DS[n];if(s===void 0)return console.error(`Invalid vec constructor ${n}. Line ${e.line}`),null;let a=[];if(e instanceof Is)if(e.isVector){let c=e.vectorValue;for(let h of c)a.push(h)}else a.push(e.scalarValue);else if(e.args)for(let c of e.args){let h=this.evalExpression(c,r);if(h instanceof ze){let p=h.data;for(let x=0;x<p.length;++x){let T=p[x];a.push(T)}}else if(h instanceof ht){let p=h.value;a.push(p)}}if(e.type instanceof pt&&e.type.format===null&&(e.type.format=pt.f32),a.length===0){let c=new Array(s).fill(0);return new ze(c,i).getSubData(this,e.postfix,r)}if(a.length===1)for(;a.length<s;)a.push(a[0]);return a.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new ze(a.length>s?a.slice(0,s):a,i).getSubData(this,e.postfix,r)}_callConstructorMatrix(e,r){let i=this.getTypeInfo(e.type),n=e.type.getTypeName(),s=aa[n];if(s===void 0)return console.error(`Invalid matrix constructor ${n}. Line ${e.line}`),null;let a=[];if(e instanceof Is)if(e.isVector){let c=e.vectorValue;for(let h of c)a.push(h)}else a.push(e.scalarValue);else if(e.args)for(let c of e.args){let h=this.evalExpression(c,r);h instanceof ze?a.push(...h.data):h instanceof ht?a.push(h.value):h instanceof Xr&&a.push(...h.data)}if(i instanceof Nh&&i.format===null&&(i.format=this.getTypeInfo("f32")),a.length===0){let c=new Array(s[2]).fill(0);return new Xr(c,i).getSubData(this,e.postfix,r)}return a.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Xr(a,i).getSubData(this,e.postfix,r)}};Qm._breakObj=new Ml(new Ma("BREAK",null),null),Qm._continueObj=new Ml(new Ma("CONTINUE",null),null),Qm._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var eI=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},tI=class{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new eI,this._exec=new Qm,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;let r=[];for(;!this._isAtEnd();){let i=this._global_decl_or_directive();if(!i)break;r.push(i)}if(this._deferArrayCountEval.length>0){for(let i of this._deferArrayCountEval){let n=i.arrayType,s=i.countNode;if(s instanceof la){let a=s.name,c=this._context.constants.get(a);if(c)try{let h=c.constEvaluate(this._exec);n.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let i of r)i.search(n=>{n instanceof qb||n instanceof l1?n.type=this._forwardType(n.type):n instanceof $p?n.format=this._forwardType(n.format):n instanceof Ec||n instanceof Wp||n instanceof Ym?n.type=this._forwardType(n.type):n instanceof Zp?n.returnType=this._forwardType(n.returnType):n instanceof $b&&(n.type=this._forwardType(n.type))});return r}_forwardType(e){if(e instanceof zb){let r=this._getType(e.name);if(r)return r}else e instanceof l1?e.type=this._forwardType(e.type):e instanceof $p&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){let r=new qS(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,r){return e.line=r??this._currentLine,e}_error(e,r){return{token:e,message:r,toString:()=>`${r}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Me.eof}_match(e){if(e instanceof lt)return!!this._check(e)&&(this._advance(),!0);for(let r=0,i=e.length;r<i;++r){let n=e[r];if(this._check(n))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),`${r}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;let r=this._peek();if(e instanceof Array){let i=r.type,n=!1;for(let s of e){if(i===s)return!0;s===Me.tokens.name&&(n=!0)}if(n){let s=Me.tokens.name.rule.exec(r.lexeme);if(s&&s.index==0&&s[0]==r.lexeme)return!0}return!1}if(r.type===e)return!0;if(e===Me.tokens.name){let i=Me.tokens.name.rule.exec(r.lexeme);return i&&i.index==0&&i[0]==r.lexeme}return!1}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Me.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Me.keywords.alias)){let r=this._type_alias();return this._consume(Me.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(Me.keywords.diagnostic)){let r=this._diagnostic();return this._consume(Me.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(Me.keywords.requires)){let r=this._requires_directive();return this._consume(Me.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(Me.keywords.enable)){let r=this._enable_directive();return this._consume(Me.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}let e=this._attribute();if(this._check(Me.keywords.var)){let r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(Me.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Me.keywords.override)){let r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(Me.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Me.keywords.let)){let r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(Me.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Me.keywords.const)){let r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(Me.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Me.keywords.struct)){let r=this._struct_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}if(this._check(Me.keywords.fn)){let r=this._function_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}return null}_function_decl(){if(!this._match(Me.keywords.fn))return null;let e=this._currentLine,r=this._consume(Me.tokens.ident,"Expected function name.").toString();this._consume(Me.tokens.paren_left,"Expected '(' for function arguments.");let i=[];if(!this._check(Me.tokens.paren_right))do{if(this._check(Me.tokens.paren_right))break;let c=this._attribute(),h=this._consume(Me.tokens.name,"Expected argument name.").toString();this._consume(Me.tokens.colon,"Expected ':' for argument type.");let p=this._attribute(),x=this._type_decl();x!=null&&(x.attributes=p,i.push(this._updateNode(new $b(h,x,c))))}while(this._match(Me.tokens.comma));this._consume(Me.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(Me.tokens.arrow)){let c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}let s=this._compound_statement(),a=this._currentLine;return this._updateNode(new Zp(r,i,n,s,e,a),e)}_compound_statement(){let e=[];for(this._consume(Me.tokens.brace_left,"Expected '{' for block.");!this._check(Me.tokens.brace_right);){let r=this._statement();r!==null&&e.push(r)}return this._consume(Me.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Me.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Me.tokens.attr)&&this._attribute(),this._check(Me.keywords.if))return this._if_statement();if(this._check(Me.keywords.switch))return this._switch_statement();if(this._check(Me.keywords.loop))return this._loop_statement();if(this._check(Me.keywords.for))return this._for_statement();if(this._check(Me.keywords.while))return this._while_statement();if(this._check(Me.keywords.continuing))return this._continuing_statement();if(this._check(Me.keywords.static_assert))return this._static_assert_statement();if(this._check(Me.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Me.keywords.return))e=this._return_statement();else if(this._check([Me.keywords.var,Me.keywords.let,Me.keywords.const]))e=this._variable_statement();else if(this._match(Me.keywords.discard))e=this._updateNode(new WS);else if(this._match(Me.keywords.break)){let r=this._updateNode(new kb);if(this._currentLoop.length>0){let i=this._currentLoop[this._currentLoop.length-1];r.loopId=i.id}e=r,this._check(Me.keywords.if)&&(this._advance(),r.condition=this._optional_paren_expression())}else if(this._match(Me.keywords.continue)){let r=this._updateNode(new Nb);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${r.line}`);{let i=this._currentLoop[this._currentLoop.length-1];r.loopId=i.id}e=r}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(Me.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Me.keywords.static_assert))return null;let e=this._currentLine,r=this._optional_paren_expression();return this._updateNode(new jS(r),e)}_while_statement(){if(!this._match(Me.keywords.while))return null;let e=this._updateNode(new Ib(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Me.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){let e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Me.keywords.continuing))return null;let r=this._currentLine,i=this._compound_statement();return this._updateNode(new c1(i,e),r)}_for_statement(){if(!this._match(Me.keywords.for))return null;this._consume(Me.tokens.paren_left,"Expected '('.");let e=this._updateNode(new Mb(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Me.tokens.semicolon)?null:this._for_init(),this._consume(Me.tokens.semicolon,"Expected ';'."),e.condition=this._check(Me.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Me.tokens.semicolon,"Expected ';'."),e.increment=this._check(Me.tokens.paren_right)?null:this._for_increment(),this._consume(Me.tokens.paren_right,"Expected ')'."),this._check(Me.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Me.keywords.var)){let e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(Me.tokens.equal)&&(r=this._short_circuit_or_expression()),this._updateNode(new Ec(e.name,e.type,e.storage,e.access,r),e.line)}if(this._match(Me.keywords.let)){let e=this._currentLine,r=this._consume(Me.tokens.name,"Expected name for let.").toString(),i=null;if(this._match(Me.tokens.colon)){let s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(Me.tokens.equal,"Expected '=' for let.");let n=this._short_circuit_or_expression();return this._updateNode(new Wp(r,i,null,null,n),e)}if(this._match(Me.keywords.const)){let e=this._currentLine,r=this._consume(Me.tokens.name,"Expected name for const.").toString(),i=null;if(this._match(Me.tokens.colon)){let s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(Me.tokens.equal,"Expected '=' for const.");let n=this._short_circuit_or_expression();return i===null&&n instanceof Is&&(i=n.type),this._updateNode(new Ym(r,i,null,null,n),e)}return null}_increment_decrement_statement(){let e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(Me.increment_operators))return this._current=e,null;let i=this._consume(Me.increment_operators,"Expected increment operator");return this._updateNode(new Pb(i.type===Me.tokens.plus_plus?Zm.increment:Zm.decrement,r))}_assignment_statement(){let e=null,r=this._currentLine;if(this._check(Me.tokens.brace_right))return null;let i=this._match(Me.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;let n=this._consume(Me.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new Rb(a1.parse(n.lexeme),e,s),r)}_func_call_statement(){if(!this._check(Me.tokens.ident))return null;let e=this._currentLine,r=this._current,i=this._consume(Me.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=r,null):this._updateNode(new h1(i.lexeme,n),e)}_loop_statement(){if(!this._match(Me.keywords.loop))return null;this._check(Me.tokens.attr)&&this._attribute(),this._consume(Me.tokens.brace_left,"Expected '{' for loop.");let e=this._updateNode(new Bb([],null));this._currentLoop.push(e);let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let i of r)e.body.push(i);else e.body.push(r);if(r instanceof c1){e.continuing=r;break}r=this._statement()}return this._currentLoop.pop(),this._consume(Me.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Me.keywords.switch))return null;let e=this._updateNode(new Lb(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Me.tokens.attr)&&this._attribute(),this._consume(Me.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Me.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){let e=[],r=!1;for(;this._check([Me.keywords.default,Me.keywords.case]);){if(this._match(Me.keywords.case)){let i=this._case_selectors();for(let s of i)if(s instanceof Km){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");r=!0;break}this._match(Me.tokens.colon),this._check(Me.tokens.attr)&&this._attribute(),this._consume(Me.tokens.brace_left,"Exected '{' for switch case.");let n=this._case_body();this._consume(Me.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Hb(i,n)))}if(this._match(Me.keywords.default)){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Me.tokens.colon),this._check(Me.tokens.attr)&&this._attribute(),this._consume(Me.tokens.brace_left,"Exected '{' for switch default.");let i=this._case_body();this._consume(Me.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Wb(i)))}}return e}_case_selectors(){let e=[];for(this._match(Me.keywords.default)?e.push(this._updateNode(new Km)):e.push(this._shift_expression());this._match(Me.tokens.comma);)this._match(Me.keywords.default)?e.push(this._updateNode(new Km)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Me.keywords.fallthrough))return this._consume(Me.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);let r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(Me.keywords.if))return null;let e=this._currentLine,r=this._optional_paren_expression();this._check(Me.tokens.attr)&&this._attribute();let i=this._compound_statement(),n=[];this._match_elseif()&&(this._check(Me.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let s=null;return this._match(Me.keywords.else)&&(this._check(Me.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new Ob(r,i,n,s),e)}_match_elseif(){return this._tokens[this._current].type===Me.keywords.else&&this._tokens[this._current+1].type===Me.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){let r=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new $S(r,i))),this._match_elseif()&&(this._check(Me.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Me.keywords.return))return null;let e=this._short_circuit_or_expression();return this._updateNode(new Db(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Me.tokens.or_or);)e=this._updateNode(new rl(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Me.tokens.and_and);)e=this._updateNode(new rl(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Me.tokens.or);)e=this._updateNode(new rl(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Me.tokens.xor);)e=this._updateNode(new rl(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Me.tokens.and);)e=this._updateNode(new rl(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){let e=this._relational_expression();return this._match([Me.tokens.equal_equal,Me.tokens.not_equal])?this._updateNode(new rl(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Me.tokens.less_than,Me.tokens.greater_than,Me.tokens.less_than_equal,Me.tokens.greater_than_equal]);)e=this._updateNode(new rl(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Me.tokens.shift_left,Me.tokens.shift_right]);)e=this._updateNode(new rl(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Me.tokens.plus,Me.tokens.minus]);)e=this._updateNode(new rl(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Me.tokens.star,Me.tokens.forward_slash,Me.tokens.modulo]);)e=this._updateNode(new rl(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Me.tokens.minus,Me.tokens.bang,Me.tokens.tilde,Me.tokens.star,Me.tokens.and])?this._updateNode(new As(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(Me.tokens.bracket_left)){let e=this._short_circuit_or_expression();this._consume(Me.tokens.bracket_right,"Expected ']'.");let r=this._updateNode(new hd(e)),i=this._postfix_expression();return i&&(r.postfix=i),r}if(this._match(Me.tokens.period)){let e=this._consume(Me.tokens.name,"Expected member name."),r=this._postfix_expression(),i=this._updateNode(new zh(e.lexeme));return r&&(i.postfix=r),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){let r=this._getStruct(e);if(r!==null)return r;switch(e){case"void":return Xt.void;case"bool":return Xt.bool;case"i32":return Xt.i32;case"u32":return Xt.u32;case"f32":return Xt.f32;case"f16":return Xt.f16;case"vec2f":return pt.vec2f;case"vec3f":return pt.vec3f;case"vec4f":return pt.vec4f;case"vec2i":return pt.vec2i;case"vec3i":return pt.vec3i;case"vec4i":return pt.vec4i;case"vec2u":return pt.vec2u;case"vec3u":return pt.vec3u;case"vec4u":return pt.vec4u;case"vec2h":return pt.vec2h;case"vec3h":return pt.vec3h;case"vec4h":return pt.vec4h;case"mat2x2f":return pt.mat2x2f;case"mat2x3f":return pt.mat2x3f;case"mat2x4f":return pt.mat2x4f;case"mat3x2f":return pt.mat3x2f;case"mat3x3f":return pt.mat3x3f;case"mat3x4f":return pt.mat3x4f;case"mat4x2f":return pt.mat4x2f;case"mat4x3f":return pt.mat4x3f;case"mat4x4f":return pt.mat4x4f;case"mat2x2h":return pt.mat2x2h;case"mat2x3h":return pt.mat2x3h;case"mat2x4h":return pt.mat2x4h;case"mat3x2h":return pt.mat3x2h;case"mat3x3h":return pt.mat3x3h;case"mat3x4h":return pt.mat3x4h;case"mat4x2h":return pt.mat4x2h;case"mat4x3h":return pt.mat4x3h;case"mat4x4h":return pt.mat4x4h;case"mat2x2i":return pt.mat2x2i;case"mat2x3i":return pt.mat2x3i;case"mat2x4i":return pt.mat2x4i;case"mat3x2i":return pt.mat3x2i;case"mat3x3i":return pt.mat3x3i;case"mat3x4i":return pt.mat3x4i;case"mat4x2i":return pt.mat4x2i;case"mat4x3i":return pt.mat4x3i;case"mat4x4i":return pt.mat4x4i;case"mat2x2u":return pt.mat2x2u;case"mat2x3u":return pt.mat2x3u;case"mat2x4u":return pt.mat2x4u;case"mat3x2u":return pt.mat3x2u;case"mat3x3u":return pt.mat3x3u;case"mat3x4u":return pt.mat3x4u;case"mat4x2u":return pt.mat4x2u;case"mat4x3u":return pt.mat4x3u;case"mat4x4u":return pt.mat4x4u}return null}_validateTypeRange(e,r){if(r.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(r.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Me.tokens.ident)){let i=this._previous().toString();if(this._check(Me.tokens.paren_left)){let n=this._argument_expression_list(),s=this._getType(i);return s!==null?this._updateNode(new Cl(s,n)):this._updateNode(new d1(i,n))}if(this._context.constants.has(i)){let n=this._context.constants.get(i);return this._updateNode(new Ub(i,n.value))}return this._updateNode(new la(i))}if(this._match(Me.tokens.int_literal)){let i=this._previous().toString(),n=i.endsWith("i")||i.endsWith("i")?Xt.i32:i.endsWith("u")||i.endsWith("U")?Xt.u32:Xt.x32,s=parseInt(i);return this._validateTypeRange(s,n),this._updateNode(new Is(new ht(s,this._exec.getTypeInfo(n)),n))}if(this._match(Me.tokens.uint_literal)){let i=parseInt(this._previous().toString());return this._validateTypeRange(i,Xt.u32),this._updateNode(new Is(new ht(i,this._exec.getTypeInfo(Xt.u32)),Xt.u32))}if(this._match([Me.tokens.decimal_float_literal,Me.tokens.hex_float_literal])){let i=this._previous().toString(),n=i.endsWith("h");n&&(i=i.substring(0,i.length-1));let s=parseFloat(i);this._validateTypeRange(s,n?Xt.f16:Xt.f32);let a=n?Xt.f16:Xt.f32;return this._updateNode(new Is(new ht(s,this._exec.getTypeInfo(a)),a))}if(this._match([Me.keywords.true,Me.keywords.false])){let i=this._previous().toString()===Me.keywords.true.rule;return this._updateNode(new Is(new ht(i?1:0,this._exec.getTypeInfo(Xt.bool)),Xt.bool))}if(this._check(Me.tokens.paren_left))return this._paren_expression();if(this._match(Me.keywords.bitcast)){this._consume(Me.tokens.less_than,"Expected '<'.");let i=this._type_decl();this._consume(Me.tokens.greater_than,"Expected '>'.");let n=this._paren_expression();return this._updateNode(new Vb(i,n))}let e=this._type_decl(),r=this._argument_expression_list();return this._updateNode(new Cl(e,r))}_argument_expression_list(){if(!this._match(Me.tokens.paren_left))return null;let e=[];do{if(this._check(Me.tokens.paren_right))break;let r=this._short_circuit_or_expression();e.push(r)}while(this._match(Me.tokens.comma));return this._consume(Me.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Me.tokens.paren_left);let e=this._short_circuit_or_expression();return this._match(Me.tokens.paren_right),e}_paren_expression(){this._consume(Me.tokens.paren_left,"Expected '('.");let e=this._short_circuit_or_expression();return this._consume(Me.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Me.keywords.struct))return null;let e=this._currentLine,r=this._consume(Me.tokens.ident,"Expected name for struct.").toString();this._consume(Me.tokens.brace_left,"Expected '{' for struct body.");let i=[];for(;!this._check(Me.tokens.brace_right);){let a=this._attribute(),c=this._consume(Me.tokens.name,"Expected variable name.").toString();this._consume(Me.tokens.colon,"Expected ':' for struct member type.");let h=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=h),this._check(Me.tokens.brace_right)?this._match(Me.tokens.comma):this._consume(Me.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new qb(c,p,a)))}this._consume(Me.tokens.brace_right,"Expected '}' after struct body.");let n=this._currentLine,s=this._updateNode(new Tc(r,i,e,n),e);return this._context.structs.set(r,s),s}_global_variable_decl(){let e=this._variable_decl();if(!e)return null;if(this._match(Me.tokens.equal)){let r=this._const_expression();e.value=r}if(e.type!==null&&e.value instanceof Is){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Is&&(e.type=e.value.type.name==="x32"?Xt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){let e=this._override_decl();return e&&this._match(Me.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Me.keywords.const))return null;let r=this._consume(Me.tokens.name,"Expected variable name"),i=this._currentLine,n=null;if(this._match(Me.tokens.colon)){let h=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=h)}let s=null;this._consume(Me.tokens.equal,"const declarations require an assignment");let a=this._short_circuit_or_expression();try{let h=[Xt.f32],p=a.constEvaluate(this._exec,h);p instanceof ht&&this._validateTypeRange(p.value,h[0]),h[0]instanceof pt&&h[0].format===null&&p.typeInfo instanceof Nh&&p.typeInfo.format!==null&&(p.typeInfo.format.name==="f16"?h[0].format=Xt.f16:p.typeInfo.format.name==="f32"?h[0].format=Xt.f32:p.typeInfo.format.name==="i32"?h[0].format=Xt.i32:p.typeInfo.format.name==="u32"?h[0].format=Xt.u32:p.typeInfo.format.name==="bool"?h[0].format=Xt.bool:console.error(`TODO: impelement template format type ${p.typeInfo.format.name}`)),s=this._updateNode(new Is(p,h[0])),this._exec.context.setVariable(r.toString(),p)}catch{s=a}if(n!==null&&s instanceof Is){if(s.type.name!=="x32"&&n.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${n.name}. Line:${this._currentLine}`);s.type=n,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else n===null&&s instanceof Is&&(n=(e=s?.type)!==null&&e!==void 0?e:Xt.f32,n===Xt.x32&&(n=Xt.i32));let c=this._updateNode(new Ym(r.toString(),n,"","",s),i);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(Me.keywords.let))return null;let e=this._currentLine,r=this._consume(Me.tokens.name,"Expected variable name"),i=null;if(this._match(Me.tokens.colon)){let s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}let n=null;if(this._match(Me.tokens.equal)&&(n=this._const_expression()),i!==null&&n instanceof Is){if(n.type.name!=="x32"&&i.getTypeName()!==n.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${i.name}. Line:${this._currentLine}`);n.type=i}else i===null&&n instanceof Is&&(i=n.type.name==="x32"?Xt.i32:n.type);return n instanceof Is&&n.isScalar&&this._validateTypeRange(n.scalarValue,i),this._updateNode(new Wp(r.toString(),i,"","",n),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Me.keywords.var))return null;let e=this._currentLine,r="",i="";this._match(Me.tokens.less_than)&&(r=this._consume(Me.storage_class,"Expected storage_class.").toString(),this._match(Me.tokens.comma)&&(i=this._consume(Me.access_mode,"Expected access_mode.").toString()),this._consume(Me.tokens.greater_than,"Expected '>'."));let n=this._consume(Me.tokens.name,"Expected variable name"),s=null;if(this._match(Me.tokens.colon)){let a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}return this._updateNode(new Ec(n.toString(),s,r,i,null),e)}_override_decl(){if(!this._match(Me.keywords.override))return null;let e=this._consume(Me.tokens.name,"Expected variable name"),r=null;if(this._match(Me.tokens.colon)){let i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}return this._updateNode(new u1(e.toString(),r,null))}_diagnostic(){this._consume(Me.tokens.paren_left,"Expected '('");let e=this._consume(Me.tokens.ident,"Expected severity control name.");this._consume(Me.tokens.comma,"Expected ','");let r=this._consume(Me.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Me.tokens.period)&&(r+=`.${this._consume(Me.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Me.tokens.paren_right,"Expected ')'"),this._updateNode(new Fb(e.toString(),r))}_enable_directive(){let e=this._consume(Me.tokens.ident,"identity expected.");return this._updateNode(new GS(e.toString()))}_requires_directive(){let e=[this._consume(Me.tokens.ident,"identity expected.").toString()];for(;this._match(Me.tokens.comma);){let r=this._consume(Me.tokens.ident,"identity expected.");e.push(r.toString())}return this._updateNode(new HS(e))}_type_alias(){let e=this._consume(Me.tokens.ident,"identity expected.");this._consume(Me.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let i=this._updateNode(new f1(e.toString(),r));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([Me.tokens.ident,...Me.texel_format,Me.keywords.bool,Me.keywords.f32,Me.keywords.i32,Me.keywords.u32])){let i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){let n=this._updateNode(new zb(i));return this._forwardTypeCount++,n}return this._updateNode(new Xt(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Me.template_types)){let i=this._advance().toString(),n=null,s=null;return this._match(Me.tokens.less_than)&&(n=this._type_decl(),s=null,this._match(Me.tokens.comma)&&(s=this._consume(Me.access_mode,"Expected access_mode for pointer").toString()),this._consume(Me.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new pt(i,n,s))}if(this._match(Me.keywords.ptr)){let i=this._previous().toString();this._consume(Me.tokens.less_than,"Expected '<' for pointer.");let n=this._consume(Me.storage_class,"Expected storage_class for pointer");this._consume(Me.tokens.comma,"Expected ',' for pointer.");let s=this._type_decl(),a=null;return this._match(Me.tokens.comma)&&(a=this._consume(Me.access_mode,"Expected access_mode for pointer").toString()),this._consume(Me.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new l1(i,n.toString(),s,a))}let r=this._attribute();if(this._match(Me.keywords.array)){let i=null,n=-1,s=this._previous(),a=null;if(this._match(Me.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let h="";if(this._match(Me.tokens.comma)){a=this._shift_expression();try{h=a.constEvaluate(this._exec).toString(),a=null}catch{h="1"}}this._consume(Me.tokens.greater_than,"Expected '>' for array."),n=h?parseInt(h):0}let c=this._updateNode(new $p(s.toString(),r,i,n));return a&&this._deferArrayCountEval.push({arrayType:c,countNode:a}),c}return null}_texture_sampler_types(){if(this._match(Me.sampler_type))return this._updateNode(new Hp(this._previous().toString(),null,null));if(this._match(Me.depth_texture_type))return this._updateNode(new Hp(this._previous().toString(),null,null));if(this._match(Me.sampled_texture_type)||this._match(Me.multisampled_texture_type)){let e=this._previous();this._consume(Me.tokens.less_than,"Expected '<' for sampler type.");let r=this._type_decl();return this._consume(Me.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Hp(e.toString(),r,null))}if(this._match(Me.storage_texture_type)){let e=this._previous();this._consume(Me.tokens.less_than,"Expected '<' for sampler type.");let r=this._consume(Me.texel_format,"Invalid texel format.").toString();this._consume(Me.tokens.comma,"Expected ',' after texel format.");let i=this._consume(Me.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Me.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Hp(e.toString(),r,i))}return null}_attribute(){let e=[];for(;this._match(Me.tokens.attr);){let r=this._consume(Me.attribute_name,"Expected attribute name"),i=this._updateNode(new Zb(r.toString(),null));if(this._match(Me.tokens.paren_left)){if(i.value=this._consume(Me.literal_or_ident,"Expected attribute value").toString(),this._check(Me.tokens.comma)){this._advance();do{let n=this._consume(Me.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(n)}while(this._match(Me.tokens.comma))}this._consume(Me.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}},Jb=class extends qp{constructor(e){super(),e&&this.update(e)}update(e){let r=new tI().parse(e);this.updateAST(r)}};function iI(t){let e={attributes:[],bindings:[]},r;try{r=aJ(t)}catch(s){return jt.error(s.message)(),e}for(let s of r.uniforms){let a=[];for(let c of s.type?.members||[])a.push({name:c.name,type:x8(c.type)});e.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:a})}for(let s of r.textures)e.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(let s of r.samplers)e.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});let i=r.entry.vertex[0],n=i?.inputs.length||0;for(let s=0;s<n;s++){let a=i.inputs[s];if(a.locationType==="location"){let c=x8(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:c})}}return e}function x8(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function aJ(t){try{return new Jb(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&e?.message&&(r+=`: ${e.message} `),typeof e=="object"&&e?.token&&(r+=e.token.line||""),new Error(r,{cause:e})}}var lJ=1/Math.PI*180,cJ=1/180*Math.PI,uJ={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...uJ}};var On=globalThis.mathgl.config;function nI(t,{precision:e=On.precision}={}){return t=hJ(t),`${parseFloat(t.toPrecision(e))}`}function il(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function sI(t){return b8(t)}function oI(t){return nl(t)}function b8(t,e){return aI(t,r=>r*cJ,e)}function nl(t,e){return aI(t,r=>r*lJ,e)}function xo(t,e,r){return aI(t,i=>Math.max(e,Math.min(r,i)))}function Do(t,e,r){return il(t)?t.map((i,n)=>Do(i,e[n],r)):r*e+(1-r)*t}function Hs(t,e,r){let i=On.EPSILON;r&&(On.EPSILON=r);try{if(t===e)return!0;if(il(t)&&il(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Hs(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=On.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{On.EPSILON=i}}function hJ(t){return Math.round(t/On.EPSILON)*On.EPSILON}function fJ(t){return t.clone?t.clone():new Array(t.length)}function aI(t,e,r){if(il(t)){let i=t;r=r||fJ(i);for(let n=0;n<r.length&&n<i.length;++n){let s=typeof t=="number"?t:t[n];r[n]=e(s,n,r)}return r}return e(t)}var fd=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+r];return this.check()}toArray(e=[],r=0){for(let i=0;i<this.ELEMENTS;++i)e[r+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:il(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(On)}formatString(e){let r="";for(let i=0;i<this.ELEMENTS;++i)r+=(i>0?", ":"")+nI(this[i],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!Hs(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,i){if(i===void 0)return this.lerp(this,e,r);for(let n=0;n<this.ELEMENTS;++n){let s=e[n],a=typeof r=="number"?r:r[n];this[n]=s+i*(a-s)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),r[i]);return this.check()}add(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=r[i];return this.check()}subtract(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=r[i];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(On.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),r);return this.check()}get elements(){return this}};function dJ(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function ki(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function dd(t,e,r=""){if(On.debug&&!dJ(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function bo(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}var pd=class extends fd{get x(){return this[0]}set x(e){this[0]=ki(e)}get y(){return this[1]}set y(e){this[1]=ki(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let i=0;i<this.ELEMENTS;++i){let n=this[i]-e[i];r+=n*n}return ki(r)}dot(e){let r=0;for(let i=0;i<this.ELEMENTS;++i)r+=this[i]*e[i];return ki(r)}normalize(){let e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=r[i];return this.check()}divide(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=r[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return bo(e>=0&&e<this.ELEMENTS,"index is out of range"),ki(this[e])}setComponent(e,r){return bo(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}};var Bu={};Es(Bu,{add:()=>_J,angle:()=>OJ,ceil:()=>yJ,clone:()=>pJ,copy:()=>mJ,create:()=>v8,cross:()=>PJ,dist:()=>GJ,distance:()=>C8,div:()=>jJ,divide:()=>E8,dot:()=>MJ,equals:()=>NJ,exactEquals:()=>kJ,floor:()=>xJ,forEach:()=>$J,fromValues:()=>AJ,inverse:()=>SJ,len:()=>zJ,length:()=>I8,lerp:()=>RJ,max:()=>vJ,min:()=>bJ,mul:()=>VJ,multiply:()=>T8,negate:()=>CJ,normalize:()=>IJ,random:()=>BJ,rotate:()=>LJ,round:()=>wJ,scale:()=>TJ,scaleAndAdd:()=>EJ,set:()=>gJ,sqrDist:()=>HJ,sqrLen:()=>WJ,squaredDistance:()=>S8,squaredLength:()=>M8,str:()=>FJ,sub:()=>UJ,subtract:()=>w8,transformMat2:()=>lI,transformMat2d:()=>cI,transformMat3:()=>A1,transformMat4:()=>m1,zero:()=>DJ});var Cn=typeof Float32Array<"u"?Float32Array:Array,Ru=Math.random;function Pl(t){return t>=0?Math.round(t):t%.5===0?Math.floor(t):Math.round(t)}var bEe=Math.PI/180;function v8(){let t=new Cn(2);return Cn!=Float32Array&&(t[0]=0,t[1]=0),t}function pJ(t){let e=new Cn(2);return e[0]=t[0],e[1]=t[1],e}function AJ(t,e){let r=new Cn(2);return r[0]=t,r[1]=e,r}function mJ(t,e){return t[0]=e[0],t[1]=e[1],t}function gJ(t,e,r){return t[0]=e,t[1]=r,t}function _J(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function w8(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function T8(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function E8(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function yJ(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function xJ(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function bJ(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function vJ(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function wJ(t,e){return t[0]=Pl(e[0]),t[1]=Pl(e[1]),t}function TJ(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function EJ(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function C8(t,e){let r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function S8(t,e){let r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function I8(t){let e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function M8(t){let e=t[0],r=t[1];return e*e+r*r}function CJ(t,e){return t[0]=-e[0],t[1]=-e[1],t}function SJ(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function IJ(t,e){let r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function MJ(t,e){return t[0]*e[0]+t[1]*e[1]}function PJ(t,e,r){let i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function RJ(t,e,r,i){let n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function BJ(t,e){e=e===void 0?1:e;let r=Ru()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function lI(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function cI(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function A1(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function m1(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function LJ(t,e,r,i){let n=e[0]-r[0],s=e[1]-r[1],a=Math.sin(i),c=Math.cos(i);return t[0]=n*c-s*a+r[0],t[1]=n*a+s*c+r[1],t}function OJ(t,e){let r=t[0],i=t[1],n=e[0],s=e[1],a=Math.sqrt((r*r+i*i)*(n*n+s*s)),c=a&&(r*n+i*s)/a;return Math.acos(Math.min(Math.max(c,-1),1))}function DJ(t){return t[0]=0,t[1]=0,t}function FJ(t){return`vec2(${t[0]}, ${t[1]})`}function kJ(t,e){return t[0]===e[0]&&t[1]===e[1]}function NJ(t,e){let r=t[0],i=t[1],n=e[0],s=e[1];return Math.abs(r-n)<=1e-6*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))}var zJ=I8,UJ=w8,VJ=T8,jJ=E8,GJ=C8,HJ=S8,WJ=M8,$J=function(){let t=v8();return function(e,r,i,n,s,a){let c,h;for(r||(r=2),i||(i=0),n?h=Math.min(n*r+i,e.length):h=e.length,c=i;c<h;c+=r)t[0]=e[c],t[1]=e[c+1],s(t,t,a),e[c]=t[0],e[c+1]=t[1];return e}}();function ev(t,e,r){let i=e[0],n=e[1],s=r[3]*i+r[7]*n||1;return t[0]=(r[0]*i+r[4]*n)/s,t[1]=(r[1]*i+r[5]*n)/s,t}function tv(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[3]*i+r[7]*n+r[11]*s||1;return t[0]=(r[0]*i+r[4]*n+r[8]*s)/a,t[1]=(r[1]*i+r[5]*n+r[9]*s)/a,t[2]=(r[2]*i+r[6]*n+r[10]*s)/a,t}function P8(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t}function R8(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t[3]=e[3],t}function rv(t,e,r){let i=e[0],n=e[1],s=e[2];return t[0]=r[0]*i+r[3]*n+r[6]*s,t[1]=r[1]*i+r[4]*n+r[7]*s,t[2]=r[2]*i+r[5]*n+r[8]*s,t[3]=e[3],t}var Xp=class extends pd{constructor(e=0,r=0){super(2),il(e)&&arguments.length===1?this.copy(e):(On.debug&&(ki(e),ki(r)),this[0]=e,this[1]=r)}set(e,r){return this[0]=e,this[1]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return On.debug&&(ki(e.x),ki(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return m1(this,this,e),this.check()}transformAsVector(e){return ev(this,this,e),this.check()}transformByMatrix3(e){return A1(this,this,e),this.check()}transformByMatrix2x3(e){return cI(this,this,e),this.check()}transformByMatrix2(e){return lI(this,this,e),this.check()}};var Fo={};Es(Fo,{add:()=>YJ,angle:()=>pI,bezier:()=>cee,ceil:()=>KJ,clone:()=>qJ,copy:()=>ZJ,create:()=>iv,cross:()=>Yp,dist:()=>_ee,distance:()=>F8,div:()=>gee,divide:()=>D8,dot:()=>g1,equals:()=>pee,exactEquals:()=>dee,floor:()=>QJ,forEach:()=>bee,fromValues:()=>nv,hermite:()=>lee,inverse:()=>see,len:()=>AI,length:()=>B8,lerp:()=>oee,max:()=>eee,min:()=>JJ,mul:()=>mee,multiply:()=>O8,negate:()=>nee,normalize:()=>uI,random:()=>uee,rotateX:()=>hI,rotateY:()=>fI,rotateZ:()=>dI,round:()=>tee,scale:()=>ree,scaleAndAdd:()=>iee,set:()=>XJ,slerp:()=>aee,sqrDist:()=>yee,sqrLen:()=>xee,squaredDistance:()=>k8,squaredLength:()=>N8,str:()=>fee,sub:()=>Aee,subtract:()=>L8,transformMat3:()=>_1,transformMat4:()=>Kp,transformQuat:()=>y1,zero:()=>hee});function iv(){let t=new Cn(3);return Cn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function qJ(t){let e=new Cn(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function B8(t){let e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function nv(t,e,r){let i=new Cn(3);return i[0]=t,i[1]=e,i[2]=r,i}function ZJ(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function XJ(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function YJ(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function L8(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function O8(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function D8(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function KJ(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function QJ(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function JJ(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function eee(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function tee(t,e){return t[0]=Pl(e[0]),t[1]=Pl(e[1]),t[2]=Pl(e[2]),t}function ree(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function iee(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function F8(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function k8(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function N8(t){let e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function nee(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function see(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function uI(t,e){let r=e[0],i=e[1],n=e[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function g1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Yp(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[0],c=r[1],h=r[2];return t[0]=n*h-s*c,t[1]=s*a-i*h,t[2]=i*c-n*a,t}function oee(t,e,r,i){let n=e[0],s=e[1],a=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a),t}function aee(t,e,r,i){let n=Math.acos(Math.min(Math.max(g1(e,r),-1),1)),s=Math.sin(n),a=Math.sin((1-i)*n)/s,c=Math.sin(i*n)/s;return t[0]=a*e[0]+c*r[0],t[1]=a*e[1]+c*r[1],t[2]=a*e[2]+c*r[2],t}function lee(t,e,r,i,n,s){let a=s*s,c=a*(2*s-3)+1,h=a*(s-2)+s,p=a*(s-1),x=a*(3-2*s);return t[0]=e[0]*c+r[0]*h+i[0]*p+n[0]*x,t[1]=e[1]*c+r[1]*h+i[1]*p+n[1]*x,t[2]=e[2]*c+r[2]*h+i[2]*p+n[2]*x,t}function cee(t,e,r,i,n,s){let a=1-s,c=a*a,h=s*s,p=c*a,x=3*s*c,T=3*h*a,R=h*s;return t[0]=e[0]*p+r[0]*x+i[0]*T+n[0]*R,t[1]=e[1]*p+r[1]*x+i[1]*T+n[1]*R,t[2]=e[2]*p+r[2]*x+i[2]*T+n[2]*R,t}function uee(t,e){e=e===void 0?1:e;let r=Ru()*2*Math.PI,i=Ru()*2-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t}function Kp(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[3]*i+r[7]*n+r[11]*s+r[15];return a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/a,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/a,t}function _1(t,e,r){let i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function y1(t,e,r){let i=r[0],n=r[1],s=r[2],a=r[3],c=e[0],h=e[1],p=e[2],x=n*p-s*h,T=s*c-i*p,R=i*h-n*c,k=n*R-s*T,j=s*x-i*R,q=i*T-n*x,X=a*2;return x*=X,T*=X,R*=X,k*=2,j*=2,q*=2,t[0]=c+x+k,t[1]=h+T+j,t[2]=p+R+q,t}function hI(t,e,r,i){let n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function fI(t,e,r,i){let n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function dI(t,e,r,i){let n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function pI(t,e){let r=t[0],i=t[1],n=t[2],s=e[0],a=e[1],c=e[2],h=Math.sqrt((r*r+i*i+n*n)*(s*s+a*a+c*c)),p=h&&g1(t,e)/h;return Math.acos(Math.min(Math.max(p,-1),1))}function hee(t){return t[0]=0,t[1]=0,t[2]=0,t}function fee(t){return`vec3(${t[0]}, ${t[1]}, ${t[2]})`}function dee(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function pee(t,e){let r=t[0],i=t[1],n=t[2],s=e[0],a=e[1],c=e[2];return Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-c)<=1e-6*Math.max(1,Math.abs(n),Math.abs(c))}var Aee=L8,mee=O8,gee=D8,_ee=F8,yee=k8,AI=B8,xee=N8,bee=function(){let t=iv();return function(e,r,i,n,s,a){let c,h;for(r||(r=3),i||(i=0),n?h=Math.min(n*r+i,e.length):h=e.length,c=i;c<h;c+=r)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],s(t,t,a),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2];return e}}();var mI=[0,0,0],sv,st=class t extends pd{static get ZERO(){return sv||(sv=new t(0,0,0),Object.freeze(sv)),sv}constructor(e=0,r=0,i=0){super(-0,-0,-0),arguments.length===1&&il(e)?this.copy(e):(On.debug&&(ki(e),ki(r),ki(i)),this[0]=e,this[1]=r,this[2]=i)}set(e,r,i){return this[0]=e,this[1]=r,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return On.debug&&(ki(e.x),ki(e.y),ki(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ki(e)}angle(e){return pI(this,e)}cross(e){return Yp(this,this,e),this.check()}rotateX({radians:e,origin:r=mI}){return hI(this,this,r,e),this.check()}rotateY({radians:e,origin:r=mI}){return fI(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=mI}){return dI(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Kp(this,this,e),this.check()}transformAsVector(e){return tv(this,this,e),this.check()}transformByMatrix3(e){return _1(this,this,e),this.check()}transformByMatrix2(e){return P8(this,this,e),this.check()}transformByQuaternion(e){return y1(this,this,e),this.check()}};var ov,av=class t extends pd{static get ZERO(){return ov||(ov=new t(0,0,0,0),Object.freeze(ov)),ov}constructor(e=0,r=0,i=0,n=0){super(-0,-0,-0,-0),il(e)&&arguments.length===1?this.copy(e):(On.debug&&(ki(e),ki(r),ki(i),ki(n)),this[0]=e,this[1]=r,this[2]=i,this[3]=n)}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return On.debug&&(ki(e.x),ki(e.y),ki(e.z),ki(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ki(e)}get w(){return this[3]}set w(e){this[3]=ki(e)}transform(e){return Kp(this,this,e),this.check()}transformByMatrix3(e){return rv(this,this,e),this.check()}transformByMatrix2(e){return R8(this,this,e),this.check()}transformByQuaternion(e){return y1(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}};var r0=class extends fd{toString(){let e="[";if(On.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,i){return this[r*this.RANK+e]=ki(i),this}getColumn(e,r=new Array(this.RANK).fill(-0)){let i=e*this.RANK;for(let n=0;n<this.RANK;++n)r[n]=this[i+n];return r}setColumn(e,r){let i=e*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=r[n];return this}};function z8(){let t=new Cn(9);return Cn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function U8(t,e){if(t===e){let r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function V8(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],c=e[5],h=e[6],p=e[7],x=e[8],T=x*a-c*p,R=-x*s+c*h,k=p*s-a*h,j=r*T+i*R+n*k;return j?(j=1/j,t[0]=T*j,t[1]=(-x*i+n*p)*j,t[2]=(c*i-n*a)*j,t[3]=R*j,t[4]=(x*r-n*h)*j,t[5]=(-c*r+n*s)*j,t[6]=k*j,t[7]=(-p*r+i*h)*j,t[8]=(a*r-i*s)*j,t):null}function j8(t){let e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],c=t[6],h=t[7],p=t[8];return e*(p*s-a*h)+r*(-p*n+a*c)+i*(h*n-s*c)}function gI(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=e[8],R=r[0],k=r[1],j=r[2],q=r[3],X=r[4],re=r[5],te=r[6],oe=r[7],ae=r[8];return t[0]=R*i+k*a+j*p,t[1]=R*n+k*c+j*x,t[2]=R*s+k*h+j*T,t[3]=q*i+X*a+re*p,t[4]=q*n+X*c+re*x,t[5]=q*s+X*h+re*T,t[6]=te*i+oe*a+ae*p,t[7]=te*n+oe*c+ae*x,t[8]=te*s+oe*h+ae*T,t}function G8(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=e[8],R=r[0],k=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=a,t[4]=c,t[5]=h,t[6]=R*i+k*a+p,t[7]=R*n+k*c+x,t[8]=R*s+k*h+T,t}function H8(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=e[8],R=Math.sin(r),k=Math.cos(r);return t[0]=k*i+R*a,t[1]=k*n+R*c,t[2]=k*s+R*h,t[3]=k*a-R*i,t[4]=k*c-R*n,t[5]=k*h-R*s,t[6]=p,t[7]=x,t[8]=T,t}function _I(t,e,r){let i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function W8(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r+r,c=i+i,h=n+n,p=r*a,x=i*a,T=i*c,R=n*a,k=n*c,j=n*h,q=s*a,X=s*c,re=s*h;return t[0]=1-T-j,t[3]=x-re,t[6]=R+X,t[1]=x+re,t[4]=1-p-j,t[7]=k-q,t[2]=R-X,t[5]=k+q,t[8]=1-p-T,t}var yI;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(yI||(yI={}));var vee=Object.freeze([1,0,0,0,1,0,0,0,1]),an=class extends r0{static get IDENTITY(){return Tee()}static get ZERO(){return wee()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return yI}constructor(e,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(vee)}fromObject(e){return this.check()}fromQuaternion(e){return W8(this,e),this.check()}set(e,r,i,n,s,a,c,h,p){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=a,this[6]=c,this[7]=h,this[8]=p,this.check()}setRowMajor(e,r,i,n,s,a,c,h,p){return this[0]=e,this[1]=n,this[2]=c,this[3]=r,this[4]=s,this[5]=h,this[6]=i,this[7]=a,this[8]=p,this.check()}determinant(){return j8(this)}transpose(){return U8(this,this),this.check()}invert(){return V8(this,this),this.check()}multiplyLeft(e){return gI(this,e,this),this.check()}multiplyRight(e){return gI(this,this,e),this.check()}rotate(e){return H8(this,this,e),this.check()}scale(e){return Array.isArray(e)?_I(this,this,e):_I(this,this,[e,e]),this.check()}translate(e){return G8(this,this,e),this.check()}transform(e,r){let i;switch(e.length){case 2:i=A1(r||[-0,-0],e,this);break;case 3:i=_1(r||[-0,-0,-0],e,this);break;case 4:i=rv(r||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return dd(i,e.length),i}transformVector(e,r){return this.transform(e,r)}transformVector2(e,r){return this.transform(e,r)}transformVector3(e,r){return this.transform(e,r)}},lv,cv=null;function wee(){return lv||(lv=new an([0,0,0,0,0,0,0,0,0]),Object.freeze(lv)),lv}function Tee(){return cv||(cv=new an,Object.freeze(cv)),cv}var Ms={};Es(Ms,{add:()=>Xee,adjoint:()=>Pee,clone:()=>Cee,copy:()=>See,create:()=>Eee,decompose:()=>Uee,determinant:()=>vI,equals:()=>Jee,exactEquals:()=>Qee,frob:()=>Zee,fromQuat:()=>MI,fromQuat2:()=>kee,fromRotation:()=>Lee,fromRotationTranslation:()=>Z8,fromRotationTranslationScale:()=>Vee,fromRotationTranslationScaleOrigin:()=>jee,fromScaling:()=>Bee,fromTranslation:()=>Ree,fromValues:()=>Iee,fromXRotation:()=>Oee,fromYRotation:()=>Dee,fromZRotation:()=>Fee,frustum:()=>PI,getRotation:()=>zee,getScaling:()=>X8,getTranslation:()=>Nee,identity:()=>q8,invert:()=>bI,lookAt:()=>LI,mul:()=>ete,multiply:()=>x1,multiplyScalar:()=>Yee,multiplyScalarAndAdd:()=>Kee,ortho:()=>BI,orthoNO:()=>K8,orthoZO:()=>Wee,perspective:()=>RI,perspectiveFromFieldOfView:()=>Hee,perspectiveNO:()=>Y8,perspectiveZO:()=>Gee,rotate:()=>EI,rotateX:()=>CI,rotateY:()=>SI,rotateZ:()=>II,scale:()=>TI,set:()=>Mee,str:()=>qee,sub:()=>tte,subtract:()=>Q8,targetTo:()=>$ee,translate:()=>wI,transpose:()=>xI});function Eee(){let t=new Cn(16);return Cn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Cee(t){let e=new Cn(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function See(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Iee(t,e,r,i,n,s,a,c,h,p,x,T,R,k,j,q){let X=new Cn(16);return X[0]=t,X[1]=e,X[2]=r,X[3]=i,X[4]=n,X[5]=s,X[6]=a,X[7]=c,X[8]=h,X[9]=p,X[10]=x,X[11]=T,X[12]=R,X[13]=k,X[14]=j,X[15]=q,X}function Mee(t,e,r,i,n,s,a,c,h,p,x,T,R,k,j,q,X){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=a,t[6]=c,t[7]=h,t[8]=p,t[9]=x,t[10]=T,t[11]=R,t[12]=k,t[13]=j,t[14]=q,t[15]=X,t}function q8(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xI(t,e){if(t===e){let r=e[1],i=e[2],n=e[3],s=e[6],a=e[7],c=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=a,t[14]=c}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function bI(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],c=e[5],h=e[6],p=e[7],x=e[8],T=e[9],R=e[10],k=e[11],j=e[12],q=e[13],X=e[14],re=e[15],te=r*c-i*a,oe=r*h-n*a,ae=r*p-s*a,pe=i*h-n*c,be=i*p-s*c,Fe=n*p-s*h,Y=x*q-T*j,J=x*X-R*j,Z=x*re-k*j,xe=T*X-R*q,_e=T*re-k*q,Be=R*re-k*X,Se=te*Be-oe*_e+ae*xe+pe*Z-be*J+Fe*Y;return Se?(Se=1/Se,t[0]=(c*Be-h*_e+p*xe)*Se,t[1]=(n*_e-i*Be-s*xe)*Se,t[2]=(q*Fe-X*be+re*pe)*Se,t[3]=(R*be-T*Fe-k*pe)*Se,t[4]=(h*Z-a*Be-p*J)*Se,t[5]=(r*Be-n*Z+s*J)*Se,t[6]=(X*ae-j*Fe-re*oe)*Se,t[7]=(x*Fe-R*ae+k*oe)*Se,t[8]=(a*_e-c*Z+p*Y)*Se,t[9]=(i*Z-r*_e-s*Y)*Se,t[10]=(j*be-q*ae+re*te)*Se,t[11]=(T*ae-x*be-k*te)*Se,t[12]=(c*J-a*xe-h*Y)*Se,t[13]=(r*xe-i*J+n*Y)*Se,t[14]=(q*oe-j*pe-X*te)*Se,t[15]=(x*pe-T*oe+R*te)*Se,t):null}function Pee(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],c=e[5],h=e[6],p=e[7],x=e[8],T=e[9],R=e[10],k=e[11],j=e[12],q=e[13],X=e[14],re=e[15],te=r*c-i*a,oe=r*h-n*a,ae=r*p-s*a,pe=i*h-n*c,be=i*p-s*c,Fe=n*p-s*h,Y=x*q-T*j,J=x*X-R*j,Z=x*re-k*j,xe=T*X-R*q,_e=T*re-k*q,Be=R*re-k*X;return t[0]=c*Be-h*_e+p*xe,t[1]=n*_e-i*Be-s*xe,t[2]=q*Fe-X*be+re*pe,t[3]=R*be-T*Fe-k*pe,t[4]=h*Z-a*Be-p*J,t[5]=r*Be-n*Z+s*J,t[6]=X*ae-j*Fe-re*oe,t[7]=x*Fe-R*ae+k*oe,t[8]=a*_e-c*Z+p*Y,t[9]=i*Z-r*_e-s*Y,t[10]=j*be-q*ae+re*te,t[11]=T*ae-x*be-k*te,t[12]=c*J-a*xe-h*Y,t[13]=r*xe-i*J+n*Y,t[14]=q*oe-j*pe-X*te,t[15]=x*pe-T*oe+R*te,t}function vI(t){let e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],c=t[6],h=t[7],p=t[8],x=t[9],T=t[10],R=t[11],k=t[12],j=t[13],q=t[14],X=t[15],re=e*a-r*s,te=e*c-i*s,oe=r*c-i*a,ae=p*j-x*k,pe=p*q-T*k,be=x*q-T*j,Fe=e*be-r*pe+i*ae,Y=s*be-a*pe+c*ae,J=p*oe-x*te+T*re,Z=k*oe-j*te+q*re;return h*Fe-n*Y+X*J-R*Z}function x1(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=e[8],R=e[9],k=e[10],j=e[11],q=e[12],X=e[13],re=e[14],te=e[15],oe=r[0],ae=r[1],pe=r[2],be=r[3];return t[0]=oe*i+ae*c+pe*T+be*q,t[1]=oe*n+ae*h+pe*R+be*X,t[2]=oe*s+ae*p+pe*k+be*re,t[3]=oe*a+ae*x+pe*j+be*te,oe=r[4],ae=r[5],pe=r[6],be=r[7],t[4]=oe*i+ae*c+pe*T+be*q,t[5]=oe*n+ae*h+pe*R+be*X,t[6]=oe*s+ae*p+pe*k+be*re,t[7]=oe*a+ae*x+pe*j+be*te,oe=r[8],ae=r[9],pe=r[10],be=r[11],t[8]=oe*i+ae*c+pe*T+be*q,t[9]=oe*n+ae*h+pe*R+be*X,t[10]=oe*s+ae*p+pe*k+be*re,t[11]=oe*a+ae*x+pe*j+be*te,oe=r[12],ae=r[13],pe=r[14],be=r[15],t[12]=oe*i+ae*c+pe*T+be*q,t[13]=oe*n+ae*h+pe*R+be*X,t[14]=oe*s+ae*p+pe*k+be*re,t[15]=oe*a+ae*x+pe*j+be*te,t}function wI(t,e,r){let i=r[0],n=r[1],s=r[2],a,c,h,p,x,T,R,k,j,q,X,re;return e===t?(t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15]):(a=e[0],c=e[1],h=e[2],p=e[3],x=e[4],T=e[5],R=e[6],k=e[7],j=e[8],q=e[9],X=e[10],re=e[11],t[0]=a,t[1]=c,t[2]=h,t[3]=p,t[4]=x,t[5]=T,t[6]=R,t[7]=k,t[8]=j,t[9]=q,t[10]=X,t[11]=re,t[12]=a*i+x*n+j*s+e[12],t[13]=c*i+T*n+q*s+e[13],t[14]=h*i+R*n+X*s+e[14],t[15]=p*i+k*n+re*s+e[15]),t}function TI(t,e,r){let i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function EI(t,e,r,i){let n=i[0],s=i[1],a=i[2],c=Math.sqrt(n*n+s*s+a*a),h,p,x,T,R,k,j,q,X,re,te,oe,ae,pe,be,Fe,Y,J,Z,xe,_e,Be,Se,ke;return c<1e-6?null:(c=1/c,n*=c,s*=c,a*=c,p=Math.sin(r),h=Math.cos(r),x=1-h,T=e[0],R=e[1],k=e[2],j=e[3],q=e[4],X=e[5],re=e[6],te=e[7],oe=e[8],ae=e[9],pe=e[10],be=e[11],Fe=n*n*x+h,Y=s*n*x+a*p,J=a*n*x-s*p,Z=n*s*x-a*p,xe=s*s*x+h,_e=a*s*x+n*p,Be=n*a*x+s*p,Se=s*a*x-n*p,ke=a*a*x+h,t[0]=T*Fe+q*Y+oe*J,t[1]=R*Fe+X*Y+ae*J,t[2]=k*Fe+re*Y+pe*J,t[3]=j*Fe+te*Y+be*J,t[4]=T*Z+q*xe+oe*_e,t[5]=R*Z+X*xe+ae*_e,t[6]=k*Z+re*xe+pe*_e,t[7]=j*Z+te*xe+be*_e,t[8]=T*Be+q*Se+oe*ke,t[9]=R*Be+X*Se+ae*ke,t[10]=k*Be+re*Se+pe*ke,t[11]=j*Be+te*Se+be*ke,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function CI(t,e,r){let i=Math.sin(r),n=Math.cos(r),s=e[4],a=e[5],c=e[6],h=e[7],p=e[8],x=e[9],T=e[10],R=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+p*i,t[5]=a*n+x*i,t[6]=c*n+T*i,t[7]=h*n+R*i,t[8]=p*n-s*i,t[9]=x*n-a*i,t[10]=T*n-c*i,t[11]=R*n-h*i,t}function SI(t,e,r){let i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],c=e[2],h=e[3],p=e[8],x=e[9],T=e[10],R=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-p*i,t[1]=a*n-x*i,t[2]=c*n-T*i,t[3]=h*n-R*i,t[8]=s*i+p*n,t[9]=a*i+x*n,t[10]=c*i+T*n,t[11]=h*i+R*n,t}function II(t,e,r){let i=Math.sin(r),n=Math.cos(r),s=e[0],a=e[1],c=e[2],h=e[3],p=e[4],x=e[5],T=e[6],R=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+p*i,t[1]=a*n+x*i,t[2]=c*n+T*i,t[3]=h*n+R*i,t[4]=p*n-s*i,t[5]=x*n-a*i,t[6]=T*n-c*i,t[7]=R*n-h*i,t}function Ree(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Bee(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lee(t,e,r){let i=r[0],n=r[1],s=r[2],a=Math.sqrt(i*i+n*n+s*s),c,h,p;return a<1e-6?null:(a=1/a,i*=a,n*=a,s*=a,h=Math.sin(e),c=Math.cos(e),p=1-c,t[0]=i*i*p+c,t[1]=n*i*p+s*h,t[2]=s*i*p-n*h,t[3]=0,t[4]=i*n*p-s*h,t[5]=n*n*p+c,t[6]=s*n*p+i*h,t[7]=0,t[8]=i*s*p+n*h,t[9]=n*s*p-i*h,t[10]=s*s*p+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Oee(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Dee(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Fee(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Z8(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],c=i+i,h=n+n,p=s+s,x=i*c,T=i*h,R=i*p,k=n*h,j=n*p,q=s*p,X=a*c,re=a*h,te=a*p;return t[0]=1-(k+q),t[1]=T+te,t[2]=R-re,t[3]=0,t[4]=T-te,t[5]=1-(x+q),t[6]=j+X,t[7]=0,t[8]=R+re,t[9]=j-X,t[10]=1-(x+k),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function kee(t,e){let r=new Cn(3),i=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=i*i+n*n+s*s+a*a;return T>0?(r[0]=(c*a+x*i+h*s-p*n)*2/T,r[1]=(h*a+x*n+p*i-c*s)*2/T,r[2]=(p*a+x*s+c*n-h*i)*2/T):(r[0]=(c*a+x*i+h*s-p*n)*2,r[1]=(h*a+x*n+p*i-c*s)*2,r[2]=(p*a+x*s+c*n-h*i)*2),Z8(t,e,r),t}function Nee(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function X8(t,e){let r=e[0],i=e[1],n=e[2],s=e[4],a=e[5],c=e[6],h=e[8],p=e[9],x=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+a*a+c*c),t[2]=Math.sqrt(h*h+p*p+x*x),t}function zee(t,e){let r=new Cn(3);X8(r,e);let i=1/r[0],n=1/r[1],s=1/r[2],a=e[0]*i,c=e[1]*n,h=e[2]*s,p=e[4]*i,x=e[5]*n,T=e[6]*s,R=e[8]*i,k=e[9]*n,j=e[10]*s,q=a+x+j,X=0;return q>0?(X=Math.sqrt(q+1)*2,t[3]=.25*X,t[0]=(T-k)/X,t[1]=(R-h)/X,t[2]=(c-p)/X):a>x&&a>j?(X=Math.sqrt(1+a-x-j)*2,t[3]=(T-k)/X,t[0]=.25*X,t[1]=(c+p)/X,t[2]=(R+h)/X):x>j?(X=Math.sqrt(1+x-a-j)*2,t[3]=(R-h)/X,t[0]=(c+p)/X,t[1]=.25*X,t[2]=(T+k)/X):(X=Math.sqrt(1+j-a-x)*2,t[3]=(c-p)/X,t[0]=(R+h)/X,t[1]=(T+k)/X,t[2]=.25*X),t}function Uee(t,e,r,i){e[0]=i[12],e[1]=i[13],e[2]=i[14];let n=i[0],s=i[1],a=i[2],c=i[4],h=i[5],p=i[6],x=i[8],T=i[9],R=i[10];r[0]=Math.sqrt(n*n+s*s+a*a),r[1]=Math.sqrt(c*c+h*h+p*p),r[2]=Math.sqrt(x*x+T*T+R*R);let k=1/r[0],j=1/r[1],q=1/r[2],X=n*k,re=s*j,te=a*q,oe=c*k,ae=h*j,pe=p*q,be=x*k,Fe=T*j,Y=R*q,J=X+ae+Y,Z=0;return J>0?(Z=Math.sqrt(J+1)*2,t[3]=.25*Z,t[0]=(pe-Fe)/Z,t[1]=(be-te)/Z,t[2]=(re-oe)/Z):X>ae&&X>Y?(Z=Math.sqrt(1+X-ae-Y)*2,t[3]=(pe-Fe)/Z,t[0]=.25*Z,t[1]=(re+oe)/Z,t[2]=(be+te)/Z):ae>Y?(Z=Math.sqrt(1+ae-X-Y)*2,t[3]=(be-te)/Z,t[0]=(re+oe)/Z,t[1]=.25*Z,t[2]=(pe+Fe)/Z):(Z=Math.sqrt(1+Y-X-ae)*2,t[3]=(re-oe)/Z,t[0]=(be+te)/Z,t[1]=(pe+Fe)/Z,t[2]=.25*Z),t}function Vee(t,e,r,i){let n=e[0],s=e[1],a=e[2],c=e[3],h=n+n,p=s+s,x=a+a,T=n*h,R=n*p,k=n*x,j=s*p,q=s*x,X=a*x,re=c*h,te=c*p,oe=c*x,ae=i[0],pe=i[1],be=i[2];return t[0]=(1-(j+X))*ae,t[1]=(R+oe)*ae,t[2]=(k-te)*ae,t[3]=0,t[4]=(R-oe)*pe,t[5]=(1-(T+X))*pe,t[6]=(q+re)*pe,t[7]=0,t[8]=(k+te)*be,t[9]=(q-re)*be,t[10]=(1-(T+j))*be,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function jee(t,e,r,i,n){let s=e[0],a=e[1],c=e[2],h=e[3],p=s+s,x=a+a,T=c+c,R=s*p,k=s*x,j=s*T,q=a*x,X=a*T,re=c*T,te=h*p,oe=h*x,ae=h*T,pe=i[0],be=i[1],Fe=i[2],Y=n[0],J=n[1],Z=n[2],xe=(1-(q+re))*pe,_e=(k+ae)*pe,Be=(j-oe)*pe,Se=(k-ae)*be,ke=(1-(R+re))*be,Ye=(X+te)*be,rt=(j+oe)*Fe,tt=(X-te)*Fe,_t=(1-(R+q))*Fe;return t[0]=xe,t[1]=_e,t[2]=Be,t[3]=0,t[4]=Se,t[5]=ke,t[6]=Ye,t[7]=0,t[8]=rt,t[9]=tt,t[10]=_t,t[11]=0,t[12]=r[0]+Y-(xe*Y+Se*J+rt*Z),t[13]=r[1]+J-(_e*Y+ke*J+tt*Z),t[14]=r[2]+Z-(Be*Y+Ye*J+_t*Z),t[15]=1,t}function MI(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r+r,c=i+i,h=n+n,p=r*a,x=i*a,T=i*c,R=n*a,k=n*c,j=n*h,q=s*a,X=s*c,re=s*h;return t[0]=1-T-j,t[1]=x+re,t[2]=R-X,t[3]=0,t[4]=x-re,t[5]=1-p-j,t[6]=k+q,t[7]=0,t[8]=R+X,t[9]=k-q,t[10]=1-p-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function PI(t,e,r,i,n,s,a){let c=1/(r-e),h=1/(n-i),p=1/(s-a);return t[0]=s*2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*h,t[6]=0,t[7]=0,t[8]=(r+e)*c,t[9]=(n+i)*h,t[10]=(a+s)*p,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*p,t[15]=0,t}function Y8(t,e,r,i,n){let s=1/Math.tan(e/2);if(t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){let a=1/(i-n);t[10]=(n+i)*a,t[14]=2*n*i*a}else t[10]=-1,t[14]=-2*i;return t}var RI=Y8;function Gee(t,e,r,i,n){let s=1/Math.tan(e/2);if(t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){let a=1/(i-n);t[10]=n*a,t[14]=n*i*a}else t[10]=-1,t[14]=-i;return t}function Hee(t,e,r,i){let n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),h=2/(a+c),p=2/(n+s);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=-((a-c)*h*.5),t[9]=(n-s)*p*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function K8(t,e,r,i,n,s,a){let c=1/(e-r),h=1/(i-n),p=1/(s-a);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+r)*c,t[13]=(n+i)*h,t[14]=(a+s)*p,t[15]=1,t}var BI=K8;function Wee(t,e,r,i,n,s,a){let c=1/(e-r),h=1/(i-n),p=1/(s-a);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=p,t[11]=0,t[12]=(e+r)*c,t[13]=(n+i)*h,t[14]=s*p,t[15]=1,t}function LI(t,e,r,i){let n,s,a,c,h,p,x,T,R,k,j=e[0],q=e[1],X=e[2],re=i[0],te=i[1],oe=i[2],ae=r[0],pe=r[1],be=r[2];return Math.abs(j-ae)<1e-6&&Math.abs(q-pe)<1e-6&&Math.abs(X-be)<1e-6?q8(t):(T=j-ae,R=q-pe,k=X-be,n=1/Math.sqrt(T*T+R*R+k*k),T*=n,R*=n,k*=n,s=te*k-oe*R,a=oe*T-re*k,c=re*R-te*T,n=Math.sqrt(s*s+a*a+c*c),n?(n=1/n,s*=n,a*=n,c*=n):(s=0,a=0,c=0),h=R*c-k*a,p=k*s-T*c,x=T*a-R*s,n=Math.sqrt(h*h+p*p+x*x),n?(n=1/n,h*=n,p*=n,x*=n):(h=0,p=0,x=0),t[0]=s,t[1]=h,t[2]=T,t[3]=0,t[4]=a,t[5]=p,t[6]=R,t[7]=0,t[8]=c,t[9]=x,t[10]=k,t[11]=0,t[12]=-(s*j+a*q+c*X),t[13]=-(h*j+p*q+x*X),t[14]=-(T*j+R*q+k*X),t[15]=1,t)}function $ee(t,e,r,i){let n=e[0],s=e[1],a=e[2],c=i[0],h=i[1],p=i[2],x=n-r[0],T=s-r[1],R=a-r[2],k=x*x+T*T+R*R;k>0&&(k=1/Math.sqrt(k),x*=k,T*=k,R*=k);let j=h*R-p*T,q=p*x-c*R,X=c*T-h*x;return k=j*j+q*q+X*X,k>0&&(k=1/Math.sqrt(k),j*=k,q*=k,X*=k),t[0]=j,t[1]=q,t[2]=X,t[3]=0,t[4]=T*X-R*q,t[5]=R*j-x*X,t[6]=x*q-T*j,t[7]=0,t[8]=x,t[9]=T,t[10]=R,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1,t}function qee(t){return`mat4(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}, ${t[4]}, ${t[5]}, ${t[6]}, ${t[7]}, ${t[8]}, ${t[9]}, ${t[10]}, ${t[11]}, ${t[12]}, ${t[13]}, ${t[14]}, ${t[15]})`}function Zee(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+t[6]*t[6]+t[7]*t[7]+t[8]*t[8]+t[9]*t[9]+t[10]*t[10]+t[11]*t[11]+t[12]*t[12]+t[13]*t[13]+t[14]*t[14]+t[15]*t[15])}function Xee(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Q8(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Yee(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Kee(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function Qee(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Jee(t,e){let r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],c=t[5],h=t[6],p=t[7],x=t[8],T=t[9],R=t[10],k=t[11],j=t[12],q=t[13],X=t[14],re=t[15],te=e[0],oe=e[1],ae=e[2],pe=e[3],be=e[4],Fe=e[5],Y=e[6],J=e[7],Z=e[8],xe=e[9],_e=e[10],Be=e[11],Se=e[12],ke=e[13],Ye=e[14],rt=e[15];return Math.abs(r-te)<=1e-6*Math.max(1,Math.abs(r),Math.abs(te))&&Math.abs(i-oe)<=1e-6*Math.max(1,Math.abs(i),Math.abs(oe))&&Math.abs(n-ae)<=1e-6*Math.max(1,Math.abs(n),Math.abs(ae))&&Math.abs(s-pe)<=1e-6*Math.max(1,Math.abs(s),Math.abs(pe))&&Math.abs(a-be)<=1e-6*Math.max(1,Math.abs(a),Math.abs(be))&&Math.abs(c-Fe)<=1e-6*Math.max(1,Math.abs(c),Math.abs(Fe))&&Math.abs(h-Y)<=1e-6*Math.max(1,Math.abs(h),Math.abs(Y))&&Math.abs(p-J)<=1e-6*Math.max(1,Math.abs(p),Math.abs(J))&&Math.abs(x-Z)<=1e-6*Math.max(1,Math.abs(x),Math.abs(Z))&&Math.abs(T-xe)<=1e-6*Math.max(1,Math.abs(T),Math.abs(xe))&&Math.abs(R-_e)<=1e-6*Math.max(1,Math.abs(R),Math.abs(_e))&&Math.abs(k-Be)<=1e-6*Math.max(1,Math.abs(k),Math.abs(Be))&&Math.abs(j-Se)<=1e-6*Math.max(1,Math.abs(j),Math.abs(Se))&&Math.abs(q-ke)<=1e-6*Math.max(1,Math.abs(q),Math.abs(ke))&&Math.abs(X-Ye)<=1e-6*Math.max(1,Math.abs(X),Math.abs(Ye))&&Math.abs(re-rt)<=1e-6*Math.max(1,Math.abs(re),Math.abs(rt))}var ete=x1,tte=Q8;var Pa={};Es(Pa,{add:()=>OI,ceil:()=>rte,clone:()=>eD,copy:()=>rD,create:()=>J8,cross:()=>ute,dist:()=>_te,distance:()=>aD,div:()=>gte,divide:()=>oD,dot:()=>kI,equals:()=>pte,exactEquals:()=>cD,floor:()=>ite,forEach:()=>vte,fromValues:()=>tD,inverse:()=>cte,len:()=>xte,length:()=>uv,lerp:()=>NI,max:()=>ste,min:()=>nte,mul:()=>mte,multiply:()=>sD,negate:()=>lte,normalize:()=>FI,random:()=>hte,round:()=>ote,scale:()=>DI,scaleAndAdd:()=>ate,set:()=>iD,sqrDist:()=>yte,sqrLen:()=>bte,squaredDistance:()=>lD,squaredLength:()=>hv,str:()=>dte,sub:()=>Ate,subtract:()=>nD,transformMat4:()=>zI,transformQuat:()=>UI,zero:()=>fte});function J8(){let t=new Cn(4);return Cn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function eD(t){let e=new Cn(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function tD(t,e,r,i){let n=new Cn(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function rD(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function iD(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function OI(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function nD(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function sD(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function oD(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function rte(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function ite(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function nte(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function ste(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function ote(t,e){return t[0]=Pl(e[0]),t[1]=Pl(e[1]),t[2]=Pl(e[2]),t[3]=Pl(e[3]),t}function DI(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function ate(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function aD(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function lD(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function uv(t){let e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function hv(t){let e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function lte(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function cte(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function FI(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=s*a,t}function kI(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function ute(t,e,r,i){let n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],c=r[1]*i[2]-r[2]*i[1],h=r[1]*i[3]-r[3]*i[1],p=r[2]*i[3]-r[3]*i[2],x=e[0],T=e[1],R=e[2],k=e[3];return t[0]=T*p-R*h+k*c,t[1]=-(x*p)+R*a-k*s,t[2]=x*h-T*a+k*n,t[3]=-(x*c)+T*s-R*n,t}function NI(t,e,r,i){let n=e[0],s=e[1],a=e[2],c=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=a+i*(r[2]-a),t[3]=c+i*(r[3]-c),t}function hte(t,e){e=e===void 0?1:e;let r,i,n,s,a,c;do r=Ru()*2-1,i=Ru()*2-1,a=r*r+i*i;while(a>=1);do n=Ru()*2-1,s=Ru()*2-1,c=n*n+s*s;while(c>=1);let h=Math.sqrt((1-a)/c);return t[0]=e*r,t[1]=e*i,t[2]=e*n*h,t[3]=e*s*h,t}function zI(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,t}function UI(t,e,r){let i=e[0],n=e[1],s=e[2],a=r[0],c=r[1],h=r[2],p=r[3],x=p*i+c*s-h*n,T=p*n+h*i-a*s,R=p*s+a*n-c*i,k=-a*i-c*n-h*s;return t[0]=x*p+k*-a+T*-h-R*-c,t[1]=T*p+k*-c+R*-a-x*-h,t[2]=R*p+k*-h+x*-c-T*-a,t[3]=e[3],t}function fte(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function dte(t){return`vec4(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}function cD(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function pte(t,e){let r=t[0],i=t[1],n=t[2],s=t[3],a=e[0],c=e[1],h=e[2],p=e[3];return Math.abs(r-a)<=1e-6*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-c)<=1e-6*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-h)<=1e-6*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-p)<=1e-6*Math.max(1,Math.abs(s),Math.abs(p))}var Ate=nD,mte=sD,gte=oD,_te=aD,yte=lD,xte=uv,bte=hv,vte=function(){let t=J8();return function(e,r,i,n,s,a){let c,h;for(r||(r=4),i||(i=0),n?h=Math.min(n*r+i,e.length):h=e.length,c=i;c<h;c+=r)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],t[3]=e[c+3],s(t,t,a),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2],e[c+3]=t[3];return e}}();var GI;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(GI||(GI={}));var wte=45*Math.PI/180,Tte=1,VI=.1,jI=500,Ete=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Er=class extends r0{static get IDENTITY(){return Ste()}static get ZERO(){return Cte()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return GI}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,i,n,s,a,c,h,p,x,T,R,k,j,q,X){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=a,this[6]=c,this[7]=h,this[8]=p,this[9]=x,this[10]=T,this[11]=R,this[12]=k,this[13]=j,this[14]=q,this[15]=X,this.check()}setRowMajor(e,r,i,n,s,a,c,h,p,x,T,R,k,j,q,X){return this[0]=e,this[1]=s,this[2]=p,this[3]=k,this[4]=r,this[5]=a,this[6]=x,this[7]=j,this[8]=i,this[9]=c,this[10]=T,this[11]=q,this[12]=n,this[13]=h,this[14]=R,this[15]=X,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Ete)}fromObject(e){return this.check()}fromQuaternion(e){return MI(this,e),this.check()}frustum(e){let{left:r,right:i,bottom:n,top:s,near:a=VI,far:c=jI}=e;return c===1/0?Ite(this,r,i,n,s,a):PI(this,r,i,n,s,a,c),this.check()}lookAt(e){let{eye:r,center:i=[0,0,0],up:n=[0,1,0]}=e;return LI(this,r,i,n),this.check()}ortho(e){let{left:r,right:i,bottom:n,top:s,near:a=VI,far:c=jI}=e;return BI(this,r,i,n,s,a,c),this.check()}orthographic(e){let{fovy:r=wte,aspect:i=Tte,focalDistance:n=1,near:s=VI,far:a=jI}=e;uD(r);let c=r/2,h=n*Math.tan(c),p=h*i;return this.ortho({left:-p,right:p,bottom:-h,top:h,near:s,far:a})}perspective(e){let{fovy:r=45*Math.PI/180,aspect:i=1,near:n=.1,far:s=500}=e;return uD(r),RI(this,r,i,n,s),this.check()}determinant(){return vI(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let i=this.getScale(r),n=1/i[0],s=1/i[1],a=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let i=this.getScale(r),n=1/i[0],s=1/i[1],a=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*n,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*n,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return xI(this,this),this.check()}invert(){return bI(this,this),this.check()}multiplyLeft(e){return x1(this,e,this),this.check()}multiplyRight(e){return x1(this,this,e),this.check()}rotateX(e){return CI(this,this,e),this.check()}rotateY(e){return SI(this,this,e),this.check()}rotateZ(e){return II(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return EI(this,this,e,r),this.check()}scale(e){return TI(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return wI(this,this,e),this.check()}transform(e,r){return e.length===4?(r=zI(r||[-0,-0,-0,-0],e,this),dd(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){let{length:i}=e,n;switch(i){case 2:n=m1(r||[-0,-0],e,this);break;case 3:n=Kp(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return dd(n,e.length),n}transformAsVector(e,r){let i;switch(e.length){case 2:i=ev(r||[-0,-0],e,this);break;case 3:i=tv(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return dd(i,e.length),i}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,i){return this.identity().translate([e,r,i])}},fv,dv;function Cte(){return fv||(fv=new Er([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(fv)),fv}function Ste(){return dv||(dv=new Er,Object.freeze(dv)),dv}function uD(t){if(t>Math.PI*2)throw Error("expected radians")}function Ite(t,e,r,i,n,s){let a=2*s/(r-e),c=2*s/(n-i),h=(r+e)/(r-e),p=(n+i)/(n-i),x=-1,T=-1,R=-2*s;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=h,t[9]=p,t[10]=x,t[11]=T,t[12]=0,t[13]=0,t[14]=R,t[15]=0,t}function hD(){let t=new Cn(4);return Cn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function fD(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function HI(t,e,r){r=r*.5;let i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function WI(t,e,r){let i=e[0],n=e[1],s=e[2],a=e[3],c=r[0],h=r[1],p=r[2],x=r[3];return t[0]=i*x+a*c+n*p-s*h,t[1]=n*x+a*h+s*c-i*p,t[2]=s*x+a*p+i*h-n*c,t[3]=a*x-i*c-n*h-s*p,t}function dD(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+a*c,t[1]=n*h+s*c,t[2]=s*h-n*c,t[3]=a*h-i*c,t}function pD(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h-s*c,t[1]=n*h+a*c,t[2]=s*h+i*c,t[3]=a*h-n*c,t}function AD(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*c,t[1]=n*h-i*c,t[2]=s*h+a*c,t[3]=a*h-s*c,t}function mD(t,e){let r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function b1(t,e,r,i){let n=e[0],s=e[1],a=e[2],c=e[3],h=r[0],p=r[1],x=r[2],T=r[3],R,k,j,q,X;return R=n*h+s*p+a*x+c*T,R<0&&(R=-R,h=-h,p=-p,x=-x,T=-T),1-R>1e-6?(k=Math.acos(R),X=Math.sin(k),j=Math.sin((1-i)*k)/X,q=Math.sin(i*k)/X):(j=1-i,q=i),t[0]=j*n+q*h,t[1]=j*s+q*p,t[2]=j*a+q*x,t[3]=j*c+q*T,t}function gD(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],a=r*r+i*i+n*n+s*s,c=a?1/a:0;return t[0]=-r*c,t[1]=-i*c,t[2]=-n*c,t[3]=s*c,t}function _D(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function $I(t,e){let r=e[0]+e[4]+e[8],i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);let s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[s*3+s]-e[a*3+a]+1),t[n]=.5*i,i=.5/i,t[3]=(e[s*3+a]-e[a*3+s])*i,t[s]=(e[s*3+n]+e[n*3+s])*i,t[a]=(e[a*3+n]+e[n*3+a])*i}return t}var yD=OI;var xD=DI,bD=kI,vD=NI,wD=uv;var TD=hv;var ED=FI;var CD=function(){let t=iv(),e=nv(1,0,0),r=nv(0,1,0);return function(i,n,s){let a=g1(n,s);return a<-.999999?(Yp(t,e,n),AI(t)<1e-6&&Yp(t,r,n),uI(t,t),HI(i,t,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Yp(t,n,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+a,ED(i,i))}}(),oCe=function(){let t=hD(),e=hD();return function(r,i,n,s,a,c){return b1(t,i,a,c),b1(e,n,s,c),b1(r,t,e,2*c*(1-c)),r}}(),aCe=function(){let t=z8();return function(e,r,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],ED(e,$I(e,t))}}();var Pte=[0,0,0,1],Rl=class extends fd{constructor(e=0,r=0,i=0,n=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,r,i,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return $I(this,e),this.check()}fromAxisRotation(e,r){return HI(this,e,r),this.check()}identity(){return fD(this),this.check()}setAxisAngle(e,r){return this.fromAxisRotation(e,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ki(e)}get y(){return this[1]}set y(e){this[1]=ki(e)}get z(){return this[2]}set z(e){this[2]=ki(e)}get w(){return this[3]}set w(e){this[3]=ki(e)}len(){return wD(this)}lengthSquared(){return TD(this)}dot(e){return bD(this,e)}rotationTo(e,r){return CD(this,e,r),this.check()}add(e){return yD(this,this,e),this.check()}calculateW(){return mD(this,this),this.check()}conjugate(){return _D(this,this),this.check()}invert(){return gD(this,this),this.check()}lerp(e,r,i){return i===void 0?this.lerp(this,e,r):(vD(this,e,r,i),this.check())}multiplyRight(e){return WI(this,this,e),this.check()}multiplyLeft(e){return WI(this,e,this),this.check()}normalize(){let e=this.len(),r=e>0?1/e:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,e===0&&(this[3]=1),this.check()}rotateX(e){return dD(this,this,e),this.check()}rotateY(e){return pD(this,this,e),this.check()}rotateZ(e){return AD(this,this,e),this.check()}scale(e){return xD(this,this,e),this.check()}slerp(e,r,i){let n,s,a;switch(arguments.length){case 1:({start:n=Pte,target:s,ratio:a}=e);break;case 2:n=this,s=e,a=r;break;default:n=e,s=r,a=i}return b1(this,n,s,a),this.check()}transformVector4(e,r=new av){return UI(r,e,this),dd(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,r){return this.setAxisAngle(e,r)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}};var Cc={};Es(Cc,{EPSILON1:()=>Rte,EPSILON10:()=>Ute,EPSILON11:()=>Vte,EPSILON12:()=>jte,EPSILON13:()=>Gte,EPSILON14:()=>Hte,EPSILON15:()=>Wte,EPSILON16:()=>$te,EPSILON17:()=>qte,EPSILON18:()=>Zte,EPSILON19:()=>Xte,EPSILON2:()=>Bte,EPSILON20:()=>Yte,EPSILON3:()=>Lte,EPSILON4:()=>Ote,EPSILON5:()=>Dte,EPSILON6:()=>Fte,EPSILON7:()=>kte,EPSILON8:()=>Nte,EPSILON9:()=>zte,PI_OVER_FOUR:()=>Qte,PI_OVER_SIX:()=>Jte,PI_OVER_TWO:()=>Kte,TWO_PI:()=>ere});var Rte=.1,Bte=.01,Lte=.001,Ote=1e-4,Dte=1e-5,Fte=1e-6,kte=1e-7,Nte=1e-8,zte=1e-9,Ute=1e-10,Vte=1e-11,jte=1e-12,Gte=1e-13,Hte=1e-14,Wte=1e-15,$te=1e-16,qte=1e-17,Zte=1e-18,Xte=1e-19,Yte=1e-20,Kte=Math.PI/2,Qte=Math.PI/4,Jte=Math.PI/6,ere=Math.PI*2;function qI(t,e=[],r=0){let i=Math.fround(t),n=t-i;return e[r]=i,e[r+1]=n,e}function SD(t){return t-Math.fround(t)}function ID(t){let e=new Float32Array(32);for(let r=0;r<4;++r)for(let i=0;i<4;++i){let n=r*4+i;qI(t[i*4+r],e,n*2)}return e}var tre=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,ZI={name:"fp32",vs:tre};var MD=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var rre={ONE:1},XI={name:"fp64arithmetic",vs:MD,defaultUniforms:rre,uniformTypes:{ONE:"f32"},fp64ify:qI,fp64LowPart:SD,fp64ifyMatrix4:ID};var ire=[0,1,1,1],nre=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,sre=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,pv={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:ire},vs:nre,fs:sre,getUniforms:ore};function ore(t={},e){let r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;let i=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=i}if(t.highlightColor){let i=Array.from(t.highlightColor,n=>n/255);Number.isFinite(i[3])||(i[3]=1),r.highlightColor=i}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}var YI=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`;var PD=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;var RD=3,are=255,v1;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(v1||(v1={}));var Uh={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:RD},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:v1.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:PD,vs:YI,fs:YI,getUniforms:lre};function lre(t,e={}){if(t=t&&{...t},!t)return{...Uh.defaultUniforms};t.lights&&(t={...t,...ure(t.lights),lights:void 0});let{ambientLight:r,pointLights:i,directionalLights:n}=t||{};if(!(r||i&&i.length>0||n&&n.length>0))return{...Uh.defaultUniforms,enabled:0};let a={...Uh.defaultUniforms,...e,...cre({ambientLight:r,pointLights:i,directionalLights:n})};return t.enabled!==void 0&&(a.enabled=t.enabled?1:0),a}function cre({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){let i={};i.ambientLightColor=KI(t);let n=0;for(let s of e){i.lightType=v1.POINT;let a=n;i[`lightColor${a}`]=KI(s),i[`lightPosition${a}`]=s.position,i[`lightAttenuation${a}`]=s.attenuation||[1,0,0],n++}for(let s of r){i.lightType=v1.DIRECTIONAL;let a=n;i[`lightColor${a}`]=KI(s),i[`lightDirection${a}`]=s.direction,n++}return n>RD&&jt.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=r.length,i.pointLightCount=e.length,i}function ure(t){let e={pointLights:[],directionalLights:[]};for(let r of t||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":e.directionalLights?.push(r);break;case"point":e.pointLights?.push(r);break;default:}return e}function KI(t={}){let{color:e=[0,0,0],intensity:r=1}=t;return e.map(i=>i*r/are)}var Av=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,mv=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`;var gv=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`;var Ad={props:{},name:"gouraudMaterial",vs:mv.replace("phongMaterial","gouraudMaterial"),fs:Av.replace("phongMaterial","gouraudMaterial"),source:gv.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Uh],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){let e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...Ad.defaultUniforms,...e}}};var i0={name:"phongMaterial",dependencies:[Uh],source:gv,vs:Av,fs:mv,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){let e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...i0.defaultUniforms,...e}}};var BD=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`;var LD=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`;var OD=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,DD={name:"pbrProjection",vs:OD,fs:OD,getUniforms:t=>t,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}};var Qp={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Uh,DD],vs:BD,fs:LD,defines:{LIGHTING_FRAGMENT:1},getUniforms:t=>t,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}};var FD=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,QI={name:"layer",vs:FD,fs:FD,getUniforms:t=>({opacity:Math.pow(t.opacity,.45454545454545453)}),uniformTypes:{opacity:"f32"}};var hre=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,kD="#define SMOOTH_EDGE_RADIUS 0.5",fre=`${kD}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,dre=`${kD}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,_v={name:"geometry",source:hre,vs:fre,fs:dre};var pn;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(pn||(pn={}));var Xn;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(Xn||(Xn={}));var Ur;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(Ur||(Ur={}));var ND="compute",JI="auto",w1="manipulation",Jp="none",T1="pan-x",E1="pan-y";function eM(t){if(t.includes(Jp))return Jp;let e=t.includes(T1),r=t.includes(E1);return e&&r?Jp:e||r?e?T1:E1:t.includes(w1)?w1:JI}var C1=class{constructor(e,r){this.actions="",this.manager=e,this.set(r)}set(e){e===ND&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(let r of this.manager.recognizers)r.options.enable&&(e=e.concat(r.getTouchAction()));return eM(e.join(" "))}};function n0(t){return t.trim().split(/\s+/g)}function yv(t,e,r){if(t)for(let i of n0(e))t.addEventListener(i,r,!1)}function xv(t,e,r){if(t)for(let i of n0(e))t.removeEventListener(i,r,!1)}function tM(t){return(t.ownerDocument||t).defaultView}function rM(t,e){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function bv(t){let e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let r=0,i=0,n=0;for(;n<e;)r+=t[n].clientX,i+=t[n].clientY,n++;return{x:Math.round(r/e),y:Math.round(i/e)}}function iM(t){let e=[],r=0;for(;r<t.pointers.length;)e[r]={clientX:Math.round(t.pointers[r].clientX),clientY:Math.round(t.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:e,center:bv(e),deltaX:t.deltaX,deltaY:t.deltaY}}function vv(t,e){let r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function nM(t,e){let r=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(r*r+i*i)}function zD(t,e){let r=e.x-t.x,i=e.y-t.y;return Math.atan2(i,r)*180/Math.PI}function sM(t,e){let r=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.atan2(i,r)*180/Math.PI}function wv(t,e){return t===e?Xn.None:Math.abs(t)>=Math.abs(e)?t<0?Xn.Left:Xn.Right:e<0?Xn.Up:Xn.Down}function UD(t,e){let r=e.center,i=t.offsetDelta,n=t.prevDelta,s=t.prevInput;return(e.eventType===pn.Start||s?.eventType===pn.End)&&(n=t.prevDelta={x:s?.deltaX||0,y:s?.deltaY||0},i=t.offsetDelta={x:r.x,y:r.y}),{deltaX:n.x+(r.x-i.x),deltaY:n.y+(r.y-i.y)}}function Tv(t,e,r){return{x:e/t||0,y:r/t||0}}function VD(t,e){return nM(e[0],e[1])/nM(t[0],t[1])}function jD(t,e){return sM(e[1],e[0])-sM(t[1],t[0])}function GD(t,e){let r=t.lastInterval||e,i=e.timeStamp-r.timeStamp,n,s,a,c;if(e.eventType!==pn.Cancel&&(i>25||r.velocity===void 0)){let h=e.deltaX-r.deltaX,p=e.deltaY-r.deltaY,x=Tv(i,h,p);s=x.x,a=x.y,n=Math.abs(x.x)>Math.abs(x.y)?x.x:x.y,c=wv(h,p),t.lastInterval=e}else n=r.velocity,s=r.velocityX,a=r.velocityY,c=r.direction;e.velocity=n,e.velocityX=s,e.velocityY=a,e.direction=c}function HD(t,e){let{session:r}=t,{pointers:i}=e,{length:n}=i;r.firstInput||(r.firstInput=iM(e)),n>1&&!r.firstMultiple?r.firstMultiple=iM(e):n===1&&(r.firstMultiple=!1);let{firstInput:s,firstMultiple:a}=r,c=a?a.center:s.center,h=e.center=bv(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=zD(c,h),e.distance=vv(c,h);let{deltaX:p,deltaY:x}=UD(r,e);e.deltaX=p,e.deltaY=x,e.offsetDirection=wv(e.deltaX,e.deltaY);let T=Tv(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=T.x,e.overallVelocityY=T.y,e.overallVelocity=Math.abs(T.x)>Math.abs(T.y)?T.x:T.y,e.scale=a?VD(a.pointers,i):1,e.rotation=a?jD(a.pointers,i):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length;let R=t.element;return rM(e.srcEvent.target,R)&&(R=e.srcEvent.target),e.target=R,GD(r,e),e}function WD(t,e,r){let i=r.pointers.length,n=r.changedPointers.length,s=e&pn.Start&&i-n===0,a=e&(pn.End|pn.Cancel)&&i-n===0;r.isFirst=!!s,r.isFinal=!!a,s&&(t.session={}),r.eventType=e;let c=HD(t,r);t.emit("hammer.input",c),t.recognize(c),t.session.prevInput=c}var S1=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,r){WD(this.manager,e,r)}init(){yv(this.element,this.evEl,this.domHandler),yv(this.target,this.evTarget,this.domHandler),yv(tM(this.element),this.evWin,this.domHandler)}destroy(){xv(this.element,this.evEl,this.domHandler),xv(this.target,this.evTarget,this.domHandler),xv(tM(this.element),this.evWin,this.domHandler)}};var Are={pointerdown:pn.Start,pointermove:pn.Move,pointerup:pn.End,pointercancel:pn.Cancel,pointerout:pn.Cancel},mre="pointerdown",gre="pointermove pointerup pointercancel",I1=class extends S1{constructor(e){super(e),this.evEl=mre,this.evWin=gre,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){let{store:r}=this,i=!1,n=Are[e.type],s=e.pointerType,a=s==="touch",c=r.findIndex(h=>h.pointerId===e.pointerId);n&pn.Start&&(e.buttons||a)?c<0&&(r.push(e),c=r.length-1):n&(pn.End|pn.Cancel)&&(i=!0),!(c<0)&&(r[c]=e,this.callback(n,{pointers:r,changedPointers:[e],eventType:n,pointerType:s,srcEvent:e}),i&&r.splice(c,1))}};var _re=["","webkit","Moz","MS","ms","o"];function $D(t,e){let r=e[0].toUpperCase()+e.slice(1);for(let i of _re){let n=i?i+r:e;if(n in t)return n}}var yre=1,qD=2,ZD={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}},M1=class{constructor(e,r){this.options={...ZD,...r,cssProps:{...ZD.cssProps,...r.cssProps},inputTarget:r.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new I1(this),this.touchAction=new C1(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?qD:yre}recognize(e){let{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i,{recognizers:n}=this,{curRecognizer:s}=r;(!s||s&&s.state&Ur.Recognized)&&(s=r.curRecognizer=null);let a=0;for(;a<n.length;)i=n[a],r.stopped!==qD&&(!s||i===s||i.canRecognizeWith(s))?i.recognize(e):i.reset(),!s&&i.state&(Ur.Began|Ur.Changed|Ur.Ended)&&(s=r.curRecognizer=i),a++}get(e){let{recognizers:r}=this;for(let i=0;i<r.length;i++)if(r[i].options.event===e)return r[i];return null}add(e){if(Array.isArray(e)){for(let i of e)this.add(i);return this}let r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(let i of e)this.remove(i);return this}let r=typeof e=="string"?this.get(e):e;if(r){let{recognizers:i}=this,n=i.indexOf(r);n!==-1&&(i.splice(n,1),this.touchAction.update())}return this}on(e,r){if(!e||!r)return;let{handlers:i}=this;for(let n of n0(e))i[n]=i[n]||[],i[n].push(r)}off(e,r){if(!e)return;let{handlers:i}=this;for(let n of n0(e))r?i[n]&&i[n].splice(i[n].indexOf(r),1):delete i[n]}emit(e,r){let i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;let n=r;n.type=e,n.preventDefault=function(){r.srcEvent.preventDefault()};let s=0;for(;s<i.length;)i[s](n),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){let{element:r}=this;if(r){for(let[i,n]of Object.entries(this.options.cssProps)){let s=$D(r.style,i);e?(this.oldCssProps[s]=r.style[s],r.style[s]=n):r.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}};var xre=1;function XD(){return xre++}function oM(t){return t&Ur.Cancelled?"cancel":t&Ur.Ended?"end":t&Ur.Changed?"move":t&Ur.Began?"start":""}var Vh=class{constructor(e){this.options=e,this.id=XD(),this.state=Ur.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(let n of e)this.recognizeWith(n);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;let{simultaneous:i}=this;return i[r.id]||(i[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(let i of e)this.dropRecognizeWith(i);return this}let r;return typeof e=="string"?r=this.manager.get(e):r=e,r&&delete this.simultaneous[r.id],this}requireFailure(e){if(Array.isArray(e)){for(let n of e)this.requireFailure(n);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;let{requireFail:i}=this;return i.indexOf(r)===-1&&(i.push(r),r.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(let i of e)this.dropRequireFailure(i);return this}let r;if(typeof e=="string"?r=this.manager.get(e):r=e,r){let i=this.requireFail.indexOf(r);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;let{state:r}=this;r<Ur.Ended&&this.manager.emit(this.options.event+oM(r),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),r>=Ur.Ended&&this.manager.emit(this.options.event+oM(r),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ur.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ur.Failed|Ur.Possible)))return!1;e++}return!0}recognize(e){let r={...e};if(!this.options.enable){this.reset(),this.state=Ur.Failed;return}this.state&(Ur.Recognized|Ur.Cancelled|Ur.Failed)&&(this.state=Ur.Possible),this.state=this.process(r),this.state&(Ur.Began|Ur.Changed|Ur.Ended|Ur.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}};var jh=class extends Vh{attrTest(e){let r=this.options.pointers;return r===0||e.pointers.length===r}process(e){let{state:r}=this,{eventType:i}=e,n=r&(Ur.Began|Ur.Changed),s=this.attrTest(e);return n&&(i&pn.Cancel||!s)?r|Ur.Cancelled:n||s?i&pn.End?r|Ur.Ended:r&Ur.Began?r|Ur.Changed:Ur.Began:Ur.Failed}};var eA=class extends Vh{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[w1]}process(e){let{options:r}=this,i=e.pointers.length===r.pointers,n=e.distance<r.threshold,s=e.deltaTime<r.time;if(this.reset(),e.eventType&pn.Start&&this.count===0)return this.failTimeout();if(n&&s&&i){if(e.eventType!==pn.End)return this.failTimeout();let a=this.pTime?e.timeStamp-this.pTime<r.interval:!0,c=!this.pCenter||vv(this.pCenter,e.center)<r.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!c||!a?this.count=1:this.count+=1,this._input=e,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ur.Recognized,this.tryEmit(this._input)},r.interval),Ur.Began):Ur.Recognized}return Ur.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ur.Failed},this.options.interval),Ur.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ur.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}};var bre=["","start","move","end","cancel","up","down","left","right"],md=class extends jh{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Xn.All,...e}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:e}}=this,r=[];return e&Xn.Horizontal&&r.push(E1),e&Xn.Vertical&&r.push(T1),r}getEventNames(){return bre.map(e=>this.options.event+e)}directionTest(e){let{options:r}=this,i=!0,{distance:n}=e,{direction:s}=e,a=e.deltaX,c=e.deltaY;return s&r.direction||(r.direction&Xn.Horizontal?(s=a===0?Xn.None:a<0?Xn.Left:Xn.Right,i=a!==this.pX,n=Math.abs(e.deltaX)):(s=c===0?Xn.None:c<0?Xn.Up:Xn.Down,i=c!==this.pY,n=Math.abs(e.deltaY))),e.direction=s,i&&n>r.threshold&&!!(s&r.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ur.Began)||!(this.state&Ur.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;let r=Xn[e.direction].toLowerCase();r&&(e.additionalEvent=this.options.event+r),super.emit(e)}};var vre=["","start","move","end","cancel","in","out"],s0=class extends jh{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Jp]}getEventNames(){return vre.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ur.Began))}emit(e){if(e.scale!==1){let r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}super.emit(e)}};var Lu=class{constructor(e,r,i){this.element=e,this.callback=r,this.options=i}};var YD=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",OMe=typeof window<"u"?window:global;var Cre=YD.indexOf("firefox")!==-1,KD=4.000244140625,Sre=40,Ire=.25,Ev=class extends Lu{constructor(e,r,i){super(e,r,{enable:!0,...i}),this.handleEvent=n=>{if(!this.options.enable)return;let s=n.deltaY;globalThis.WheelEvent&&(Cre&&n.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),n.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=Sre)),s!==0&&s%KD===0&&(s=Math.floor(s/KD)),n.shiftKey&&s&&(s=s*Ire),this.callback({type:"wheel",center:{x:n.clientX,y:n.clientY},delta:-s,srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,r){e==="wheel"&&(this.options.enable=r)}};var QD=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],Cv=class extends Lu{constructor(e,r,i){super(e,r,{enable:!0,...i}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;let{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,QD.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){QD.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){switch(e){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break;default:}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break;default:}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}};var JD=["keydown","keyup"],Sv=class extends Lu{constructor(e,r,i){super(e,r,{enable:!0,tabIndex:0,...i}),this.handleEvent=n=>{let s=n.target||n.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:"keydown",srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:"keyup",srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",JD.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){JD.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e==="keydown"&&(this.enableDownEvent=r),e==="keyup"&&(this.enableUpEvent=r)}};var Iv=class extends Lu{constructor(e,r,i){super(e,r,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e==="contextmenu"&&(this.options.enable=r)}};var Mre={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},Pre=0,Rre=1,Bre=2,Lre=1,Ore=2,Dre=4;function eF(t){let e=Mre[t.srcEvent.type];if(!e)return null;let{buttons:r,button:i}=t.srcEvent,n=!1,s=!1,a=!1;return e===2?(n=!!(r&Lre),s=!!(r&Dre),a=!!(r&Ore)):(n=i===Pre,s=i===Rre,a=i===Bre),{leftButton:n,middleButton:s,rightButton:a}}function tF(t,e){let r=t.center;if(!r)return null;let i=e.getBoundingClientRect(),n=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,a={x:(r.x-i.left-e.clientLeft)/n,y:(r.y-i.top-e.clientTop)/s};return{center:r,offsetCenter:a}}var Fre={srcElement:"root",priority:0},Mv=class{constructor(e,r){this.handleEvent=i=>{if(this.isEmpty())return;let n=this._normalizeEvent(i),s=i.srcEvent.target;for(;s&&s!==n.rootElement;){if(this._emit(n,s),n.handled)return;s=s.parentNode}this._emit(n,"root")},this.eventManager=e,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,i,n=!1,s=!1){let{handlers:a,handlersByElement:c}=this,h={...Fre,...i},p=c.get(h.srcElement);p||(p=[],c.set(h.srcElement,p));let x={type:e,handler:r,srcElement:h.srcElement,priority:h.priority};n&&(x.once=!0),s&&(x.passive=!0),a.push(x),this._active=this._active||!x.passive;let T=p.length-1;for(;T>=0&&!(p[T].priority>=x.priority);)T--;p.splice(T+1,0,x)}remove(e,r){let{handlers:i,handlersByElement:n}=this;for(let s=i.length-1;s>=0;s--){let a=i[s];if(a.type===e&&a.handler===r){i.splice(s,1);let c=n.get(a.srcElement);c.splice(c.indexOf(a),1),c.length===0&&n.delete(a.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,r){let i=this.handlersByElement.get(r);if(i){let n=!1,s=()=>{e.handled=!0},a=()=>{e.handled=!0,n=!0},c=[];for(let h=0;h<i.length;h++){let{type:p,handler:x,once:T}=i[h];if(x({...e,type:p,stopPropagation:s,stopImmediatePropagation:a}),T&&c.push(i[h]),n)break}for(let h=0;h<c.length;h++){let{type:p,handler:x}=c[h];this.remove(p,x)}}}_normalizeEvent(e){let r=this.eventManager.getElement();return{...e,...eF(e),...tF(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}};function kre(t){if("recognizer"in t)return t;let e,r=Array.isArray(t)?[...t]:[t];if(typeof r[0]=="function"){let i=r.shift(),n=r.shift()||{};e=new i(n)}else e=r.shift();return{recognizer:e,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}var P1=class{constructor(e=null,r={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=e,!!e){this.manager=new M1(e,this.options);for(let i of this.options.recognizers){let{recognizer:n,recognizeWith:s,requireFailure:a}=kre(i);this.manager.add(n),s&&n.recognizeWith(s),a&&n.requireFailure(a)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Ev(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Cv(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Sv(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new Iv(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,r,i){this._addEventHandler(e,r,i,!1)}once(e,r,i){this._addEventHandler(e,r,i,!0)}watch(e,r,i){this._addEventHandler(e,r,i,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){let{manager:i}=this;if(!i)return;let n=i.get(e);n&&(n.set({enable:r}),i.touchAction.update()),this.wheelInput?.enableEventType(e,r),this.moveInput?.enableEventType(e,r),this.keyInput?.enableEventType(e,r),this.contextmenuInput?.enableEventType(e,r)}_addEventHandler(e,r,i,n,s){if(typeof e!="string"){i=r;for(let[p,x]of Object.entries(e))this._addEventHandler(p,x,i,n,s);return}let{manager:a,events:c}=this;if(!a)return;let h=c.get(e);if(!h){let p=this._getRecognizerName(e)||e;h=new Mv(this,p),c.set(e,h),a&&a.on(e,h.handleEvent)}h.add(e,r,i,n,s),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(let[s,a]of Object.entries(e))this._removeEventHandler(s,a);return}let{events:i}=this,n=i.get(e);if(n&&(n.remove(e,r),n.isEmpty())){let{recognizerName:s}=n,a=!1;for(let c of i.values())if(c.recognizerName===s&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(r=>r.getEventNames().includes(e))?.options.event}};var Tr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Tr,"IDENTITY",{get:()=>(ur.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var ro={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Dn={common:0,meters:1,pixels:2},R1={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},aM={multipan:[md,{threshold:10,direction:Xn.Vertical,pointers:2}],pinch:[s0,{},null,["multipan"]],pan:[md,{threshold:1},["pinch"],["multipan"]],dblclick:[eA,{event:"dblclick",taps:2}],click:[eA,{event:"click"},null,["dblclick"]]};function Nre(t,e){if(t===e)return!0;if(Array.isArray(t)){let r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Ou(t){let e={},r;return i=>{for(let n in i)if(!Nre(i[n],e[n])){r=t(i),e=i;break}return r}}var rF=[0,0,0,0],zre=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],iF=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ure=[0,0,0],nF=[0,0,0],Vre=Ou(Gre);function lM(t,e,r=nF){r.length<3&&(r=[r[0],r[1],0]);let i=r,n,s=!0;switch(e===Tr.LNGLAT_OFFSETS||e===Tr.METER_OFFSETS?n=r:n=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ro.WEB_MERCATOR:(e===Tr.LNGLAT||e===Tr.CARTESIAN)&&(n=[0,0,0],s=!1);break;case ro.WEB_MERCATOR_AUTO_OFFSET:e===Tr.LNGLAT?i=n:e===Tr.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],n=t.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case ro.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case ro.GLOBE:s=!1,n=null;break;default:s=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:s}}function jre(t,e,r){let{viewMatrixUncentered:i,projectionMatrix:n}=t,{viewMatrix:s,viewProjectionMatrix:a}=t,c=rF,h=rF,p=t.cameraPosition,{geospatialOrigin:x,shaderCoordinateOrigin:T,offsetMode:R}=lM(t,e,r);return R&&(h=t.projectPosition(x||T),p=[p[0]-h[0],p[1]-h[1],p[2]-h[2]],h[3]=1,c=Pa.transformMat4([],h,a),s=i||s,a=Ms.multiply([],n,s),a=Ms.multiply([],a,zre)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:c,originCommon:h,cameraPosCommon:p,shaderCoordinateOrigin:T,geospatialOrigin:x}}function sF({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:i=Tr.DEFAULT,coordinateOrigin:n=nF,autoWrapLongitude:s=!1}){i===Tr.DEFAULT&&(i=t.isGeospatial?Tr.LNGLAT:Tr.CARTESIAN);let a=Vre({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n});return a.wrapLongitude=s,a.modelMatrix=r||iF,a}function Gre({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i}){let{projectionCenter:n,viewProjectionMatrix:s,originCommon:a,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:p}=jre(t,r,i),x=t.getDistanceScales(),T=[t.width*e,t.height*e],R=Pa.transformMat4([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,k={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:h,commonOrigin:a.slice(0,3),center:n,pseudoMeters:!!t._pseudoMeters,viewportSize:T,devicePixelRatio:e,focalDistance:R,commonUnitsPerMeter:x.unitsPerMeter,commonUnitsPerWorldUnit:x.unitsPerMeter,commonUnitsPerWorldUnit2:Ure,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:iF,cameraPosition:c};if(p){let j=t.getDistanceScales(p);switch(r){case Tr.METER_OFFSETS:k.commonUnitsPerWorldUnit=j.unitsPerMeter,k.commonUnitsPerWorldUnit2=j.unitsPerMeter2;break;case Tr.LNGLAT:case Tr.LNGLAT_OFFSETS:t._pseudoMeters||(k.commonUnitsPerMeter=j.unitsPerMeter),k.commonUnitsPerWorldUnit=j.unitsPerDegree,k.commonUnitsPerWorldUnit2=j.unitsPerDegree2;break;case Tr.CARTESIAN:k.commonUnitsPerWorldUnit=[1,1,j.unitsPerMeter[2]],k.commonUnitsPerWorldUnit2=[0,0,j.unitsPerMeter2[2]];break;default:break}}return k}var Hre=Object.keys(Tr).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${Tr[t]};`).join(""),Wre=Object.keys(ro).map(t=>`const PROJECTION_MODE_${t}: i32 = ${ro[t]};`).join(""),$re=Object.keys(Dn).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Dn[t]};`).join(""),qre=`${Hre}
${Wre}
${$re}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,oF=`${qre}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z\u2011axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`;var Zre=Object.keys(Tr).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Tr[t]};`).join(""),Xre=Object.keys(ro).map(t=>`const int PROJECTION_MODE_${t} = ${ro[t]};`).join(""),Yre=Object.keys(Dn).map(t=>`const int UNIT_${t.toUpperCase()} = ${Dn[t]};`).join(""),aF=`${Zre}
${Xre}
${Yre}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;var Kre={};function Qre(t=Kre){return"viewport"in t?sF(t):{}}var o0={name:"project",dependencies:[ZI,_v],source:oF,vs:aF,getUniforms:Qre,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}};var Jre=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,eie=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Li={name:"project32",dependencies:[o0],source:Jre,vs:eie};function cM(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function gd(t,e){let r=Pa.transformMat4([],e,t);return Pa.scale(r,r,1/r[3]),r}function uM(t,e){let r=t%e;return r<0?e+r:r}function B1(t,e,r){return t<e?e:t>r?r:t}function tie(t){return Math.log(t)*Math.LOG2E}var a0=Math.log2||tie;function Sc(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var Ic=Math.PI,lF=Ic/4,Bl=Ic/180,hM=180/Ic,l0=512,Pv=4003e4,Ll=85.051129,cF=1.5;function fM(t){return a0(t)}function io(t){let[e,r]=t;Sc(Number.isFinite(e)),Sc(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let i=e*Bl,n=r*Bl,s=l0*(i+Ic)/(2*Ic),a=l0*(Ic+Math.log(Math.tan(lF+n*.5)))/(2*Ic);return[s,a]}function $o(t){let[e,r]=t,i=e/l0*(2*Ic)-Ic,n=2*(Math.atan(Math.exp(r/l0*(2*Ic)-Ic))-lF);return[i*hM,n*hM]}function dM(t){let{latitude:e}=t;Sc(Number.isFinite(e));let r=Math.cos(e*Bl);return fM(Pv*r)-9}function tA(t){let e=Math.cos(t*Bl);return l0/Pv/e}function c0(t){let{latitude:e,longitude:r,highPrecision:i=!1}=t;Sc(Number.isFinite(e)&&Number.isFinite(r));let n=l0,s=Math.cos(e*Bl),a=n/360,c=a/s,h=n/Pv/s,p={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[a,c,h],degreesPerUnit:[1/a,1/c,1/h]};if(i){let x=Bl*Math.tan(e*Bl)/s,T=a*x/2,R=n/Pv*x,k=R/c*h;p.unitsPerDegree2=[0,T,R],p.unitsPerMeter2=[k,0,k]}return p}function L1(t,e){let[r,i,n]=t,[s,a,c]=e,{unitsPerMeter:h,unitsPerMeter2:p}=c0({longitude:r,latitude:i,highPrecision:!0}),x=io(t);x[0]+=s*(h[0]+p[0]*a),x[1]+=a*(h[1]+p[1]*a);let T=$o(x),R=(n||0)+(c||0);return Number.isFinite(n)||Number.isFinite(c)?[T[0],T[1],R]:T}function Rv(t){let{height:e,pitch:r,bearing:i,altitude:n,scale:s,center:a}=t,c=cM();Ms.translate(c,c,[0,0,-n]),Ms.rotateX(c,c,-r*Bl),Ms.rotateZ(c,c,i*Bl);let h=s/e;return Ms.scale(c,c,[h,h,h]),a&&Ms.translate(c,c,Fo.negate([],a)),c}function pM(t){let{width:e,height:r,altitude:i,pitch:n=0,offset:s,center:a,scale:c,nearZMultiplier:h=1,farZMultiplier:p=1}=t,{fovy:x=Gh(cF)}=t;i!==void 0&&(x=Gh(i));let T=x*Bl,R=n*Bl,k=rA(x),j=k;a&&(j+=a[2]*c/Math.cos(R)/r);let q=T*(.5+(s?s[1]:0)/r),X=Math.sin(q)*j/Math.sin(B1(Math.PI/2-R-q,.01,Math.PI-.01)),re=Math.sin(R)*X+j,te=j*10,oe=Math.min(re*p,te);return{fov:T,aspect:e/r,focalDistance:k,near:h,far:oe}}function Gh(t){return 2*Math.atan(.5/t)*hM}function rA(t){return .5/Math.tan(.5*t*Bl)}function u0(t,e){let[r,i,n=0]=t;return Sc(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),gd(e,[r,i,n,1])}function _d(t,e,r=0){let[i,n,s]=t;if(Sc(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return gd(e,[i,n,s,1]);let a=gd(e,[i,n,0,1]),c=gd(e,[i,n,1,1]),h=a[2],p=c[2],x=h===p?0:((r||0)-h)/(p-h);return Bu.lerp([],a,c,x)}function Bv(t){let{width:e,height:r,bounds:i,minExtent:n=0,maxZoom:s=24,offset:a=[0,0]}=t,[[c,h],[p,x]]=i,T=rie(t.padding),R=io([c,B1(x,-Ll,Ll)]),k=io([p,B1(h,-Ll,Ll)]),j=[Math.max(Math.abs(k[0]-R[0]),n),Math.max(Math.abs(k[1]-R[1]),n)],q=[e-T.left-T.right-Math.abs(a[0])*2,r-T.top-T.bottom-Math.abs(a[1])*2];Sc(q[0]>0&&q[1]>0);let X=q[0]/j[0],re=q[1]/j[1],te=(T.right-T.left)/2/X,oe=(T.top-T.bottom)/2/re,ae=[(k[0]+R[0])/2+te,(k[1]+R[1])/2+oe],pe=$o(ae),be=Math.min(s,a0(Math.abs(Math.min(X,re))));return Sc(Number.isFinite(be)),{longitude:pe[0],latitude:pe[1],zoom:be}}function rie(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Sc(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}var uF=Math.PI/180;function Lv(t,e=0){let{width:r,height:i,unproject:n}=t,s={targetZ:e},a=n([0,i],s),c=n([r,i],s),h,p,x=t.fovy?.5*t.fovy*uF:Math.atan(.5/t.altitude),T=(90-t.pitch)*uF;return x>T-.01?(h=hF(t,0,e),p=hF(t,r,e)):(h=n([0,0],s),p=n([r,0],s)),[a,c,p,h]}function hF(t,e,r){let{pixelUnprojectionMatrix:i}=t,n=gd(i,[e,0,1,1]),s=gd(i,[e,t.height,1,1]),c=(r*t.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),h=Bu.lerp([],n,s,c),p=$o(h);return p.push(r),p}var dF=512;function AM(t){let{width:e,height:r,pitch:i=0}=t,{longitude:n,latitude:s,zoom:a,bearing:c=0}=t;(n<-180||n>180)&&(n=uM(n+180,360)-180),(c<-180||c>180)&&(c=uM(c+180,360)-180);let h=a0(r/dF);if(a<=h)a=h,s=0;else{let p=r/2/Math.pow(2,a),x=$o([0,p])[1];if(s<x)s=x;else{let T=$o([0,dF-p])[1];s>T&&(s=T)}}return{width:e,height:r,longitude:n,latitude:s,zoom:a,pitch:i,bearing:c}}var pF=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,sie=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,oie=`
${pF}
${sie}
`,aie=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,lie=`
${pF}
${aie}
`,cie=Ou(pie),uie=Ou(Aie),hie=[0,0,0,1],fie=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function die(t,e){let[r,i,n]=t,s=_d([r,i,n],e);return Number.isFinite(n)?s:[s[0],s[1],0]}function pie({viewport:t,center:e}){return new Er(t.viewProjectionMatrix).invert().transform(e)}function Aie({viewport:t,shadowMatrices:e}){let r=[],i=t.pixelUnprojectionMatrix,n=t.isGeospatial?void 0:1,s=[[0,0,n],[t.width,0,n],[0,t.height,n],[t.width,t.height,n],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(a=>die(a,i));for(let a of e){let c=a.clone().translate(new st(t.center).negate()),h=s.map(x=>c.transform(x)),p=new Er().ortho({left:Math.min(...h.map(x=>x[0])),right:Math.max(...h.map(x=>x[0])),bottom:Math.min(...h.map(x=>x[1])),top:Math.max(...h.map(x=>x[1])),near:Math.min(...h.map(x=>-x[2])),far:Math.max(...h.map(x=>-x[2]))});r.push(p.multiplyRight(a))}return r}function mie(t){let{shadowEnabled:e=!0,project:r}=t;if(!e||!r||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};let i=o0.getUniforms(r),n=cie({viewport:r.viewport,center:i.center}),s=[],a=uie({shadowMatrices:t.shadowMatrices,viewport:r.viewport}).slice();for(let h=0;h<t.shadowMatrices.length;h++){let p=a[h],x=p.clone().translate(new st(r.viewport.center).negate());i.coordinateSystem===Tr.LNGLAT&&i.projectionMode===ro.WEB_MERCATOR?(a[h]=x,s[h]=n):(a[h]=p.clone().multiplyRight(fie),s[h]=x.transform(n))}let c={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||hie,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let h=0;h<a.length;h++)c[`viewProjectionMatrix${h}`]=a[h],c[`projectCenter${h}`]=s[h];for(let h=0;h<2;h++)c[`shadow_uShadowMap${h}`]=t.shadowMaps&&t.shadowMaps[h]||t.dummyShadowMap;return c}var Ov={name:"shadow",dependencies:[o0],vs:oie,fs:lie,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:mie,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}};var Sn={...pv,defaultUniforms:{...pv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}};var gie=[_v],_ie=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],yie=[];function AF(t){let e=Np.getDefaultShaderAssembler();for(let i of gie)e.addDefaultModule(i);let r=t==="glsl"?_ie:yie;for(let i of r)e.addShaderHook(i);return e}var xie=[255,255,255],bie=1,vie=0,Dv=class{constructor(e={}){this.type="ambient";let{color:r=xie}=e,{intensity:i=bie}=e;this.id=e.id||`ambient-${vie++}`,this.color=r,this.intensity=i}};var wie=[255,255,255],Tie=1,Eie=[0,0,-1],Cie=0,O1=class{constructor(e={}){this.type="directional";let{color:r=wie}=e,{intensity:i=Tie}=e,{direction:n=Eie}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${Cie++}`,this.color=r,this.intensity=i,this.type="directional",this.direction=new st(n).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}};var D1=class{constructor(e,r={id:"pass"}){let{id:i}=r;this.id=i,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}};var Hh=class extends D1{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){let[r,i]=this.device.canvasContext.getDrawingBufferSize(),n=e.clearCanvas??!0,s=e.clearColor??(n?[0,0,0,0]:!1),a=n?1:!1,c=n?0:!1,h=e.colorMask??15,p={viewport:[0,0,r,i]};e.colorMask&&(p.colorMask=h),e.scissorRect&&(p.scissorRect=e.scissorRect);let x=this.device.beginRenderPass({framebuffer:e.target,parameters:p,clearColor:s,clearDepth:a,clearStencil:c});try{return this._drawLayers(x,e)}finally{x.end(),this.device.submit()}}_drawLayers(e,r){let{target:i,shaderModuleProps:n,viewports:s,views:a,onViewportActive:c,clearStack:h=!0}=r;r.pass=r.pass||"unknown",h&&(this._lastRenderIndex=-1);let p=[];for(let x of s){let T=a&&a[x.id];c?.(x);let R=this._getDrawLayerParams(x,r),k=x.subViewports||[x];for(let j of k){let q=this._drawLayersInViewport(e,{target:i,shaderModuleProps:n,viewport:j,view:T,pass:r.pass,layers:r.layers},R);p.push(q)}}return p}_getDrawLayerParams(e,{layers:r,pass:i,isPicking:n=!1,layerFilter:s,cullRect:a,effects:c,shaderModuleProps:h},p=!1){let x=[],T=gF(this._lastRenderIndex+1),R={layer:r[0],viewport:e,isPicking:n,renderPass:i,cullRect:a},k={};for(let j=0;j<r.length;j++){let q=r[j],X=this._shouldDrawLayer(q,R,s,k),re={shouldDrawLayer:X};X&&!p&&(re.shouldDrawLayer=!0,re.layerRenderIndex=T(q,X),re.shaderModuleProps=this._getShaderModuleProps(q,c,i,h),re.layerParameters={...q.context.deck?.props.parameters,...this.getLayerParameters(q,j,e)}),x[j]=re}return x}_drawLayersInViewport(e,{layers:r,shaderModuleProps:i,pass:n,target:s,viewport:a,view:c},h){let p=Sie(this.device,{shaderModuleProps:i,target:s,viewport:a});if(c&&c.props.clear){let T=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:p,scissorRect:p},clearColor:T.color?[0,0,0,0]:!1,clearDepth:T.depth?1:!1}).end()}let x={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:p});for(let T=0;T<r.length;T++){let R=r[T],k=h[T],{shouldDrawLayer:j}=k;if(j&&R.props.pickable&&x.pickableCount++,R.isComposite&&x.compositeCount++,R.isDrawable&&k.shouldDrawLayer){let{layerRenderIndex:q,shaderModuleProps:X,layerParameters:re}=k;x.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,q),X.project&&(X.project.viewport=a),R.context.renderPass=e;try{R._drawLayer({renderPass:e,shaderModuleProps:X,uniforms:{layerIndex:q},parameters:re})}catch(te){R.raiseError(te,`drawing ${R} to ${n}`)}}}return x}shouldDrawLayer(e){return!0}getShaderModuleProps(e,r,i){return null}getLayerParameters(e,r,i){return e.props.parameters}_shouldDrawLayer(e,r,i,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(r))return!1;r.layer=a,a=a.parent}if(i){let c=r.layer.id;if(c in n||(n[c]=i(r)),!n[c])return!1}return e.activateViewport(r.viewport),!0}_getShaderModuleProps(e,r,i,n){let s=this.device.canvasContext.cssToDeviceRatio(),a=e.internalState?.propsInTransition||e.props,c={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(r)for(let h of r)mF(c,h.getShaderModuleProps?.(e,c));return mF(c,this.getShaderModuleProps(e,r,c),n)}};function gF(t=0,e={}){let r={},i=(n,s)=>{let a=n.props._offset,c=n.id,h=n.parent&&n.parent.id,p;if(h&&!(h in e)&&i(n.parent,!1),h in r){let x=r[h]=r[h]||gF(e[h],e);p=x(n,s),r[c]=x}else Number.isFinite(a)?(p=a+(e[h]||0),r[c]=null):p=t;return s&&p>=t&&(t=p+1),e[c]=p,p};return i}function Sie(t,{shaderModuleProps:e,target:r,viewport:i}){let n=e?.project?.devicePixelRatio??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),a=r?r.height:s,c=i;return[c.x*n,a-(c.y+c.height)*n,c.width*n,c.height*n]}function mF(t,...e){for(let r of e)if(r)for(let i in r)t[i]?Object.assign(t[i],r[i]):t[i]=r[i];return t}var F1=class extends Hh{constructor(e,r){super(e,r);let i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),n=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:n})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){let r=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),n=e.viewports[0],s=n.width*i,a=n.height*i,c=[1,1,1,1];(s!==r.width||a!==r.height)&&r.resize({width:s,height:a}),super.render({...e,clearColor:c,target:r,pass:"shadow"})}getLayerParameters(e,r,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,r,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}};var Iie={color:[255,255,255],intensity:1},_F=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Mie=[0,0,0,200/255],h0=class{constructor(e={}){this.id="lighting-effect",this.shadowColor=Mie,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;let{device:r,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),i._addDefaultShaderModule(Ov),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(let r in e){let i=e[r];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:s,shaderModuleProps:{shadow:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,r){let i=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(a=>a.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},n={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(a=>a.getProjectedLight({layer:e})),pointLights:this.pointLights.map(a=>a.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:i,lighting:n,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(let r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Ov))}_calculateMatrices(){let e=[];for(let r of this.directionalLights){let i=new Er().lookAt({eye:new st(r.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){let i=new F1(e);this.shadowPasses[r]=i}}_applyDefaultLights(){let{ambientLight:e,pointLights:r,directionalLights:i}=this;!e&&r.length===0&&i.length===0&&(this.ambientLight=new Dv(Iie),this.directionalLights.push(new O1(_F[0]),new O1(_F[1])))}};var mM=class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:i=1,type:n,padding:s=0,copy:a=!1,initialize:c=!1,maxCount:h}){let p=n||e&&e.constructor||Float32Array,x=r*i+s;if(ArrayBuffer.isView(e)){if(x<=e.length)return e;if(x*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new p(e.buffer,0,x)}let T=1/0;h&&(T=h*i+s);let R=this._allocate(p,x,c,T);return e&&a?R.set(e):c||R.fill(0,0,4),this._release(e),R}release(e){this._release(e)}_allocate(e,r,i,n){let s=Math.max(Math.ceil(r*this.opts.overAlloc),1);s>n&&(s=n);let a=this._pool,c=e.BYTES_PER_ELEMENT*s,h=a.findIndex(p=>p.byteLength>=c);if(h>=0){let p=new e(a.splice(h,1)[0],0,s);return i&&p.fill(0),p}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;let r=this._pool,{buffer:i}=e,{byteLength:n}=i,s=r.findIndex(a=>a.byteLength>=n);s<0?r.push(i):(s>0||r.length<this.opts.poolSize)&&r.splice(s,0,i),r.length>this.opts.poolSize&&r.shift()}},Mc=new mM;function d0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xF(t,e){let r=t%e;return r<0?e+r:r}function bF(t){return[t[12],t[13],t[14]]}function vF(t){return{left:f0(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:f0(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:f0(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:f0(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:f0(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:f0(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}var yF=new st;function f0(t,e,r,i){yF.set(t,e,r);let n=yF.len();return{distance:i/n,normal:new st(-t/n,-e/n,-r/n)}}function Pie(t){return t-Math.fround(t)}var k1;function Fv(t,e){let{size:r=1,startIndex:i=0}=e,n=e.endIndex!==void 0?e.endIndex:t.length,s=(n-i)/r;k1=Mc.allocate(k1,s,{type:Float32Array,size:r*2});let a=i,c=0;for(;a<n;){for(let h=0;h<r;h++){let p=t[a++];k1[c+h]=p,k1[c+h+r]=Pie(p)}c+=r*2}return k1.subarray(0,s*r*2)}function wF(t){let e=null,r=!1;for(let i of t)i&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}var Rie=Math.PI/180,Bie=d0(),TF=[0,0,0],Lie={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Oie({width:t,height:e,orthographic:r,fovyRadians:i,focalDistance:n,padding:s,near:a,far:c}){let h=t/e,p=r?new Er().orthographic({fovy:i,aspect:h,focalDistance:n,near:a,far:c}):new Er().perspective({fovy:i,aspect:h,near:a,far:c});if(s){let{left:x=0,right:T=0,top:R=0,bottom:k=0}=s,j=xo((x+t-T)/2,0,t)-t/2,q=xo((R+e-k)/2,0,e)-e/2;p[8]-=j*2/t,p[9]+=q*2/e}return p}var kv=class t{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Lie,this.focalDistance=e.focalDistance||1,this.position=e.position||TF,this.modelMatrix=e.modelMatrix||null;let{longitude:r,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ro.WEB_MERCATOR:ro.WEB_MERCATOR_AUTO_OFFSET:ro.IDENTITY}equals(e){return e instanceof t?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Hs(e.projectionMatrix,this.projectionMatrix)&&Hs(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){let i=this.projectPosition(e),n=u0(i,this.pixelProjectionMatrix),[s,a]=n,c=r?a:this.height-a;return e.length===2?[s,c]:[s,c,n[2]]}unproject(e,{topLeft:r=!0,targetZ:i}={}){let[n,s,a]=e,c=r?s:this.height-s,h=i&&i*this.distanceScales.unitsPerMeter[2],p=_d([n,c,a],this.pixelUnprojectionMatrix,h),[x,T,R]=this.unprojectPosition(p);return Number.isFinite(a)?[x,T,R]:Number.isFinite(i)?[x,T,i]:[x,T]}projectPosition(e){let[r,i]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,i,n]}unprojectPosition(e){let[r,i]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,i,n]}projectFlat(e){if(this.isGeospatial){let r=io(e);return r[1]=xo(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?$o(e):e}getBounds(e={}){let r={targetZ:e.z||0},i=this.unproject([0,0],r),n=this.unproject([this.width,0],r),s=this.unproject([0,this.height],r),a=this.unproject([this.width,this.height],r);return[Math.min(i[0],n[0],s[0],a[0]),Math.min(i[1],n[1],s[1],a[1]),Math.max(i[0],n[0],s[0],a[0]),Math.max(i[1],n[1],s[1],a[1])]}getDistanceScales(e){return e&&this.isGeospatial?c0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:i=1,height:n=1}){return e<this.x+this.width&&this.x<e+i&&r<this.y+this.height&&this.y<r+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,vF(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){let r=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=dM({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||c0({latitude:i,longitude:r}));let n=Math.pow(2,this.zoom);this.scale=n;let{position:s,modelMatrix:a}=e,c=TF;if(s&&(c=a?new Er(a).transformAsVector(s,[]):s),this.isGeospatial){let h=this.projectPosition([r,i,0]);this.center=new st(c).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(c)}_initMatrices(e){let{viewMatrix:r=Bie,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:s,fovy:a=75,near:c=.1,far:h=1e3,padding:p=null,focalDistance:x=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new Er().multiplyRight(r).translate(new st(this.center).negate()),this.projectionMatrix=i||Oie({width:this.width,height:this.height,orthographic:n,fovyRadians:s||a*Rie,focalDistance:x,padding:p,near:c,far:h});let T=d0();Ms.multiply(T,T,this.projectionMatrix),Ms.multiply(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=Ms.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=bF(this.viewMatrixInverse);let R=d0(),k=d0();Ms.scale(R,R,[this.width/2,-this.height/2,1]),Ms.translate(R,R,[1,-1,0]),Ms.multiply(k,R,this.viewProjectionMatrix),this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=Ms.invert(d0(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ur.warn("Pixel project matrix not invertible")()}};kv.displayName="Viewport";var sl=kv;var Nv=class t extends sl{constructor(e={}){let{latitude:r=0,longitude:i=0,zoom:n=0,pitch:s=0,bearing:a=0,nearZMultiplier:c=.1,farZMultiplier:h=1.01,nearZ:p,farZ:x,orthographic:T=!1,projectionMatrix:R,repeat:k=!1,worldOffset:j=0,position:q,padding:X,legacyMeterSizes:re=!1}=e,{width:te,height:oe,altitude:ae=1.5}=e,pe=Math.pow(2,n);te=te||1,oe=oe||1;let be,Fe=null;if(R)ae=R[5]/2,be=Gh(ae);else{e.fovy?(be=e.fovy,ae=rA(be)):be=Gh(ae);let J;if(X){let{top:Z=0,bottom:xe=0}=X;J=[0,xo((Z+oe-xe)/2,0,oe)-oe/2]}Fe=pM({width:te,height:oe,scale:pe,center:q&&[0,0,q[2]*tA(r)],offset:J,pitch:s,fovy:be,nearZMultiplier:c,farZMultiplier:h}),Number.isFinite(p)&&(Fe.near=p),Number.isFinite(x)&&(Fe.far=x)}let Y=Rv({height:oe,pitch:s,bearing:a,scale:pe,altitude:ae});j&&(Y=new Er().translate([512*j,0,0]).multiplyLeft(Y)),super({...e,width:te,height:oe,viewMatrix:Y,longitude:i,latitude:r,zoom:n,...Fe,fovy:be,focalDistance:ae}),this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=s,this.bearing=a,this.altitude=ae,this.fovy=be,this.orthographic=T,this._subViewports=k?[]:null,this._pseudoMeters=re,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),r=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let n=r;n<=i;n++){let s=n?new t({...this,worldOffset:n}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[r,i]=this.projectFlat(e),n=(e[2]||0)*tA(e[1]);return[r,i,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[r,i]=this.unprojectFlat(e),n=(e[2]||0)/tA(i);return[r,i,n]}addMetersToLngLat(e,r){return L1(e,r)}panByPosition(e,r){let i=_d(r,this.pixelUnprojectionMatrix),n=this.projectFlat(e),s=Bu.add([],n,Bu.negate([],i)),a=Bu.add([],this.center,s),[c,h]=this.unprojectFlat(a);return{longitude:c,latitude:h}}getBounds(e={}){let r=Lv(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){let{width:i,height:n}=this,{longitude:s,latitude:a,zoom:c}=Bv({width:i,height:n,bounds:e,...r});return new t({width:i,height:n,longitude:s,latitude:a,zoom:c})}};Nv.displayName="WebMercatorViewport";var Du=Nv;var EF=[0,0,0];function gM(t,e,r=!1){let i=e.projectPosition(t);if(r&&e instanceof Du){let[n,s,a=0]=t,c=e.getDistanceScales([n,s]);i[2]=a*c.unitsPerMeter[2]}return i}function Die(t){let{viewport:e,modelMatrix:r,coordinateOrigin:i}=t,{coordinateSystem:n,fromCoordinateSystem:s,fromCoordinateOrigin:a}=t;return n===Tr.DEFAULT&&(n=e.isGeospatial?Tr.LNGLAT:Tr.CARTESIAN),s===void 0&&(s=n),a===void 0&&(a=i),{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function _M(t,{viewport:e,modelMatrix:r,coordinateSystem:i,coordinateOrigin:n,offsetMode:s}){let[a,c,h=0]=t;switch(r&&([a,c,h]=Pa.transformMat4([],[a,c,h,1],r)),i){case Tr.LNGLAT:return gM([a,c,h],e,s);case Tr.LNGLAT_OFFSETS:return gM([a+n[0],c+n[1],h+(n[2]||0)],e,s);case Tr.METER_OFFSETS:return gM(L1(n,[a,c,h]),e,s);case Tr.CARTESIAN:default:return e.isGeospatial?[a+n[0],c+n[1],h+n[2]]:e.projectPosition([a,c,h])}}function CF(t,e){let{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:c}=Die(e),{autoOffset:h=!0}=e,{geospatialOrigin:p=EF,shaderCoordinateOrigin:x=EF,offsetMode:T=!1}=h?lM(r,i,n):{},R=_M(t,{viewport:r,modelMatrix:s,coordinateSystem:a,coordinateOrigin:c,offsetMode:T});if(T){let k=r.projectPosition(p||x);Fo.sub(R,R,k)}return R}var Fie=1,kie=1,iA=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){let{delay:r=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:s=1}=e,a=Fie++,c={time:0,delay:r,duration:i,rate:n,repeat:s};return this._setChannelTime(c,this.time),this.channels.set(a,c),a}removeChannel(e){this.channels.delete(e);for(let[r,i]of this.animations)i.channel===e&&this.detachAnimation(r)}isFinished(e){let r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;let r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);let r=this.channels.values();for(let n of r)this._setChannelTime(n,this.time);let i=this.animations.values();for(let n of i){let{animation:s,channel:a}=n;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){let i=kie++;return this.animations.set(i,{animation:e,channel:r}),e.setTime(this.getTime(r)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){let i=r-e.delay,n=e.duration*e.repeat;i>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}};function SF(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function IF(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var Nie=0,zie={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Hm.stats.get(`animation-loop-${Nie++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1},N1=class{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...zie,...e},e=this.props,!e.device)throw new Error("No device provided");let{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new Go({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){let i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){let r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=SF(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(IF(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){let e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:e,height:r,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);let i=this.props.onAddHTML(r);i&&(r.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[e,r]=this.device?.canvasContext?.getPixelSize()||[1,1],i=1,n=this.device?.canvasContext?.canvas;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:e>0&&r>0&&(i=e/r),{width:e,height:r,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};var yM={};function Ol(t="id"){yM[t]=yM[t]||1;let e=yM[t]++;return`${t}-${e}`}var zv=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Ol("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&qi.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(let e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}};function MF(t,e){if(e instanceof zv)return e;let r=Uie(t,e),{attributes:i,bufferLayout:n}=Vie(t,e);return new zv({topology:e.topology||"triangle-list",bufferLayout:n,vertexCount:e.vertexCount,indices:r,attributes:i})}function Uie(t,e){if(!e.indices)return;let r=e.indices.value;return t.createBuffer({usage:qi.INDEX,data:r})}function Vie(t,e){let r=[],i={};for(let[s,a]of Object.entries(e.attributes)){let c=s;switch(s){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(a){i[c]=t.createBuffer({data:a.value,id:`${s}-buffer`});let{value:h,size:p,normalized:x}=a;r.push({name:c,format:BS(h,p,x)})}}let n=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:r,vertexCount:n}}var Uv=class t{static defaultProps={...Iu.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new t(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){let r={...Iu.defaultProps,...e},i=this._hashRenderPipeline(r);if(!this._renderPipelineCache[i]){let n=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._renderPipelineCache[i]={pipeline:n,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){let r={...Wm.defaultProps,...e},i=this._hashComputePipeline(r);if(!this._computePipelineCache[i]){let n=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._computePipelineCache[i]={pipeline:n,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){let r=e.hash,i=e instanceof Wm?this._computePipelineCache:this._renderPipelineCache;i[r].useCount--,i[r].useCount===0&&this.destroyPolicy==="unused"&&(i[r].pipeline.destroy(),delete i[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){let r=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,n="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${i}V${n}BL${s}`;default:let a=this._getHash(JSON.stringify(e.parameters));return`${r}/${i}V${n}T${e.topology}P${a}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};var Vv=class t{static defaultProps={...Up.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new t(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){let r=this._hashShader(e),i=this._cache[r];if(!i){let n=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=i={shader:n,useCount:0}}return i.useCount++,i.shader}release(e){let r=this._hashShader(e),i=this._cache[r];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[r],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};function PF(t,e){let r={},i="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(let n of t.attributes)if(n){let s=`${n.location} ${n.name}: ${n.type}`;r[`in ${s}`]={[i]:n.stepMode||"vertex"}}for(let n of t.varyings||[]){let s=`${n.location} ${n.name}`;r[`out ${s}`]={[i]:JSON.stringify(n)}}return r}var vo=null,xM=null;function RF(t,{id:e,minimap:r,opaque:i,top:n="0",left:s="0",rgbaScale:a=1}){vo||(vo=document.createElement("canvas"),vo.id=e,vo.title=e,vo.style.zIndex="100",vo.style.position="absolute",vo.style.top=n,vo.style.left=s,vo.style.border="blue 5px solid",vo.style.transform="scaleY(-1)",document.body.appendChild(vo),xM=vo.getContext("2d")),(vo.width!==t.width||vo.height!==t.height)&&(vo.width=t.width/2,vo.height=t.height/2,vo.style.width="400px",vo.style.height="400px");let c=t.device.readPixelsToArrayWebGL(t),h=xM?.createImageData(t.width,t.height);if(h){for(let x=0;x<c.length;x+=4)h.data[0+x+0]=c[x+0]*a,h.data[0+x+1]=c[x+1]*a,h.data[0+x+2]=c[x+2]*a,h.data[0+x+3]=i?255:c[x+3]*a;xM?.putImageData(h,0,0)}}function jv(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!jv(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let s of i)if(!e.hasOwnProperty(s)||!jv(t[s],e[s],r-1))return!1;return!0}return!1}function BF(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function LF(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function z1(t){return BF(t)||LF(t)}function jie(t){return z1(t)||typeof t=="number"||typeof t=="boolean"}function Gv(t){let e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{let i=t[r];jie(i)?e.uniforms[r]=i:e.bindings[r]=i}),e}var Hv=class{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,r){Object.assign(this.options,r);let i=jm(Object.values(e).filter(n=>n.dependencies));for(let n of i)e[n.name]=n;jt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(let[n,s]of Object.entries(e))this._addModule(s),s.name&&n!==s.name&&!this.options.disableWarnings&&jt.warn(`Module name: ${n} vs ${s.name}`)()}destroy(){}setProps(e){for(let r of Object.keys(e)){let i=r,n=e[i]||{},s=this.modules[i];if(!s){this.options.disableWarnings||jt.warn(`Module ${r} not found`)();continue}let a=this.moduleUniforms[i],c=this.moduleBindings[i],h=s.getUniforms?.(n,a)||n,{uniforms:p,bindings:x}=Gv(h);this.moduleUniforms[i]={...a,...p},this.moduleBindings[i]={...c,...x}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let e={};for(let r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){let e={};for(let[r,i]of Object.entries(this.moduleUniforms))for(let[n,s]of Object.entries(i))e[`${r}.${n}`]={type:this.modules[r].uniformTypes?.[n],value:String(s)};return e}_addModule(e){let r=e.name;this.moduleUniforms[r]=e.defaultUniforms||{},this.moduleBindings[r]={}}};var Gie="";async function OF(t,e){let r=new Image;return r.crossOrigin=e?.crossOrigin||"anonymous",r.src=t.startsWith("http")?t:Gie+t,await r.decode(),e?await createImageBitmap(r,e):await createImageBitmap(r)}var p0=class{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,r){this.device=e,this.id=r.id||Ol("async-texture"),typeof r?.data=="string"&&r.dimension==="2d"&&(r={...r,data:OF(r.data)}),this.ready=new Promise((i,n)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=n}),this.initAsync(r)}async initAsync(e){let r=e.data,i;try{i=await DF(r)}catch(s){this.rejectReady(s)}if(this.destroyed)return;let n={...e,data:i};this.texture=this.device.createTexture(n),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){let r=this.texture;this.texture=r.clone(e),r.destroy()}return!0}};async function DF(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(DF));if(t&&typeof t=="object"&&t.constructor===Object){let e=t,r=await Promise.all(Object.values(e)),i=Object.keys(e),n={};for(let s=0;s<i.length;s++)n[i[s]]=r[s];return n}return t}var nA=2,Hie=1e4,di=class t{static defaultProps={...Iu.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Np.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,r){this.props={...t.defaultProps,...r},r=this.props,this.id=r.id||Ol("model"),this.device=e,Object.assign(this.userData,r.userData);let i=Object.fromEntries(this.props.modules?.map(h=>[h.name,h])||[]),n=r.shaderInputs||new Hv(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(n);let s=$ie(e),a=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){let{source:h,getUniforms:p}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:a});this.source=h,this._getModuleUniforms=p,this.props.shaderLayout||=iI(this.source)}else{let{vs:h,fs:p,getUniforms:x}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:a});this.vs=h,this.fs=p,this._getModuleUniforms=x}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||Uv.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||Vv.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniformsWebGL(r.uniforms),r.moduleSettings&&this.updateModuleSettingsWebGL(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let r=this._areBindingsLoading();if(r)return jt.info(nA,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let n=this._getBindings();this.pipeline.setBindings(n,{disableWarnings:this.props.disableWarnings}),bM(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:s}=this.vertexArray,a=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:a,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();let r=e&&MF(this.device,e);if(r){this.setTopology(r.topology||"triangle-list");let i=new Gp(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){let r=new Gp(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){jv(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new s1(this.shaderInputs.modules);for(let[r,i]of Object.entries(this.shaderInputs.modules))if(Wie(i)){let n=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){let i=r?.disableWarnings??this.props.disableWarnings;e.indices&&jt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=LS(this.pipeline.shaderLayout,this.bufferLayout);let n=new Gp(this.bufferLayout);for(let[s,a]of Object.entries(e)){let c=n.getBufferLayout(s);if(!c){i||jt.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}let h=n.getAttributeNamesForBuffer(c),p=!1;for(let x of h){let T=this._attributeInfos[x];if(T){let R=this.device.type==="webgpu"?n.getBufferIndex(T.bufferName):T.location;this.vertexArray.setBuffer(R,a),p=!0}}!p&&!i&&jt.warn(`Model(${this.id}): Ignoring buffer "${a.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(let[i,n]of Object.entries(e)){let s=this._attributeInfos[i];s?this.vertexArray.setConstantWebGL(s.location,n):(r?.disableWarnings??this.props.disableWarnings)||jt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){bM(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){let{bindings:r,uniforms:i}=Gv(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(let e of Object.values(this.bindings))if(e instanceof p0&&!e.isReady)return e.id;return!1}_getBindings(){let e={};for(let[r,i]of Object.entries(this.bindings))i instanceof p0?i.isReady&&(e[r]=i.texture):e[r]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(let r of Object.values(this.bindings))r instanceof zp?e=Math.max(e,r.texture.updateTimestamp):r instanceof qi||r instanceof sn?e=Math.max(e,r.updateTimestamp):r instanceof p0?e=r.texture?Math.max(e,r.texture.updateTimestamp):1/0:r instanceof Vp||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){let r={...e.attributes};for(let[i]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(n=>n.name===i)&&i!=="positions"&&delete r[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(jt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),n=null;this.source?n=i:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:n}),this._attributeInfos=bb(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let e=jt.level>3?0:Hie;jt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,jt.group(nA,`>>> DRAWING MODEL ${this.id}`,{collapsed:jt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let e=PF(this.pipeline.shaderLayout,this.id);jt.table(nA,e)();let r=this.shaderInputs.getDebugTable();for(let[n,s]of Object.entries(this.uniforms))r[n]={value:s};jt.table(nA,r)();let i=this._getAttributeDebugTable();jt.table(nA,this._attributeInfos)(),jt.table(nA,i)(),jt.groupEnd(nA)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){let r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;let i=e.props.framebuffer;i&&RF(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){let e={};for(let[r,i]of Object.entries(this._attributeInfos)){let n=this.vertexArray.attributes[i.location];e[i.location]={name:r,type:i.shaderType,values:n?this._getBufferOrConstantValues(n,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:r}=this.vertexArray,i=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,r){let i=o1(r);return(e instanceof qi?new i(e.debugData):e).toString()}};function Wie(t){return!!(t.uniformTypes&&!bM(t.uniformTypes))}function $ie(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function bM(t){for(let e in t)return!1;return!0}var Fu=class t{device;model;transformFeedback;static defaultProps={...di.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,r=t.defaultProps){if(!t.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new di(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||q_(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);let r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){let r=this.getBuffer(e);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof qi)return r.readAsync();let{buffer:i,byteOffset:n=0,byteLength:s=i.byteLength}=r;return i.readAsync(n,s)}};var qie="transform_output",A0=class{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,r){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new di(this.device,{id:r.id||"texture-transform-model",fs:r.fs||q_({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:qie}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){this.model.destroy();for(let e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){let{framebuffer:r}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:r,...e});this.model.draw(i),i.end()}getTargetTexture(){let{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:r,sourceTextures:i,targetTexture:n}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),n){e.targetTexture=n;let{width:s,height:a}=n;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:s,height:a,colorAttachments:[n]}),e.framebuffer.resize({width:s,height:a})}return e}_setSourceTextureParameters(){let e=this.currentIndex,{sourceTextures:r}=this.bindings[e];for(let i in r)r[i].sampler=this.sampler}};var Qi=class{id;topology;vertexCount;indices;attributes;userData={};constructor(e){let{attributes:r={},indices:i=null,vertexCount:n=null}=e;this.id=e.id||Ol("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(let[s,a]of Object.entries(r)){let c=ArrayBuffer.isView(a)?{value:a}:a;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!c.size&&(c.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[s]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let i=1/0;for(let n of Object.values(e)){let{value:s,size:a,constant:c}=n;!c&&s&&a!==void 0&&a>=1&&(i=Math.min(i,s.length/a))}return i}};var ku=class{id;matrix=new Er;display=!0;position=new st;rotation=new st;scale=new st(1,1,1);userData={};props={};constructor(e={}){let{id:r}=e;this.id=r||Ol(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,r=!0){r?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:r,rotation:i,scale:n,update:s=!0}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),s&&this.updateMatrix(),this}updateMatrix(){let e=this.position,r=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(r),this.matrix.scale(i),this}update(e={}){let{position:r,rotation:i,scale:n}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,r){r=r||this.matrix;let i=new Er(e).multiplyRight(r),n=i.invert(),s=n.transpose();return{viewMatrix:e,modelMatrix:r,objectMatrix:r,worldMatrix:i,worldInverseMatrix:n,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}};var Wh=class t extends ku{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;let{children:r=[]}=e;jt.assert(r.every(i=>i instanceof ku),"every child must an instance of ScenegraphNode"),super(e),this.children=r}getBounds(){let e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:i})=>{let n=r.getBounds();if(!n)return;let[s,a]=n,c=new st(s).add(a).divide([2,2,2]);i.transformAsPoint(c,c);let h=new st(a).subtract(s).divide([2,2,2]);i.transformAsVector(h,h);for(let p=0;p<8;p++){let x=new st(p&1?-1:1,p&2?-1:1,p&4?-1:1).multiply(h).add(c);for(let T=0;T<3;T++)e[0][T]=Math.min(e[0][T],x[T]),e[1][T]=Math.max(e[1][T],x[T])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(let r of e)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){let r=this.children,i=r.indexOf(e);return i>-1&&r.splice(i,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:r=new Er}={}){let i=new Er(r).multiplyRight(this.matrix);for(let n of this.children)n instanceof t?n.traverse(e,{worldMatrix:i}):e(n,{worldMatrix:i})}};var yd=class extends ku{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(e){return this.model.draw(e)}};var sA=class extends Qi{constructor(e={}){let{id:r=Ol("cube-geometry"),indices:i=!0}=e;super(i?{...e,id:r,topology:"triangle-list",indices:{size:1,value:Zie},attributes:{...tne,...e.attributes}}:{...e,id:r,topology:"triangle-list",indices:void 0,attributes:{...rne,...e.attributes}})}},Zie=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Xie=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Yie=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Kie=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),Qie=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),Jie=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),ene=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),tne={POSITION:{size:3,value:Xie},NORMAL:{size:3,value:Yie},TEXCOORD_0:{size:2,value:Kie}},rne={POSITION:{size:3,value:Qie},TEXCOORD_0:{size:2,value:Jie},COLOR_0:{size:3,value:ene}};var ine={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"},oA=class extends Hh{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:s,pickingFBO:a,deviceRect:{x:c,y:h,width:p,height:x},cullRect:T,effects:R,pass:k="picking",pickZ:j,shaderModuleProps:q}){this.pickZ=j;let X=this._resetColorEncoder(j),re=[c,h,p,x],te=super.render({target:a,layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:s,cullRect:T,effects:R?.filter(ae=>ae.useInPicking),pass:k,isPicking:!0,shaderModuleProps:q,clearColor:[0,0,0,0],colorMask:15,scissorRect:re});return this._colorEncoderState=null,{decodePickingColor:X&&sne.bind(null,X),stats:te}}shouldDrawLayer(e){let{pickable:r,operation:i}=e.props;return r&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,r,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,r,i){let n={...e.props.parameters},{pickable:s,operation:a}=e.props;return!this._colorEncoderState||a.includes("terrain")?n.blend=!1:s&&a.includes("draw")&&(Object.assign(n,ine),n.blend=!0,n.blendColor=nne(this._colorEncoderState,e,i)),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function nne(t,e,r){let{byLayer:i,byAlpha:n}=t,s,a=i.get(e);return a?(a.viewports.push(r),s=a.a):(s=i.size+1,s<=255?(a={a:s,layer:e,viewports:[r]},i.set(e,a),n[s]=a):(ur.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function sne(t,e){let r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}var xd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},m0=Symbol.for("component"),Dl=Symbol.for("propTypes"),Wv=Symbol.for("deprecatedProps"),$h=Symbol.for("asyncPropDefaults"),Nu=Symbol.for("asyncPropOriginal"),Pc=Symbol.for("asyncPropResolved");function Ra(t,e=()=>!0){return Array.isArray(t)?FF(t,e,[]):e(t)?[t]:[]}function FF(t,e,r){let i=-1;for(;++i<t.length;){let n=t[i];Array.isArray(n)?FF(n,e,r):e(n)&&r.push(n)}return r}function vM({target:t,source:e,start:r=0,count:i=1}){let n=e.length,s=i*n,a=0;for(let c=r;a<n;a++)t[c++]=e[a];for(;a<s;)a<s-a?(t.copyWithin(r+a,r,r+a),a*=2):(t.copyWithin(r+a,r,r+s-a),a=s);return t}var U1=class{constructor(e,r,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;let i=++this._loadCount,n=e;typeof e=="string"&&(n=yo(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(let s of this._subscribers)s.onChange(this.getData())}};var V1=class{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:i=!1,persistent:n=!0}){let s=this._resources[e];s?s.setData(r,i):(s=new U1(e,r,this._context),this._resources[e]=s),s.persistent=n}remove(e){let r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let r=this._consumers[e];if(r){for(let i in r){let n=r[i],s=this._resources[n.resourceId];s&&s.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:i,requestId:n="default"}){let{_resources:s,protocol:a}=this;e.startsWith(a)&&(e=e.replace(a,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));let c=s[e];if(this._track(i,n,c,r),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,r,i,n){let s=this._consumers,a=s[e]=s[e]||{},c=a[r],h=c&&c.resourceId&&this._resources[c.resourceId];h&&(h.unsubscribe(c),this.prune()),i&&(c?(c.onChange=n,c.resourceId=i.id):c={onChange:n,resourceId:i.id},a[r]=c,i.subscribe(c))}_prune(){this._pruneRequest=null;for(let e of Object.keys(this._resources)){let r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}};var one="layerManager.setLayers",ane="layerManager.activateViewport",j1=class{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{ps(ane,this,c),c&&(this.context.viewport=c)};let{deck:i,stats:n,viewport:s,timeline:a}=r||{};this.layers=[],this.resourceManager=new V1({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:AF(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[QI],renderPass:void 0,stats:n||new Go({id:"deck.gl"}),viewport:s||new sl({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new iA,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(let i of this.layers){let n=i.getNeedsRedraw(e);r=r||n}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(i=>r.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){ps(one,this,r,e),this._lastRenderedLayers=e;let i=Ra(e,Boolean);for(let n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){let{defaultShaderModules:r}=this.context;r.find(i=>i.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){let{defaultShaderModules:r}=this.context,i=r.findIndex(n=>n.name===e.name);i>=0&&(r.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,i){i.raiseError(r,`${e} of ${i}`)}_updateLayers(e,r){let i={};for(let a of e)i[a.id]?ur.warn(`Multiple old layers with same id ${a.id}`)():i[a.id]=a;if(this._defaultShaderModulesChanged){for(let a of e)a.setNeedsUpdate(),a.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let n=[];this._updateSublayersRecursively(r,i,n),this._finalizeOldLayers(i);let s=!1;for(let a of n)if(a.hasUniformTransition()){s=`Uniform transition in ${a}`;break}this._needsUpdate=s,this.layers=n}_updateSublayersRecursively(e,r,i){for(let n of e){n.context=this.context;let s=r[n.id];s===null&&ur.warn(`Multiple new layers with same id ${n.id}`)(),r[n.id]=null;let a=null;try{this._debug&&s!==n&&n.validateProps(),s?(this._transferLayerState(s,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),a=n.isComposite?n.getSubLayers():null}catch(c){this._handleError("matching",c,n)}a&&this._updateSublayersRecursively(a,r,i)}}_finalizeOldLayers(e){for(let r in e){let i=e[r];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=xd.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=xd.MATCHED,r!==e&&(e.lifecycle=xd.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=xd.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=xd.FINALIZED}catch(r){this._handleError("finalization",r,e)}}};function An(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!An(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let s of i)if(!e.hasOwnProperty(s)||!An(t[s],e[s],r-1))return!1;return!0}return!1}var G1=class{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){let e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){let r=typeof e=="string"?this.getView(e):e,i=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,r){let i=this.getViewports(),n={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){let a=i[s];if(a.containsPixel(n)){let c=e.slice();return c[0]-=a.x,c[1]-=a.y,a.unproject(c,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Ra(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!An(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ur.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){let i=r.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>this.getView(e.id)?.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,r,i,n){let s=e.controller;if(s&&i){let a={...r,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==s.type)&&(n=this._createController(e,a)),n&&n.setProps(a),n}return null}_rebuildViewports(){let{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=e.length;n--;){let s=e[n],a=this.getViewState(s),c=s.makeViewport({viewState:a,width:this.width,height:this.height}),h=r[s.id],p=!!s.controller;p&&!h&&(i=!0),(i||!p)&&h&&(h.finalize(),h=null),this.controllers[s.id]=this._updateController(s,a,c,h),c&&this._viewports.unshift(c)}for(let n in r){let s=r[n];s&&!this.controllers[n]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((i,n)=>!e[n].equals(r[n]))}};var lne=/([0-9]+\.?[0-9]*)(%|px)/;function qh(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":let e=lne.exec(t);if(e&&e.length>=3){let r=e[2]==="%",i=parseFloat(e[1]);return{position:r?i/100:i,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function Zh(t,e){return t.relative?Math.round(t.position*e):t.position}var aA=class{constructor(e){let{id:r,x:i=0,y:n=0,width:s="100%",height:a="100%",padding:c=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=qh(i),this._y=qh(n),this._width=qh(s),this._height=qh(a),this._padding=c&&{left:qh(c.left||0),right:qh(c.right||0),top:qh(c.top||0),bottom:qh(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&An(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:i}){i=this.filterViewState(i);let n=this.getDimensions({width:e,height:r});if(!n.height||!n.width)return null;let s=this.getViewportType(i);return new s({...i,...this.props,...n})}getViewStateId(){let{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let r={...e};for(let i in this.props.viewState)i!=="id"&&(r[i]=this.props.viewState[i]);return r}return e}getDimensions({width:e,height:r}){let i={x:Zh(this._x,e),y:Zh(this._y,r),width:Zh(this._width,e),height:Zh(this._height,r)};return this._padding&&(i.padding={left:Zh(this._padding.left,e),top:Zh(this._padding.top,r),right:Zh(this._padding.right,e),bottom:Zh(this._padding.bottom,r)}),i}get controller(){let e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}};var Rc=class{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:e,settings:r}=this;this._handle=e.addChannel({delay:e.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var kF=()=>{},wM={BREAK:1,SNAP_TO_END:2,IGNORE:3},cne=t=>t,une=wM.BREAK,H1=class{constructor(e){this._onTransitionUpdate=r=>{let{time:i,settings:{interpolator:n,startProps:s,endProps:a,duration:c,easing:h}}=r,p=h(i/c),x=n.interpolateProps(s,a,p);this.propsInTransition=this.getControllerState({...this.props,...x}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Rc(e.timeline),this.onViewStateChange=e.onViewStateChange||kF,this.onStateChange=e.onStateChange||kF}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){let{interruption:s,endProps:a}=this.transition.settings;n={...i,...s===wM.SNAP_TO_END?a:this.propsInTransition||i}}this._triggerTransition(n,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:r,transitionInterpolator:i}=e;return(r>0||r==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===wM.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){let i=this.getControllerState(e),n=this.getControllerState(r).shortestPathFrom(i),s=r.transitionInterpolator,a=s.getDuration?s.getDuration(e,r):r.transitionDuration;if(a===0)return;let c=s.initializeProps(e,n);this.propsInTransition={};let h={duration:a,easing:r.transitionEasing||cne,interpolator:s,interruption:r.transitionInterruption||une,startProps:c.start,endProps:c.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(r)}}};function yn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}var W1=class{constructor(e){let{compare:r,extract:i,required:n}=e;this._propsToCompare=r,this._propsToExtract=i||r,this._requiredProps=n}arePropsEqual(e,r){for(let i of this._propsToCompare)if(!(i in e)||!(i in r)||!Hs(e[i],r[i]))return!1;return!0}initializeProps(e,r){let i={},n={};for(let s of this._propsToExtract)(s in e||s in r)&&(i[s]=e[s],n[s]=r[s]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{let i=e[r];yn(Number.isFinite(i)||Array.isArray(i),`${r} is required for transition`)})}};var hne=["longitude","latitude","zoom","bearing","pitch"],fne=["longitude","latitude","zoom"],Xh=class extends W1{constructor(e={}){let r=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:hne,required:fne},super(i.transitionProps),this.opts=i}initializeProps(e,r){let i=super.initializeProps(e,r),{makeViewport:n,around:s}=this.opts;if(n&&s){let a=n(e),c=n(r),h=a.unproject(s);i.start.around=s,Object.assign(i.end,{around:c.project(h),aroundPosition:h,width:r.width,height:r.height})}return i}interpolateProps(e,r,i){let n={};for(let s of this._propsToExtract)n[s]=Do(e[s]||0,r[s]||0,i);if(r.aroundPosition&&this.opts.makeViewport){let s=this.opts.makeViewport({...r,...n});Object.assign(n,s.panByPosition(r.aroundPosition,Do(e.around,r.around,i)))}return n}};var bd={transitionDuration:0},dne=300,$v=t=>1-(1-t)*(1-t),g0={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},lA={},cA=class{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new H1({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return r?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:r,y:i}=this.props,{offsetCenter:n}=e;return[n.x-r,n.y-i]}isPointInBounds(e,r){let{width:i,height:n}=this.props;if(r&&r.handled)return!1;let s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=n;return s&&r&&r.stopPropagation(),s}isFunctionKeyPressed(e){let{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?dne:0;let{scrollZoom:i=!0,dragPan:n=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:c=!0,touchRotate:h=!1,keyboard:p=!0}=e,x=!!this.onViewStateChange;this.toggleEvents(g0.WHEEL,x&&i),this.toggleEvents(g0.PAN,x),this.toggleEvents(g0.PINCH,x&&(c||h)),this.toggleEvents(g0.MULTI_PAN,x&&h),this.toggleEvents(g0.DOUBLE_CLICK,x&&a),this.toggleEvents(g0.KEYBOARD,x&&p),this.scrollZoom=i,this.dragPan=n,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=c,this.touchRotate=h,this.keyboard=p}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(i=>{this._events[i]!==r&&(this._events[i]=r,r?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,r=null,i={}){let n={...e.getViewportProps(),...r},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){let a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:a,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);let n=this.controllerState[i?"panStart":"rotateStart"]({pos:r});return this._panMove=i,this.updateViewport(n,bd,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;let r=this.getCenter(e),i=this.controllerState.pan({pos:r});return this.updateViewport(i,bd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:r}=this;if(this.dragPan&&r&&e.velocity){let i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],s=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:$v},{isDragging:!1,isPanning:!0})}else{let i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let r=this.getCenter(e),i=this.controllerState.rotate({pos:r});return this.updateViewport(i,bd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){let i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],s=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:$v},{isDragging:!1,isRotating:!0})}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();let{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e,a=2/(1+Math.exp(-Math.abs(s*i)));s<0&&a!==0&&(a=1/a);let c=this.controllerState.zoom({pos:r,scale:a});return this.updateViewport(c,{...this._getTransitionProps({around:r}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.controllerState.rotateStart({pos:r});return this.updateViewport(i,bd,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;let r=this.getCenter(e);r[0]-=e.deltaX;let i=this.controllerState.rotate({pos:r});return this.updateViewport(i,bd,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;let{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){let i=this.getCenter(e),n=[i[0],i[1]+=e.velocityY*r/2],s=this.controllerState.rotate({pos:n});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:$v},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return lA._startPinchRotation=e.rotation,lA._lastPinchEvent=e,this.updateViewport(i,bd,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){let{scale:i}=e,n=this.getCenter(e);r=r.zoom({pos:n,scale:i})}if(this.touchRotate){let{rotation:i}=e;r=r.rotate({deltaAngleX:lA._startPinchRotation-i})}return this.updateViewport(r,bd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),lA._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:r}=this,{_lastPinchEvent:i}=lA;if(this.touchZoom&&r&&i&&e.scale!==i.scale){let n=this.getCenter(e),s=this.controllerState.rotateEnd(),a=Math.log2(e.scale),c=(a-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),h=Math.pow(2,a+c*r/2);s=s.zoom({pos:n,scale:h}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:n}),transitionDuration:r,transitionEasing:$v},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{let n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return lA._startPinchRotation=null,lA._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:r,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this,h,p={};switch(e.srcEvent.code){case"Minus":h=r?c.zoomOut(i).zoomOut(i):c.zoomOut(i),p.isZooming=!0;break;case"Equal":h=r?c.zoomIn(i).zoomIn(i):c.zoomIn(i),p.isZooming=!0;break;case"ArrowLeft":r?(h=c.rotateLeft(s),p.isRotating=!0):(h=c.moveLeft(n),p.isPanning=!0);break;case"ArrowRight":r?(h=c.rotateRight(s),p.isRotating=!0):(h=c.moveRight(n),p.isPanning=!0);break;case"ArrowUp":r?(h=c.rotateUp(a),p.isRotating=!0):(h=c.moveUp(n),p.isPanning=!0);break;case"ArrowDown":r?(h=c.rotateDown(a),p.isRotating=!0):(h=c.moveDown(n),p.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),p),!0}_getTransitionProps(e){let{transition:r}=this;return!r||!r.transitionInterpolator?bd:e?{...r,transitionInterpolator:new Xh({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}};var $1=class{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}};var NF=5,pne=1.2,q1=class extends $1{constructor(e){let{width:r,height:i,latitude:n,longitude:s,zoom:a,bearing:c=0,pitch:h=0,altitude:p=1.5,position:x=[0,0,0],maxZoom:T=20,minZoom:R=0,maxPitch:k=60,minPitch:j=0,startPanLngLat:q,startZoomLngLat:X,startRotatePos:re,startBearing:te,startPitch:oe,startZoom:ae,normalize:pe=!0}=e;yn(Number.isFinite(s)),yn(Number.isFinite(n)),yn(Number.isFinite(a)),super({width:r,height:i,latitude:n,longitude:s,zoom:a,bearing:c,pitch:h,altitude:p,maxZoom:T,minZoom:R,maxPitch:k,minPitch:j,normalize:pe,position:x},{startPanLngLat:q,startZoomLngLat:X,startRotatePos:re,startBearing:te,startPitch:oe,startZoom:ae}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){let i=this.getState().startPanLngLat||this._unproject(r);if(!i)return this;let s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:i=0}){let{startRotatePos:n,startBearing:s,startPitch:a}=this.getState();if(!n||s===void 0||a===void 0)return this;let c;return e?c=this._getNewRotation(e,n,a,s):c={bearing:s+r,pitch:a+i},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:i}){let{startZoom:n,startZoomLngLat:s}=this.getState();if(s||(n=this.getViewportProps().zoom,s=this._unproject(r)||this._unproject(e)),!s)return this;let{maxZoom:a,minZoom:c}=this.getViewportProps(),h=n+Math.log2(i);h=xo(h,c,a);let p=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...p.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let r=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:s}=i;return Math.abs(n-r.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(s-r.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){let{maxZoom:r,minZoom:i,zoom:n}=e;e.zoom=xo(n,i,r);let{maxPitch:s,minPitch:a,pitch:c}=e;e.pitch=xo(c,a,s);let{normalize:h=!0}=e;return h&&Object.assign(e,AM(e)),e}_zoomFromCenter(e){let{width:r,height:i}=this.getViewportProps();return this.zoom({pos:[r/2,i/2],scale:e})}_panFromCenter(e){let{width:r,height:i}=this.getViewportProps();return this.pan({startPos:[r/2,i/2],pos:[r/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,i,n){let s=e[0]-r[0],a=e[1]-r[1],c=e[1],h=r[1],{width:p,height:x}=this.getViewportProps(),T=s/p,R=0;a>0?Math.abs(x-h)>NF&&(R=a/(h-x)*pne):a<0&&h>NF&&(R=1-c/h),R=xo(R,-1,1);let{minPitch:k,maxPitch:j}=this.getViewportProps(),q=n+180*T,X=i;return R>0?X=i+R*(j-i):R<0&&(X=i-R*(k-i)),{pitch:X,bearing:q}}},Z1=class extends cA{constructor(){super(...arguments),this.ControllerState=q1,this.transition={transitionDuration:300,transitionInterpolator:new Xh({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];let r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};var qv=class extends aA{constructor(e={}){super(e)}getViewportType(){return Du}get ControllerType(){return Z1}};qv.displayName="MapView";var X1=qv;var Ane=new h0;function mne(t,e){let r=t.order??1/0,i=e.order??1/0;return r-i}var Y1=class{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){let r=this._defaultEffects;if(!r.find(i=>i.id===e.id)){let i=r.findIndex(n=>mne(n,e)>0);i<0?r.push(e):r.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(An(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){let r={};for(let n of this.effects)r[n.id]=n;let i=[];for(let n of e){let s=r[n.id],a=n;s&&s!==n?s.setProps?(s.setProps(n.props),a=s):s.cleanup(this._context):s||n.setup(this._context),i.push(a),delete r[n.id]}for(let n in r)r[n].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(n=>n instanceof h0)||this._resolvedEffects.push(Ane),this._needsRedraw="effects changed"}finalize(){for(let e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}};var K1=class extends Hh{shouldDrawLayer(e){let{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}};var gne="deckRenderer.renderLayers",Q1=class{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new K1(e),this.pickLayersPass=new oA(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;let r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);let n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);let s=r.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,ps(gne,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){let{renderBuffers:e}=this;for(let r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(let i of e)r.preRenderStats[i.id]=i.preRender(r),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{let n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[n]}))});for(let i of e)i.resize(r)}_postRender(e,r){let{renderBuffers:i}=this,n={...r,inputBuffer:i[0],swapBuffer:i[1]};for(let s of e)if(s.postRender){n.target=s.id===this.lastPostProcessEffect?r.target:void 0;let a=s.postRender(n);n.inputBuffer=a,n.swapBuffer=a===i[0]?i[1]:i[0]}}};var _ne={pickedColor:null,pickedObjectIndex:-1};function zF({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:i,deviceRadius:n,deviceRect:s}){let{x:a,y:c,width:h,height:p}=s,x=n*n,T=-1,R=0;for(let k=0;k<p;k++){let j=k+c-i,q=j*j;if(q>x)R+=4*h;else for(let X=0;X<h;X++){if(t[R+3]-1>=0){let te=X+a-r,oe=te*te+q;oe<=x&&(x=oe,T=R)}R+=4}}if(T>=0){let k=t.slice(T,T+4),j=e(k);if(j){let q=Math.floor(T/4/h),X=T/4-q*h;return{...j,pickedColor:k,pickedX:a+X,pickedY:c+q}}ur.error("Picked non-existent layer. Is picking buffer corrupt?")()}return _ne}function UF({pickedColors:t,decodePickingColor:e}){let r=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){let s=t.slice(i,i+4),a=s.join(",");if(!r.has(a)){let c=e(s);c?r.set(a,{...c,color:s}):ur.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function TM({pickInfo:t,viewports:e,pixelRatio:r,x:i,y:n,z:s}){let a=e[0];e.length>1&&(a=yne(t?.pickedViewports||e,{x:i,y:n}));let c;if(a){let h=[i-a.x,n-a.y];s!==void 0&&(h[2]=s),c=a.unproject(h)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:c,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function VF(t){let{pickInfo:e,lastPickedInfo:r,mode:i,layers:n}=t,{pickedColor:s,pickedLayer:a,pickedObjectIndex:c}=e,h=a?[a]:[];if(i==="hover"){let T=r.index,R=r.layerId,k=a?a.props.id:null;if(k!==R||c!==T){if(k!==R){let j=n.find(q=>q.props.id===R);j&&h.unshift(j)}r.layerId=k,r.index=c,r.info=null}}let p=TM(t),x=new Map;return x.set(null,p),h.forEach(T=>{let R={...p};T===a&&(R.color=s,R.index=c,R.picked=!0),R=EM({layer:T,info:R,mode:i});let k=R.layer;T===a&&i==="hover"&&(r.info=R),x.set(k.id,R),i==="hover"&&k.updateAutoHighlight(R)}),x}function EM({layer:t,info:e,mode:r}){for(;t&&e;){let i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:i}),t=t.parent}return e}function yne(t,e){for(let r=t.length-1;r>=0;r--){let i=t[r];if(i.containsPixel(e))return i}return t[0]}var J1=class{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new oA(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:i,viewports:n},s=this.lastPickedInfo.info){let a=s&&s.layer&&s.layer.id,c=s&&s.viewport&&s.viewport.id,h=a?i.find(R=>R.id===a):null,p=c&&n.find(R=>R.id===c)||n[0],x=p&&p.unproject([e-p.x,r-p.y]);return{...s,...{x:e,y:r,viewport:p,coordinate:x,layer:h}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}let{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;let r=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:i,x:n,y:s,radius:a=0,depth:c=1,mode:h="query",unproject3D:p,onViewportActive:x,effects:T}){let R=this.device.canvasContext.cssToDeviceRatio(),k=this._getPickable(e);if(!k||i.length===0)return{result:[],emptyInfo:TM({viewports:i,x:n,y:s,pixelRatio:R})};this._resizeBuffer();let j=this.device.canvasContext.cssToDevicePixels([n,s],!0),q=[j.x+Math.floor(j.width/2),j.y+Math.floor(j.height/2)],X=Math.round(a*R),{width:re,height:te}=this.pickingFBO,oe=this._getPickingRect({deviceX:q[0],deviceY:q[1],deviceRadius:X,deviceWidth:re,deviceHeight:te}),ae={x:n-a,y:s-a,width:a*2+1,height:a*2+1},pe,be=[],Fe=new Set;for(let Y=0;Y<c;Y++){let J;if(oe){let xe=this._drawAndSample({layers:k,views:r,viewports:i,onViewportActive:x,deviceRect:oe,cullRect:ae,effects:T,pass:`picking:${h}`});J=zF({...xe,deviceX:q[0],deviceY:q[1],deviceRadius:X,deviceRect:oe})}else J={pickedColor:null,pickedObjectIndex:-1};let Z;if(J.pickedLayer&&p&&this.depthFBO){let{pickedColors:xe}=this._drawAndSample({layers:[J.pickedLayer],views:r,viewports:i,onViewportActive:x,deviceRect:{x:J.pickedX,y:J.pickedY,width:1,height:1},cullRect:ae,effects:T,pass:`picking:${h}:z`},!0);xe[3]&&(Z=xe[0])}J.pickedLayer&&Y+1<c&&(Fe.add(J.pickedLayer),J.pickedLayer.disablePickingIndex(J.pickedObjectIndex)),pe=VF({pickInfo:J,lastPickedInfo:this.lastPickedInfo,mode:h,layers:k,viewports:i,x:n,y:s,z:Z,pixelRatio:R});for(let xe of pe.values())xe.layer&&be.push(xe);if(!J.pickedColor)break}for(let Y of Fe)Y.restorePickingColors();return{result:be,emptyInfo:pe.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:i,x:n,y:s,width:a=1,height:c=1,mode:h="query",maxObjects:p=null,onViewportActive:x,effects:T}){let R=this._getPickable(e);if(!R||i.length===0)return[];this._resizeBuffer();let k=this.device.canvasContext.cssToDeviceRatio(),j=this.device.canvasContext.cssToDevicePixels([n,s],!0),q=j.x,X=j.y+j.height,re=this.device.canvasContext.cssToDevicePixels([n+a,s+c],!0),te=re.x+re.width,oe=re.y,ae={x:q,y:oe,width:te-q,height:X-oe},pe=this._drawAndSample({layers:R,views:r,viewports:i,onViewportActive:x,deviceRect:ae,cullRect:{x:n,y:s,width:a,height:c},effects:T,pass:`picking:${h}`}),be=UF(pe),Fe=new Map,Y=[],J=Number.isFinite(p);for(let Z=0;Z<be.length&&!(J&&Y.length>=p);Z++){let xe=be[Z],_e={color:xe.pickedColor,layer:null,index:xe.pickedObjectIndex,picked:!0,x:n,y:s,pixelRatio:k};_e=EM({layer:xe.pickedLayer,info:_e,mode:h});let Be=_e.layer.id;Fe.has(Be)||Fe.set(Be,new Set);let Se=Fe.get(Be),ke=_e.object??_e.index;Se.has(ke)||(Se.add(ke),Y.push(_e))}return Y}_drawAndSample({layers:e,views:r,viewports:i,onViewportActive:n,deviceRect:s,cullRect:a,effects:c,pass:h},p=!1){let x=p?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:r,viewports:i,onViewportActive:n,pickingFBO:x,deviceRect:s,cullRect:a,effects:c,pass:h,pickZ:p,preRenderStats:{},isPicking:!0};for(let te of c)te.useInPicking&&(T.preRenderStats[te.id]=te.preRender(T));let{decodePickingColor:R}=this.pickLayersPass.render(T),{x:k,y:j,width:q,height:X}=s,re=new(p?Float32Array:Uint8Array)(q*X*4);return this.device.readPixelsToArrayWebGL(x,{sourceX:k,sourceY:j,sourceWidth:q,sourceHeight:X,target:re}),{pickedColors:re,decodePickingColor:R}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:i,deviceWidth:n,deviceHeight:s}){let a=Math.max(0,e-i),c=Math.max(0,r-i),h=Math.min(n,e+i+1)-a,p=Math.min(s,r+i+1)-c;return h<=0||p<=0?null:{x:a,y:c,width:h,height:p}}};var xne={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},bne="top-left",jF="__root",Zv=class{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!An(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(let e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){let r={};for(let i of this.resolvedWidgets)r[i.id]=i;this.resolvedWidgets.length=0;for(let i of this.defaultWidgets)r[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){let n=r[i.id];n?n.viewId!==i.viewId||n.placement!==i.placement?(this._remove(n),this._add(i)):i!==n&&(n.setProps(i.props),i=n):this._add(i),r[i.id]=null,this.resolvedWidgets.push(i)}for(let i in r){let n=r[i];n&&this._remove(n)}this.widgets=e}_add(e){let{viewId:r=null,placement:i=bne}=e,n=e.onAdd({deck:this.deck,viewId:r});n&&this._getContainer(r,i).append(n),e._element=n}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){let i=e||jF,n=this.containers[i];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",this.parentElement?.append(n),this.containers[i]=n);let s=n.querySelector(`.${r}`);return s||(s=document.createElement("div"),s.className=r,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,xne[r]),n.append(s)),s}_updateContainers(){let e=this.deck.width,r=this.deck.height;for(let i in this.containers){let n=this.lastViewports[i]||null,s=i===jF||n,a=this.containers[i];s?(a.style.display="block",a.style.left=`${n?n.x:0}px`,a.style.top=`${n?n.y:0}px`,a.style.width=`${n?n.width:e}px`,a.style.height=`${n?n.height:r}px`):a.style.display="none"}}onRedraw({viewports:e,layers:r}){let i=e.reduce((n,s)=>(n[s.id]=s,n),{});for(let n of this.getWidgets()){let{viewId:s}=n;if(s){let a=i[s];a&&(n.onViewportChange&&n.onViewportChange(a),n.onRedraw?.({viewports:[a],layers:r}))}else{if(n.onViewportChange)for(let a of e)n.onViewportChange(a);n.onRedraw?.({viewports:e,layers:r})}}this.lastViewports=i,this._updateContainers()}onHover(e,r){for(let i of this.getWidgets()){let{viewId:n}=i;(!n||n===e.viewport?.id)&&i.onHover?.(e,r)}}onEvent(e,r){let i=R1[r.type];if(i)for(let n of this.getWidgets()){let{viewId:s}=n;(!s||s===e.viewport?.id)&&n[i]?.(e,r)}}};var vne={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},ey=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){let r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,vne),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){let{deck:r}=this,i=r&&r.props.getTooltip;if(!i)return;let n=i(e);this.lastViewport=e.viewport,this.setTooltip(n,e.x,e.y)}setTooltip(e,r,i){let n=this.element;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${r}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}};var vd;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(vd||(vd={}));var ry={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ws=(t,e,r)=>e?t.enable(r):t.disable(r),GF=(t,e,r)=>t.hint(r,e),ol=(t,e,r)=>t.pixelStorei(r,e),HF=(t,e,r)=>{let i=r===36006?36009:36008;return t.bindFramebuffer(i,e)},ty=(t,e,r)=>{let n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(n,e)};function CM(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}var WF={3042:Ws,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Ws,2885:(t,e)=>t.cullFace(e),2929:Ws,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Ws,35723:GF,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:HF,36010:HF,34964:ty,36662:ty,36663:ty,35053:ty,35055:ty,2886:(t,e)=>t.frontFace(e),33170:GF,2849:(t,e)=>t.lineWidth(e),32823:Ws,32824:"polygonOffset",10752:"polygonOffset",35977:Ws,32926:Ws,32928:Ws,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ws,3088:(t,e)=>t.scissor(...e),2960:Ws,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Ws,10754:Ws,12288:Ws,12289:Ws,12290:Ws,12291:Ws,12292:Ws,12293:Ws,12294:Ws,12295:Ws,3333:ol,3317:ol,37440:ol,37441:ol,37443:ol,3330:ol,3332:ol,3331:ol,3314:ol,32878:ol,3316:ol,3315:ol,32877:ol,framebuffer:(t,e)=>{let r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{let r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{let r=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=CM(e)?e:[e,e];let[r,i]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=CM(e)&&e.length===3?[...e,...e]:e;let[r,i,n,s,a,c]=e;t.stencilFuncSeparate(1028,r,i,n),t.stencilFuncSeparate(1029,s,a,c)},stencilOp:(t,e)=>{e=CM(e)&&e.length===3?[...e,...e]:e;let[r,i,n,s,a,c]=e;t.stencilOpSeparate(1028,r,i,n),t.stencilOpSeparate(1029,s,a,c)},viewport:(t,e)=>t.viewport(...e)};function ms(t,e,r){return e[t]!==void 0?e[t]:r[t]}var $F={blendEquation:(t,e,r)=>t.blendEquationSeparate(ms(32777,e,r),ms(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(ms(32969,e,r),ms(32968,e,r),ms(32971,e,r),ms(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(ms(32824,e,r),ms(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(ms(32938,e,r),ms(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,ms(2962,e,r),ms(2967,e,r),ms(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,ms(34816,e,r),ms(36003,e,r),ms(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,ms(2964,e,r),ms(2965,e,r),ms(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,ms(34817,e,r),ms(34818,e,r),ms(34819,e,r))},SM={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{let i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:r}):{valueChanged:!0}},blendColor:(t,e,r,i,n)=>t({32773:new Float32Array([e,r,i,n])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,i,n)=>t({32969:e,32968:r,32971:i,32970:n}),clearColor:(t,e,r,i,n)=>t({3106:new Float32Array([e,r,i,n])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,i,n)=>t({3107:[e,r,i,n]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,i,n)=>t({3088:new Int32Array([e,r,i,n])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,i)=>t({2962:e,2967:r,2963:i,34816:e,36003:r,36004:i}),stencilFuncSeparate:(t,e,r,i,n)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:i,[e===1028?2963:36004]:n}),stencilOp:(t,e,r,i)=>t({2964:e,2965:r,2966:i,34817:e,34818:r,34819:i}),stencilOpSeparate:(t,e,r,i,n)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:i,[e===1028?2966:34819]:n}),viewport:(t,e,r,i,n)=>t({2978:[e,r,i,n]})},zu=(t,e)=>t.isEnabled(e),IM={3042:zu,2884:zu,2929:zu,3024:zu,32823:zu,32926:zu,32928:zu,3089:zu,2960:zu,35977:zu},qF=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Bc(t,e){if(wne(e))return;let r={};for(let n in e){let s=Number(n),a=WF[n];a&&(typeof a=="string"?r[a]=!0:a(t,e[n],s))}let i=t.state&&t.state.cache;if(i)for(let n in r){let s=$F[n];s(t,e,i)}}function Xv(t,e=ry){if(typeof e=="number"){let n=e,s=IM[n];return s?s(t,n):t.getParameter(n)}let r=Array.isArray(e)?e:Object.keys(e),i={};for(let n of r){let s=IM[n];i[n]=s?s(t,Number(n)):t.getParameter(Number(n))}return i}function ZF(t){Bc(t,ry)}function wne(t){for(let e in t)return!1;return!0}function XF(t,e){if(t===e)return!0;let r=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&i&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}var Lc=class{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,r){this.gl=e,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){let e=this.stateStack[this.stateStack.length-1];Bc(this.gl,e),this.stateStack.pop()}trackState(e,r){if(this.cache=r.copyState?Xv(e):Object.assign({},ry),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,Ene(e);for(let i in SM){let n=SM[i];Tne(e,i,n)}YF(e,"getParameter"),YF(e,"isEnabled")}_updateCache(e){let r=!1,i,n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let s in e){let a=e[s],c=this.cache[s];XF(a,c)||(r=!0,i=c,n&&!(s in n)&&(n[s]=c),this.cache[s]=a)}return{valueChanged:r,oldValue:i}}};function YF(t,e){let r=t[e].bind(t);t[e]=function(n){if(n===void 0||qF.has(n))return r(n);let s=Lc.get(t);return n in s.cache||(s.cache[n]=r(n)),s.enable?s.cache[n]:r(n)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function Tne(t,e,r){if(!t[e])return;let i=t[e].bind(t);t[e]=function(...s){let a=Lc.get(t),{valueChanged:c,oldValue:h}=r(a._updateCache,...s);return c&&i(...s),h},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function Ene(t){let e=t.useProgram.bind(t);t.useProgram=function(i){let n=Lc.get(t);n.program!==i&&(e(i),n.program=i)}}function KF(t,e,r){let i="",n={preserveDrawingBuffer:!0,...r},s=null;if(s||=t.getContext("webgl2",n),n.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!s&&!r.failIfMajorPerformanceCaveat&&(n.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",n),s.luma||={},s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,i||="Your browser only supports WebGL1")),!s)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);let{onContextLost:a,onContextRestored:c}=e;return t.addEventListener("webglcontextlost",h=>a(h),!1),t.addEventListener("webglcontextrestored",h=>c(h),!1),s.luma||={},s}function Uu(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function QF(t,e){let r=t.getParameter(7936),i=t.getParameter(7937);Uu(t,"WEBGL_debug_renderer_info",e);let n=e.WEBGL_debug_renderer_info,s=t.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),a=t.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),c=s||r,h=a||i,p=t.getParameter(7938),x=JF(c,h),T=Cne(c,h),R=Sne(c,h);return{type:"webgl",gpu:x,gpuType:R,gpuBackend:T,vendor:c,renderer:h,version:p,shadingLanguage:"glsl",shadingLanguageVersion:300}}function JF(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function Cne(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function Sne(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(JF(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Yv(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}var iy="WEBGL_compressed_texture_s3tc",ny="WEBGL_compressed_texture_s3tc_srgb",_0="EXT_texture_compression_rgtc",y0="EXT_texture_compression_bptc",Ine="WEBGL_compressed_texture_etc",Mne="WEBGL_compressed_texture_astc",Pne="WEBGL_compressed_texture_etc1",Rne="WEBGL_compressed_texture_pvrtc",Bne="WEBGL_compressed_texture_atc",ek="EXT_texture_norm16",tk="EXT_render_snorm",Lne="EXT_color_buffer_float",Kv={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[tk],"norm16-renderable-webgl":[ek],"snorm16-renderable-webgl":[ek,tk],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[iy,ny,_0,y0],"texture-compression-bc5-webgl":[_0],"texture-compression-bc7-webgl":[y0],"texture-compression-etc2":[Ine],"texture-compression-astc":[Mne],"texture-compression-etc1-webgl":[Pne],"texture-compression-pvrtc-webgl":[Rne],"texture-compression-atc-webgl":[Bne]};function rk(t){return t in Kv}function ik(t,e,r){return(Kv[e]||[]).every(n=>Uu(t,n,r))}var MM={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:Lne,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:iy},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ny},"bc1-rgba-unorm":{gl:33777,x:iy},"bc1-rgba-unorm-srgb":{gl:35916,x:ny},"bc2-rgba-unorm":{gl:33778,x:iy},"bc2-rgba-unorm-srgb":{gl:35918,x:ny},"bc3-rgba-unorm":{gl:33779,x:iy},"bc3-rgba-unorm-srgb":{gl:35919,x:ny},"bc4-r-unorm":{gl:36283,x:_0},"bc4-r-snorm":{gl:36284,x:_0},"bc5-rg-unorm":{gl:36285,x:_0},"bc5-rg-snorm":{gl:36286,x:_0},"bc6h-rgb-ufloat":{gl:36495,x:y0},"bc6h-rgb-float":{gl:36494,x:y0},"bc7-rgba-unorm":{gl:36492,x:y0},"bc7-rgba-unorm-srgb":{gl:36493,x:y0},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function nk(t,e,r){let i=e.create,n=MM[e.format];return n?.gl===void 0&&(i=!1),n?.x&&(i=i&&!!Uu(t,n.x,r)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function Qv(t){let e=MM[t],r=Dne(t),i=Gm(t);return{internalFormat:r,format:e?.dataFormat||One(i.channels,i.integer,i.normalized,r),type:i.dataType?Yv(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function sk(t){switch(Gm(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function One(t,e,r,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Dne(t){let r=MM[t]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${t}`);return r}var ok={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},Jv=class extends Y_{gl;extensions;testedFeatures=new Set;constructor(e,r,i){super([],i),this.gl=e,this.extensions=r,Uu(e,"EXT_color_buffer_float",r)}*[Symbol.iterator](){let e=this.getFeatures();for(let r of e)this.has(r)&&(yield r);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),rk(e)&&ik(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){let e=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(let r of e)this.has(r)}getFeatures(){return[...Object.keys(ok),...Object.keys(Kv)]}getWebGLFeature(e){let r=ok[e];return typeof r=="string"?!!Uu(this.gl,r,this.extensions):!!r}};var ew=class extends X_{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}};var Vu=class extends jp{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,r){super(e,r);let i=r.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){let e=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){let i=this.colorAttachments[r];if(i){let n=36064+r;this._attachTextureView(n,i)}}if(this.depthStencilAttachment){let r=sk(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){let r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${kne(r)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,r){let{gl:i}=this.device,{texture:n}=r,s=r.props.baseMipLevel,a=r.props.baseArrayLayer;switch(i.bindTexture(n.glTarget,n.handle),n.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,n.handle,s,a);break;case 34067:let c=Fne(a);i.framebufferTexture2D(36160,e,c,n.handle,s);break;case 3553:i.framebufferTexture2D(36160,e,3553,n.handle,s);break;default:throw new Error("Illegal texture type")}i.bindTexture(n.glTarget,null)}};function Fne(t){return t<34069?t+34069:t}function kne(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}var tw=class extends Q_{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,r){super(r),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Vu(this.device,{handle:null}),this._framebuffer}update(){let e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){let r=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(r,e);return}}commit(){}};async function rw(t,e){let r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");let i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),e&&(i.id=e),new Promise((n,s)=>{i.onload=n,i.onerror=a=>s(new Error(`Unable to load script '${t}': ${a}`)),r.appendChild(i)})}var Nne=1,al=null,ak=!1,iw={debugSpectorJS:jt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function lk(t){if(!globalThis.SPECTOR)try{await rw(t.debugSpectorJSUrl||iw.debugSpectorJSUrl)}catch(e){jt.warn(String(e))}}function ck(t){if(t={...iw,...t},!t.debugSpectorJS)return null;if(!al&&globalThis.SPECTOR&&!globalThis.luma?.spector){jt.probe(Nne,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();let{Spector:e}=globalThis.SPECTOR;al=new e,globalThis.luma&&(globalThis.luma.spector=al)}if(!al)return null;if(ak||(ak=!0,al.spyCanvases(),al?.onCaptureStarted.add(e=>jt.info("Spector capture started:",e)()),al?.onCapture.add(e=>{jt.info("Spector capture complete:",e)(),al?.getResultUI(),al?.resultView.display(),al?.resultView.addCapture(e)})),t.gl){let e=t.gl,r=e.device;al?.startCapture(t.gl,500),e.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{jt.info("Spector capture stopped after 2 seconds")(),al?.stopCapture()})}return al}var zne="https://unpkg.com/webgl-debug@2.0.1/index.js";function hk(t){return t.luma=t.luma||{},t.luma}async function fk(){oa()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await rw(zne))}function dk(t,e={}){return e.debugWebGL||e.traceWebGL?Vne(t,e):Une(t)}function Une(t){let e=hk(t);return e.realContext?e.realContext:t}function Vne(t,e){if(!globalThis.WebGLDebugUtils)return jt.warn("webgl-debug not loaded")(),t;let r=hk(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...vd,...t});let i=globalThis.WebGLDebugUtils.makeDebugContext(t,jne.bind(null,e),Gne.bind(null,e));for(let a in vd)!(a in i)&&typeof vd[a]=="number"&&(i[a]=vd[a]);class n{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(n,i);let s=Object.create(n);return r.realContext=t,r.debugContext=s,s.debug=!0,s}function uk(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function jne(t,e,r,i){i=Array.from(i).map(c=>c===void 0?"undefined":c);let n=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,i),a=`${n} in gl.${r}(${s})`;jt.error(a)();debugger}function Gne(t,e,r){let i="";jt.level>=1&&(i=uk(e,r),t.traceWebGL&&jt.log(1,i)());for(let n of r)if(n===void 0){i=i||uk(e,r);debugger}}var PM={};function pk(t="id"){PM[t]=PM[t]||1;let e=PM[t]++;return`${t}-${e}`}var Oc=class extends qi{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,r={}){super(e,r),this.device=e,this.gl=this.device.gl;let i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Hne(this.props.usage),this.glUsage=Wne(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(e,r=0,i=e.byteLength+r){let n=this.glTarget;this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bufferSubData(n,r,e),this.gl.bindBuffer(n,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let r=e;e===0&&(r=new Float32Array(0));let i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,r,e.byteLength)}async readAsync(e=0,r){return this.readSyncWebGL(e,r)}readSyncWebGL(e=0,r){r=r??this.byteLength-e;let i=new Uint8Array(r),n=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,n,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,r),i}};function Hne(t){return t&qi.INDEX?34963:t&qi.VERTEX?34962:t&qi.UNIFORM?35345:34962}function Wne(t){return t&qi.INDEX||t&qi.VERTEX?35044:t&qi.UNIFORM?35048:35044}function mk(t){let e=t.split(/\r?\n/),r=[];for(let i of e){if(i.length<=1)continue;let n=i.split(":");if(n.length===2){let[T,R]=n;r.push({message:R.trim(),type:Ak(T),lineNum:0,linePos:0});continue}let[s,a,c,...h]=n,p=parseInt(c,10);isNaN(p)&&(p=0);let x=parseInt(a,10);isNaN(x)&&(x=0),r.push({message:h.join(":").trim(),type:Ak(s),lineNum:p,linePos:x})}return r}function Ak(t){let e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}var nw=class extends Up{device;handle;constructor(e,r){switch(super(e,r),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let e=this.device.gl.getShaderInfoLog(this.handle);return e?mk(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;let{gl:r}=this.device;if(r.shaderSource(this.handle,e),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}jt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),jt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let e=async n=>await new Promise(s=>setTimeout(s,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}};function _k(t,e,r,i){if(Xne(e))return i(t);let n=t;n.pushState();try{return $ne(t,e),Bc(n.gl,r),i(t)}finally{n.popState()}}function $ne(t,e){let r=t,{gl:i}=r;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(uA("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){let s=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,a=uA("provokingVertex",e.provokingVertex,{first:36429,last:36430});s?.provokingVertexWEBGL(a)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){let s=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,a=uA("polygonMode",e.polygonMode,{fill:6914,line:6913});s?.polygonModeWEBGL(1028,a),s?.polygonModeWEBGL(1029,a)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(Zne("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(ow("depthCompare",e.depthCompare))),e.stencilWriteMask){let n=e.stencilWriteMask;i.stencilMaskSeparate(1028,n),i.stencilMaskSeparate(1029,n)}if(e.stencilReadMask&&jt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){let n=e.stencilReadMask||4294967295,s=ow("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,s,0,n),i.stencilFuncSeparate(1029,s,0,n)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){let n=RM("stencilPassOperation",e.stencilPassOperation),s=RM("stencilFailOperation",e.stencilFailOperation),a=RM("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,s,a,n),i.stencilOpSeparate(1029,s,a,n)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break;default:}if(e.blendColorOperation||e.blendAlphaOperation){let n=gk("blendColorOperation",e.blendColorOperation||"add"),s=gk("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(n,s);let a=sw("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=sw("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=sw("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),p=sw("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(a,c,h,p)}}function ow(t,e){return uA(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function RM(t,e){return uA(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function gk(t,e){return uA(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function sw(t,e){return uA(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function qne(t,e){return`Illegal parameter ${e} for ${t}`}function uA(t,e,r){if(!(e in r))throw new Error(qne(t,e));return r[e]}function Zne(t,e){return e}function Xne(t){let e=!0;for(let r in t){e=!1;break}return e}function aw(t){let e={};return t.addressModeU&&(e[10242]=BM(t.addressModeU)),t.addressModeV&&(e[10243]=BM(t.addressModeV)),t.addressModeW&&(e[32882]=BM(t.addressModeW)),t.magFilter&&(e[10240]=LM(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=Yne(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=ow("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function BM(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function LM(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function Yne(t,e="none"){if(!e)return LM(t);switch(e){case"none":return LM(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}var hA=class extends Vp{device;handle;parameters;constructor(e,r){super(e,r),this.device=e,this.parameters=aw(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(let[r,i]of Object.entries(e)){let n=Number(r);switch(n){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,n,i);break;default:this.device.gl.samplerParameteri(this.handle,n,i);break}}}};var ju=class extends zp{device;gl;handle;texture;constructor(e,r){super(e,{...sn.defaultProps,...r}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}};var Kne="Failed to deduce GL constant from typed array";function yk(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Kne)}}function xk(t,e){let{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function OM(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function bk(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function fA(t,e,r){if(Qne(e))return r(t);let{nocatch:i=!0}=e,n=Lc.get(t);n.push(),Bc(t,e);let s;if(i)s=r(t),n.pop();else try{s=r(t)}finally{n.pop()}return s}function Qne(t){for(let e in t)return!1;return!0}function vk(t,e,r){let{dimension:i,width:n,height:s,depth:a=0}=r,{glInternalFormat:c}=r,h=r.glTarget;switch(i){case"2d-array":case"3d":t.texStorage3D(h,e,c,n,s,a);break;default:t.texStorage2D(h,e,c,n,s)}}function DM(t,e,r,i){let{width:n,height:s}=i,{dimension:a,depth:c=0,mipLevel:h=0}=i,{x:p=0,y:x=0,z:T=0}=i,{glFormat:R,glType:k}=i,j=Tk(i.glTarget,a,c),q=i.flipY?{37440:!0}:{};fA(t,q,()=>{switch(a){case"2d-array":case"3d":t.bindTexture(j,e),t.texSubImage3D(j,h,p,x,T,n,s,c,R,k,r),t.bindTexture(j,null);break;case"2d":case"cube":t.bindTexture(j,e),t.texSubImage2D(j,h,p,x,n,s,R,k,r),t.bindTexture(j,null);break;default:throw new Error(a)}})}function FM(t,e,r){let{dimension:i,width:n,height:s,depth:a=0,mipLevel:c=0,byteOffset:h=0}=r,{x:p=0,y:x=0,z:T=0}=r,{glFormat:R,glType:k,compressed:j}=r,q=Tk(r.glTarget,i,a);switch(i){case"2d-array":case"3d":j?t.compressedTexSubImage3D(q,c,p,x,T,n,s,a,R,e,h):t.texSubImage3D(q,c,p,x,T,n,s,a,R,k,e,h);break;case"2d":case"cube":j?t.compressedTexSubImage2D(q,c,p,x,n,s,R,e,h):t.texSubImage2D(q,c,p,x,n,s,R,k,e,h);break;default:throw new Error(i)}}function wk(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866;case"cube-array":break}throw new Error(t)}function Tk(t,e,r){return e==="cube"?34069+r:t}function Ek(t,e){let{sourceX:r=0,sourceY:i=0,sourceAttachment:n=0}=e||{},{target:s=null,sourceWidth:a,sourceHeight:c,sourceDepth:h,sourceFormat:p,sourceType:x}=e||{},{framebuffer:T,deleteFramebuffer:R}=Sk(t),{gl:k,handle:j}=T;a||=T.width,c||=T.height;let q=T.colorAttachments[n]?.texture;if(!q)throw new Error(`Invalid framebuffer attachment ${n}`);h=q?.depth||1,p||=q?.glFormat||6408,x||=q?.glType||5121,s=ese(s,x,p,a,c,h),x=x||yk(s);let X=k.bindFramebuffer(36160,j);return k.readBuffer(36064+n),k.readPixels(r,i,a,c,p,x,s),k.readBuffer(36064),k.bindFramebuffer(36160,X||null),R&&T.destroy(),s}function Ck(t,e){let{target:r,sourceX:i=0,sourceY:n=0,sourceFormat:s=6408,targetByteOffset:a=0}=e||{},{sourceWidth:c,sourceHeight:h,sourceType:p}=e||{},{framebuffer:x,deleteFramebuffer:T}=Sk(t);c=c||x.width,h=h||x.height;let R=x;p=p||5121;let k=r;if(!k){let q=OM(s),X=bk(p),re=a+c*h*q*X;k=R.device.createBuffer({byteLength:re})}let j=t.device.createCommandEncoder();return j.copyTextureToBuffer({sourceTexture:t,width:c,height:h,origin:[i,n],destinationBuffer:k,byteOffset:a}),j.destroy(),T&&x.destroy(),k}function Sk(t){return t instanceof jp?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Jne(t),deleteFramebuffer:!0}}function Jne(t,e){let{device:r,width:i,height:n,id:s}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:i,height:n,colorAttachments:[t]})}function ese(t,e,r,i,n,s){if(t)return t;e||=5121;let a=xk(e,{clamped:!1}),c=OM(r);return new a(i*n*c)}var Gu=class extends sn{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,r){super(e,r);let i={...this.props};i.data=r.data,this.device=e,this.gl=this.device.gl,this.glTarget=wk(this.props.dimension);let n=Qv(this.props.format);this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:r,height:i}=e;if(!r||!i){let n=sn.getTextureDataSize(e.data);r=n?.width||1,i=n?.height||1}if(this.width=r,this.height=i,this.depth=e.depth,this.setSampler(e.sampler),this.view=new ju(this.device,{...this.props,texture:this}),this.bind(),vk(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new ju(this.device,{...e,texture:this})}setSampler(e={}){let r;e instanceof hA?(this.sampler=e,r=e.props):(this.sampler=new hA(this.device,e),r=e);let i=aw(r);this._setSamplerParameters(i)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(jt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){jt.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){let r=sn.getExternalImageSize(e.image),i={...sn.defaultCopyExternalImageOptions,...r,...e},{image:n,depth:s,mipLevel:a,x:c,y:h,z:p,flipY:x}=i,{width:T,height:R}=i,{dimension:k,glTarget:j,glFormat:q,glInternalFormat:X,glType:re}=this;if(T=Math.min(T,this.width-c),R=Math.min(R,this.height-h),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return DM(this.device.gl,this.handle,n,{dimension:k,mipLevel:a,x:c,y:h,z:p,width:T,height:R,depth:s,glFormat:q,glInternalFormat:X,glType:re,glTarget:j,flipY:x}),{width:i.width,height:i.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,r=0){this.bind();let i=sn.normalizeTextureData(e,this);i.length>1&&this.props.mipmaps!==!1&&jt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let n=0;n<i.length;n++){let s=i[n];this._setMipLevel(r,n,s)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),FM(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(let i of sn.CubeFaces)this.setTextureCubeFaceData(e[i],i)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,r,i=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&jt.warn(`${this.id} has mipmap and multiple LODs.`)();let n=sn.CubeFaces.indexOf(r);this.setTexture2DData(e,n)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){let{face:r,width:i,height:n,pixels:s,data:a,format:c=6408,type:h=5121}=e,{gl:p}=this,x=s||a;this.bind(),x instanceof Promise?x.then(T=>this.setImageDataForFace(Object.assign({},e,{face:r,data:T,pixels:T}))):this.width||this.height?p.texImage2D(r,0,c,i,n,0,c,h,x):p.texImage2D(r,0,c,c,h,x)}_getImageDataMap(e){for(let r=0;r<sn.CubeFaces.length;++r){let i=sn.CubeFaces[r];e[i]&&(e[34069+r]=e[i],delete e[i])}return e}_setSamplerParameters(e){jt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(let[r,i]of Object.entries(e)){let n=Number(r),s=i;switch(n){case 33082:case 33083:this.gl.texParameterf(this.glTarget,n,s);break;case 10241:this.gl.texParameteri(this.glTarget,n,s);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,n,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,n,s);break;default:this.gl.texParameteri(this.glTarget,n,s);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,r,i,n=this.glTarget){if(sn.isExternalImage(i)){DM(this.device.gl,this.handle,i,{...this,depth:e,mipLevel:r,glTarget:n,flipY:this.props.flipY});return}if(sn.isTextureLevelData(i)){FM(this.device.gl,i.data,{...this,depth:e,mipLevel:r,glTarget:n});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){let{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,this.handle),e}unbind(e){let{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,null),e}};var tse=[1,2,4,8],lw=class extends J_{device;glParameters;constructor(e,r){super(e,r),this.device=e;let i;if(!r?.parameters?.viewport)if(r?.framebuffer){let{width:s,height:a}=r.framebuffer;i=[0,0,s,a]}else{let[s,a]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,s,a]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){let s=this.props.framebuffer.colorAttachments.map((a,c)=>36064+c);this.device.gl.drawBuffers(s)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){let r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(r.viewport=e.viewport.slice(0,4),r.depthRange=[e.viewport[4],e.viewport[5]]):r.viewport=e.viewport),e.scissorRect&&(r.scissorTest=!0,r.scissor=e.scissorRect),e.blendConstant&&(r.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(r.colorMask=tse.map(i=>!!(i&e.colorMask))),this.glParameters=r,Bc(this.device.gl,r)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let e={...this.glParameters},r=0;this.props.clearColors&&this.props.clearColors.forEach((i,n)=>{i&&this.clearColorBuffer(n,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,e.clearStencil=this.props.clearStencil),r!==0&&fA(this.device.gl,e,()=>{this.device.gl.clear(r)})}clearColorBuffer(e=0,r=[0,0,0,0]){fA(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}};function Ik(t){return rse.includes(t)}var rse=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Mk={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function kM(t){let e=Mk[t];if(!e)throw new Error("uniform");let[r,i,,n]=e;return{format:n,components:i,glType:r}}function Pk(t){let e=Mk[t];if(!e)throw new Error("attribute");let[,r,,i,n]=e;return{attributeType:i,vertexFormat:n,components:r}}function Rk(t,e){let r={attributes:[],bindings:[]};r.attributes=ise(t,e);let i=ose(t,e);for(let c of i){let h=c.uniforms.map(p=>({name:p.name,format:p.format,byteOffset:p.byteOffset,byteStride:p.byteStride,arrayLength:p.arrayLength}));r.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:h})}let n=sse(t,e),s=0;for(let c of n)if(Ik(c.type)){let{viewDimension:h,sampleType:p}=lse(c.type);r.bindings.push({type:"texture",name:c.name,group:0,location:s,viewDimension:h,sampleType:p}),c.textureUnit=s,s+=1}n.length&&(r.uniforms=n);let a=nse(t,e);return a?.length&&(r.varyings=a),r}function ise(t,e){let r=[],i=t.getProgramParameter(e,35721);for(let n=0;n<i;n++){let s=t.getActiveAttrib(e,n);if(!s)throw new Error("activeInfo");let{name:a,type:c}=s,h=t.getAttribLocation(e,a);if(h>=0){let{attributeType:p}=Pk(c),x=/instance/i.test(a)?"instance":"vertex";r.push({name:a,location:h,stepMode:x,type:p})}}return r.sort((n,s)=>n.location-s.location),r}function nse(t,e){let r=[],i=t.getProgramParameter(e,35971);for(let n=0;n<i;n++){let s=t.getTransformFeedbackVarying(e,n);if(!s)throw new Error("activeInfo");let{name:a,type:c,size:h}=s,{glType:p,components:x}=kM(c),T={location:n,name:a,type:p,size:h*x};r.push(T)}return r.sort((n,s)=>n.location-s.location),r}function sse(t,e){let r=[],i=t.getProgramParameter(e,35718);for(let n=0;n<i;n++){let s=t.getActiveUniform(e,n);if(!s)throw new Error("activeInfo");let{name:a,size:c,type:h}=s,{name:p,isArray:x}=cse(a),T=t.getUniformLocation(e,p),R={location:T,name:p,size:c,type:h,isArray:x};if(r.push(R),R.size>1)for(let k=0;k<R.size;k++){let j=`${p}[${k}]`;T=t.getUniformLocation(e,j);let q={...R,name:j,location:T};r.push(q)}}return r}function ose(t,e){let r=(s,a)=>t.getActiveUniformBlockParameter(e,s,a),i=[],n=t.getProgramParameter(e,35382);for(let s=0;s<n;s++){let a={name:t.getActiveUniformBlockName(e,s)||"",location:r(s,35391),byteLength:r(s,35392),vertex:r(s,35396),fragment:r(s,35398),uniformCount:r(s,35394),uniforms:[]},c=r(s,35395)||[],h=t.getActiveUniforms(e,c,35383),p=t.getActiveUniforms(e,c,35384),x=t.getActiveUniforms(e,c,35387),T=t.getActiveUniforms(e,c,35388);for(let R=0;R<a.uniformCount;++R){let k=t.getActiveUniform(e,c[R]);if(!k)throw new Error("activeInfo");a.uniforms.push({name:k.name,format:kM(h[R]).format,type:h[R],arrayLength:p[R],byteOffset:x[R],byteStride:T[R]})}i.push(a)}return i.sort((s,a)=>s.location-a.location),i}var ase={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function lse(t){let e=ase[t];if(!e)throw new Error("sampler");let[r,i]=e;return{viewDimension:r,sampleType:i}}function cse(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};let r=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function Bk(t,e,r,i){let n=t,s=i;s===!0&&(s=1),s===!1&&(s=0);let a=typeof s=="number"?[s]:s;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,a);case 35664:return t.uniform2fv(e,a);case 35665:return t.uniform3fv(e,a);case 35666:return t.uniform4fv(e,a);case 5124:return t.uniform1iv(e,a);case 35667:return t.uniform2iv(e,a);case 35668:return t.uniform3iv(e,a);case 35669:return t.uniform4iv(e,a);case 35670:return t.uniform1iv(e,a);case 35671:return t.uniform2iv(e,a);case 35672:return t.uniform3iv(e,a);case 35673:return t.uniform4iv(e,a);case 5125:return n.uniform1uiv(e,a,1);case 36294:return n.uniform2uiv(e,a,2);case 36295:return n.uniform3uiv(e,a,3);case 36296:return n.uniform4uiv(e,a,4);case 35674:return t.uniformMatrix2fv(e,!1,a);case 35675:return t.uniformMatrix3fv(e,!1,a);case 35676:return t.uniformMatrix4fv(e,!1,a);case 35685:return n.uniformMatrix2x3fv(e,!1,a);case 35686:return n.uniformMatrix2x4fv(e,!1,a);case 35687:return n.uniformMatrix3x2fv(e,!1,a);case 35688:return n.uniformMatrix3x4fv(e,!1,a);case 35689:return n.uniformMatrix4x2fv(e,!1,a);case 35690:return n.uniformMatrix4x3fv(e,!1,a)}throw new Error("Illegal uniform")}function use(t){return z1(t)!==null||typeof t=="number"||typeof t=="boolean"}function Lk(t){let e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{let i=t[r];use(i)?e.uniforms[r]=i:e.bindings[r]=i}),e}function Ok(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function Dk(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}var Fk=4,cw=class extends Iu{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,r){super(e,r),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;let{varyings:i,bufferMode:n=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,n)),this._linkShaders(),jt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Rk(this.device.gl,this.handle),jt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=hse(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,r){for(let[i,n]of Object.entries(e)){let s=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!s){let a=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");r?.disableWarnings||jt.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${a}`,n)();continue}switch(n||jt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(n instanceof Oc)&&!(n.buffer instanceof Oc))throw new Error("buffer value");break;case"texture":if(!(n instanceof ju||n instanceof Gu||n instanceof Vu))throw new Error("texture value");break;case"sampler":jt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(s.type)}this.bindings[i]=n}}draw(e){let{renderPass:r,parameters:i=this.props.parameters,topology:n=this.props.topology,vertexArray:s,vertexCount:a,instanceCount:c,isInstanced:h=!1,firstVertex:p=0,transformFeedback:x}=e,T=Ok(n),R=!!s.indexBuffer,k=s.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return jt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return jt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(r),x&&x.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let j=r;return _k(this.device,i,j.glParameters,()=>{R&&h?this.device.gl.drawElementsInstanced(T,a||0,k,p,c||0):R?this.device.gl.drawElements(T,a||0,k,p):h?this.device.gl.drawArraysInstanced(T,p,a||0,c||0):this.device.gl.drawArrays(T,p,a||0),x&&x.end()}),s.unbindAfterRender(r),!0}setUniformsWebGL(e){let{bindings:r}=Lk(e);Object.keys(r).forEach(i=>{jt.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){let{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),jt.time(Fk,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),jt.timeEnd(Fk,`linkProgram for ${this.id}`)(),jt.level,!this.device.features.has("compilation-status-async-webgl")){let i=this._getLinkStatus();this._reportLinkStatus(i);return}jt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),jt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break;case"success":break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break;case"success":break}let r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${r}`)}}_getLinkStatus(){let{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let e=async n=>await new Promise(s=>setTimeout(s,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(let r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(jt.warn(`Binding ${r.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;let{gl:e}=this.device;e.useProgram(this.handle);let r=0,i=0;for(let n of this.shaderLayout.bindings){let s=this.bindings[n.name]||this.bindings[n.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${n.name} in ${this.id}`);switch(n.type){case"uniform":let{name:a}=n,c=e.getUniformBlockIndex(this.handle,a);if(c===4294967295)throw new Error(`Invalid uniform block name ${a}`);e.uniformBlockBinding(this.handle,i,c),s instanceof Oc?e.bindBufferBase(35345,i,s.handle):e.bindBufferRange(35345,i,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),i+=1;break;case"texture":if(!(s instanceof ju||s instanceof Gu||s instanceof Vu))throw new Error("texture");let h;if(s instanceof ju)h=s.texture;else if(s instanceof Gu)h=s;else if(s instanceof Vu&&s.colorAttachments[0]instanceof ju)jt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=s.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+r),e.bindTexture(h.glTarget,h.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${n.type}' not supported in WebGL`)}}}_applyUniforms(){for(let e of this.shaderLayout.uniforms||[]){let{name:r,location:i,type:n,textureUnit:s}=e,a=this.uniforms[r]??s;a!==void 0&&Bk(this.device.gl,i,n,a)}}};function hse(t,e){let r={...t,attributes:t.attributes.map(i=>({...i}))};for(let i of e?.attributes||[]){let n=r.attributes.find(s=>s.name===i.name);n?(n.type=i.type||n.type,n.stepMode=i.stepMode||n.stepMode):jt.warn(`shader layout attribute ${i.name} not present in shader`)}return r}var uw=class extends t1{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(let r of e)switch(r.name){case"copy-buffer-to-buffer":fse(this.device,r.options);break;case"copy-buffer-to-texture":dse(this.device,r.options);break;case"copy-texture-to-buffer":pse(this.device,r.options);break;case"copy-texture-to-texture":Ase(this.device,r.options);break;default:throw new Error(r.name)}}};function fse(t,e){let r=e.sourceBuffer,i=e.destinationBuffer;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function dse(t,e){throw new Error("Not implemented")}function pse(t,e){let{sourceTexture:r,mipLevel:i=0,aspect:n="all",width:s=e.sourceTexture.width,height:a=e.sourceTexture.height,depthOrArrayLayers:c=0,origin:h=[0,0],destinationBuffer:p,byteOffset:x=0,bytesPerRow:T,rowsPerImage:R}=e;if(n!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||c!==0||T||R)throw new Error("not implemented");let{framebuffer:k,destroyFramebuffer:j}=kk(r),q;try{let X=p,re=s||k.width,te=a||k.height,oe=Qv(k.colorAttachments[0].texture.props.format),ae=oe.format,pe=oe.type;t.gl.bindBuffer(35051,X.handle),q=t.gl.bindFramebuffer(36160,k.handle),t.gl.readPixels(h[0],h[1],re,te,ae,pe,x)}finally{t.gl.bindBuffer(35051,null),q!==void 0&&t.gl.bindFramebuffer(36160,q),j&&k.destroy()}}function Ase(t,e){let{sourceTexture:r,destinationMipLevel:i=0,origin:n=[0,0],destinationOrigin:s=[0,0],destinationTexture:a}=e,{width:c=e.destinationTexture.width,height:h=e.destinationTexture.height}=e,{framebuffer:p,destroyFramebuffer:x}=kk(r),[T,R]=n,[k,j,q]=s,X=t.gl.bindFramebuffer(36160,p.handle),re=null,te;if(a instanceof Gu)re=a,c=Number.isFinite(c)?c:re.width,h=Number.isFinite(h)?h:re.height,re.bind(0),te=re.glTarget;else throw new Error("invalid destination");switch(te){case 3553:case 34067:t.gl.copyTexSubImage2D(te,i,k,j,T,R,c,h);break;case 35866:case 32879:t.gl.copyTexSubImage3D(te,i,k,j,q,T,R,c,h);break;default:}re&&re.unbind(),t.gl.bindFramebuffer(36160,X),x&&p.destroy()}function kk(t){if(t instanceof sn){let{width:e,height:r,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}var hw=class extends e1{device;commandBuffer;constructor(e,r){super(e,r),this.device=e,this.commandBuffer=new uw(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,r,i){}};function Nk(t){let{target:e,source:r,start:i=0,count:n=1}=t,s=r.length,a=n*s,c=0;for(let h=i;c<s;c++)e[h++]=r[c];for(;c<a;)c<a-c?(e.copyWithin(i+c,i,i+c),c*=2):(e.copyWithin(i+c,i,i+a-c),c=a);return t.target}var fw=class t extends r1{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return IC()==="Chrome"}constructor(e,r){super(e,r),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){let r=e;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(e,r){let i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");let{size:n,type:s,stride:a,offset:c,normalized:h,integer:p,divisor:x}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),p?this.device.gl.vertexAttribIPointer(e,n,s,a,c):this.device.gl.vertexAttribPointer(e,n,s,h,a,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,x||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,r){this._enable(e,!1),this.attributes[e]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){let r=this.attributes[e];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(e,r)}}_getAccessor(e){let r=this.attributeInfos[e];if(!r)throw new Error(`Unknown attribute location ${e}`);let i=Yv(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(e,r=!0){let n=t.isConstantAttributeZeroSupported(this.device)||e!==0;(r||n)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,r){let i=mse(r),n=i.byteLength*e,s=i.length*e;if(this.buffer&&n!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${n} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:n}),a=a||!gse(i,this.bufferValue),a){let c=RS(r.constructor,s);Nk({target:c,source:i,start:0,count:s}),this.buffer.write(c),this.bufferValue=r}return this.buffer}};function mse(t){return Array.isArray(t)?new Float32Array(t):t}function gse(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var dw=class extends i1{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,r){super(e,r),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Dk(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let r in e)this.setBuffer(r,e[r])})}setBuffer(e,r){let i=this._getVaryingIndex(e),{buffer:n,byteLength:s,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[e]=n,jt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:n,byteLength:s,byteOffset:a},this.bindOnUse||this._bindBuffer(i,n,a,s)}getBuffer(e){if(zk(e))return this.buffers[e]||null;let r=this._getVaryingIndex(e);return r>=0?this.buffers[r]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let r;return this._bound?r=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Oc)return{buffer:e,byteOffset:0,byteLength:e.byteLength};let{buffer:r,byteOffset:i=0,byteLength:n=e.buffer.byteLength}=e;return{buffer:r,byteOffset:i,byteLength:n}}_getVaryingIndex(e){if(zk(e))return Number(e);for(let r of this.layout.varyings)if(e===r.name)return r.location;return-1}_bindBuffers(){for(let e in this.buffers){let{buffer:r,byteLength:i,byteOffset:n}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),r,n,i)}}_unbindBuffers(){for(let e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,r,i=0,n){let s=r&&r.handle;!s||n===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,n)}};function zk(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}var pw=class extends n1{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,r){if(super(e,r),this.device=e,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,n)=>{let s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}};var Dc=class extends El{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||pk("webgl-device")});let r=El._getCanvasContextProps(e);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=r.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new tw(this,r),this.lost=new Promise(x=>{this._resolveContextLost=x});let n={...e.webgl};r.alphaMode==="premultiplied"&&(n.premultipliedAlpha=!0),e.powerPreference!==void 0&&(n.powerPreference=e.powerPreference);let a=this.props._handle||KF(this.canvasContext.canvas,{onContextLost:x=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:x=>console.log("WebGL context restored")},n);if(!a)throw new Error("WebGL context creation failed");if(i=a.device,i){if(e._reuseDevices)return jt.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=a,this.gl=a,this.spectorJS=ck({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=QF(this.gl,this._extensions),this.limits=new ew(this.gl),this.features=new Jv(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new Lc(this.gl,{log:(...x)=>jt.log(1,...x)()}).trackState(this.gl,{copyState:!1});let h=e.debugWebGL||e.debug,p=e.debugWebGL;h&&(this.gl=dk(this.gl,{debugWebGL:h,traceWebGL:p}),jt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(jt.level=Math.max(jt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){let r=this._normalizeBufferProps(e);return new Oc(this,r)}createTexture(e){return new Gu(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new hA(this,e)}createShader(e){return new nw(this,e)}createFramebuffer(e){return new Vu(this,e)}createVertexArray(e){return new fw(this,e)}createTransformFeedback(e){return new dw(this,e)}createQuerySet(e){return new pw(this,e)}createRenderPipeline(e){return new cw(this,e)}beginRenderPass(e){return new lw(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new hw(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,r){return Ek(e,r)}readPixelsToBufferWebGL(e,r){return Ck(e,r)}setParametersWebGL(e){Bc(this.gl,e)}getParametersWebGL(e){return Xv(this.gl,e)}withParametersWebGL(e,r){return fA(this.gl,e,r)}resetWebGL(){jt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),ZF(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return nk(this.gl,e,this._extensions)}loseDevice(){let e=!1,i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Lc.get(this.gl).push()}popState(){Lc.get(this.gl).pop()}setSpectorMetadata(e,r){e.__SPECTOR_Metadata=r}getGLKey(e,r){let i=Number(e);for(let n in this.gl)if(this.gl[n]===i)return`GL.${n}`;return r?.emptyIfUnknown?"":String(e)}getGLKeys(e){let r={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[n,s])=>(i[`${n}:${this.getGLKey(n,r)}`]=`${s}:${this.getGLKey(s,r)}`,i),{})}_constants;setConstantAttributeWebGL(e,r){let i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);let n=this._constants[e];switch(n&&bse(n,r)&&jt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=r,r.constructor){case Float32Array:_se(this,e,r);break;case Int32Array:yse(this,e,r);break;case Uint32Array:xse(this,e,r);break;default:throw new Error("constant")}}getExtension(e){return Uu(this.gl,e,this._extensions),this._extensions}};function _se(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break;default:}}function yse(t,e,r){t.gl.vertexAttribI4iv(e,r)}function xse(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function bse(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var vse={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},wse=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Tse=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),Ese=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function Uk(t=!0){let e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(r,i){if(r==="webgl"||r==="experimental-webgl"){let n=this.originalGetContext("webgl2",i);return n instanceof HTMLElement&&Cse(n),n}return this.originalGetContext(r,i)}}function Cse(t){t.getExtension("EXT_color_buffer_float");let e={...vse,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:wse(t),OES_vertex_array_object:Tse(t),ANGLE_instanced_arrays:Ese(t)},r=t.getExtension;t.getExtension=function(n){let s=r.call(t,n);return s||(n in e?e[n]:null)};let i=t.getSupportedExtensions;t.getSupportedExtensions=function(){return(i.apply(t)||[])?.concat(Object.keys(e))}}var Aw=1,NM=class extends K_{type="webgl";constructor(){super(),El.defaultProps={...El.defaultProps,...iw},Dc.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){Uk(e)}async attach(e){if(e instanceof Dc)return e;if(e?.device instanceof El)return e.device;if(!Sse(e))throw new Error("Invalid WebGL2RenderingContext");return new Dc({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){jt.groupCollapsed(Aw,"WebGLDevice created")();let r=[];(e.debugWebGL||e.debug)&&r.push(fk()),e.debugSpectorJS&&r.push(lk(e));let i=await Promise.allSettled(r);for(let a of i)a.status==="rejected"&&jt.error(`Failed to initialize debug libraries ${a.reason}`)();let n=new Dc(e),s=`${n._reused?"Reusing":"Created"} device with WebGL2 ${n.debug?"debug ":""}context: ${n.info.vendor}, ${n.info.renderer} for canvas: ${n.canvasContext.id}`;return jt.probe(Aw,s)(),jt.table(Aw,n.info)(),jt.groupEnd(Aw)(),n}};function Sse(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}var mw=new NM;function wd(){}var Ise=({isDragging:t})=>t?"grabbing":"grab",Vk={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:wd,onWebGLInitialized:wd,onResize:wd,onViewStateChange:wd,onInteractionStateChange:wd,onBeforeRender:wd,onAfterRender:wd,onLoad:wd,onError:t=>ur.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Ise,getTooltip:null,debug:!1,drawPickingColors:!1},sy=class{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Go({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{let{_pickRequest:n}=this;if(i.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(i.leftButton||i.rightButton)return;{let s=i.offsetCenter;if(!s)return;n.x=s.x,n.y=s.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=i},this._onEvent=i=>{let n=R1[i.type],s=i.offsetCenter;if(!n||!s||!this.layerManager)return;let a=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:a,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:h}=c,p=h&&(h[n]||h.props[n]),x=this.props[n],T=!1;p&&(T=p.call(h,c,i)),T||(x?.(c,i),this.widgetManager.onEvent(c,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;let n=i.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...Vk,...e},e=this.props,e.viewState&&e.initialViewState&&ur.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let r=this.device;!r&&e.gl&&(e.gl instanceof WebGLRenderingContext&&ur.error("WebGL1 context not supported.")(),r=mw.attach(e.gl)),r||(r=Hm.createDevice({type:"best-available",_reuseDevices:!0,adapters:[mw],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&Mc.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ur.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ur.removed("onLayerClick","onClick")(),e.initialViewState&&!An(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let i=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return r=r||i||n||s||a,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return yn(this.viewManager),this.viewManager.views}getViewports(e){return yn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){let r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(let i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:r})}_removeResources(e){for(let r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,r,i){yn(this.deckPicker);let{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(r).timeStart();let s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(r).timeEnd(),s}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),yn(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){if(!this.canvas)return;let{width:r,height:i}=e;if(r||r===0){let n=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=n}if(i||i===0){let n=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let r=e.clientWidth??e.width,i=e.clientHeight??e.height;(r!==this.width||i!==this.height)&&(this.width=r,this.height=i,this.viewManager?.setProps({width:r,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:i}))}_createAnimationLoop(e,r){let{gl:i,onError:n,useDevicePixels:s}=r;return new N1({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new X1({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:e}=this;if(e.event){let{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let n=i,s=!1;for(let a of r)n=a,s=a.layer?.onHover(a,e.event)||s;s||(this.props.onHover?.(n,e.event),this.widgetManager.onHover(n,e.event)),e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);let r=new iA;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new P1(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(aM).map(n=>{let[s,a,c,h]=aM[n],p=this.props.eventRecognizerOptions?.[n],x={...a,...p,event:n};return{recognizer:new s(x),recognizeWith:c,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let n in R1)this.eventManager.on(n,this._onEvent);this.viewManager=new G1({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let i=this.viewManager.getViewports()[0];this.layerManager=new j1(this.device,{deck:this,stats:this.stats,viewport:i,timeline:r}),this.effectManager=new Y1({deck:this,device:this.device}),this.deckRenderer=new Q1(this.device),this.deckPicker=new J1(this.device),this.widgetManager=new Zv({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new ey),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){let{device:i,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:n});let s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:i,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ur.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();let i=Hm.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}};sy.defaultProps=Vk;sy.VERSION=PO;var x0=sy;function jk(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return o1(t)}}var Gk=Eb;function oy(t,e,r){let i=r==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function Td(t){return t.stride||t.size*t.bytesPerElement}function Hk(t,e){return t.type===e.type&&t.size===e.size&&Td(t)===Td(e)&&(t.offset||0)===(e.offset||0)}function zM(t,e){e.offset&&ur.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=Td(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,n=e.elementOffset||0,s=i*r+n*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:r}}function Mse(t,e){let r=zM(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}var ay=class{constructor(e,r,i){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;let n=r.logicalType||r.type,s=n==="float64",{defaultValue:a}=r;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let c;s?c="float32":!n&&r.isIndexed?c="uint32":c=n||"float32";let h=jk(n||c);this.doublePrecision=s,s&&r.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...r,defaultType:h,defaultValue:a,logicalType:n,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Td(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Mc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){let i={};if(this.state.constant){let n=this.value;if(r){let s=zM(this.getAccessor(),r),a=s.offset/n.BYTES_PER_ELEMENT,c=s.size||this.size;i[e]=n.subarray(a,a+c)}else i[e]=n}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,r=null){let i=this.getAccessor(),n=[],s={name:this.id,byteStride:Td(i),attributes:n};if(this.doublePrecision){let a=Mse(i,r||{});n.push(oy(e,{...i,...a.high},this.device.type),oy(`${e}64Low`,{...i,...a.low},this.device.type))}else if(r){let a=zM(i,r);n.push(oy(e,{...i,...a},this.device.type))}else n.push(oy(e,i,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let r=Array.from(this.value);e=[r,r]}else{let{value:r,numInstances:i,size:n}=this,s=i*n;if(r&&s&&r.length>=s){let a=new Array(n).fill(1/0),c=new Array(n).fill(-1/0);for(let h=0;h<s;)for(let p=0;p<n;p++){let x=r[h++];x<a[p]&&(a[p]=x),x>c[p]&&(c[p]=x)}e=[a,c]}}return this.state.bounds=e,e}setData(e){let{state:r}=this,i;ArrayBuffer.isView(e)?i={value:e}:e instanceof qi?i={buffer:e}:i=e;let n={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)n.type="float32";else{let a=Gk(i.value);n.type=n.normalized?a.replace("int","norm"):a}n.bytesPerElement=i.value.BYTES_PER_ELEMENT,n.stride=Td(n)}if(r.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!r.constant||!this._areValuesEqual(s,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(i.buffer){let s=i.buffer;r.externalBuffer=s,r.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let s=i.value;r.externalBuffer=null,r.constant=!1,this.value=s;let{buffer:a}=this,c=Td(n),h=(n.vertexOffset||0)*c;if(this.doublePrecision&&s instanceof Float64Array&&(s=Fv(s,n)),this.settings.isIndexed){let x=this.settings.defaultType;s.constructor!==x&&(s=new x(s))}let p=s.byteLength+h+c*2;(!a||a.byteLength<p)&&(a=this._createBuffer(p)),a.write(s,h)}return this.setAccessor(n),!0}updateSubBuffer(e={}){this.state.bounds=null;let r=this.value,{startOffset:i=0,endOffset:n}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?Fv(r,{size:this.size,startIndex:i,endIndex:n}):r.subarray(i,n),i*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){let{state:i}=this,n=i.allocatedValue,s=Mc.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=s;let{byteOffset:a}=this,{buffer:c}=this;return(!c||c.byteLength<s.byteLength+a)&&(c=this._createBuffer(s.byteLength+a),r&&n&&c.write(n instanceof Float64Array?Fv(n,this):n,a)),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){let{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);let i=this.settings.defaultType,n=!1;if(this.doublePrecision&&(n=r.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof i)&&this.settings.normalized&&!("normalized"in e)&&ur.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,i){let{defaultValue:n,size:s}=this.settings;if(Number.isFinite(e))return r[i]=e,r;if(!e){let a=s;for(;--a>=0;)r[i+a]=n[a];return r}switch(s){case 4:r[i+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:r[i+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:r[i+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:r[i+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let a=s;for(;--a>=0;)r[i+a]=Number.isFinite(e[a])?e[a]:n[a]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;let{size:i}=this;for(let n=0;n<i;n++)if(e[n]!==r[n])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();let{isIndexed:r,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(r?qi.INDEX:qi.VERTEX)|qi.COPY_DST,indexType:r?i:void 0,byteLength:e}),this._buffer}};var Wk=[],$k=[];function Ps(t,e=0,r=1/0){let i=Wk,n={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&($k.length=t.length,i=$k):i=Wk,(e>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,r),n.index=e-1),{iterable:i,objectInfo:n}}function gw(t){return t&&t[Symbol.asyncIterator]}function _w(t,e){let{size:r,stride:i,offset:n,startIndices:s,nested:a}=e,c=t.BYTES_PER_ELEMENT,h=i?i/c:r,p=n?n/c:0,x=Math.floor((t.length-p)/h);return(T,{index:R,target:k})=>{if(!s){let re=R*h+p;for(let te=0;te<r;te++)k[te]=t[re+te];return k}let j=s[R],q=s[R+1]||x,X;if(a){X=new Array(q-j);for(let re=j;re<q;re++){let te=re*h+p;k=new Array(r);for(let oe=0;oe<r;oe++)k[oe]=t[te+oe];X[re-j]=k}}else if(h===r)X=t.subarray(j*r+p,q*r+p);else{X=new t.constructor((q-j)*r);let re=0;for(let te=j;te<q;te++){let oe=te*h+p;for(let ae=0;ae<r;ae++)X[re++]=t[oe+ae]}}return X}}var qk=[],ly=[[0,1/0]];function Zk(t,e){if(t===ly||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;let r=[],i=t.length,n=0;for(let s=0;s<i;s++){let a=t[s];a[1]<e[0]?(r.push(a),n=s+1):a[0]>e[1]?r.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return r.splice(n,0,e),r}var Rse={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function yw(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});let r=t.type||"interpolation";return{...Rse[r],...e,...t,type:r}}var dA=class extends ay{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:ly}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!Hk(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:r}=this.settings,i=this.settings.transition,n=Array.isArray(r)?e[r.find(s=>e[s])]:e[r];return yw(n,i)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){let{startRow:i=0,endRow:n=1/0}=r;this.state.updateRanges=Zk(this.state.updateRanges,[i,n])}else this.state.updateRanges=ly}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=qk}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:r,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,r.updateRanges!==ly),!0):!1}updateBuffer({numInstances:e,data:r,props:i,context:n}){if(!this.needsUpdate())return!1;let{state:{updateRanges:s},settings:{update:a,noAlloc:c}}=this,h=!0;if(a){for(let[p,x]of s)a.call(n,this,{data:r,startRow:p,endRow:x,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[p,x]of s){let T=Number.isFinite(p)?this.getVertexOffset(p):0,R=Number.isFinite(x)?this.getVertexOffset(x):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:T,endOffset:R})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){let{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){let{state:i,settings:n}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),n.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let a=e;yn(ArrayBuffer.isView(a.value),`invalid ${n.accessor}`);let c=!!a.size&&a.size!==this.size;return i.binaryAccessor=_w(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:r,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){let e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(let i in e)Object.assign(r,super.getValue(i,e[i]));return r}getBufferLayout(e){this.state.layoutChanged=!1;let r=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=n??"vertex",!r)return i;for(let s in r){let a=super._getBufferLayout(s,r[s]);i.attributes.push(...a.attributes)}return i}_autoUpdater(e,{data:r,startRow:i,endRow:n,props:s,numInstances:a}){if(e.constant&&this.context.device.type!=="webgpu")return;let{settings:c,state:h,value:p,size:x,startIndices:T}=e,{accessor:R,transform:k}=c,j=h.binaryAccessor||(typeof R=="function"?R:s[R]);typeof j!="function"&&(j=()=>j),yn(typeof j=="function",`accessor "${R}" is not a function`);let q=e.getVertexOffset(i),{iterable:X,objectInfo:re}=Ps(r,i,n);for(let te of X){re.index++;let oe=j(te,re);if(k&&(oe=k.call(this,oe)),T){let ae=(re.index<T.length-1?T[re.index+1]:a)-T[re.index];if(oe&&Array.isArray(oe[0])){let pe=q;for(let be of oe)e._normalizeValue(be,p,pe),pe+=x}else oe&&oe.length>x?p.set(oe,q):(e._normalizeValue(oe,re.target,0),vM({target:p,source:re.target,start:q,count:ae}));q+=ae*x}else e._normalizeValue(oe,p,q),q+=x}}_validateAttributeUpdaters(){let{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let i=!0;switch(r){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function UM(t){let{source:e,target:r,start:i=0,size:n,getData:s}=t,a=t.end||r.length,c=e.length,h=a-i;if(c>h){r.set(e.subarray(0,h),i);return}if(r.set(e,i),!s)return;let p=c;for(;p<h;){let x=s(p,e);for(let T=0;T<n;T++)r[i+p]=x[T]||0,p++}}function Xk({source:t,target:e,size:r,getData:i,sourceStartIndices:n,targetStartIndices:s}){if(!n||!s)return UM({source:t,target:e,size:r,getData:i}),e;let a=0,c=0,h=i&&((x,T)=>i(x+c,T)),p=Math.min(n.length,s.length);for(let x=1;x<p;x++){let T=n[x]*r,R=s[x]*r;UM({source:t.subarray(a,T),target:e,start:c,end:R,size:r,getData:h}),a=T,c=R}return c<e.length&&UM({source:[],target:e,start:c,size:r,getData:h}),e}function Yk(t){let{device:e,settings:r,value:i}=t,n=new dA(e,r);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),n}function xw(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function bw(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function vw(t){t.push(t.shift())}function Kk(t,e){let{doublePrecision:r,settings:i,value:n,size:s}=t,a=r&&n instanceof Float64Array?2:1,c=0,{shaderAttributes:h}=t.settings;if(h)for(let p of Object.values(h))c=Math.max(c,p.vertexOffset??0);return(i.noAlloc?n.length:(e+c)*s)*a}function ww({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function Tw({device:t,buffer:e,attribute:r,fromLength:i,toLength:n,fromStartIndices:s,getData:a=c=>c}){let c=r.doublePrecision&&r.value instanceof Float64Array?2:1,h=r.size*c,p=r.byteOffset,x=r.settings.bytesPerElement<4?p/r.settings.bytesPerElement*4:p,T=r.startIndices,R=s&&T,k=r.isConstant;if(!R&&e&&i>=n)return e;let j=r.value instanceof Float64Array?Float32Array:r.value.constructor,q=k?r.value:new j(r.getBuffer().readSyncWebGL(p,n*j.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!k){let oe=a;a=(ae,pe)=>r.normalizeConstant(oe(ae,pe))}let X=k?(oe,ae)=>a(q,ae):(oe,ae)=>a(q.subarray(oe+p,oe+p+h),ae),re=e?new Float32Array(e.readSyncWebGL(x,i*4).buffer):new Float32Array(0),te=new Float32Array(n);return Xk({source:re,target:te,sourceStartIndices:s,targetStartIndices:T,size:h,getData:X}),(!e||e.byteLength<te.byteLength+x)&&(e?.destroy(),e=t.createBuffer({byteLength:te.byteLength+x,usage:35050})),e.write(te,x),e}var b0=class{constructor({device:e,attribute:r,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Rc(i),this.attribute=r,this.attributeInTransition=Yk(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Kk(this.attribute,r),this.transition.start({...e,duration:i})}update(){let e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let e of this.buffers)e.destroy();this.buffers.length=0}};var cy=class extends b0{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="interpolation",this.transform=Dse(e,r)}start(e,r){let i=this.currentLength,n=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}let{buffers:s,attribute:a}=this;vw(s),s[0]=Tw({device:this.device,buffer:s[0],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter}),s[1]=ww({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);let{transform:c}=this,h=c.model,p=Math.floor(this.currentLength/a.size);Jk(a)&&(p/=2),h.setVertexCount(p),a.isConstant?(h.setAttributes({aFrom:s[0]}),h.setConstantAttributes({aTo:a.value})):h.setAttributes({aFrom:s[0],aTo:a.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){let{duration:e,easing:r}=this.settings,{time:i}=this.transition,n=i/e;r&&(n=r(n));let{model:s}=this.transform,a={time:n};s.shaderInputs.setProps({interpolation:a}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},Bse=`uniform interpolationUniforms {
  float time;
} interpolation;
`,Qk={name:"interpolation",vs:Bse,uniformTypes:{time:"f32"}},Lse=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,Ose=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Jk(t){return t.doublePrecision&&t.value instanceof Float64Array}function Dse(t,e){let r=e.size,i=xw(r),n=bw(r),s=e.getBufferLayout();return Jk(e)?new Fu(t,{vs:Ose,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*r}]}],modules:[XI,Qk],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Fu(t,{vs:Lse,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:s.attributes[0].format}],modules:[Qk],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}var uy=class extends b0{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="spring",this.texture=Vse(e),this.framebuffer=jse(e,this.texture),this.transform=Use(e,r)}start(e,r){let i=this.currentLength,n=this.currentStartIndices;super.start(e,r);let{buffers:s,attribute:a}=this;for(let h=0;h<2;h++)s[h]=Tw({device:this.device,buffer:s[h],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter});s[2]=ww({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);let{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/a.size)),a.isConstant?c.setConstantAttributes({aTo:a.value}):c.setAttributes({aTo:a.getBuffer()})}onUpdate(){let{buffers:e,transform:r,framebuffer:i,transition:n}=this,s=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]});let a={stiffness:s.stiffness,damping:s.damping};r.model.shaderInputs.setProps({spring:a}),r.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),vw(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}},Fse=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,kse={name:"spring",vs:Fse,uniformTypes:{damping:"f32",stiffness:"f32"}},Nse=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,zse=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Use(t,e){let r=xw(e.size),i=bw(e.size);return new Fu(t,{vs:Nse,fs:zse,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[kse],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Vse(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function jse(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}var Gse={interpolation:cy,spring:uy},hy=class{constructor(e,{id:r,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:i}){this.numInstances=i||1;for(let n in e){let s=e[n],a=s.getTransitionSetting(r);a&&this._updateAttribute(n,s,a)}for(let n in this.transitions){let s=e[n];(!s||!s.getTransitionSetting(r))&&this._removeTransition(n)}}hasAttribute(e){let r=this.transitions[e];return r&&r.inProgress}getAttributes(){let e={};for(let r in this.transitions){let i=this.transitions[r];i.inProgress&&(e[r]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(let r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,i){let n=this.transitions[e],s=!n||n.type!==i.type;if(s){n&&this._removeTransition(e);let a=Gse[i.type];a?this.transitions[e]=new a({attribute:r,timeline:this.timeline,device:this.device}):(ur.error(`unsupported transition type '${i.type}'`)(),s=!1)}(s||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}};var eN="attributeManager.invalidate",Hse="attributeManager.updateStart",Wse="attributeManager.updateEnd",$se="attribute.updateStart",qse="attribute.allocate",Zse="attribute.updateEnd",Fl=class{constructor(e,{id:r="attribute-manager",stats:i,timeline:n}={}){this.mergeBoundsMemoized=Ou(wF),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new hy(e,{id:`${r}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(let r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){let i=this._invalidateTrigger(e,r);ps(eN,this,e,i)}invalidateAll(e){for(let r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);ps(eN,this,"all")}update({data:e,numInstances:r,startIndices:i=null,transitions:n,props:s={},buffers:a={},context:c={}}){let h=!1;ps(Hse,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let p in this.attributes){let x=this.attributes[p],T=x.settings.accessor;x.startIndices=i,x.numInstances=r,s[p]&&ur.removed(`props.${p}`,`data.attributes.${p}`)(),x.setExternalBuffer(a[p])||x.setBinaryValue(typeof T=="string"?a[T]:void 0,e.startIndices)||typeof T=="string"&&!a[T]&&x.setConstantValue(s[T])||x.needsUpdate()&&(h=!0,this._updateAttribute({attribute:x,numInstances:r,data:e,props:s,context:c})),this.needsRedraw=this.needsRedraw||x.needsRedraw()}h&&ps(Wse,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:n})}updateTransition(){let{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){let r=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:r,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(let s in r){let a=r[s];a.needsRedraw(e)&&!i.hasAttribute(s)&&(n[s]=a)}return n}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(let i in e){let n=e[i],s={...n,id:i,size:n.isIndexed&&1||n.size||1,...r};this.attributes[i]=new dA(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let e={};for(let r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){let{attributes:i,updateTriggers:n}=this,s=n[e];return s&&s.forEach(a=>{let c=i[a];c&&c.setNeedsUpdate(c.id,r)}),s}_updateAttribute(e){let{attribute:r,numInstances:i}=e;if(ps($se,r),r.constant){r.setConstantValue(r.value);return}r.allocate(i)&&ps(qse,r,i),r.updateBuffer(e)&&(this.needsRedraw=!0,ps(Zse,r,i))}};var fy=class extends Rc{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:r,toValue:i,duration:n,easing:s}}=this,a=s(e/n);this._value=Do(r,i,a)}};var tN=1e-5;function rN(t,e,r,i,n){let s=e-t,c=(r-e)*n,h=-s*i;return c+h+s+e}function Xse(t,e,r,i,n){if(Array.isArray(r)){let s=[];for(let a=0;a<r.length;a++)s[a]=rN(t[a],e[a],r[a],i,n);return s}return rN(t,e,r,i,n)}function iN(t,e){if(Array.isArray(t)){let r=0;for(let i=0;i<t.length;i++){let n=t[i]-e[i];r+=n*n}return Math.sqrt(r)}return Math.abs(t-e)}var dy=class extends Rc{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:r,damping:i,stiffness:n}=this.settings,{_prevValue:s=e,_currValue:a=e}=this,c=Xse(s,a,r,i,n),h=iN(c,r),p=iN(c,a);h<tN&&p<tN&&(c=r,this.end()),this._prevValue=a,this._currValue=c}};var Yse={interpolation:fy,spring:dy},py=class{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,i,n){let{transitions:s}=this;if(s.has(e)){let h=s.get(e),{value:p=h.settings.fromValue}=h;r=p,this.remove(e)}if(n=yw(n),!n)return;let a=Yse[n.type];if(!a){ur.error(`unsupported transition type '${n.type}'`)();return}let c=new a(this.timeline);c.start({...n,fromValue:r,toValue:i}),s.set(e,c)}remove(e){let{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){let e={};for(let[r,i]of this.transitions)i.update(),e[r]=i.value,i.inProgress||this.remove(r);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}};function sN(t){let e=t[Dl];for(let r in e){let i=e[r],{validate:n}=i;if(n&&!n(t[r],i))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function oN(t,e){let r=Ay({newProps:t,oldProps:e,propTypes:t[Dl],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=Qse(t,e),n=!1;return i||(n=Jse(t,e)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:eoe(t,e),transitionsChanged:Kse(t,e)}}function Kse(t,e){if(!t.transitions)return!1;let r={},i=t[Dl],n=!1;for(let s in t.transitions){let a=i[s],c=a&&a.type;(c==="number"||c==="color"||c==="array")&&VM(t[s],e[s],a)&&(r[s]=!0,n=!0)}return n?r:!1}function Ay({newProps:t,oldProps:e,ignoreProps:r={},propTypes:i={},triggerName:n="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${n} changed shallowly`;if(typeof e!="object"||e===null)return`${n} changed shallowly`;for(let s of Object.keys(t))if(!(s in r)){if(!(s in e))return`${n}.${s} added`;let a=VM(t[s],e[s],i[s]);if(a)return`${n}.${s} ${a}`}for(let s of Object.keys(e))if(!(s in r)){if(!(s in t))return`${n}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){let a=VM(t[s],e[s],i[s]);if(a)return`${n}.${s} ${a}`}}return!1}function VM(t,e,r){let i=r&&r.equal;return i&&!i(t,e,r)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function Qse(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1,{dataComparator:i,_dataDiff:n}=t;return i?i(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&n&&(r=n(t.data,e.data)||r),r}function Jse(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&nN(t,e,"all"))return{all:!0};let r={},i=!1;for(let n in t.updateTriggers)n!=="all"&&nN(t,e,n)&&(r[n]=!0,i=!0);return i?r:!1}function eoe(t,e){if(e===null)return!0;let r=e.extensions,{extensions:i}=t;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(r[n]))return!0;return!1}function nN(t,e,r){let i=t.updateTriggers[r];i=i??{};let n=e.updateTriggers[r];return n=n??{},Ay({oldProps:n,newProps:i,triggerName:r})}var toe="count(): argument not an object",roe="count(): argument not a container";function aN(t){if(!noe(t))throw new Error(toe);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(ioe(t))return Object.keys(t).length;throw new Error(roe)}function ioe(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function noe(t){return t!==null&&typeof t=="object"}function jM(t,e){if(!e)return t;let r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){let i=r.modules.findIndex(n=>n.name==="project32");i>=0&&r.modules.splice(i,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{let i={...t.inject};for(let n in e.inject)i[n]=(i[n]||"")+e.inject[n];r.inject=i}return r}var soe={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},GM={};function lN(t,e,r,i){if(r instanceof sn)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let n=null;r.compressed&&(n={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let s=e.createTexture({...r,sampler:{...soe,...n,...i},mipmaps:!0});return GM[s.id]=t,s}function cN(t,e){!e||!(e instanceof sn)||GM[e.id]===t&&(e.delete(),delete GM[e.id])}var ooe={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||HM(t)&&(t.length===3||t.length===4)},equal(t,e,r){return An(t,e,1)}},accessor:{validate(t,e){let r=Ew(t);return r==="function"||r===Ew(e.value)},equal(t,e,r){return typeof e=="function"?!0:An(t,e,1)}},array:{validate(t,e){return e.optional&&!t||HM(t)},equal(t,e,r){let{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?An(t,e,n):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;let{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?An(t,e,n):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;let{dataTransform:i}=r.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{let i=r.context;return!i||!i.device?null:lN(r.id,i.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{cN(r.id,t)}}};function uN(t){let e={},r={},i={};for(let[n,s]of Object.entries(t)){let a=s?.deprecatedFor;if(a)i[n]=Array.isArray(a)?a:[a];else{let c=aoe(n,s);e[n]=c,r[n]=c.value}}return{propTypes:e,defaultProps:r,deprecatedProps:i}}function aoe(t,e){switch(Ew(e)){case"object":return my(t,e);case"array":return my(t,{type:"array",value:e,compare:!1});case"boolean":return my(t,{type:"boolean",value:e});case"number":return my(t,{type:"number",value:e});case"function":return my(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function my(t,e){return"type"in e?{name:t,...ooe[e.type],...e}:"value"in e?{name:t,type:Ew(e.value),...e}:{name:t,type:"object",value:e}}function HM(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Ew(t){return HM(t)?"array":t===null?"null":typeof t}function hN(t,e){let r;for(let s=e.length-1;s>=0;s--){let a=e[s];"extensions"in a&&(r=a.extensions)}let i=WM(t.constructor,r),n=Object.create(i);n[m0]=t,n[Nu]={},n[Pc]={};for(let s=0;s<e.length;++s){let a=e[s];for(let c in a)n[c]=a[c]}return Object.freeze(n),n}var loe="_mergedDefaultProps";function WM(t,e){if(!(t instanceof Cw.constructor))return{};let r=loe;if(e)for(let n of e){let s=n.constructor;s&&(r+=`:${s.extensionName||s.name}`)}let i=fN(t,r);return i||(t[r]=coe(t,e||[]))}function coe(t,e){if(!t.prototype)return null;let i=Object.getPrototypeOf(t),n=WM(i),s=fN(t,"defaultProps")||{},a=uN(s),c=Object.assign(Object.create(null),n,a.defaultProps),h=Object.assign(Object.create(null),n?.[Dl],a.propTypes),p=Object.assign(Object.create(null),n?.[Wv],a.deprecatedProps);for(let x of e){let T=WM(x.constructor);T&&(Object.assign(c,T),Object.assign(h,T[Dl]),Object.assign(p,T[Wv]))}return uoe(c,t),foe(c,h),hoe(c,p),c[Dl]=h,c[Wv]=p,e.length===0&&!$M(t,"_propTypes")&&(t._propTypes=h),c}function uoe(t,e){let r=poe(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function hoe(t,e){for(let r in e)Object.defineProperty(t,r,{enumerable:!1,set(i){let n=`${this.id}: ${r}`;for(let s of e[r])$M(this,s)||(this[s]=i);ur.deprecated(n,e[r].join("/"))()}})}function foe(t,e){let r={},i={};for(let n in e){let s=e[n],{name:a,value:c}=s;s.async&&(r[a]=c,i[a]=doe(a))}t[$h]=r,t[Nu]={},Object.defineProperties(t,i)}function doe(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||gw(e)?this[Nu][t]=e:this[Pc][t]=e},get(){if(this[Pc]){if(t in this[Pc])return this[Pc][t]||this[$h][t];if(t in this[Nu]){let e=this[m0]&&this[m0].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[$h][t]}}return this[$h][t]}}}function $M(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function fN(t,e){return $M(t,e)&&t[e]}function poe(t){let e=t.componentName;return e||ur.warn(`${t.name}.componentName not specified`)(),e||t.name}var Aoe=0,gy=class{constructor(...e){this.props=hN(this,e),this.id=this.props.id,this.count=Aoe++}clone(e){let{props:r}=this,i={};for(let n in r[$h])n in r[Pc]?i[n]=r[Pc][n]:n in r[Nu]&&(i[n]=r[Nu][n]);return new this.constructor({...r,...i,...e})}};gy.componentName="Component";gy.defaultProps={};var Cw=gy;var moe=Object.freeze({}),_y=class{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||moe}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){let r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(let r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[m0]||this.component;let r=e[Pc]||{},i=e[Nu]||e,n=e[$h]||{};for(let s in r){let a=r[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,a),r[s]=this.getAsyncProp(s)}for(let s in i){let a=i[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,a)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(gw(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){let i=this.asyncProps[e];return r===i.resolvedValue||r===i.lastValue?!1:(i.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();let i=this.asyncProps[e];i&&(r=this._postProcessValue(i,r),i.resolvedValue=r,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,r,i){let n=this.asyncProps[e];n&&i>=n.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=r,n.resolvedLoadCount=i,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){let i=this.asyncProps[e];if(i){i.pendingLoadCount++;let n=i.pendingLoadCount;r.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,n),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}let i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;let n=i.pendingLoadCount,s=[],a=0;for await(let c of r){if(!this.component)return;let{dataTransform:h}=this.component.props;h?s=h(c,s):s=s.concat(c),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(e,s,n)}this._onResolve(e,s)}_postProcessValue(e,r){let i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(r,i,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){let n=this.component&&this.component.props[Dl];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}};var yy=class extends _y{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){let i=this.layer,n=i?.props.fetch;return n?n(r,{propName:e,layer:i}):super._fetch(e,r)}_onResolve(e,r){let i=this.layer;if(i){let n=i.props.onDataLoad;e==="data"&&n&&n(r,{propName:e,layer:i})}}_onError(e,r){let i=this.layer;i&&i.raiseError(r,`loading ${e} of ${this.layer}`)}};var goe="layer.changeFlag",_oe="layer.initialize",yoe="layer.update",xoe="layer.finalize",boe="layer.matched",dN=2**24-1,voe=Object.freeze([]),woe=Ou(({oldViewport:t,viewport:e})=>t.equals(e)),Fc=new Uint8ClampedArray(0),Toe={data:{type:"data",value:voe,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:i,loadOptions:n,signal:s})=>{let{resourceManager:a}=r.context;n=n||r.getLoadOptions(),i=i||r.props.loaders,s&&(n={...n,fetch:{...n?.fetch,signal:s}});let c=a.contains(t);return!c&&!n&&(a.add({resourceId:t,data:yo(t,i),persistent:!1}),c=!0),c?a.subscribe({resourceId:t,onChange:h=>r.internalState?.reloadAsyncProp(e,h),consumerId:r.id,requestId:e}):yo(t,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Tr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},xy=class extends Cw{constructor(){super(...arguments),this.internalState=null,this.lifecycle=xd.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){yn(this.internalState);let r=this.internalState.viewport||this.context.viewport,i=_M(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,s,a]=u0(i,r.pixelProjectionMatrix);return e.length===2?[n,s]:[n,s,a]}unproject(e){return yn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){yn(this.internalState);let i=this.internalState.viewport||this.context.viewport;return CF(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(let r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===Tr.DEFAULT||e===Tr.LNGLAT||e===Tr.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){yn(e instanceof Uint8Array);let[r,i,n]=e;return r+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:aN(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=jM(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(let r of this.props.extensions)e=jM(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let r=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&r)if(Array.isArray(i))for(let n of i)r.invalidateAll(n);else r.invalidateAll();if(r){let{props:n}=e,s=this.internalState.hasPickingBuffer,a=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(s!==a){this.internalState.hasPickingBuffer=a;let{pickingColors:c,instancePickingColors:h}=r.attributes,p=c||h;p&&(a&&p.constant&&(p.constant=!1,r.invalidate(p.id)),!p.value&&!a&&(p.constant=!0,p.value=[0,0,0]))}}}finalizeState(e){for(let i of this.getModels())i.destroy();let r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let r of this.getModels())r.draw(e.renderPass)}getPickingInfo({info:e,mode:r,sourceLayer:i}){let{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(e,r){r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;let r=this.internalState.viewport;this.internalState.viewport=e,(!r||!woe({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(let i in e)e[i].layoutChanged()&&(r=!0);for(let i of this.getModels())this._setModelAttributes(i,e,r)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let r=this.props,i=this.getNumInstances(),n=this.getStartIndices();e.update({data:r.data,numInstances:i,startIndices:n,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});let s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let r=e.update(),i=Object.create(this.props);for(let n in r)Object.defineProperty(i,n,{value:r[n]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;let i=Math.floor(Fc.length/4);if(this.internalState.usesPickingColorCache=!0,i<r){r>dN&&ur.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Fc=Mc.allocate(Fc,r,{size:4,copy:!0,maxCount:Math.max(r,dN)});let n=Math.floor(Fc.length/4),s=[0,0,0];for(let a=i;a<n;a++)this.encodePickingColor(a,s),Fc[a*4+0]=s[0],Fc[a*4+1]=s[1],Fc[a*4+2]=s[2],Fc[a*4+3]=0}e.value=Fc.subarray(0,r*4)}_setModelAttributes(e,r,i=!1){if(!Object.keys(r).length)return;if(i){let c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts(e)),r=c.getAttributes()}let n=e.userData?.excludeAttributes||{},s={},a={};for(let c in r){if(n[c])continue;let h=r[c].getValue();for(let p in h){let x=h[p];x instanceof qi?r[c].settings.isIndexed?e.setIndexBuffer(x):s[p]=x:x&&(a[p]=x)}}e.setAttributes(s),e.setConstantAttributes(a)}disablePickingIndex(e){let r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}let{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,s=i||n,a=s&&r.attributes&&r.attributes[s.id];if(a&&a.value){let c=a.value,h=this.encodePickingColor(e);for(let p=0;p<r.length;p++){let x=s.getVertexOffset(p);c[x]===h[0]&&c[x+1]===h[1]&&c[x+2]===h[2]&&this._disablePickingIndex(p)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,n=r||i;if(!n)return;let s=n.getVertexOffset(e),a=n.getVertexOffset(e+1);n.buffer.write(new Uint8Array(a-s),s)}restorePickingColors(){let{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,i=e||r;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Fc.buffer&&(i.value=Fc.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){yn(!this.internalState),yn(Number.isFinite(this.props.coordinateSystem)),ps(_oe,this);let e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new yy({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ur.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new py(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){ps(boe,this,this===e);let{state:r,internalState:i}=e;this!==e&&(this.internalState=i,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if(ps(yoe,this,e),!e)return;let r=this.props,i=this.context,n=this.internalState,s=i.viewport,a=this._updateUniformTransition();n.propsInTransition=a,i.viewport=n.viewport||s,this.props=a;try{let c=this._getUpdateParams(),h=this.getModels();if(i.device)this.updateState(c);else try{this.updateState(c)}catch{}for(let x of this.props.extensions)x.updateState.call(this,c,x);this.setNeedsRedraw(),this._updateAttributes();let p=this.getModels()[0]!==h[0];this._postUpdate(c,p)}finally{i.viewport=s,this.props=r,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){ps(xoe,this),this.finalizeState(this.context);for(let e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:r=null,uniforms:i={},parameters:n={}}){this._updateAttributeTransition();let s=this.props,a=this.context;this.props=this.internalState.propsInTransition||s;try{r&&this.setShaderModuleProps(r);let{getPolygonOffset:c}=this.props,h=c&&c(i)||[0,0];a.device instanceof Dc&&a.device.setParametersWebGL({polygonOffset:h});for(let p of this.getModels())p.device.type==="webgpu"?p.setParameters({...p.parameters,...n}):p.setParameters(n);if(a.device instanceof Dc)a.device.withParametersWebGL(n,()=>{let p={renderPass:e,shaderModuleProps:r,uniforms:i,parameters:n,context:a};for(let x of this.props.extensions)x.draw.call(this,p,x);this.draw(p)});else{let p={renderPass:e,shaderModuleProps:r,uniforms:i,parameters:n,context:a};for(let x of this.props.extensions)x.draw.call(this,p,x);this.draw(p)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:r}=this.internalState;for(let n in e)if(e[n]){let s=!1;switch(n){case"dataChanged":let a=e[n],c=r[n];a&&Array.isArray(c)&&(r.dataChanged=Array.isArray(a)?c.concat(a):a,s=!0);default:r[n]||(r[n]=e[n],s=!0)}s&&ps(goe,this,n,e)}let i=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=i,r.somethingChanged=i||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){let i=oN(e,r);if(i.updateTriggersChanged)for(let n in i.updateTriggersChanged)i.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(i.transitionsChanged)for(let n in i.transitionsChanged)this.internalState.uniformTransitions.add(n,r[n],e[n],e.transitions?.[n]);return this.setChangeFlags(i)}validateProps(){sN(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(r.highlightColor=i(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new Fl(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){let{props:i,oldProps:n}=e,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());let{autoHighlight:a,highlightedObjectIndex:c,highlightColor:h}=i;if(r||n.autoHighlight!==a||n.highlightedObjectIndex!==c||n.highlightColor!==h){let p={};Array.isArray(h)&&(p.highlightColor=h),(r||n.autoHighlight!==a||c!==n.highlightedObjectIndex)&&(p.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:p})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;let i=this.getAttributeManager(),n=i?i.getNeedsRedraw(e):!1;if(r=r||n,r)for(let s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};xy.defaultProps=Toe;xy.layerName="Layer";var ln=xy;var Eoe="compositeLayer.renderLayers",Sw=class extends ln{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){let{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){let{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||r}getSubLayerRow(e,r,i){return e.__source={parent:this,object:r,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){let r={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(r.index=i.__source.index,e(i.__source.object,r)):e(i,n)}return e}getSubLayerProps(e={}){let{opacity:r,pickable:i,visible:n,parameters:s,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:h,highlightColor:p,coordinateSystem:x,coordinateOrigin:T,wrapLongitude:R,positionFormat:k,modelMatrix:j,extensions:q,fetch:X,operation:re,_subLayerProps:te}=this.props,oe={id:"",updateTriggers:{},opacity:r,pickable:i,visible:n,parameters:s,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:h,highlightColor:p,coordinateSystem:x,coordinateOrigin:T,wrapLongitude:R,positionFormat:k,modelMatrix:j,extensions:q,fetch:X,operation:re},ae=te&&e.id&&te[e.id],pe=ae&&ae.updateTriggers,be=e.id||"sublayer";if(ae){let Fe=this.props[Dl],Y=e.type?e.type._propTypes:{};for(let J in ae){let Z=Y[J]||Fe[J];Z&&Z.type==="accessor"&&(ae[J]=this.getSubLayerAccessor(ae[J]))}}Object.assign(oe,e,ae),oe.id=`${this.props.id}-${be}`,oe.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...pe};for(let Fe of q){let Y=Fe.getSubLayerProps.call(this,Fe);Y&&Object.assign(oe,Y,{updateTriggers:Object.assign(oe.updateTriggers,Y.updateTriggers)})}return oe}_updateAutoHighlight(e){for(let r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let i=this.internalState.subLayers,n=!i||this.needsUpdate();if(n){let s=this.renderLayers();i=Ra(s,Boolean),this.internalState.subLayers=i}ps(Eoe,this,n,i);for(let s of i)s.parent=this}};Sw.layerName="CompositeLayer";var ss=Sw;var Iw=Math.PI/180,pN=180/Math.PI,Mw=6370972,v0=256;function Coe(){let t=v0/Mw,e=Math.PI/180*v0;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}var Ed=class extends sl{constructor(e={}){let{longitude:r=0,zoom:i=0,nearZMultiplier:n=.5,farZMultiplier:s=1,resolution:a=10}=e,{latitude:c=0,height:h,altitude:p=1.5,fovy:x}=e;c=Math.max(Math.min(c,Ll),-Ll),h=h||1,x?p=rA(x):x=Gh(p);let T=1/Math.PI/Math.cos(c*Math.PI/180),R=Math.pow(2,i)*T,k=e.nearZ??n,j=e.farZ??(p+v0*2*R/h)*s,q=new Er().lookAt({eye:[0,-p,0],up:[0,0,1]});q.rotateX(c*Iw),q.rotateZ(-r*Iw),q.scale(R/h),super({...e,height:h,viewMatrix:q,longitude:r,latitude:c,zoom:i,distanceScales:Coe(),fovy:x,focalDistance:p,near:k,far:j}),this.scale=R,this.latitude=c,this.longitude=r,this.resolution=a}get projectionMode(){return ro.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){let r={targetZ:e.z||0},i=this.unproject([0,this.height/2],r),n=this.unproject([this.width/2,0],r),s=this.unproject([this.width,this.height/2],r),a=this.unproject([this.width/2,this.height],r);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],n[0],a[0]),Math.min(i[1],s[1],n[1],a[1]),Math.max(i[0],s[0],n[0],a[0]),Math.max(i[1],s[1],n[1],a[1])]}unproject(e,{topLeft:r=!0,targetZ:i}={}){let[n,s,a]=e,c=r?s:this.height-s,{pixelUnprojectionMatrix:h}=this,p;if(Number.isFinite(a))p=qM(h,[n,c,a,1]);else{let k=qM(h,[n,c,-1,1]),j=qM(h,[n,c,1,1]),q=((i||0)/Mw+1)*v0,X=Fo.sqrLen(Fo.sub([],k,j)),re=Fo.sqrLen(k),te=Fo.sqrLen(j),ae=4*((4*re*te-(X-re-te)**2)/16)/X,pe=Math.sqrt(re-ae),be=Math.sqrt(Math.max(0,q*q-ae)),Fe=(pe-be)/Math.sqrt(X);p=Fo.lerp([],k,j,Fe)}let[x,T,R]=this.unprojectPosition(p);return Number.isFinite(a)?[x,T,R]:Number.isFinite(i)?[x,T,i]:[x,T]}projectPosition(e){let[r,i,n=0]=e,s=r*Iw,a=i*Iw,c=Math.cos(a),h=(n/Mw+1)*v0;return[Math.sin(s)*c*h,-Math.cos(s)*c*h,Math.sin(a)*h]}unprojectPosition(e){let[r,i,n]=e,s=Fo.len(e),a=Math.asin(n/s),h=Math.atan2(r,-i)*pN,p=a*pN,x=(s/v0-1)*Mw;return[h,p,x]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,r){let i=this.unproject(r);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}};function qM(t,e){let r=Pa.transformMat4([],e,t);return Pa.scale(r,r,1/r[3]),r}var ZM=class extends q1{applyConstraints(e){let{maxZoom:r,minZoom:i,zoom:n}=e;e.zoom=xo(n,i,r);let{longitude:s,latitude:a}=e;return(s<-180||s>180)&&(e.longitude=xF(s+180,360)-180),e.latitude=xo(a,-Ll,Ll),e}},by=class extends cA{constructor(){super(...arguments),this.ControllerState=ZM,this.transition={transitionDuration:300,transitionInterpolator:new Xh(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}};var Pw=class extends aA{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?Du:Ed}get ControllerType(){return by}};Pw.displayName="GlobeView";var XM=Pw;var vy=class{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&An(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){let{defaultProps:r}=e.constructor,i={updateTriggers:{}};for(let n in r)if(n in this.props){let s=r[n],a=this.props[n];i[n]=a,s&&s.type==="accessor"&&(i.updateTriggers[n]=this.props.updateTriggers[n],typeof a=="function"&&(i[n]=this.getSubLayerAccessor(a)))}return i}initializeState(e,r){}updateState(e,r){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,r){}finalizeState(e,r){}};vy.defaultProps={};vy.extensionName="LayerExtension";var YM=vy;var Cd=class{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;let{attributes:r={}}=e;this.typedArrayManager=Mc,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);let{data:r,buffers:i={},getGeometry:n,geometryBuffer:s,positionFormat:a,dataChanged:c,normalize:h=!0}=this.opts;if(this.data=r,this.getGeometry=n,this.positionSize=s&&s.size||(a==="XY"?2:3),this.buffers=i,this.normalize=h,s&&(yn(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),h||(i.vertexPositions=s)),this.geometryBuffer=i.vertexPositions,Array.isArray(c))for(let p of c)this._rebuildGeometry(p);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:r}){this._rebuildGeometry({startRow:e,endRow:r})}getGeometryFromBuffer(e){let r=e.value||e;return ArrayBuffer.isView(r)?_w(r,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,r){let{attributes:i,buffers:n,_attributeDefs:s,typedArrayManager:a}=this;for(let c in s)if(c in n)a.release(i[c]),i[c]=null;else{let h=s[c];h.copy=r,i[c]=a.allocate(i[c],e,h)}}_forEachGeometry(e,r,i){let{data:n,getGeometry:s}=this,{iterable:a,objectInfo:c}=Ps(n,r,i);for(let h of a){c.index++;let p=s?s(h,c):null;e(p,c.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:r,vertexStarts:i,instanceCount:n}=this,{data:s,geometryBuffer:a}=this,{startRow:c=0,endRow:h=1/0}=e||{},p={};if(e||(r=[0],i=[0]),this.normalize||!a)this._forEachGeometry((T,R)=>{let k=T&&this.normalizeGeometry(T);p[R]=k,i[R+1]=i[R]+(k?this.getGeometrySize(k):0)},c,h),n=i[i.length-1];else if(i=s.startIndices,n=i[s.length]||0,ArrayBuffer.isView(a))n=n||a.length/this.positionSize;else if(a instanceof qi){let T=this.positionSize*4;n=n||a.byteLength/T}else if(a.buffer){let T=a.stride||this.positionSize*4;n=n||a.buffer.byteLength/T}else if(a.value){let T=a.value,R=a.stride/T.BYTES_PER_ELEMENT||this.positionSize;n=n||T.length/R}this._allocate(n,!!e),this.indexStarts=r,this.vertexStarts=i,this.instanceCount=n;let x={};this._forEachGeometry((T,R)=>{let k=p[R]||T;x.vertexStart=i[R],x.indexStart=r[R];let j=R<i.length-1?i[R+1]:n;x.geometrySize=j-i[R],x.geometryIndex=R,this.updateGeometryAttributes(k,x)},c,h),this.vertexCount=r[r.length-1]}};var KM=512,Soe=Math.PI/180;function Rw({map:t,gl:e,deck:r}){if(t.__deck)return t.__deck;let i=r?.props._customRender,n=r?.props.onLoad,s={...r?.props,_customRender:()=>{t.triggerRepaint(),i?.("")}};s.parameters={...Bw(t,!0),...s.parameters},s.views||(s.views=wy(t));let a;return(!r||r.props.gl===e)&&(Object.assign(s,{gl:e,width:null,height:null,touchAction:"unset",viewState:w0(t)}),r?.isInitialized?AN(r,t):s.onLoad=()=>{n?.(),AN(a,t)}),r?(a=r,r.setProps(s),r.userData.isExternal=!0):(a=new x0(s),t.on("remove",()=>{QM(t)})),a.userData.mapboxLayers=new Set,t.__deck=a,t.on("render",()=>{a.isInitialized&&Moe(a,t)}),a}function AN(t,e){let r=()=>{t.isInitialized?Poe(t,e):e.off("move",r)};e.on("move",r)}function QM(t){t.__deck?.finalize(),t.__deck=null}function Bw(t,e){let r=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return xN(t)==="globe"&&(r.cullMode="back"),r}function mN(t,e){t.userData.mapboxLayers.add(e),JM(t)}function gN(t,e){t.userData.mapboxLayers.delete(e),JM(t)}function _N(t,e){JM(t)}function yN(t,e,r,i){let{currentViewport:n}=t.userData,s=!1;n||(n=bN(t,e,i),t.userData.currentViewport=n,s=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:({layer:a})=>r.id===a.id||a.props.operation.includes("terrain"),clearStack:s,clearCanvas:!1})}function xN(t){let e=t.getProjection?.(),r=e?.type||e?.name;if(r==="globe")return"globe";if(r&&r!=="mercator")throw new Error("Unsupported projection");return"mercator"}function wy(t){return xN(t)==="globe"?new XM({id:"mapbox"}):new X1({id:"mapbox"})}function w0(t){let{lng:e,lat:r}=t.getCenter(),i={longitude:(e+540)%360-180,latitude:r,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return t.getTerrain?.()&&Ioe(t,i),i}function Ioe(t,e){if(t.getFreeCameraOptions){let{position:r}=t.getFreeCameraOptions();if(!r||r.z===void 0)return;let i=t.transform.height,{longitude:n,latitude:s,pitch:a}=e,c=r.x*KM,h=(1-r.y)*KM,p=r.z*KM,x=io([n,s]),T=c-x[0],R=h-x[1],k=Math.sqrt(T*T+R*R),j=a*Soe,q=1.5*i,X=j<.001?q*Math.cos(j)/p:q*Math.sin(j)/k;e.zoom=Math.log2(X);let re=q*Math.cos(j)/X,te=p-re;e.position=[0,0,te/tA(s)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function bN(t,e,r){let i=w0(e),n=wy(e);r&&(n.props.nearZMultiplier=.2);let s=r?.nearZ??e.transform._nearZ,a=r?.farZ??e.transform._farZ;return Number.isFinite(s)&&(i.nearZ=s/e.transform.height,i.farZ=a/e.transform.height),n.makeViewport({width:t.width,height:t.height,viewState:i})}function Moe(t,e){let{mapboxLayers:r,isExternal:i}=t.userData;if(i){let n=Array.from(r,x=>x.id),a=Ra(t.props.layers,Boolean).some(x=>x&&!n.includes(x.id)),c=t.getViewports(),h=c.findIndex(x=>x.id==="mapbox"),p=c.length>1||h<0;(a||p)&&(h>=0&&(c=c.slice(),c[h]=bN(t,e)),t._drawLayers("mapbox-repaint",{viewports:c,layerFilter:x=>(!t.props.layerFilter||t.props.layerFilter(x))&&(x.viewport.id!=="mapbox"||!n.includes(x.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function Poe(t,e){t.setProps({viewState:w0(e)}),t.needsRedraw({clearRedrawFlags:!0})}function JM(t){if(t.userData.isExternal)return;let e=[];t.userData.mapboxLayers.forEach(r=>{let i=r.props.type,n=new i(r.props);e.push(n)}),t.setProps({layers:e})}var Ty=class{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,r){this.map=e,this.deck=Rw({map:e,gl:r,deck:this.props.deck}),mN(this.deck,this)}onRemove(){this.deck&&gN(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&_N(this.deck,this)}render(e,r){yN(this.deck,this.map,this,r)}};var e4="__UNDEFINED__";function Ey(t,e,r,i){if(!t||!e||!t.style||!t.style._loaded)return;let n=Ra(i,Boolean);if(r!==i){let c=Ra(r,Boolean),h=new Set(c.map(p=>p.id));for(let p of n)h.delete(p.id);for(let p of h)t.getLayer(p)&&t.removeLayer(p)}for(let c of n){let h=t.getLayer(c.id);h?(h.implementation||h).setProps(c.props):t.addLayer(new Ty({id:c.id,deck:e}),c.props.beforeId)}let s=t.style._order,a={};for(let c of n){let{beforeId:h}=c.props;(!h||!s.includes(h))&&(h=e4),a[h]=a[h]||[],a[h].push(c.id)}for(let c in a){let h=a[c],p=c===e4?s.length:s.indexOf(c),x=c===e4?void 0:c;for(let T=h.length-1;T>=0;T--){let R=h[T],k=s.indexOf(R);k!==p-1&&(t.moveLayer(R,x),k>p&&p++),p--,x=R}}}var T0=class{constructor(e){this._handleStyleChange=()=>{Ey(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:n,clientHeight:s}=this._map.getContainer();Object.assign(this._container.style,{width:`${n}px`,height:`${s}px`})}},this._updateViewState=()=>{let n=this._deck,s=this._map;n&&s&&(n.setProps({views:this._props.views||wy(s),viewState:w0(s)}),n.isInitialized&&n.redraw())},this._handleMouseEvent=n=>{let s=this._deck;if(!s||!s.isInitialized)return;let a={type:n.type,offsetCenter:n.point,srcEvent:n},c=this._lastMouseDownPoint;switch(!n.point&&c&&(a.deltaX=n.originalEvent.clientX-c.clientX,a.deltaY=n.originalEvent.clientY-c.clientY,a.offsetCenter={x:c.x+a.deltaX,y:c.y+a.deltaY}),a.type){case"mousedown":s._onPointerDown(a),this._lastMouseDownPoint={...n.point,clientX:n.originalEvent.clientX,clientY:n.originalEvent.clientY};break;case"dragstart":a.type="panstart",s._onEvent(a);break;case"drag":a.type="panmove",s._onEvent(a);break;case"dragend":a.type="panend",s._onEvent(a);break;case"click":a.tapCount=1,s._onEvent(a);break;case"dblclick":a.type="click",a.tapCount=2,s._onEvent(a);break;case"mousemove":a.type="pointermove",s._onPointerMove(a);break;case"mouseout":a.type="pointerleave",s._onPointerMove(a);break;default:return}};let{interleaved:r=!1,...i}=e;this._interleaved=r,this._props=i}setProps(e){this._interleaved&&e.layers&&Ey(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...Bw(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){let r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new x0({...this._props,parent:r,parameters:{...Bw(e,!1),...this._props.parameters},views:this._props.views||wy(e),viewState:w0(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(e){let r=e.painter.context.gl;return r instanceof WebGLRenderingContext&&ur.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=Rw({map:e,gl:r,deck:new x0({...this._props,gl:r})}),e.on("styledata",this._handleStyleChange),Ey(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){let e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Ey(e,this._deck,this._props.layers,[]),QM(e)}getDefaultPosition(){return"top-left"}pickObject(e){return yn(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return yn(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return yn(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}};function E0(t,e=""){if(!t)throw new Error(`JSON conversion error ${e}`)}function wN(t,e){let r=Boe(e),i=t;for(let n of r)i=Roe(i)?i[n]:void 0;return i}function Roe(t){return t!==null&&typeof t=="object"}var vN={};function Boe(t){if(typeof t=="string"){let e=vN[t];return e||(e=t.split("."),vN[t]=e),e}return Array.isArray(t)?t:[t]}var t4=_l(TN(),1);var EN={"||":(t,e)=>t||e,"&&":(t,e)=>t&&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"&":(t,e)=>t&e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"<":(t,e)=>t<e,">":(t,e)=>t>e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e},Loe={"-":t=>-t,"+":t=>+t,"~":t=>~t,"!":t=>!t};function CN(t,e){return t.map(function(r){return wo(r,e)})}function SN(t,e){let r=wo(t.object,e),i;if(t.computed?i=wo(t.property,e):i=t.property.name,/^__proto__|prototype|constructor$/.test(i))throw Error(`Access to member "${i}" disallowed.`);return[r,r[i]]}function wo(t,e){let r=t;switch(r.type){case"ArrayExpression":return CN(r.elements,e);case"BinaryExpression":return EN[r.operator](wo(r.left,e),wo(r.right,e));case"CallExpression":let i,n,s;return r.callee.type==="MemberExpression"?(s=SN(r.callee,e),i=s[0],n=s[1]):n=wo(r.callee,e),typeof n!="function"?void 0:n.apply(i,CN(r.arguments,e));case"ConditionalExpression":return wo(r.test,e)?wo(r.consequent,e):wo(r.alternate,e);case"Identifier":return e[r.name];case"Literal":return r.value;case"LogicalExpression":return r.operator==="||"?wo(r.left,e)||wo(r.right,e):r.operator==="&&"?wo(r.left,e)&&wo(r.right,e):EN[r.operator](wo(r.left,e),wo(r.right,e));case"MemberExpression":return SN(r,e)[1];case"ThisExpression":return e;case"UnaryExpression":return Loe[r.operator](wo(r.argument,e));default:return}}var r4={"-":t=>t};function Sy(t,e){if(t in r4)return r4[t];let r,i=(0,t4.default)(t);return i.type==="Identifier"?r=n=>wN(n,t):(i4(i,n=>{if(n.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),r=n=>wo(i,n)),r4[t]=r,r}function i4(t,e){if(Array.isArray(t))t.forEach(r=>i4(r,e));else if(t&&typeof t=="object"){t.type&&e(t);for(let r in t)i4(t[r],e)}}var C0="@@=",n4="@@#",IN="@@type",Ow="@@function";var MN=t=>t&&typeof t=="object",Hu=class{constructor(...e){this.typeKey=IN,this.functionKey=Ow,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=Sy,this.preProcessClassProps=(r,i)=>i,this.postProcessConvertedJson=r=>r;for(let r of e)this.merge(r)}merge(e){for(let r in e)switch(r){case"layers":case"views":Object.assign(this.classes,e[r]);break;default:if(r in this){let i=e[r];this[r]=MN(this[r])?Object.assign(this[r],i):i}}}validate(e){return E0(!this.typeKey||typeof this.typeKey=="string"),E0(MN(this.classes)),!0}};function Ooe(t){return typeof t=="string"&&t.startsWith(C0)}function Doe(t){return t.replace(C0,"")}function Dw(t,e){let r={};for(let i in t){let n=t[i];Ooe(n)&&(n=Doe(n),n=Sy(n,e)),r[i]=n}return r}function PN(t,e,r){let i=r.classes[t],n=r.reactComponents[t];if(!i&&!n){let{log:s}=r;if(s){let a=JSON.stringify(e,null,0).slice(0,40);s.warn(`JSON converter: No registered class of type ${t}(${a}...)  `)}return null}return i?Foe(i,e,r):koe(n,e,r)}function Foe(t,e,r){return r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=Dw(e,r),new t(e)}function koe(t,e,r){let{React:i}=r,{children:n=[]}=e;return delete e.children,r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=Dw(e,r),i.createElement(t,e,n)}function RN(t,e,r){let i=r.functions[t];if(!i){let{log:n}=r;if(n){let s=JSON.stringify(e,null,0).slice(0,40);n.warn(`JSON converter: No registered function ${t}(${s}...)  `)}return null}return i(e)}function s4(t){return typeof t=="string"?JSON.parse(t):t}var o4=t=>t&&typeof t=="object",S0=class{constructor(e){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(e)}finalize(){}setProps(e){"configuration"in e&&(this.configuration=e.configuration instanceof Hu?e.configuration:new Hu(e.configuration)),"onJSONChange"in e&&(this.onJSONChange=e.onJSONChange)}mergeConfiguration(e){this.configuration.merge(e)}convert(e){if(!e||e===this.json)return this.convertedJson;this.json=e;let r=s4(e),i=Noe(r,this.configuration);return i=this.configuration.postProcessConvertedJson(i),this.convertedJson=i,i}convertJson(e){return this.convert(e)}};function Noe(t,e){return e=new Hu(e),a4(t,"",e)}function a4(t,e,r){return Array.isArray(t)?t.map((i,n)=>a4(i,String(n),r)):zoe(t,r)?Uoe(t,r):o4(t)?Ow in t?Voe(t,r):l4(t,r):typeof t=="string"?joe(t,e,r):t}function zoe(t,e){let{typeKey:r}=e;return o4(t)&&!!t[r]}function Uoe(t,e){let{typeKey:r}=e,i=t[r],n={...t};return delete n[r],n=l4(n,e),PN(i,n,e)}function Voe(t,e){let{functionKey:r}=e,i=t[r],n={...t};return delete n[r],n=l4(n,e),RN(i,n,e)}function l4(t,e){E0(o4(t));let r={};for(let i in t){let n=t[i];r[i]=a4(n,i,e)}return r}function joe(t,e,r){if(t.startsWith(C0)&&r.convertFunction)return t=t.replace(C0,""),r.convertFunction(t,r);if(t.startsWith(n4)){if(t=t.replace(n4,""),r.constants[t])return r.constants[t];let[i,n]=t.split(".");return r.enumerations[i][n]}return t}var K5={};Es(K5,{ArcLayer:()=>kw,BitmapLayer:()=>Nw,CPUAggregator:()=>ca,ColumnLayer:()=>Wu,ContourLayer:()=>Bz,GeoJsonLayer:()=>_A,GeohashLayer:()=>sW,GreatCircleLayer:()=>HU,GridCellLayer:()=>E7,GridLayer:()=>kz,H3ClusterLayer:()=>qV,H3HexagonLayer:()=>U3,HeatmapLayer:()=>tU,HexagonLayer:()=>J9,IconLayer:()=>I0,LineLayer:()=>JN,MVTLayer:()=>tW,PathLayer:()=>$u,PointCloudLayer:()=>zw,PolygonLayer:()=>Rd,QuadkeyLayer:()=>nV,S2Layer:()=>rV,ScatterplotLayer:()=>Uw,ScreenGridLayer:()=>j9,SolidPolygonLayer:()=>Pd,TerrainLayer:()=>MH,TextLayer:()=>o3,Tile3DLayer:()=>vH,TileLayer:()=>TA,TripsLayer:()=>TV,WebGLAggregator:()=>Rs,_AggregationLayer:()=>qu,_GeoCellLayer:()=>Zu,_MultiIconLayer:()=>i3,_TextBackgroundLayer:()=>s3,_Tile2DHeader:()=>vA,_Tileset2D:()=>wA,_WMSLayer:()=>X0,_getURLFromTemplate:()=>Ku});var BN=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,LN={name:"arc",vs:BN,fs:BN,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}};var ON=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var DN=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Fw=[0,0,0,255],Goe={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:Fw},getTargetColor:{type:"accessor",value:Fw},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Iy=class extends ln{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:ON,fs:DN,modules:[Li,Sn,LN]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:Fw},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:Fw},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:r,widthScale:i,widthMinPixels:n,widthMaxPixels:s,greatCircle:a,wrapLongitude:c,numSegments:h}=this.props,p={numSegments:h,widthUnits:Dn[r],widthScale:i,widthMinPixels:n,widthMaxPixels:s,greatCircle:a,useShortestPath:c},x=this.state.model;x.shaderInputs.setProps({arc:p}),x.setVertexCount(h*2),x.draw(this.context.renderPass)}_getModel(){return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}};Iy.layerName="ArcLayer";Iy.defaultProps=Goe;var kw=Iy;var Hoe=new Uint32Array([0,2,1,0,3,2]),Woe=new Float32Array([0,1,0,0,1,0,1,1]);function c4(t,e){if(!e)return $oe(t);let r=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),n=Math.ceil(r/e)+1,s=Math.ceil(i/e)+1,a=(n-1)*(s-1)*6,c=new Uint32Array(a),h=new Float32Array(n*s*2),p=new Float64Array(n*s*3),x=0,T=0;for(let R=0;R<n;R++){let k=R/(n-1);for(let j=0;j<s;j++){let q=j/(s-1),X=qoe(t,k,q);p[x*3+0]=X[0],p[x*3+1]=X[1],p[x*3+2]=X[2]||0,h[x*2+0]=k,h[x*2+1]=1-q,R>0&&j>0&&(c[T++]=x-s,c[T++]=x-s-1,c[T++]=x-1,c[T++]=x-s,c[T++]=x-1,c[T++]=x),x++}}return{vertexCount:a,positions:p,indices:c,texCoords:h}}function $oe(t){let e=new Float64Array(12);for(let r=0;r<t.length;r++)e[r*3+0]=t[r][0],e[r*3+1]=t[r][1],e[r*3+2]=t[r][2]||0;return{vertexCount:6,positions:e,indices:Hoe,texCoords:Woe}}function qoe(t,e,r){return Do(Do(t[0],t[1],r),Do(t[3],t[2],r),e)}var FN=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,kN={name:"bitmap",vs:FN,fs:FN,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}};var NN=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var Zoe=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,zN=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${Zoe}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`;var Xoe={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Tr.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}},My=class extends ln{getShaders(){return super.getShaders({vs:NN,fs:zN,modules:[Li,Sn,kN]})}initializeState(){let e=this.getAttributeManager();e.remove(["instancePickingColors"]);let r=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:r},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:r},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:r}})}updateState({props:e,oldProps:r,changeFlags:i}){let n=this.getAttributeManager();if(i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll()),e.bounds!==r.bounds){let s=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(let c in a)s&&s[c]!==a[c]&&n.invalidate(c);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==r._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){let{image:r}=this.props,i=e.info;if(!i.color||!r)return i.bitmap=null,i;let{width:n,height:s}=r;i.index=0;let a=Yoe(i.color);return i.bitmap={size:{width:n,height:s},uv:a,pixel:[Math.floor(a[0]*n),Math.floor(a[1]*s)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){let{bounds:e}=this.props,r=e;return UN(e)&&(r=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),c4(r,this.context.viewport.resolution)}_getModel(){return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){let{shaderModuleProps:r}=e,{model:i,coordinateConversion:n,bounds:s,disablePicking:a}=this.state,{image:c,desaturate:h,transparentColor:p,tintColor:x}=this.props;if(!(r.picking.isActive&&a)&&c&&i){let T={bitmapTexture:c,bounds:s,coordinateConversion:n,desaturate:h,tintColor:x.slice(0,3).map(R=>R/255),transparentColor:p.map(R=>R/255)};i.shaderInputs.setProps({bitmap:T}),i.draw(this.context.renderPass)}}_getCoordinateUniforms(){let{LNGLAT:e,CARTESIAN:r,DEFAULT:i}=Tr,{_imageCoordinateSystem:n}=this.props;if(n!==i){let{bounds:s}=this.props;if(!UN(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");let a=this.context.viewport.resolution?e:r;if(n=n===e?e:r,n===e&&a===r)return{coordinateConversion:-1,bounds:s};if(n===r&&a===e){let c=io([s[0],s[1]]),h=io([s[2],s[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],h[0],h[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}};My.layerName="BitmapLayer";My.defaultProps=Xoe;var Nw=My;function Yoe(t){let[e,r,i]=t,n=(i&240)/256,s=(i&15)/16;return[(e+s)/256,(r+n)/256]}function UN(t){return Number.isFinite(t[0])}var VN=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,jN={name:"icon",vs:VN,fs:VN,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}};var GN=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`;var HN=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Koe=1024,Qoe=4,WN=()=>{},$N={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Joe={x:0,y:0,width:0,height:0};function eae(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function tae(t,e,r,i){let n=Math.min(r/e.width,i/e.height),s=Math.floor(e.width*n),a=Math.floor(e.height*n);return n===1?{image:e,width:s,height:a}:(t.canvas.height=a,t.canvas.width=s,t.clearRect(0,0,s,a),t.drawImage(e,0,0,e.width,e.height,0,0,s,a),{image:t.canvas,width:s,height:a})}function Py(t){return t&&(t.id||t.url)}function rae(t,e,r,i){let{width:n,height:s,device:a}=t,c=a.createTexture({format:"rgba8unorm",width:e,height:r,sampler:i,mipmaps:!0}),h=a.createCommandEncoder();return h.copyTextureToTexture({sourceTexture:t,destinationTexture:c,width:n,height:s}),h.finish(),t.destroy(),c}function qN(t,e,r){for(let i=0;i<e.length;i++){let{icon:n,xOffset:s}=e[i],a=Py(n);t[a]={...n,x:s,y:r}}}function iae({icons:t,buffer:e,mapping:r={},xOffset:i=0,yOffset:n=0,rowHeight:s=0,canvasWidth:a}){let c=[];for(let h=0;h<t.length;h++){let p=t[h],x=Py(p);if(!r[x]){let{height:T,width:R}=p;i+R+e>a&&(qN(r,c,n),i=0,n=s+n+e,s=0,c=[]),c.push({icon:p,xOffset:i}),i=i+R+e,s=Math.max(s,T)}}return c.length>0&&qN(r,c,n),{mapping:r,rowHeight:s,xOffset:i,yOffset:n,canvasWidth:a,canvasHeight:eae(s+n+e)}}function nae(t,e,r){if(!t||!e)return null;r=r||{};let i={},{iterable:n,objectInfo:s}=Ps(t);for(let a of n){s.index++;let c=e(a,s),h=Py(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!i[h]&&(!r[h]||c.url!==r[h].url)&&(i[h]={...c,source:a,sourceIndex:s.index})}return i}var Ry=class{constructor(e,{onUpdate:r=WN,onError:i=WN}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Qoe,this._canvasWidth=Koe,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=r,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){let r=this._autoPacking?Py(e):e;return this._mapping[r]||Joe}setProps({loadOptions:e,autoPacking:r,iconAtlas:i,iconMapping:n,textureParameters:s}){e&&(this._loadOptions=e),r!==void 0&&(this._autoPacking=r),n&&(this._mapping=n),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,r){if(!this._autoPacking||typeof document>"u")return;let i=Object.values(nae(e,r,this._mapping)||{});if(i.length>0){let{mapping:n,xOffset:s,yOffset:a,rowHeight:c,canvasHeight:h}=iae({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=n,this._xOffset=s,this._yOffset=a,this._canvasHeight=h,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||$N,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=rae(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||$N)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){let r=this._canvas.getContext("2d",{willReadFrequently:!0});for(let i of e)this._pendingCount++,yo(i.url,this._loadOptions).then(n=>{let s=Py(i),a=this._mapping[s],{x:c,y:h,width:p,height:x}=a,{image:T,width:R,height:k}=tae(r,n,p,x);this._texture?.copyExternalImage({image:T,x:c+(p-R)/2,y:h+(x-k)/2,width:R,height:k}),a.width=R,a.height=k,this._texture.generateMipmap(),this.onUpdate()}).catch(n=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:n})}).finally(()=>{this._pendingCount--})}};var ZN=[0,0,0,255],sae={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:ZN},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},By=class extends ln{getShaders(){return super.getShaders({vs:GN,fs:HN,modules:[Li,Sn,jN]})}initializeState(){this.state={iconManager:new Ry(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:ZN},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e,s=this.getAttributeManager(),{iconAtlas:a,iconMapping:c,data:h,getIcon:p,textureParameters:x}=r,{iconManager:T}=this.state;if(typeof a=="string")return;let R=a||this.internalState.isAsyncPropLoading("iconAtlas");T.setProps({loadOptions:r.loadOptions,autoPacking:!R,iconAtlas:a,iconMapping:R?c:null,textureParameters:x}),R?i.iconMapping!==r.iconMapping&&s.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&T.packIcons(h,p),n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){let{sizeScale:r,sizeMinPixels:i,sizeMaxPixels:n,sizeUnits:s,billboard:a,alphaCutoff:c}=this.props,{iconManager:h}=this.state,p=h.getTexture();if(p){let x=this.state.model,T={iconsTexture:p,iconsTextureDim:[p.width,p.height],sizeUnits:Dn[s],sizeScale:r,sizeMinPixels:i,sizeMaxPixels:n,billboard:a,alphaCutoff:c};x.shaderInputs.setProps({icon:T}),x.draw(this.context.renderPass)}}_getModel(){let e=[-1,-1,1,-1,-1,1,1,1];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){let r=this.getCurrentLayer()?.props.onIconError;r?r(e):ur.error(e.error.message)()}getInstanceOffset(e){let{width:r,height:i,anchorX:n=r/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[r/2-n,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){let{x:r,y:i,width:n,height:s}=this.state.iconManager.getIconMapping(e);return[r,i,n,s]}};By.defaultProps=sae;By.layerName="IconLayer";var I0=By;var XN=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,YN={name:"line",vs:XN,fs:XN,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}};var KN=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var QN=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var oae=[0,0,0,255],aae={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:oae},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Ly=class extends ln{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:KN,fs:QN,modules:[Li,Sn,YN]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:r,widthScale:i,widthMinPixels:n,widthMaxPixels:s,wrapLongitude:a}=this.props,c=this.state.model,h={widthUnits:Dn[r],widthScale:i,widthMinPixels:n,widthMaxPixels:s,useShortestPath:a?1:0};c.shaderInputs.setProps({line:h}),c.draw(this.context.renderPass),a&&(c.shaderInputs.setProps({line:{...h,useShortestPath:-1}}),c.draw(this.context.renderPass))}_getModel(){let e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};Ly.layerName="LineLayer";Ly.defaultProps=aae;var JN=Ly;var e7=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,t7={name:"pointCloud",vs:e7,fs:e7,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}};var r7=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var i7=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var n7=[0,0,0,255],s7=[0,0,1],lae={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:s7},getColor:{type:"accessor",value:n7},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function cae(t){let{header:e,attributes:r}=t;if(!(!e||!r)&&(t.length=e.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){let{size:i,value:n}=r.COLOR_0;r.instanceColors={size:i,type:"unorm8",value:n}}}var Oy=class extends ln{getShaders(){return super.getShaders({vs:r7,fs:i7,modules:[Li,Ad,Sn,t7]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:s7},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:n7}})}updateState(e){let{changeFlags:r,props:i}=e;super.updateState(e),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&cae(i.data)}draw({uniforms:e}){let{pointSize:r,sizeUnits:i}=this.props,n=this.state.model,s={sizeUnits:Dn[i],radiusPixels:r};n.shaderInputs.setProps({pointCloud:s}),n.draw(this.context.renderPass)}_getModel(){let e=[];for(let r=0;r<3;r++){let i=r/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}};Oy.layerName="PointCloudLayer";Oy.defaultProps=lae;var zw=Oy;var o7=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  bool filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,a7={name:"scatterplot",vs:o7,fs:o7,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}};var l7=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var c7=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled == false) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var u7=[0,0,0,255],uae={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:u7},getLineColor:{type:"accessor",value:u7},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Dy=class extends ln{getShaders(){return super.getShaders({vs:l7,fs:c7,modules:[Li,Sn,a7]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{radiusUnits:r,radiusScale:i,radiusMinPixels:n,radiusMaxPixels:s,stroked:a,filled:c,billboard:h,antialiasing:p,lineWidthUnits:x,lineWidthScale:T,lineWidthMinPixels:R,lineWidthMaxPixels:k}=this.props,j={stroked:a,filled:c,billboard:h,antialiasing:p,radiusUnits:Dn[r],radiusScale:i,radiusMinPixels:n,radiusMaxPixels:s,lineWidthUnits:Dn[x],lineWidthScale:T,lineWidthMinPixels:R,lineWidthMaxPixels:k},q=this.state.model;q.shaderInputs.setProps({scatterplot:j}),q.draw(this.context.renderPass)}_getModel(){let e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};Dy.defaultProps=uae;Dy.layerName="ScatterplotLayer";var Uw=Dy;var M0={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function pA(t,e,r={}){return h7(t,r)!==e?(hae(t,r),!0):!1}function h7(t,e={}){return Math.sign(Sd(t,e))}var Fy={x:0,y:1,z:2};function Sd(t,e={}){let{start:r=0,end:i=t.length,plane:n="xy"}=e,s=e.size||2,a=0,c=Fy[n[0]],h=Fy[n[1]];for(let p=r,x=i-s;p<i;p+=s)a+=(t[p+c]-t[x+c])*(t[p+h]+t[x+h]),x=p;return a/2}function hae(t,e){let{start:r=0,end:i=t.length,size:n=2}=e,s=(i-r)/n,a=Math.floor(s/2);for(let c=0;c<a;++c){let h=r+c*n,p=r+(s-1-c)*n;for(let x=0;x<n;++x){let T=t[h+x];t[h+x]=t[p+x],t[p+x]=T}}}function h4(t,e,r=2,i,n="xy"){let s=e&&e.length,a=s?e[0]*r:t.length,c=d7(t,0,a,r,!0,i&&i[0],n),h=[];if(!c||c.next===c.prev)return h;let p,x,T,R,k,j,q;if(s&&(c=gae(t,e,c,r,i,n)),t.length>80*r){R=x=t[0],k=T=t[1];for(let X=r;X<a;X+=r)j=t[X],q=t[X+1],j<R&&(R=j),q<k&&(k=q),j>x&&(x=j),q>T&&(T=q);p=Math.max(x-R,T-k),p=p!==0?32767/p:0}return ky(c,h,r,R,k,p,0),h}function d7(t,e,r,i,n,s,a){let c,h;s===void 0&&(s=Sd(t,{start:e,end:r,size:i,plane:a}));let p=Fy[a[0]],x=Fy[a[1]];if(n===s<0)for(c=e;c<r;c+=i)h=f7(c,t[c+p],t[c+x],h);else for(c=r-i;c>=e;c-=i)h=f7(c,t[c+p],t[c+x],h);return h&&Gw(h,h.next)&&(zy(h),h=h.next),h}function AA(t,e){if(!t)return t;e||(e=t);let r=t,i;do if(i=!1,!r.steiner&&(Gw(r,r.next)||os(r.prev,r,r.next)===0)){if(zy(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function ky(t,e,r,i,n,s,a){if(!t)return;!a&&s&&vae(t,i,n,s);let c=t,h,p;for(;t.prev!==t.next;){if(h=t.prev,p=t.next,s?pae(t,i,n,s):dae(t)){e.push(h.i/r|0),e.push(t.i/r|0),e.push(p.i/r|0),zy(t),t=p.next,c=p.next;continue}if(t=p,t===c){a?a===1?(t=Aae(AA(t),e,r),ky(t,e,r,i,n,s,2)):a===2&&mae(t,e,r,i,n,s):ky(AA(t),e,r,i,n,s,1);break}}}function dae(t){let e=t.prev,r=t,i=t.next;if(os(e,r,i)>=0)return!1;let n=e.x,s=r.x,a=i.x,c=e.y,h=r.y,p=i.y,x=n<s?n<a?n:a:s<a?s:a,T=c<h?c<p?c:p:h<p?h:p,R=n>s?n>a?n:a:s>a?s:a,k=c>h?c>p?c:p:h>p?h:p,j=i.next;for(;j!==e;){if(j.x>=x&&j.x<=R&&j.y>=T&&j.y<=k&&P0(n,c,s,h,a,p,j.x,j.y)&&os(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function pae(t,e,r,i){let n=t.prev,s=t,a=t.next;if(os(n,s,a)>=0)return!1;let c=n.x,h=s.x,p=a.x,x=n.y,T=s.y,R=a.y,k=c<h?c<p?c:p:h<p?h:p,j=x<T?x<R?x:R:T<R?T:R,q=c>h?c>p?c:p:h>p?h:p,X=x>T?x>R?x:R:T>R?T:R,re=u4(k,j,e,r,i),te=u4(q,X,e,r,i),oe=t.prevZ,ae=t.nextZ;for(;oe&&oe.z>=re&&ae&&ae.z<=te;){if(oe.x>=k&&oe.x<=q&&oe.y>=j&&oe.y<=X&&oe!==n&&oe!==a&&P0(c,x,h,T,p,R,oe.x,oe.y)&&os(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ae.x>=k&&ae.x<=q&&ae.y>=j&&ae.y<=X&&ae!==n&&ae!==a&&P0(c,x,h,T,p,R,ae.x,ae.y)&&os(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;oe&&oe.z>=re;){if(oe.x>=k&&oe.x<=q&&oe.y>=j&&oe.y<=X&&oe!==n&&oe!==a&&P0(c,x,h,T,p,R,oe.x,oe.y)&&os(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ae&&ae.z<=te;){if(ae.x>=k&&ae.x<=q&&ae.y>=j&&ae.y<=X&&ae!==n&&ae!==a&&P0(c,x,h,T,p,R,ae.x,ae.y)&&os(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function Aae(t,e,r){let i=t;do{let n=i.prev,s=i.next.next;!Gw(n,s)&&p7(n,i,i.next,s)&&Ny(n,s)&&Ny(s,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(s.i/r|0),zy(i),zy(i.next),i=t=s),i=i.next}while(i!==t);return AA(i)}function mae(t,e,r,i,n,s){let a=t;do{let c=a.next.next;for(;c!==a.prev;){if(a.i!==c.i&&Eae(a,c)){let h=A7(a,c);a=AA(a,a.next),h=AA(h,h.next),ky(a,e,r,i,n,s,0),ky(h,e,r,i,n,s,0);return}c=c.next}a=a.next}while(a!==t)}function gae(t,e,r,i,n,s){let a=[],c,h,p,x,T;for(c=0,h=e.length;c<h;c++)p=e[c]*i,x=c<h-1?e[c+1]*i:t.length,T=d7(t,p,x,i,!1,n&&n[c+1],s),T===T.next&&(T.steiner=!0),a.push(Tae(T));for(a.sort(_ae),c=0;c<a.length;c++)r=yae(a[c],r);return r}function _ae(t,e){return t.x-e.x}function yae(t,e){let r=xae(t,e);if(!r)return e;let i=A7(r,t);return AA(i,i.next),AA(r,r.next)}function xae(t,e){let r=e,i=t.x,n=t.y,s=-1/0,a;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){let R=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(R<=i&&R>s&&(s=R,a=r.x<r.next.x?r:r.next,R===i))return a}r=r.next}while(r!==e);if(!a)return null;let c=a,h=a.x,p=a.y,x=1/0,T;r=a;do i>=r.x&&r.x>=h&&i!==r.x&&P0(n<p?i:s,n,h,p,n<p?s:i,n,r.x,r.y)&&(T=Math.abs(n-r.y)/(i-r.x),Ny(r,t)&&(T<x||T===x&&(r.x>a.x||r.x===a.x&&bae(a,r)))&&(a=r,x=T)),r=r.next;while(r!==c);return a}function bae(t,e){return os(t.prev,t,e.prev)<0&&os(e.next,t,t.next)<0}function vae(t,e,r,i){let n=t;do n.z===0&&(n.z=u4(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,wae(n)}function wae(t){let e,r,i=1,n,s,a,c,h,p;do{for(s=t,t=null,p=null,n=0;s;){for(n++,c=s,a=0,r=0;r<i&&(a++,c=c.nextZ,!!c);r++);for(h=i;a>0||h>0&&c;)a!==0&&(h===0||!c||s.z<=c.z)?(e=s,s=s.nextZ,a--):(e=c,c=c.nextZ,h--),p?p.nextZ=e:t=e,e.prevZ=p,p=e;s=c}p.nextZ=null,i*=2}while(n>1);return t}function u4(t,e,r,i,n){return t=(t-r)*n|0,e=(e-i)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Tae(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function P0(t,e,r,i,n,s,a,c){return(n-a)*(e-c)>=(t-a)*(s-c)&&(t-a)*(i-c)>=(r-a)*(e-c)&&(r-a)*(s-c)>=(n-a)*(i-c)}function Eae(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Cae(t,e)&&(Ny(t,e)&&Ny(e,t)&&Sae(t,e)&&(os(t.prev,t,e.prev)||os(t,e.prev,e))||Gw(t,e)&&os(t.prev,t,t.next)>0&&os(e.prev,e,e.next)>0)}function os(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Gw(t,e){return t.x===e.x&&t.y===e.y}function p7(t,e,r,i){let n=jw(os(t,e,r)),s=jw(os(t,e,i)),a=jw(os(r,i,t)),c=jw(os(r,i,e));return!!(n!==s&&a!==c||n===0&&Vw(t,r,e)||s===0&&Vw(t,i,e)||a===0&&Vw(r,t,i)||c===0&&Vw(r,e,i))}function Vw(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function jw(t){return t>0?1:t<0?-1:0}function Cae(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&p7(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Ny(t,e){return os(t.prev,t,t.next)<0?os(t,e,t.next)>=0&&os(t,t.prev,e)>=0:os(t,e,t.prev)<0||os(t,t.next,e)<0}function Sae(t,e){let r=t,i=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function A7(t,e){let r=new Uy(t.i,t.x,t.y),i=new Uy(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function f7(t,e,r,i){let n=new Uy(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function zy(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}var Uy=class{constructor(e,r,i){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=e,this.x=r,this.y=i}};function Ba(t,e){let r=e.length,i=t.length;if(i>0){let n=!0;for(let s=0;s<r;s++)if(t[i-r+s]!==e[s]){n=!1;break}if(n)return!1}for(let n=0;n<r;n++)t[i+n]=e[n];return!0}function Vy(t,e){let r=e.length;for(let i=0;i<r;i++)t[i]=e[i]}function Id(t,e,r,i,n=[]){let s=i+e*r;for(let a=0;a<r;a++)n[a]=t[s+a];return n}function Hw(t,e,r,i,n=[]){let s,a;if(r&8)s=(i[3]-t[1])/(e[1]-t[1]),a=3;else if(r&4)s=(i[1]-t[1])/(e[1]-t[1]),a=1;else if(r&2)s=(i[2]-t[0])/(e[0]-t[0]),a=2;else if(r&1)s=(i[0]-t[0])/(e[0]-t[0]),a=0;else return null;for(let c=0;c<t.length;c++)n[c]=(a&1)===c?i[a]:s*(e[c]-t[c])+t[c];return n}function jy(t,e){let r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function Gy(t,e){let{size:r=2,broken:i=!1,gridResolution:n=10,gridOffset:s=[0,0],startIndex:a=0,endIndex:c=t.length}=e||{},h=(c-a)/r,p=[],x=[p],T=Id(t,0,r,a),R,k,j=_7(T,n,s,[]),q=[];Ba(p,T);for(let X=1;X<h;X++){for(R=Id(t,X,r,a,R),k=jy(R,j);k;){Hw(T,R,k,j,q);let re=jy(q,j);re&&(Hw(T,q,re,j,q),k=re),Ba(p,q),Vy(T,q),Mae(j,n,k),i&&p.length>r&&(p=[],x.push(p),Ba(p,T)),k=jy(R,j)}Ba(p,R),Vy(T,R)}return i?x:x[0]}var m7=0,Iae=1;function Hy(t,e=null,r){if(!t.length)return[];let{size:i=2,gridResolution:n=10,gridOffset:s=[0,0],edgeTypes:a=!1}=r||{},c=[],h=[{pos:t,types:a?new Array(t.length/i).fill(Iae):null,holes:e||[]}],p=[[],[]],x=[];for(;h.length;){let{pos:T,types:R,holes:k}=h.shift();Pae(T,i,k[0]||T.length,p),x=_7(p[0],n,s,x);let j=jy(p[1],x);if(j){let q=g7(T,R,i,0,k[0]||T.length,x,j),X={pos:q[0].pos,types:q[0].types,holes:[]},re={pos:q[1].pos,types:q[1].types,holes:[]};h.push(X,re);for(let te=0;te<k.length;te++)q=g7(T,R,i,k[te],k[te+1]||T.length,x,j),q[0]&&(X.holes.push(X.pos.length),X.pos=Ww(X.pos,q[0].pos),a&&(X.types=Ww(X.types,q[0].types))),q[1]&&(re.holes.push(re.pos.length),re.pos=Ww(re.pos,q[1].pos),a&&(re.types=Ww(re.types,q[1].types)))}else{let q={positions:T};a&&(q.edgeTypes=R),k.length&&(q.holeIndices=k),c.push(q)}}return c}function g7(t,e,r,i,n,s,a){let c=(n-i)/r,h=[],p=[],x=[],T=[],R=[],k,j,q,X=Id(t,c-1,r,i),re=Math.sign(a&8?X[1]-s[3]:X[0]-s[2]),te=e&&e[c-1],oe=0,ae=0;for(let pe=0;pe<c;pe++)k=Id(t,pe,r,i,k),j=Math.sign(a&8?k[1]-s[3]:k[0]-s[2]),q=e&&e[i/r+pe],j&&re&&re!==j&&(Hw(X,k,a,s,R),Ba(h,R)&&x.push(te),Ba(p,R)&&T.push(te)),j<=0?(Ba(h,k)&&x.push(q),oe-=j):x.length&&(x[x.length-1]=m7),j>=0?(Ba(p,k)&&T.push(q),ae+=j):T.length&&(T[T.length-1]=m7),Vy(X,k),re=j,te=q;return[oe?{pos:h,types:e&&x}:null,ae?{pos:p,types:e&&T}:null]}function _7(t,e,r,i){let n=Math.floor((t[0]-r[0])/e)*e+r[0],s=Math.floor((t[1]-r[1])/e)*e+r[1];return i[0]=n,i[1]=s,i[2]=n+e,i[3]=s+e,i}function Mae(t,e,r){r&8?(t[1]+=e,t[3]+=e):r&4?(t[1]-=e,t[3]-=e):r&2?(t[0]+=e,t[2]+=e):r&1&&(t[0]-=e,t[2]-=e)}function Pae(t,e,r,i){let n=1/0,s=-1/0,a=1/0,c=-1/0;for(let h=0;h<r;h+=e){let p=t[h],x=t[h+1];n=p<n?p:n,s=p>s?p:s,a=x<a?x:a,c=x>c?x:c}return i[0][0]=n,i[0][1]=a,i[1][0]=s,i[1][1]=c,i}function Ww(t,e){for(let r=0;r<e.length;r++)t.push(e[r]);return t}var Rae=85.051129;function f4(t,e){let{size:r=2,startIndex:i=0,endIndex:n=t.length,normalize:s=!0}=e||{},a=t.slice(i,n);y7(a,r,0,n-i);let c=Gy(a,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(let h of c)x7(h,r);return c}function d4(t,e=null,r){let{size:i=2,normalize:n=!0,edgeTypes:s=!1}=r||{};e=e||[];let a=[],c=[],h=0,p=0;for(let T=0;T<=e.length;T++){let R=e[T]||t.length,k=p,j=Bae(t,i,h,R);for(let q=j;q<R;q++)a[p++]=t[q];for(let q=h;q<j;q++)a[p++]=t[q];y7(a,i,k,p),Lae(a,i,k,p,r?.maxLatitude),h=R,c[T]=p}c.pop();let x=Hy(a,c,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(n)for(let T of x)x7(T.positions,i);return x}function Bae(t,e,r,i){let n=-1,s=-1;for(let a=r+1;a<i;a+=e){let c=Math.abs(t[a]);c>n&&(n=c,s=a-1)}return s}function Lae(t,e,r,i,n=Rae){let s=t[r],a=t[i-e];if(Math.abs(s-a)>180){let c=Id(t,0,e,r);c[0]+=Math.round((a-s)/360)*360,Ba(t,c),c[1]=Math.sign(c[1])*n,Ba(t,c),c[0]=s,Ba(t,c)}}function y7(t,e,r,i){let n=t[0],s;for(let a=r;a<i;a+=e){s=t[a];let c=s-n;(c>180||c<-180)&&(s-=Math.round(c/360)*360),t[a]=n=s}}function x7(t,e){let r,i=t.length/e;for(let s=0;s<i&&(r=t[s*e],(r+180)%360===0);s++);let n=-Math.round(r/360)*360;if(n!==0)for(let s=0;s<i;s++)t[s*e]+=n}var Wy=class extends Qi{constructor(e){let{indices:r,attributes:i}=Dae(e);super({...e,indices:r,attributes:i})}};function Dae(t){let{radius:e,height:r=1,nradial:i=10}=t,{vertices:n}=t;n&&(ur.assert(n.length>=i),n=n.flatMap(k=>[k[0],k[1]]),pA(n,M0.COUNTER_CLOCKWISE));let s=r>0,a=i+1,c=s?a*3+1:i,h=Math.PI*2/i,p=new Uint16Array(s?i*3*2:0),x=new Float32Array(c*3),T=new Float32Array(c*3),R=0;if(s){for(let k=0;k<a;k++){let j=k*h,q=k%i,X=Math.sin(j),re=Math.cos(j);for(let te=0;te<2;te++)x[R+0]=n?n[q*2]:re*e,x[R+1]=n?n[q*2+1]:X*e,x[R+2]=(1/2-te)*r,T[R+0]=n?n[q*2]:re,T[R+1]=n?n[q*2+1]:X,R+=3}x[R+0]=x[R-3],x[R+1]=x[R-2],x[R+2]=x[R-1],R+=3}for(let k=s?0:1;k<a;k++){let j=Math.floor(k/2)*Math.sign(.5-k%2),q=j*h,X=(j+i)%i,re=Math.sin(q),te=Math.cos(q);x[R+0]=n?n[X*2]:te*e,x[R+1]=n?n[X*2+1]:re*e,x[R+2]=r/2,T[R+2]=1,R+=3}if(s){let k=0;for(let j=0;j<i;j++)p[k++]=j*2+0,p[k++]=j*2+2,p[k++]=j*2+0,p[k++]=j*2+1,p[k++]=j*2+1,p[k++]=j*2+3}return{indices:p,attributes:{POSITION:{size:3,value:x},NORMAL:{size:3,value:T}}}}var b7=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,v7={name:"column",vs:b7,fs:b7,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}};var w7=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var T7=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var $w=[0,0,0,255],Fae={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:$w},getLineColor:{type:"accessor",value:$w},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},$y=class extends ln{getShaders(){let e={},{flatShading:r}=this.props;return r&&(e.FLAT_SHADING=1),super.getShaders({vs:w7,fs:T7,defines:e,modules:[Li,r?i0:Ad,Sn,v7]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:$w},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:$w},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e,s=n.extensionsChanged||r.flatShading!==i.flatShading;s&&(this.state.models?.forEach(c=>c.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());let a=this.getNumInstances();this.state.fillModel.setInstanceCount(a),this.state.wireframeModel.setInstanceCount(a),(s||r.diskResolution!==i.diskResolution||r.vertices!==i.vertices||(r.extruded||r.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(r)}getGeometry(e,r,i){let n=new Wy({radius:1,height:i?2:0,vertices:r,nradial:e}),s=0;if(r)for(let a=0;a<e;a++){let c=r[a],h=Math.sqrt(c[0]*c[0]+c[1]*c[1]);s+=h/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),n}_getModels(){let e=this.getShaders(),r=this.getAttributeManager().getBufferLayouts(),i=new di(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:r,isInstanced:!0}),n=new di(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:r,isInstanced:!0});return{fillModel:i,wireframeModel:n,models:[n,i]}}_updateGeometry({diskResolution:e,vertices:r,extruded:i,stroked:n}){let s=this.getGeometry(e,r,i||n);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3});let a=this.state.fillModel,c=this.state.wireframeModel;a.setGeometry(s),a.setTopology("triangle-strip"),a.setIndexBuffer(null),c.setGeometry(s),c.setTopology("line-list")}draw({uniforms:e}){let{lineWidthUnits:r,lineWidthScale:i,lineWidthMinPixels:n,lineWidthMaxPixels:s,radiusUnits:a,elevationScale:c,extruded:h,filled:p,stroked:x,wireframe:T,offset:R,coverage:k,radius:j,angle:q}=this.props,X=this.state.fillModel,re=this.state.wireframeModel,{fillVertexCount:te,edgeDistance:oe}=this.state,ae={radius:j,angle:q/180*Math.PI,offset:R,extruded:h,stroked:x,coverage:k,elevationScale:c,edgeDistance:oe,radiusUnits:Dn[a],widthUnits:Dn[r],widthScale:i,widthMinPixels:n,widthMaxPixels:s};h&&T&&(re.shaderInputs.setProps({column:{...ae,isStroke:!0}}),re.draw(this.context.renderPass)),p&&(X.setVertexCount(te),X.shaderInputs.setProps({column:{...ae,isStroke:!1}}),X.draw(this.context.renderPass)),!h&&x&&(X.setVertexCount(te*2/3),X.shaderInputs.setProps({column:{...ae,isStroke:!0}}),X.draw(this.context.renderPass))}};$y.layerName="ColumnLayer";$y.defaultProps=Fae;var Wu=$y;var kae={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},qy=class extends Wu{_updateGeometry(){let e=new sA;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){let{elevationScale:r,extruded:i,offset:n,coverage:s,cellSize:a,angle:c,radiusUnits:h}=this.props,p=this.state.fillModel,x={radius:a/2,radiusUnits:Dn[h],angle:c,offset:n,extruded:i,stroked:!1,coverage:s,elevationScale:r,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};p.shaderInputs.setProps({column:x}),p.draw(this.context.renderPass)}};qy.layerName="GridCellLayer";qy.defaultProps=kae;var E7=qy;function C7(t,e,r,i){let n;if(Array.isArray(t[0])){let s=t.length*e;n=new Array(s);for(let a=0;a<t.length;a++)for(let c=0;c<e;c++)n[a*e+c]=t[a][c]||0}else n=t;return r?Gy(n,{size:e,gridResolution:r}):i?f4(n,{size:e}):n}var Nae=1,zae=2,p4=4,Zy=class extends Cd{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?C7(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(S7(e)){let i=0;for(let n of e)i+=this.getGeometrySize(n);return i}let r=this.getPathLength(e);return r<2?0:this.isClosed(e)?r<3?0:r+2:r}updateGeometryAttributes(e,r){if(r.geometrySize!==0)if(e&&S7(e))for(let i of e){let n=this.getGeometrySize(i);r.geometrySize=n,this.updateGeometryAttributes(i,r),r.vertexStart+=n}else this._updateSegmentTypes(e,r),this._updatePositions(e,r)}_updateSegmentTypes(e,r){let i=this.attributes.segmentTypes,n=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:a}=r;i.fill(0,s,s+a),n?(i[s]=p4,i[s+a-2]=p4):(i[s]+=Nae,i[s+a-2]+=zae),i[s+a-1]=p4}_updatePositions(e,r){let{positions:i}=this.attributes;if(!i||!e)return;let{vertexStart:n,geometrySize:s}=r,a=new Array(3);for(let c=n,h=0;h<s;c++,h++)this.getPointOnPath(e,h,a),i[c*3]=a[0],i[c*3+1]=a[1],i[c*3+2]=a[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,r,i=[]){let{positionSize:n}=this;r*n>=e.length&&(r+=1-e.length/n);let s=r*n;return i[0]=e[s],i[1]=e[s+1],i[2]=n===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;let{positionSize:r}=this,i=e.length-r;return e[0]===e[i]&&e[1]===e[i+1]&&(r===2||e[2]===e[i+2])}};function S7(t){return Array.isArray(t[0])}var I7=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,M7={name:"path",vs:I7,fs:I7,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}};var P7=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var R7=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var B7=[0,0,0,255],Uae={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:B7},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},A4={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},Xy=class extends ln{getShaders(){return super.getShaders({vs:P7,fs:R7,modules:[Li,Sn,M7]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:A4,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:A4,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:A4,defaultValue:B7},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:n,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:n,s)}}),this.setState({pathTesselator:new Zy({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);let{props:r,changeFlags:i}=e,n=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){let{pathTesselator:a}=this.state,c=r.data.attributes||{};a.updateGeometry({data:r.data,geometryBuffer:c.getPath,buffers:c,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||n.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(e){let r=super.getPickingInfo(e),{index:i}=r,n=this.props.data;return n[0]&&n[0].__source&&(r.object=n.find(s=>s.__source.index===i)),r}disablePickingIndex(e){let r=this.props.data;if(r[0]&&r[0].__source)for(let i=0;i<r.length;i++)r[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{jointRounded:r,capRounded:i,billboard:n,miterLimit:s,widthUnits:a,widthScale:c,widthMinPixels:h,widthMaxPixels:p}=this.props,x=this.state.model,T={jointType:Number(r),capType:Number(i),billboard:n,widthUnits:Dn[a],widthScale:c,miterLimit:s,widthMinPixels:h,widthMaxPixels:p};x.shaderInputs.setProps({path:T}),x.draw(this.context.renderPass)}_getModel(){let e=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){let{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateSegmentTypes(e){let{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("segmentTypes")}};Xy.defaultProps=Uae;Xy.layerName="PathLayer";var $u=Xy;var j7=_l(k7(),1);var Kw=M0.CLOCKWISE,N7=M0.COUNTER_CLOCKWISE,Md={isClosed:!0};function rle(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function B0(t){return"positions"in t?t.positions:t}function Jy(t){return"holeIndices"in t?t.holeIndices:null}function ile(t){return Array.isArray(t[0])}function nle(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function sle(t){let e=t[0],r=t[t.length-1];return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function ole(t,e,r,i){for(let n=0;n<e;n++)if(t[r+n]!==t[i-e+n])return!1;return!0}function z7(t,e,r,i,n){let s=e,a=r.length;for(let c=0;c<a;c++)for(let h=0;h<i;h++)t[s++]=r[c][h]||0;if(!sle(r))for(let c=0;c<i;c++)t[s++]=r[0][c]||0;return Md.start=e,Md.end=s,Md.size=i,pA(t,n,Md),s}function U7(t,e,r,i,n=0,s,a){s=s||r.length;let c=s-n;if(c<=0)return e;let h=e;for(let p=0;p<c;p++)t[h++]=r[n+p];if(!ole(r,i,n,s))for(let p=0;p<i;p++)t[h++]=r[n+p];return Md.start=e,Md.end=h,Md.size=i,pA(t,a,Md),h}function Qw(t,e){rle(t);let r=[],i=[];if("positions"in t){let{positions:n,holeIndices:s}=t;if(s){let a=0;for(let c=0;c<=s.length;c++)a=U7(r,a,n,e,s[c-1],s[c],c===0?Kw:N7),i.push(a);return i.pop(),{positions:r,holeIndices:i}}t=n}if(!ile(t))return U7(r,0,t,e,0,r.length,Kw),r;if(!nle(t)){let n=0;for(let[s,a]of t.entries())n=z7(r,n,a,e,s===0?Kw:N7),i.push(n);return i.pop(),{positions:r,holeIndices:i}}return z7(r,0,t,e,Kw),r}function x4(t,e,r){let i=t.length/3,n=0;for(let s=0;s<i;s++){let a=(s+1)%i;n+=t[s*3+e]*t[a*3+r],n-=t[a*3+e]*t[s*3+r]}return Math.abs(n/2)}function V7(t,e,r,i){let n=t.length/3;for(let s=0;s<n;s++){let a=s*3,c=t[a+0],h=t[a+1],p=t[a+2];t[a+e]=c,t[a+r]=h,t[a+i]=p}}function G7(t,e,r,i){let n=Jy(t);n&&(n=n.map(c=>c/e));let s=B0(t),a=i&&e===3;if(r){let c=s.length;s=s.slice();let h=[];for(let p=0;p<c;p+=e){h[0]=s[p],h[1]=s[p+1],a&&(h[2]=s[p+2]);let x=r(h);s[p]=x[0],s[p+1]=x[1],a&&(s[p+2]=x[2])}}if(a){let c=x4(s,0,1),h=x4(s,0,2),p=x4(s,1,2);if(!c&&!h&&!p)return[];c>h&&c>p||(h>p?(r||(s=s.slice()),V7(s,0,2,1)):(r||(s=s.slice()),V7(s,2,0,1)))}return(0,j7.default)(s,n,e)}var ex=class extends Cd{constructor(e){let{fp64:r,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){let{attributes:r}=this;return e==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[e]}updateGeometry(e){super.updateGeometry(e);let r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){let r=Qw(e,this.positionSize);return this.opts.resolution?Hy(B0(r),Jy(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?d4(B0(r),Jy(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return e}getGeometrySize(e){if(W7(e)){let r=0;for(let i of e)r+=this.getGeometrySize(i);return r}return B0(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,r){if(e&&W7(e))for(let i of e){let n=this.getGeometrySize(i);r.geometrySize=n,this.updateGeometryAttributes(i,r),r.vertexStart+=n,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{let i=e;this._updateIndices(i,r),this._updatePositions(i,r),this._updateVertexValid(i,r)}}_updateIndices(e,{geometryIndex:r,vertexStart:i,indexStart:n}){let{attributes:s,indexStarts:a,typedArrayManager:c}=this,h=s.indices;if(!h||!e)return;let p=n,x=G7(e,this.positionSize,this.opts.preproject,this.opts.full3d);h=c.allocate(h,n+x.length,{copy:!0});for(let T=0;T<x.length;T++)h[p++]=x[T]+i;a[r+1]=n+x.length,s.indices=h}_updatePositions(e,{vertexStart:r,geometrySize:i}){let{attributes:{positions:n},positionSize:s}=this;if(!n||!e)return;let a=B0(e);for(let c=r,h=0;h<i;c++,h++){let p=a[h*s],x=a[h*s+1],T=s>2?a[h*s+2]:0;n[c*3]=p,n[c*3+1]=x,n[c*3+2]=T}}_updateVertexValid(e,{vertexStart:r,geometrySize:i}){let{positionSize:n}=this,s=this.attributes.vertexValid,a=e&&Jy(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,r):s.fill(1,r,r+i),a)for(let c=0;c<a.length;c++)s[r+a[c]/n-1]=0;s[r+i-1]=0}};function W7(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}var $7=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,q7={name:"solidPolygon",vs:$7,fs:$7,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}};var Jw=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Z7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${Jw}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`;var X7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${Jw}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`;var Y7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var t3=[0,0,0,255],ale={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:t3},getLineColor:{type:"accessor",value:t3},material:!0},e3={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},tx=class extends ln{getShaders(e){return super.getShaders({vs:e==="top"?Z7:X7,fs:Y7,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Li,Ad,Sn,q7]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){let{viewport:e}=this.context,{coordinateSystem:r}=this.props,{_full3d:i}=this.props;e.isGeospatial&&r===Tr.DEFAULT&&(r=Tr.LNGLAT);let n;r===Tr.LNGLAT&&(i?n=e.projectPosition.bind(e):n=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new ex({preproject:n,fp64:this.use64bitPositions(),IndexType:Uint32Array})});let s=this.getAttributeManager(),a=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:a},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:e3,accessor:"getPolygon",update:this.calculatePositions,noAlloc:a,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:a},elevations:{size:1,stepMode:"dynamic",transition:e3,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:e3,accessor:"getFillColor",defaultValue:t3},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:e3,accessor:"getLineColor",defaultValue:t3},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:h,target:p})=>this.encodePickingColor(c&&c.__source?c.__source.index:h,p)}})}getPickingInfo(e){let r=super.getPickingInfo(e),{index:i}=r,n=this.props.data;return n[0]&&n[0].__source&&(r.object=n.find(s=>s.__source.index===i)),r}disablePickingIndex(e){let r=this.props.data;if(r[0]&&r[0].__source)for(let i=0;i<r.length;i++)r[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{extruded:r,filled:i,wireframe:n,elevationScale:s}=this.props,{topModel:a,sideModel:c,wireframeModel:h,polygonTesselator:p}=this.state,x={extruded:!!r,elevationScale:s,isWireframe:!1};h&&n&&(h.setInstanceCount(p.instanceCount-1),h.shaderInputs.setProps({solidPolygon:{...x,isWireframe:!0}}),h.draw(this.context.renderPass)),c&&i&&(c.setInstanceCount(p.instanceCount-1),c.shaderInputs.setProps({solidPolygon:x}),c.draw(this.context.renderPass)),a&&i&&(a.setVertexCount(p.vertexCount),a.shaderInputs.setProps({solidPolygon:x}),a.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);let{props:r,oldProps:i,changeFlags:n}=e,s=this.getAttributeManager();(n.extensionsChanged||r.filled!==i.filled||r.extruded!==i.extruded)&&(this.state.models?.forEach(c=>c.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:r,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){let{polygonTesselator:s}=this.state,a=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:a.getPolygon,buffers:a,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){let{id:e,filled:r,extruded:i}=this.props,n,s,a;if(r){let c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;let h=this.getAttributeManager().getBufferLayouts({isInstanced:!1});n=new di(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",bufferLayout:h,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){let c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new di(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:c,geometry:new Qi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),a=new di(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:c,geometry:new Qi({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,a,n].filter(Boolean),topModel:n,sideModel:s,wireframeModel:a}}calculateIndices(e){let{polygonTesselator:r}=this.state;e.startIndices=r.indexStarts,e.value=r.get("indices")}calculatePositions(e){let{polygonTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};tx.defaultProps=ale;tx.layerName="SolidPolygonLayer";var Pd=tx;function r3({data:t,getIndex:e,dataRange:r,replace:i}){let{startRow:n=0,endRow:s=1/0}=r,a=t.length,c=a,h=a;for(let R=0;R<a;R++){let k=e(t[R]);if(c>R&&k>=n&&(c=R),k>=s){h=R;break}}let p=c,T=h-c!==i.length?t.slice(h):void 0;for(let R=0;R<i.length;R++)t[p++]=i[R];if(T){for(let R=0;R<T.length;R++)t[p++]=T[R];t.length=p}return{startRow:c,endRow:c+i.length}}var K7=[0,0,0,255],lle=[0,0,0,255],cle={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:lle},getLineColor:{type:"accessor",value:K7},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},rx=class extends ss{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&ur.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){let r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(r&&Array.isArray(e.dataChanged)){let i=this.state.paths.slice(),n=e.dataChanged.map(s=>r3({data:i,getIndex:a=>a.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:i,pathsDiff:n})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){let{data:r,getPolygon:i,positionFormat:n,_normalize:s}=this.props,a=[],c=n==="XY"?2:3,{startRow:h,endRow:p}=e,{iterable:x,objectInfo:T}=Ps(r,h,p);for(let R of x){T.index++;let k=i(R,T);s&&(k=Qw(k,c));let{holeIndices:j}=k,q=k.positions||k;if(j)for(let X=0;X<=j.length;X++){let re=q.slice(j[X-1]||0,j[X]||q.length);a.push(this.getSubLayerRow({path:re},R,T.index))}else a.push(this.getSubLayerRow({path:q},R,T.index))}return a}renderLayers(){let{data:e,_dataDiff:r,stroked:i,filled:n,extruded:s,wireframe:a,_normalize:c,_windingOrder:h,elevationScale:p,transitions:x,positionFormat:T}=this.props,{lineWidthUnits:R,lineWidthScale:k,lineWidthMinPixels:j,lineWidthMaxPixels:q,lineJointRounded:X,lineMiterLimit:re,lineDashJustified:te}=this.props,{getFillColor:oe,getLineColor:ae,getLineWidth:pe,getLineDashArray:be,getElevation:Fe,getPolygon:Y,updateTriggers:J,material:Z}=this.props,{paths:xe,pathsDiff:_e}=this.state,Be=this.getSubLayerClass("fill",Pd),Se=this.getSubLayerClass("stroke",$u),ke=this.shouldRenderSubLayer("fill",xe)&&new Be({_dataDiff:r,extruded:s,elevationScale:p,filled:n,wireframe:a,_normalize:c,_windingOrder:h,getElevation:Fe,getFillColor:oe,getLineColor:s&&a?ae:K7,material:Z,transitions:x},this.getSubLayerProps({id:"fill",updateTriggers:J&&{getPolygon:J.getPolygon,getElevation:J.getElevation,getFillColor:J.getFillColor,lineColors:s&&a,getLineColor:J.getLineColor}}),{data:e,positionFormat:T,getPolygon:Y}),Ye=!s&&i&&this.shouldRenderSubLayer("stroke",xe)&&new Se({_dataDiff:_e&&(()=>_e),widthUnits:R,widthScale:k,widthMinPixels:j,widthMaxPixels:q,jointRounded:X,miterLimit:re,dashJustified:te,_pathType:"loop",transitions:x&&{getWidth:x.getLineWidth,getColor:x.getLineColor,getPath:x.getPolygon},getColor:this.getSubLayerAccessor(ae),getWidth:this.getSubLayerAccessor(pe),getDashArray:this.getSubLayerAccessor(be)},this.getSubLayerProps({id:"stroke",updateTriggers:J&&{getWidth:J.getLineWidth,getColor:J.getLineColor,getDashArray:J.getLineDashArray}}),{data:xe,positionFormat:T,getPath:rt=>rt.path});return[!s&&ke,Ye,s&&ke]}};rx.layerName="PolygonLayer";rx.defaultProps=cle;var Rd=rx;function Q7(t,e){if(!t)return null;let r="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[r];return r!==-1?ule(t,i,r):null}function ule(t,e,r){let i={properties:{...t.properties[e]}};for(let n in t.numericProps)i.properties[n]=t.numericProps[n].value[r];return i}function J7(t,e){let r={points:null,lines:null,polygons:null};for(let i in r){let n=t[i].globalFeatureIds.value;r[i]=new Uint8ClampedArray(n.length*4);let s=[];for(let a=0;a<n.length;a++)e(n[a],s),r[i][a*4+0]=s[0],r[i][a*4+1]=s[1],r[i][a*4+2]=s[2],r[i][a*4+3]=255}return r}var e9=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,t9={name:"sdf",vs:e9,fs:e9,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}};var r9=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var b4=192/256,i9=[],hle={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},ix=class extends I0{getShaders(){let e=super.getShaders();return{...e,modules:[...e.modules,t9],fs:r9}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(r,{index:i,target:n})=>this.encodePickingColor(i,n)}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e,{outlineColor:n}=r;n!==i.outlineColor&&(n=n.map(s=>s/255),n[3]=Number.isFinite(n[3])?n[3]:1,this.setState({outlineColor:n})),!r.sdf&&r.outlineWidth&&ur.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){let{sdf:r,smoothing:i,outlineWidth:n}=this.props,{outlineColor:s}=this.state,a=n?Math.max(i,b4*(1-n)):-1,c=this.state.model,h={buffer:b4,outlineBuffer:a,gamma:i,enabled:!!r,outlineColor:s};if(c.shaderInputs.setProps({sdf:h}),super.draw(e),r&&n){let{iconManager:p}=this.state;p.getTexture()&&(c.shaderInputs.setProps({sdf:{...h,outlineBuffer:b4}}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(r=>super.getInstanceOffset(r)):i9}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(r=>super.getInstanceIconFrame(r)):i9}};ix.defaultProps=hle;ix.layerName="MultiIconLayer";var i3=ix;var nx=class{constructor({fontSize:e=24,buffer:r=3,radius:i=8,cutoff:n=.25,fontFamily:s="sans-serif",fontWeight:a="normal",fontStyle:c="normal"}={}){this.buffer=r,this.cutoff=n,this.radius=i;let h=this.size=e+r*4,p=this._createCanvas(h),x=this.ctx=p.getContext("2d",{willReadFrequently:!0});x.font=`${c} ${a} ${e}px ${s}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){let r=document.createElement("canvas");return r.width=r.height=e,r}draw(e){let{width:r,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:s,actualBoundingBoxRight:a}=this.ctx.measureText(e),c=Math.ceil(i),h=0,p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-s))),x=Math.min(this.size-this.buffer,c+Math.ceil(n)),T=p+2*this.buffer,R=x+2*this.buffer,k=Math.max(T*R,0),j=new Uint8ClampedArray(k),q={data:j,width:T,height:R,glyphWidth:p,glyphHeight:x,glyphTop:c,glyphLeft:h,glyphAdvance:r};if(p===0||x===0)return q;let{ctx:X,buffer:re,gridInner:te,gridOuter:oe}=this;X.clearRect(re,re,p,x),X.fillText(e,re,re+c);let ae=X.getImageData(re,re,p,x);oe.fill(1e20,0,k),te.fill(0,0,k);for(let pe=0;pe<x;pe++)for(let be=0;be<p;be++){let Fe=ae.data[4*(pe*p+be)+3]/255;if(Fe===0)continue;let Y=(pe+re)*T+be+re;if(Fe===1)oe[Y]=0,te[Y]=1e20;else{let J=.5-Fe;oe[Y]=J>0?J*J:0,te[Y]=J<0?J*J:0}}n9(oe,0,0,T,R,T,this.f,this.v,this.z),n9(te,re,re,p,x,T,this.f,this.v,this.z);for(let pe=0;pe<k;pe++){let be=Math.sqrt(oe[pe])-Math.sqrt(te[pe]);j[pe]=Math.round(255-255*(be/this.radius+this.cutoff))}return q}};function n9(t,e,r,i,n,s,a,c,h){for(let p=e;p<e+i;p++)s9(t,r*s+p,s,n,a,c,h);for(let p=r;p<r+n;p++)s9(t,p*s+e,1,i,a,c,h)}function s9(t,e,r,i,n,s,a){s[0]=0,a[0]=-1e20,a[1]=1e20,n[0]=t[e];for(let c=1,h=0,p=0;c<i;c++){n[c]=t[e+c*r];let x=c*c;do{let T=s[h];p=(n[c]-n[T]+x-T*T)/(c-T)/2}while(p<=a[h]&&--h>-1);h++,s[h]=c,a[h]=p,a[h+1]=1e20}for(let c=0,h=0;c<i;c++){for(;a[h+1]<c;)h++;let p=s[h],x=c-p;t[e+c*r]=n[p]+x*x}}var fle=32,dle=[];function ple(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function o9({characterSet:t,getFontWidth:e,fontHeight:r,buffer:i,maxCanvasWidth:n,mapping:s={},xOffset:a=0,yOffset:c=0}){let h=0,p=a,x=r+i*2;for(let T of t)if(!s[T]){let R=e(T);p+R+i*2>n&&(p=0,h++),s[T]={x:p+i,y:c+h*x+i,width:R,height:x,layoutWidth:R,layoutHeight:r},p+=R+i*2}return{mapping:s,xOffset:p,yOffset:c+h*x,canvasHeight:ple(c+(h+1)*x)}}function a9(t,e,r,i){let n=0;for(let s=e;s<r;s++){let a=t[s];n+=i[a]?.layoutWidth||0}return n}function l9(t,e,r,i,n,s){let a=e,c=0;for(let h=e;h<r;h++){let p=a9(t,h,h+1,n);c+p>i&&(a<h&&s.push(h),a=h,c=0),c+=p}return c}function Ale(t,e,r,i,n,s){let a=e,c=e,h=e,p=0;for(let x=e;x<r;x++)if((t[x]===" "||t[x+1]===" "||x+1===r)&&(h=x+1),h>c){let T=a9(t,c,h,n);p+T>i&&(a<c&&(s.push(c),a=c,p=0),T>i&&(T=l9(t,c,h,i,n,s),a=s[s.length-1])),c=h,p+=T}return p}function mle(t,e,r,i,n=0,s){s===void 0&&(s=t.length);let a=[];return e==="break-all"?l9(t,n,s,r,i,a):Ale(t,n,s,r,i,a),a}function gle(t,e,r,i,n,s){let a=0,c=0;for(let h=e;h<r;h++){let p=t[h],x=i[p];x?(c||(c=x.layoutHeight),n[h]=a+x.layoutWidth/2,a+=x.layoutWidth):(ur.warn(`Missing character: ${p} (${p.codePointAt(0)})`)(),n[h]=a,a+=fle)}s[0]=a,s[1]=c}function c9(t,e,r,i,n){let s=Array.from(t),a=s.length,c=new Array(a),h=new Array(a),p=new Array(a),x=(r==="break-word"||r==="break-all")&&isFinite(i)&&i>0,T=[0,0],R=[0,0],k=0,j=0,q=0;for(let X=0;X<=a;X++){let re=s[X];if((re===`
`||X===a)&&(q=X),q>j){let te=x?mle(s,r,i,n,j,q):dle;for(let oe=0;oe<=te.length;oe++){let ae=oe===0?j:te[oe-1],pe=oe<te.length?te[oe]:q;gle(s,ae,pe,n,c,R);for(let be=ae;be<pe;be++){let Fe=s[be],Y=n[Fe]?.layoutOffsetY||0;h[be]=k+R[1]/2+Y,p[be]=R[0]}k=k+R[1]*e,T[0]=Math.max(T[0],R[0])}j=q}re===`
`&&(c[j]=0,h[j]=0,p[j]=0,j++)}return T[1]=k,{x:c,y:h,rowWidth:p,size:T}}function u9({value:t,length:e,stride:r,offset:i,startIndices:n,characterSet:s}){let a=t.BYTES_PER_ELEMENT,c=r?r/a:1,h=i?i/a:0,p=n[e]||Math.ceil((t.length-h)/c),x=s&&new Set,T=new Array(e),R=t;if(c>1||h>0){let k=t.constructor;R=new k(p);for(let j=0;j<p;j++)R[j]=t[j*c+h]}for(let k=0;k<e;k++){let j=n[k],q=n[k+1]||p,X=R.subarray(j,q);T[k]=String.fromCodePoint.apply(null,X),x&&X.forEach(x.add,x)}if(x)for(let k of x)s.add(String.fromCodePoint(k));return{texts:T,characterCount:p}}var L0=class{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){let r=this._cache[e];return r&&(this._deleteOrder(e),this._appendOrder(e)),r}set(e,r){this._cache[e]?(this.delete(e),this._cache[e]=r,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=r,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){let r=this._order.indexOf(e);r>=0&&this._order.splice(r,1)}_appendOrder(e){this._order.push(e)}};function _le(){let t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}var gA={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:_le(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},h9=1024,f9=.9,d9=1.2,A9=3,n3=new L0(A9);function yle(t,e){let r;typeof e=="string"?r=new Set(Array.from(e)):r=new Set(e);let i=n3.get(t);if(!i)return r;for(let n in i.mapping)r.has(n)&&r.delete(n);return r}function xle(t,e){for(let r=0;r<t.length;r++)e.data[4*r+3]=t[r]}function p9(t,e,r,i){t.font=`${i} ${r}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function m9(t){ur.assert(Number.isFinite(t)&&t>=A9,"Invalid cache limit"),n3=new L0(t)}var sx=class{constructor(){this.props={...gA}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){let{fontSize:e,buffer:r}=this.props;return(e*d9+r*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();let r=yle(this._key,this.props.characterSet),i=n3.get(this._key);if(i&&r.size===0){this._atlas!==i&&(this._atlas=i);return}let n=this._generateFontAtlas(r,i);this._atlas=n,n3.set(this._key,n)}_generateFontAtlas(e,r){let{fontFamily:i,fontWeight:n,fontSize:s,buffer:a,sdf:c,radius:h,cutoff:p}=this.props,x=r&&r.data;x||(x=document.createElement("canvas"),x.width=h9);let T=x.getContext("2d",{willReadFrequently:!0});p9(T,i,s,n);let{mapping:R,canvasHeight:k,xOffset:j,yOffset:q}=o9({getFontWidth:X=>T.measureText(X).width,fontHeight:s*d9,buffer:a,characterSet:e,maxCanvasWidth:h9,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(x.height!==k){let X=T.getImageData(0,0,x.width,x.height);x.height=k,T.putImageData(X,0,0)}if(p9(T,i,s,n),c){let X=new nx({fontSize:s,buffer:a,radius:h,cutoff:p,fontFamily:i,fontWeight:`${n}`});for(let re of e){let{data:te,width:oe,height:ae,glyphTop:pe}=X.draw(re);R[re].width=oe,R[re].layoutOffsetY=s*f9-pe;let be=T.createImageData(oe,ae);xle(te,be),T.putImageData(be,R[re].x,R[re].y)}}else for(let X of e)T.fillText(X,R[X].x,R[X].y+a+s*f9);return{xOffset:j,yOffset:q,mapping:R,data:x,width:x.width,height:x.height}}_getKey(){let{fontFamily:e,fontWeight:r,fontSize:i,buffer:n,sdf:s,radius:a,cutoff:c}=this.props;return s?`${e} ${r} ${i} ${n} ${a} ${c}`:`${e} ${r} ${i} ${n}`}};var g9=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,_9={name:"textBackground",vs:g9,fs:g9,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}};var y9=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var x9=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var ble={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},ox=class extends ln{getShaders(){return super.getShaders({vs:y9,fs:x9,modules:[Li,Sn,_9]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);let{changeFlags:r}=e;r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{billboard:r,sizeScale:i,sizeUnits:n,sizeMinPixels:s,sizeMaxPixels:a,getLineWidth:c}=this.props,{padding:h}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]);let p=this.state.model,x={billboard:r,stroked:!!c,padding:h,sizeUnits:Dn[n],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:a};p.shaderInputs.setProps({textBackground:x}),p.draw(this.context.renderPass)}_getModel(){let e=[0,0,1,0,0,1,1,1];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};ox.defaultProps=ble;ox.layerName="TextBackgroundLayer";var s3=ox;var b9={start:1,middle:0,end:-1},v9={top:1,center:0,bottom:-1},v4=[0,0,0,255],vle=1,wle={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:v4},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:gA.characterSet},fontFamily:gA.fontFamily,fontWeight:gA.fontWeight,lineHeight:vle,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:v4},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:v4},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},ax=class extends ss{constructor(){super(...arguments),this.getBoundingRect=(e,r)=>{let{size:[i,n]}=this.transformParagraph(e,r),{fontSize:s}=this.state.fontAtlasManager.props;i/=s,n/=s;let{getTextAnchor:a,getAlignmentBaseline:c}=this.props,h=b9[typeof a=="function"?a(e,r):a],p=v9[typeof c=="function"?c(e,r):c];return[(h-1)*i/2,(p-1)*n/2,i,n]},this.getIconOffsets=(e,r)=>{let{getTextAnchor:i,getAlignmentBaseline:n}=this.props,{x:s,y:a,rowWidth:c,size:[h,p]}=this.transformParagraph(e,r),x=b9[typeof i=="function"?i(e,r):i],T=v9[typeof n=="function"?n(e,r):n],R=s.length,k=new Array(R*2),j=0;for(let q=0;q<R;q++){let X=(1-x)*(h-c[q])/2;k[j++]=(x-1)*h/2+X+s[q],k[j++]=(T-1)*p/2+a[q]}return k}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new sx},this.props.maxWidth>0&&ur.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){let{props:r,oldProps:i,changeFlags:n}=e;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==i.lineHeight||r.wordBreak!==i.wordBreak||r.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){let{fontSettings:e,fontFamily:r,fontWeight:i}=this.props,{fontAtlasManager:n,characterSet:s}=this.state,a={...e,characterSet:s,fontFamily:r,fontWeight:i};if(!n.mapping)return n.setProps(a),!0;for(let c in a)if(a[c]!==n.props[c])return n.setProps(a),!0;return!1}_updateText(){let{data:e,characterSet:r}=this.props,i=e.attributes?.getText,{getText:n}=this.props,s=e.startIndices,a,c=r==="auto"&&new Set;if(i&&s){let{texts:h,characterCount:p}=u9({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:s,characterSet:c});a=p,n=(x,{index:T})=>h[T]}else{let{iterable:h,objectInfo:p}=Ps(e);s=[0],a=0;for(let x of h){p.index++;let T=Array.from(n(x,p)||"");c&&T.forEach(c.add,c),a+=T.length,s.push(a)}}this.setState({getText:n,startIndices:s,numInstances:a,characterSet:c||r})}transformParagraph(e,r){let{fontAtlasManager:i}=this.state,n=i.mapping,s=this.state.getText,{wordBreak:a,lineHeight:c,maxWidth:h}=this.props,p=s(e,r)||"";return c9(p,c,a,h*i.props.fontSize,n)}renderLayers(){let{startIndices:e,numInstances:r,getText:i,fontAtlasManager:{scale:n,atlas:s,mapping:a},styleVersion:c}=this.state,{data:h,_dataDiff:p,getPosition:x,getColor:T,getSize:R,getAngle:k,getPixelOffset:j,getBackgroundColor:q,getBorderColor:X,getBorderWidth:re,backgroundPadding:te,background:oe,billboard:ae,fontSettings:pe,outlineWidth:be,outlineColor:Fe,sizeScale:Y,sizeUnits:J,sizeMinPixels:Z,sizeMaxPixels:xe,transitions:_e,updateTriggers:Be}=this.props,Se=this.getSubLayerClass("characters",i3),ke=this.getSubLayerClass("background",s3);return[oe&&new ke({getFillColor:q,getLineColor:X,getLineWidth:re,padding:te,getPosition:x,getSize:R,getAngle:k,getPixelOffset:j,billboard:ae,sizeScale:Y,sizeUnits:J,sizeMinPixels:Z,sizeMaxPixels:xe,transitions:_e&&{getPosition:_e.getPosition,getAngle:_e.getAngle,getSize:_e.getSize,getFillColor:_e.getBackgroundColor,getLineColor:_e.getBorderColor,getLineWidth:_e.getBorderWidth,getPixelOffset:_e.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Be.getPosition,getAngle:Be.getAngle,getSize:Be.getSize,getFillColor:Be.getBackgroundColor,getLineColor:Be.getBorderColor,getLineWidth:Be.getBorderWidth,getPixelOffset:Be.getPixelOffset,getBoundingRect:{getText:Be.getText,getTextAnchor:Be.getTextAnchor,getAlignmentBaseline:Be.getAlignmentBaseline,styleVersion:c}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:p,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Se({sdf:pe.sdf,smoothing:Number.isFinite(pe.smoothing)?pe.smoothing:gA.smoothing,outlineWidth:be/(pe.radius||gA.radius),outlineColor:Fe,iconAtlas:s,iconMapping:a,getPosition:x,getColor:T,getSize:R,getAngle:k,getPixelOffset:j,billboard:ae,sizeScale:Y*n,sizeUnits:J,sizeMinPixels:Z*n,sizeMaxPixels:xe*n,transitions:_e&&{getPosition:_e.getPosition,getAngle:_e.getAngle,getColor:_e.getColor,getSize:_e.getSize,getPixelOffset:_e.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Be.getText,getPosition:Be.getPosition,getAngle:Be.getAngle,getColor:Be.getColor,getSize:Be.getSize,getPixelOffset:Be.getPixelOffset,getIconOffsets:{getTextAnchor:Be.getTextAnchor,getAlignmentBaseline:Be.getAlignmentBaseline,styleVersion:c}}}),{data:h,_dataDiff:p,startIndices:e,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){m9(e)}};ax.defaultProps=wle;ax.layerName="TextLayer";var o3=ax;var lx={circle:{type:Uw,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:I0,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:o3,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},cx={type:$u,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},a3={type:Pd,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function O0({type:t,props:e}){let r={};for(let i in e)r[i]=t.defaultProps[e[i]];return r}function l3(t,e){let{transitions:r,updateTriggers:i}=t.props,n={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(let s in e){let a=e[s],c=t.props[s];s.startsWith("get")&&(c=t.getSubLayerAccessor(c),n.updateTriggers[a]=i[s],r&&(n.transitions[a]=r[s])),n[a]=c}return n}function T9(t){if(Array.isArray(t))return t;switch(ur.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return ur.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function w4(t,e,r={}){let i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:s=t.length}=r;for(let a=n;a<s;a++){let c=t[a],{geometry:h}=c;if(h)if(h.type==="GeometryCollection"){ur.assert(Array.isArray(h.geometries),"GeoJSON does not have geometries array");let{geometries:p}=h;for(let x=0;x<p.length;x++){let T=p[x];w9(T,i,e,c,a)}}else w9(h,i,e,c,a)}return i}function w9(t,e,r,i,n){let{type:s,coordinates:a}=t,{pointFeatures:c,lineFeatures:h,polygonFeatures:p,polygonOutlineFeatures:x}=e;if(!Ele(s,a)){ur.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":c.push(r({geometry:t},i,n));break;case"MultiPoint":a.forEach(T=>{c.push(r({geometry:{type:"Point",coordinates:T}},i,n))});break;case"LineString":h.push(r({geometry:t},i,n));break;case"MultiLineString":a.forEach(T=>{h.push(r({geometry:{type:"LineString",coordinates:T}},i,n))});break;case"Polygon":p.push(r({geometry:t},i,n)),a.forEach(T=>{x.push(r({geometry:{type:"LineString",coordinates:T}},i,n))});break;case"MultiPolygon":a.forEach(T=>{p.push(r({geometry:{type:"Polygon",coordinates:T}},i,n)),T.forEach(R=>{x.push(r({geometry:{type:"LineString",coordinates:R}},i,n))})});break;default:}}var Tle={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Ele(t,e){let r=Tle[t];for(ur.assert(r,`Unknown GeoJSON type ${t}`);e&&--r>0;)e=e[0];return e&&Number.isFinite(e[0])}function E9(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function c3(t){return t.geometry.coordinates}function C9(t,e){let r=E9(),{pointFeatures:i,lineFeatures:n,polygonFeatures:s,polygonOutlineFeatures:a}=t;return r.points.data=i,r.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),r.points.getPosition=c3,r.lines.data=n,r.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),r.lines.getPath=c3,r.polygons.data=s,r.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),r.polygons.getPolygon=c3,r.polygonsOutline.data=a,r.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),r.polygonsOutline.getPath=c3,r}function S9(t,e){let r=E9(),{points:i,lines:n,polygons:s}=t,a=J7(t,e);return r.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:a.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:4,value:a.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines._pathType="open",r.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:a.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},r.polygons._normalize=!1,s.triangles&&(r.polygons.data.attributes.indices=s.triangles.value),r.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:a.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},r.polygonsOutline._pathType="open",r}var Cle=["points","linestrings","polygons"],Sle={...O0(lx.circle),...O0(lx.icon),...O0(lx.text),...O0(cx),...O0(a3),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},ux=class extends ss{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:r}){if(!r.dataChanged)return;let{data:i}=this.props,n=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:n}),n?this._updateStateBinary({props:e,changeFlags:r}):this._updateStateJSON({props:e,changeFlags:r})}_updateStateBinary({props:e,changeFlags:r}){let i=S9(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:r}){let i=T9(e.data),n=this.getSubLayerRow.bind(this),s={},a={};if(Array.isArray(r.dataChanged)){let h=this.state.features;for(let p in h)s[p]=h[p].slice(),a[p]=[];for(let p of r.dataChanged){let x=w4(i,n,p);for(let T in h)a[T].push(r3({data:s[T],getIndex:R=>R.__source.index,dataRange:p,replace:x[T]}))}}else s=w4(i,n);let c=C9(s,a);this.setState({features:s,featuresDiff:a,layerProps:c})}getPickingInfo(e){let r=super.getPickingInfo(e),{index:i,sourceLayer:n}=r;return r.featureType=Cle.find(s=>n.id.startsWith(`${this.id}-${s}-`)),i>=0&&n.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[i]),r}_updateAutoHighlight(e){let r=`${this.id}-points-`,i=e.featureType==="points";for(let n of this.getSubLayers())n.id.startsWith(r)===i&&n.updateAutoHighlight(e)}_renderPolygonLayer(){let{extruded:e,wireframe:r}=this.props,{layerProps:i}=this.state,n="polygons-fill",s=this.shouldRenderSubLayer(n,i.polygons?.data)&&this.getSubLayerClass(n,a3.type);if(s){let a=l3(this,a3.props),c=e&&r;return c||delete a.getLineColor,a.updateTriggers.lineColors=c,new s(a,this.getSubLayerProps({id:n,updateTriggers:a.updateTriggers}),i.polygons)}return null}_renderLineLayers(){let{extruded:e,stroked:r}=this.props,{layerProps:i}=this.state,n="polygons-stroke",s="linestrings",a=!e&&r&&this.shouldRenderSubLayer(n,i.polygonsOutline?.data)&&this.getSubLayerClass(n,cx.type),c=this.shouldRenderSubLayer(s,i.lines?.data)&&this.getSubLayerClass(s,cx.type);if(a||c){let h=l3(this,cx.props);return[a&&new a(h,this.getSubLayerProps({id:n,updateTriggers:h.updateTriggers}),i.polygonsOutline),c&&new c(h,this.getSubLayerProps({id:s,updateTriggers:h.updateTriggers}),i.lines)]}return null}_renderPointLayers(){let{pointType:e}=this.props,{layerProps:r,binary:i}=this.state,{highlightedObjectIndex:n}=this.props;!i&&Number.isFinite(n)&&(n=r.points.data.findIndex(c=>c.__source.index===n));let s=new Set(e.split("+")),a=[];for(let c of s){let h=`points-${c}`,p=lx[c],x=p&&this.shouldRenderSubLayer(h,r.points?.data)&&this.getSubLayerClass(h,p.type);if(x){let T=l3(this,p.props),R=r.points;if(c==="text"&&i){let{instancePickingColors:k,...j}=R.data.attributes;R={...R,data:{...R.data,attributes:j}}}a.push(new x(T,this.getSubLayerProps({id:h,updateTriggers:T.updateTriggers,highlightedObjectIndex:n}),R))}}return a}renderLayers(){let{extruded:e}=this.props,r=this._renderPolygonLayer(),i=this._renderLineLayers(),n=this._renderPointLayers();return[!e&&r,i,n,e&&r]}getSubLayerAccessor(e){let{binary:r}=this.state;return!r||typeof e!="function"?super.getSubLayerAccessor(e):(i,n)=>{let{data:s,index:a}=n,c=Q7(s,a);return e(c,n)}}};ux.layerName="GeoJsonLayer";ux.defaultProps=Sle;var _A=ux;function I9({pointCount:t,getBinId:e}){let r=new Map;for(let i=0;i<t;i++){let n=e(i);if(n===null)continue;let s=r.get(String(n));s?s.points.push(i):(s={id:n,index:r.size,points:[i]},r.set(String(n),s))}return Array.from(r.values())}function M9({bins:t,dimensions:e,target:r}){let i=t.length*e;(!r||r.length<i)&&(r=new Float32Array(i));for(let n=0;n<t.length;n++){let{id:s}=t[n];Array.isArray(s)?r.set(s,n*e):r[n]=s}return r}var Ile=t=>t.length,P9=(t,e)=>{let r=0;for(let i of t)r+=e(i);return r},Mle=(t,e)=>t.length===0?NaN:P9(t,e)/t.length,Ple=(t,e)=>{let r=1/0;for(let i of t){let n=e(i);n<r&&(r=n)}return r},Rle=(t,e)=>{let r=-1/0;for(let i of t){let n=e(i);n>r&&(r=n)}return r},R9={COUNT:Ile,SUM:P9,MEAN:Mle,MIN:Ple,MAX:Rle};function B9({bins:t,getValue:e,operation:r,target:i}){(!i||i.length<t.length)&&(i=new Float32Array(t.length));let n=1/0,s=-1/0;for(let a=0;a<t.length;a++){let{points:c}=t[a];i[a]=r(c,e),i[a]<n&&(n=i[a]),i[a]>s&&(s=i[a])}return{value:i,domain:[n,s]}}function T4(t,e,r){let i={};for(let s of t.sources||[]){let a=e[s];if(a)i[s]=Ble(a);else throw new Error(`Cannot find attribute ${s}`)}let n={};return s=>{for(let a in i)n[a]=i[a](s);return t.getValue(n,s,r)}}function Ble(t){let e=t.value,{offset:r=0,stride:i,size:n}=t.getAccessor(),s=e.BYTES_PER_ELEMENT,a=r/s,c=i?i/s:n;if(n===1)return t.isConstant?()=>e[0]:p=>{let x=a+c*p;return e[x]};let h;return t.isConstant?(h=Array.from(e),()=>h):(h=new Array(n),p=>{let x=a+c*p;for(let T=0;T<n;T++)h[T]=e[x+T];return h})}var ca=class{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){let r=this.props;if(e.binOptions&&(An(e.binOptions,r.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==r.operations[i]&&this.setNeedsUpdate(i);if(e.customOperations)for(let i=0;i<this.channelCount;i++)!!e.customOperations[i]!=!!r.customOperations[i]&&this.setNeedsUpdate(i);e.pointCount!==void 0&&e.pointCount!==r.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...r.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){if(this.needsUpdate===!0){this.bins=I9({pointCount:this.props.pointCount,getBinId:T4(this.props.getBin,this.props.attributes,this.props.binOptions)});let e=M9({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:e,type:"float32",size:this.dimensions}}for(let e=0;e<this.channelCount;e++)if(this.needsUpdate===!0||this.needsUpdate[e]){let r=this.props.customOperations[e]||R9[this.props.operations[e]],{value:i,domain:n}=B9({bins:this.bins,getValue:T4(this.props.getValue[e],this.props.attributes,void 0),operation:r,target:this.results[e]?.value});this.results[e]={value:i,domain:n,type:"float32",size:1},this.props.onUpdate?.({channel:e})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){return this.results[e]?.domain??[1/0,-1/0]}getBin(e){let r=this.bins[e];if(!r)return null;let i=new Array(this.channelCount);for(let n=0;n<i.length;n++){let s=this.results[n];i[n]=s?.value[e]}return{id:r.id,value:i,count:r.points.length,pointIndices:r.points}}};function u3(t,e,r){return t.createFramebuffer({width:e,height:r,colorAttachments:[t.createTexture({width:e,height:r,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}var Lle=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,L9={name:"binSorter",vs:Lle,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}};var D9=[1,2,4,8],O9=3e38,Ole={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},hx=1024,h3=class{constructor(e,r){this.binsFBO=null,this.device=e,this.model=Fle(e,r)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(e){if(!this.binsFBO)return null;let r=e%hx,i=Math.floor(e/hx),n=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:r,sourceY:i,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(n)}setDimensions(e,r){let i=hx,n=Math.ceil(e/i);this.binsFBO?this.binsFBO.height<n&&this.binsFBO.resize({width:i,height:n}):this.binsFBO=u3(this.device,i,n);let s={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:s})}setModelProps(e){let r=this.model;e.attributes&&r.setAttributes(e.attributes),e.constantAttributes&&r.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&r.setVertexCount(e.vertexCount),e.shaderModuleProps&&r.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;let r=Dle(e);this._updateBins("SUM",r.SUM+r.MEAN),this._updateBins("MIN",r.MIN),this._updateBins("MAX",r.MAX)}_updateBins(e,r){if(r===0)return;r|=D9[3];let i=this.model,n=this.binsFBO,s=e==="MAX"?-O9:e==="MIN"?O9:0,a=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:n,parameters:{viewport:[0,0,n.width,n.height],colorMask:r},clearColor:[s,s,s,0],clearDepth:!1,clearStencil:!1});i.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),i.draw(a),a.end()}};function Dle(t){let e={...Ole};for(let r=0;r<t.length;r++){let i=t[r];i&&(e[i]+=D9[r])}return e}function Fle(t,e){let r=e.vs;e.dimensions===2&&(r+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);let i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${r}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new di(t,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],L9],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:i,fs:n,topology:"point-list",disableWarnings:!0})}var kle=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,F9={name:"aggregatorTransform",vs:kle,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};var E4=3e38,f3=class{constructor(e,r){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=r.channelCount,this.transform=Nle(e,r),this.domainFBO=u3(e,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){let e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,r=new Float32Array(e);this._domains=[[-r[4],r[0]],[-r[5],r[1]],[-r[6],r[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,r){let{model:i,transformFeedback:n}=this.transform;i.setVertexCount(e);let s={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0]};i.shaderInputs.setProps({aggregatorTransform:s});let a=e*r.length*4;(!this.binBuffer||this.binBuffer.byteLength<a)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:a}),n.setBuffer("binIds",this.binBuffer));let c=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<c)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:c}),n.setBuffer("values",this.valueBuffer))}update(e,r){if(!e)return;let i=this.transform,n=this.domainFBO,s=[0,1,2].map(h=>r[h]==="COUNT"?1:0),a=[0,1,2].map(h=>r[h]==="MEAN"?1:0),c={isCount:s,isMean:a,bins:e};i.model.shaderInputs.setProps({aggregatorTransform:c}),i.run({id:"gpu-aggregation-domain",framebuffer:n,parameters:{viewport:[0,0,2,1]},clearColor:[-E4,-E4,-E4,0],clearDepth:!1,clearStencil:!1}),this._domains=null}};function Nle(t,e){let r=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new Fu(t,{vs:r,fs:i,topology:"point-list",modules:[F9],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:hx},varyings:["binIds","values"],disableWarnings:!0})}var Rs=class{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,r){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=r.dimensions,this.channelCount=r.channelCount,this.props={...r,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new h3(e,r),this.aggregationTransform=new f3(e,r),this.setProps(r)}getBins(){let e=this.aggregationTransform.binBuffer;return e?(this.binIds?.buffer!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){let r=this.aggregationTransform.valueBuffer;return!r||e>=this.channelCount?null:(this.results[e]?.buffer!==r&&(this.results[e]={buffer:r,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;let{binIdRange:r}=this.props,i;if(this.dimensions===1)i=[e+r[0][0]];else{let[[c,h],[p]]=r,x=h-c;i=[e%x+c,Math.floor(e/x)+p]}let n=this.binSorter.getBinValues(e);if(!n)return null;let s=n[3],a=[];for(let c=0;c<this.channelCount;c++){let h=this.props.operations[c];h==="COUNT"?a[c]=s:s===0?a[c]=NaN:a[c]=h==="MEAN"?n[c]/s:n[c]}return{id:i,value:a,count:s}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){let r=this.props;if("binIdRange"in e&&!An(e.binIdRange,r.binIdRange,2)){let i=e.binIdRange;if(ur.assert(i.length===this.dimensions),this.dimensions===1){let[[n,s]]=i;this.binCount=s-n}else{let[[n,s],[a,c]]=i;this.binCount=(s-n)*(c-a)}this.binSorter.setDimensions(this.binCount,i),this.aggregationTransform.setDimensions(this.binCount,i),this.setNeedsUpdate()}if(e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==r.operations[i]&&this.setNeedsUpdate(i);if(e.pointCount!==void 0&&e.pointCount!==r.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(An(e.binOptions,r.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){let i={},n={};for(let s of Object.values(e.attributes))for(let[a,c]of Object.entries(s.getValue()))ArrayBuffer.isView(c)?n[a]=c:c&&(i[a]=c);this.binSorter.setModelProps({attributes:i,constantAttributes:n})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;let{operations:e}=this.props,r=this.needsUpdate.map((i,n)=>i?e[n]:null);this.binSorter.update(r),this.aggregationTransform.update(this.binSorter.texture,e);for(let i=0;i<this.channelCount;i++)this.needsUpdate[i]&&(this.needsUpdate[i]=!1,this.props.onUpdate?.({channel:i}))}};var d3=class extends ss{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){super.updateState(e);let r=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==r){this.state.aggregator?.destroy();let i=this.createAggregator(r);return i.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:i,aggregatorType:r}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){let{aggregator:r}=this.state;r.setProps({attributes:e});for(let i in e)this.onAttributeChange(i);r.update()}draw({shaderModuleProps:e}){let{aggregator:r}=this.state;r.setProps({shaderModuleProps:e}),r.preDraw()}_getAttributeManager(){return new Fl(this.context.device,{id:this.props.id,stats:this.context.stats})}};d3.layerName="AggregationLayer";var qu=d3;var Bd=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function C4(t,e=!1,r=Float32Array){let i;if(Number.isFinite(t[0]))i=new r(t);else{i=new r(t.length*4);let n=0;for(let s=0;s<t.length;s++){let a=t[s];i[n++]=a[0],i[n++]=a[1],i[n++]=a[2],i[n++]=Number.isFinite(a[3])?a[3]:255}}if(e)for(let n=0;n<i.length;n++)i[n]/=255;return i}var p3={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function D0(t,e){t.setSampler({minFilter:p3[e],magFilter:p3[e]})}function F0(t,e,r="linear"){let i=C4(e,!1,Uint8Array);return t.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:p3[r],magFilter:p3[r],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:i,width:i.length/4,height:1})}var k9=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`;var N9=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var zle=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,z9={name:"screenGrid",vs:zle,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};var A3=class extends ln{getShaders(){return super.getShaders({vs:k9,fs:N9,modules:[Sn,z9]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e,s=this.state.model;if(i.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=F0(this.context.device,r.colorRange,r.colorScaleType);let a={colorRange:this.state.colorTexture};s.shaderInputs.setProps({screenGrid:a})}else i.colorScaleType!==r.colorScaleType&&D0(this.state.colorTexture,r.colorScaleType);if(i.cellMarginPixels!==r.cellMarginPixels||i.cellSizePixels!==r.cellSizePixels||n.viewportChanged){let{width:a,height:c}=this.context.viewport,{cellSizePixels:h,cellMarginPixels:p}=this.props,x=Math.max(h-p,0),T={gridSizeClipspace:[h/a*2,h/c*2],cellSizeClipspace:[x/a*2,x/c*2]};s.shaderInputs.setProps({screenGrid:T})}}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){let r=this.props.colorDomain(),i=this.state.model,n={colorDomain:r};i.shaderInputs.setProps({screenGrid:n}),i.draw(this.context.renderPass)}_getModel(){return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}};A3.layerName="ScreenGridCellLayer";var U9=A3;var Ule=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,V9={name:"binOptions",vs:Ule,uniformTypes:{cellSizePixels:"f32"}};var Vle={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:Bd,colorScaleType:"linear",getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},fx=class extends qu{getAggregatorType(){return this.props.gpuAggregation&&Rs.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"||!Rs.isSupported(this.context.device)?new ca({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},i,n)=>{let s=this.context.viewport,a=s.project(r),c=n.cellSizePixels;return a[0]<0||a[0]>=s.width||a[1]<0||a[1]>=s.height?null:[Math.floor(a[0]/c),Math.floor(a[1]/c)]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}]}):new Rs(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Li,V9],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{cellSizePixels:a,aggregation:c}=i;if(r||s.dataChanged||s.updateTriggersChanged||s.viewportChanged||c!==n.aggregation||a!==n.cellSizePixels){let{width:h,height:p}=this.context.viewport,{aggregator:x}=this.state;x instanceof Rs&&x.setProps({binIdRange:[[0,Math.ceil(h/a)],[0,Math.ceil(p/a)]]}),x.setProps({pointCount:this.getNumInstances(),operations:[c],binOptions:{cellSizePixels:a}})}return s.viewportChanged&&this.state.aggregator.setNeedsUpdate(),r}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate();break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let{aggregator:e}=this.state,r=this.getSubLayerClass("cells",U9),i=e.getBins(),n=e.getResult(0);return new r(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:i,getWeight:n}},dataComparator:(s,a)=>s.length===a.length,updateTriggers:{getBin:[i],getWeight:[n]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){let r=e.info,{index:i}=r;if(i>=0){let n=this.state.aggregator.getBin(i),s;n&&(s={col:n.id[0],row:n.id[1],value:n.value[0],count:n.count},n.pointIndices&&(s.pointIndices=n.pointIndices,s.points=Array.isArray(this.props.data)?n.pointIndices.map(a=>this.props.data[a]):[])),r.object=s}return r}};fx.layerName="ScreenGridLayer";fx.defaultProps=Vle;var j9=fx;var Ld=class{constructor(e,r){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=r,this.attribute=e}getScalePercentile(){if(!this._percentile){let e=G9(this.input,this.inputLength);this._percentile=Gle(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){let e=G9(this.input,this.inputLength);this._ordinal=jle(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:r,upperPercentile:i}){if(e==="quantile")return[r,i-1];if(r>0||i<100){let{domain:n}=this.getScalePercentile(),s=n[Math.floor(r)-1]??-1/0,a=n[Math.floor(i)-1]??1/0;if(e==="ordinal"){let{domain:c}=this.getScaleOrdinal();s=c.findIndex(h=>h>=s),a=c.findIndex(h=>h>a)-1,a===-2&&(a=c.length-1)}return[s,a]}return null}update(e){let r=this.props;if(e.scaleType!==r.scaleType)switch(e.scaleType){case"quantile":{let{attribute:i}=this.getScalePercentile();this.attribute=i,this.domain=[0,99];break}case"ordinal":{let{attribute:i,domain:n}=this.getScaleOrdinal();this.attribute=i,this.domain=[0,n.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==r.scaleType||e.lowerPercentile!==r.lowerPercentile||e.upperPercentile!==r.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}};function jle(t){let e=new Set;for(let n of t)Number.isFinite(n)&&e.add(n);let r=Array.from(e).sort(),i=new Map;for(let n=0;n<r.length;n++)i.set(r[n],n);return{attribute:{value:t.map(n=>Number.isFinite(n)?i.get(n):NaN),type:"float32",size:1},domain:r}}function Gle(t,e=100){let r=Array.from(t).filter(Number.isFinite).sort(Hle),i=0,n=Math.max(1,e),s=new Array(n-1);for(;++i<n;)s[i-1]=Wle(r,i/n);return{attribute:{value:t.map(a=>Number.isFinite(a)?$le(s,a):NaN),type:"float32",size:1},domain:s}}function G9(t,e){let r=(t.stride??4)/4,i=(t.offset??0)/4,n=t.value;if(!n){let a=t.buffer?.readSyncWebGL(0,r*4*e);a&&(n=new Float32Array(a.buffer),t.value=n)}if(r===1)return n.subarray(0,e);let s=new Float32Array(e);for(let a=0;a<e;a++)s[a]=n[a*r+i];return s}function Hle(t,e){return t-e}function Wle(t,e){let r=t.length;if(e<=0||r<2)return t[0];if(e>=1)return t[r-1];let i=(r-1)*e,n=Math.floor(i),s=t[n],a=t[n+1];return s+(a-s)*(i-n)}function $le(t,e){let r=0,i=t.length;for(;r<i;){let n=r+i>>>1;t[n]>e?i=n:r=n+1}return r}function k0({dataBounds:t,getBinId:e,padding:r=0}){let i=[t[0],t[1],[t[0][0],t[1][1]],[t[1][0],t[0][1]]].map(h=>e(h)),n=Math.min(...i.map(h=>h[0]))-r,s=Math.min(...i.map(h=>h[1]))-r,a=Math.max(...i.map(h=>h[0]))+r+1,c=Math.max(...i.map(h=>h[1]))+r+1;return[[n,a],[s,c]]}var H9=Math.PI/3,m3=2*Math.sin(H9),g3=1.5,W9=Array.from({length:6},(t,e)=>{let r=e*H9;return[Math.sin(r),-Math.cos(r)]});function _3([t,e],r){let i=Math.round(e=e/r/g3),n=Math.round(t=t/r/m3-(i&1)/2),s=e-i;if(Math.abs(s)*3>1){let a=t-n,c=n+(t<n?-1:1)/2,h=i+(e<i?-1:1),p=t-c,x=e-h;a*a+s*s>p*p+x*x&&(n=c+(i&1?1:-1)/2,i=h)}return[n,i]}var $9=`
const vec2 DIST = vec2(${m3}, ${g3});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function S4([t,e],r){return[(t+(e&1)/2)*r*m3,e*r*g3]}var q9=`
const vec2 DIST = vec2(${m3}, ${g3});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`;var Z9=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${q9}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var qle=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,X9={name:"hexagon",vs:qle,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};var y3=class extends Wu{getShaders(){let e=super.getShaders();return e.modules.push(X9),{...e,vs:Z9}}initializeState(){super.initializeState();let e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e,n=this.state.fillModel;if(i.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=F0(this.context.device,r.colorRange,r.colorScaleType);let s={colorRange:this.state.colorTexture};n.shaderInputs.setProps({hexagon:s})}else i.colorScaleType!==r.colorScaleType&&D0(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){let{radius:r,hexOriginCommon:i,elevationRange:n,elevationScale:s,extruded:a,coverage:c,colorDomain:h,elevationDomain:p}=this.props,x=this.props.colorCutoff||[-1/0,1/0],T=this.props.elevationCutoff||[-1/0,1/0],R=this.state.fillModel;R.vertexArray.indexBuffer&&R.setIndexBuffer(null),R.setVertexCount(this.state.fillVertexCount);let k={colorDomain:[Math.max(h[0],x[0]),Math.min(h[1],x[1]),Math.max(h[0]-1,x[0]),Math.min(h[1]+1,x[1])],elevationDomain:[Math.max(p[0],T[0]),Math.min(p[1],T[1]),Math.max(p[0]-1,T[0]),Math.min(p[1]+1,T[1])],elevationRange:[n[0]*s,n[1]*s],originCommon:i};R.shaderInputs.setProps({column:{extruded:a,coverage:c,radius:r},hexagon:k}),R.draw(this.context.renderPass)}};y3.layerName="HexagonCellLayer";var Y9=y3;var Zle=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,K9={name:"binOptions",vs:Zle,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function Q9(){}var Xle={gpuAggregation:!0,colorDomain:null,colorRange:Bd,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:Q9,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:Q9,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},dx=class extends qu{getAggregatorType(){let{gpuAggregation:e,hexagonAggregator:r,getColorValue:i,getElevationValue:n}=this.props;return e&&(r||i||n)?(ur.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Rs.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){let{hexagonAggregator:r,radius:i}=this.props;return new ca({dimensions:2,getBin:{sources:["positions"],getValue:({positions:n},s,a)=>{if(r)return r(n,i);let h=this.state.aggregatorViewport.projectPosition(n),{radiusCommon:p,hexOriginCommon:x}=a;return _3([h[0]-x[0],h[1]-x[1]],p)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:n})=>n},{sources:["elevationWeights"],getValue:({elevationWeights:n})=>n}]})}return new Rs(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Li,K9],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${$9}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{aggregator:a}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(Ps(i.data).iterable)),r||s.dataChanged||i.radius!==n.radius||i.getColorValue!==n.getColorValue||i.getElevationValue!==n.getElevationValue||i.colorAggregation!==n.colorAggregation||i.elevationAggregation!==n.elevationAggregation){this._updateBinOptions();let{radiusCommon:c,hexOriginCommon:h,binIdRange:p,dataAsArray:x}=this.state;if(a.setProps({binIdRange:p,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{radiusCommon:c,hexOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),x){let{getColorValue:T,getElevationValue:R}=this.props;a.setProps({customOperations:[T&&(k=>T(k.map(j=>x[j]),{indices:k,data:i.data})),R&&(k=>R(k.map(j=>x[j]),{indices:k,data:i.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&a.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&a.setNeedsUpdate(1),r}_updateBinOptions(){let e=this.getBounds(),r=1,i=[0,0],n=[[0,1],[0,1]],s=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{radius:c}=this.props,{unitsPerMeter:h}=s.getDistanceScales(a);r=h[0]*c;let p=_3(s.projectFlat(a),r);a=s.unprojectFlat(S4(p,r));let x=s.constructor;s=s.isGeospatial?new x({longitude:a[0],latitude:a[1],zoom:12}):new sl({position:[a[0],a[1],0],zoom:12}),i=[Math.fround(s.center[0]),Math.fround(s.center[1])],n=k0({dataBounds:e,getBinId:T=>{let R=s.projectFlat(T);return R[0]-=i[0],R[1]-=i[1],_3(R,r)},padding:1})}this.setState({radiusCommon:r,hexOriginCommon:i,binIdRange:n,aggregatorViewport:s})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){let r=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){let n=i.getResult(0);this.setState({colors:new Ld(n,i.binCount)}),r.onSetColorDomain(i.getResultDomain(0))}else if(e===1){let n=i.getResult(1);this.setState({elevations:new Ld(n,i.binCount)}),r.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{radiusCommon:i,hexOriginCommon:n,binIdRange:s}=this.state;r.setProps({binIdRange:s,binOptions:{radiusCommon:i,hexOriginCommon:n}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:e,radiusCommon:r,hexOriginCommon:i}=this.state,{elevationScale:n,colorRange:s,elevationRange:a,extruded:c,coverage:h,material:p,transitions:x,colorScaleType:T,lowerPercentile:R,upperPercentile:k,colorDomain:j,elevationScaleType:q,elevationLowerPercentile:X,elevationUpperPercentile:re,elevationDomain:te}=this.props,oe=this.getSubLayerClass("cells",Y9),ae=e.getBins(),pe=this.state.colors?.update({scaleType:T,lowerPercentile:R,upperPercentile:k}),be=this.state.elevations?.update({scaleType:q,lowerPercentile:X,upperPercentile:re});return!pe||!be?null:new oe(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:ae,getColorValue:pe.attribute,getElevationValue:be.attribute}},dataComparator:(Fe,Y)=>Fe.length===Y.length,updateTriggers:{getBin:[ae],getColorValue:[pe.attribute],getElevationValue:[be.attribute]},diskResolution:6,vertices:W9,radius:r,hexOriginCommon:i,elevationScale:n,colorRange:s,colorScaleType:T,elevationRange:a,extruded:c,coverage:h,material:p,colorDomain:pe.domain||j||e.getResultDomain(0),elevationDomain:be.domain||te||e.getResultDomain(1),colorCutoff:pe.cutoff,elevationCutoff:be.cutoff,transitions:x&&{getFillColor:x.getColorValue||x.getColorWeight,getElevation:x.getElevationValue||x.getElevationWeight},extensions:[]})}getPickingInfo(e){let r=e.info,{index:i}=r;if(i>=0){let n=this.state.aggregator.getBin(i),s;if(n){let a=S4(n.id,this.state.radiusCommon),c=this.context.viewport.unprojectFlat(a);s={col:n.id[0],row:n.id[1],position:c,colorValue:n.value[0],elevationValue:n.value[1],count:n.count},n.pointIndices&&(s.pointIndices=n.pointIndices,s.points=Array.isArray(this.props.data)?n.pointIndices.map(h=>this.props.data[h]):[])}r.object=s}return r}};dx.layerName="HexagonLayer";dx.defaultProps=Xle;var J9=dx;var yr=.16666666666666666,St={N:[0,.5],E:[.5,0],S:[0,-.5],W:[-.5,0],NE:[.5,.5],NW:[-.5,.5],SE:[.5,-.5],SW:[-.5,-.5]},N0=[St.W,St.SW,St.S],z0=[St.S,St.SE,St.E],U0=[St.E,St.NE,St.N],V0=[St.NW,St.W,St.N],j0=[[-.5,yr],[-.5,-yr],[-yr,-.5],[yr,-.5]],G0=[[-yr,-.5],[yr,-.5],[.5,-yr],[.5,yr]],H0=[[.5,-yr],[.5,yr],[yr,.5],[-yr,.5]],W0=[[-.5,yr],[-.5,-yr],[yr,.5],[-yr,.5]],ez=[St.W,St.SW,St.SE,St.E],tz=[St.S,St.SE,St.NE,St.N],rz=[St.NW,St.W,St.E,St.NE],iz=[St.NW,St.SW,St.S,St.N],nz=[[-.5,yr],[-.5,-yr],[.5,-yr],[.5,yr]],sz=[[-yr,-.5],[yr,-.5],[yr,.5],[-yr,.5]],Yle=[St.NW,St.SW,St.SE,St.NE],oz=[St.NW,St.SW,St.SE,St.E,St.N],az=[St.W,St.SW,St.SE,St.NE,St.N],lz=[St.NW,St.W,St.S,St.SE,St.NE],cz=[St.NW,St.SW,St.S,St.E,St.NE],uz=[St.NW,St.W,[.5,-yr],[.5,yr],St.N],hz=[[-yr,-.5],[yr,-.5],St.E,St.NE,St.N],fz=[[-.5,yr],[-.5,-yr],St.S,St.SE,St.E],dz=[St.W,St.SW,St.S,[yr,.5],[-yr,.5]],pz=[St.NW,St.W,[-yr,-.5],[yr,-.5],St.N],Az=[[-.5,yr],[-.5,-yr],St.E,St.NE,St.N],mz=[St.S,St.SE,St.E,[yr,.5],[-yr,.5]],gz=[St.W,St.SW,St.S,[.5,-yr],[.5,yr]],_z=[St.W,St.SW,St.SE,St.E,[yr,.5],[-yr,.5]],yz=[[-.5,yr],[-.5,-yr],St.S,St.SE,St.NE,St.N],xz=[St.NW,St.W,[-yr,-.5],[yr,-.5],St.E,St.NE],bz=[St.NW,St.SW,St.S,[.5,-yr],[.5,yr],St.N],$0=[St.W,St.SW,St.S,St.E,St.NE,St.N],q0=[St.NW,St.W,St.S,St.SE,St.E,St.N],x3=[[-.5,yr],[-.5,-yr],[-yr,-.5],[yr,-.5],St.E,St.NE,St.N],b3=[St.W,St.SW,St.S,[.5,-yr],[.5,yr],[yr,.5],[-yr,.5]],v3=[St.NW,St.W,[-yr,-.5],[yr,-.5],[.5,-yr],[.5,yr],St.N],w3=[[-.5,yr],[-.5,-yr],St.S,St.SE,St.E,[yr,.5],[-yr,.5]],vz=[[-.5,yr],[-.5,-yr],[-yr,-.5],[yr,-.5],[.5,-yr],[.5,yr],[yr,.5],[-yr,.5]],wz={0:[],1:[[St.W,St.S]],2:[[St.S,St.E]],3:[[St.W,St.E]],4:[[St.N,St.E]],5:{0:[[St.W,St.S],[St.N,St.E]],1:[[St.W,St.N],[St.S,St.E]]},6:[[St.N,St.S]],7:[[St.W,St.N]],8:[[St.W,St.N]],9:[[St.N,St.S]],10:{0:[[St.W,St.N],[St.S,St.E]],1:[[St.W,St.S],[St.N,St.E]]},11:[[St.N,St.E]],12:[[St.W,St.E]],13:[[St.S,St.E]],14:[[St.W,St.S]],15:[]};function fr(t){return parseInt(t,4)}var Tz={[fr("0000")]:[],[fr("2222")]:[],[fr("2221")]:[N0],[fr("2212")]:[z0],[fr("2122")]:[U0],[fr("1222")]:[V0],[fr("0001")]:[N0],[fr("0010")]:[z0],[fr("0100")]:[U0],[fr("1000")]:[V0],[fr("2220")]:[j0],[fr("2202")]:[G0],[fr("2022")]:[H0],[fr("0222")]:[W0],[fr("0002")]:[j0],[fr("0020")]:[G0],[fr("0200")]:[H0],[fr("2000")]:[W0],[fr("0011")]:[ez],[fr("0110")]:[tz],[fr("1100")]:[rz],[fr("1001")]:[iz],[fr("2211")]:[ez],[fr("2112")]:[tz],[fr("1122")]:[rz],[fr("1221")]:[iz],[fr("2200")]:[nz],[fr("2002")]:[sz],[fr("0022")]:[nz],[fr("0220")]:[sz],[fr("1111")]:[Yle],[fr("1211")]:[oz],[fr("2111")]:[az],[fr("1112")]:[lz],[fr("1121")]:[cz],[fr("1011")]:[oz],[fr("0111")]:[az],[fr("1110")]:[lz],[fr("1101")]:[cz],[fr("1200")]:[uz],[fr("0120")]:[hz],[fr("0012")]:[fz],[fr("2001")]:[dz],[fr("1022")]:[uz],[fr("2102")]:[hz],[fr("2210")]:[fz],[fr("0221")]:[dz],[fr("1002")]:[pz],[fr("2100")]:[Az],[fr("0210")]:[mz],[fr("0021")]:[gz],[fr("1220")]:[pz],[fr("0122")]:[Az],[fr("2012")]:[mz],[fr("2201")]:[gz],[fr("0211")]:[_z],[fr("2110")]:[yz],[fr("1102")]:[xz],[fr("1021")]:[bz],[fr("2011")]:[_z],[fr("0112")]:[yz],[fr("1120")]:[xz],[fr("1201")]:[bz],[fr("2101")]:[$0],[fr("0121")]:[$0],[fr("1012")]:[q0],[fr("1210")]:[q0],[fr("0101")]:{0:[N0,U0],1:[$0],2:[$0]},[fr("1010")]:{0:[V0,z0],1:[q0],2:[q0]},[fr("2121")]:{0:[$0],1:[$0],2:[N0,U0]},[fr("1212")]:{0:[q0],1:[q0],2:[V0,z0]},[fr("2120")]:{0:[x3],1:[x3],2:[j0,U0]},[fr("2021")]:{0:[b3],1:[b3],2:[N0,H0]},[fr("1202")]:{0:[v3],1:[v3],2:[V0,G0]},[fr("0212")]:{0:[w3],1:[w3],2:[z0,W0]},[fr("0102")]:{0:[j0,U0],1:[x3],2:[x3]},[fr("0201")]:{0:[N0,H0],1:[b3],2:[b3]},[fr("1020")]:{0:[V0,G0],1:[v3],2:[v3]},[fr("2010")]:{0:[z0,W0],1:[w3],2:[w3]},[fr("2020")]:{0:[W0,G0],1:[vz],2:[j0,H0]},[fr("0202")]:{0:[H0,j0],1:[vz],2:[W0,G0]}};function px(t,e){return Number.isNaN(t)?0:Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function Ez(t){let{x:e,y:r,xRange:i,yRange:n,getValue:s,threshold:a}=t,c=e<i[0],h=e>=i[1]-1,p=r<n[0],x=r>=n[1]-1,T=c||h||p||x,R=0,k,j,q,X;if(c||x)q=0;else{let oe=s(e,r+1);q=px(oe,a),R+=oe}if(h||x)X=0;else{let oe=s(e+1,r+1);X=px(oe,a),R+=oe}if(h||p)j=0;else{let oe=s(e+1,r);j=px(oe,a),R+=oe}if(c||p)k=0;else{let oe=s(e,r);k=px(oe,a),R+=oe}let re=-1;Number.isFinite(a)&&(re=q<<3|X<<2|j<<1|k),Array.isArray(a)&&(re=q<<6|X<<4|j<<2|k);let te=0;return T||(te=px(R/4,a)),{code:re,meanCode:te}}function Cz(t){let{x:e,y:r,z:i,code:n,meanCode:s}=t,a=Tz[n];Array.isArray(a)||(a=a[s]);let c=e+1,h=r+1,p=[];return a.forEach(x=>{let T=[];x.forEach(R=>{let k=c+R[0],j=h+R[1];T.push([k,j,i])}),p.push(T)}),p}function Sz(t){let{x:e,y:r,z:i,code:n,meanCode:s}=t,a=wz[n];Array.isArray(a)||(a=a[s]);let c=e+1,h=r+1,p=[];return a.forEach(x=>{x.forEach(T=>{let R=c+T[0],k=h+T[1];p.push([R,k,i])})}),p}function Iz({contours:t,getValue:e,xRange:r,yRange:i}){let n=[],s=[],a=0,c=0;for(let h=0;h<t.length;h++){let p=t[h],x=p.zIndex??h,{threshold:T}=p;for(let R=r[0]-1;R<r[1];R++)for(let k=i[0]-1;k<i[1];k++){let{code:j,meanCode:q}=Ez({getValue:e,threshold:T,x:R,y:k,xRange:r,yRange:i}),X={x:R,y:k,z:x,code:j,meanCode:q};if(Array.isArray(T)){let re=Cz(X);for(let te of re)s[c++]={vertices:te,contour:p}}else{let re=Sz(X);re.length>0&&(n[a++]={vertices:re,contour:p})}}}return{lines:n,polygons:s}}function Mz(t){let{aggregator:e,binIdRange:r,channel:i}=t;if(e instanceof Rs){let n=e.getResult(i)?.buffer;if(n){let s=new Float32Array(n.readSyncWebGL().buffer);return Kle(s,r)}}if(e instanceof ca){let n=e.getResult(i)?.value,s=e.getBins()?.value;if(s&&n)return Qle(n,s,e.binCount)}return null}function Kle(t,e){let[[r,i],[n,s]]=e,a=i-r,c=s-n;return(h,p)=>(h-=r,p-=n,h<0||h>=a||p<0||p>=c?NaN:t[p*a+h])}function Qle(t,e,r){let i={};for(let n=0;n<r;n++){let s=e[n*2],a=e[n*2+1];i[s]=i[s]||{},i[s][a]=t[n]}return(n,s)=>i[n]?.[s]??NaN}var Jle=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Pz={name:"binOptions",vs:Jle,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};var Rz=[255,255,255,255],ece=1,tce={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005},Ax=class extends qu{getAggregatorType(){return this.props.gpuAggregation&&Rs.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new ca({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},i,n)=>{let a=this.state.aggregatorViewport.projectPosition(r),{cellSizeCommon:c,cellOriginCommon:h}=n;return[Math.floor((a[0]-h[0])/c[0]),Math.floor((a[1]-h[1])/c[1])]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}],onUpdate:this._onAggregationUpdate.bind(this)}):new Rs(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Li,Pz],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{aggregator:a}=this.state;if(r||s.dataChanged||i.cellSize!==n.cellSize||!An(i.gridOrigin,n.gridOrigin,1)||i.aggregation!==n.aggregation){this._updateBinOptions();let{cellSizeCommon:c,cellOriginCommon:h,binIdRange:p}=this.state;a.setProps({binIdRange:p,pointCount:this.getNumInstances(),operations:[i.aggregation],binOptions:{cellSizeCommon:c,cellOriginCommon:h}})}return An(n.contours,i.contours,2)||this.setState({contourData:null}),r}_updateBinOptions(){let e=this.getBounds(),r=[1,1],i=[0,0],n=[[0,1],[0,1]],s=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{cellSize:c,gridOrigin:h}=this.props,{unitsPerMeter:p}=s.getDistanceScales(a);r[0]=p[0]*c,r[1]=p[1]*c;let x=s.projectFlat(a);i=[Math.floor((x[0]-h[0])/r[0])*r[0]+h[0],Math.floor((x[1]-h[1])/r[1])*r[1]+h[1]],a=s.unprojectFlat(i);let T=s.constructor;s=s.isGeospatial?new T({longitude:a[0],latitude:a[1],zoom:12}):new sl({position:[a[0],a[1],0],zoom:12}),i=[Math.fround(s.center[0]),Math.fround(s.center[1])],n=k0({dataBounds:e,getBinId:R=>{let k=s.projectFlat(R);return[Math.floor((k[0]-i[0])/r[0]),Math.floor((k[1]-i[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:i,binIdRange:n,aggregatorViewport:s})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){let{aggregator:e,binIdRange:r}=this.state;this.setState({aggregatedValueReader:Mz({aggregator:e,binIdRange:r,channel:0}),contourData:null})}_getContours(){let{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){let{binIdRange:r}=this.state,{contours:i}=this.props,n=Iz({contours:i,getValue:e,xRange:r[0],yRange:r[1]});this.state.contourData=n}return this.state.contourData}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:i,cellOriginCommon:n,binIdRange:s}=this.state;r.setProps({binIdRange:s,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let e=this._getContours();if(!e)return null;let{lines:r,polygons:i}=e,{zOffset:n}=this.props,{cellOriginCommon:s,cellSizeCommon:a}=this.state,c=this.getSubLayerClass("lines",$u),h=this.getSubLayerClass("bands",Pd),p=new Er().translate([s[0],s[1],0]).scale([a[0],a[1],n]),x=r&&r.length>0&&new c(this.getSubLayerProps({id:"lines"}),{data:r,coordinateSystem:Tr.CARTESIAN,modelMatrix:p,getPath:R=>R.vertices,getColor:R=>R.contour.color??Rz,getWidth:R=>R.contour.strokeWidth??ece,widthUnits:"pixels"}),T=i&&i.length>0&&new h(this.getSubLayerProps({id:"bands"}),{data:i,coordinateSystem:Tr.CARTESIAN,modelMatrix:p,getPolygon:R=>R.vertices,getFillColor:R=>R.contour.color??Rz});return[x,T]}getPickingInfo(e){let r=e.info,{object:i}=r;return i&&(r.object={contour:i.contour}),r}};Ax.layerName="ContourLayer";Ax.defaultProps=tce;var Bz=Ax;var Lz=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var rce=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,Oz={name:"grid",vs:rce,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};var mx=class extends Wu{getShaders(){let e=super.getShaders();return e.modules.push(Oz),{...e,vs:Lz}}initializeState(){super.initializeState();let e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e,n=this.state.fillModel;if(i.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=F0(this.context.device,r.colorRange,r.colorScaleType);let s={colorRange:this.state.colorTexture};n.shaderInputs.setProps({grid:s})}else i.colorScaleType!==r.colorScaleType&&D0(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}_updateGeometry(){let e=new sA;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){let{cellOriginCommon:r,cellSizeCommon:i,elevationRange:n,elevationScale:s,extruded:a,coverage:c,colorDomain:h,elevationDomain:p}=this.props,x=this.props.colorCutoff||[-1/0,1/0],T=this.props.elevationCutoff||[-1/0,1/0],R=this.state.fillModel,k={colorDomain:[Math.max(h[0],x[0]),Math.min(h[1],x[1]),Math.max(h[0]-1,x[0]),Math.min(h[1]+1,x[1])],elevationDomain:[Math.max(p[0],T[0]),Math.min(p[1],T[1]),Math.max(p[0]-1,T[0]),Math.min(p[1]+1,T[1])],elevationRange:[n[0]*s,n[1]*s],originCommon:r,sizeCommon:i};R.shaderInputs.setProps({column:{extruded:a,coverage:c},grid:k}),R.draw(this.context.renderPass)}};mx.layerName="GridCellLayer";var ice=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Dz={name:"binOptions",vs:ice,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function Fz(){}var nce={gpuAggregation:!0,colorDomain:null,colorRange:Bd,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:Fz,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:Fz,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},gx=class extends qu{getAggregatorType(){let{gpuAggregation:e,gridAggregator:r,getColorValue:i,getElevationValue:n}=this.props;return e&&(r||i||n)?(ur.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Rs.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){let{gridAggregator:r,cellSize:i}=this.props;return new ca({dimensions:2,getBin:{sources:["positions"],getValue:({positions:n},s,a)=>{if(r)return r(n,i);let h=this.state.aggregatorViewport.projectPosition(n),{cellSizeCommon:p,cellOriginCommon:x}=a;return[Math.floor((h[0]-x[0])/p[0]),Math.floor((h[1]-x[1])/p[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:n})=>n},{sources:["elevationWeights"],getValue:({elevationWeights:n})=>n}]})}return new Rs(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Li,Dz],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{aggregator:a}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(Ps(i.data).iterable)),r||s.dataChanged||i.cellSize!==n.cellSize||i.getColorValue!==n.getColorValue||i.getElevationValue!==n.getElevationValue||i.colorAggregation!==n.colorAggregation||i.elevationAggregation!==n.elevationAggregation){this._updateBinOptions();let{cellSizeCommon:c,cellOriginCommon:h,binIdRange:p,dataAsArray:x}=this.state;if(a.setProps({binIdRange:p,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{cellSizeCommon:c,cellOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),x){let{getColorValue:T,getElevationValue:R}=this.props;a.setProps({customOperations:[T&&(k=>T(k.map(j=>x[j]),{indices:k,data:i.data})),R&&(k=>R(k.map(j=>x[j]),{indices:k,data:i.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&a.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&a.setNeedsUpdate(1),r}_updateBinOptions(){let e=this.getBounds(),r=[1,1],i=[0,0],n=[[0,1],[0,1]],s=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{cellSize:c}=this.props,{unitsPerMeter:h}=s.getDistanceScales(a);r[0]=h[0]*c,r[1]=h[1]*c;let p=s.projectFlat(a);i=[Math.floor(p[0]/r[0])*r[0],Math.floor(p[1]/r[1])*r[1]],a=s.unprojectFlat(i);let x=s.constructor;s=s.isGeospatial?new x({longitude:a[0],latitude:a[1],zoom:12}):new sl({position:[a[0],a[1],0],zoom:12}),i=[Math.fround(s.center[0]),Math.fround(s.center[1])],n=k0({dataBounds:e,getBinId:T=>{let R=s.projectFlat(T);return[Math.floor((R[0]-i[0])/r[0]),Math.floor((R[1]-i[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:i,binIdRange:n,aggregatorViewport:s})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){let r=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){let n=i.getResult(0);this.setState({colors:new Ld(n,i.binCount)}),r.onSetColorDomain(i.getResultDomain(0))}else if(e===1){let n=i.getResult(1);this.setState({elevations:new Ld(n,i.binCount)}),r.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:i,cellOriginCommon:n,binIdRange:s}=this.state;r.setProps({binIdRange:s,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:e,cellOriginCommon:r,cellSizeCommon:i}=this.state,{elevationScale:n,colorRange:s,elevationRange:a,extruded:c,coverage:h,material:p,transitions:x,colorScaleType:T,lowerPercentile:R,upperPercentile:k,colorDomain:j,elevationScaleType:q,elevationLowerPercentile:X,elevationUpperPercentile:re,elevationDomain:te}=this.props,oe=this.getSubLayerClass("cells",mx),ae=e.getBins(),pe=this.state.colors?.update({scaleType:T,lowerPercentile:R,upperPercentile:k}),be=this.state.elevations?.update({scaleType:q,lowerPercentile:X,upperPercentile:re});return!pe||!be?null:new oe(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:ae,getColorValue:pe.attribute,getElevationValue:be.attribute}},dataComparator:(Fe,Y)=>Fe.length===Y.length,updateTriggers:{getBin:[ae],getColorValue:[pe.attribute],getElevationValue:[be.attribute]},cellOriginCommon:r,cellSizeCommon:i,elevationScale:n,colorRange:s,colorScaleType:T,elevationRange:a,extruded:c,coverage:h,material:p,colorDomain:pe.domain||j||e.getResultDomain(0),elevationDomain:be.domain||te||e.getResultDomain(1),colorCutoff:pe.cutoff,elevationCutoff:be.cutoff,transitions:x&&{getFillColor:x.getColorValue||x.getColorWeight,getElevation:x.getElevationValue||x.getElevationWeight},extensions:[]})}getPickingInfo(e){let r=e.info,{index:i}=r;if(i>=0){let n=this.state.aggregator.getBin(i),s;n&&(s={col:n.id[0],row:n.id[1],colorValue:n.value[0],elevationValue:n.value[1],count:n.count},n.pointIndices&&(s.pointIndices=n.pointIndices,s.points=Array.isArray(this.props.data)?n.pointIndices.map(a=>this.props.data[a]):[])),r.object=s}return r}};gx.layerName="GridLayer";gx.defaultProps=nce;var kz=gx;function zz(t){let e=t.map(c=>c[0]),r=t.map(c=>c[1]),i=Math.min.apply(null,e),n=Math.max.apply(null,e),s=Math.min.apply(null,r),a=Math.max.apply(null,r);return[i,s,n,a]}function Uz(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}var Nz=new Float32Array(12);function I4(t,e=2){let r=0;for(let i of t)for(let n=0;n<e;n++)Nz[r++]=i[n]||0;return Nz}function Vz(t,e,r){let[i,n,s,a]=t,c=s-i,h=a-n,p=c,x=h;c/h<e/r?p=e/r*h:x=r/e*c,p<e&&(p=e,x=r);let T=(s+i)/2,R=(a+n)/2;return[T-p/2,R-x/2,T+p/2,R+x/2]}function jz(t,e){let[r,i,n,s]=e;return[(t[0]-r)/(n-r),(t[1]-i)/(s-i)]}var Gz=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`;var Hz=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`;var Wz=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,$z={name:"triangle",vs:Wz,fs:Wz,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};var T3=class extends ln{getShaders(){return super.getShaders({vs:Gz,fs:Hz,modules:[Li,$z]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){let{vertexCount:r,data:i}=this.props;return new di(e,{...this.getShaders(),id:this.props.id,attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:r})}draw(){let{model:e}=this.state,{aggregationMode:r,colorDomain:i,intensity:n,threshold:s,colorTexture:a,maxTexture:c,weightsTexture:h}=this.props,p={aggregationMode:r,colorDomain:i,intensity:n,threshold:s,colorTexture:a,maxTexture:c,weightsTexture:h};e.shaderInputs.setProps({triangle:p}),e.draw(this.context.renderPass)}};T3.layerName="TriangleLayer";var qz=T3;function Zz(t,e){let r={};for(let i in t)e.includes(i)||(r[i]=t[i]);return r}var E3=class extends ss{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:Zz(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);let{changeFlags:r}=e;if(r.extensionsChanged){let i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){let{viewport:e,mousePosition:r,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:r,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,r={}){let{props:i,oldProps:n,changeFlags:s}=e,{compareAll:a=!1,dimension:c}=r,{ignoreProps:h}=this.state,{props:p,accessors:x=[]}=c,{updateTriggersChanged:T}=s;if(s.dataChanged)return!0;if(T){if(T.all)return!0;for(let R of x)if(T[R])return!0}if(a)return s.extensionsChanged?!0:Ay({oldProps:n,newProps:i,ignoreProps:h,propTypes:this.constructor._propTypes});for(let R of p)if(i[R]!==n[R])return!0;return!1}isAttributeChanged(e){let{changedAttributes:r}=this.state;return e?r&&r[e]!==void 0:!sce(r)}_getAttributeManager(){return new Fl(this.context.device,{id:this.props.id,stats:this.context.stats})}};E3.layerName="AggregationLayer";var Xz=E3;function sce(t){let e=!0;for(let r in t){e=!1;break}return e}var M4=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`;var P4=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Yz=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`;var Kz=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`;var oce=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,Qz={name:"weight",vs:oce,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},Jz={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}};var ace=2,R4={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},eU=[0,0],lce={SUM:0,MEAN:1},cce={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Bd,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},uce=["float32-renderable-webgl","texture-blend-float-webgl"],hce={data:{props:["radiusPixels"]}},_x=class extends Xz{getShaders(e){let r=[Li];return e.modules&&(r=[...r,...e.modules]),super.getShaders({...e,modules:r})}initializeState(){super.initializeAggregationLayer(hce),this.setState({colorDomain:eU}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){let{props:r,oldProps:i}=e,n=this._getChangeFlags(e);(n.dataChanged||n.viewportChanged)&&(n.boundsChanged=this._updateBounds(n.dataChanged),this._updateTextureRenderingBounds()),n.dataChanged||n.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):n.viewportZoomChanged&&this._debouncedUpdateWeightmap(),r.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){let{weightsTexture:e,triPositionBuffer:r,triTexCoordBuffer:i,maxWeightsTexture:n,colorTexture:s,colorDomain:a}=this.state,{updateTriggers:c,intensity:h,threshold:p,aggregation:x}=this.props,T=this.getSubLayerClass("triangle",qz);return new T(this.getSubLayerProps({id:"triangle-layer",updateTriggers:c}),{coordinateSystem:Tr.DEFAULT,data:{attributes:{positions:r,texCoords:i}},vertexCount:4,maxTexture:n,colorTexture:s,aggregationMode:lce[x]||0,weightsTexture:e,intensity:h,threshold:p,colorDomain:a})}finalizeState(e){super.finalizeState(e);let{weightsTransform:r,weightsTexture:i,maxWeightTransform:n,maxWeightsTexture:s,triPositionBuffer:a,triTexCoordBuffer:c,colorTexture:h,updateTimer:p}=this.state;r?.destroy(),i?.destroy(),n?.destroy(),s?.destroy(),a?.destroy(),c?.destroy(),h?.destroy(),p&&clearTimeout(p)}_getAttributeManager(){return new Fl(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){let r={},{dimensions:i}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",r.viewportChanged=e.changeFlags.viewportChanged;let{zoom:n}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==n)&&(r.viewportZoomChanged=!0),r}_createTextures(){let{textureSize:e,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...R4,width:e,height:e,format:r}),maxWeightsTexture:this.context.device.createTexture({...R4,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){let{device:e}=this.context,{weightsTextureSize:r}=this.props,i=Math.min(r,e.limits.maxTextureDimension2D),n=uce.every(c=>e.features.has(c)),s=n?"rgba32float":"rgba8unorm",a=n?1:1/255;this.setState({textureSize:i,format:s,weightsScale:a}),n||ur.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:r}=this.state,{weightsTexture:i}=this.state,n=this.getAttributeManager();r?.destroy(),r=new A0(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:n.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,Qz]}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();let{device:e}=this.context,{textureSize:r,weightsTexture:i,maxWeightsTexture:n}=this.state,s=this.getShaders({vs:M4,fs:P4});this._createWeightsTransform(s);let a=this.getShaders({vs:Yz,fs:Kz,modules:[Jz]}),c=new A0(e,{id:`${this.id}-max-weights-transform`,targetTexture:n,...a,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),h={inTexture:i,textureSize:r};c.model.shaderInputs.setProps({maxWeight:h}),this.setState({weightsTexture:i,maxWeightsTexture:n,maxWeightTransform:c,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:M4,fs:P4,...e})}_updateMaxWeightValue(){let{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){let{viewport:r}=this.context,i=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([0,r.height]),r.unproject([r.width,r.height])].map(c=>c.map(Math.fround)),n=zz(i),s={visibleWorldBounds:n,viewportCorners:i},a=!1;if(e||!this.state.worldBounds||!Uz(this.state.worldBounds,n)){let c=this._worldToCommonBounds(n),h=this._commonToWorldBounds(c);this.props.coordinateSystem===Tr.LNGLAT&&(h[1]=Math.max(h[1],-85.051129),h[3]=Math.min(h[3],85.051129),h[0]=Math.max(h[0],-360),h[2]=Math.min(h[2],360));let p=this._worldToCommonBounds(h);s.worldBounds=h,s.normalizedCommonBounds=p,a=!0}return this.setState(s),a}_updateTextureRenderingBounds(){let{triPositionBuffer:e,triTexCoordBuffer:r,normalizedCommonBounds:i,viewportCorners:n}=this.state,{viewport:s}=this.context;e.write(I4(n,3));let a=n.map(c=>jz(s.projectPosition(c),i));r.write(I4(a,2))}_updateColorTexture(e){let{colorRange:r}=e.props,{colorTexture:i}=this.state,n=C4(r,!1,Uint8Array);i&&i?.width===r.length?i.setTexture2DData({data:n}):(i?.destroy(),i=this.context.device.createTexture({...R4,data:n,width:r.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){let{radiusPixels:e,colorDomain:r,aggregation:i}=this.props,{worldBounds:n,textureSize:s,weightsScale:a,weightsTexture:c}=this.state,h=this.state.weightsTransform;this.state.isWeightMapDirty=!1;let p=this._worldToCommonBounds(n,{useLayerCoordinateSystem:!0});if(r&&i==="SUM"){let{viewport:oe}=this.context,ae=oe.distanceScales.metersPerUnit[2]*(p[2]-p[0])/s;this.state.colorDomain=r.map(pe=>pe*ae*a)}else this.state.colorDomain=r||eU;let T=this.getAttributeManager().getAttributes(),R=this.getModuleSettings();this._setModelAttributes(h.model,T),h.model.setVertexCount(this.getNumInstances());let k={radiusPixels:e,commonBounds:p,textureWidth:s,weightsScale:a,weightsTexture:c},{viewport:j,devicePixelRatio:q,coordinateSystem:X,coordinateOrigin:re}=R,{modelMatrix:te}=this.props;h.model.shaderInputs.setProps({project:{viewport:j,devicePixelRatio:q,modelMatrix:te,coordinateSystem:X,coordinateOrigin:re},weight:k}),h.run({parameters:{viewport:[0,0,s,s]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:r}=this.state,{debounceTimeout:i}=this.props;e?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:r})}_worldToCommonBounds(e,r={}){let{useLayerCoordinateSystem:i=!1}=r,[n,s,a,c]=e,{viewport:h}=this.context,{textureSize:p}=this.state,{coordinateSystem:x}=this.props,T=i&&(x===Tr.LNGLAT_OFFSETS||x===Tr.METER_OFFSETS),R=T?h.projectPosition(this.props.coordinateOrigin):[0,0],k=p*ace/h.scale,j,q;return i&&!T?(j=this.projectPosition([n,s,0]),q=this.projectPosition([a,c,0])):(j=h.projectPosition([n,s,0]),q=h.projectPosition([a,c,0])),Vz([j[0]-R[0],j[1]-R[1],q[0]-R[0],q[1]-R[1]],k,k)}_commonToWorldBounds(e){let[r,i,n,s]=e,{viewport:a}=this.context,c=a.unprojectPosition([r,i]),h=a.unprojectPosition([n,s]);return c.slice(0,2).concat(h.slice(0,2))}};_x.layerName="HeatmapLayer";_x.defaultProps=cce;var tU=_x;function fce(t){return typeof t=="string"?t.charAt(0).toLowerCase()+t.slice(1):t}function C3(t){if(Array.isArray(t))return t.map(e=>C3(e));if(t&&typeof t=="object"){let e={};for(let[r,i]of Object.entries(t))e[fce(r)]=C3(i);return e}return t}var DU=_l(OU(),1);function V4(t,e){if(e?._parser&&e._parser!=="fast-xml-parser")throw new Error(e?._parser);let r={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:e?.removeNSPrefix,textNodeName:e?.textNodeName,isArray:(n,s,a,c)=>!!e?.arrayPaths?.some(p=>s===p),...e?._fastXML},i=Eue(t,r);return e?.uncapitalizeKeys?C3(i):i}function Eue(t,e){return new DU.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(t)}var Cue="4.3.2",kc={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Cue,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:Sue,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(t,e)=>V4(new TextDecoder().decode(t),{...kc.options.xml,...e?.xml}),parseTextSync:(t,e)=>V4(t,{...kc.options.xml,...e?.xml})};function Sue(t){return t.startsWith("<?xml")}function FU(t,e){let r=kc.parseTextSync?.(t,e),i=r?.ServiceExceptionReport?.ServiceException||r?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof i=="string"?i:i.value||i.code||"Unknown error"}var Iue="4.3.2",bx={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:Iue,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:Mue,options:{wms:{throwOnError:!1}},parse:async(t,e)=>j4(new TextDecoder().decode(t),e),parseSync:(t,e)=>j4(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>j4(t,e)};function Mue(t){return t.startsWith("<?xml")}function j4(t,e){let r={...bx.options.wms,...e?.wms},i=FU(t,r),n=r.minimalErrors?i:`WMS Service error: ${i}`;if(r.throwOnError)throw new Error(n);return n}function xA(t){return Array.isArray(t)?t:t?[t]:[]}function vx(t){let e=xA(t);return e.length>0&&e.every(r=>typeof r=="string")?e:[]}function wx(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseFloat(t);default:return}}function I3(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseInt(t,10);default:return}}function bA(t){switch(t){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function G4(t,e){let r=kc.parseTextSync?.(t,e),i=r.WMT_MS_Capabilities||r.WMS_Capabilities||r,n=Pue(i);if(e?.inheritedLayerProps)for(let s of n.layers)NU(s,null);return e?.includeRawJSON&&(n.json=i),e?.includeXMLText&&(n.xml=t),n}function Pue(t){let e={version:String(t.version||""),name:String(t.Service?.Name||"unnamed"),title:t.Service?.Title?String(t.Service?.Title):void 0,abstract:t.Service?.Abstract?String(t.Service?.Abstract):void 0,keywords:vx(t.Service?.KeywordList?.Keyword),fees:t.Service?.Fees?JSON.stringify(t.Service?.Fees):void 0,accessConstraints:t.Service?.AccessConstraints?JSON.stringify(t.Service?.AccessConstraints):void 0,layerLimit:I3(t.Service?.LayerLimit),maxWidth:I3(t.Service?.maxWidth),maxHeight:I3(t.Service?.maxHeight),layers:[],requests:Rue(t.Capability?.Request),exceptions:Bue(t.Exception)},r=xA(t.Capability?.Layer);for(let i of r)e.layers.push(kU(i));for(let[i,n]of Object.entries(e))n===void 0&&delete e[i];return e}function Rue(t){let e={};for(let[r,i]of Object.entries(t||{})){let n=vx(i?.Format);e[r]={mimeTypes:n}}return e}function Bue(t){if(xA(t?.Format).length>0)return{mimeTypes:vx(t)}}function kU(t){let e={title:String(t?.Title||""),name:t?.Name&&String(t?.Name),abstract:t?.Name&&String(t?.Abstract),keywords:vx(t.KeywordList?.Keyword)},r=t?.CRS||t?.SRS;r&&Array.isArray(r)&&r.every(p=>typeof p=="string")&&(e.crs=r);let i=t?.EX_GeographicBoundingBox&&Lue(t?.EX_GeographicBoundingBox);i&&(e.geographicBoundingBox=i),i=t?.LatLonBoundingBox&&Oue(t?.LatLonBoundingBox),i&&(e.geographicBoundingBox=i);let n=t?.BoundingBox&&Due(t?.BoundingBox);n&&n.length>0&&(e.boundingBoxes=n);let a=xA(t?.Dimension).map(p=>kue(p));a.length&&(e.dimensions=a),t?.opaque&&(e.opaque=bA(t?.opaque)),t?.cascaded&&(e.cascaded=bA(t?.cascaded)),t?.queryable&&(e.queryable=bA(t?.queryable));let c=xA(t?.Layer),h=[];for(let p of c)h.push(kU(p));h.length>0&&(e.layers=h);for(let[p,x]of Object.entries(e))x===void 0&&delete e[p];return e}function Lue(t){let{westBoundLongitude:e,northBoundLatitude:r,eastBoundLongitude:i,southBoundLatitude:n}=t;return[[e,n],[i,r]]}function Oue(t){let{minx:e,miny:r,maxx:i,maxy:n}=t;return[[e,r],[i,n]]}function Due(t){return xA(t).map(r=>Fue(r))}function Fue(t){let{CRS:e,SRS:r,minx:i,miny:n,maxx:s,maxy:a,resx:c,resy:h}=t,p={crs:e||r,boundingBox:[[wx(i),wx(n)],[wx(s),wx(a)]]};return c&&(p.xResolution=c),h&&(p.yResolution=h),p}function kue(t){let{name:e,units:r,value:i}=t,n={name:e,units:r,extent:i};return t.unitSymbol&&(n.unitSymbol=t.unitSymbol),t.default&&(n.defaultValue=t.default),t.multipleValues&&(n.multipleValues=bA(t.multipleValues)),t.nearestValue&&(n.nearestValue=bA(t.nearestValue)),t.current&&(n.current=bA(t.current)),n}function NU(t,e){e?.geographicBoundingBox&&!t.geographicBoundingBox&&(t.geographicBoundingBox=[...e.geographicBoundingBox]),e?.crs&&!t.crs&&(t.crs=[...e.crs]),e?.boundingBoxes&&!t.boundingBoxes&&(t.boundingBoxes=[...e.boundingBoxes]),e?.dimensions&&!t.dimensions&&(t.dimensions=[...e.dimensions]);for(let r of t.layers||[])NU(r,t)}var Nue="4.3.2",Z0={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:Nue,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:zue,options:{wms:{}},parse:async(t,e)=>G4(new TextDecoder().decode(t),e?.wms),parseTextSync:(t,e)=>G4(t,e?.wms)};function zue(t){return t.startsWith("<?xml")}function H4(t,e){let i=(kc.parseTextSync?.(t,e)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(i)?i:[i]).map(s=>Uue(s))}}function Uue(t){return{attributes:t||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}var zU={...Z0,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(t,e)=>H4(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>H4(t,e)};function W4(t,e){return kc.parseTextSync?.(t,e)}var UU={...Z0,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(t,e)=>W4(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>W4(t,e)};var VU={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:t=>t.toLowerCase().includes("wms"),createDataSource:(t,e)=>new $4(t,e)},$4=class extends Eu{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(e,r){super(r),this.url=e,this.data=e,this.substituteCRS84=r.wms?.substituteCRS84??r.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...r.wmsParameters,...r.wms?.wmsParameters},this.vendorParameters=r.wms?.vendorParameters||r.vendorParameters||{}}async getMetadata(){let e=await this.getCapabilities();return this.normalizeMetadata(e)}async getImage(e){let{boundingBox:r,bbox:i,...n}=e,s={bbox:r?[...r[0],...r[1]]:i,...n};return await this.getMap(s)}normalizeMetadata(e){return e}async getCapabilities(e,r){let i=this.getCapabilitiesURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();this._checkResponse(n,s);let a=await Z0.parse(s,this.loadOptions);return this.capabilities=a,a}async getMap(e,r){let i=this.getMapURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();this._checkResponse(n,s);try{return await ad.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}async getFeatureInfo(e,r){let i=this.getFeatureInfoURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();return this._checkResponse(n,s),await zU.parse(s,this.loadOptions)}async getFeatureInfoText(e,r){let i=this.getFeatureInfoURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();return this._checkResponse(n,s),new TextDecoder().decode(s)}async describeLayer(e,r){let i=this.describeLayerURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();return this._checkResponse(n,s),await UU.parse(s,this.loadOptions)}async getLegendGraphic(e,r){let i=this.getLegendGraphicURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();this._checkResponse(n,s);try{return await ad.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}getCapabilitiesURL(e,r){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetCapabilities",i,r)}getMapURL(e,r){e=this._getWMS130Parameters(e);let i={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetMap",i,r)}getFeatureInfoURL(e,r){e=this._getWMS130Parameters(e);let{boundingBox:i,bbox:n}=e;e.bbox=i?[...i[0],...i[1]]:n;let s={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetFeatureInfo",s,r)}describeLayerURL(e,r){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("DescribeLayer",i,r)}getLegendGraphicURL(e,r){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetLegendGraphic",i,r)}_parseWMSUrl(e){let[r,i]=e.split("?"),n=i.split("&"),s={};for(let a of n){let[c,h]=a.split("=");s[c]=h}return{url:r,parameters:s}}_getWMSUrl(e,r,i){let n=this.url,s=!0,a={service:"WMS",version:r.version,request:e,...r,...this.vendorParameters,...i},c=["transparent","time","elevation"];for(let[h,p]of Object.entries(a))(!c.includes(h)||p)&&(n+=s?"?":"&",s=!1,n+=this._getURLParameter(h,p,r));return encodeURI(n)}_getWMS130Parameters(e){let r={...e};return r.srs&&(r.crs=r.crs||r.srs,delete r.srs),r}_getURLParameter(e,r,i){switch(e){case"crs":i.version!=="1.3.0"?e="srs":this.substituteCRS84&&r==="EPSG:4326"&&(r="CRS:84");break;case"srs":i.version==="1.3.0"&&(e="crs");break;case"bbox":let n=this._flipBoundingBox(r,i);n&&(r=n);break;case"x":i.version==="1.3.0"&&(e="i");break;case"y":i.version==="1.3.0"&&(e="j");break;default:}return e=e.toUpperCase(),Array.isArray(r)?`${e}=${r.join(",")}`:`${e}=${r?String(r):""}`}_flipBoundingBox(e,r){if(!Array.isArray(e)||e.length!==4)return null;let i=r.version==="1.3.0"&&this.flipCRS.includes(r.crs||"")&&!(this.substituteCRS84&&r.crs==="EPSG:4326"),n=e;return i?[n[1],n[0],n[3],n[2]]:n}async _fetchArrayBuffer(e){let r=await this.fetch(e),i=await r.arrayBuffer();return this._checkResponse(r,i),i}_checkResponse(e,r){let i=e.headers["content-type"];if(!e.ok||bx.mimeTypes.includes(i)){let n=M_(this.loadOptions,{wms:{throwOnError:!0}}),s=bx.parseSync?.(r,n);throw new Error(s)}}_parseError(e){let r=bx.parseSync?.(e,this.loadOptions);return new Error(r)}};var jU={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:t=>t.toLowerCase().includes("ImageServer"),createDataSource:(t,e)=>new q4(t,e)},q4=class extends Eu{url;data;constructor(e,r){super(r),this.url=e,this.data=e}async getMetadata(){return await this.metadata()}async getImage(e){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(e){throw new Error("not implemented")}metadataURL(e){return`${this.url}?f=pjson`}exportImageURL(e){let r=`bbox=${e.bbox[0]},${e.bbox[1]},${e.bbox[2]},${e.bbox[3]}`,i=`size=${e.width},${e.height}`,n={...e,bbox:r,size:i};return delete n.width,delete n.height,this.getUrl("exportImage",n)}getUrl(e,r,i){let n=`${this.url}/${e}`,s=!0;for(let[a,c]of Object.entries(r))n+=s?"?":"&",s=!1,Array.isArray(c)?n+=`${a.toUpperCase()}=${c.join(",")}`:n+=`${a.toUpperCase()}=${c?String(c):""}`;return n}async checkResponse(e){if(!e.ok)throw new Error("error")}};var Vue=[VU,jU];function Z4(t,e=Vue){let{type:r="auto"}=t,i=r==="auto"?Gue(t.url,e):jue(r,e);if(!i)throw new Error("Not a valid image source type");return i.createDataSource(t.url,t)}function jue(t,e){for(let r of e)if(r.type===t)return r;return null}function Gue(t,e){for(let r of e)if(r.testURL&&r.testURL(t))return r;return null}var GU=6378137*Math.PI;function X4(t){let e=io(t);return e[0]=(e[0]/256-1)*GU,e[1]=(e[1]/256-1)*GU,e}var Hue={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(t,e)=>console.error(e,t)}},X0=class extends ss{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:r,oldProps:i}){let{viewport:n}=this.context;e.dataChanged||r.serviceType!==i.serviceType?(this.state.imageSource=this._createImageSource(r),this._loadMetadata(),this.debounce(()=>this.loadImage(n,"image source changed"),0)):An(r.layers,i.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(n,"viewport changed")):this.debounce(()=>this.loadImage(n,"layers changed"),0)}finalizeState(){}renderLayers(){let{bounds:e,image:r,lastRequestParameters:i}=this.state;return r&&new Nw({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:i.srs==="EPSG:4326"?Tr.LNGLAT:Tr.CARTESIAN,bounds:e,image:r})}async getFeatureInfoText(e,r){let{lastRequestParameters:i}=this.state;return i?await this.state.imageSource.getFeatureInfoText?.({...i,query_layers:i.layers,x:e,y:r,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(e){if(e.data instanceof Eu)return e.data;if(typeof e.data=="string")return Z4({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){let{imageSource:e}=this.state;try{this.state.loadCounter++;let r=await e.getMetadata();this.state.imageSource===e&&this.getCurrentLayer()?.props.onMetadataLoad(r)}catch(r){this.getCurrentLayer()?.props.onMetadataLoadError(r)}finally{this.state.loadCounter--}}async loadImage(e,r){let{layers:i,serviceType:n}=this.props;if(n==="wms"&&i.length===0)return;let s=e.getBounds(),{width:a,height:c}=e,h=this.getRequestId(),{srs:p}=this.props;p==="auto"&&(p=e.resolution?"EPSG:4326":"EPSG:3857");let x={width:a,height:c,boundingBox:[[s[0],s[1]],[s[2],s[3]]],layers:i,crs:p};if(p==="EPSG:3857"){let T=X4([s[0],s[1]]),R=X4([s[2],s[3]]);x.boundingBox=[T,R]}try{this.state.loadCounter++,this.props.onImageLoadStart(h);let T=await this.state.imageSource.getImage(x);this.state.lastRequestId<h&&(this.getCurrentLayer()?.props.onImageLoad(h),this.setState({image:T,bounds:s,lastRequestParameters:x,lastRequestId:h}))}catch(T){this.raiseError(T,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(h,T)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,r=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),r)}};X0.layerName="WMSLayer";X0.defaultProps=Hue;var Wue={getHeight:{type:"accessor",value:0},greatCircle:!0},Tx=class extends kw{};Tx.layerName="GreatCircleLayer";Tx.defaultProps=Wue;var HU=Tx;var $ue={...Rd.defaultProps},Ex=class extends ss{indexToBounds(){return null}renderLayers(){let{elevationScale:e,extruded:r,wireframe:i,filled:n,stroked:s,lineWidthUnits:a,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:p,lineJointRounded:x,lineMiterLimit:T,lineDashJustified:R,getElevation:k,getFillColor:j,getLineColor:q,getLineWidth:X}=this.props,{updateTriggers:re,material:te,transitions:oe}=this.props,ae=this.getSubLayerClass("cell",Rd),{updateTriggers:pe,...be}=this.indexToBounds()||{};return new ae({filled:n,wireframe:i,extruded:r,elevationScale:e,stroked:s,lineWidthUnits:a,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:p,lineJointRounded:x,lineMiterLimit:T,lineDashJustified:R,material:te,transitions:oe,getElevation:k,getFillColor:j,getLineColor:q,getLineWidth:X},this.getSubLayerProps({id:"cell",updateTriggers:re&&{...pe,getElevation:re.getElevation,getFillColor:re.getFillColor,getLineColor:re.getLineColor,getLineWidth:re.getLineWidth}}),be)}};Ex.layerName="GeoCellLayer";Ex.defaultProps=$ue;var Zu=Ex;var M3=_l(Y4(),1),que=3,Zue=30,Xue=2*Zue+1,$U=180/Math.PI;function ZU(t,e,r){let i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function qU(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function XU(t){return[qU(t[0]),qU(t[1])]}function YU(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function KU([t,e,r]){let i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*$U,i*$U]}function QU(t){let e=M3.default.fromString(t,!0,10).toString(2);for(;e.length<que+Xue;)e="0"+e;let r=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,r),s=n.length/2,a=M3.default.fromString(i,!0,2).toString(10),c=M3.default.fromString(n,!0,2).toString(4);for(;c.length<s;)c="0"+c;return`${a}/${c}`}function Yue(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}function JU(t){let e=t.split("/"),r=parseInt(e[0],10),i=e[1],n=i.length,s=[0,0],a;for(let c=n-1;c>=0;c--){a=n-c;let h=i[c],p=0,x=0;h==="1"?x=1:h==="2"?(p=1,x=1):h==="3"&&(p=1);let T=Math.pow(2,a-1);Yue(T,s,p,x),s[0]+=T*p,s[1]+=T*x}if(r%2===1){let c=s[0];s[0]=s[1],s[1]=c}return{face:r,ij:s,level:a}}var eV=_l(Y4(),1);function Kue(t){let e=t.padEnd(16,"0");return eV.default.fromString(e,16)}var Que=100;function Jue({face:t,ij:e,level:r}){let i=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(Que*Math.pow(2,-r))),s=new Float64Array(4*n*2+2),a=0,c=0;for(let h=0;h<4;h++){let p=i[h].slice(0),x=i[h+1],T=(x[0]-p[0])/n,R=(x[1]-p[1])/n;for(let k=0;k<n;k++){p[0]+=T,p[1]+=R;let j=ZU(e,r,p),q=XU(j),X=YU(t,q),re=KU(X);Math.abs(re[1])>89.999&&(re[0]=c);let te=re[0]-c;re[0]+=te>180?-360:te<-180?360:0,s[a++]=re[0],s[a++]=re[1],c=re[0]}}return s[a++]=s[0],s[a++]=s[1],s}function ehe(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=Kue(t)}return QU(t.toString())}function tV(t){let e=ehe(t),r=JU(e);return Jue(r)}var the={getS2Token:{type:"accessor",value:t=>t.token}},Sx=class extends Zu{indexToBounds(){let{data:e,getS2Token:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>tV(r(i,n))}}};Sx.layerName="S2Layer";Sx.defaultProps=the;var rV=Sx;var K4=512;function rhe(t,e){let r=0,i=0,n=1<<t.length,s=n/K4;for(let a=0;a<t.length;a++){n>>=1;let c=parseInt(t[a]);c%2&&(r|=n),c>1&&(i|=n)}return[[r/s,K4-i/s],[(r+e)/s,K4-(i+e)/s]]}function iV(t,e=1){let[r,i]=rhe(t,e),[n,s]=$o(r),[a,c]=$o(i);return[a,s,a,c,n,c,n,s,a,s]}var ihe={getQuadkey:{type:"accessor",value:t=>t.quadkey}},Ix=class extends Zu{indexToBounds(){let{data:e,extruded:r,getQuadkey:i}=this.props,n=r?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(s,a)=>iV(i(s,a),n),updateTriggers:{getPolygon:n}}}};Ix.layerName="QuadkeyLayer";Ix.defaultProps=ihe;var nV=Ix;var vA=class{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:r,onLoad:i,onError:n}){let{index:s,id:a,bbox:c,userData:h,zoom:p}=this,x=this._loaderId;this._abortController=new AbortController;let{signal:T}=this._abortController,R=await r.scheduleRequest(this,q=>q.isSelected?1:-1);if(!R){this._isCancelled=!0;return}if(this._isCancelled){R.done();return}let k=null,j;try{k=await e({index:s,id:a,bbox:c,userData:h,zoom:p,signal:T})}catch(q){j=q||!0}finally{R.done()}if(x===this._loaderId){if(this._loader=void 0,this.content=k,this._isCancelled&&!k){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,j?n(j,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}};var Ls={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};var sV=new st,nhe=new st,Y0=class t{constructor(e=[0,0,0],r=[0,0,0],i){i=i||sV.copy(e).add(r).scale(.5),this.center=new st(i),this.halfDiagonal=new st(r).subtract(this.center),this.minimum=new st(e),this.maximum=new st(r)}clone(){return new t(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){let{halfDiagonal:r}=this,i=nhe.from(e.normal),n=r.x*Math.abs(i.x)+r.y*Math.abs(i.y)+r.z*Math.abs(i.z),s=this.center.dot(i)+e.distance;return s-n>0?Ls.INSIDE:s+n<0?Ls.OUTSIDE:Ls.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let r=sV.from(e).subtract(this.center),{halfDiagonal:i}=this,n=0,s;return s=Math.abs(r.x)-i.x,s>0&&(n+=s*s),s=Math.abs(r.y)-i.y,s>0&&(n+=s*s),s=Math.abs(r.z)-i.z,s>0&&(n+=s*s),n}};var Mx=new st,oV=new st,Xu=class t{constructor(e=[0,0,0],r=0){this.radius=-0,this.center=new st,this.fromCenterRadius(e,r)}fromCenterRadius(e,r){return this.center.from(e),this.radius=r,this}fromCornerPoints(e,r){return r=Mx.from(r),this.center=new st().from(e).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new t(this.center,this.radius)}union(e){let r=this.center,i=this.radius,n=e.center,s=e.radius,a=Mx.copy(n).subtract(r),c=a.magnitude();if(i>=c+s)return this.clone();if(s>=c+i)return e.clone();let h=(i+c+s)*.5;return oV.copy(a).scale((-i+h)/c).add(r),this.center.copy(oV),this.radius=h,this}expand(e){let i=Mx.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);let r=Ms.getScaling(Mx,e);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(e){let r=this.distanceTo(e);return r*r}distanceTo(e){let i=Mx.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){let r=this.center,i=this.radius,s=e.normal.dot(r)+e.distance;return s<-i?Ls.OUTSIDE:s<i?Ls.INTERSECTING:Ls.INSIDE}};var she=new st,ohe=new st,P3=new st,R3=new st,B3=new st,ahe=new st,lhe=new st,Kh={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},Qh=class t{constructor(e=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new st().from(e),this.halfAxes=new an(r)}get halfSize(){let e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new st(e).len(),new st(r).len(),new st(i).len()]}get quaternion(){let e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new st(e).normalize(),s=new st(r).normalize(),a=new st(i).normalize();return new Rl().fromMatrix3(new an([...n,...s,...a]))}fromCenterHalfSizeQuaternion(e,r,i){let n=new Rl(i),s=new an().fromQuaternion(n);return s[0]=s[0]*r[0],s[1]=s[1]*r[0],s[2]=s[2]*r[0],s[3]=s[3]*r[1],s[4]=s[4]*r[1],s[5]=s[5]*r[1],s[6]=s[6]*r[2],s[7]=s[7]*r[2],s[8]=s[8]*r[2],this.center=new st().from(e),this.halfAxes=s,this}clone(){return new t(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Xu){let r=this.halfAxes,i=r.getColumn(0,P3),n=r.getColumn(1,R3),s=r.getColumn(2,B3),a=she.copy(i).add(n).add(s);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){let r=this.center,i=e.normal,n=this.halfAxes,s=i.x,a=i.y,c=i.z,h=Math.abs(s*n[Kh.COLUMN0ROW0]+a*n[Kh.COLUMN0ROW1]+c*n[Kh.COLUMN0ROW2])+Math.abs(s*n[Kh.COLUMN1ROW0]+a*n[Kh.COLUMN1ROW1]+c*n[Kh.COLUMN1ROW2])+Math.abs(s*n[Kh.COLUMN2ROW0]+a*n[Kh.COLUMN2ROW1]+c*n[Kh.COLUMN2ROW2]),p=i.dot(r)+e.distance;return p<=-h?Ls.OUTSIDE:p>=h?Ls.INSIDE:Ls.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let r=ohe.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,P3),s=i.getColumn(1,R3),a=i.getColumn(2,B3),c=n.magnitude(),h=s.magnitude(),p=a.magnitude();n.normalize(),s.normalize(),a.normalize();let x=0,T;return T=Math.abs(r.dot(n))-c,T>0&&(x+=T*T),T=Math.abs(r.dot(s))-h,T>0&&(x+=T*T),T=Math.abs(r.dot(a))-p,T>0&&(x+=T*T),x}computePlaneDistances(e,r,i=[-0,-0]){let n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,a=this.center,c=this.halfAxes,h=c.getColumn(0,P3),p=c.getColumn(1,R3),x=c.getColumn(2,B3),T=ahe.copy(h).add(p).add(x).add(a),R=lhe.copy(T).subtract(e),k=r.dot(R);return n=Math.min(k,n),s=Math.max(k,s),T.copy(a).add(h).add(p).subtract(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),s=Math.max(k,s),T.copy(a).add(h).subtract(p).add(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),s=Math.max(k,s),T.copy(a).add(h).subtract(p).subtract(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),s=Math.max(k,s),a.copy(T).subtract(h).add(p).add(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),s=Math.max(k,s),a.copy(T).subtract(h).add(p).subtract(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),s=Math.max(k,s),a.copy(T).subtract(h).subtract(p).add(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),s=Math.max(k,s),a.copy(T).subtract(h).subtract(p).subtract(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),s=Math.max(k,s),i[0]=n,i[1]=s,i}transform(e){this.center.transformAsPoint(e);let r=this.halfAxes.getColumn(0,P3);r.transformAsPoint(e);let i=this.halfAxes.getColumn(1,R3);i.transformAsPoint(e);let n=this.halfAxes.getColumn(2,B3);return n.transformAsPoint(e),this.halfAxes=new an([...r,...i,...n]),this}getTransform(){throw new Error("not implemented")}};var aV=new st,lV=new st,qo=class t{constructor(e=[0,0,1],r=0){this.normal=new st,this.distance=-0,this.fromNormalDistance(e,r)}fromNormalDistance(e,r){return bo(Number.isFinite(r)),this.normal.from(e).normalize(),this.distance=r,this}fromPointNormal(e,r){e=aV.from(e),this.normal.from(r).normalize();let i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,r,i,n){return this.normal.set(e,r,i),bo(Hs(this.normal.len(),1)),this.distance=n,this}clone(){return new t(this.normal,this.distance)}equals(e){return Hs(this.distance,e.distance)&&Hs(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){let r=lV.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,r)}projectPointOntoPlane(e,r=[0,0,0]){let i=aV.from(e),n=this.getPointDistance(i),s=lV.copy(this.normal).scale(n);return i.subtract(s).to(r)}};var cV=[new st([1,0,0]),new st([0,1,0]),new st([0,0,1])],uV=new st,che=new st,ha=class t{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*cV.length;let r=e.center,i=e.radius,n=0;for(let s of cV){let a=this.planes[n],c=this.planes[n+1];a||(a=this.planes[n]=new qo),c||(c=this.planes[n+1]=new qo);let h=uV.copy(s).scale(-i).add(r);a.fromPointNormal(h,s);let p=uV.copy(s).scale(i).add(r),x=che.copy(s).negate();c.fromPointNormal(p,x),n+=2}return this}computeVisibility(e){let r=Ls.INSIDE;for(let i of this.planes)switch(e.intersectPlane(i)){case Ls.OUTSIDE:return Ls.OUTSIDE;case Ls.INTERSECTING:r=Ls.INTERSECTING;break;default:}return r}computeVisibilityWithPlaneMask(e,r){if(bo(Number.isFinite(r),"parentPlaneMask is required."),r===t.MASK_OUTSIDE||r===t.MASK_INSIDE)return r;let i=t.MASK_INSIDE,n=this.planes;for(let s=0;s<this.planes.length;++s){let a=s<31?1<<s:0;if(s<31&&!(r&a))continue;let c=n[s],h=e.intersectPlane(c);if(h===Ls.OUTSIDE)return t.MASK_OUTSIDE;h===Ls.INTERSECTING&&(i|=a)}return i}};ha.MASK_OUTSIDE=4294967295;ha.MASK_INSIDE=0;ha.MASK_INDETERMINATE=2147483647;var dHe=new st,pHe=new st,AHe=new st,mHe=new st,gHe=new st;var wHe=new st,THe=new st,EHe=new st,CHe=new st,SHe=new st,IHe=new st,MHe=new st,PHe=new st,RHe=new st,BHe=new st,LHe=new st,OHe=new st;var Yu=new an,hhe=new an,fhe=new an,L3=new an,hV=new an;function eP(t,e={}){let r=Cc.EPSILON20,i=10,n=0,s=0,a=hhe,c=fhe;a.identity(),c.copy(t);let h=r*dhe(c);for(;s<i&&phe(c)>h;)Ahe(c,L3),hV.copy(L3).transpose(),c.multiplyRight(L3),c.multiplyLeft(hV),a.multiplyRight(L3),++n>2&&(++s,n=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=c.toTarget(e.diagonal),e}function dhe(t){let e=0;for(let r=0;r<9;++r){let i=t[r];e+=i*i}return Math.sqrt(e)}var Q4=[1,0,0],J4=[2,2,1];function phe(t){let e=0;for(let r=0;r<3;++r){let i=t[Yu.getElementIndex(J4[r],Q4[r])];e+=2*i*i}return Math.sqrt(e)}function Ahe(t,e){let r=Cc.EPSILON15,i=0,n=1;for(let p=0;p<3;++p){let x=Math.abs(t[Yu.getElementIndex(J4[p],Q4[p])]);x>i&&(n=p,i=x)}let s=Q4[n],a=J4[n],c=1,h=0;if(Math.abs(t[Yu.getElementIndex(a,s)])>r){let p=t[Yu.getElementIndex(a,a)],x=t[Yu.getElementIndex(s,s)],T=t[Yu.getElementIndex(a,s)],R=(p-x)/2/T,k;R<0?k=-1/(-R+Math.sqrt(1+R*R)):k=1/(R+Math.sqrt(1+R*R)),c=1/Math.sqrt(1+k*k),h=k*c}return an.IDENTITY.to(e),e[Yu.getElementIndex(s,s)]=e[Yu.getElementIndex(a,a)]=c,e[Yu.getElementIndex(a,s)]=h,e[Yu.getElementIndex(s,a)]=-h,e}var Dd=new st,mhe=new st,ghe=new st,_he=new st,yhe=new st,xhe=new an,bhe={diagonal:new an,unitary:new an};function Px(t,e=new Qh){if(!t||t.length===0)return e.halfAxes=new an([0,0,0,0,0,0,0,0,0]),e.center=new st,e;let r=t.length,i=new st(0,0,0);for(let J of t)i.add(J);let n=1/r;i.multiplyByScalar(n);let s=0,a=0,c=0,h=0,p=0,x=0;for(let J of t){let Z=Dd.copy(J).subtract(i);s+=Z.x*Z.x,a+=Z.x*Z.y,c+=Z.x*Z.z,h+=Z.y*Z.y,p+=Z.y*Z.z,x+=Z.z*Z.z}s*=n,a*=n,c*=n,h*=n,p*=n,x*=n;let T=xhe;T[0]=s,T[1]=a,T[2]=c,T[3]=a,T[4]=h,T[5]=p,T[6]=c,T[7]=p,T[8]=x;let{unitary:R}=eP(T,bhe),k=e.halfAxes.copy(R),j=k.getColumn(0,ghe),q=k.getColumn(1,_he),X=k.getColumn(2,yhe),re=-Number.MAX_VALUE,te=-Number.MAX_VALUE,oe=-Number.MAX_VALUE,ae=Number.MAX_VALUE,pe=Number.MAX_VALUE,be=Number.MAX_VALUE;for(let J of t)Dd.copy(J),re=Math.max(Dd.dot(j),re),te=Math.max(Dd.dot(q),te),oe=Math.max(Dd.dot(X),oe),ae=Math.min(Dd.dot(j),ae),pe=Math.min(Dd.dot(q),pe),be=Math.min(Dd.dot(X),be);j=j.multiplyByScalar(.5*(ae+re)),q=q.multiplyByScalar(.5*(pe+te)),X=X.multiplyByScalar(.5*(be+oe)),e.center.copy(j).add(q).add(X);let Fe=mhe.set(re-ae,te-pe,oe-be).multiplyByScalar(.5),Y=new an([Fe[0],0,0,0,Fe[1],0,0,0,Fe[2]]);return e.halfAxes.multiplyRight(Y),e}var K0=512,fV=3,dV=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],pV=dV.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),vhe=pV.concat([[.25,.5],[.75,.5]]),tP=class t{constructor(e,r,i){this.x=e,this.y=r,this.z=i}get children(){if(!this._children){let e=this.x*2,r=this.y*2,i=this.z+1;this._children=[new t(e,r,i),new t(e,r+1,i),new t(e+1,r,i),new t(e+1,r+1,i)]}return this._children}update(e){let{viewport:r,cullingVolume:i,elevationBounds:n,minZ:s,maxZ:a,bounds:c,offset:h,project:p}=e,x=this.getBoundingVolume(n,h,p);if(c&&!this.insideBounds(c)||i.computeVisibility(x)<0)return!1;if(!this.childVisible){let{z:R}=this;if(R<a&&R>=s){let k=x.distanceTo(r.cameraPosition)*r.scale/r.height;R+=Math.floor(Math.log2(k))}if(R>=a)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(let R of this.children)R.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(let r of this._children)r.getSelected(e);return e}insideBounds([e,r,i,n]){let s=Math.pow(2,this.z),a=K0/s;return this.x*a<i&&this.y*a<n&&(this.x+1)*a>e&&(this.y+1)*a>r}getBoundingVolume(e,r,i){if(i){let h=this.z<1?vhe:this.z<2?pV:dV,p=[];for(let x of h){let T=O3(this.x+x[0],this.y+x[1],this.z);T[2]=e[0],p.push(i(T)),e[0]!==e[1]&&(T[2]=e[1],p.push(i(T)))}return Px(p)}let n=Math.pow(2,this.z),s=K0/n,a=this.x*s+r*K0,c=K0-(this.y+1)*s;return new Y0([a,c,e[0]],[a+s,c+s,e[1]])}};function AV(t,e,r,i){let n=t instanceof Ed&&t.resolution?t.projectPosition:null,s=Object.values(t.getFrustumPlanes()).map(({normal:k,distance:j})=>new qo(k.clone().negate(),j)),a=new ha(s),c=t.distanceScales.unitsPerMeter[2],h=r&&r[0]*c||0,p=r&&r[1]*c||0,x=t instanceof Du&&t.pitch<=60?e:0;if(i){let[k,j,q,X]=i,re=io([k,X]),te=io([q,j]);i=[re[0],K0-re[1],te[0],K0-te[1]]}let T=new tP(0,0,0),R={viewport:t,project:n,cullingVolume:a,elevationBounds:[h,p],minZ:x,maxZ:e,bounds:i,offset:0};if(T.update(R),t instanceof Du&&t.subViewports&&t.subViewports.length>1){for(R.offset=-1;T.update(R)&&!(--R.offset<-fV););for(R.offset=1;T.update(R)&&!(++R.offset>fV););}return T.getSelected()}var Jh=512,whe=[-1/0,-1/0,1/0,1/0],Fd={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(r=>typeof r=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;let r=t.length;if(r!==e.length)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}};function gV(t,e){let r=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...r.map(n=>n[0])),Math.min(...r.map(n=>n[1])),Math.max(...r.map(n=>n[0])),Math.max(...r.map(n=>n[1]))]}function The(t){return Math.abs(t.split("").reduce((e,r)=>(e<<5)-e+r.charCodeAt(0)|0,0))}function Ku(t,e){if(!t||!t.length)return null;let{index:r,id:i}=e;if(Array.isArray(t)){let s=The(i)%t.length;t=t[s]}let n=t;for(let s of Object.keys(r)){let a=new RegExp(`{${s}}`,"g");n=n.replace(a,String(r[s]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),n}function Ehe(t,e,r){let i;if(e&&e.length===2){let[n,s]=e,a=t.getBounds({z:n}),c=t.getBounds({z:s});i=[Math.min(a[0],c[0]),Math.min(a[1],c[1]),Math.max(a[2],c[2]),Math.max(a[3],c[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],r[0]),Math.max(i[1],r[1]),Math.min(i[2],r[2]),Math.min(i[3],r[3])]:[Math.max(Math.min(i[0],r[2]),r[0]),Math.max(Math.min(i[1],r[3]),r[1]),Math.min(Math.max(i[2],r[0]),r[2]),Math.min(Math.max(i[3],r[1]),r[3])]}function _V({viewport:t,z:e,cullRect:r}){return(t.subViewports||[t]).map(n=>rP(n,e||0,r))}function rP(t,e,r){if(!Array.isArray(e)){let s=r.x-t.x,a=r.y-t.y,{width:c,height:h}=r,p={targetZ:e},x=t.unproject([s,a],p),T=t.unproject([s+c,a],p),R=t.unproject([s,a+h],p),k=t.unproject([s+c,a+h],p);return[Math.min(x[0],T[0],R[0],k[0]),Math.min(x[1],T[1],R[1],k[1]),Math.max(x[0],T[0],R[0],k[0]),Math.max(x[1],T[1],R[1],k[1])]}let i=rP(t,e[0],r),n=rP(t,e[1],r);return[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[2],n[2]),Math.max(i[3],n[3])]}function Che(t,e,r){return r?gV(t,r).map(n=>n*e/Jh):t.map(i=>i*e/Jh)}function iP(t,e){return Math.pow(2,t)*Jh/e}function O3(t,e,r){let i=iP(r,Jh),n=t/i*360-180,s=Math.PI-2*Math.PI*e/i,a=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[n,a]}function mV(t,e,r,i){let n=iP(r,i);return[t/n*Jh,e/n*Jh]}function nP(t,e,r,i,n=Jh){if(t.isGeospatial){let[p,x]=O3(e,r,i),[T,R]=O3(e+1,r+1,i);return{west:p,north:x,east:T,south:R}}let[s,a]=mV(e,r,i,n),[c,h]=mV(e+1,r+1,i,n);return{left:s,top:a,right:c,bottom:h}}function She(t,e,r,i,n){let s=Ehe(t,null,i),a=iP(e,r),[c,h,p,x]=Che(s,a,n),T=[];for(let R=Math.floor(c);R<p;R++)for(let k=Math.floor(h);k<x;k++)T.push({x:R,y:k,z:e});return T}function sP({viewport:t,maxZoom:e,minZoom:r,zRange:i,extent:n,tileSize:s=Jh,modelMatrix:a,modelMatrixInverse:c,zoomOffset:h=0}){let p=t.isGeospatial?Math.round(t.zoom+Math.log2(Jh/s))+h:Math.ceil(t.zoom)+h;if(typeof r=="number"&&Number.isFinite(r)&&p<r){if(!n)return[];p=r}typeof e=="number"&&Number.isFinite(e)&&p>e&&(p=e);let x=n;return a&&c&&n&&!t.isGeospatial&&(x=gV(n,a)),t.isGeospatial?AV(t,p,i,n):She(t,p,s,x||whe,c)}function oP(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function aP(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function yV(t){let e={},r;return i=>{for(let n in i)if(!Ihe(i[n],e[n])){r=t(i),e=i;break}return r}}function Ihe(t,e){if(t===e)return!0;if(Array.isArray(t)){let r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}var xV=1,D3=2,Mhe="never",Phe="no-overlap",Rx="best-available",Rhe=5,Bhe={[Rx]:Ohe,[Phe]:Dhe,[Mhe]:()=>{}},Lhe={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}},wA=class{constructor(e){this._getCullBounds=yV(_V),this.opts={...Lhe,...e},this.setOptions(this.opts),this.onTileLoad=r=>{this.opts.onTileLoad?.(r),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=r.byteLength,this._resizeCache())},this._requestScheduler=new od({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Er,this._modelMatrixInverse=new Er}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(let e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let e of this._cache.keys()){let r=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(r)?this._cache.delete(e):r.setNeedsReload()}}update(e,{zRange:r,modelMatrix:i}={zRange:null,modelMatrix:null}){let n=i?new Er(i):new Er,s=!n.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Hs(this._zRange,r)||s){s&&(this._modelMatrixInverse=n.clone().invert(),this._modelMatrix=n),this._viewport=e,this._zRange=r;let c=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:r,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=c.map(h=>this._getTile(h,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(c=>this._getTile(c.index,!0)));let a=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),a&&this._frameNumber++,this._frameNumber}isTileVisible(e,r){if(!e.isVisible)return!1;if(r&&this._viewport){let i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:r}),{bbox:n}=e;for(let[s,a,c,h]of i){let p;if("west"in n)p=n.west<c&&n.east>s&&n.south<h&&n.north>a;else{let x=Math.min(n.top,n.bottom),T=Math.max(n.top,n.bottom);p=n.left<c&&n.right>s&&x<h&&T>a}if(p)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:r,minZoom:i,zRange:n,modelMatrix:s,modelMatrixInverse:a}){let{tileSize:c,extent:h,zoomOffset:p}=this.opts;return sP({viewport:e,maxZoom:r,minZoom:i,zRange:n,tileSize:c,extent:h,modelMatrix:s,modelMatrixInverse:a,zoomOffset:p})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){let{tileSize:r}=this.opts;return{bbox:nP(this._viewport,e.x,e.y,e.z,r)}}getParentIndex(e){let r=Math.floor(e.x/2),i=Math.floor(e.y/2),n=e.z-1;return{x:r,y:i,z:n}}updateTileStates(){let e=this.opts.refinementStrategy||Rx,r=new Array(this._cache.size),i=0;for(let n of this._cache.values())r[i++]=n.isVisible,n.isSelected=!1,n.isVisible=!1;for(let n of this._selectedTiles)n.isSelected=!0,n.isVisible=!0;(typeof e=="function"?e:Bhe[e])(Array.from(this._cache.values())),i=0;for(let n of this._cache.values())if(r[i++]!==n.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:e=0}=this.opts,r=[],i=0;for(let n of this._cache.values())n.isLoading&&(i++,!n.isSelected&&!n.isVisible&&r.push(n));for(;e>0&&i>e&&r.length>0;)r.shift().abort(),i--}_rebuildTree(){let{_cache:e}=this;for(let r of e.values())r.parent=null,r.children&&(r.children.length=0);for(let r of e.values()){let i=this._getNearestAncestor(r);r.parent=i,i?.children&&i.children.push(r)}}_resizeCache(){let{_cache:e,opts:r}=this,i=r.maxCacheSize??(r.maxCacheByteSize!==null?1/0:Rhe*this.selectedTiles.length),n=r.maxCacheByteSize??1/0;if(e.size>i||this._cacheByteSize>n){for(let[a,c]of e)if(!c.isVisible&&!c.isSelected&&(this._cacheByteSize-=r.maxCacheByteSize!==null?c.byteLength:0,e.delete(a),this.opts.onTileUnload?.(c)),e.size<=i&&this._cacheByteSize<=n)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((a,c)=>a.zoom-c.zoom),this._dirty=!1)}_getTile(e,r){let i=this.getTileId(e),n=this._cache.get(i),s=!1;return!n&&r?(n=new vA(e),Object.assign(n,this.getTileMetadata(n.index)),Object.assign(n,{id:i,zoom:this.getTileZoom(n.index)}),s=!0,this._cache.set(i,n),this._dirty=!0):n&&n.needsReload&&(s=!0),n&&s&&n.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),n}_getNearestAncestor(e){let{_minZoom:r=0}=this,i=e.index;for(;this.getTileZoom(i)>r;){i=this.getParentIndex(i);let n=this._getTile(i);if(n)return n}return null}};function Ohe(t){for(let e of t)e.state=0;for(let e of t)e.isSelected&&!bV(e)&&lP(e);for(let e of t)e.isVisible=!!(e.state&D3)}function Dhe(t){for(let r of t)r.state=0;for(let r of t)r.isSelected&&bV(r);let e=Array.from(t).sort((r,i)=>r.zoom-i.zoom);for(let r of e)if(r.isVisible=!!(r.state&D3),r.children&&(r.isVisible||r.state&xV))for(let i of r.children)i.state=xV;else r.isSelected&&lP(r)}function bV(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=D3,!0;e=e.parent}return!1}function lP(t){for(let e of t.children)e.isLoaded||e.content?e.state|=D3:lP(e)}var Fhe={TilesetClass:wA,data:{type:"data",value:[]},dataComparator:Fd.equal,renderSubLayers:{type:"function",value:t=>new _A(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Rx,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},Bx=class extends ss{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:r}=this.state,i=e.propsOrDataChanged||e.updateTriggersChanged,n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);r?i&&(r.setOptions(this._getTilesetOptions()),n?r.reloadAll():r.tiles.forEach(s=>{s.layers=null})):(r=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:r})),this._updateTileset()}_getTilesetOptions(){let{tileSize:e,maxCacheSize:r,maxCacheByteSize:i,refinementStrategy:n,extent:s,maxZoom:a,minZoom:c,maxRequests:h,debounceTime:p,zoomOffset:x}=this.props;return{maxCacheSize:r,maxCacheByteSize:i,maxZoom:a,minZoom:c,tileSize:e,refinementStrategy:n,extent:s,maxRequests:h,debounceTime:p,zoomOffset:x,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let e=this.state.tileset,{zRange:r,modelMatrix:i}=this.props,n=e.update(this.context.viewport,{zRange:r,modelMatrix:i}),{isLoaded:s}=e,a=this.state.isLoaded!==s,c=this.state.frameNumber!==n;s&&(a||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:n}),this.state.isLoaded=s}_onViewportLoad(){let{tileset:e}=this.state,{onViewportLoad:r}=this.props;r&&r(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,r){this.props.onTileError(e),r.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){let{data:r,getTileData:i,fetch:n}=this.props,{signal:s}=e;return e.url=typeof r=="string"||Array.isArray(r)?Ku(r,e):null,i?i(e):n&&e.url?n(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){let r=e.sourceLayer,i=r.props.tile,n=e.info;return n.picked&&(n.tile=i),n.sourceTile=i,n.sourceTileSubLayer=r,n}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{let r=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)r&&e.layers[0]&&Object.keys(r).some(i=>e.layers[0].props[i]!==r[i])&&(e.layers=e.layers.map(i=>i.clone(r)));else{let i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Ra(i,Boolean).map(n=>n.clone({tile:e,...r}))}return e.layers})}filterSubLayer({layer:e,cullRect:r}){let{tile:i}=e.props;return this.state.tileset.isTileVisible(i,r)}};Bx.defaultProps=Fhe;Bx.layerName="TileLayer";var TA=Bx;var vV=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,wV={name:"trips",vs:vV,fs:vV,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}};var khe={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}},Lx=class extends $u{getShaders(){let e=super.getShaders();return e.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},e.modules=[...e.modules,wV],e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){let{fadeTrail:r,trailLength:i,currentTime:n}=this.props,s={fadeTrail:r,trailLength:i,currentTime:n};this.state.model.shaderInputs.setProps({trips:s}),super.draw(e)}};Lx.layerName="TripsLayer";Lx.defaultProps=khe;var TV=Lx;var Ji=function(t){t=t||{};var e=typeof t<"u"?t:{},r={},i;for(i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);var n=[],s="";function a(gt){return e.locateFile?e.locateFile(gt,s):s+gt}var c;typeof document<"u"&&document.currentScript&&(s=document.currentScript.src),s.indexOf("blob:")!==0?s=s.substr(0,s.lastIndexOf("/")+1):s="",c=function($t,or,Dr){var y=new XMLHttpRequest;y.open("GET",$t,!0),y.responseType="arraybuffer",y.onload=function(){if(y.status==200||y.status==0&&y.response){or(y.response);return}var Mi=zt($t);if(Mi){or(Mi.buffer);return}Dr()},y.onerror=Dr,y.send(null)};var h=e.print||console.log.bind(console),p=e.printErr||console.warn.bind(console);for(i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);r=null,e.arguments&&(n=e.arguments);var x=0,T=function(gt){x=gt},R=function(){return x},k=8;function j(gt,$t,or,Dr){switch(or=or||"i8",or.charAt(or.length-1)==="*"&&(or="i32"),or){case"i1":Se[gt>>0]=$t;break;case"i8":Se[gt>>0]=$t;break;case"i16":Ye[gt>>1]=$t;break;case"i32":tt[gt>>2]=$t;break;case"i64":Xi=[$t>>>0,(Rr=$t,+qs(Rr)>=1?Rr>0?(Aa(+Zs(Rr/4294967296),4294967295)|0)>>>0:~~+ls((Rr-+(~~Rr>>>0))/4294967296)>>>0:0)],tt[gt>>2]=Xi[0],tt[gt+4>>2]=Xi[1];break;case"float":Zt[gt>>2]=$t;break;case"double":Vt[gt>>3]=$t;break;default:za("invalid type for setValue: "+or)}}function q(gt,$t,or){switch($t=$t||"i8",$t.charAt($t.length-1)==="*"&&($t="i32"),$t){case"i1":return Se[gt>>0];case"i8":return Se[gt>>0];case"i16":return Ye[gt>>1];case"i32":return tt[gt>>2];case"i64":return tt[gt>>2];case"float":return Zt[gt>>2];case"double":return Vt[gt>>3];default:za("invalid type for getValue: "+$t)}return null}var X=!1;function re(gt,$t){gt||za("Assertion failed: "+$t)}function te(gt){var $t=e["_"+gt];return re($t,"Cannot call unknown function "+gt+", make sure it is exported"),$t}function oe(gt,$t,or,Dr,y){var Yi={string:function(Wn){var Ci=0;if(Wn!=null&&Wn!==0){var Pi=(Wn.length<<2)+1;Ci=rm(Pi),J(Wn,Ci,Pi)}return Ci},array:function(Wn){var Ci=rm(Wn.length);return xe(Wn,Ci),Ci}};function Mi(Wn){return $t==="string"?Fe(Wn):$t==="boolean"?!!Wn:Wn}var Ce=te(gt),Rn=[],ho=0;if(Dr)for(var ts=0;ts<Dr.length;ts++){var Gi=Yi[or[ts]];Gi?(ho===0&&(ho=gf()),Rn[ts]=Gi(Dr[ts])):Rn[ts]=Dr[ts]}var gn=Ce.apply(null,Rn);return gn=Mi(gn),ho!==0&&mf(ho),gn}function ae(gt,$t,or,Dr){or=or||[];var y=or.every(function(Mi){return Mi==="number"}),Yi=$t!=="string";return Yi&&y&&!Dr?te(gt):function(){return oe(gt,$t,or,arguments,Dr)}}var pe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function be(gt,$t,or){for(var Dr=$t+or,y=$t;gt[y]&&!(y>=Dr);)++y;if(y-$t>16&&gt.subarray&&pe)return pe.decode(gt.subarray($t,y));for(var Yi="";$t<y;){var Mi=gt[$t++];if(!(Mi&128)){Yi+=String.fromCharCode(Mi);continue}var Ce=gt[$t++]&63;if((Mi&224)==192){Yi+=String.fromCharCode((Mi&31)<<6|Ce);continue}var Rn=gt[$t++]&63;if((Mi&240)==224?Mi=(Mi&15)<<12|Ce<<6|Rn:Mi=(Mi&7)<<18|Ce<<12|Rn<<6|gt[$t++]&63,Mi<65536)Yi+=String.fromCharCode(Mi);else{var ho=Mi-65536;Yi+=String.fromCharCode(55296|ho>>10,56320|ho&1023)}}return Yi}function Fe(gt,$t){return gt?be(ke,gt,$t):""}function Y(gt,$t,or,Dr){if(!(Dr>0))return 0;for(var y=or,Yi=or+Dr-1,Mi=0;Mi<gt.length;++Mi){var Ce=gt.charCodeAt(Mi);if(Ce>=55296&&Ce<=57343){var Rn=gt.charCodeAt(++Mi);Ce=65536+((Ce&1023)<<10)|Rn&1023}if(Ce<=127){if(or>=Yi)break;$t[or++]=Ce}else if(Ce<=2047){if(or+1>=Yi)break;$t[or++]=192|Ce>>6,$t[or++]=128|Ce&63}else if(Ce<=65535){if(or+2>=Yi)break;$t[or++]=224|Ce>>12,$t[or++]=128|Ce>>6&63,$t[or++]=128|Ce&63}else{if(or+3>=Yi)break;$t[or++]=240|Ce>>18,$t[or++]=128|Ce>>12&63,$t[or++]=128|Ce>>6&63,$t[or++]=128|Ce&63}}return $t[or]=0,or-y}function J(gt,$t,or){return Y(gt,ke,$t,or)}var Z=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function xe(gt,$t){Se.set(gt,$t)}function _e(gt,$t){return gt%$t>0&&(gt+=$t-gt%$t),gt}var Be,Se,ke,Ye,rt,tt,_t,Zt,Vt;function cr(gt){Be=gt,e.HEAP8=Se=new Int8Array(gt),e.HEAP16=Ye=new Int16Array(gt),e.HEAP32=tt=new Int32Array(gt),e.HEAPU8=ke=new Uint8Array(gt),e.HEAPU16=rt=new Uint16Array(gt),e.HEAPU32=_t=new Uint32Array(gt),e.HEAPF32=Zt=new Float32Array(gt),e.HEAPF64=Vt=new Float64Array(gt)}var Wt=5267040,Lt=24128,vr=e.TOTAL_MEMORY||33554432;e.buffer?Be=e.buffer:Be=new ArrayBuffer(vr),vr=Be.byteLength,cr(Be),tt[Lt>>2]=Wt;function Pr(gt){for(;gt.length>0;){var $t=gt.shift();if(typeof $t=="function"){$t();continue}var or=$t.func;typeof or=="number"?$t.arg===void 0?e.dynCall_v(or):e.dynCall_vi(or,$t.arg):or($t.arg===void 0?null:$t.arg)}}var dr=[],Nr=[],Ai=[],Wr=[];function Di(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)oi(e.preRun.shift());Pr(dr)}function ui(){Pr(Nr)}function tn(){Pr(Ai)}function Ni(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Eo(e.postRun.shift());Pr(Wr)}function oi(gt){dr.unshift(gt)}function Eo(gt){Wr.unshift(gt)}var qs=Math.abs,ls=Math.ceil,Zs=Math.floor,Aa=Math.min,_s=0,oo=null,ys=null;function Gr(gt){_s++,e.monitorRunDependencies&&e.monitorRunDependencies(_s)}function Jt(gt){if(_s--,e.monitorRunDependencies&&e.monitorRunDependencies(_s),_s==0&&(oo!==null&&(clearInterval(oo),oo=null),ys)){var $t=ys;ys=null,$t()}}e.preloadedImages={},e.preloadedAudios={};var kt=null,Cr="data:application/octet-stream;base64,";function ai(gt){return String.prototype.startsWith?gt.startsWith(Cr):gt.indexOf(Cr)===0}var Rr,Xi;kt="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var cs=24144;function zn(gt){return gt}function ot(gt){var $t=/\b__Z[\w\d_]+/g;return gt.replace($t,function(or){var Dr=or;return or===Dr?or:Dr+" ["+or+"]"})}function Ae(){var gt=new Error;if(!gt.stack){try{throw new Error(0)}catch($t){gt=$t}if(!gt.stack)return"(no stack trace available)"}return gt.stack.toString()}function ye(){var gt=Ae();return e.extraStackTrace&&(gt+=`
`+e.extraStackTrace()),ot(gt)}function ue(gt,$t,or,Dr){za("Assertion failed: "+Fe(gt)+", at: "+[$t?Fe($t):"unknown filename",or,Dr?Fe(Dr):"unknown function"])}function Ve(){return Se.length}function Ke(gt,$t,or){ke.set(ke.subarray($t,$t+or),gt)}function Qe(gt){return e.___errno_location&&(tt[e.___errno_location()>>2]=gt),gt}function dt(gt){za("OOM")}function it(gt){try{var $t=new ArrayBuffer(gt);return $t.byteLength!=gt?void 0:(new Int8Array($t).set(Se),Jn($t),cr($t),1)}catch{}}function Bt(gt){var $t=Ve(),or=16777216,Dr=2147483648-or;if(gt>Dr)return!1;for(var y=16777216,Yi=Math.max($t,y);Yi<gt;)Yi<=536870912?Yi=_e(2*Yi,or):Yi=Math.min(_e((3*Yi+2147483648)/4,or),Dr);var Mi=it(Yi);return!!Mi}var Mt=typeof atob=="function"?atob:function(gt){var $t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",or="",Dr,y,Yi,Mi,Ce,Rn,ho,ts=0;gt=gt.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Mi=$t.indexOf(gt.charAt(ts++)),Ce=$t.indexOf(gt.charAt(ts++)),Rn=$t.indexOf(gt.charAt(ts++)),ho=$t.indexOf(gt.charAt(ts++)),Dr=Mi<<2|Ce>>4,y=(Ce&15)<<4|Rn>>2,Yi=(Rn&3)<<6|ho,or=or+String.fromCharCode(Dr),Rn!==64&&(or=or+String.fromCharCode(y)),ho!==64&&(or=or+String.fromCharCode(Yi));while(ts<gt.length);return or};function ut(gt){try{for(var $t=Mt(gt),or=new Uint8Array($t.length),Dr=0;Dr<$t.length;++Dr)or[Dr]=$t.charCodeAt(Dr);return or}catch{throw new Error("Converting base64 string to bytes failed.")}}function zt(gt){if(ai(gt))return ut(gt.slice(Cr.length))}var rr={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},nr={a:za,b:T,c:R,d:ue,e:Qe,f:Ve,g:Ke,h:Bt,i:dt,j:zn,k:ot,l:it,m:Ae,n:ye,o:cs,p:Lt},$e=function(gt,$t,or){"almost asm";var Dr=new gt.Int8Array(or),y=new gt.Int32Array(or),Yi=new gt.Uint8Array(or),Mi=new gt.Float32Array(or),Ce=new gt.Float64Array(or),Rn=$t.o|0,ho=$t.p|0,ts=gt.Math.floor,Gi=gt.Math.abs,gn=gt.Math.sqrt,Wn=gt.Math.pow,Ci=gt.Math.cos,Pi=gt.Math.sin,Kc=gt.Math.tan,im=gt.Math.acos,Kl=gt.Math.asin,Qc=gt.Math.atan,Po=gt.Math.atan2,xa=gt.Math.ceil,ba=gt.Math.imul,Ql=gt.Math.min,nm=gt.Math.max,Jl=gt.Math.clz32,Qr=$t.b,Re=$t.c,zr=$t.d,yf=$t.e,sm=$t.f,xf=$t.g,va=$t.h,Kd=$t.i,we=24160;function Qd(m){return Dr=new Int8Array(m),Yi=new Uint8Array(m),y=new Int32Array(m),Mi=new Float32Array(m),Ce=new Float64Array(m),or=m,!0}function om(m){m=m|0;var A=0;return A=we,we=we+m|0,we=we+15&-16,A|0}function Ri(){return we|0}function ec(m){m=m|0,we=m}function Jd(m,A){m=m|0,A=A|0,we=m}function Ug(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;return(m|0)<0?(A=2,A|0):(m|0)>13780509?(A=fc(15,A)|0,A|0):(b=((m|0)<0)<<31>>31,M=Tt(m|0,b|0,3,0)|0,E=Re()|0,b=He(m|0,b|0,1,0)|0,b=Tt(M|0,E|0,b|0,Re()|0)|0,b=He(b|0,Re()|0,1,0)|0,m=Re()|0,y[A>>2]=b,y[A+4>>2]=m,A=0,A|0)}function am(m,A,b,E){return m=m|0,A=A|0,b=b|0,E=E|0,lm(m,A,b,E,0)|0}function lm(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0;if(W=we,we=we+16|0,F=W,!(cm(m,A,b,E,M)|0))return E=0,we=W,E|0;do if((b|0)>=0){if((b|0)>13780509){if(B=fc(15,F)|0,B|0)break;N=F,F=y[N>>2]|0,N=y[N+4>>2]|0}else B=((b|0)<0)<<31>>31,ee=Tt(b|0,B|0,3,0)|0,N=Re()|0,B=He(b|0,B|0,1,0)|0,B=Tt(ee|0,N|0,B|0,Re()|0)|0,B=He(B|0,Re()|0,1,0)|0,N=Re()|0,y[F>>2]=B,y[F+4>>2]=N,F=B;if(Ui(E|0,0,F<<3|0)|0,M|0){Ui(M|0,0,F<<2|0)|0,B=wa(m,A,b,E,M,F,N,0)|0;break}B=Ze(F,4)|0,B?(ee=wa(m,A,b,E,B,F,N,0)|0,De(B),B=ee):B=13}else B=2;while(!1);return ee=B,we=W,ee|0}function cm(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0;if(nt=we,we=we+16|0,Je=nt,je=nt+8|0,qe=Je,y[qe>>2]=m,y[qe+4>>2]=A,(b|0)<0)return je=2,we=nt,je|0;if(B=E,y[B>>2]=m,y[B+4>>2]=A,B=(M|0)!=0,B&&(y[M>>2]=0),Hi(m,A)|0)return je=9,we=nt,je|0;y[je>>2]=0;e:do if((b|0)>=1)if(B)for(fe=1,ee=0,Te=0,qe=1,B=m;;){if(!(ee|Te)){if(B=fs(B,A,4,je,Je)|0,B|0)break e;if(A=Je,B=y[A>>2]|0,A=y[A+4>>2]|0,Hi(B,A)|0){B=9;break e}}if(B=fs(B,A,y[22384+(Te<<2)>>2]|0,je,Je)|0,B|0)break e;if(A=Je,B=y[A>>2]|0,A=y[A+4>>2]|0,m=E+(fe<<3)|0,y[m>>2]=B,y[m+4>>2]=A,y[M+(fe<<2)>>2]=qe,m=ee+1|0,F=(m|0)==(qe|0),N=Te+1|0,W=(N|0)==6,Hi(B,A)|0){B=9;break e}if(qe=qe+(W&F&1)|0,(qe|0)>(b|0)){B=0;break}else fe=fe+1|0,ee=F?0:m,Te=F?W?0:N:Te}else for(fe=1,ee=0,Te=0,qe=1,B=m;;){if(!(ee|Te)){if(B=fs(B,A,4,je,Je)|0,B|0)break e;if(A=Je,B=y[A>>2]|0,A=y[A+4>>2]|0,Hi(B,A)|0){B=9;break e}}if(B=fs(B,A,y[22384+(Te<<2)>>2]|0,je,Je)|0,B|0)break e;if(A=Je,B=y[A>>2]|0,A=y[A+4>>2]|0,m=E+(fe<<3)|0,y[m>>2]=B,y[m+4>>2]=A,m=ee+1|0,F=(m|0)==(qe|0),N=Te+1|0,W=(N|0)==6,Hi(B,A)|0){B=9;break e}if(qe=qe+(W&F&1)|0,(qe|0)>(b|0)){B=0;break}else fe=fe+1|0,ee=F?0:m,Te=F?W?0:N:Te}else B=0;while(!1);return je=B,we=nt,je|0}function wa(m,A,b,E,M,B,F,N){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0,F=F|0,N=N|0;var W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0;if(nt=we,we=we+16|0,Je=nt+8|0,je=nt,W=Kt(m|0,A|0,B|0,F|0)|0,fe=Re()|0,Te=E+(W<<3)|0,It=Te,wt=y[It>>2]|0,It=y[It+4>>2]|0,ee=(wt|0)==(m|0)&(It|0)==(A|0),!((wt|0)==0&(It|0)==0|ee))do W=He(W|0,fe|0,1,0)|0,W=er(W|0,Re()|0,B|0,F|0)|0,fe=Re()|0,Te=E+(W<<3)|0,wt=Te,It=y[wt>>2]|0,wt=y[wt+4>>2]|0,ee=(It|0)==(m|0)&(wt|0)==(A|0);while(!((It|0)==0&(wt|0)==0|ee));if(W=M+(W<<2)|0,ee&&(y[W>>2]|0)<=(N|0)||(wt=Te,y[wt>>2]=m,y[wt+4>>2]=A,y[W>>2]=N,(N|0)>=(b|0)))return wt=0,we=nt,wt|0;switch(ee=N+1|0,y[Je>>2]=0,W=fs(m,A,2,Je,je)|0,W|0){case 9:{qe=9;break}case 0:{W=je,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,ee)|0,W||(qe=9);break}default:}e:do if((qe|0)==9){switch(y[Je>>2]=0,W=fs(m,A,3,Je,je)|0,W|0){case 9:break;case 0:{if(W=je,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,ee)|0,W|0)break e;break}default:break e}switch(y[Je>>2]=0,W=fs(m,A,1,Je,je)|0,W|0){case 9:break;case 0:{if(W=je,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,ee)|0,W|0)break e;break}default:break e}switch(y[Je>>2]=0,W=fs(m,A,5,Je,je)|0,W|0){case 9:break;case 0:{if(W=je,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,ee)|0,W|0)break e;break}default:break e}switch(y[Je>>2]=0,W=fs(m,A,4,Je,je)|0,W|0){case 9:break;case 0:{if(W=je,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,ee)|0,W|0)break e;break}default:break e}switch(y[Je>>2]=0,W=fs(m,A,6,Je,je)|0,W|0){case 9:break;case 0:{if(W=je,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,ee)|0,W|0)break e;break}default:break e}return wt=0,we=nt,wt|0}while(!1);return wt=W,we=nt,wt|0}function fs(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0;if(b>>>0>6)return M=1,M|0;if(Te=(y[E>>2]|0)%6|0,y[E>>2]=Te,(Te|0)>0){B=0;do b=oc(b)|0,B=B+1|0;while((B|0)<(y[E>>2]|0))}if(Te=mt(m|0,A|0,45)|0,Re()|0,fe=Te&127,fe>>>0>121)return M=5,M|0;W=Ns(m,A)|0,B=mt(m|0,A|0,52)|0,Re()|0,B=B&15;e:do if(!B)ee=8;else{for(;;){if(F=(15-B|0)*3|0,N=mt(m|0,A|0,F|0)|0,Re()|0,N=N&7,(N|0)==7){A=5;break}if(je=(wn(B)|0)==0,B=B+-1|0,qe=Nt(7,0,F|0)|0,A=A&~(Re()|0),Je=Nt(y[(je?432:16)+(N*28|0)+(b<<2)>>2]|0,0,F|0)|0,F=Re()|0,b=y[(je?640:224)+(N*28|0)+(b<<2)>>2]|0,m=Je|m&~qe,A=F|A,!b){b=0;break e}if(!B){ee=8;break e}}return A|0}while(!1);(ee|0)==8&&(je=y[848+(fe*28|0)+(b<<2)>>2]|0,Je=Nt(je|0,0,45)|0,m=Je|m,A=Re()|0|A&-1040385,b=y[4272+(fe*28|0)+(b<<2)>>2]|0,(je&127|0)==127&&(je=Nt(y[848+(fe*28|0)+20>>2]|0,0,45)|0,A=Re()|0|A&-1040385,b=y[4272+(fe*28|0)+20>>2]|0,m=Ga(je|m,A)|0,A=Re()|0,y[E>>2]=(y[E>>2]|0)+1)),N=mt(m|0,A|0,45)|0,Re()|0,N=N&127;e:do if(yi(N)|0){t:do if((Ns(m,A)|0)==1){if((fe|0)!=(N|0))if(Ah(N,y[7696+(fe*28|0)>>2]|0)|0){m=Al(m,A)|0,F=1,A=Re()|0;break}else zr(23313,22416,436,22424);switch(W|0){case 3:{m=Ga(m,A)|0,A=Re()|0,y[E>>2]=(y[E>>2]|0)+1,F=0;break t}case 5:{m=Al(m,A)|0,A=Re()|0,y[E>>2]=(y[E>>2]|0)+5,F=0;break t}case 0:return je=9,je|0;default:return je=1,je|0}}else F=0;while(!1);if((b|0)>0){B=0;do m=fp(m,A)|0,A=Re()|0,B=B+1|0;while((B|0)!=(b|0))}if((fe|0)!=(N|0)){if(!(Tf(N)|0)){if((F|0)!=0|(Ns(m,A)|0)!=5)break;y[E>>2]=(y[E>>2]|0)+1;break}switch(Te&127){case 8:case 118:break e;default:}(Ns(m,A)|0)!=3&&(y[E>>2]=(y[E>>2]|0)+1)}}else if((b|0)>0){B=0;do m=Ga(m,A)|0,A=Re()|0,B=B+1|0;while((B|0)!=(b|0))}while(!1);return y[E>>2]=((y[E>>2]|0)+b|0)%6|0,je=M,y[je>>2]=m,y[je+4>>2]=A,je=0,je|0}function bf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0;for(N=we,we=we+16|0,B=N,F=N+8|0,M=(Hi(m,A)|0)==0,M=M?1:2;;){if(y[F>>2]=0,ee=(fs(m,A,M,F,B)|0)==0,W=B,ee&((y[W>>2]|0)==(b|0)?(y[W+4>>2]|0)==(E|0):0)){m=4;break}if(M=M+1|0,M>>>0>=7){M=7,m=4;break}}return(m|0)==4?(we=N,M|0):0}function vf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0;if(je=we,we=we+16|0,qe=je,Je=je+8|0,Te=qe,y[Te>>2]=m,y[Te+4>>2]=A,!b)return Je=E,y[Je>>2]=m,y[Je+4>>2]=A,Je=0,we=je,Je|0;y[Je>>2]=0;e:do if(Hi(m,A)|0)m=9;else{if(B=(b|0)>0,B){M=0,Te=m;do{if(m=fs(Te,A,4,Je,qe)|0,m|0)break e;if(A=qe,Te=y[A>>2]|0,A=y[A+4>>2]|0,M=M+1|0,Hi(Te,A)|0){m=9;break e}}while((M|0)<(b|0));if(fe=E,y[fe>>2]=Te,y[fe+4>>2]=A,fe=b+-1|0,B){ee=0,m=1;do{if(M=22384+(ee<<2)|0,(ee|0)==5)for(F=y[M>>2]|0,B=0,M=m;;){if(m=qe,m=fs(y[m>>2]|0,y[m+4>>2]|0,F,Je,qe)|0,m|0)break e;if((B|0)!=(fe|0))if(W=qe,N=y[W>>2]|0,W=y[W+4>>2]|0,m=E+(M<<3)|0,y[m>>2]=N,y[m+4>>2]=W,!(Hi(N,W)|0))m=M+1|0;else{m=9;break e}else m=M;if(B=B+1|0,(B|0)>=(b|0))break;M=m}else for(F=qe,W=y[M>>2]|0,N=0,M=m,B=y[F>>2]|0,F=y[F+4>>2]|0;;){if(m=fs(B,F,W,Je,qe)|0,m|0)break e;if(F=qe,B=y[F>>2]|0,F=y[F+4>>2]|0,m=E+(M<<3)|0,y[m>>2]=B,y[m+4>>2]=F,m=M+1|0,Hi(B,F)|0){m=9;break e}if(N=N+1|0,(N|0)>=(b|0))break;M=m}ee=ee+1|0}while(ee>>>0<6);m=qe,F=Te,M=y[m>>2]|0,B=A,m=y[m+4>>2]|0}else F=Te,M=Te,B=A,m=A}else F=E,y[F>>2]=m,y[F+4>>2]=A,F=m,M=m,B=A,m=A;m=(F|0)==(M|0)&(B|0)==(m|0)?0:9}while(!1);return Je=m,we=je,Je|0}function wf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0;if(N=we,we=we+48|0,M=N+16|0,B=N+8|0,F=N,b|0)return F=15,we=N,F|0;if(ee=m,W=y[ee+4>>2]|0,b=B,y[b>>2]=y[ee>>2],y[b+4>>2]=W,du(B,M),A=Cf(M,A,F)|0,!A){if(b=y[B>>2]|0,B=y[m+8>>2]|0,(B|0)>0){M=y[m+12>>2]|0,A=0;do b=(y[M+(A<<3)>>2]|0)+b|0,A=A+1|0;while((A|0)<(B|0))}A=F,M=y[A>>2]|0,A=y[A+4>>2]|0,B=((b|0)<0)<<31>>31,(A|0)<(B|0)|(A|0)==(B|0)&M>>>0<b>>>0?(A=F,y[A>>2]=b,y[A+4>>2]=B,A=B):b=M,W=He(b|0,A|0,12,0)|0,ee=Re()|0,A=F,y[A>>2]=W,y[A+4>>2]=ee,A=E,y[A>>2]=W,y[A+4>>2]=ee,A=0}return ee=A,we=N,ee|0}function ph(m,A,b,E,M,B,F){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0,F=F|0;var N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,gr=0,sr=0,lr=0,mi=0,ri=0,ni=0,qr=0,jr=0,Hr=0,Vi=0,Zr=0,fn=0,Ro=0,_m=0;if(Vi=we,we=we+64|0,ni=Vi+48|0,qr=Vi+32|0,jr=Vi+24|0,ar=Vi+8|0,gr=Vi,W=y[m>>2]|0,(W|0)<=0)return Hr=0,we=Vi,Hr|0;for(sr=m+4|0,lr=ni+8|0,mi=qr+8|0,ri=ar+8|0,N=0,bt=0;;){ee=y[sr>>2]|0,at=ee+(bt<<4)|0,y[ni>>2]=y[at>>2],y[ni+4>>2]=y[at+4>>2],y[ni+8>>2]=y[at+8>>2],y[ni+12>>2]=y[at+12>>2],(bt|0)==(W+-1|0)?(y[qr>>2]=y[ee>>2],y[qr+4>>2]=y[ee+4>>2],y[qr+8>>2]=y[ee+8>>2],y[qr+12>>2]=y[ee+12>>2]):(at=ee+(bt+1<<4)|0,y[qr>>2]=y[at>>2],y[qr+4>>2]=y[at+4>>2],y[qr+8>>2]=y[at+8>>2],y[qr+12>>2]=y[at+12>>2]),W=Si(ni,qr,E,jr)|0;e:do if(W)ee=0,N=W;else if(ee=jr,W=y[ee>>2]|0,ee=y[ee+4>>2]|0,(ee|0)>0|(ee|0)==0&W>>>0>0){wt=0,at=0;t:for(;;){if(_m=+Ce[ni>>3],It=Xe(W|0,ee|0,wt|0,at|0)|0,Ro=+(It>>>0)+4294967296*+(Re()|0),Zr=+(W>>>0)+4294967296*+(ee|0),fn=+(wt>>>0)+4294967296*+(at|0),Ce[ar>>3]=_m*Ro/Zr+ +Ce[qr>>3]*fn/Zr,Ce[ri>>3]=+Ce[lr>>3]*Ro/Zr+ +Ce[mi>>3]*fn/Zr,W=hr(ar,E,gr)|0,W|0){N=W;break}It=gr,nt=y[It>>2]|0,It=y[It+4>>2]|0,qe=Kt(nt|0,It|0,A|0,b|0)|0,fe=Re()|0,W=F+(qe<<3)|0,Te=W,ee=y[Te>>2]|0,Te=y[Te+4>>2]|0;r:do if((ee|0)==0&(Te|0)==0)ft=W,Hr=16;else for(Je=0,je=0;;){if((Je|0)>(b|0)|(Je|0)==(b|0)&je>>>0>A>>>0){N=1;break t}if((ee|0)==(nt|0)&(Te|0)==(It|0))break r;if(W=He(qe|0,fe|0,1,0)|0,qe=er(W|0,Re()|0,A|0,b|0)|0,fe=Re()|0,je=He(je|0,Je|0,1,0)|0,Je=Re()|0,W=F+(qe<<3)|0,Te=W,ee=y[Te>>2]|0,Te=y[Te+4>>2]|0,(ee|0)==0&(Te|0)==0){ft=W,Hr=16;break}}while(!1);if((Hr|0)==16&&(Hr=0,!((nt|0)==0&(It|0)==0))&&(je=ft,y[je>>2]=nt,y[je+4>>2]=It,je=B+(y[M>>2]<<3)|0,y[je>>2]=nt,y[je+4>>2]=It,je=M,je=He(y[je>>2]|0,y[je+4>>2]|0,1,0)|0,nt=Re()|0,It=M,y[It>>2]=je,y[It+4>>2]=nt),wt=He(wt|0,at|0,1,0)|0,at=Re()|0,ee=jr,W=y[ee>>2]|0,ee=y[ee+4>>2]|0,!((ee|0)>(at|0)|(ee|0)==(at|0)&W>>>0>wt>>>0)){ee=1;break e}}ee=0}else ee=1;while(!1);if(bt=bt+1|0,!ee){Hr=21;break}if(W=y[m>>2]|0,(bt|0)>=(W|0)){N=0,Hr=21;break}}return(Hr|0)==21?(we=Vi,N|0):0}function ep(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,gr=0,sr=0,lr=0,mi=0,ri=0,ni=0,qr=0,jr=0,Hr=0,Vi=0,Zr=0,fn=0,Ro=0;if(Ro=we,we=we+112|0,Hr=Ro+80|0,W=Ro+72|0,Vi=Ro,Zr=Ro+56|0,b|0)return fn=15,we=Ro,fn|0;if(ee=m+8|0,fn=Ge((y[ee>>2]<<5)+32|0)|0,!fn)return fn=13,we=Ro,fn|0;if(Hf(m,fn),qr=m,jr=y[qr+4>>2]|0,b=W,y[b>>2]=y[qr>>2],y[b+4>>2]=jr,du(W,Hr),b=Cf(Hr,A,Vi)|0,b)qr=0,jr=0;else{if(b=y[W>>2]|0,B=y[ee>>2]|0,(B|0)>0){F=y[m+12>>2]|0,M=0;do b=(y[F+(M<<3)>>2]|0)+b|0,M=M+1|0;while((M|0)!=(B|0));M=b}else M=b;b=Vi,B=y[b>>2]|0,b=y[b+4>>2]|0,F=((M|0)<0)<<31>>31,(b|0)<(F|0)|(b|0)==(F|0)&B>>>0<M>>>0?(b=Vi,y[b>>2]=M,y[b+4>>2]=F,b=F):M=B,qr=He(M|0,b|0,12,0)|0,jr=Re()|0,b=Vi,y[b>>2]=qr,y[b+4>>2]=jr,b=0}if(b|0)return De(fn),fn=b,we=Ro,fn|0;if(M=Ze(qr,8)|0,!M)return De(fn),fn=13,we=Ro,fn|0;if(N=Ze(qr,8)|0,!N)return De(fn),De(M),fn=13,we=Ro,fn|0;ri=Hr,y[ri>>2]=0,y[ri+4>>2]=0,ri=m,ni=y[ri+4>>2]|0,b=W,y[b>>2]=y[ri>>2],y[b+4>>2]=ni,b=ph(W,qr,jr,A,Hr,M,N)|0;e:do if(b)De(M),De(N),De(fn);else{t:do if((y[ee>>2]|0)>0){for(F=m+12|0,B=0;b=ph((y[F>>2]|0)+(B<<3)|0,qr,jr,A,Hr,M,N)|0,B=B+1|0,!(b|0);)if((B|0)>=(y[ee>>2]|0))break t;De(M),De(N),De(fn);break e}while(!1);(jr|0)>0|(jr|0)==0&qr>>>0>0&&Ui(N|0,0,qr<<3|0)|0,ni=Hr,ri=y[ni+4>>2]|0;t:do if((ri|0)>0|(ri|0)==0&(y[ni>>2]|0)>>>0>0){sr=M,lr=N,mi=M,ri=N,ni=M,b=M,ft=M,ar=N,gr=N,M=N;r:for(;;){for(It=0,wt=0,at=0,bt=0,B=0,F=0;;){N=Vi,W=N+56|0;do y[N>>2]=0,N=N+4|0;while((N|0)<(W|0));if(A=sr+(It<<3)|0,ee=y[A>>2]|0,A=y[A+4>>2]|0,cm(ee,A,1,Vi,0)|0){N=Vi,W=N+56|0;do y[N>>2]=0,N=N+4|0;while((N|0)<(W|0));N=Ze(7,4)|0,N|0&&(wa(ee,A,1,Vi,N,7,0,0)|0,De(N))}for(nt=0;;){je=Vi+(nt<<3)|0,Je=y[je>>2]|0,je=y[je+4>>2]|0;i:do if((Je|0)==0&(je|0)==0)N=B,W=F;else{if(fe=Kt(Je|0,je|0,qr|0,jr|0)|0,ee=Re()|0,N=E+(fe<<3)|0,A=N,W=y[A>>2]|0,A=y[A+4>>2]|0,!((W|0)==0&(A|0)==0)){Te=0,qe=0;do{if((Te|0)>(jr|0)|(Te|0)==(jr|0)&qe>>>0>qr>>>0)break r;if((W|0)==(Je|0)&(A|0)==(je|0)){N=B,W=F;break i}N=He(fe|0,ee|0,1,0)|0,fe=er(N|0,Re()|0,qr|0,jr|0)|0,ee=Re()|0,qe=He(qe|0,Te|0,1,0)|0,Te=Re()|0,N=E+(fe<<3)|0,A=N,W=y[A>>2]|0,A=y[A+4>>2]|0}while(!((W|0)==0&(A|0)==0))}(Je|0)==0&(je|0)==0?(N=B,W=F):(cu(Je,je,Zr)|0,dc(m,fn,Zr)|0&&(qe=He(B|0,F|0,1,0)|0,F=Re()|0,Te=N,y[Te>>2]=Je,y[Te+4>>2]=je,B=lr+(B<<3)|0,y[B>>2]=Je,y[B+4>>2]=je,B=qe),N=B,W=F)}while(!1);if(nt=nt+1|0,nt>>>0>=7)break;B=N,F=W}if(It=He(It|0,wt|0,1,0)|0,wt=Re()|0,at=He(at|0,bt|0,1,0)|0,bt=Re()|0,F=Hr,B=y[F>>2]|0,F=y[F+4>>2]|0,(bt|0)<(F|0)|(bt|0)==(F|0)&at>>>0<B>>>0)B=N,F=W;else break}if((F|0)>0|(F|0)==0&B>>>0>0){B=0,F=0;do bt=sr+(B<<3)|0,y[bt>>2]=0,y[bt+4>>2]=0,B=He(B|0,F|0,1,0)|0,F=Re()|0,bt=Hr,at=y[bt+4>>2]|0;while((F|0)<(at|0)|((F|0)==(at|0)?B>>>0<(y[bt>>2]|0)>>>0:0))}if(bt=Hr,y[bt>>2]=N,y[bt+4>>2]=W,(W|0)>0|(W|0)==0&N>>>0>0)nt=M,It=gr,wt=ni,at=ar,bt=lr,M=ft,gr=b,ar=mi,ft=nt,b=It,ni=ri,ri=wt,mi=at,lr=sr,sr=bt;else break t}De(mi),De(ri),De(fn),b=1;break e}else b=N;while(!1);De(fn),De(M),De(b),b=0}while(!1);return fn=b,we=Ro,fn|0}function tc(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0;if(fe=we,we=we+176|0,W=fe,(A|0)<1)return H(b,0,0),ee=0,we=fe,ee|0;for(N=m,N=mt(y[N>>2]|0,y[N+4>>2]|0,52)|0,Re()|0,H(b,(A|0)>6?A:6,N&15),N=0;E=m+(N<<3)|0,E=ra(y[E>>2]|0,y[E+4>>2]|0,W)|0,!(E|0);){if(E=y[W>>2]|0,(E|0)>0){F=0;do B=W+8+(F<<4)|0,F=F+1|0,E=W+8+(((F|0)%(E|0)|0)<<4)|0,M=ge(b,E,B)|0,M?ie(b,M)|0:de(b,B,E)|0,E=y[W>>2]|0;while((F|0)<(E|0))}if(N=N+1|0,(N|0)>=(A|0)){E=0,ee=13;break}}return(ee|0)==13?(we=fe,E|0):(Q(b),ee=E,we=fe,ee|0)}function Jc(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;if(B=we,we=we+32|0,E=B,M=B+16|0,m=tc(m,A,M)|0,m|0)return b=m,we=B,b|0;if(y[b>>2]=0,y[b+4>>2]=0,y[b+8>>2]=0,m=ne(M)|0,m|0)do{A=jf(b)|0;do gp(A,m)|0,F=m+16|0,y[E>>2]=y[F>>2],y[E+4>>2]=y[F+4>>2],y[E+8>>2]=y[F+8>>2],y[E+12>>2]=y[F+12>>2],ie(M,m)|0,m=Pe(M,E)|0;while(m|0);m=ne(M)|0}while(m|0);return Q(M),m=po(b)|0,m?(Gf(b),F=m,we=B,F|0):(F=0,we=B,F|0)}function yi(m){return m=m|0,m>>>0>121?(m=0,m|0):(m=y[7696+(m*28|0)+16>>2]|0,m|0)}function Tf(m){return m=m|0,(m|0)==4|(m|0)==117|0}function tp(m){return m=m|0,y[11120+((y[m>>2]|0)*216|0)+((y[m+4>>2]|0)*72|0)+((y[m+8>>2]|0)*24|0)+(y[m+12>>2]<<3)>>2]|0}function rp(m){return m=m|0,y[11120+((y[m>>2]|0)*216|0)+((y[m+4>>2]|0)*72|0)+((y[m+8>>2]|0)*24|0)+(y[m+12>>2]<<3)+4>>2]|0}function rc(m,A){m=m|0,A=A|0,m=7696+(m*28|0)|0,y[A>>2]=y[m>>2],y[A+4>>2]=y[m+4>>2],y[A+8>>2]=y[m+8>>2],y[A+12>>2]=y[m+12>>2]}function Ef(m,A){m=m|0,A=A|0;var b=0,E=0;if(A>>>0>20)return A=-1,A|0;do if((y[11120+(A*216|0)>>2]|0)!=(m|0))if((y[11120+(A*216|0)+8>>2]|0)!=(m|0))if((y[11120+(A*216|0)+16>>2]|0)!=(m|0))if((y[11120+(A*216|0)+24>>2]|0)!=(m|0))if((y[11120+(A*216|0)+32>>2]|0)!=(m|0))if((y[11120+(A*216|0)+40>>2]|0)!=(m|0))if((y[11120+(A*216|0)+48>>2]|0)!=(m|0))if((y[11120+(A*216|0)+56>>2]|0)!=(m|0))if((y[11120+(A*216|0)+64>>2]|0)!=(m|0))if((y[11120+(A*216|0)+72>>2]|0)!=(m|0))if((y[11120+(A*216|0)+80>>2]|0)!=(m|0))if((y[11120+(A*216|0)+88>>2]|0)!=(m|0))if((y[11120+(A*216|0)+96>>2]|0)!=(m|0))if((y[11120+(A*216|0)+104>>2]|0)!=(m|0))if((y[11120+(A*216|0)+112>>2]|0)!=(m|0))if((y[11120+(A*216|0)+120>>2]|0)!=(m|0))if((y[11120+(A*216|0)+128>>2]|0)!=(m|0))if((y[11120+(A*216|0)+136>>2]|0)==(m|0))m=2,b=1,E=2;else{if((y[11120+(A*216|0)+144>>2]|0)==(m|0)){m=0,b=2,E=0;break}if((y[11120+(A*216|0)+152>>2]|0)==(m|0)){m=0,b=2,E=1;break}if((y[11120+(A*216|0)+160>>2]|0)==(m|0)){m=0,b=2,E=2;break}if((y[11120+(A*216|0)+168>>2]|0)==(m|0)){m=1,b=2,E=0;break}if((y[11120+(A*216|0)+176>>2]|0)==(m|0)){m=1,b=2,E=1;break}if((y[11120+(A*216|0)+184>>2]|0)==(m|0)){m=1,b=2,E=2;break}if((y[11120+(A*216|0)+192>>2]|0)==(m|0)){m=2,b=2,E=0;break}if((y[11120+(A*216|0)+200>>2]|0)==(m|0)){m=2,b=2,E=1;break}if((y[11120+(A*216|0)+208>>2]|0)==(m|0)){m=2,b=2,E=2;break}else m=-1;return m|0}else m=2,b=1,E=1;else m=2,b=1,E=0;else m=1,b=1,E=2;else m=1,b=1,E=1;else m=1,b=1,E=0;else m=0,b=1,E=2;else m=0,b=1,E=1;else m=0,b=1,E=0;else m=2,b=0,E=2;else m=2,b=0,E=1;else m=2,b=0,E=0;else m=1,b=0,E=2;else m=1,b=0,E=1;else m=1,b=0,E=0;else m=0,b=0,E=2;else m=0,b=0,E=1;else m=0,b=0,E=0;while(!1);return A=y[11120+(A*216|0)+(b*72|0)+(m*24|0)+(E<<3)+4>>2]|0,A|0}function Ah(m,A){return m=m|0,A=A|0,(y[7696+(m*28|0)+20>>2]|0)==(A|0)?(A=1,A|0):(A=(y[7696+(m*28|0)+24>>2]|0)==(A|0),A|0)}function ic(m,A){return m=m|0,A=A|0,y[848+(m*28|0)+(A<<2)>>2]|0}function eu(m,A){return m=m|0,A=A|0,(y[848+(m*28|0)>>2]|0)==(A|0)?(A=0,A|0):(y[848+(m*28|0)+4>>2]|0)==(A|0)?(A=1,A|0):(y[848+(m*28|0)+8>>2]|0)==(A|0)?(A=2,A|0):(y[848+(m*28|0)+12>>2]|0)==(A|0)?(A=3,A|0):(y[848+(m*28|0)+16>>2]|0)==(A|0)?(A=4,A|0):(y[848+(m*28|0)+20>>2]|0)==(A|0)?(A=5,A|0):((y[848+(m*28|0)+24>>2]|0)==(A|0)?6:7)|0}function um(){return 122}function tu(m){m=m|0;var A=0,b=0,E=0;A=0;do Nt(A|0,0,45)|0,E=Re()|0|134225919,b=m+(A<<3)|0,y[b>>2]=-1,y[b+4>>2]=E,A=A+1|0;while((A|0)!=122);return 0}function nc(m){return m=m|0,+Ce[m+16>>3]<+Ce[m+24>>3]|0}function ip(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;return b=+Ce[A>>3],!(b>=+Ce[m+8>>3])||!(b<=+Ce[m>>3])?(A=0,A|0):(E=+Ce[m+16>>3],b=+Ce[m+24>>3],M=+Ce[A+8>>3],A=M>=b,m=M<=E&1,E<b?A&&(m=1):A||(m=0),A=(m|0)!=0,A|0)}function Cf(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0;je=we,we=we+288|0,fe=je+264|0,Te=je+96|0,ee=je,N=ee,W=N+96|0;do y[N>>2]=0,N=N+4|0;while((N|0)<(W|0));return A=uu(A,ee)|0,A|0?(Je=A,we=je,Je|0):(W=ee,ee=y[W>>2]|0,W=y[W+4>>2]|0,cu(ee,W,fe)|0,ra(ee,W,Te)|0,F=+hu(fe,Te+8|0),Ce[fe>>3]=+Ce[m>>3],W=fe+8|0,Ce[W>>3]=+Ce[m+16>>3],Ce[Te>>3]=+Ce[m+8>>3],ee=Te+8|0,Ce[ee>>3]=+Ce[m+24>>3],M=+hu(fe,Te),It=+Ce[W>>3]-+Ce[ee>>3],B=+Gi(+It),nt=+Ce[fe>>3]-+Ce[Te>>3],E=+Gi(+nt),!(It==0|nt==0)&&(It=+Bi(+B,+E),It=+xa(+(M*M/+$r(+(It/+$r(+B,+E)),3)/(F*(F*2.59807621135)*.8))),Ce[Rn>>3]=It,qe=~~It>>>0,Je=+Gi(It)>=1?It>0?~~+Ql(+ts(It/4294967296),4294967295)>>>0:~~+xa((It-+(~~It>>>0))/4294967296)>>>0:0,(y[Rn+4>>2]&2146435072|0)!=2146435072)?(Te=(qe|0)==0&(Je|0)==0,A=b,y[A>>2]=Te?1:qe,y[A+4>>2]=Te?0:Je,A=0):A=1,Je=A,we=je,Je|0)}function Si(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0,fe=0;ee=we,we=we+288|0,F=ee+264|0,N=ee+96|0,W=ee,M=W,B=M+96|0;do y[M>>2]=0,M=M+4|0;while((M|0)<(B|0));return b=uu(b,W)|0,b|0?(E=b,we=ee,E|0):(b=W,M=y[b>>2]|0,b=y[b+4>>2]|0,cu(M,b,F)|0,ra(M,b,N)|0,fe=+hu(F,N+8|0),fe=+xa(+(+hu(m,A)/(fe*2))),Ce[Rn>>3]=fe,b=~~fe>>>0,M=+Gi(fe)>=1?fe>0?~~+Ql(+ts(fe/4294967296),4294967295)>>>0:~~+xa((fe-+(~~fe>>>0))/4294967296)>>>0:0,(y[Rn+4>>2]&2146435072|0)==2146435072?(E=1,we=ee,E|0):(W=(b|0)==0&(M|0)==0,y[E>>2]=W?1:b,y[E+4>>2]=W?0:M,E=0,we=ee,E|0))}function Sf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0,y[m>>2]=A,y[m+4>>2]=b,y[m+8>>2]=E}function np(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0;Te=A+8|0,y[Te>>2]=0,W=+Ce[m>>3],F=+Gi(+W),ee=+Ce[m+8>>3],N=+Gi(+ee)/.8660254037844386,F=F+N*.5,b=~~F,m=~~N,F=F-+(b|0),N=N-+(m|0);do if(F<.5)if(F<.3333333333333333)if(y[A>>2]=b,N<(F+1)*.5){y[A+4>>2]=m;break}else{m=m+1|0,y[A+4>>2]=m;break}else if(qe=1-F,m=(!(N<qe)&1)+m|0,y[A+4>>2]=m,qe<=N&N<F*2){b=b+1|0,y[A>>2]=b;break}else{y[A>>2]=b;break}else{if(!(F<.6666666666666666))if(b=b+1|0,y[A>>2]=b,N<F*.5){y[A+4>>2]=m;break}else{m=m+1|0,y[A+4>>2]=m;break}if(N<1-F){if(y[A+4>>2]=m,F*2+-1<N){y[A>>2]=b;break}}else m=m+1|0,y[A+4>>2]=m;b=b+1|0,y[A>>2]=b}while(!1);do if(W<0)if(m&1){fe=(m+1|0)/2|0,fe=Xe(b|0,((b|0)<0)<<31>>31|0,fe|0,((fe|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-((+(fe>>>0)+4294967296*+(Re()|0))*2+1)),y[A>>2]=b;break}else{fe=(m|0)/2|0,fe=Xe(b|0,((b|0)<0)<<31>>31|0,fe|0,((fe|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-(+(fe>>>0)+4294967296*+(Re()|0))*2),y[A>>2]=b;break}while(!1);fe=A+4|0,ee<0&&(b=b-((m<<1|1|0)/2|0)|0,y[A>>2]=b,m=0-m|0,y[fe>>2]=m),E=m-b|0,(b|0)<0?(M=0-b|0,y[fe>>2]=E,y[Te>>2]=M,y[A>>2]=0,m=E,b=0):M=0,(m|0)<0&&(b=b-m|0,y[A>>2]=b,M=M-m|0,y[Te>>2]=M,y[fe>>2]=0,m=0),B=b-M|0,E=m-M|0,(M|0)<0&&(y[A>>2]=B,y[fe>>2]=E,y[Te>>2]=0,m=E,b=B,M=0),E=(m|0)<(b|0)?m:b,E=(M|0)<(E|0)?M:E,!((E|0)<=0)&&(y[A>>2]=b-E,y[fe>>2]=m-E,y[Te>>2]=M-E)}function xs(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0;A=y[m>>2]|0,F=m+4|0,b=y[F>>2]|0,(A|0)<0&&(b=b-A|0,y[F>>2]=b,B=m+8|0,y[B>>2]=(y[B>>2]|0)-A,y[m>>2]=0,A=0),(b|0)<0?(A=A-b|0,y[m>>2]=A,B=m+8|0,M=(y[B>>2]|0)-b|0,y[B>>2]=M,y[F>>2]=0,b=0):(M=m+8|0,B=M,M=y[M>>2]|0),(M|0)<0&&(A=A-M|0,y[m>>2]=A,b=b-M|0,y[F>>2]=b,y[B>>2]=0,M=0),E=(b|0)<(A|0)?b:A,E=(M|0)<(E|0)?M:E,!((E|0)<=0)&&(y[m>>2]=A-E,y[F>>2]=b-E,y[B>>2]=M-E)}function ea(m,A){m=m|0,A=A|0;var b=0,E=0;E=y[m+8>>2]|0,b=+((y[m+4>>2]|0)-E|0),Ce[A>>3]=+((y[m>>2]|0)-E|0)-b*.5,Ce[A+8>>3]=b*.8660254037844386}function Ks(m,A,b){m=m|0,A=A|0,b=b|0,y[b>>2]=(y[A>>2]|0)+(y[m>>2]|0),y[b+4>>2]=(y[A+4>>2]|0)+(y[m+4>>2]|0),y[b+8>>2]=(y[A+8>>2]|0)+(y[m+8>>2]|0)}function If(m,A,b){m=m|0,A=A|0,b=b|0,y[b>>2]=(y[m>>2]|0)-(y[A>>2]|0),y[b+4>>2]=(y[m+4>>2]|0)-(y[A+4>>2]|0),y[b+8>>2]=(y[m+8>>2]|0)-(y[A+8>>2]|0)}function sp(m,A){m=m|0,A=A|0;var b=0,E=0;b=ba(y[m>>2]|0,A)|0,y[m>>2]=b,b=m+4|0,E=ba(y[b>>2]|0,A)|0,y[b>>2]=E,m=m+8|0,A=ba(y[m>>2]|0,A)|0,y[m>>2]=A}function Mf(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=y[m>>2]|0,N=(F|0)<0,E=(y[m+4>>2]|0)-(N?F:0)|0,B=(E|0)<0,M=(B?0-E|0:0)+((y[m+8>>2]|0)-(N?F:0))|0,b=(M|0)<0,m=b?0:M,A=(B?0:E)-(b?M:0)|0,M=(N?0:F)-(B?E:0)-(b?M:0)|0,b=(A|0)<(M|0)?A:M,b=(m|0)<(b|0)?m:b,E=(b|0)>0,m=m-(E?b:0)|0,A=A-(E?b:0)|0;e:do switch(M-(E?b:0)|0){case 0:switch(A|0){case 0:return N=m|0?(m|0)==1?1:7:0,N|0;case 1:return N=m|0?(m|0)==1?3:7:2,N|0;default:break e}case 1:switch(A|0){case 0:return N=m|0?(m|0)==1?5:7:4,N|0;case 1:{if(!m)m=6;else break e;return m|0}default:break e}default:}while(!1);return N=7,N|0}function ru(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=m+8|0,M=y[F>>2]|0,B=(y[m>>2]|0)-M|0,N=m+4|0,M=(y[N>>2]|0)-M|0;do if(B>>>0>715827881|M>>>0>715827881){if(b=(B|0)>0,b){if((2147483647-B|0)<(B|0)||(2147483647-(B<<1)|0)<(B|0))return N=1,N|0}else if((-2147483648-B|0)>(B|0)||(-2147483648-(B<<1)|0)>(B|0))return N=1,N|0;if(A=B*3|0,(M|0)>0){if((2147483647-M|0)<(M|0))return N=1,N|0}else if((-2147483648-M|0)>(M|0))return N=1,N|0;if(E=M<<1,(B|0)>-1){if((A|-2147483648|0)>=(M|0))return N=1,N|0}else if((A^-2147483648|0)<(M|0))return N=1,N|0;if(b){if((2147483647-B|0)<(E|0))A=1;else{b=E;break}return A|0}else{if((-2147483648-B|0)>(E|0))A=1;else{b=E;break}return A|0}}else b=M<<1,A=B*3|0;while(!1);E=Ne(+(A-M|0)/7)|0,y[m>>2]=E,M=Ne(+(b+B|0)/7)|0,y[N>>2]=M,y[F>>2]=0,b=(M|0)<(E|0),A=b?E:M,b=b?M:E;do if((b|0)<0){if((A|0)>0){if((A|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-A|0)>=(b|0)))break;zr(23313,22444,355,22455)}if((b|0)==-2147483648|(-2147483648-A|0)>(b|0)&&zr(23313,22444,355,22455),(A|0)>-1){if((A|-2147483648|0)<(b|0))break;zr(23313,22444,355,22455)}else{if((A^-2147483648|0)>=(b|0))break;zr(23313,22444,355,22455)}}while(!1);return A=M-E|0,(E|0)<0?(b=0-E|0,y[N>>2]=A,y[F>>2]=b,y[m>>2]=0,E=0):(A=M,b=0),(A|0)<0&&(E=E-A|0,y[m>>2]=E,b=b-A|0,y[F>>2]=b,y[N>>2]=0,A=0),B=E-b|0,M=A-b|0,(b|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,A=M,M=B,b=0):M=E,E=(A|0)<(M|0)?A:M,E=(b|0)<(E|0)?b:E,(E|0)<=0?(N=0,N|0):(y[m>>2]=M-E,y[N>>2]=A-E,y[F>>2]=b-E,N=0,N|0)}function mh(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=m+8|0,M=y[F>>2]|0,B=(y[m>>2]|0)-M|0,N=m+4|0,M=(y[N>>2]|0)-M|0;do if(B>>>0>715827881|M>>>0>715827881){if(b=(B|0)>0,b){if((2147483647-B|0)<(B|0))return N=1,N|0}else if((-2147483648-B|0)>(B|0))return N=1,N|0;if(A=B<<1,(M|0)>0){if((2147483647-M|0)<(M|0)||(2147483647-(M<<1)|0)<(M|0))return N=1,N|0}else if((-2147483648-M|0)>(M|0)||(-2147483648-(M<<1)|0)>(M|0))return N=1,N|0;if(E=M*3|0,b){if((2147483647-A|0)<(M|0))return N=1,N|0}else if((-2147483648-A|0)>(M|0))return N=1,N|0;if((M|0)>-1){if((E|-2147483648|0)<(B|0)){b=E;break}else A=1;return A|0}else{if((E^-2147483648|0)<(B|0))A=1;else{b=E;break}return A|0}}else b=M*3|0,A=B<<1;while(!1);E=Ne(+(A+M|0)/7)|0,y[m>>2]=E,M=Ne(+(b-B|0)/7)|0,y[N>>2]=M,y[F>>2]=0,b=(M|0)<(E|0),A=b?E:M,b=b?M:E;do if((b|0)<0){if((A|0)>0){if((A|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-A|0)>=(b|0)))break;zr(23313,22444,404,22469)}if((b|0)==-2147483648|(-2147483648-A|0)>(b|0)&&zr(23313,22444,404,22469),(A|0)>-1){if((A|-2147483648|0)<(b|0))break;zr(23313,22444,404,22469)}else{if((A^-2147483648|0)>=(b|0))break;zr(23313,22444,404,22469)}}while(!1);return A=M-E|0,(E|0)<0?(b=0-E|0,y[N>>2]=A,y[F>>2]=b,y[m>>2]=0,E=0):(A=M,b=0),(A|0)<0&&(E=E-A|0,y[m>>2]=E,b=b-A|0,y[F>>2]=b,y[N>>2]=0,A=0),B=E-b|0,M=A-b|0,(b|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,A=M,M=B,b=0):M=E,E=(A|0)<(M|0)?A:M,E=(b|0)<(E|0)?b:E,(E|0)<=0?(N=0,N|0):(y[m>>2]=M-E,y[N>>2]=A-E,y[F>>2]=b-E,N=0,N|0)}function Pf(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=m+8|0,b=y[F>>2]|0,A=(y[m>>2]|0)-b|0,N=m+4|0,b=(y[N>>2]|0)-b|0,E=Ne(+((A*3|0)-b|0)/7)|0,y[m>>2]=E,A=Ne(+((b<<1)+A|0)/7)|0,y[N>>2]=A,y[F>>2]=0,b=A-E|0,(E|0)<0?(B=0-E|0,y[N>>2]=b,y[F>>2]=B,y[m>>2]=0,A=b,E=0,b=B):b=0,(A|0)<0&&(E=E-A|0,y[m>>2]=E,b=b-A|0,y[F>>2]=b,y[N>>2]=0,A=0),B=E-b|0,M=A-b|0,(b|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,A=M,M=B,b=0):M=E,E=(A|0)<(M|0)?A:M,E=(b|0)<(E|0)?b:E,!((E|0)<=0)&&(y[m>>2]=M-E,y[N>>2]=A-E,y[F>>2]=b-E)}function Rf(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=m+8|0,b=y[F>>2]|0,A=(y[m>>2]|0)-b|0,N=m+4|0,b=(y[N>>2]|0)-b|0,E=Ne(+((A<<1)+b|0)/7)|0,y[m>>2]=E,A=Ne(+((b*3|0)-A|0)/7)|0,y[N>>2]=A,y[F>>2]=0,b=A-E|0,(E|0)<0?(B=0-E|0,y[N>>2]=b,y[F>>2]=B,y[m>>2]=0,A=b,E=0,b=B):b=0,(A|0)<0&&(E=E-A|0,y[m>>2]=E,b=b-A|0,y[F>>2]=b,y[N>>2]=0,A=0),B=E-b|0,M=A-b|0,(b|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,A=M,M=B,b=0):M=E,E=(A|0)<(M|0)?A:M,E=(b|0)<(E|0)?b:E,!((E|0)<=0)&&(y[m>>2]=M-E,y[N>>2]=A-E,y[F>>2]=b-E)}function iu(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;A=y[m>>2]|0,F=m+4|0,b=y[F>>2]|0,N=m+8|0,E=y[N>>2]|0,M=b+(A*3|0)|0,y[m>>2]=M,b=E+(b*3|0)|0,y[F>>2]=b,A=(E*3|0)+A|0,y[N>>2]=A,E=b-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=E,y[N>>2]=A,y[m>>2]=0,b=E,E=0):E=M,(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=M,y[N>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[F>>2]=M-b,y[N>>2]=A-b)}function fl(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;M=y[m>>2]|0,F=m+4|0,A=y[F>>2]|0,N=m+8|0,b=y[N>>2]|0,E=(A*3|0)+M|0,M=b+(M*3|0)|0,y[m>>2]=M,y[F>>2]=E,A=(b*3|0)+A|0,y[N>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=b,y[N>>2]=A,y[m>>2]=0,M=0):b=E,(b|0)<0&&(M=M-b|0,y[m>>2]=M,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=M-A|0,E=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=E,y[N>>2]=0,M=B,A=0):E=b,b=(E|0)<(M|0)?E:M,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=M-b,y[F>>2]=E-b,y[N>>2]=A-b)}function gh(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0;(A+-1|0)>>>0>=6||(M=(y[15440+(A*12|0)>>2]|0)+(y[m>>2]|0)|0,y[m>>2]=M,N=m+4|0,E=(y[15440+(A*12|0)+4>>2]|0)+(y[N>>2]|0)|0,y[N>>2]=E,F=m+8|0,A=(y[15440+(A*12|0)+8>>2]|0)+(y[F>>2]|0)|0,y[F>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[N>>2]=b,y[F>>2]=A,y[m>>2]=0,E=0):(b=E,E=M),(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[F>>2]=A,y[N>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[N>>2]=M-b,y[F>>2]=A-b))}function nu(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;M=y[m>>2]|0,F=m+4|0,A=y[F>>2]|0,N=m+8|0,b=y[N>>2]|0,E=A+M|0,M=b+M|0,y[m>>2]=M,y[F>>2]=E,A=b+A|0,y[N>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=b,y[N>>2]=A,y[m>>2]=0,E=0):(b=E,E=M),(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=M,y[N>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[F>>2]=M-b,y[N>>2]=A-b)}function sc(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;A=y[m>>2]|0,F=m+4|0,E=y[F>>2]|0,N=m+8|0,b=y[N>>2]|0,M=E+A|0,y[m>>2]=M,E=b+E|0,y[F>>2]=E,A=b+A|0,y[N>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=b,y[N>>2]=A,y[m>>2]=0,E=0):(b=E,E=M),(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=M,y[N>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[F>>2]=M-b,y[N>>2]=A-b)}function oc(m){switch(m=m|0,m|0){case 1:{m=5;break}case 5:{m=4;break}case 4:{m=6;break}case 6:{m=2;break}case 2:{m=3;break}case 3:{m=1;break}default:}return m|0}function Ta(m){switch(m=m|0,m|0){case 1:{m=3;break}case 3:{m=2;break}case 2:{m=6;break}case 6:{m=4;break}case 4:{m=5;break}case 5:{m=1;break}default:}return m|0}function op(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;A=y[m>>2]|0,F=m+4|0,b=y[F>>2]|0,N=m+8|0,E=y[N>>2]|0,M=b+(A<<1)|0,y[m>>2]=M,b=E+(b<<1)|0,y[F>>2]=b,A=(E<<1)+A|0,y[N>>2]=A,E=b-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=E,y[N>>2]=A,y[m>>2]=0,b=E,E=0):E=M,(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=M,y[N>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[F>>2]=M-b,y[N>>2]=A-b)}function Bf(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;M=y[m>>2]|0,F=m+4|0,A=y[F>>2]|0,N=m+8|0,b=y[N>>2]|0,E=(A<<1)+M|0,M=b+(M<<1)|0,y[m>>2]=M,y[F>>2]=E,A=(b<<1)+A|0,y[N>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=b,y[N>>2]=A,y[m>>2]=0,M=0):b=E,(b|0)<0&&(M=M-b|0,y[m>>2]=M,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=M-A|0,E=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=E,y[N>>2]=0,M=B,A=0):E=b,b=(E|0)<(M|0)?E:M,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=M-b,y[F>>2]=E-b,y[N>>2]=A-b)}function ac(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0;return F=(y[m>>2]|0)-(y[A>>2]|0)|0,N=(F|0)<0,E=(y[m+4>>2]|0)-(y[A+4>>2]|0)-(N?F:0)|0,B=(E|0)<0,M=(N?0-F|0:0)+(y[m+8>>2]|0)-(y[A+8>>2]|0)+(B?0-E|0:0)|0,m=(M|0)<0,A=m?0:M,b=(B?0:E)-(m?M:0)|0,M=(N?0:F)-(B?E:0)-(m?M:0)|0,m=(b|0)<(M|0)?b:M,m=(A|0)<(m|0)?A:m,E=(m|0)>0,A=A-(E?m:0)|0,b=b-(E?m:0)|0,m=M-(E?m:0)|0,m=(m|0)>-1?m:0-m|0,b=(b|0)>-1?b:0-b|0,A=(A|0)>-1?A:0-A|0,A=(b|0)>(A|0)?b:A,((m|0)>(A|0)?m:A)|0}function Lf(m,A){m=m|0,A=A|0;var b=0;b=y[m+8>>2]|0,y[A>>2]=(y[m>>2]|0)-b,y[A+4>>2]=(y[m+4>>2]|0)-b}function Of(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0;E=y[m>>2]|0,y[A>>2]=E,M=y[m+4>>2]|0,F=A+4|0,y[F>>2]=M,N=A+8|0,y[N>>2]=0,b=(M|0)<(E|0),m=b?E:M,b=b?M:E;do if((b|0)<0){if((m|0)>0){if((m|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-m|0)>=(b|0)))break;return m=1,m|0}if((b|0)==-2147483648|(-2147483648-m|0)>(b|0))return A=1,A|0;if((m|0)>-1){if((m|-2147483648|0)<(b|0))break;return m=1,m|0}else{if((m^-2147483648|0)<(b|0))m=1;else break;return m|0}}while(!1);return m=M-E|0,(E|0)<0?(b=0-E|0,y[F>>2]=m,y[N>>2]=b,y[A>>2]=0,E=0):(m=M,b=0),(m|0)<0&&(E=E-m|0,y[A>>2]=E,b=b-m|0,y[N>>2]=b,y[F>>2]=0,m=0),B=E-b|0,M=m-b|0,(b|0)<0?(y[A>>2]=B,y[F>>2]=M,y[N>>2]=0,m=M,M=B,b=0):M=E,E=(m|0)<(M|0)?m:M,E=(b|0)<(E|0)?b:E,(E|0)<=0?(A=0,A|0):(y[A>>2]=M-E,y[F>>2]=m-E,y[N>>2]=b-E,A=0,A|0)}function _h(m){m=m|0;var A=0,b=0,E=0,M=0;A=m+8|0,M=y[A>>2]|0,b=M-(y[m>>2]|0)|0,y[m>>2]=b,E=m+4|0,m=(y[E>>2]|0)-M|0,y[E>>2]=m,y[A>>2]=0-(m+b)}function su(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;b=y[m>>2]|0,A=0-b|0,y[m>>2]=A,F=m+8|0,y[F>>2]=0,N=m+4|0,E=y[N>>2]|0,M=E+b|0,(b|0)>0?(y[N>>2]=M,y[F>>2]=b,y[m>>2]=0,A=0,E=M):b=0,(E|0)<0?(B=A-E|0,y[m>>2]=B,b=b-E|0,y[F>>2]=b,y[N>>2]=0,M=B-b|0,A=0-b|0,(b|0)<0?(y[m>>2]=M,y[N>>2]=A,y[F>>2]=0,E=A,b=0):(E=0,M=B)):M=A,A=(E|0)<(M|0)?E:M,A=(b|0)<(A|0)?b:A,!((A|0)<=0)&&(y[m>>2]=M-A,y[N>>2]=E-A,y[F>>2]=b-A)}function ou(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0;if(Te=we,we=we+64|0,fe=Te,N=Te+56|0,!(!0&(A&2013265920|0)==134217728&(!0&(E&2013265920|0)==134217728)))return M=5,we=Te,M|0;if((m|0)==(b|0)&(A|0)==(E|0))return y[M>>2]=0,M=0,we=Te,M|0;if(F=mt(m|0,A|0,52)|0,Re()|0,F=F&15,ee=mt(b|0,E|0,52)|0,Re()|0,(F|0)!=(ee&15|0))return M=12,we=Te,M|0;if(B=F+-1|0,F>>>0>1){Nf(m,A,B,fe)|0,Nf(b,E,B,N)|0,ee=fe,W=y[ee>>2]|0,ee=y[ee+4>>2]|0;e:do if((W|0)==(y[N>>2]|0)&&(ee|0)==(y[N+4>>2]|0)){F=(F^15)*3|0,B=mt(m|0,A|0,F|0)|0,Re()|0,B=B&7,F=mt(b|0,E|0,F|0)|0,Re()|0,F=F&7;do if((B|0)==0|(F|0)==0)y[M>>2]=1,B=0;else if((B|0)==7)B=5;else{if((B|0)==1|(F|0)==1&&Hi(W,ee)|0){B=5;break}if((y[15536+(B<<2)>>2]|0)!=(F|0)&&(y[15568+(B<<2)>>2]|0)!=(F|0))break e;y[M>>2]=1,B=0}while(!1);return M=B,we=Te,M|0}while(!1)}B=fe,F=B+56|0;do y[B>>2]=0,B=B+4|0;while((B|0)<(F|0));return am(m,A,1,fe)|0,A=fe,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0))&&(A=fe+8|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=fe+16|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=fe+24|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=fe+32|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=fe+40|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))?(B=fe+48|0,B=((y[B>>2]|0)==(b|0)?(y[B+4>>2]|0)==(E|0):0)&1):B=1,y[M>>2]=B,M=0,we=Te,M|0}function Vg(m,A,b,E,M){return m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,b=bf(m,A,b,E)|0,(b|0)==7?(M=11,M|0):(E=Nt(b|0,0,56)|0,A=A&-2130706433|(Re()|0)|268435456,y[M>>2]=m|E,y[M+4>>2]=A,M=0,M|0)}function hm(m,A,b){return m=m|0,A=A|0,b=b|0,!0&(A&2013265920|0)==268435456?(y[b>>2]=m,y[b+4>>2]=A&-2130706433|134217728,b=0,b|0):(b=6,b|0)}function Un(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;return M=we,we=we+16|0,E=M,y[E>>2]=0,!0&(A&2013265920|0)==268435456?(B=mt(m|0,A|0,56)|0,Re()|0,E=fs(m,A&-2130706433|134217728,B&7,E,b)|0,we=M,E|0):(E=6,we=M,E|0)}function lc(m,A){m=m|0,A=A|0;var b=0;switch(b=mt(m|0,A|0,56)|0,Re()|0,b&7){case 0:case 7:return b=0,b|0;default:}return b=A&-2130706433|134217728,!(!0&(A&2013265920|0)==268435456)||!0&(A&117440512|0)==16777216&(Hi(m,b)|0)!=0?(b=0,b|0):(b=kf(m,b)|0,b|0)}function zo(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;return M=we,we=we+16|0,E=M,!0&(A&2013265920|0)==268435456?(B=A&-2130706433|134217728,F=b,y[F>>2]=m,y[F+4>>2]=B,y[E>>2]=0,A=mt(m|0,A|0,56)|0,Re()|0,E=fs(m,B,A&7,E,b+8|0)|0,we=M,E|0):(E=6,we=M,E|0)}function ap(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;return M=(Hi(m,A)|0)==0,A=A&-2130706433,E=b,y[E>>2]=M?m:0,y[E+4>>2]=M?A|285212672:0,E=b+8|0,y[E>>2]=m,y[E+4>>2]=A|301989888,E=b+16|0,y[E>>2]=m,y[E+4>>2]=A|318767104,E=b+24|0,y[E>>2]=m,y[E+4>>2]=A|335544320,E=b+32|0,y[E>>2]=m,y[E+4>>2]=A|352321536,b=b+40|0,y[b>>2]=m,y[b+4>>2]=A|369098752,0}function cc(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;return F=we,we=we+16|0,M=F,B=A&-2130706433|134217728,!0&(A&2013265920|0)==268435456?(E=mt(m|0,A|0,56)|0,Re()|0,E=_(m,B,E&7)|0,(E|0)==-1?(y[b>>2]=0,B=6,we=F,B|0):(ta(m,B,M)|0&&zr(23313,22484,282,22499),A=mt(m|0,A|0,52)|0,Re()|0,A=A&15,Hi(m,B)|0?Df(M,A,E,2,b):Va(M,A,E,2,b),B=0,we=F,B|0)):(B=6,we=F,B|0)}function lp(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;E=we,we=we+16|0,M=E,Ua(m,A,b,M),np(M,b+4|0),we=E}function Ua(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0;if(N=we,we=we+16|0,W=N,yh(m,b,W),B=+im(+(1-+Ce[W>>3]*.5)),B<1e-16){y[E>>2]=0,y[E+4>>2]=0,y[E+8>>2]=0,y[E+12>>2]=0,we=N;return}if(W=y[b>>2]|0,M=+Ce[15920+(W*24|0)>>3],M=+hc(M-+hc(+Gg(15600+(W<<4)|0,m))),wn(A)|0?F=+hc(M+-.3334731722518321):F=M,M=+Kc(+B)/.381966011250105,(A|0)>0){m=0;do M=M*2.6457513110645907,m=m+1|0;while((m|0)!=(A|0))}B=+Ci(+F)*M,Ce[E>>3]=B,F=+Pi(+F)*M,Ce[E+8>>3]=F,we=N}function yh(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if(B=we,we=we+32|0,M=B,u(m,M),y[A>>2]=0,Ce[b>>3]=5,E=+o(16400,M),E<+Ce[b>>3]&&(y[A>>2]=0,Ce[b>>3]=E),E=+o(16424,M),E<+Ce[b>>3]&&(y[A>>2]=1,Ce[b>>3]=E),E=+o(16448,M),E<+Ce[b>>3]&&(y[A>>2]=2,Ce[b>>3]=E),E=+o(16472,M),E<+Ce[b>>3]&&(y[A>>2]=3,Ce[b>>3]=E),E=+o(16496,M),E<+Ce[b>>3]&&(y[A>>2]=4,Ce[b>>3]=E),E=+o(16520,M),E<+Ce[b>>3]&&(y[A>>2]=5,Ce[b>>3]=E),E=+o(16544,M),E<+Ce[b>>3]&&(y[A>>2]=6,Ce[b>>3]=E),E=+o(16568,M),E<+Ce[b>>3]&&(y[A>>2]=7,Ce[b>>3]=E),E=+o(16592,M),E<+Ce[b>>3]&&(y[A>>2]=8,Ce[b>>3]=E),E=+o(16616,M),E<+Ce[b>>3]&&(y[A>>2]=9,Ce[b>>3]=E),E=+o(16640,M),E<+Ce[b>>3]&&(y[A>>2]=10,Ce[b>>3]=E),E=+o(16664,M),E<+Ce[b>>3]&&(y[A>>2]=11,Ce[b>>3]=E),E=+o(16688,M),E<+Ce[b>>3]&&(y[A>>2]=12,Ce[b>>3]=E),E=+o(16712,M),E<+Ce[b>>3]&&(y[A>>2]=13,Ce[b>>3]=E),E=+o(16736,M),E<+Ce[b>>3]&&(y[A>>2]=14,Ce[b>>3]=E),E=+o(16760,M),E<+Ce[b>>3]&&(y[A>>2]=15,Ce[b>>3]=E),E=+o(16784,M),E<+Ce[b>>3]&&(y[A>>2]=16,Ce[b>>3]=E),E=+o(16808,M),E<+Ce[b>>3]&&(y[A>>2]=17,Ce[b>>3]=E),E=+o(16832,M),E<+Ce[b>>3]&&(y[A>>2]=18,Ce[b>>3]=E),E=+o(16856,M),!(E<+Ce[b>>3])){we=B;return}y[A>>2]=19,Ce[b>>3]=E,we=B}function dl(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0;if(B=+Sh(m),B<1e-16){A=15600+(A<<4)|0,y[M>>2]=y[A>>2],y[M+4>>2]=y[A+4>>2],y[M+8>>2]=y[A+8>>2],y[M+12>>2]=y[A+12>>2];return}if(F=+Po(+ +Ce[m+8>>3],+ +Ce[m>>3]),(b|0)>0){m=0;do B=B/2.6457513110645907,m=m+1|0;while((m|0)!=(b|0))}E?(B=B/3,b=(wn(b)|0)==0,B=+Qc(+((b?B:B/2.6457513110645907)*.381966011250105))):(B=+Qc(+(B*.381966011250105)),wn(b)|0&&(F=+hc(F+.3334731722518321))),Hg(15600+(A<<4)|0,+hc(+Ce[15920+(A*24|0)>>3]-F),B,M)}function cp(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;E=we,we=we+16|0,M=E,ea(m+4|0,M),dl(M,y[m>>2]|0,A,0,b),we=E}function Df(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,gr=0,sr=0,lr=0,mi=0,ri=0,ni=0,qr=0,jr=0,Hr=0,Vi=0,Zr=0;if(Hr=we,we=we+272|0,B=Hr+256|0,at=Hr+240|0,ni=Hr,qr=Hr+224|0,jr=Hr+208|0,bt=Hr+176|0,ft=Hr+160|0,ar=Hr+192|0,gr=Hr+144|0,sr=Hr+128|0,lr=Hr+112|0,mi=Hr+96|0,ri=Hr+80|0,y[B>>2]=A,y[at>>2]=y[m>>2],y[at+4>>2]=y[m+4>>2],y[at+8>>2]=y[m+8>>2],y[at+12>>2]=y[m+12>>2],Ff(at,B,ni),y[M>>2]=0,at=E+b+((E|0)==5&1)|0,(at|0)<=(b|0)){we=Hr;return}W=y[B>>2]|0,ee=qr+4|0,fe=bt+4|0,Te=b+5|0,qe=16880+(W<<2)|0,Je=16960+(W<<2)|0,je=sr+8|0,nt=lr+8|0,It=mi+8|0,wt=jr+4|0,N=b;e:for(;;){F=ni+(((N|0)%5|0)<<4)|0,y[jr>>2]=y[F>>2],y[jr+4>>2]=y[F+4>>2],y[jr+8>>2]=y[F+8>>2],y[jr+12>>2]=y[F+12>>2];do;while((pl(jr,W,0,1)|0)==2);if((N|0)>(b|0)&(wn(A)|0)!=0){if(y[bt>>2]=y[jr>>2],y[bt+4>>2]=y[jr+4>>2],y[bt+8>>2]=y[jr+8>>2],y[bt+12>>2]=y[jr+12>>2],ea(ee,ft),E=y[bt>>2]|0,B=y[17040+(E*80|0)+(y[qr>>2]<<2)>>2]|0,y[bt>>2]=y[18640+(E*80|0)+(B*20|0)>>2],F=y[18640+(E*80|0)+(B*20|0)+16>>2]|0,(F|0)>0){m=0;do nu(fe),m=m+1|0;while((m|0)<(F|0))}switch(F=18640+(E*80|0)+(B*20|0)+4|0,y[ar>>2]=y[F>>2],y[ar+4>>2]=y[F+4>>2],y[ar+8>>2]=y[F+8>>2],sp(ar,(y[qe>>2]|0)*3|0),Ks(fe,ar,fe),xs(fe),ea(fe,gr),Vi=+(y[Je>>2]|0),Ce[sr>>3]=Vi*3,Ce[je>>3]=0,Zr=Vi*-1.5,Ce[lr>>3]=Zr,Ce[nt>>3]=Vi*2.598076211353316,Ce[mi>>3]=Zr,Ce[It>>3]=Vi*-2.598076211353316,y[17040+((y[bt>>2]|0)*80|0)+(y[jr>>2]<<2)>>2]|0){case 1:{m=lr,E=sr;break}case 3:{m=mi,E=lr;break}case 2:{m=sr,E=mi;break}default:{m=12;break e}}$f(ft,gr,E,m,ri),dl(ri,y[bt>>2]|0,W,1,M+8+(y[M>>2]<<4)|0),y[M>>2]=(y[M>>2]|0)+1}if((N|0)<(Te|0)&&(ea(wt,bt),dl(bt,y[jr>>2]|0,W,1,M+8+(y[M>>2]<<4)|0),y[M>>2]=(y[M>>2]|0)+1),y[qr>>2]=y[jr>>2],y[qr+4>>2]=y[jr+4>>2],y[qr+8>>2]=y[jr+8>>2],y[qr+12>>2]=y[jr+12>>2],N=N+1|0,(N|0)>=(at|0)){m=3;break}}if((m|0)==3){we=Hr;return}else(m|0)==12&&zr(22522,22569,571,22579)}function Ff(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0;W=we,we=we+128|0,E=W+64|0,M=W,B=E,F=20240,N=B+60|0;do y[B>>2]=y[F>>2],B=B+4|0,F=F+4|0;while((B|0)<(N|0));B=M,F=20304,N=B+60|0;do y[B>>2]=y[F>>2],B=B+4|0,F=F+4|0;while((B|0)<(N|0));N=(wn(y[A>>2]|0)|0)==0,E=N?E:M,M=m+4|0,op(M),Bf(M),wn(y[A>>2]|0)|0&&(fl(M),y[A>>2]=(y[A>>2]|0)+1),y[b>>2]=y[m>>2],A=b+4|0,Ks(M,E,A),xs(A),y[b+16>>2]=y[m>>2],A=b+20|0,Ks(M,E+12|0,A),xs(A),y[b+32>>2]=y[m>>2],A=b+36|0,Ks(M,E+24|0,A),xs(A),y[b+48>>2]=y[m>>2],A=b+52|0,Ks(M,E+36|0,A),xs(A),y[b+64>>2]=y[m>>2],b=b+68|0,Ks(M,E+48|0,b),xs(b),we=W}function pl(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0;if(je=we,we=we+32|0,qe=je+12|0,N=je,Je=m+4|0,Te=y[16960+(A<<2)>>2]|0,fe=(E|0)!=0,Te=fe?Te*3|0:Te,M=y[Je>>2]|0,ee=m+8|0,F=y[ee>>2]|0,fe){if(B=m+12|0,E=y[B>>2]|0,M=F+M+E|0,(M|0)==(Te|0))return Je=1,we=je,Je|0;W=B}else W=m+12|0,E=y[W>>2]|0,M=F+M+E|0;if((M|0)<=(Te|0))return Je=0,we=je,Je|0;do if((E|0)>0){if(E=y[m>>2]|0,(F|0)>0){B=18640+(E*80|0)+60|0,E=m;break}E=18640+(E*80|0)+40|0,b?(Sf(qe,Te,0,0),If(Je,qe,N),sc(N),Ks(N,qe,Je),B=E,E=m):(B=E,E=m)}else B=18640+((y[m>>2]|0)*80|0)+20|0,E=m;while(!1);if(y[E>>2]=y[B>>2],M=B+16|0,(y[M>>2]|0)>0){E=0;do nu(Je),E=E+1|0;while((E|0)<(y[M>>2]|0))}return m=B+4|0,y[qe>>2]=y[m>>2],y[qe+4>>2]=y[m+4>>2],y[qe+8>>2]=y[m+8>>2],A=y[16880+(A<<2)>>2]|0,sp(qe,fe?A*3|0:A),Ks(Je,qe,Je),xs(Je),fe?E=((y[ee>>2]|0)+(y[Je>>2]|0)+(y[W>>2]|0)|0)==(Te|0)?1:2:E=2,Je=E,we=je,Je|0}function au(m,A){m=m|0,A=A|0;var b=0;do b=pl(m,A,0,1)|0;while((b|0)==2);return b|0}function Va(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,gr=0,sr=0,lr=0,mi=0,ri=0,ni=0;if(mi=we,we=we+240|0,B=mi+224|0,ar=mi+208|0,gr=mi,sr=mi+192|0,lr=mi+176|0,It=mi+160|0,wt=mi+144|0,at=mi+128|0,bt=mi+112|0,ft=mi+96|0,y[B>>2]=A,y[ar>>2]=y[m>>2],y[ar+4>>2]=y[m+4>>2],y[ar+8>>2]=y[m+8>>2],y[ar+12>>2]=y[m+12>>2],up(ar,B,gr),y[M>>2]=0,nt=E+b+((E|0)==6&1)|0,(nt|0)<=(b|0)){we=mi;return}W=y[B>>2]|0,ee=b+6|0,fe=16960+(W<<2)|0,Te=wt+8|0,qe=at+8|0,Je=bt+8|0,je=sr+4|0,F=0,N=b,E=-1;e:for(;;){if(B=(N|0)%6|0,m=gr+(B<<4)|0,y[sr>>2]=y[m>>2],y[sr+4>>2]=y[m+4>>2],y[sr+8>>2]=y[m+8>>2],y[sr+12>>2]=y[m+12>>2],m=F,F=pl(sr,W,0,1)|0,(N|0)>(b|0)&(wn(A)|0)!=0&&(m|0)!=1&&(y[sr>>2]|0)!=(E|0)){switch(ea(gr+(((B+5|0)%6|0)<<4)+4|0,lr),ea(gr+(B<<4)+4|0,It),ri=+(y[fe>>2]|0),Ce[wt>>3]=ri*3,Ce[Te>>3]=0,ni=ri*-1.5,Ce[at>>3]=ni,Ce[qe>>3]=ri*2.598076211353316,Ce[bt>>3]=ni,Ce[Je>>3]=ri*-2.598076211353316,B=y[ar>>2]|0,y[17040+(B*80|0)+(((E|0)==(B|0)?y[sr>>2]|0:E)<<2)>>2]|0){case 1:{m=at,E=wt;break}case 3:{m=bt,E=at;break}case 2:{m=wt,E=bt;break}default:{m=8;break e}}$f(lr,It,E,m,ft),!(C(lr,ft)|0)&&!(C(It,ft)|0)&&(dl(ft,y[ar>>2]|0,W,1,M+8+(y[M>>2]<<4)|0),y[M>>2]=(y[M>>2]|0)+1)}if((N|0)<(ee|0)&&(ea(je,lr),dl(lr,y[sr>>2]|0,W,1,M+8+(y[M>>2]<<4)|0),y[M>>2]=(y[M>>2]|0)+1),N=N+1|0,(N|0)>=(nt|0)){m=3;break}else E=y[sr>>2]|0}if((m|0)==3){we=mi;return}else(m|0)==8&&zr(22606,22569,736,22651)}function up(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0;W=we,we=we+160|0,E=W+80|0,M=W,B=E,F=20368,N=B+72|0;do y[B>>2]=y[F>>2],B=B+4|0,F=F+4|0;while((B|0)<(N|0));B=M,F=20448,N=B+72|0;do y[B>>2]=y[F>>2],B=B+4|0,F=F+4|0;while((B|0)<(N|0));N=(wn(y[A>>2]|0)|0)==0,E=N?E:M,M=m+4|0,op(M),Bf(M),wn(y[A>>2]|0)|0&&(fl(M),y[A>>2]=(y[A>>2]|0)+1),y[b>>2]=y[m>>2],A=b+4|0,Ks(M,E,A),xs(A),y[b+16>>2]=y[m>>2],A=b+20|0,Ks(M,E+12|0,A),xs(A),y[b+32>>2]=y[m>>2],A=b+36|0,Ks(M,E+24|0,A),xs(A),y[b+48>>2]=y[m>>2],A=b+52|0,Ks(M,E+36|0,A),xs(A),y[b+64>>2]=y[m>>2],A=b+68|0,Ks(M,E+48|0,A),xs(A),y[b+80>>2]=y[m>>2],b=b+84|0,Ks(M,E+60|0,b),xs(b),we=W}function fm(m,A){return m=m|0,A=A|0,A=mt(m|0,A|0,52)|0,Re()|0,A&15|0}function hp(m,A){return m=m|0,A=A|0,A=mt(m|0,A|0,45)|0,Re()|0,A&127|0}function kf(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0;if(!(!0&(A&-16777216|0)==134217728)||(F=mt(m|0,A|0,45)|0,Re()|0,F=F&127,F>>>0>121))return A=0,A|0;b=mt(m|0,A|0,52)|0,Re()|0,b=b&15;do if(b|0){for(M=1,E=0;;){if(B=mt(m|0,A|0,(15-M|0)*3|0)|0,Re()|0,B=B&7,(B|0)!=0&(E^1))if((B|0)==1&(yi(F)|0)!=0){N=0,E=13;break}else E=1;if((B|0)==7){N=0,E=13;break}if(M>>>0<b>>>0)M=M+1|0;else{E=9;break}}if((E|0)==9){if((b|0)==15)N=1;else break;return N|0}else if((E|0)==13)return N|0}while(!1);for(;;){if(N=mt(m|0,A|0,(14-b|0)*3|0)|0,Re()|0,!((N&7|0)==7&!0)){N=0,E=13;break}if(b>>>0<14)b=b+1|0;else{N=1,E=13;break}}return(E|0)==13?N|0:0}function Nf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0;if(B=mt(m|0,A|0,52)|0,Re()|0,B=B&15,b>>>0>15)return E=4,E|0;if((B|0)<(b|0))return E=12,E|0;if((B|0)==(b|0))return y[E>>2]=m,y[E+4>>2]=A,E=0,E|0;if(M=Nt(b|0,0,52)|0,M=M|m,m=Re()|0|A&-15728641,(B|0)>(b|0))do A=Nt(7,0,(14-b|0)*3|0)|0,b=b+1|0,M=A|M,m=Re()|0|m;while((b|0)<(B|0));return y[E>>2]=M,y[E+4>>2]=m,E=0,E|0}function ja(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0;if(B=mt(m|0,A|0,52)|0,Re()|0,B=B&15,!((b|0)<16&(B|0)<=(b|0)))return E=4,E|0;M=b-B|0,b=mt(m|0,A|0,45)|0,Re()|0;e:do if(!(yi(b&127)|0))b=bs(7,0,M,((M|0)<0)<<31>>31)|0,M=Re()|0;else{t:do if(B|0){for(b=1;F=Nt(7,0,(15-b|0)*3|0)|0,!!((F&m|0)==0&((Re()|0)&A|0)==0);)if(b>>>0<B>>>0)b=b+1|0;else break t;b=bs(7,0,M,((M|0)<0)<<31>>31)|0,M=Re()|0;break e}while(!1);b=bs(7,0,M,((M|0)<0)<<31>>31)|0,b=Tt(b|0,Re()|0,5,0)|0,b=He(b|0,Re()|0,-5,-1)|0,b=Pt(b|0,Re()|0,6,0)|0,b=He(b|0,Re()|0,1,0)|0,M=Re()|0}while(!1);return F=E,y[F>>2]=b,y[F+4>>2]=M,F=0,F|0}function Hi(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;if(M=mt(m|0,A|0,45)|0,Re()|0,!(yi(M&127)|0))return M=0,M|0;M=mt(m|0,A|0,52)|0,Re()|0,M=M&15;e:do if(!M)b=0;else for(E=1;;){if(b=mt(m|0,A|0,(15-E|0)*3|0)|0,Re()|0,b=b&7,b|0)break e;if(E>>>0<M>>>0)E=E+1|0;else{b=0;break}}while(!1);return M=(b|0)==0&1,M|0}function ks(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0;if(F=we,we=we+16|0,B=F,dp(B,m,A,b),A=B,m=y[A>>2]|0,A=y[A+4>>2]|0,(m|0)==0&(A|0)==0)return we=F,0;M=0,b=0;do N=E+(M<<3)|0,y[N>>2]=m,y[N+4>>2]=A,M=He(M|0,b|0,1,0)|0,b=Re()|0,Am(B),N=B,m=y[N>>2]|0,A=y[N+4>>2]|0;while(!((m|0)==0&(A|0)==0));return we=F,0}function lu(m,A,b,E){return m=m|0,A=A|0,b=b|0,E=E|0,(E|0)<(b|0)?(b=A,E=m,Qr(b|0),E|0):(b=Nt(-1,-1,((E-b|0)*3|0)+3|0)|0,E=Nt(~b|0,~(Re()|0)|0,(15-E|0)*3|0)|0,b=~(Re()|0)&A,E=~E&m,Qr(b|0),E|0)}function Uo(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0;return M=mt(m|0,A|0,52)|0,Re()|0,M=M&15,(b|0)<16&(M|0)<=(b|0)?((M|0)<(b|0)&&(M=Nt(-1,-1,((b+-1-M|0)*3|0)+3|0)|0,M=Nt(~M|0,~(Re()|0)|0,(15-b|0)*3|0)|0,A=~(Re()|0)&A,m=~M&m),M=Nt(b|0,0,52)|0,b=A&-15728641|(Re()|0),y[E>>2]=m|M,y[E+4>>2]=b,E=0,E|0):(E=4,E|0)}function Ea(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,gr=0,sr=0,lr=0;if((b|0)==0&(E|0)==0)return sr=0,sr|0;if(M=m,B=y[M>>2]|0,M=y[M+4>>2]|0,!0&(M&15728640|0)==0){if(!((E|0)>0|(E|0)==0&b>>>0>0)||(sr=A,y[sr>>2]=B,y[sr+4>>2]=M,(b|0)==1&(E|0)==0))return sr=0,sr|0;M=1;do ar=m+(M<<3)|0,gr=y[ar+4>>2]|0,sr=A+(M<<3)|0,y[sr>>2]=y[ar>>2],y[sr+4>>2]=gr,M=M+1|0;while(0<(E|0)|(E|0)==0&M>>>0<b>>>0);return M=0,M|0}if(ft=b<<3,gr=Ge(ft)|0,!gr)return sr=13,sr|0;if(Zi(gr|0,m|0,ft|0)|0,ar=Ze(b,8)|0,!ar)return De(gr),sr=13,sr|0;e:do if(b|0){t:for(;;){M=gr,wt=y[M>>2]|0,M=y[M+4>>2]|0,at=mt(wt|0,M|0,52)|0,Re()|0,at=at&15,bt=at+-1|0,It=(b|0)>0;r:do if((at|0)!=0&It){if(Je=((b|0)<0)<<31>>31,je=Nt(bt|0,0,52)|0,nt=Re()|0,bt>>>0>15){if(!((wt|0)==0&(M|0)==0)){sr=17;break t}for(B=0;;){if(B=B+1|0,(B|0)>=(b|0))break r;if(E=gr+(B<<3)|0,nt=y[E>>2]|0,E=y[E+4>>2]|0,!((nt|0)==0&(E|0)==0)){M=E,sr=17;break t}}}for(B=0,m=wt,E=M;;){if(!((m|0)==0&(E|0)==0)){if(!(!0&(E&117440512|0)==0)){sr=22;break t}if(N=mt(m|0,E|0,52)|0,Re()|0,N=N&15,(N|0)<(bt|0)){M=12,sr=28;break t}if((N|0)!=(bt|0)&&(m=m|je,E=E&-15728641|nt,N>>>0>=at>>>0)){F=bt;do qe=Nt(7,0,(14-F|0)*3|0)|0,F=F+1|0,m=qe|m,E=Re()|0|E;while(F>>>0<N>>>0)}if(F=Kt(m|0,E|0,b|0,Je|0)|0,Re()|0,ee=ar+(F<<3)|0,N=ee,W=y[N>>2]|0,N=y[N+4>>2]|0,(W|0)==0&(N|0)==0)F=ee;else for(qe=0;;){if((qe|0)>(b|0)){sr=32;break t}if((W|0)==(m|0)&(N&-117440513|0)==(E|0)){fe=mt(W|0,N|0,56)|0,Re()|0,fe=fe&7,Te=fe+1|0,lr=mt(W|0,N|0,45)|0,Re()|0;i:do if(!(yi(lr&127)|0))N=7;else{if(W=mt(W|0,N|0,52)|0,Re()|0,W=W&15,!W){N=6;break}for(N=1;;){if(lr=Nt(7,0,(15-N|0)*3|0)|0,!((lr&m|0)==0&((Re()|0)&E|0)==0)){N=7;break i}if(N>>>0<W>>>0)N=N+1|0;else{N=6;break}}}while(!1);if((fe+2|0)>>>0>N>>>0){sr=42;break t}lr=Nt(Te|0,0,56)|0,E=Re()|0|E&-117440513,Te=ee,y[Te>>2]=0,y[Te+4>>2]=0,m=lr|m}else F=(F+1|0)%(b|0)|0;if(ee=ar+(F<<3)|0,N=ee,W=y[N>>2]|0,N=y[N+4>>2]|0,(W|0)==0&(N|0)==0){F=ee;break}else qe=qe+1|0}lr=F,y[lr>>2]=m,y[lr+4>>2]=E}if(B=B+1|0,(B|0)>=(b|0))break r;E=gr+(B<<3)|0,m=y[E>>2]|0,E=y[E+4>>2]|0}}while(!1);if((b+5|0)>>>0<11){sr=85;break}if(nt=Ze((b|0)/6|0,8)|0,!nt){sr=49;break}r:do if(It){qe=0,Te=0;do{if(N=ar+(qe<<3)|0,E=N,B=y[E>>2]|0,E=y[E+4>>2]|0,!((B|0)==0&(E|0)==0)){W=mt(B|0,E|0,56)|0,Re()|0,W=W&7,m=W+1|0,ee=E&-117440513,lr=mt(B|0,E|0,45)|0,Re()|0;i:do if(yi(lr&127)|0){if(fe=mt(B|0,E|0,52)|0,Re()|0,fe=fe&15,fe|0)for(F=1;;){if(lr=Nt(7,0,(15-F|0)*3|0)|0,!((B&lr|0)==0&(ee&(Re()|0)|0)==0))break i;if(F>>>0<fe>>>0)F=F+1|0;else break}E=Nt(m|0,0,56)|0,B=E|B,E=Re()|0|ee,m=N,y[m>>2]=B,y[m+4>>2]=E,m=W+2|0}while(!1);(m|0)==7&&(lr=nt+(Te<<3)|0,y[lr>>2]=B,y[lr+4>>2]=E&-117440513,Te=Te+1|0)}qe=qe+1|0}while((qe|0)!=(b|0));if(It){if(qe=((b|0)<0)<<31>>31,Je=Nt(bt|0,0,52)|0,je=Re()|0,bt>>>0>15){if(!((wt|0)==0&(M|0)==0)){M=4,sr=84;break t}for(M=0;;){if(M=M+1|0,(M|0)>=(b|0)){B=0,M=Te;break r}if(lr=gr+(M<<3)|0,!((y[lr>>2]|0)==0&(y[lr+4>>2]|0)==0)){M=4,sr=84;break t}}}for(fe=0,B=0,ee=wt;;){do if(!((ee|0)==0&(M|0)==0)){if(N=mt(ee|0,M|0,52)|0,Re()|0,N=N&15,(N|0)<(bt|0)){M=12,sr=84;break t}do if((N|0)==(bt|0))E=ee,N=M;else{if(E=ee|Je,m=M&-15728641|je,N>>>0<at>>>0){N=m;break}F=bt;do lr=Nt(7,0,(14-F|0)*3|0)|0,F=F+1|0,E=lr|E,m=Re()|0|m;while(F>>>0<N>>>0);N=m}while(!1);for(F=Kt(E|0,N|0,b|0,qe|0)|0,Re()|0,m=0;;){if((m|0)>(b|0)){sr=77;break t}if(lr=ar+(F<<3)|0,W=y[lr+4>>2]|0,(W&-117440513|0)==(N|0)&&(y[lr>>2]|0)==(E|0)){sr=79;break}if(F=(F+1|0)%(b|0)|0,lr=ar+(F<<3)|0,(y[lr>>2]|0)==(E|0)&&(y[lr+4>>2]|0)==(N|0))break;m=m+1|0}if((sr|0)==79&&(sr=0,!0&(W&117440512|0)==100663296))break;lr=A+(B<<3)|0,y[lr>>2]=ee,y[lr+4>>2]=M,B=B+1|0}while(!1);if(M=fe+1|0,(M|0)>=(b|0)){M=Te;break r}lr=gr+(M<<3)|0,fe=M,ee=y[lr>>2]|0,M=y[lr+4>>2]|0}}else B=0,M=Te}else B=0,M=0;while(!1);if(Ui(ar|0,0,ft|0)|0,Zi(gr|0,nt|0,M<<3|0)|0,De(nt),M)A=A+(B<<3)|0,b=M;else break e}if((sr|0)==17)!0&(M&117440512|0)==0?(M=4,sr=28):sr=22;else if((sr|0)==32)zr(23313,22674,362,22684);else{if((sr|0)==42)return De(gr),De(ar),lr=10,lr|0;if((sr|0)==49)return De(gr),De(ar),lr=13,lr|0;if((sr|0)==77)zr(23313,22674,462,22684);else{if((sr|0)==84)return De(nt),De(gr),De(ar),lr=M,lr|0;if((sr|0)==85){Zi(A|0,gr|0,b<<3|0)|0;break}}}if((sr|0)==22)return De(gr),De(ar),lr=5,lr|0;if((sr|0)==28)return De(gr),De(ar),lr=M,lr|0}while(!1);return De(gr),De(ar),lr=0,lr|0}function dm(m,A,b,E,M,B,F){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0,F=F|0;var N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0;if(nt=we,we=we+16|0,je=nt,!((b|0)>0|(b|0)==0&A>>>0>0))return je=0,we=nt,je|0;if((F|0)>=16)return je=12,we=nt,je|0;qe=0,Je=0,Te=0,N=0;e:for(;;){if(ee=m+(qe<<3)|0,W=y[ee>>2]|0,ee=y[ee+4>>2]|0,fe=mt(W|0,ee|0,52)|0,Re()|0,(fe&15|0)>(F|0)){N=12,W=11;break}if(dp(je,W,ee,F),fe=je,ee=y[fe>>2]|0,fe=y[fe+4>>2]|0,(ee|0)==0&(fe|0)==0)W=Te;else{W=Te;do{if(!((N|0)<(B|0)|(N|0)==(B|0)&W>>>0<M>>>0)){W=10;break e}Te=E+(W<<3)|0,y[Te>>2]=ee,y[Te+4>>2]=fe,W=He(W|0,N|0,1,0)|0,N=Re()|0,Am(je),Te=je,ee=y[Te>>2]|0,fe=y[Te+4>>2]|0}while(!((ee|0)==0&(fe|0)==0))}if(qe=He(qe|0,Je|0,1,0)|0,Je=Re()|0,(Je|0)<(b|0)|(Je|0)==(b|0)&qe>>>0<A>>>0)Te=W;else{N=0,W=11;break}}return(W|0)==10?(je=14,we=nt,je|0):(W|0)==11?(we=nt,N|0):0}function fo(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0;qe=we,we=we+16|0,Te=qe;e:do if((b|0)>0|(b|0)==0&A>>>0>0){for(ee=0,F=0,B=0,fe=0;;){if(W=m+(ee<<3)|0,N=y[W>>2]|0,W=y[W+4>>2]|0,!((N|0)==0&(W|0)==0)&&(W=(ja(N,W,E,Te)|0)==0,N=Te,F=He(y[N>>2]|0,y[N+4>>2]|0,F|0,B|0)|0,B=Re()|0,!W)){B=12;break}if(ee=He(ee|0,fe|0,1,0)|0,fe=Re()|0,!((fe|0)<(b|0)|(fe|0)==(b|0)&ee>>>0<A>>>0))break e}return we=qe,B|0}else F=0,B=0;while(!1);return y[M>>2]=F,y[M+4>>2]=B,M=0,we=qe,M|0}function uc(m,A){return m=m|0,A=A|0,A=mt(m|0,A|0,52)|0,Re()|0,A&1|0}function Ns(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;if(M=mt(m|0,A|0,52)|0,Re()|0,M=M&15,!M)return M=0,M|0;for(E=1;;){if(b=mt(m|0,A|0,(15-E|0)*3|0)|0,Re()|0,b=b&7,b|0){E=5;break}if(E>>>0<M>>>0)E=E+1|0;else{b=0,E=5;break}}return(E|0)==5?b|0:0}function fp(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0;if(W=mt(m|0,A|0,52)|0,Re()|0,W=W&15,!W)return N=A,W=m,Qr(N|0),W|0;for(N=1,b=0;;){B=(15-N|0)*3|0,E=Nt(7,0,B|0)|0,M=Re()|0,F=mt(m|0,A|0,B|0)|0,Re()|0,B=Nt(oc(F&7)|0,0,B|0)|0,F=Re()|0,m=B|m&~E,A=F|A&~M;e:do if(!b)if((B&E|0)==0&(F&M|0)==0)b=0;else if(E=mt(m|0,A|0,52)|0,Re()|0,E=E&15,!E)b=1;else{b=1;t:for(;;){switch(F=mt(m|0,A|0,(15-b|0)*3|0)|0,Re()|0,F&7){case 1:break t;case 0:break;default:{b=1;break e}}if(b>>>0<E>>>0)b=b+1|0;else{b=1;break e}}for(b=1;;)if(F=(15-b|0)*3|0,M=mt(m|0,A|0,F|0)|0,Re()|0,B=Nt(7,0,F|0)|0,A=A&~(Re()|0),F=Nt(oc(M&7)|0,0,F|0)|0,m=m&~B|F,A=A|(Re()|0),b>>>0<E>>>0)b=b+1|0;else{b=1;break}}while(!1);if(N>>>0<W>>>0)N=N+1|0;else break}return Qr(A|0),m|0}function Ga(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0;if(E=mt(m|0,A|0,52)|0,Re()|0,E=E&15,!E)return b=A,E=m,Qr(b|0),E|0;for(b=1;B=(15-b|0)*3|0,F=mt(m|0,A|0,B|0)|0,Re()|0,M=Nt(7,0,B|0)|0,A=A&~(Re()|0),B=Nt(oc(F&7)|0,0,B|0)|0,m=B|m&~M,A=Re()|0|A,b>>>0<E>>>0;)b=b+1|0;return Qr(A|0),m|0}function jg(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0;if(W=mt(m|0,A|0,52)|0,Re()|0,W=W&15,!W)return N=A,W=m,Qr(N|0),W|0;for(N=1,b=0;;){B=(15-N|0)*3|0,E=Nt(7,0,B|0)|0,M=Re()|0,F=mt(m|0,A|0,B|0)|0,Re()|0,B=Nt(Ta(F&7)|0,0,B|0)|0,F=Re()|0,m=B|m&~E,A=F|A&~M;e:do if(!b)if((B&E|0)==0&(F&M|0)==0)b=0;else if(E=mt(m|0,A|0,52)|0,Re()|0,E=E&15,!E)b=1;else{b=1;t:for(;;){switch(F=mt(m|0,A|0,(15-b|0)*3|0)|0,Re()|0,F&7){case 1:break t;case 0:break;default:{b=1;break e}}if(b>>>0<E>>>0)b=b+1|0;else{b=1;break e}}for(b=1;;)if(M=(15-b|0)*3|0,B=Nt(7,0,M|0)|0,F=A&~(Re()|0),A=mt(m|0,A|0,M|0)|0,Re()|0,A=Nt(Ta(A&7)|0,0,M|0)|0,m=m&~B|A,A=F|(Re()|0),b>>>0<E>>>0)b=b+1|0;else{b=1;break}}while(!1);if(N>>>0<W>>>0)N=N+1|0;else break}return Qr(A|0),m|0}function Al(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0;if(E=mt(m|0,A|0,52)|0,Re()|0,E=E&15,!E)return b=A,E=m,Qr(b|0),E|0;for(b=1;F=(15-b|0)*3|0,B=Nt(7,0,F|0)|0,M=A&~(Re()|0),A=mt(m|0,A|0,F|0)|0,Re()|0,A=Nt(Ta(A&7)|0,0,F|0)|0,m=A|m&~B,A=Re()|0|M,b>>>0<E>>>0;)b=b+1|0;return Qr(A|0),m|0}function xh(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0;if(W=we,we=we+64|0,N=W+40|0,E=W+24|0,M=W+12|0,B=W,Nt(A|0,0,52)|0,b=Re()|0|134225919,!A)return(y[m+4>>2]|0)>2||(y[m+8>>2]|0)>2||(y[m+12>>2]|0)>2?(F=0,N=0,Qr(F|0),we=W,N|0):(Nt(tp(m)|0,0,45)|0,F=Re()|0|b,N=-1,Qr(F|0),we=W,N|0);if(y[N>>2]=y[m>>2],y[N+4>>2]=y[m+4>>2],y[N+8>>2]=y[m+8>>2],y[N+12>>2]=y[m+12>>2],F=N+4|0,(A|0)>0)for(m=-1;y[E>>2]=y[F>>2],y[E+4>>2]=y[F+4>>2],y[E+8>>2]=y[F+8>>2],A&1?(Pf(F),y[M>>2]=y[F>>2],y[M+4>>2]=y[F+4>>2],y[M+8>>2]=y[F+8>>2],iu(M)):(Rf(F),y[M>>2]=y[F>>2],y[M+4>>2]=y[F+4>>2],y[M+8>>2]=y[F+8>>2],fl(M)),If(E,M,B),xs(B),fe=(15-A|0)*3|0,ee=Nt(7,0,fe|0)|0,b=b&~(Re()|0),fe=Nt(Mf(B)|0,0,fe|0)|0,m=fe|m&~ee,b=Re()|0|b,(A|0)>1;)A=A+-1|0;else m=-1;e:do if((y[F>>2]|0)<=2&&(y[N+8>>2]|0)<=2&&(y[N+12>>2]|0)<=2){if(E=tp(N)|0,A=Nt(E|0,0,45)|0,A=A|m,m=Re()|0|b&-1040385,B=rp(N)|0,!(yi(E)|0)){if((B|0)<=0)break;for(M=0;;){if(E=mt(A|0,m|0,52)|0,Re()|0,E=E&15,E)for(b=1;fe=(15-b|0)*3|0,N=mt(A|0,m|0,fe|0)|0,Re()|0,ee=Nt(7,0,fe|0)|0,m=m&~(Re()|0),fe=Nt(oc(N&7)|0,0,fe|0)|0,A=A&~ee|fe,m=m|(Re()|0),b>>>0<E>>>0;)b=b+1|0;if(M=M+1|0,(M|0)==(B|0))break e}}M=mt(A|0,m|0,52)|0,Re()|0,M=M&15;t:do if(M){b=1;r:for(;;){switch(fe=mt(A|0,m|0,(15-b|0)*3|0)|0,Re()|0,fe&7){case 1:break r;case 0:break;default:break t}if(b>>>0<M>>>0)b=b+1|0;else break t}if(Ah(E,y[N>>2]|0)|0)for(b=1;N=(15-b|0)*3|0,ee=Nt(7,0,N|0)|0,fe=m&~(Re()|0),m=mt(A|0,m|0,N|0)|0,Re()|0,m=Nt(Ta(m&7)|0,0,N|0)|0,A=A&~ee|m,m=fe|(Re()|0),b>>>0<M>>>0;)b=b+1|0;else for(b=1;fe=(15-b|0)*3|0,N=mt(A|0,m|0,fe|0)|0,Re()|0,ee=Nt(7,0,fe|0)|0,m=m&~(Re()|0),fe=Nt(oc(N&7)|0,0,fe|0)|0,A=A&~ee|fe,m=m|(Re()|0),b>>>0<M>>>0;)b=b+1|0}while(!1);if((B|0)>0){b=0;do A=fp(A,m)|0,m=Re()|0,b=b+1|0;while((b|0)!=(B|0))}}else A=0,m=0;while(!1);return ee=m,fe=A,Qr(ee|0),we=W,fe|0}function wn(m){return m=m|0,(m|0)%2|0|0}function hr(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;return M=we,we=we+16|0,E=M,A>>>0>15?(E=4,we=M,E|0):(y[m+4>>2]&2146435072|0)==2146435072||(y[m+8+4>>2]&2146435072|0)==2146435072?(E=3,we=M,E|0):(lp(m,A,E),A=xh(E,A)|0,E=Re()|0,y[b>>2]=A,y[b+4>>2]=E,(A|0)==0&(E|0)==0&&zr(23313,22674,786,22697),E=0,we=M,E|0)}function zf(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;if(M=b+4|0,B=mt(m|0,A|0,52)|0,Re()|0,B=B&15,F=mt(m|0,A|0,45)|0,Re()|0,E=(B|0)==0,yi(F&127)|0){if(E)return F=1,F|0;E=1}else{if(E)return F=0,F|0;!(y[M>>2]|0)&&!(y[b+8>>2]|0)?E=(y[b+12>>2]|0)!=0&1:E=1}for(b=1;b&1?iu(M):fl(M),F=mt(m|0,A|0,(15-b|0)*3|0)|0,Re()|0,gh(M,F&7),b>>>0<B>>>0;)b=b+1|0;return E|0}function ta(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0;if(fe=we,we=we+16|0,W=fe,ee=mt(m|0,A|0,45)|0,Re()|0,ee=ee&127,ee>>>0>121)return y[b>>2]=0,y[b+4>>2]=0,y[b+8>>2]=0,y[b+12>>2]=0,ee=5,we=fe,ee|0;e:do if(yi(ee)|0&&(B=mt(m|0,A|0,52)|0,Re()|0,B=B&15,(B|0)!=0)){E=1;t:for(;;){switch(N=mt(m|0,A|0,(15-E|0)*3|0)|0,Re()|0,N&7){case 5:break t;case 0:break;default:{E=A;break e}}if(E>>>0<B>>>0)E=E+1|0;else{E=A;break e}}for(M=1,E=A;A=(15-M|0)*3|0,F=Nt(7,0,A|0)|0,N=E&~(Re()|0),E=mt(m|0,E|0,A|0)|0,Re()|0,E=Nt(Ta(E&7)|0,0,A|0)|0,m=m&~F|E,E=N|(Re()|0),M>>>0<B>>>0;)M=M+1|0}else E=A;while(!1);if(N=7696+(ee*28|0)|0,y[b>>2]=y[N>>2],y[b+4>>2]=y[N+4>>2],y[b+8>>2]=y[N+8>>2],y[b+12>>2]=y[N+12>>2],!(zf(m,E,b)|0))return ee=0,we=fe,ee|0;if(F=b+4|0,y[W>>2]=y[F>>2],y[W+4>>2]=y[F+4>>2],y[W+8>>2]=y[F+8>>2],B=mt(m|0,E|0,52)|0,Re()|0,N=B&15,B&1?(fl(F),B=N+1|0):B=N,!(yi(ee)|0))E=0;else{e:do if(!N)E=0;else for(A=1;;){if(M=mt(m|0,E|0,(15-A|0)*3|0)|0,Re()|0,M=M&7,M|0){E=M;break e}if(A>>>0<N>>>0)A=A+1|0;else{E=0;break}}while(!1);E=(E|0)==4&1}if(!(pl(b,B,E,0)|0))(B|0)!=(N|0)&&(y[F>>2]=y[W>>2],y[F+4>>2]=y[W+4>>2],y[F+8>>2]=y[W+8>>2]);else{if(yi(ee)|0)do;while(pl(b,B,0,0)|0);(B|0)!=(N|0)&&Rf(F)}return ee=0,we=fe,ee|0}function cu(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;return B=we,we=we+16|0,E=B,M=ta(m,A,E)|0,M|0?(we=B,M|0):(M=mt(m|0,A|0,52)|0,Re()|0,cp(E,M&15,b),M=0,we=B,M|0)}function ra(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0;if(F=we,we=we+16|0,B=F,E=ta(m,A,B)|0,E|0)return B=E,we=F,B|0;E=mt(m|0,A|0,45)|0,Re()|0,E=(yi(E&127)|0)==0,M=mt(m|0,A|0,52)|0,Re()|0,M=M&15;e:do if(!E){if(M|0)for(E=1;;){if(N=Nt(7,0,(15-E|0)*3|0)|0,!((N&m|0)==0&((Re()|0)&A|0)==0))break e;if(E>>>0<M>>>0)E=E+1|0;else break}return Df(B,M,0,5,b),N=0,we=F,N|0}while(!1);return Va(B,M,0,6,b),N=0,we=F,N|0}function ml(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if(M=mt(m|0,A|0,45)|0,Re()|0,!(yi(M&127)|0))return M=2,y[b>>2]=M,0;if(M=mt(m|0,A|0,52)|0,Re()|0,M=M&15,!M)return M=5,y[b>>2]=M,0;for(E=1;;){if(B=Nt(7,0,(15-E|0)*3|0)|0,!((B&m|0)==0&((Re()|0)&A|0)==0)){E=2,m=6;break}if(E>>>0<M>>>0)E=E+1|0;else{E=5,m=6;break}}return(m|0)==6&&(y[b>>2]=E),0}function Uf(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0;Te=we,we=we+128|0,ee=Te+112|0,B=Te+96|0,fe=Te,M=mt(m|0,A|0,52)|0,Re()|0,N=M&15,y[ee>>2]=N,F=mt(m|0,A|0,45)|0,Re()|0,F=F&127;e:do if(yi(F)|0){if(N|0)for(E=1;;){if(W=Nt(7,0,(15-E|0)*3|0)|0,!((W&m|0)==0&((Re()|0)&A|0)==0)){M=0;break e}if(E>>>0<N>>>0)E=E+1|0;else break}if(M&1)M=1;else return W=Nt(N+1|0,0,52)|0,fe=Re()|0|A&-15728641,ee=Nt(7,0,(14-N|0)*3|0)|0,fe=Uf((W|m)&~ee,fe&~(Re()|0),b)|0,we=Te,fe|0}else M=0;while(!1);if(E=ta(m,A,B)|0,!E){M?(Ff(B,ee,fe),W=5):(up(B,ee,fe),W=6);e:do if(yi(F)|0)if(!N)m=5;else for(E=1;;){if(F=Nt(7,0,(15-E|0)*3|0)|0,!((F&m|0)==0&((Re()|0)&A|0)==0)){m=2;break e}if(E>>>0<N>>>0)E=E+1|0;else{m=5;break}}else m=2;while(!1);Ui(b|0,-1,m<<2|0)|0;e:do if(M)for(B=0;;){if(F=fe+(B<<4)|0,au(F,y[ee>>2]|0)|0,F=y[F>>2]|0,N=y[b>>2]|0,(N|0)==-1|(N|0)==(F|0))E=b;else{M=0;do{if(M=M+1|0,M>>>0>=m>>>0){E=1;break e}E=b+(M<<2)|0,N=y[E>>2]|0}while(!((N|0)==-1|(N|0)==(F|0)))}if(y[E>>2]=F,B=B+1|0,B>>>0>=W>>>0){E=0;break}}else for(B=0;;){if(F=fe+(B<<4)|0,pl(F,y[ee>>2]|0,0,1)|0,F=y[F>>2]|0,N=y[b>>2]|0,(N|0)==-1|(N|0)==(F|0))E=b;else{M=0;do{if(M=M+1|0,M>>>0>=m>>>0){E=1;break e}E=b+(M<<2)|0,N=y[E>>2]|0}while(!((N|0)==-1|(N|0)==(F|0)))}if(y[E>>2]=F,B=B+1|0,B>>>0>=W>>>0){E=0;break}}while(!1)}return fe=E,we=Te,fe|0}function li(){return 12}function uu(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0;if(m>>>0>15)return N=4,N|0;if(Nt(m|0,0,52)|0,N=Re()|0|134225919,!m){b=0,E=0;do yi(E)|0&&(Nt(E|0,0,45)|0,F=N|(Re()|0),m=A+(b<<3)|0,y[m>>2]=-1,y[m+4>>2]=F,b=b+1|0),E=E+1|0;while((E|0)!=122);return b=0,b|0}b=0,F=0;do{if(yi(F)|0){for(Nt(F|0,0,45)|0,E=1,M=-1,B=N|(Re()|0);W=Nt(7,0,(15-E|0)*3|0)|0,M=M&~W,B=B&~(Re()|0),(E|0)!=(m|0);)E=E+1|0;W=A+(b<<3)|0,y[W>>2]=M,y[W+4>>2]=B,b=b+1|0}F=F+1|0}while((F|0)!=122);return b=0,b|0}function pm(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0;if(at=we,we=we+16|0,It=at,wt=mt(m|0,A|0,52)|0,Re()|0,wt=wt&15,b>>>0>15)return wt=4,we=at,wt|0;if((wt|0)<(b|0))return wt=12,we=at,wt|0;if((wt|0)!=(b|0))if(B=Nt(b|0,0,52)|0,B=B|m,N=Re()|0|A&-15728641,(wt|0)>(b|0)){W=b;do nt=Nt(7,0,(14-W|0)*3|0)|0,W=W+1|0,B=nt|B,N=Re()|0|N;while((W|0)<(wt|0));nt=B}else nt=B;else nt=m,N=A;je=mt(nt|0,N|0,45)|0,Re()|0;e:do if(yi(je&127)|0){if(W=mt(nt|0,N|0,52)|0,Re()|0,W=W&15,W|0)for(B=1;;){if(je=Nt(7,0,(15-B|0)*3|0)|0,!((je&nt|0)==0&((Re()|0)&N|0)==0)){ee=33;break e}if(B>>>0<W>>>0)B=B+1|0;else break}if(je=E,y[je>>2]=0,y[je+4>>2]=0,(wt|0)>(b|0)){for(je=A&-15728641,Je=wt;;){if(qe=Je,Je=Je+-1|0,Je>>>0>15|(wt|0)<(Je|0)){ee=19;break}if((wt|0)!=(Je|0))if(B=Nt(Je|0,0,52)|0,B=B|m,W=Re()|0|je,(wt|0)<(qe|0))Te=B;else{ee=Je;do Te=Nt(7,0,(14-ee|0)*3|0)|0,ee=ee+1|0,B=Te|B,W=Re()|0|W;while((ee|0)<(wt|0));Te=B}else Te=m,W=A;if(fe=mt(Te|0,W|0,45)|0,Re()|0,!(yi(fe&127)|0))B=0;else{fe=mt(Te|0,W|0,52)|0,Re()|0,fe=fe&15;t:do if(!fe)B=0;else for(ee=1;;){if(B=mt(Te|0,W|0,(15-ee|0)*3|0)|0,Re()|0,B=B&7,B|0)break t;if(ee>>>0<fe>>>0)ee=ee+1|0;else{B=0;break}}while(!1);B=(B|0)==0&1}if(W=mt(m|0,A|0,(15-qe|0)*3|0)|0,Re()|0,W=W&7,(W|0)==7){M=5,ee=42;break}if(B=(B|0)!=0,(W|0)==1&B){M=5,ee=42;break}if(Te=W+(((W|0)!=0&B)<<31>>31)|0,Te|0&&(ee=wt-qe|0,ee=bs(7,0,ee,((ee|0)<0)<<31>>31)|0,fe=Re()|0,B?(B=Tt(ee|0,fe|0,5,0)|0,B=He(B|0,Re()|0,-5,-1)|0,B=Pt(B|0,Re()|0,6,0)|0,B=He(B|0,Re()|0,1,0)|0,W=Re()|0):(B=ee,W=fe),qe=Te+-1|0,qe=Tt(ee|0,fe|0,qe|0,((qe|0)<0)<<31>>31|0)|0,qe=He(B|0,W|0,qe|0,Re()|0)|0,Te=Re()|0,fe=E,fe=He(qe|0,Te|0,y[fe>>2]|0,y[fe+4>>2]|0)|0,Te=Re()|0,qe=E,y[qe>>2]=fe,y[qe+4>>2]=Te),(Je|0)<=(b|0)){ee=37;break}}if((ee|0)==19)zr(23313,22674,1099,22710);else if((ee|0)==37){F=E,M=y[F+4>>2]|0,F=y[F>>2]|0;break}else if((ee|0)==42)return we=at,M|0}else M=0,F=0}else ee=33;while(!1);e:do if((ee|0)==33)if(je=E,y[je>>2]=0,y[je+4>>2]=0,(wt|0)>(b|0)){for(B=wt;;){if(M=mt(m|0,A|0,(15-B|0)*3|0)|0,Re()|0,M=M&7,(M|0)==7){M=5;break}if(F=wt-B|0,F=bs(7,0,F,((F|0)<0)<<31>>31)|0,M=Tt(F|0,Re()|0,M|0,0)|0,F=Re()|0,je=E,F=He(y[je>>2]|0,y[je+4>>2]|0,M|0,F|0)|0,M=Re()|0,je=E,y[je>>2]=F,y[je+4>>2]=M,B=B+-1|0,(B|0)<=(b|0))break e}return we=at,M|0}else M=0,F=0;while(!1);return ja(nt,N,wt,It)|0&&zr(23313,22674,1063,22725),wt=It,It=y[wt+4>>2]|0,((M|0)>-1|(M|0)==-1&F>>>0>4294967295)&((It|0)>(M|0)|((It|0)==(M|0)?(y[wt>>2]|0)>>>0>F>>>0:0))?(wt=0,we=at,wt|0):(zr(23313,22674,1139,22710),0)}function bh(m,A,b,E,M,B){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0;var F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0;if(Te=we,we=we+16|0,F=Te,M>>>0>15)return B=4,we=Te,B|0;if(N=mt(b|0,E|0,52)|0,Re()|0,N=N&15,(N|0)>(M|0))return B=12,we=Te,B|0;if(ja(b,E,M,F)|0&&zr(23313,22674,1063,22725),fe=F,ee=y[fe+4>>2]|0,!(((A|0)>-1|(A|0)==-1&m>>>0>4294967295)&((ee|0)>(A|0)|((ee|0)==(A|0)?(y[fe>>2]|0)>>>0>m>>>0:0))))return B=2,we=Te,B|0;fe=M-N|0,M=Nt(M|0,0,52)|0,W=Re()|0|E&-15728641,ee=B,y[ee>>2]=M|b,y[ee+4>>2]=W,ee=mt(b|0,E|0,45)|0,Re()|0;e:do if(yi(ee&127)|0){if(N|0)for(F=1;;){if(ee=Nt(7,0,(15-F|0)*3|0)|0,!((ee&b|0)==0&((Re()|0)&E|0)==0))break e;if(F>>>0<N>>>0)F=F+1|0;else break}if((fe|0)<1)return B=0,we=Te,B|0;for(ee=N^15,E=-1,W=1,F=1;;){N=fe-W|0,N=bs(7,0,N,((N|0)<0)<<31>>31)|0,b=Re()|0;do if(F)if(F=Tt(N|0,b|0,5,0)|0,F=He(F|0,Re()|0,-5,-1)|0,F=Pt(F|0,Re()|0,6,0)|0,M=Re()|0,(A|0)>(M|0)|(A|0)==(M|0)&m>>>0>F>>>0){A=He(m|0,A|0,-1,-1)|0,A=Xe(A|0,Re()|0,F|0,M|0)|0,F=Re()|0,qe=B,je=y[qe>>2]|0,qe=y[qe+4>>2]|0,nt=(ee+E|0)*3|0,Je=Nt(7,0,nt|0)|0,qe=qe&~(Re()|0),E=Pt(A|0,F|0,N|0,b|0)|0,m=Re()|0,M=He(E|0,m|0,2,0)|0,nt=Nt(M|0,Re()|0,nt|0)|0,qe=Re()|0|qe,M=B,y[M>>2]=nt|je&~Je,y[M+4>>2]=qe,m=Tt(E|0,m|0,N|0,b|0)|0,m=Xe(A|0,F|0,m|0,Re()|0)|0,F=0,A=Re()|0;break}else{nt=B,Je=y[nt>>2]|0,nt=y[nt+4>>2]|0,je=Nt(7,0,(ee+E|0)*3|0)|0,nt=nt&~(Re()|0),F=B,y[F>>2]=Je&~je,y[F+4>>2]=nt,F=1;break}else Je=B,M=y[Je>>2]|0,Je=y[Je+4>>2]|0,E=(ee+E|0)*3|0,qe=Nt(7,0,E|0)|0,Je=Je&~(Re()|0),nt=Pt(m|0,A|0,N|0,b|0)|0,F=Re()|0,E=Nt(nt|0,F|0,E|0)|0,Je=Re()|0|Je,je=B,y[je>>2]=E|M&~qe,y[je+4>>2]=Je,F=Tt(nt|0,F|0,N|0,b|0)|0,m=Xe(m|0,A|0,F|0,Re()|0)|0,F=0,A=Re()|0;while(!1);if((fe|0)>(W|0))E=~W,W=W+1|0;else{A=0;break}}return we=Te,A|0}while(!1);if((fe|0)<1)return nt=0,we=Te,nt|0;for(M=N^15,F=1;;)if(je=fe-F|0,je=bs(7,0,je,((je|0)<0)<<31>>31)|0,nt=Re()|0,W=B,b=y[W>>2]|0,W=y[W+4>>2]|0,N=(M-F|0)*3|0,E=Nt(7,0,N|0)|0,W=W&~(Re()|0),qe=Pt(m|0,A|0,je|0,nt|0)|0,Je=Re()|0,N=Nt(qe|0,Je|0,N|0)|0,W=Re()|0|W,ee=B,y[ee>>2]=N|b&~E,y[ee+4>>2]=W,nt=Tt(qe|0,Je|0,je|0,nt|0)|0,m=Xe(m|0,A|0,nt|0,Re()|0)|0,A=Re()|0,(fe|0)<=(F|0)){A=0;break}else F=F+1|0;return we=Te,A|0}function dp(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0;M=mt(A|0,b|0,52)|0,Re()|0,M=M&15,(A|0)==0&(b|0)==0|((E|0)>15|(M|0)>(E|0))?(E=-1,M=-1,A=0,b=0):(B=lu(A,b,M+1|0,E)|0,b=(Re()|0)&-15728641,A=Nt(E|0,0,52)|0,A=B|A,b=b|(Re()|0),B=(Hi(A,b)|0)==0,E=B?-1:E),B=m,y[B>>2]=A,y[B+4>>2]=b,y[m+8>>2]=M,y[m+12>>2]=E}function Am(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0,W=0,ee=0;if(b=m,A=y[b>>2]|0,b=y[b+4>>2]|0,!((A|0)==0&(b|0)==0)&&(E=mt(A|0,b|0,52)|0,Re()|0,E=E&15,N=Nt(1,0,(E^15)*3|0)|0,A=He(N|0,Re()|0,A|0,b|0)|0,b=Re()|0,N=m,y[N>>2]=A,y[N+4>>2]=b,N=m+8|0,F=y[N>>2]|0,!((E|0)<(F|0)))){for(W=m+12|0,B=E;;){if((B|0)==(F|0)){E=5;break}if(ee=(B|0)==(y[W>>2]|0),M=(15-B|0)*3|0,E=mt(A|0,b|0,M|0)|0,Re()|0,E=E&7,ee&((E|0)==1&!0)){E=7;break}if(!((E|0)==7&!0)){E=10;break}if(ee=Nt(1,0,M|0)|0,A=He(A|0,b|0,ee|0,Re()|0)|0,b=Re()|0,ee=m,y[ee>>2]=A,y[ee+4>>2]=b,(B|0)>(F|0))B=B+-1|0;else{E=10;break}}if((E|0)==5){ee=m,y[ee>>2]=0,y[ee+4>>2]=0,y[N>>2]=-1,y[W>>2]=-1;return}else if((E|0)==7){F=Nt(1,0,M|0)|0,F=He(A|0,b|0,F|0,Re()|0)|0,N=Re()|0,ee=m,y[ee>>2]=F,y[ee+4>>2]=N,y[W>>2]=B+-1;return}else if((E|0)==10)return}}function hc(m){m=+m;var A=0;return A=m<0?m+6.283185307179586:m,+(m>=6.283185307179586?A+-6.283185307179586:A)}function gl(m,A){return m=m|0,A=A|0,+Gi(+(+Ce[m>>3]-+Ce[A>>3]))<17453292519943298e-27?(A=+Gi(+(+Ce[m+8>>3]-+Ce[A+8>>3]))<17453292519943298e-27,A|0):(A=0,A|0)}function pp(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return M=+Ce[A>>3],E=+Ce[m>>3],B=+Pi(+((M-E)*.5)),b=+Pi(+((+Ce[A+8>>3]-+Ce[m+8>>3])*.5)),b=B*B+b*(+Ci(+M)*+Ci(+E)*b),+(+Po(+ +gn(+b),+ +gn(+(1-b)))*2)}function hu(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return M=+Ce[A>>3],E=+Ce[m>>3],B=+Pi(+((M-E)*.5)),b=+Pi(+((+Ce[A+8>>3]-+Ce[m+8>>3])*.5)),b=B*B+b*(+Ci(+M)*+Ci(+E)*b),+(+Po(+ +gn(+b),+ +gn(+(1-b)))*2*6371.007180918475)}function Ap(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return M=+Ce[A>>3],E=+Ce[m>>3],B=+Pi(+((M-E)*.5)),b=+Pi(+((+Ce[A+8>>3]-+Ce[m+8>>3])*.5)),b=B*B+b*(+Ci(+M)*+Ci(+E)*b),+(+Po(+ +gn(+b),+ +gn(+(1-b)))*2*6371.007180918475*1e3)}function Gg(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0;return B=+Ce[A>>3],E=+Ci(+B),M=+Ce[A+8>>3]-+Ce[m+8>>3],F=E*+Pi(+M),b=+Ce[m>>3],+ +Po(+F,+(+Pi(+B)*+Ci(+b)-+Ci(+M)*(E*+Pi(+b))))}function Hg(m,A,b,E){m=m|0,A=+A,b=+b,E=E|0;var M=0,B=0,F=0,N=0;if(b<1e-16){y[E>>2]=y[m>>2],y[E+4>>2]=y[m+4>>2],y[E+8>>2]=y[m+8>>2],y[E+12>>2]=y[m+12>>2];return}B=A<0?A+6.283185307179586:A,B=A>=6.283185307179586?B+-6.283185307179586:B;do if(B<1e-16)A=+Ce[m>>3]+b,Ce[E>>3]=A,M=E;else{if(M=+Gi(+(B+-3.141592653589793))<1e-16,A=+Ce[m>>3],M){A=A-b,Ce[E>>3]=A,M=E;break}if(F=+Ci(+b),b=+Pi(+b),A=F*+Pi(+A)+ +Ci(+B)*(b*+Ci(+A)),A=A>1?1:A,A=+Kl(+(A<-1?-1:A)),Ce[E>>3]=A,+Gi(+(A+-1.5707963267948966))<1e-16){Ce[E>>3]=1.5707963267948966,Ce[E+8>>3]=0;return}if(+Gi(+(A+1.5707963267948966))<1e-16){Ce[E>>3]=-1.5707963267948966,Ce[E+8>>3]=0;return}if(N=+Ci(+A),B=b*+Pi(+B)/N,b=+Ce[m>>3],A=(F-+Pi(+A)*+Pi(+b))/+Ci(+b)/N,F=B>1?1:B,A=A>1?1:A,A=+Ce[m+8>>3]+ +Po(+(F<-1?-1:F),+(A<-1?-1:A)),A>3.141592653589793)do A=A+-6.283185307179586;while(A>3.141592653589793);if(A<-3.141592653589793)do A=A+6.283185307179586;while(A<-3.141592653589793);Ce[E+8>>3]=A;return}while(!1);if(+Gi(+(A+-1.5707963267948966))<1e-16){Ce[M>>3]=1.5707963267948966,Ce[E+8>>3]=0;return}if(+Gi(+(A+1.5707963267948966))<1e-16){Ce[M>>3]=-1.5707963267948966,Ce[E+8>>3]=0;return}if(A=+Ce[m+8>>3],A>3.141592653589793)do A=A+-6.283185307179586;while(A>3.141592653589793);if(A<-3.141592653589793)do A=A+6.283185307179586;while(A<-3.141592653589793);Ce[E+8>>3]=A}function Ha(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ce[A>>3]=+Ce[20528+(m<<3)>>3],A=0,A|0)}function hn(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ce[A>>3]=+Ce[20656+(m<<3)>>3],A=0,A|0)}function vh(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ce[A>>3]=+Ce[20784+(m<<3)>>3],A=0,A|0)}function Vf(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ce[A>>3]=+Ce[20912+(m<<3)>>3],A=0,A|0)}function fc(m,A){m=m|0,A=A|0;var b=0;return m>>>0>15?(A=4,A|0):(b=bs(7,0,m,((m|0)<0)<<31>>31)|0,b=Tt(b|0,Re()|0,120,0)|0,m=Re()|0,y[A>>2]=b|2,y[A+4>>2]=m,A=0,A|0)}function mp(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0;return qe=+Ce[A>>3],fe=+Ce[m>>3],W=+Pi(+((qe-fe)*.5)),B=+Ce[A+8>>3],ee=+Ce[m+8>>3],F=+Pi(+((B-ee)*.5)),N=+Ci(+fe),Te=+Ci(+qe),F=W*W+F*(Te*N*F),F=+Po(+ +gn(+F),+ +gn(+(1-F)))*2,W=+Ce[b>>3],qe=+Pi(+((W-qe)*.5)),E=+Ce[b+8>>3],B=+Pi(+((E-B)*.5)),M=+Ci(+W),B=qe*qe+B*(Te*M*B),B=+Po(+ +gn(+B),+ +gn(+(1-B)))*2,W=+Pi(+((fe-W)*.5)),E=+Pi(+((ee-E)*.5)),E=W*W+E*(N*M*E),E=+Po(+ +gn(+E),+ +gn(+(1-E)))*2,M=(F+B+E)*.5,+(+Qc(+ +gn(+(+Kc(+(M*.5))*+Kc(+((M-F)*.5))*+Kc(+((M-B)*.5))*+Kc(+((M-E)*.5)))))*4)}function fu(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0;if(N=we,we=we+192|0,B=N+168|0,F=N,M=cu(m,A,B)|0,M|0)return b=M,we=N,b|0;if(ra(m,A,F)|0&&zr(23313,22742,386,22751),A=y[F>>2]|0,(A|0)>0){if(E=+mp(F+8|0,F+8+(((A|0)!=1&1)<<4)|0,B)+0,(A|0)!=1){m=1;do M=m,m=m+1|0,E=E+ +mp(F+8+(M<<4)|0,F+8+(((m|0)%(A|0)|0)<<4)|0,B);while((m|0)<(A|0))}}else E=0;return Ce[b>>3]=E,b=0,we=N,b|0}function Wg(m,A,b){return m=m|0,A=A|0,b=b|0,m=fu(m,A,b)|0,m|0||(Ce[b>>3]=+Ce[b>>3]*6371.007180918475*6371.007180918475),m|0}function Ca(m,A,b){return m=m|0,A=A|0,b=b|0,m=fu(m,A,b)|0,m|0||(Ce[b>>3]=+Ce[b>>3]*6371.007180918475*6371.007180918475*1e3*1e3),m|0}function wh(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0;if(N=we,we=we+176|0,F=N,m=cc(m,A,F)|0,m|0)return F=m,we=N,F|0;if(Ce[b>>3]=0,m=y[F>>2]|0,(m|0)<=1)return F=0,we=N,F|0;A=m+-1|0,m=0,E=+Ce[F+8>>3],M=+Ce[F+16>>3],B=0;do m=m+1|0,ee=E,E=+Ce[F+8+(m<<4)>>3],fe=+Pi(+((E-ee)*.5)),W=M,M=+Ce[F+8+(m<<4)+8>>3],W=+Pi(+((M-W)*.5)),W=fe*fe+W*(+Ci(+E)*+Ci(+ee)*W),B=B+ +Po(+ +gn(+W),+ +gn(+(1-W)))*2;while((m|0)<(A|0));return Ce[b>>3]=B,F=0,we=N,F|0}function br(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0;if(N=we,we=we+176|0,F=N,m=cc(m,A,F)|0,m|0)return F=m,B=+Ce[b>>3],B=B*6371.007180918475,Ce[b>>3]=B,we=N,F|0;if(Ce[b>>3]=0,m=y[F>>2]|0,(m|0)<=1)return F=0,B=0,B=B*6371.007180918475,Ce[b>>3]=B,we=N,F|0;A=m+-1|0,m=0,E=+Ce[F+8>>3],M=+Ce[F+16>>3],B=0;do m=m+1|0,ee=E,E=+Ce[F+8+(m<<4)>>3],fe=+Pi(+((E-ee)*.5)),W=M,M=+Ce[F+8+(m<<4)+8>>3],W=+Pi(+((M-W)*.5)),W=fe*fe+W*(+Ci(+ee)*+Ci(+E)*W),B=B+ +Po(+ +gn(+W),+ +gn(+(1-W)))*2;while((m|0)!=(A|0));return Ce[b>>3]=B,F=0,fe=B,fe=fe*6371.007180918475,Ce[b>>3]=fe,we=N,F|0}function Lr(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0;if(N=we,we=we+176|0,F=N,m=cc(m,A,F)|0,m|0)return F=m,B=+Ce[b>>3],B=B*6371.007180918475,B=B*1e3,Ce[b>>3]=B,we=N,F|0;if(Ce[b>>3]=0,m=y[F>>2]|0,(m|0)<=1)return F=0,B=0,B=B*6371.007180918475,B=B*1e3,Ce[b>>3]=B,we=N,F|0;A=m+-1|0,m=0,E=+Ce[F+8>>3],M=+Ce[F+16>>3],B=0;do m=m+1|0,ee=E,E=+Ce[F+8+(m<<4)>>3],fe=+Pi(+((E-ee)*.5)),W=M,M=+Ce[F+8+(m<<4)+8>>3],W=+Pi(+((M-W)*.5)),W=fe*fe+W*(+Ci(+ee)*+Ci(+E)*W),B=B+ +Po(+ +gn(+W),+ +gn(+(1-W)))*2;while((m|0)!=(A|0));return Ce[b>>3]=B,F=0,fe=B,fe=fe*6371.007180918475,fe=fe*1e3,Ce[b>>3]=fe,we=N,F|0}function jf(m){m=m|0;var A=0,b=0,E=0;return A=Ze(1,12)|0,A||zr(22832,22787,49,22845),b=m+4|0,E=y[b>>2]|0,E|0?(E=E+8|0,y[E>>2]=A,y[b>>2]=A,A|0):(y[m>>2]|0&&zr(22862,22787,61,22885),E=m,y[E>>2]=A,y[b>>2]=A,A|0)}function gp(m,A){m=m|0,A=A|0;var b=0,E=0;return E=Ge(24)|0,E||zr(22899,22787,78,22913),y[E>>2]=y[A>>2],y[E+4>>2]=y[A+4>>2],y[E+8>>2]=y[A+8>>2],y[E+12>>2]=y[A+12>>2],y[E+16>>2]=0,A=m+4|0,b=y[A>>2]|0,b|0?(y[b+16>>2]=E,y[A>>2]=E,E|0):(y[m>>2]|0&&zr(22928,22787,82,22913),y[m>>2]=E,y[A>>2]=E,E|0)}function Gf(m){m=m|0;var A=0,b=0,E=0,M=0;if(m)for(E=1;;){if(A=y[m>>2]|0,A|0)do{if(b=y[A>>2]|0,b|0)do M=b,b=y[b+16>>2]|0,De(M);while(b|0);M=A,A=y[A+8>>2]|0,De(M)}while(A|0);if(A=m,m=y[m+8>>2]|0,E||De(A),m)E=0;else break}}function po(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,gr=0,sr=0,lr=0,mi=0,ri=0,ni=0,qr=0,jr=0,Hr=0,Vi=0,Zr=0;if(M=m+8|0,y[M>>2]|0)return Zr=1,Zr|0;if(E=y[m>>2]|0,!E)return Zr=0,Zr|0;A=E,b=0;do b=b+1|0,A=y[A+8>>2]|0;while(A|0);if(b>>>0<2)return Zr=0,Zr|0;Hr=Ge(b<<2)|0,Hr||zr(22948,22787,317,22967),jr=Ge(b<<5)|0,jr||zr(22989,22787,321,22967),y[m>>2]=0,gr=m+4|0,y[gr>>2]=0,y[M>>2]=0,b=0,qr=0,ar=0,Te=0;e:for(;;){if(fe=y[E>>2]|0,fe){B=0,F=fe;do{if(W=+Ce[F+8>>3],A=F,F=y[F+16>>2]|0,ee=(F|0)==0,M=ee?fe:F,N=+Ce[M+8>>3],+Gi(+(W-N))>3.141592653589793){Zr=14;break}B=B+(N-W)*(+Ce[A>>3]+ +Ce[M>>3])}while(!ee);if((Zr|0)==14){Zr=0,B=0,A=fe;do ft=+Ce[A+8>>3],ni=A+16|0,ri=y[ni>>2]|0,ri=ri|0?ri:fe,bt=+Ce[ri+8>>3],B=B+(+Ce[A>>3]+ +Ce[ri>>3])*((bt<0?bt+6.283185307179586:bt)-(ft<0?ft+6.283185307179586:ft)),A=y[(A|0?ni:E)>>2]|0;while(A|0)}B>0?(y[Hr+(qr<<2)>>2]=E,qr=qr+1|0,M=ar,A=Te):Zr=19}else Zr=19;if((Zr|0)==19){Zr=0;do if(b){if(A=b+8|0,y[A>>2]|0){Zr=21;break e}if(b=Ze(1,12)|0,!b){Zr=23;break e}y[A>>2]=b,M=b+4|0,F=b,A=Te}else if(Te){M=gr,F=Te+8|0,A=E,b=m;break}else if(y[m>>2]|0){Zr=27;break e}else{M=gr,F=m,A=E,b=m;break}while(!1);if(y[F>>2]=E,y[M>>2]=E,F=jr+(ar<<5)|0,ee=y[E>>2]|0,ee){for(fe=jr+(ar<<5)+8|0,Ce[fe>>3]=17976931348623157e292,Te=jr+(ar<<5)+24|0,Ce[Te>>3]=17976931348623157e292,Ce[F>>3]=-17976931348623157e292,qe=jr+(ar<<5)+16|0,Ce[qe>>3]=-17976931348623157e292,wt=17976931348623157e292,at=-17976931348623157e292,M=0,Je=ee,W=17976931348623157e292,nt=17976931348623157e292,It=-17976931348623157e292,N=-17976931348623157e292;B=+Ce[Je>>3],ft=+Ce[Je+8>>3],Je=y[Je+16>>2]|0,je=(Je|0)==0,bt=+Ce[(je?ee:Je)+8>>3],B<W&&(Ce[fe>>3]=B,W=B),ft<nt&&(Ce[Te>>3]=ft,nt=ft),B>It?Ce[F>>3]=B:B=It,ft>N&&(Ce[qe>>3]=ft,N=ft),wt=ft>0&ft<wt?ft:wt,at=ft<0&ft>at?ft:at,M=M|+Gi(+(ft-bt))>3.141592653589793,!je;)It=B;M&&(Ce[qe>>3]=at,Ce[Te>>3]=wt)}else y[F>>2]=0,y[F+4>>2]=0,y[F+8>>2]=0,y[F+12>>2]=0,y[F+16>>2]=0,y[F+20>>2]=0,y[F+24>>2]=0,y[F+28>>2]=0;M=ar+1|0}if(ni=E+8|0,E=y[ni>>2]|0,y[ni>>2]=0,E)ar=M,Te=A;else{Zr=45;break}}if((Zr|0)==21)zr(22765,22787,35,22799);else if((Zr|0)==23)zr(22819,22787,37,22799);else if((Zr|0)==27)zr(22862,22787,61,22885);else if((Zr|0)==45){e:do if((qr|0)>0){for(ni=(M|0)==0,mi=M<<2,ri=(m|0)==0,lr=0,A=0;;){if(sr=y[Hr+(lr<<2)>>2]|0,ni)Zr=73;else{if(ar=Ge(mi)|0,!ar){Zr=50;break}if(gr=Ge(mi)|0,!gr){Zr=52;break}t:do if(ri)b=0;else{for(M=0,b=0,F=m;E=jr+(M<<5)|0,_p(y[F>>2]|0,E,y[sr>>2]|0)|0?(y[ar+(b<<2)>>2]=F,y[gr+(b<<2)>>2]=E,je=b+1|0):je=b,F=y[F+8>>2]|0,F;)M=M+1|0,b=je;if((je|0)>0)if(E=y[ar>>2]|0,(je|0)==1)b=E;else for(qe=0,Je=-1,b=E,Te=E;;){for(ee=y[Te>>2]|0,E=0,F=0;M=y[y[ar+(F<<2)>>2]>>2]|0,(M|0)==(ee|0)?fe=E:fe=E+((_p(M,y[gr+(F<<2)>>2]|0,y[ee>>2]|0)|0)&1)|0,F=F+1|0,(F|0)!=(je|0);)E=fe;if(M=(fe|0)>(Je|0),b=M?Te:b,E=qe+1|0,(E|0)==(je|0))break t;qe=E,Je=M?fe:Je,Te=y[ar+(E<<2)>>2]|0}else b=0}while(!1);if(De(ar),De(gr),b){if(M=b+4|0,E=y[M>>2]|0,E)b=E+8|0;else if(y[b>>2]|0){Zr=70;break}y[b>>2]=sr,y[M>>2]=sr}else Zr=73}if((Zr|0)==73){if(Zr=0,A=y[sr>>2]|0,A|0)do gr=A,A=y[A+16>>2]|0,De(gr);while(A|0);De(sr),A=1}if(lr=lr+1|0,(lr|0)>=(qr|0)){Vi=A;break e}}(Zr|0)==50?zr(23004,22787,249,23023):(Zr|0)==52?zr(23042,22787,252,23023):(Zr|0)==70&&zr(22862,22787,61,22885)}else Vi=0;while(!1);return De(Hr),De(jr),Zr=Vi,Zr|0}return 0}function _p(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0;if(!(ip(A,b)|0)||(A=nc(A)|0,E=+Ce[b>>3],M=+Ce[b+8>>3],M=A&M<0?M+6.283185307179586:M,m=y[m>>2]|0,!m))return m=0,m|0;if(A){A=0,ee=M,b=m;e:for(;;){for(;F=+Ce[b>>3],M=+Ce[b+8>>3],b=b+16|0,fe=y[b>>2]|0,fe=fe|0?fe:m,B=+Ce[fe>>3],N=+Ce[fe+8>>3],F>B?(W=F,F=N):(W=B,B=F,F=M,M=N),E=E==B|E==W?E+2220446049250313e-31:E,!!(E<B|E>W);)if(b=y[b>>2]|0,!b){b=22;break e}if(N=F<0?F+6.283185307179586:F,F=M<0?M+6.283185307179586:M,ee=N==ee|F==ee?ee+-2220446049250313e-31:ee,W=N+(F-N)*((E-B)/(W-B)),(W<0?W+6.283185307179586:W)>ee&&(A=A^1),b=y[b>>2]|0,!b){b=22;break}}if((b|0)==22)return A|0}else{A=0,ee=M,b=m;e:for(;;){for(;F=+Ce[b>>3],M=+Ce[b+8>>3],b=b+16|0,fe=y[b>>2]|0,fe=fe|0?fe:m,B=+Ce[fe>>3],N=+Ce[fe+8>>3],F>B?(W=F,F=N):(W=B,B=F,F=M,M=N),E=E==B|E==W?E+2220446049250313e-31:E,!!(E<B|E>W);)if(b=y[b>>2]|0,!b){b=22;break e}if(ee=F==ee|M==ee?ee+-2220446049250313e-31:ee,F+(M-F)*((E-B)/(W-B))>ee&&(A=A^1),b=y[b>>2]|0,!b){b=22;break}}if((b|0)==22)return A|0}return 0}function Bn(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0;if(at=we,we=we+32|0,wt=at+16|0,It=at,B=mt(m|0,A|0,52)|0,Re()|0,B=B&15,Je=mt(b|0,E|0,52)|0,Re()|0,(B|0)!=(Je&15|0))return wt=12,we=at,wt|0;if(ee=mt(m|0,A|0,45)|0,Re()|0,ee=ee&127,fe=mt(b|0,E|0,45)|0,Re()|0,fe=fe&127,ee>>>0>121|fe>>>0>121)return wt=5,we=at,wt|0;if(Je=(ee|0)!=(fe|0),Je){if(N=eu(ee,fe)|0,(N|0)==7)return wt=1,we=at,wt|0;W=eu(fe,ee)|0,(W|0)==7?zr(23066,23090,161,23100):(je=N,F=W)}else je=0,F=0;Te=yi(ee)|0,qe=yi(fe)|0,y[wt>>2]=0,y[wt+4>>2]=0,y[wt+8>>2]=0,y[wt+12>>2]=0;do if(je){if(fe=y[4272+(ee*28|0)+(je<<2)>>2]|0,N=(fe|0)>0,qe)if(N){ee=0,W=b,N=E;do W=jg(W,N)|0,N=Re()|0,F=Ta(F)|0,(F|0)==1&&(F=Ta(1)|0),ee=ee+1|0;while((ee|0)!=(fe|0));fe=F,ee=W,W=N}else fe=F,ee=b,W=E;else if(N){ee=0,W=b,N=E;do W=Al(W,N)|0,N=Re()|0,F=Ta(F)|0,ee=ee+1|0;while((ee|0)!=(fe|0));fe=F,ee=W,W=N}else fe=F,ee=b,W=E;if(zf(ee,W,wt)|0,Je||zr(23115,23090,191,23100),N=(Te|0)!=0,F=(qe|0)!=0,N&F&&zr(23142,23090,192,23100),N){if(F=Ns(m,A)|0,(F|0)==7){B=5;break}if(Dr[21872+(F*7|0)+je>>0]|0){B=1;break}W=y[21040+(F*28|0)+(je<<2)>>2]|0,ee=W}else if(F){if(F=Ns(ee,W)|0,(F|0)==7){B=5;break}if(Dr[21872+(F*7|0)+fe>>0]|0){B=1;break}ee=0,W=y[21040+(fe*28|0)+(F<<2)>>2]|0}else ee=0,W=0;if((ee|W|0)<0)B=5;else{if((W|0)>0){N=wt+4|0,F=0;do sc(N),F=F+1|0;while((F|0)!=(W|0))}if(y[It>>2]=0,y[It+4>>2]=0,y[It+8>>2]=0,gh(It,je),B|0)for(;wn(B)|0?iu(It):fl(It),(B|0)>1;)B=B+-1|0;if((ee|0)>0){B=0;do sc(It),B=B+1|0;while((B|0)!=(ee|0))}nt=wt+4|0,Ks(nt,It,nt),xs(nt),nt=51}}else if(zf(b,E,wt)|0,(Te|0)!=0&(qe|0)!=0)if((fe|0)!=(ee|0)&&zr(23173,23090,261,23100),F=Ns(m,A)|0,B=Ns(b,E)|0,(F|0)==7|(B|0)==7)B=5;else if(Dr[21872+(F*7|0)+B>>0]|0)B=1;else if(F=y[21040+(F*28|0)+(B<<2)>>2]|0,(F|0)>0){N=wt+4|0,B=0;do sc(N),B=B+1|0;while((B|0)!=(F|0));nt=51}else nt=51;else nt=51;while(!1);return(nt|0)==51&&(B=wt+4|0,y[M>>2]=y[B>>2],y[M+4>>2]=y[B+4>>2],y[M+8>>2]=y[B+8>>2],B=0),wt=B,we=at,wt|0}function mm(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0;if(nt=we,we=we+48|0,ee=nt+36|0,F=nt+24|0,N=nt+12|0,W=nt,M=mt(m|0,A|0,52)|0,Re()|0,M=M&15,qe=mt(m|0,A|0,45)|0,Re()|0,qe=qe&127,qe>>>0>121)return E=5,we=nt,E|0;if(fe=yi(qe)|0,Nt(M|0,0,52)|0,It=Re()|0|134225919,B=E,y[B>>2]=-1,y[B+4>>2]=It,!M)return M=Mf(b)|0,(M|0)==7||(M=ic(qe,M)|0,(M|0)==127)?(It=1,we=nt,It|0):(Je=Nt(M|0,0,45)|0,je=Re()|0,qe=E,je=y[qe+4>>2]&-1040385|je,It=E,y[It>>2]=y[qe>>2]|Je,y[It+4>>2]=je,It=0,we=nt,It|0);for(y[ee>>2]=y[b>>2],y[ee+4>>2]=y[b+4>>2],y[ee+8>>2]=y[b+8>>2],b=M;;){if(B=b,b=b+-1|0,y[F>>2]=y[ee>>2],y[F+4>>2]=y[ee+4>>2],y[F+8>>2]=y[ee+8>>2],wn(B)|0){if(M=ru(ee)|0,M|0){b=13;break}y[N>>2]=y[ee>>2],y[N+4>>2]=y[ee+4>>2],y[N+8>>2]=y[ee+8>>2],iu(N)}else{if(M=mh(ee)|0,M|0){b=13;break}y[N>>2]=y[ee>>2],y[N+4>>2]=y[ee+4>>2],y[N+8>>2]=y[ee+8>>2],fl(N)}if(If(F,N,W),xs(W),M=E,at=y[M>>2]|0,M=y[M+4>>2]|0,bt=(15-B|0)*3|0,wt=Nt(7,0,bt|0)|0,M=M&~(Re()|0),bt=Nt(Mf(W)|0,0,bt|0)|0,M=Re()|0|M,It=E,y[It>>2]=bt|at&~wt,y[It+4>>2]=M,(B|0)<=1){b=14;break}}e:do if((b|0)!=13&&(b|0)==14)if((y[ee>>2]|0)<=1&&(y[ee+4>>2]|0)<=1&&(y[ee+8>>2]|0)<=1){b=Mf(ee)|0,M=ic(qe,b)|0,(M|0)==127?W=0:W=yi(M)|0;t:do if(b){if(fe){if(M=Ns(m,A)|0,(M|0)==7){M=5;break e}if(B=y[21248+(M*28|0)+(b<<2)>>2]|0,(B|0)>0){M=b,b=0;do M=oc(M)|0,b=b+1|0;while((b|0)!=(B|0))}else M=b;if((M|0)==1){M=9;break e}b=ic(qe,M)|0,(b|0)==127&&zr(23200,23090,411,23230),yi(b)|0?zr(23245,23090,412,23230):(je=b,Je=B,Te=M)}else je=M,Je=0,Te=b;if(N=y[4272+(qe*28|0)+(Te<<2)>>2]|0,(N|0)<=-1&&zr(23276,23090,419,23230),!W){if((Je|0)<0){M=5;break e}if(Je|0){B=E,M=0,b=y[B>>2]|0,B=y[B+4>>2]|0;do b=Ga(b,B)|0,B=Re()|0,bt=E,y[bt>>2]=b,y[bt+4>>2]=B,M=M+1|0;while((M|0)<(Je|0))}if((N|0)<=0){M=je,b=58;break}for(B=E,M=0,b=y[B>>2]|0,B=y[B+4>>2]|0;;)if(b=Ga(b,B)|0,B=Re()|0,bt=E,y[bt>>2]=b,y[bt+4>>2]=B,M=M+1|0,(M|0)==(N|0)){M=je,b=58;break t}}if(F=eu(je,qe)|0,(F|0)==7&&zr(23066,23090,428,23230),M=E,b=y[M>>2]|0,M=y[M+4>>2]|0,(N|0)>0){B=0;do b=Ga(b,M)|0,M=Re()|0,bt=E,y[bt>>2]=b,y[bt+4>>2]=M,B=B+1|0;while((B|0)!=(N|0))}if(M=Ns(b,M)|0,(M|0)==7&&zr(23313,23090,440,23230),b=Tf(je)|0,b=y[(b?21664:21456)+(F*28|0)+(M<<2)>>2]|0,(b|0)<0&&zr(23313,23090,454,23230),!b)M=je,b=58;else{F=E,M=0,B=y[F>>2]|0,F=y[F+4>>2]|0;do B=fp(B,F)|0,F=Re()|0,bt=E,y[bt>>2]=B,y[bt+4>>2]=F,M=M+1|0;while((M|0)<(b|0));M=je,b=58}}else if((fe|0)!=0&(W|0)!=0){if(b=Ns(m,A)|0,B=E,B=Ns(y[B>>2]|0,y[B+4>>2]|0)|0,(b|0)==7|(B|0)==7){M=5;break e}if(B=y[21248+(b*28|0)+(B<<2)>>2]|0,(B|0)<0){M=5;break e}if(!B)b=59;else{N=E,b=0,F=y[N>>2]|0,N=y[N+4>>2]|0;do F=Ga(F,N)|0,N=Re()|0,bt=E,y[bt>>2]=F,y[bt+4>>2]=N,b=b+1|0;while((b|0)<(B|0));b=58}}else b=58;while(!1);if((b|0)==58&&W&&(b=59),(b|0)==59&&(bt=E,(Ns(y[bt>>2]|0,y[bt+4>>2]|0)|0)==1)){M=9;break}bt=E,wt=y[bt>>2]|0,bt=y[bt+4>>2]&-1040385,at=Nt(M|0,0,45)|0,bt=bt|(Re()|0),M=E,y[M>>2]=wt|at,y[M+4>>2]=bt,M=0}else M=1;while(!1);return bt=M,we=nt,bt|0}function Th(m,A,b,E,M,B){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0;var F=0,N=0;return N=we,we=we+16|0,F=N,M?m=15:(m=Bn(m,A,b,E,F)|0,m||(Lf(F,B),m=0)),we=N,m|0}function Ln(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0;return F=we,we=we+16|0,B=F,E?b=15:(b=Of(b,B)|0,b||(b=mm(m,A,B,M)|0)),we=F,b|0}function Vn(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0;return W=we,we=we+32|0,F=W+12|0,N=W,B=Bn(m,A,m,A,F)|0,B|0?(N=B,we=W,N|0):(m=Bn(m,A,b,E,N)|0,m|0?(N=m,we=W,N|0):(F=ac(F,N)|0,N=M,y[N>>2]=F,y[N+4>>2]=((F|0)<0)<<31>>31,N=0,we=W,N|0))}function gm(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0;return W=we,we=we+32|0,F=W+12|0,N=W,B=Bn(m,A,m,A,F)|0,!B&&(B=Bn(m,A,b,E,N)|0,!B)?(E=ac(F,N)|0,E=He(E|0,((E|0)<0)<<31>>31|0,1,0)|0,F=Re()|0,N=M,y[N>>2]=E,y[N+4>>2]=F,N=0,we=W,N|0):(N=B,we=W,N|0)}function Eh(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,gr=0,sr=0,lr=0;if(sr=we,we=we+48|0,F=sr+24|0,N=sr+12|0,gr=sr,B=Bn(m,A,m,A,F)|0,!B&&(B=Bn(m,A,b,E,N)|0,!B)){ft=ac(F,N)|0,ar=((ft|0)<0)<<31>>31,y[F>>2]=0,y[F+4>>2]=0,y[F+8>>2]=0,y[N>>2]=0,y[N+4>>2]=0,y[N+8>>2]=0,Bn(m,A,m,A,F)|0&&zr(23313,23090,691,23299),Bn(m,A,b,E,N)|0&&zr(23313,23090,696,23299),_h(F),_h(N),ft?(Te=y[F>>2]|0,je=+(ft|0),wt=F+4|0,qe=y[wt>>2]|0,at=F+8|0,Je=y[at>>2]|0,bt=F,E=Te,B=qe,b=Je,nt=+((y[N>>2]|0)-Te|0)/je,It=+((y[N+4>>2]|0)-qe|0)/je,je=+((y[N+8>>2]|0)-Je|0)/je):(B=F+4|0,b=F+8|0,wt=B,at=b,bt=F,E=y[F>>2]|0,B=y[B>>2]|0,b=y[b>>2]|0,nt=0,It=0,je=0),y[gr>>2]=E,Je=gr+4|0,y[Je>>2]=B,qe=gr+8|0,y[qe>>2]=b;e:do if((ft|0)<0)B=0;else for(fe=0,Te=0,B=E;;){ee=+(Te>>>0)+4294967296*+(fe|0),lr=nt*ee+ +(B|0),W=It*ee+ +(y[wt>>2]|0),ee=je*ee+ +(y[at>>2]|0),b=~~+zi(+lr),F=~~+zi(+W),B=~~+zi(+ee),lr=+Gi(+(+(b|0)-lr)),W=+Gi(+(+(F|0)-W)),ee=+Gi(+(+(B|0)-ee));do if(lr>W&lr>ee)b=0-(F+B)|0,E=F;else if(N=0-b|0,W>ee){E=N-B|0;break}else{E=F,B=N-F|0;break}while(!1);if(y[gr>>2]=b,y[Je>>2]=E,y[qe>>2]=B,su(gr),B=mm(m,A,gr,M+(Te<<3)|0)|0,B|0)break e;if(!((fe|0)<(ar|0)|(fe|0)==(ar|0)&Te>>>0<ft>>>0)){B=0;break e}B=He(Te|0,fe|0,1,0)|0,N=Re()|0,fe=N,Te=B,B=y[bt>>2]|0}while(!1);return gr=B,we=sr,gr|0}return gr=B,we=sr,gr|0}function bs(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0;if((b|0)==0&(E|0)==0)return M=0,B=1,Qr(M|0),B|0;B=m,M=A,m=1,A=0;do F=(b&1|0)==0&!0,m=Tt((F?1:B)|0,(F?0:M)|0,m|0,A|0)|0,A=Re()|0,b=Ut(b|0,E|0,1)|0,E=Re()|0,B=Tt(B|0,M|0,B|0,M|0)|0,M=Re()|0;while(!((b|0)==0&(E|0)==0));return Qr(A|0),m|0}function Ch(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0;if(!(ip(A,b)|0)||(A=nc(A)|0,E=+Ce[b>>3],M=+Ce[b+8>>3],M=A&M<0?M+6.283185307179586:M,qe=y[m>>2]|0,(qe|0)<=0))return qe=0,qe|0;if(Te=y[m+4>>2]|0,A){A=0,fe=M,b=-1,m=0;e:for(;;){for(ee=m;F=+Ce[Te+(ee<<4)>>3],M=+Ce[Te+(ee<<4)+8>>3],m=(b+2|0)%(qe|0)|0,B=+Ce[Te+(m<<4)>>3],N=+Ce[Te+(m<<4)+8>>3],F>B?(W=F,F=N):(W=B,B=F,F=M,M=N),E=E==B|E==W?E+2220446049250313e-31:E,!!(E<B|E>W);)if(b=ee+1|0,(b|0)>=(qe|0)){b=22;break e}else m=ee,ee=b,b=m;if(N=F<0?F+6.283185307179586:F,F=M<0?M+6.283185307179586:M,fe=N==fe|F==fe?fe+-2220446049250313e-31:fe,W=N+(F-N)*((E-B)/(W-B)),(W<0?W+6.283185307179586:W)>fe&&(A=A^1),m=ee+1|0,(m|0)>=(qe|0)){b=22;break}else b=ee}if((b|0)==22)return A|0}else{A=0,fe=M,b=-1,m=0;e:for(;;){for(ee=m;F=+Ce[Te+(ee<<4)>>3],M=+Ce[Te+(ee<<4)+8>>3],m=(b+2|0)%(qe|0)|0,B=+Ce[Te+(m<<4)>>3],N=+Ce[Te+(m<<4)+8>>3],F>B?(W=F,F=N):(W=B,B=F,F=M,M=N),E=E==B|E==W?E+2220446049250313e-31:E,!!(E<B|E>W);)if(b=ee+1|0,(b|0)>=(qe|0)){b=22;break e}else m=ee,ee=b,b=m;if(fe=F==fe|M==fe?fe+-2220446049250313e-31:fe,F+(M-F)*((E-B)/(W-B))>fe&&(A=A^1),m=ee+1|0,(m|0)>=(qe|0)){b=22;break}else b=ee}if((b|0)==22)return A|0}return 0}function du(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0;if(je=y[m>>2]|0,!je){y[A>>2]=0,y[A+4>>2]=0,y[A+8>>2]=0,y[A+12>>2]=0,y[A+16>>2]=0,y[A+20>>2]=0,y[A+24>>2]=0,y[A+28>>2]=0;return}if(nt=A+8|0,Ce[nt>>3]=17976931348623157e292,It=A+24|0,Ce[It>>3]=17976931348623157e292,Ce[A>>3]=-17976931348623157e292,wt=A+16|0,Ce[wt>>3]=-17976931348623157e292,!((je|0)<=0)){for(qe=y[m+4>>2]|0,ee=17976931348623157e292,fe=-17976931348623157e292,Te=0,m=-1,B=17976931348623157e292,F=17976931348623157e292,W=-17976931348623157e292,E=-17976931348623157e292,Je=0;b=+Ce[qe+(Je<<4)>>3],N=+Ce[qe+(Je<<4)+8>>3],m=m+2|0,M=+Ce[qe+(((m|0)==(je|0)?0:m)<<4)+8>>3],b<B&&(Ce[nt>>3]=b,B=b),N<F&&(Ce[It>>3]=N,F=N),b>W?Ce[A>>3]=b:b=W,N>E&&(Ce[wt>>3]=N,E=N),ee=N>0&N<ee?N:ee,fe=N<0&N>fe?N:fe,Te=Te|+Gi(+(N-M))>3.141592653589793,m=Je+1|0,(m|0)!=(je|0);)at=Je,W=b,Je=m,m=at;Te&&(Ce[wt>>3]=fe,Ce[It>>3]=ee)}}function Hf(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,gr=0,sr=0;if(je=y[m>>2]|0,je){if(nt=A+8|0,Ce[nt>>3]=17976931348623157e292,It=A+24|0,Ce[It>>3]=17976931348623157e292,Ce[A>>3]=-17976931348623157e292,wt=A+16|0,Ce[wt>>3]=-17976931348623157e292,(je|0)>0){for(M=y[m+4>>2]|0,qe=17976931348623157e292,Je=-17976931348623157e292,E=0,b=-1,W=17976931348623157e292,ee=17976931348623157e292,Te=-17976931348623157e292,F=-17976931348623157e292,at=0;B=+Ce[M+(at<<4)>>3],fe=+Ce[M+(at<<4)+8>>3],gr=b+2|0,N=+Ce[M+(((gr|0)==(je|0)?0:gr)<<4)+8>>3],B<W&&(Ce[nt>>3]=B,W=B),fe<ee&&(Ce[It>>3]=fe,ee=fe),B>Te?Ce[A>>3]=B:B=Te,fe>F&&(Ce[wt>>3]=fe,F=fe),qe=fe>0&fe<qe?fe:qe,Je=fe<0&fe>Je?fe:Je,E=E|+Gi(+(fe-N))>3.141592653589793,b=at+1|0,(b|0)!=(je|0);)gr=at,Te=B,at=b,b=gr;E&&(Ce[wt>>3]=Je,Ce[It>>3]=qe)}}else y[A>>2]=0,y[A+4>>2]=0,y[A+8>>2]=0,y[A+12>>2]=0,y[A+16>>2]=0,y[A+20>>2]=0,y[A+24>>2]=0,y[A+28>>2]=0;if(gr=m+8|0,b=y[gr>>2]|0,!((b|0)<=0)){ar=m+12|0,ft=0;do if(M=y[ar>>2]|0,E=ft,ft=ft+1|0,It=A+(ft<<5)|0,wt=y[M+(E<<3)>>2]|0,wt){if(at=A+(ft<<5)+8|0,Ce[at>>3]=17976931348623157e292,m=A+(ft<<5)+24|0,Ce[m>>3]=17976931348623157e292,Ce[It>>3]=-17976931348623157e292,bt=A+(ft<<5)+16|0,Ce[bt>>3]=-17976931348623157e292,(wt|0)>0){for(je=y[M+(E<<3)+4>>2]|0,qe=17976931348623157e292,Je=-17976931348623157e292,M=0,E=-1,nt=0,W=17976931348623157e292,ee=17976931348623157e292,fe=-17976931348623157e292,F=-17976931348623157e292;B=+Ce[je+(nt<<4)>>3],Te=+Ce[je+(nt<<4)+8>>3],E=E+2|0,N=+Ce[je+(((E|0)==(wt|0)?0:E)<<4)+8>>3],B<W&&(Ce[at>>3]=B,W=B),Te<ee&&(Ce[m>>3]=Te,ee=Te),B>fe?Ce[It>>3]=B:B=fe,Te>F&&(Ce[bt>>3]=Te,F=Te),qe=Te>0&Te<qe?Te:qe,Je=Te<0&Te>Je?Te:Je,M=M|+Gi(+(Te-N))>3.141592653589793,E=nt+1|0,(E|0)!=(wt|0);)sr=nt,nt=E,fe=B,E=sr;M&&(Ce[bt>>3]=Je,Ce[m>>3]=qe)}}else y[It>>2]=0,y[It+4>>2]=0,y[It+8>>2]=0,y[It+12>>2]=0,y[It+16>>2]=0,y[It+20>>2]=0,y[It+24>>2]=0,y[It+28>>2]=0,b=y[gr>>2]|0;while((ft|0)<(b|0))}}function dc(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if(!(Ch(m,A,b)|0))return M=0,M|0;if(M=m+8|0,(y[M>>2]|0)<=0)return M=1,M|0;for(E=m+12|0,m=0;;){if(B=m,m=m+1|0,Ch((y[E>>2]|0)+(B<<3)|0,A+(m<<5)|0,b)|0){m=0,E=6;break}if((m|0)>=(y[M>>2]|0)){m=1,E=6;break}}return(E|0)==6?m|0:0}function yp(){return 8}function pu(){return 16}function pc(){return 168}function xp(){return 8}function Wf(){return 16}function Ac(){return 12}function bp(){return 8}function vp(m){return m=m|0,+(+((y[m>>2]|0)>>>0)+4294967296*+(y[m+4>>2]|0))}function Sh(m){m=m|0;var A=0,b=0;return b=+Ce[m>>3],A=+Ce[m+8>>3],+ +gn(+(b*b+A*A))}function $f(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0;ee=+Ce[m>>3],W=+Ce[A>>3]-ee,N=+Ce[m+8>>3],F=+Ce[A+8>>3]-N,Te=+Ce[b>>3],B=+Ce[E>>3]-Te,qe=+Ce[b+8>>3],fe=+Ce[E+8>>3]-qe,B=(B*(N-qe)-(ee-Te)*fe)/(W*fe-F*B),Ce[M>>3]=ee+W*B,Ce[M+8>>3]=N+F*B}function C(m,A){return m=m|0,A=A|0,+Gi(+(+Ce[m>>3]-+Ce[A>>3]))<11920928955078125e-23?(A=+Gi(+(+Ce[m+8>>3]-+Ce[A+8>>3]))<11920928955078125e-23,A|0):(A=0,A|0)}function o(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;return M=+Ce[m>>3]-+Ce[A>>3],E=+Ce[m+8>>3]-+Ce[A+8>>3],b=+Ce[m+16>>3]-+Ce[A+16>>3],+(M*M+E*E+b*b)}function u(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;b=+Ce[m>>3],E=+Ci(+b),b=+Pi(+b),Ce[A+16>>3]=b,b=+Ce[m+8>>3],M=E*+Ci(+b),Ce[A>>3]=M,b=E*+Pi(+b),Ce[A+8>>3]=b}function _(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if(B=we,we=we+16|0,M=B,E=Hi(m,A)|0,(b+-1|0)>>>0>5||(E=(E|0)!=0,(b|0)==1&E))return M=-1,we=B,M|0;do if(v(m,A,M)|0)E=-1;else if(E){E=((y[21936+(b<<2)>>2]|0)+5-(y[M>>2]|0)|0)%5|0;break}else{E=((y[21968+(b<<2)>>2]|0)+6-(y[M>>2]|0)|0)%6|0;break}while(!1);return M=E,we=B,M|0}function v(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,ee=0;if(ee=we,we=we+32|0,F=ee+16|0,N=ee,E=ta(m,A,F)|0,E|0)return b=E,we=ee,b|0;B=hp(m,A)|0,W=Ns(m,A)|0,rc(B,N),E=Ef(B,y[F>>2]|0)|0;e:do if(yi(B)|0){do switch(B|0){case 4:{m=0;break}case 14:{m=1;break}case 24:{m=2;break}case 38:{m=3;break}case 49:{m=4;break}case 58:{m=5;break}case 63:{m=6;break}case 72:{m=7;break}case 83:{m=8;break}case 97:{m=9;break}case 107:{m=10;break}case 117:{m=11;break}default:{E=1;break e}}while(!1);if(M=y[22e3+(m*24|0)+8>>2]|0,A=y[22e3+(m*24|0)+16>>2]|0,m=y[F>>2]|0,(m|0)!=(y[N>>2]|0)&&(N=Tf(B)|0,m=y[F>>2]|0,N|(m|0)==(A|0)&&(E=(E+1|0)%6|0)),(W|0)==3&(m|0)==(A|0)){E=(E+5|0)%6|0,M=22;break}(W|0)==5&(m|0)==(M|0)&&(E=(E+1|0)%6|0),M=22}else M=22;while(!1);return(M|0)==22&&(y[b>>2]=E,E=0),b=E,we=ee,b|0}function S(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0;if(bt=we,we=we+32|0,at=bt+24|0,It=bt+20|0,je=bt+8|0,Je=bt+16|0,qe=bt,W=(Hi(m,A)|0)==0,W=W?6:5,fe=mt(m|0,A|0,52)|0,Re()|0,fe=fe&15,W>>>0<=b>>>0)return E=2,we=bt,E|0;Te=(fe|0)==0,!Te&&(nt=Nt(7,0,(fe^15)*3|0)|0,(nt&m|0)==0&((Re()|0)&A|0)==0)?M=b:B=4;e:do if((B|0)==4){if(M=(Hi(m,A)|0)!=0,((M?4:5)|0)<(b|0)||v(m,A,at)|0||(B=(y[at>>2]|0)+b|0,M?M=22288+(((B|0)%5|0)<<2)|0:M=22320+(((B|0)%6|0)<<2)|0,nt=y[M>>2]|0,(nt|0)==7))return E=1,we=bt,E|0;y[It>>2]=0,M=fs(m,A,nt,It,je)|0;do if(!M){if(N=je,ee=y[N>>2]|0,N=y[N+4>>2]|0,F=N>>>0<A>>>0|(N|0)==(A|0)&ee>>>0<m>>>0,B=F?ee:m,F=F?N:A,!Te&&(Te=Nt(7,0,(fe^15)*3|0)|0,(ee&Te|0)==0&(N&(Re()|0)|0)==0))M=b;else{if(N=(b+-1+W|0)%(W|0)|0,M=Hi(m,A)|0,(N|0)<0&&zr(23313,23315,245,23324),W=(M|0)!=0,((W?4:5)|0)<(N|0)&&zr(23313,23315,245,23324),v(m,A,at)|0&&zr(23313,23315,245,23324),M=(y[at>>2]|0)+N|0,W?M=22288+(((M|0)%5|0)<<2)|0:M=22320+(((M|0)%6|0)<<2)|0,N=y[M>>2]|0,(N|0)==7&&zr(23313,23315,245,23324),y[Je>>2]=0,M=fs(m,A,N,Je,qe)|0,M|0)break;ee=qe,W=y[ee>>2]|0,ee=y[ee+4>>2]|0;do if(ee>>>0<F>>>0|(ee|0)==(F|0)&W>>>0<B>>>0){if(Hi(W,ee)|0?B=bf(W,ee,m,A)|0:B=y[22384+((((y[Je>>2]|0)+(y[22352+(N<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,M=Hi(W,ee)|0,(B+-1|0)>>>0>5){M=-1,B=W,F=ee;break}if(M=(M|0)!=0,(B|0)==1&M){M=-1,B=W,F=ee;break}do if(v(W,ee,at)|0)M=-1;else if(M){M=((y[21936+(B<<2)>>2]|0)+5-(y[at>>2]|0)|0)%5|0;break}else{M=((y[21968+(B<<2)>>2]|0)+6-(y[at>>2]|0)|0)%6|0;break}while(!1);B=W,F=ee}else M=b;while(!1);N=je,ee=y[N>>2]|0,N=y[N+4>>2]|0}if((B|0)==(ee|0)&(F|0)==(N|0)){if(W=(Hi(ee,N)|0)!=0,W?m=bf(ee,N,m,A)|0:m=y[22384+((((y[It>>2]|0)+(y[22352+(nt<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,M=Hi(ee,N)|0,(m+-1|0)>>>0<=5&&(wt=(M|0)!=0,!((m|0)==1&wt)))do if(v(ee,N,at)|0)M=-1;else if(wt){M=((y[21936+(m<<2)>>2]|0)+5-(y[at>>2]|0)|0)%5|0;break}else{M=((y[21968+(m<<2)>>2]|0)+6-(y[at>>2]|0)|0)%6|0;break}while(!1);else M=-1;M=M+1|0,M=(M|0)==6|W&(M|0)==5?0:M}A=F,m=B;break e}while(!1);return E=M,we=bt,E|0}while(!1);return wt=Nt(M|0,0,56)|0,at=Re()|0|A&-2130706433|536870912,y[E>>2]=wt|m,y[E+4>>2]=at,E=0,we=bt,E|0}function O(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;return B=(Hi(m,A)|0)==0,E=S(m,A,0,b)|0,M=(E|0)==0,B?!M||(E=S(m,A,1,b+8|0)|0,E|0)||(E=S(m,A,2,b+16|0)|0,E|0)||(E=S(m,A,3,b+24|0)|0,E|0)||(E=S(m,A,4,b+32|0)|0,E)?(B=E,B|0):S(m,A,5,b+40|0)|0:!M||(E=S(m,A,1,b+8|0)|0,E|0)||(E=S(m,A,2,b+16|0)|0,E|0)||(E=S(m,A,3,b+24|0)|0,E|0)||(E=S(m,A,4,b+32|0)|0,E|0)?(B=E,B|0):(B=b+40|0,y[B>>2]=0,y[B+4>>2]=0,B=0,B|0)}function z(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0;return W=we,we=we+192|0,M=W,B=W+168|0,F=mt(m|0,A|0,56)|0,Re()|0,F=F&7,N=A&-2130706433|134217728,E=ta(m,N,B)|0,E|0?(N=E,we=W,N|0):(A=mt(m|0,A|0,52)|0,Re()|0,A=A&15,Hi(m,N)|0?Df(B,A,F,1,M):Va(B,A,F,1,M),N=M+8|0,y[b>>2]=y[N>>2],y[b+4>>2]=y[N+4>>2],y[b+8>>2]=y[N+8>>2],y[b+12>>2]=y[N+12>>2],N=0,we=W,N|0)}function V(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return M=we,we=we+16|0,b=M,!(!0&(A&2013265920|0)==536870912)||(E=A&-2130706433|134217728,!(kf(m,E)|0))?(E=0,we=M,E|0):(B=mt(m|0,A|0,56)|0,Re()|0,B=(S(m,E,B&7,b)|0)==0,E=b,E=B&((y[E>>2]|0)==(m|0)?(y[E+4>>2]|0)==(A|0):0)&1,we=M,E|0)}function H(m,A,b){m=m|0,A=A|0,b=b|0;var E=0;(A|0)>0?(E=Ze(A,4)|0,y[m>>2]=E,E||zr(23337,23360,40,23374)):y[m>>2]=0,y[m+4>>2]=A,y[m+8>>2]=0,y[m+12>>2]=b}function Q(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;M=m+4|0,B=m+12|0,F=m+8|0;e:for(;;){for(b=y[M>>2]|0,A=0;;){if((A|0)>=(b|0))break e;if(E=y[m>>2]|0,N=y[E+(A<<2)>>2]|0,!N)A=A+1|0;else break}A=E+(~~(+Gi(+(+Wn(10,+ +(15-(y[B>>2]|0)|0))*(+Ce[N>>3]+ +Ce[N+8>>3])))%+(b|0))>>>0<<2)|0,b=y[A>>2]|0;t:do if(b|0){if(E=N+32|0,(b|0)==(N|0))y[A>>2]=y[E>>2];else{if(b=b+32|0,A=y[b>>2]|0,!A)break;for(;(A|0)!=(N|0);)if(b=A+32|0,A=y[b>>2]|0,!A)break t;y[b>>2]=y[E>>2]}De(N),y[F>>2]=(y[F>>2]|0)+-1}while(!1)}De(y[m>>2]|0)}function ne(m){m=m|0;var A=0,b=0,E=0;for(E=y[m+4>>2]|0,b=0;;){if((b|0)>=(E|0)){A=0,b=4;break}if(A=y[(y[m>>2]|0)+(b<<2)>>2]|0,!A)b=b+1|0;else{b=4;break}}return(b|0)==4?A|0:0}function ie(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;if(b=~~(+Gi(+(+Wn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ce[A>>3]+ +Ce[A+8>>3])))%+(y[m+4>>2]|0))>>>0,b=(y[m>>2]|0)+(b<<2)|0,E=y[b>>2]|0,!E)return B=1,B|0;B=A+32|0;do if((E|0)!=(A|0)){if(b=y[E+32>>2]|0,!b)return B=1,B|0;for(M=b;;){if((M|0)==(A|0)){M=8;break}if(b=y[M+32>>2]|0,b)E=M,M=b;else{b=1,M=10;break}}if((M|0)==8){y[E+32>>2]=y[B>>2];break}else if((M|0)==10)return b|0}else y[b>>2]=y[B>>2];while(!1);return De(A),B=m+8|0,y[B>>2]=(y[B>>2]|0)+-1,B=0,B|0}function de(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;B=Ge(40)|0,B||zr(23390,23360,98,23403),y[B>>2]=y[A>>2],y[B+4>>2]=y[A+4>>2],y[B+8>>2]=y[A+8>>2],y[B+12>>2]=y[A+12>>2],M=B+16|0,y[M>>2]=y[b>>2],y[M+4>>2]=y[b+4>>2],y[M+8>>2]=y[b+8>>2],y[M+12>>2]=y[b+12>>2],y[B+32>>2]=0,M=~~(+Gi(+(+Wn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ce[A>>3]+ +Ce[A+8>>3])))%+(y[m+4>>2]|0))>>>0,M=(y[m>>2]|0)+(M<<2)|0,E=y[M>>2]|0;do if(!E)y[M>>2]=B;else{for(;!(gl(E,A)|0&&gl(E+16|0,b)|0);)if(M=y[E+32>>2]|0,E=M|0?M:E,!(y[E+32>>2]|0)){F=10;break}if((F|0)==10){y[E+32>>2]=B;break}return De(B),F=E,F|0}while(!1);return F=m+8|0,y[F>>2]=(y[F>>2]|0)+1,F=B,F|0}function ge(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;if(M=~~(+Gi(+(+Wn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ce[A>>3]+ +Ce[A+8>>3])))%+(y[m+4>>2]|0))>>>0,M=y[(y[m>>2]|0)+(M<<2)>>2]|0,!M)return b=0,b|0;if(!b){for(m=M;;){if(gl(m,A)|0){E=10;break}if(m=y[m+32>>2]|0,!m){m=0,E=10;break}}if((E|0)==10)return m|0}for(m=M;;){if(gl(m,A)|0&&gl(m+16|0,b)|0){E=10;break}if(m=y[m+32>>2]|0,!m){m=0,E=10;break}}return(E|0)==10?m|0:0}function Pe(m,A){m=m|0,A=A|0;var b=0;if(b=~~(+Gi(+(+Wn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ce[A>>3]+ +Ce[A+8>>3])))%+(y[m+4>>2]|0))>>>0,m=y[(y[m>>2]|0)+(b<<2)>>2]|0,!m)return b=0,b|0;for(;;){if(gl(m,A)|0){A=5;break}if(m=y[m+32>>2]|0,!m){m=0,A=5;break}}return(A|0)==5?m|0:0}function Ie(){return 23424}function Le(m){return m=+m,+ +Wi(+m)}function Ne(m){return m=+m,~~+Le(m)|0}function Ge(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0;ar=we,we=we+16|0,qe=ar;do if(m>>>0<245){if(ee=m>>>0<11?16:m+11&-8,m=ee>>>3,Te=y[5857]|0,b=Te>>>m,b&3|0)return A=(b&1^1)+m|0,m=23468+(A<<1<<2)|0,b=m+8|0,E=y[b>>2]|0,M=E+8|0,B=y[M>>2]|0,(B|0)==(m|0)?y[5857]=Te&~(1<<A):(y[B+12>>2]=m,y[b>>2]=B),ft=A<<3,y[E+4>>2]=ft|3,ft=E+ft+4|0,y[ft>>2]=y[ft>>2]|1,ft=M,we=ar,ft|0;if(fe=y[5859]|0,ee>>>0>fe>>>0){if(b|0)return A=2<<m,A=b<<m&(A|0-A),A=(A&0-A)+-1|0,N=A>>>12&16,A=A>>>N,b=A>>>5&8,A=A>>>b,B=A>>>2&4,A=A>>>B,m=A>>>1&2,A=A>>>m,E=A>>>1&1,E=(b|N|B|m|E)+(A>>>E)|0,A=23468+(E<<1<<2)|0,m=A+8|0,B=y[m>>2]|0,N=B+8|0,b=y[N>>2]|0,(b|0)==(A|0)?(m=Te&~(1<<E),y[5857]=m):(y[b+12>>2]=A,y[m>>2]=b,m=Te),ft=E<<3,F=ft-ee|0,y[B+4>>2]=ee|3,M=B+ee|0,y[M+4>>2]=F|1,y[B+ft>>2]=F,fe|0&&(E=y[5862]|0,A=fe>>>3,b=23468+(A<<1<<2)|0,A=1<<A,m&A?(m=b+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=b,m=b+8|0),y[m>>2]=E,y[A+12>>2]=E,y[E+8>>2]=A,y[E+12>>2]=b),y[5859]=F,y[5862]=M,ft=N,we=ar,ft|0;if(B=y[5858]|0,B){for(b=(B&0-B)+-1|0,M=b>>>12&16,b=b>>>M,E=b>>>5&8,b=b>>>E,F=b>>>2&4,b=b>>>F,N=b>>>1&2,b=b>>>N,W=b>>>1&1,W=y[23732+((E|M|F|N|W)+(b>>>W)<<2)>>2]|0,b=W,N=W,W=(y[W+4>>2]&-8)-ee|0;m=y[b+16>>2]|0,!(!m&&(m=y[b+20>>2]|0,!m));)F=(y[m+4>>2]&-8)-ee|0,M=F>>>0<W>>>0,b=m,N=M?m:N,W=M?F:W;if(F=N+ee|0,F>>>0>N>>>0){M=y[N+24>>2]|0,A=y[N+12>>2]|0;do if((A|0)==(N|0)){if(m=N+20|0,A=y[m>>2]|0,!A&&(m=N+16|0,A=y[m>>2]|0,!A)){b=0;break}for(;;)if(E=A+20|0,b=y[E>>2]|0,b)A=b,m=E;else if(E=A+16|0,b=y[E>>2]|0,b)A=b,m=E;else break;y[m>>2]=0,b=A}else b=y[N+8>>2]|0,y[b+12>>2]=A,y[A+8>>2]=b,b=A;while(!1);do if(M|0){if(A=y[N+28>>2]|0,m=23732+(A<<2)|0,(N|0)==(y[m>>2]|0)){if(y[m>>2]=b,!b){y[5858]=B&~(1<<A);break}}else if(ft=M+16|0,y[((y[ft>>2]|0)==(N|0)?ft:M+20|0)>>2]=b,!b)break;y[b+24>>2]=M,A=y[N+16>>2]|0,A|0&&(y[b+16>>2]=A,y[A+24>>2]=b),A=y[N+20>>2]|0,A|0&&(y[b+20>>2]=A,y[A+24>>2]=b)}while(!1);return W>>>0<16?(ft=W+ee|0,y[N+4>>2]=ft|3,ft=N+ft+4|0,y[ft>>2]=y[ft>>2]|1):(y[N+4>>2]=ee|3,y[F+4>>2]=W|1,y[F+W>>2]=W,fe|0&&(E=y[5862]|0,A=fe>>>3,b=23468+(A<<1<<2)|0,A=1<<A,A&Te?(m=b+8|0,A=y[m>>2]|0):(y[5857]=A|Te,A=b,m=b+8|0),y[m>>2]=E,y[A+12>>2]=E,y[E+8>>2]=A,y[E+12>>2]=b),y[5859]=W,y[5862]=F),ft=N+8|0,we=ar,ft|0}else Te=ee}else Te=ee}else Te=ee}else if(m>>>0<=4294967231)if(m=m+11|0,ee=m&-8,E=y[5858]|0,E){M=0-ee|0,m=m>>>8,m?ee>>>0>16777215?W=31:(Te=(m+1048320|0)>>>16&8,nt=m<<Te,N=(nt+520192|0)>>>16&4,nt=nt<<N,W=(nt+245760|0)>>>16&2,W=14-(N|Te|W)+(nt<<W>>>15)|0,W=ee>>>(W+7|0)&1|W<<1):W=0,b=y[23732+(W<<2)>>2]|0;e:do if(!b)b=0,m=0,nt=61;else for(m=0,N=ee<<((W|0)==31?0:25-(W>>>1)|0),B=0;;){if(F=(y[b+4>>2]&-8)-ee|0,F>>>0<M>>>0)if(F)m=b,M=F;else{m=b,M=0,nt=65;break e}if(nt=y[b+20>>2]|0,b=y[b+16+(N>>>31<<2)>>2]|0,B=(nt|0)==0|(nt|0)==(b|0)?B:nt,b)N=N<<1;else{b=B,nt=61;break}}while(!1);if((nt|0)==61){if((b|0)==0&(m|0)==0){if(m=2<<W,m=(m|0-m)&E,!m){Te=ee;break}Te=(m&0-m)+-1|0,F=Te>>>12&16,Te=Te>>>F,B=Te>>>5&8,Te=Te>>>B,N=Te>>>2&4,Te=Te>>>N,W=Te>>>1&2,Te=Te>>>W,b=Te>>>1&1,m=0,b=y[23732+((B|F|N|W|b)+(Te>>>b)<<2)>>2]|0}b?nt=65:(N=m,F=M)}if((nt|0)==65)for(B=b;;)if(Te=(y[B+4>>2]&-8)-ee|0,b=Te>>>0<M>>>0,M=b?Te:M,m=b?B:m,b=y[B+16>>2]|0,b||(b=y[B+20>>2]|0),b)B=b;else{N=m,F=M;break}if(N|0&&F>>>0<((y[5859]|0)-ee|0)>>>0&&(fe=N+ee|0,fe>>>0>N>>>0)){B=y[N+24>>2]|0,A=y[N+12>>2]|0;do if((A|0)==(N|0)){if(m=N+20|0,A=y[m>>2]|0,!A&&(m=N+16|0,A=y[m>>2]|0,!A)){A=0;break}for(;;)if(M=A+20|0,b=y[M>>2]|0,b)A=b,m=M;else if(M=A+16|0,b=y[M>>2]|0,b)A=b,m=M;else break;y[m>>2]=0}else ft=y[N+8>>2]|0,y[ft+12>>2]=A,y[A+8>>2]=ft;while(!1);do if(B){if(m=y[N+28>>2]|0,b=23732+(m<<2)|0,(N|0)==(y[b>>2]|0)){if(y[b>>2]=A,!A){E=E&~(1<<m),y[5858]=E;break}}else if(ft=B+16|0,y[((y[ft>>2]|0)==(N|0)?ft:B+20|0)>>2]=A,!A)break;y[A+24>>2]=B,m=y[N+16>>2]|0,m|0&&(y[A+16>>2]=m,y[m+24>>2]=A),m=y[N+20>>2]|0,m&&(y[A+20>>2]=m,y[m+24>>2]=A)}while(!1);e:do if(F>>>0<16)ft=F+ee|0,y[N+4>>2]=ft|3,ft=N+ft+4|0,y[ft>>2]=y[ft>>2]|1;else{if(y[N+4>>2]=ee|3,y[fe+4>>2]=F|1,y[fe+F>>2]=F,A=F>>>3,F>>>0<256){b=23468+(A<<1<<2)|0,m=y[5857]|0,A=1<<A,m&A?(m=b+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=b,m=b+8|0),y[m>>2]=fe,y[A+12>>2]=fe,y[fe+8>>2]=A,y[fe+12>>2]=b;break}if(A=F>>>8,A?F>>>0>16777215?b=31:(bt=(A+1048320|0)>>>16&8,ft=A<<bt,at=(ft+520192|0)>>>16&4,ft=ft<<at,b=(ft+245760|0)>>>16&2,b=14-(at|bt|b)+(ft<<b>>>15)|0,b=F>>>(b+7|0)&1|b<<1):b=0,A=23732+(b<<2)|0,y[fe+28>>2]=b,m=fe+16|0,y[m+4>>2]=0,y[m>>2]=0,m=1<<b,!(E&m)){y[5858]=E|m,y[A>>2]=fe,y[fe+24>>2]=A,y[fe+12>>2]=fe,y[fe+8>>2]=fe;break}A=y[A>>2]|0;t:do if((y[A+4>>2]&-8|0)!=(F|0)){for(E=F<<((b|0)==31?0:25-(b>>>1)|0);b=A+16+(E>>>31<<2)|0,m=y[b>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(F|0)){A=m;break t}else E=E<<1,A=m;y[b>>2]=fe,y[fe+24>>2]=A,y[fe+12>>2]=fe,y[fe+8>>2]=fe;break e}while(!1);bt=A+8|0,ft=y[bt>>2]|0,y[ft+12>>2]=fe,y[bt>>2]=fe,y[fe+8>>2]=ft,y[fe+12>>2]=A,y[fe+24>>2]=0}while(!1);return ft=N+8|0,we=ar,ft|0}else Te=ee}else Te=ee;else Te=-1;while(!1);if(b=y[5859]|0,b>>>0>=Te>>>0)return A=b-Te|0,m=y[5862]|0,A>>>0>15?(ft=m+Te|0,y[5862]=ft,y[5859]=A,y[ft+4>>2]=A|1,y[m+b>>2]=A,y[m+4>>2]=Te|3):(y[5859]=0,y[5862]=0,y[m+4>>2]=b|3,ft=m+b+4|0,y[ft>>2]=y[ft>>2]|1),ft=m+8|0,we=ar,ft|0;if(F=y[5860]|0,F>>>0>Te>>>0)return at=F-Te|0,y[5860]=at,ft=y[5863]|0,bt=ft+Te|0,y[5863]=bt,y[bt+4>>2]=at|1,y[ft+4>>2]=Te|3,ft=ft+8|0,we=ar,ft|0;if(y[5975]|0?m=y[5977]|0:(y[5977]=4096,y[5976]=4096,y[5978]=-1,y[5979]=-1,y[5980]=0,y[5968]=0,y[5975]=qe&-16^1431655768,m=4096),N=Te+48|0,W=Te+47|0,B=m+W|0,M=0-m|0,ee=B&M,ee>>>0<=Te>>>0||(m=y[5967]|0,m|0&&(fe=y[5965]|0,qe=fe+ee|0,qe>>>0<=fe>>>0|qe>>>0>m>>>0)))return ft=0,we=ar,ft|0;e:do if(y[5968]&4)A=0,nt=143;else{b=y[5863]|0;t:do if(b){for(E=23876;qe=y[E>>2]|0,!(qe>>>0<=b>>>0&&(qe+(y[E+4>>2]|0)|0)>>>0>b>>>0);)if(m=y[E+8>>2]|0,m)E=m;else{nt=128;break t}if(A=B-F&M,A>>>0<2147483647)if(m=wi(A|0)|0,(m|0)==((y[E>>2]|0)+(y[E+4>>2]|0)|0)){if((m|0)!=-1){F=A,B=m,nt=145;break e}}else E=m,nt=136;else A=0}else nt=128;while(!1);do if((nt|0)==128)if(b=wi(0)|0,(b|0)!=-1&&(A=b,Je=y[5976]|0,je=Je+-1|0,A=(je&A|0?(je+A&0-Je)-A|0:0)+ee|0,Je=y[5965]|0,je=A+Je|0,A>>>0>Te>>>0&A>>>0<2147483647)){if(qe=y[5967]|0,qe|0&&je>>>0<=Je>>>0|je>>>0>qe>>>0){A=0;break}if(m=wi(A|0)|0,(m|0)==(b|0)){F=A,B=b,nt=145;break e}else E=m,nt=136}else A=0;while(!1);do if((nt|0)==136){if(b=0-A|0,!(N>>>0>A>>>0&(A>>>0<2147483647&(E|0)!=-1)))if((E|0)==-1){A=0;break}else{F=A,B=E,nt=145;break e}if(m=y[5977]|0,m=W-A+m&0-m,m>>>0>=2147483647){F=A,B=E,nt=145;break e}if((wi(m|0)|0)==-1){wi(b|0)|0,A=0;break}else{F=m+A|0,B=E,nt=145;break e}}while(!1);y[5968]=y[5968]|4,nt=143}while(!1);if((nt|0)==143&&ee>>>0<2147483647&&(at=wi(ee|0)|0,je=wi(0)|0,It=je-at|0,wt=It>>>0>(Te+40|0)>>>0,!((at|0)==-1|wt^1|at>>>0<je>>>0&((at|0)!=-1&(je|0)!=-1)^1))&&(F=wt?It:A,B=at,nt=145),(nt|0)==145){A=(y[5965]|0)+F|0,y[5965]=A,A>>>0>(y[5966]|0)>>>0&&(y[5966]=A),W=y[5863]|0;e:do if(W){for(A=23876;;){if(m=y[A>>2]|0,b=y[A+4>>2]|0,(B|0)==(m+b|0)){nt=154;break}if(E=y[A+8>>2]|0,E)A=E;else break}if((nt|0)==154&&(bt=A+4|0,(y[A+12>>2]&8|0)==0)&&B>>>0>W>>>0&m>>>0<=W>>>0){y[bt>>2]=b+F,ft=(y[5860]|0)+F|0,at=W+8|0,at=at&7|0?0-at&7:0,bt=W+at|0,at=ft-at|0,y[5863]=bt,y[5860]=at,y[bt+4>>2]=at|1,y[W+ft+4>>2]=40,y[5864]=y[5979];break}for(B>>>0<(y[5861]|0)>>>0&&(y[5861]=B),b=B+F|0,A=23876;;){if((y[A>>2]|0)==(b|0)){nt=162;break}if(m=y[A+8>>2]|0,m)A=m;else break}if((nt|0)==162&&!(y[A+12>>2]&8|0)){y[A>>2]=B,fe=A+4|0,y[fe>>2]=(y[fe>>2]|0)+F,fe=B+8|0,fe=B+(fe&7|0?0-fe&7:0)|0,A=b+8|0,A=b+(A&7|0?0-A&7:0)|0,ee=fe+Te|0,N=A-fe-Te|0,y[fe+4>>2]=Te|3;t:do if((W|0)==(A|0))ft=(y[5860]|0)+N|0,y[5860]=ft,y[5863]=ee,y[ee+4>>2]=ft|1;else{if((y[5862]|0)==(A|0)){ft=(y[5859]|0)+N|0,y[5859]=ft,y[5862]=ee,y[ee+4>>2]=ft|1,y[ee+ft>>2]=ft;break}if(m=y[A+4>>2]|0,(m&3|0)==1){F=m&-8,E=m>>>3;r:do if(m>>>0<256)if(m=y[A+8>>2]|0,b=y[A+12>>2]|0,(b|0)==(m|0)){y[5857]=y[5857]&~(1<<E);break}else{y[m+12>>2]=b,y[b+8>>2]=m;break}else{B=y[A+24>>2]|0,m=y[A+12>>2]|0;do if((m|0)==(A|0)){if(b=A+16|0,E=b+4|0,m=y[E>>2]|0,m)b=E;else if(m=y[b>>2]|0,!m){m=0;break}for(;;)if(M=m+20|0,E=y[M>>2]|0,E)m=E,b=M;else if(M=m+16|0,E=y[M>>2]|0,E)m=E,b=M;else break;y[b>>2]=0}else ft=y[A+8>>2]|0,y[ft+12>>2]=m,y[m+8>>2]=ft;while(!1);if(!B)break;b=y[A+28>>2]|0,E=23732+(b<<2)|0;do if((y[E>>2]|0)!=(A|0)){if(ft=B+16|0,y[((y[ft>>2]|0)==(A|0)?ft:B+20|0)>>2]=m,!m)break r}else{if(y[E>>2]=m,m|0)break;y[5858]=y[5858]&~(1<<b);break r}while(!1);if(y[m+24>>2]=B,b=A+16|0,E=y[b>>2]|0,E|0&&(y[m+16>>2]=E,y[E+24>>2]=m),b=y[b+4>>2]|0,!b)break;y[m+20>>2]=b,y[b+24>>2]=m}while(!1);A=A+F|0,M=F+N|0}else M=N;if(A=A+4|0,y[A>>2]=y[A>>2]&-2,y[ee+4>>2]=M|1,y[ee+M>>2]=M,A=M>>>3,M>>>0<256){b=23468+(A<<1<<2)|0,m=y[5857]|0,A=1<<A,m&A?(m=b+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=b,m=b+8|0),y[m>>2]=ee,y[A+12>>2]=ee,y[ee+8>>2]=A,y[ee+12>>2]=b;break}A=M>>>8;do if(!A)E=0;else{if(M>>>0>16777215){E=31;break}bt=(A+1048320|0)>>>16&8,ft=A<<bt,at=(ft+520192|0)>>>16&4,ft=ft<<at,E=(ft+245760|0)>>>16&2,E=14-(at|bt|E)+(ft<<E>>>15)|0,E=M>>>(E+7|0)&1|E<<1}while(!1);if(A=23732+(E<<2)|0,y[ee+28>>2]=E,m=ee+16|0,y[m+4>>2]=0,y[m>>2]=0,m=y[5858]|0,b=1<<E,!(m&b)){y[5858]=m|b,y[A>>2]=ee,y[ee+24>>2]=A,y[ee+12>>2]=ee,y[ee+8>>2]=ee;break}A=y[A>>2]|0;r:do if((y[A+4>>2]&-8|0)!=(M|0)){for(E=M<<((E|0)==31?0:25-(E>>>1)|0);b=A+16+(E>>>31<<2)|0,m=y[b>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(M|0)){A=m;break r}else E=E<<1,A=m;y[b>>2]=ee,y[ee+24>>2]=A,y[ee+12>>2]=ee,y[ee+8>>2]=ee;break t}while(!1);bt=A+8|0,ft=y[bt>>2]|0,y[ft+12>>2]=ee,y[bt>>2]=ee,y[ee+8>>2]=ft,y[ee+12>>2]=A,y[ee+24>>2]=0}while(!1);return ft=fe+8|0,we=ar,ft|0}for(A=23876;m=y[A>>2]|0,!(m>>>0<=W>>>0&&(ft=m+(y[A+4>>2]|0)|0,ft>>>0>W>>>0));)A=y[A+8>>2]|0;M=ft+-47|0,m=M+8|0,m=M+(m&7|0?0-m&7:0)|0,M=W+16|0,m=m>>>0<M>>>0?W:m,A=m+8|0,b=F+-40|0,at=B+8|0,at=at&7|0?0-at&7:0,bt=B+at|0,at=b-at|0,y[5863]=bt,y[5860]=at,y[bt+4>>2]=at|1,y[B+b+4>>2]=40,y[5864]=y[5979],b=m+4|0,y[b>>2]=27,y[A>>2]=y[5969],y[A+4>>2]=y[5970],y[A+8>>2]=y[5971],y[A+12>>2]=y[5972],y[5969]=B,y[5970]=F,y[5972]=0,y[5971]=A,A=m+24|0;do bt=A,A=A+4|0,y[A>>2]=7;while((bt+8|0)>>>0<ft>>>0);if((m|0)!=(W|0)){if(B=m-W|0,y[b>>2]=y[b>>2]&-2,y[W+4>>2]=B|1,y[m>>2]=B,A=B>>>3,B>>>0<256){b=23468+(A<<1<<2)|0,m=y[5857]|0,A=1<<A,m&A?(m=b+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=b,m=b+8|0),y[m>>2]=W,y[A+12>>2]=W,y[W+8>>2]=A,y[W+12>>2]=b;break}if(A=B>>>8,A?B>>>0>16777215?E=31:(bt=(A+1048320|0)>>>16&8,ft=A<<bt,at=(ft+520192|0)>>>16&4,ft=ft<<at,E=(ft+245760|0)>>>16&2,E=14-(at|bt|E)+(ft<<E>>>15)|0,E=B>>>(E+7|0)&1|E<<1):E=0,b=23732+(E<<2)|0,y[W+28>>2]=E,y[W+20>>2]=0,y[M>>2]=0,A=y[5858]|0,m=1<<E,!(A&m)){y[5858]=A|m,y[b>>2]=W,y[W+24>>2]=b,y[W+12>>2]=W,y[W+8>>2]=W;break}A=y[b>>2]|0;t:do if((y[A+4>>2]&-8|0)!=(B|0)){for(E=B<<((E|0)==31?0:25-(E>>>1)|0);b=A+16+(E>>>31<<2)|0,m=y[b>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(B|0)){A=m;break t}else E=E<<1,A=m;y[b>>2]=W,y[W+24>>2]=A,y[W+12>>2]=W,y[W+8>>2]=W;break e}while(!1);bt=A+8|0,ft=y[bt>>2]|0,y[ft+12>>2]=W,y[bt>>2]=W,y[W+8>>2]=ft,y[W+12>>2]=A,y[W+24>>2]=0}}else ft=y[5861]|0,(ft|0)==0|B>>>0<ft>>>0&&(y[5861]=B),y[5969]=B,y[5970]=F,y[5972]=0,y[5866]=y[5975],y[5865]=-1,y[5870]=23468,y[5869]=23468,y[5872]=23476,y[5871]=23476,y[5874]=23484,y[5873]=23484,y[5876]=23492,y[5875]=23492,y[5878]=23500,y[5877]=23500,y[5880]=23508,y[5879]=23508,y[5882]=23516,y[5881]=23516,y[5884]=23524,y[5883]=23524,y[5886]=23532,y[5885]=23532,y[5888]=23540,y[5887]=23540,y[5890]=23548,y[5889]=23548,y[5892]=23556,y[5891]=23556,y[5894]=23564,y[5893]=23564,y[5896]=23572,y[5895]=23572,y[5898]=23580,y[5897]=23580,y[5900]=23588,y[5899]=23588,y[5902]=23596,y[5901]=23596,y[5904]=23604,y[5903]=23604,y[5906]=23612,y[5905]=23612,y[5908]=23620,y[5907]=23620,y[5910]=23628,y[5909]=23628,y[5912]=23636,y[5911]=23636,y[5914]=23644,y[5913]=23644,y[5916]=23652,y[5915]=23652,y[5918]=23660,y[5917]=23660,y[5920]=23668,y[5919]=23668,y[5922]=23676,y[5921]=23676,y[5924]=23684,y[5923]=23684,y[5926]=23692,y[5925]=23692,y[5928]=23700,y[5927]=23700,y[5930]=23708,y[5929]=23708,y[5932]=23716,y[5931]=23716,ft=F+-40|0,at=B+8|0,at=at&7|0?0-at&7:0,bt=B+at|0,at=ft-at|0,y[5863]=bt,y[5860]=at,y[bt+4>>2]=at|1,y[B+ft+4>>2]=40,y[5864]=y[5979];while(!1);if(A=y[5860]|0,A>>>0>Te>>>0)return at=A-Te|0,y[5860]=at,ft=y[5863]|0,bt=ft+Te|0,y[5863]=bt,y[bt+4>>2]=at|1,y[ft+4>>2]=Te|3,ft=ft+8|0,we=ar,ft|0}return ft=Ie()|0,y[ft>>2]=12,ft=0,we=ar,ft|0}function De(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0,W=0;if(m){b=m+-8|0,M=y[5861]|0,m=y[m+-4>>2]|0,A=m&-8,W=b+A|0;do if(m&1)N=b,F=b;else{if(E=y[b>>2]|0,!(m&3)||(F=b+(0-E)|0,B=E+A|0,F>>>0<M>>>0))return;if((y[5862]|0)==(F|0)){if(m=W+4|0,A=y[m>>2]|0,(A&3|0)!=3){N=F,A=B;break}y[5859]=B,y[m>>2]=A&-2,y[F+4>>2]=B|1,y[F+B>>2]=B;return}if(b=E>>>3,E>>>0<256)if(m=y[F+8>>2]|0,A=y[F+12>>2]|0,(A|0)==(m|0)){y[5857]=y[5857]&~(1<<b),N=F,A=B;break}else{y[m+12>>2]=A,y[A+8>>2]=m,N=F,A=B;break}M=y[F+24>>2]|0,m=y[F+12>>2]|0;do if((m|0)==(F|0)){if(A=F+16|0,b=A+4|0,m=y[b>>2]|0,m)A=b;else if(m=y[A>>2]|0,!m){m=0;break}for(;;)if(E=m+20|0,b=y[E>>2]|0,b)m=b,A=E;else if(E=m+16|0,b=y[E>>2]|0,b)m=b,A=E;else break;y[A>>2]=0}else N=y[F+8>>2]|0,y[N+12>>2]=m,y[m+8>>2]=N;while(!1);if(M){if(A=y[F+28>>2]|0,b=23732+(A<<2)|0,(y[b>>2]|0)==(F|0)){if(y[b>>2]=m,!m){y[5858]=y[5858]&~(1<<A),N=F,A=B;break}}else if(N=M+16|0,y[((y[N>>2]|0)==(F|0)?N:M+20|0)>>2]=m,!m){N=F,A=B;break}y[m+24>>2]=M,A=F+16|0,b=y[A>>2]|0,b|0&&(y[m+16>>2]=b,y[b+24>>2]=m),A=y[A+4>>2]|0,A?(y[m+20>>2]=A,y[A+24>>2]=m,N=F,A=B):(N=F,A=B)}else N=F,A=B}while(!1);if(!(F>>>0>=W>>>0)&&(m=W+4|0,E=y[m>>2]|0,!!(E&1))){if(E&2)y[m>>2]=E&-2,y[N+4>>2]=A|1,y[F+A>>2]=A,M=A;else{if((y[5863]|0)==(W|0)){if(W=(y[5860]|0)+A|0,y[5860]=W,y[5863]=N,y[N+4>>2]=W|1,(N|0)!=(y[5862]|0))return;y[5862]=0,y[5859]=0;return}if((y[5862]|0)==(W|0)){W=(y[5859]|0)+A|0,y[5859]=W,y[5862]=F,y[N+4>>2]=W|1,y[F+W>>2]=W;return}M=(E&-8)+A|0,b=E>>>3;do if(E>>>0<256)if(A=y[W+8>>2]|0,m=y[W+12>>2]|0,(m|0)==(A|0)){y[5857]=y[5857]&~(1<<b);break}else{y[A+12>>2]=m,y[m+8>>2]=A;break}else{B=y[W+24>>2]|0,m=y[W+12>>2]|0;do if((m|0)==(W|0)){if(A=W+16|0,b=A+4|0,m=y[b>>2]|0,m)A=b;else if(m=y[A>>2]|0,!m){b=0;break}for(;;)if(E=m+20|0,b=y[E>>2]|0,b)m=b,A=E;else if(E=m+16|0,b=y[E>>2]|0,b)m=b,A=E;else break;y[A>>2]=0,b=m}else b=y[W+8>>2]|0,y[b+12>>2]=m,y[m+8>>2]=b,b=m;while(!1);if(B|0){if(m=y[W+28>>2]|0,A=23732+(m<<2)|0,(y[A>>2]|0)==(W|0)){if(y[A>>2]=b,!b){y[5858]=y[5858]&~(1<<m);break}}else if(E=B+16|0,y[((y[E>>2]|0)==(W|0)?E:B+20|0)>>2]=b,!b)break;y[b+24>>2]=B,m=W+16|0,A=y[m>>2]|0,A|0&&(y[b+16>>2]=A,y[A+24>>2]=b),m=y[m+4>>2]|0,m|0&&(y[b+20>>2]=m,y[m+24>>2]=b)}}while(!1);if(y[N+4>>2]=M|1,y[F+M>>2]=M,(N|0)==(y[5862]|0)){y[5859]=M;return}}if(m=M>>>3,M>>>0<256){b=23468+(m<<1<<2)|0,A=y[5857]|0,m=1<<m,A&m?(A=b+8|0,m=y[A>>2]|0):(y[5857]=A|m,m=b,A=b+8|0),y[A>>2]=N,y[m+12>>2]=N,y[N+8>>2]=m,y[N+12>>2]=b;return}m=M>>>8,m?M>>>0>16777215?E=31:(F=(m+1048320|0)>>>16&8,W=m<<F,B=(W+520192|0)>>>16&4,W=W<<B,E=(W+245760|0)>>>16&2,E=14-(B|F|E)+(W<<E>>>15)|0,E=M>>>(E+7|0)&1|E<<1):E=0,m=23732+(E<<2)|0,y[N+28>>2]=E,y[N+20>>2]=0,y[N+16>>2]=0,A=y[5858]|0,b=1<<E;e:do if(!(A&b))y[5858]=A|b,y[m>>2]=N,y[N+24>>2]=m,y[N+12>>2]=N,y[N+8>>2]=N;else{m=y[m>>2]|0;t:do if((y[m+4>>2]&-8|0)!=(M|0)){for(E=M<<((E|0)==31?0:25-(E>>>1)|0);b=m+16+(E>>>31<<2)|0,A=y[b>>2]|0,!!A;)if((y[A+4>>2]&-8|0)==(M|0)){m=A;break t}else E=E<<1,m=A;y[b>>2]=N,y[N+24>>2]=m,y[N+12>>2]=N,y[N+8>>2]=N;break e}while(!1);F=m+8|0,W=y[F>>2]|0,y[W+12>>2]=N,y[F>>2]=N,y[N+8>>2]=W,y[N+12>>2]=m,y[N+24>>2]=0}while(!1);if(W=(y[5865]|0)+-1|0,y[5865]=W,!(W|0)){for(m=23884;m=y[m>>2]|0,m;)m=m+8|0;y[5865]=-1}}}}function Ze(m,A){m=m|0,A=A|0;var b=0;return m?(b=ba(A,m)|0,(A|m)>>>0>65535&&(b=((b>>>0)/(m>>>0)|0|0)==(A|0)?b:-1)):b=0,m=Ge(b)|0,!m||!(y[m+-4>>2]&3)||Ui(m|0,0,b|0)|0,m|0}function He(m,A,b,E){return m=m|0,A=A|0,b=b|0,E=E|0,b=m+b>>>0,Qr(A+E+(b>>>0<m>>>0|0)>>>0|0),b|0|0}function Xe(m,A,b,E){return m=m|0,A=A|0,b=b|0,E=E|0,E=A-E-(b>>>0>m>>>0|0)>>>0,Qr(E|0),m-b>>>0|0|0}function yt(m){return m=m|0,(m?31-(Jl(m^m-1)|0)|0:32)|0}function At(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,ee=0,fe=0,Te=0,qe=0,Je=0,je=0;if(fe=m,W=A,ee=W,F=b,qe=E,N=qe,!ee)return B=(M|0)!=0,N?B?(y[M>>2]=m|0,y[M+4>>2]=A&0,qe=0,M=0,Qr(qe|0),M|0):(qe=0,M=0,Qr(qe|0),M|0):(B&&(y[M>>2]=(fe>>>0)%(F>>>0),y[M+4>>2]=0),qe=0,M=(fe>>>0)/(F>>>0)>>>0,Qr(qe|0),M|0);B=(N|0)==0;do if(F){if(!B){if(B=(Jl(N|0)|0)-(Jl(ee|0)|0)|0,B>>>0<=31){Te=B+1|0,N=31-B|0,A=B-31>>31,F=Te,m=fe>>>(Te>>>0)&A|ee<<N,A=ee>>>(Te>>>0)&A,B=0,N=fe<<N;break}return M?(y[M>>2]=m|0,y[M+4>>2]=W|A&0,qe=0,M=0,Qr(qe|0),M|0):(qe=0,M=0,Qr(qe|0),M|0)}if(B=F-1|0,B&F|0){N=(Jl(F|0)|0)+33-(Jl(ee|0)|0)|0,je=64-N|0,Te=32-N|0,W=Te>>31,Je=N-32|0,A=Je>>31,F=N,m=Te-1>>31&ee>>>(Je>>>0)|(ee<<Te|fe>>>(N>>>0))&A,A=A&ee>>>(N>>>0),B=fe<<je&W,N=(ee<<je|fe>>>(Je>>>0))&W|fe<<Te&N-33>>31;break}return M|0&&(y[M>>2]=B&fe,y[M+4>>2]=0),(F|0)==1?(Je=W|A&0,je=m|0|0,Qr(Je|0),je|0):(je=yt(F|0)|0,Je=ee>>>(je>>>0)|0,je=ee<<32-je|fe>>>(je>>>0)|0,Qr(Je|0),je|0)}else{if(B)return M|0&&(y[M>>2]=(ee>>>0)%(F>>>0),y[M+4>>2]=0),Je=0,je=(ee>>>0)/(F>>>0)>>>0,Qr(Je|0),je|0;if(!fe)return M|0&&(y[M>>2]=0,y[M+4>>2]=(ee>>>0)%(N>>>0)),Je=0,je=(ee>>>0)/(N>>>0)>>>0,Qr(Je|0),je|0;if(B=N-1|0,!(B&N))return M|0&&(y[M>>2]=m|0,y[M+4>>2]=B&ee|A&0),Je=0,je=ee>>>((yt(N|0)|0)>>>0),Qr(Je|0),je|0;if(B=(Jl(N|0)|0)-(Jl(ee|0)|0)|0,B>>>0<=30){A=B+1|0,N=31-B|0,F=A,m=ee<<N|fe>>>(A>>>0),A=ee>>>(A>>>0),B=0,N=fe<<N;break}return M?(y[M>>2]=m|0,y[M+4>>2]=W|A&0,Je=0,je=0,Qr(Je|0),je|0):(Je=0,je=0,Qr(Je|0),je|0)}while(!1);if(!F)ee=N,W=0,N=0;else{Te=b|0|0,fe=qe|E&0,ee=He(Te|0,fe|0,-1,-1)|0,b=Re()|0,W=N,N=0;do E=W,W=B>>>31|W<<1,B=N|B<<1,E=m<<1|E>>>31|0,qe=m>>>31|A<<1|0,Xe(ee|0,b|0,E|0,qe|0)|0,je=Re()|0,Je=je>>31|((je|0)<0?-1:0)<<1,N=Je&1,m=Xe(E|0,qe|0,Je&Te|0,(((je|0)<0?-1:0)>>31|((je|0)<0?-1:0)<<1)&fe|0)|0,A=Re()|0,F=F-1|0;while(F|0);ee=W,W=0}return F=0,M|0&&(y[M>>2]=m,y[M+4>>2]=A),Je=(B|0)>>>31|(ee|F)<<1|(F<<1|B>>>31)&0|W,je=(B<<1|0)&-2|N,Qr(Je|0),je|0}function Pt(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0;return ee=A>>31|((A|0)<0?-1:0)<<1,W=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,B=E>>31|((E|0)<0?-1:0)<<1,M=((E|0)<0?-1:0)>>31|((E|0)<0?-1:0)<<1,N=Xe(ee^m|0,W^A|0,ee|0,W|0)|0,F=Re()|0,m=B^ee,A=M^W,Xe((At(N,F,Xe(B^b|0,M^E|0,B|0,M|0)|0,Re()|0,0)|0)^m|0,(Re()|0)^A|0,m|0,A|0)|0}function Ot(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return B=m&65535,M=A&65535,b=ba(M,B)|0,E=m>>>16,m=(b>>>16)+(ba(M,E)|0)|0,M=A>>>16,A=ba(M,B)|0,Qr((m>>>16)+(ba(M,E)|0)+(((m&65535)+A|0)>>>16)|0),m+A<<16|b&65535|0|0}function Tt(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0;return M=m,B=b,b=Ot(M,B)|0,m=Re()|0,Qr((ba(A,B)|0)+(ba(E,M)|0)+m|m&0|0),b|0|0|0}function er(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,ee=0;return M=we,we=we+16|0,N=M|0,F=A>>31|((A|0)<0?-1:0)<<1,B=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,ee=E>>31|((E|0)<0?-1:0)<<1,W=((E|0)<0?-1:0)>>31|((E|0)<0?-1:0)<<1,m=Xe(F^m|0,B^A|0,F|0,B|0)|0,A=Re()|0,At(m,A,Xe(ee^b|0,W^E|0,ee|0,W|0)|0,Re()|0,N)|0,E=Xe(y[N>>2]^F|0,y[N+4>>2]^B|0,F|0,B|0)|0,b=Re()|0,we=M,Qr(b|0),E|0}function Kt(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0;return B=we,we=we+16|0,M=B|0,At(m,A,b,E,M)|0,we=B,Qr(y[M+4>>2]|0),y[M>>2]|0|0}function Ut(m,A,b){return m=m|0,A=A|0,b=b|0,(b|0)<32?(Qr(A>>b|0),m>>>b|(A&(1<<b)-1)<<32-b):(Qr(((A|0)<0?-1:0)|0),A>>b-32|0)}function mt(m,A,b){return m=m|0,A=A|0,b=b|0,(b|0)<32?(Qr(A>>>b|0),m>>>b|(A&(1<<b)-1)<<32-b):(Qr(0),A>>>b-32|0)}function Nt(m,A,b){return m=m|0,A=A|0,b=b|0,(b|0)<32?(Qr(A<<b|(m&(1<<b)-1<<32-b)>>>32-b|0),m<<b):(Qr(m<<b-32|0),0)}function Bi(m,A){return m=+m,A=+A,m!=m?+A:A!=A?+m:+nm(+m,+A)}function $r(m,A){return m=+m,A=+A,m!=m?+A:A!=A?+m:+Ql(+m,+A)}function zi(m){return m=+m,m>=0?+ts(m+.5):+xa(m-.5)}function Zi(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if((b|0)>=8192)return xf(m|0,A|0,b|0)|0,m|0;if(B=m|0,M=m+b|0,(m&3)==(A&3)){for(;m&3;){if(!b)return B|0;Dr[m>>0]=Dr[A>>0]|0,m=m+1|0,A=A+1|0,b=b-1|0}for(b=M&-4|0,E=b-64|0;(m|0)<=(E|0);)y[m>>2]=y[A>>2],y[m+4>>2]=y[A+4>>2],y[m+8>>2]=y[A+8>>2],y[m+12>>2]=y[A+12>>2],y[m+16>>2]=y[A+16>>2],y[m+20>>2]=y[A+20>>2],y[m+24>>2]=y[A+24>>2],y[m+28>>2]=y[A+28>>2],y[m+32>>2]=y[A+32>>2],y[m+36>>2]=y[A+36>>2],y[m+40>>2]=y[A+40>>2],y[m+44>>2]=y[A+44>>2],y[m+48>>2]=y[A+48>>2],y[m+52>>2]=y[A+52>>2],y[m+56>>2]=y[A+56>>2],y[m+60>>2]=y[A+60>>2],m=m+64|0,A=A+64|0;for(;(m|0)<(b|0);)y[m>>2]=y[A>>2],m=m+4|0,A=A+4|0}else for(b=M-4|0;(m|0)<(b|0);)Dr[m>>0]=Dr[A>>0]|0,Dr[m+1>>0]=Dr[A+1>>0]|0,Dr[m+2>>0]=Dr[A+2>>0]|0,Dr[m+3>>0]=Dr[A+3>>0]|0,m=m+4|0,A=A+4|0;for(;(m|0)<(M|0);)Dr[m>>0]=Dr[A>>0]|0,m=m+1|0,A=A+1|0;return B|0}function Ui(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;if(B=m+b|0,A=A&255,(b|0)>=67){for(;m&3;)Dr[m>>0]=A,m=m+1|0;for(E=B&-4|0,F=A|A<<8|A<<16|A<<24,M=E-64|0;(m|0)<=(M|0);)y[m>>2]=F,y[m+4>>2]=F,y[m+8>>2]=F,y[m+12>>2]=F,y[m+16>>2]=F,y[m+20>>2]=F,y[m+24>>2]=F,y[m+28>>2]=F,y[m+32>>2]=F,y[m+36>>2]=F,y[m+40>>2]=F,y[m+44>>2]=F,y[m+48>>2]=F,y[m+52>>2]=F,y[m+56>>2]=F,y[m+60>>2]=F,m=m+64|0;for(;(m|0)<(E|0);)y[m>>2]=F,m=m+4|0}for(;(m|0)<(B|0);)Dr[m>>0]=A,m=m+1|0;return B-b|0}function Wi(m){return m=+m,m>=0?+ts(m+.5):+xa(m-.5)}function wi(m){m=m|0;var A=0,b=0,E=0;return E=sm()|0,b=y[ho>>2]|0,A=b+m|0,(m|0)>0&(A|0)<(b|0)|(A|0)<0?(Kd(A|0)|0,yf(12),-1):(A|0)>(E|0)&&!(va(A|0)|0)?(yf(12),-1):(y[ho>>2]=A,b|0)}return{___divdi3:Pt,___muldi3:Tt,___remdi3:er,___uremdi3:Kt,_areNeighborCells:ou,_bitshift64Ashr:Ut,_bitshift64Lshr:mt,_bitshift64Shl:Nt,_calloc:Ze,_cellAreaKm2:Wg,_cellAreaM2:Ca,_cellAreaRads2:fu,_cellToBoundary:ra,_cellToCenterChild:Uo,_cellToChildPos:pm,_cellToChildren:ks,_cellToChildrenSize:ja,_cellToLatLng:cu,_cellToLocalIj:Th,_cellToParent:Nf,_cellToVertex:S,_cellToVertexes:O,_cellsToDirectedEdge:Vg,_cellsToLinkedMultiPolygon:Jc,_childPosToCell:bh,_compactCells:Ea,_destroyLinkedMultiPolygon:Gf,_directedEdgeToBoundary:cc,_directedEdgeToCells:zo,_edgeLengthKm:br,_edgeLengthM:Lr,_edgeLengthRads:wh,_emscripten_replace_memory:Qd,_free:De,_getBaseCellNumber:hp,_getDirectedEdgeDestination:Un,_getDirectedEdgeOrigin:hm,_getHexagonAreaAvgKm2:Ha,_getHexagonAreaAvgM2:hn,_getHexagonEdgeLengthAvgKm:vh,_getHexagonEdgeLengthAvgM:Vf,_getIcosahedronFaces:Uf,_getNumCells:fc,_getPentagons:uu,_getRes0Cells:tu,_getResolution:fm,_greatCircleDistanceKm:hu,_greatCircleDistanceM:Ap,_greatCircleDistanceRads:pp,_gridDisk:am,_gridDiskDistances:lm,_gridDistance:Vn,_gridPathCells:Eh,_gridPathCellsSize:gm,_gridRingUnsafe:vf,_i64Add:He,_i64Subtract:Xe,_isPentagon:Hi,_isResClassIII:uc,_isValidCell:kf,_isValidDirectedEdge:lc,_isValidVertex:V,_latLngToCell:hr,_llvm_maxnum_f64:Bi,_llvm_minnum_f64:$r,_llvm_round_f64:zi,_localIjToCell:Ln,_malloc:Ge,_maxFaceCount:ml,_maxGridDiskSize:Ug,_maxPolygonToCellsSize:wf,_memcpy:Zi,_memset:Ui,_originToDirectedEdges:ap,_pentagonCount:li,_polygonToCells:ep,_readInt64AsDoubleFromPointer:vp,_res0CellCount:um,_round:Wi,_sbrk:wi,_sizeOfCellBoundary:pc,_sizeOfCoordIJ:bp,_sizeOfGeoLoop:xp,_sizeOfGeoPolygon:Wf,_sizeOfH3Index:yp,_sizeOfLatLng:pu,_sizeOfLinkedGeoPolygon:Ac,_uncompactCells:dm,_uncompactCellsSize:fo,_vertexToLatLng:z,establishStackSpace:Jd,stackAlloc:om,stackRestore:ec,stackSave:Ri}}(rr,nr,Be),Fr=e.___divdi3=$e.___divdi3,Sr=e.___muldi3=$e.___muldi3,kr=e.___remdi3=$e.___remdi3,_i=e.___uremdi3=$e.___uremdi3,Gt=e._areNeighborCells=$e._areNeighborCells,pr=e._bitshift64Ashr=$e._bitshift64Ashr,tr=e._bitshift64Lshr=$e._bitshift64Lshr,Vr=e._bitshift64Shl=$e._bitshift64Shl,xn=e._calloc=$e._calloc,ma=e._cellAreaKm2=$e._cellAreaKm2,Br=e._cellAreaM2=$e._cellAreaM2,Kn=e._cellAreaRads2=$e._cellAreaRads2,rn=e._cellToBoundary=$e._cellToBoundary,nh=e._cellToCenterChild=$e._cellToCenterChild,Wl=e._cellToChildPos=$e._cellToChildPos,Ct=e._cellToChildren=$e._cellToChildren,Kr=e._cellToChildrenSize=$e._cellToChildrenSize,ii=e._cellToLatLng=$e._cellToLatLng,Xs=e._cellToLocalIj=$e._cellToLocalIj,Qn=e._cellToParent=$e._cellToParent,Co=e._cellToVertex=$e._cellToVertex,us=e._cellToVertexes=$e._cellToVertexes,Ti=e._cellsToDirectedEdge=$e._cellsToDirectedEdge,$l=e._cellsToLinkedMultiPolygon=$e._cellsToLinkedMultiPolygon,ao=e._childPosToCell=$e._childPosToCell,sh=e._compactCells=$e._compactCells,lo=e._destroyLinkedMultiPolygon=$e._destroyLinkedMultiPolygon,lf=e._directedEdgeToBoundary=$e._directedEdgeToBoundary,qc=e._directedEdgeToCells=$e._directedEdgeToCells,Hd=e._edgeLengthKm=$e._edgeLengthKm,Fa=e._edgeLengthM=$e._edgeLengthM,ql=e._edgeLengthRads=$e._edgeLengthRads,Jn=e._emscripten_replace_memory=$e._emscripten_replace_memory,Zc=e._free=$e._free,QA=e._getBaseCellNumber=$e._getBaseCellNumber,Dg=e._getDirectedEdgeDestination=$e._getDirectedEdgeDestination,JA=e._getDirectedEdgeOrigin=$e._getDirectedEdgeOrigin,Wd=e._getHexagonAreaAvgKm2=$e._getHexagonAreaAvgKm2,cf=e._getHexagonAreaAvgM2=$e._getHexagonAreaAvgM2,ga=e._getHexagonEdgeLengthAvgKm=$e._getHexagonEdgeLengthAvgKm,hi=e._getHexagonEdgeLengthAvgM=$e._getHexagonEdgeLengthAvgM,Xc=e._getIcosahedronFaces=$e._getIcosahedronFaces,Zl=e._getNumCells=$e._getNumCells,cl=e._getPentagons=$e._getPentagons,oh=e._getRes0Cells=$e._getRes0Cells,Ei=e._getResolution=$e._getResolution,Jo=e._greatCircleDistanceKm=$e._greatCircleDistanceKm,uf=e._greatCircleDistanceM=$e._greatCircleDistanceM,ah=e._greatCircleDistanceRads=$e._greatCircleDistanceRads,co=e._gridDisk=$e._gridDisk,Ds=e._gridDiskDistances=$e._gridDiskDistances,bn=e._gridDistance=$e._gridDistance,$d=e._gridPathCells=$e._gridPathCells,uo=e._gridPathCellsSize=$e._gridPathCellsSize,So=e._gridRingUnsafe=$e._gridRingUnsafe,hs=e._i64Add=$e._i64Add,Fg=e._i64Subtract=$e._i64Subtract,Xl=e._isPentagon=$e._isPentagon,vn=e._isResClassIII=$e._isResClassIII,lh=e._isValidCell=$e._isValidCell,Yl=e._isValidDirectedEdge=$e._isValidDirectedEdge,hf=e._isValidVertex=$e._isValidVertex,Io=e._latLngToCell=$e._latLngToCell,mn=e._llvm_maxnum_f64=$e._llvm_maxnum_f64,ka=e._llvm_minnum_f64=$e._llvm_minnum_f64,Fi=e._llvm_round_f64=$e._llvm_round_f64,ti=e._localIjToCell=$e._localIjToCell,ch=e._malloc=$e._malloc,vi=e._maxFaceCount=$e._maxFaceCount,uh=e._maxGridDiskSize=$e._maxGridDiskSize,_a=e._maxPolygonToCellsSize=$e._maxPolygonToCellsSize,ff=e._memcpy=$e._memcpy,df=e._memset=$e._memset,qd=e._originToDirectedEdges=$e._originToDirectedEdges,pf=e._pentagonCount=$e._pentagonCount,Af=e._polygonToCells=$e._polygonToCells,Zd=e._readInt64AsDoubleFromPointer=$e._readInt64AsDoubleFromPointer,hh=e._res0CellCount=$e._res0CellCount,kg=e._round=$e._round,Yc=e._sbrk=$e._sbrk,Fs=e._sizeOfCellBoundary=$e._sizeOfCellBoundary,Xd=e._sizeOfCoordIJ=$e._sizeOfCoordIJ,Ng=e._sizeOfGeoLoop=$e._sizeOfGeoLoop,Ys=e._sizeOfGeoPolygon=$e._sizeOfGeoPolygon,es=e._sizeOfH3Index=$e._sizeOfH3Index,ya=e._sizeOfLatLng=$e._sizeOfLatLng,fh=e._sizeOfLinkedGeoPolygon=$e._sizeOfLinkedGeoPolygon,em=e._uncompactCells=$e._uncompactCells,zg=e._uncompactCellsSize=$e._uncompactCellsSize,ul=e._vertexToLatLng=$e._vertexToLatLng,tm=e.establishStackSpace=$e.establishStackSpace,rm=e.stackAlloc=$e.stackAlloc,mf=e.stackRestore=$e.stackRestore,gf=e.stackSave=$e.stackSave;if(e.asm=$e,e.cwrap=ae,e.setValue=j,e.getValue=q,kt){ai(kt)||(kt=a(kt));{Gr("memory initializer");var Mo=function(gt){gt.byteLength&&(gt=new Uint8Array(gt)),ke.set(gt,k),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,Jt("memory initializer")},Yd=function(){c(kt,Mo,function(){throw"could not load memory initializer "+kt})},hl=zt(kt);if(hl)Mo(hl.buffer);else if(e.memoryInitializerRequest){var _f=function(){var gt=e.memoryInitializerRequest,$t=gt.response;if(gt.status!==200&&gt.status!==0){var or=zt(e.memoryInitializerRequestURL);if(or)$t=or.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+gt.status+", retrying "+kt),Yd();return}}Mo($t)};e.memoryInitializerRequest.response?setTimeout(_f,0):e.memoryInitializerRequest.addEventListener("load",_f)}else Yd()}}var Na;ys=function gt(){Na||dh(),Na||(ys=gt)};function dh(gt){if(gt=gt||n,_s>0||(Di(),_s>0))return;function $t(){Na||(Na=!0,!X&&(ui(),tn(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Ni()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),$t()},1)):$t()}e.run=dh;function za(gt){throw e.onAbort&&e.onAbort(gt),gt+="",h(gt),p(gt),X=!0,"abort("+gt+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=za,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return dh(),t}(typeof Ji=="object"?Ji:{}),pi="number",Yr=pi,Ox=pi,Jr=pi,ei=pi,Zo=pi,Ir=pi,Nhe=[["sizeOfH3Index",pi],["sizeOfLatLng",pi],["sizeOfCellBoundary",pi],["sizeOfGeoLoop",pi],["sizeOfGeoPolygon",pi],["sizeOfLinkedGeoPolygon",pi],["sizeOfCoordIJ",pi],["readInt64AsDoubleFromPointer",pi],["isValidCell",Ox,[Jr,ei]],["latLngToCell",Yr,[pi,pi,Zo,Ir]],["cellToLatLng",Yr,[Jr,ei,Ir]],["cellToBoundary",Yr,[Jr,ei,Ir]],["maxGridDiskSize",Yr,[pi,Ir]],["gridDisk",Yr,[Jr,ei,pi,Ir]],["gridDiskDistances",Yr,[Jr,ei,pi,Ir,Ir]],["gridRingUnsafe",Yr,[Jr,ei,pi,Ir]],["maxPolygonToCellsSize",Yr,[Ir,Zo,pi,Ir]],["polygonToCells",Yr,[Ir,Zo,pi,Ir]],["cellsToLinkedMultiPolygon",Yr,[Ir,pi,Ir]],["destroyLinkedMultiPolygon",null,[Ir]],["compactCells",Yr,[Ir,Ir,pi,pi]],["uncompactCells",Yr,[Ir,pi,pi,Ir,pi,Zo]],["uncompactCellsSize",Yr,[Ir,pi,pi,Zo,Ir]],["isPentagon",Ox,[Jr,ei]],["isResClassIII",Ox,[Jr,ei]],["getBaseCellNumber",pi,[Jr,ei]],["getResolution",pi,[Jr,ei]],["maxFaceCount",Yr,[Jr,ei,Ir]],["getIcosahedronFaces",Yr,[Jr,ei,Ir]],["cellToParent",Yr,[Jr,ei,Zo,Ir]],["cellToChildren",Yr,[Jr,ei,Zo,Ir]],["cellToCenterChild",Yr,[Jr,ei,Zo,Ir]],["cellToChildrenSize",Yr,[Jr,ei,Zo,Ir]],["cellToChildPos",Yr,[Jr,ei,Zo,Ir]],["childPosToCell",Yr,[pi,pi,Jr,ei,Zo,Ir]],["areNeighborCells",Yr,[Jr,ei,Jr,ei,Ir]],["cellsToDirectedEdge",Yr,[Jr,ei,Jr,ei,Ir]],["getDirectedEdgeOrigin",Yr,[Jr,ei,Ir]],["getDirectedEdgeDestination",Yr,[Jr,ei,Ir]],["isValidDirectedEdge",Ox,[Jr,ei]],["directedEdgeToCells",Yr,[Jr,ei,Ir]],["originToDirectedEdges",Yr,[Jr,ei,Ir]],["directedEdgeToBoundary",Yr,[Jr,ei,Ir]],["gridDistance",Yr,[Jr,ei,Jr,ei,Ir]],["gridPathCells",Yr,[Jr,ei,Jr,ei,Ir]],["gridPathCellsSize",Yr,[Jr,ei,Jr,ei,Ir]],["cellToLocalIj",Yr,[Jr,ei,Jr,ei,pi,Ir]],["localIjToCell",Yr,[Jr,ei,Ir,pi,Ir]],["getHexagonAreaAvgM2",Yr,[Zo,Ir]],["getHexagonAreaAvgKm2",Yr,[Zo,Ir]],["getHexagonEdgeLengthAvgM",Yr,[Zo,Ir]],["getHexagonEdgeLengthAvgKm",Yr,[Zo,Ir]],["greatCircleDistanceM",pi,[Ir,Ir]],["greatCircleDistanceKm",pi,[Ir,Ir]],["greatCircleDistanceRads",pi,[Ir,Ir]],["cellAreaM2",Yr,[Jr,ei,Ir]],["cellAreaKm2",Yr,[Jr,ei,Ir]],["cellAreaRads2",Yr,[Jr,ei,Ir]],["edgeLengthM",Yr,[Jr,ei,Ir]],["edgeLengthKm",Yr,[Jr,ei,Ir]],["edgeLengthRads",Yr,[Jr,ei,Ir]],["getNumCells",Yr,[Zo,Ir]],["getRes0Cells",Yr,[Ir]],["res0CellCount",pi],["getPentagons",Yr,[pi,Ir]],["pentagonCount",pi],["cellToVertex",Yr,[Jr,ei,pi,Ir]],["cellToVertexes",Yr,[Jr,ei,Ir]],["vertexToLatLng",Yr,[Jr,ei,Ir]],["isValidVertex",Ox,[Jr,ei]]],zhe=0,Uhe=1,Vhe=2,jhe=3,IV=4,Ghe=5,Hhe=6,Whe=7,$he=8,qhe=9,Zhe=10,Xhe=11,Yhe=12,Khe=13,Qhe=14,Jhe=15,ko={};ko[zhe]="Success";ko[Uhe]="The operation failed but a more specific error is not available";ko[Vhe]="Argument was outside of acceptable range";ko[jhe]="Latitude or longitude arguments were outside of acceptable range";ko[IV]="Resolution argument was outside of acceptable range";ko[Ghe]="Cell argument was not valid";ko[Hhe]="Directed edge argument was not valid";ko[Whe]="Undirected edge argument was not valid";ko[$he]="Vertex argument was not valid";ko[qhe]="Pentagon distortion was encountered";ko[Zhe]="Duplicate input";ko[Xhe]="Cell arguments were not neighbors";ko[Yhe]="Cell arguments had incompatible resolutions";ko[Khe]="Memory allocation failed";ko[Qhe]="Bounds of provided memory were insufficient";ko[Jhe]="Mode or flags argument was not valid";var MV=1e3,efe=1001,PV=1002,N3={};N3[MV]="Unknown unit";N3[efe]="Array length out of bounds";N3[PV]="Got unexpected null value for H3 index";var tfe="Unknown error";function RV(t,e,r){var i=r&&"value"in r,n=new Error((t[e]||tfe)+" (code: "+e+(i?", value: "+r.value:"")+")");return n.code=e,n}function BV(t,e){var r=arguments.length===2?{value:e}:{};return RV(ko,t,r)}function LV(t,e){var r=arguments.length===2?{value:e}:{};return RV(N3,t,r)}function EA(t){if(t!==0)throw BV(t)}var $s={};Nhe.forEach(function(e){$s[e[0]]=Ji.cwrap.apply(Ji,e)});var Q0=16;var OV=4,EV=4,kd=8,rfe=8,F3=$s.sizeOfH3Index(),DV=$s.sizeOfLatLng(),ife=$s.sizeOfCellBoundary(),RWe=$s.sizeOfGeoPolygon(),BWe=$s.sizeOfGeoLoop(),nfe=$s.sizeOfLinkedGeoPolygon(),LWe=$s.sizeOfCoordIJ(),CV={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function sfe(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw BV(IV,t);return t}function ofe(t){if(!t)throw LV(PV);return t}var OWe=Math.pow(2,32)-1;var afe=/[^0-9a-fA-F]/;function CA(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||afe.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),Q0),r=parseInt(t.substring(t.length-8),Q0);return[r,e]}function SV(t){if(t>=0)return t.toString(Q0);t=t&2147483647;var e=FV(8,t.toString(Q0)),r=(parseInt(e[0],Q0)+8).toString(Q0);return e=r+e.substring(1),e}function lfe(t,e){return SV(e)+FV(8,SV(t))}function FV(t,e){for(var r=t-e.length,i="",n=0;n<r;n++)i+="0";return i=i+e,i}var DWe=Math.pow(2,32);function cfe(t,e){e===void 0&&(e=0);var r=Ji.getValue(t+F3*e,"i32"),i=Ji.getValue(t+F3*e+OV,"i32");return i?lfe(r,i):null}function ufe(t,e){return e===void 0&&(e=0),Ji.getValue(t+kd*e,"double")}function hfe(t){return $s.readInt64AsDoubleFromPointer(t)}function ffe(t,e,r){Ji.HEAPU32.set(CA(t),e/OV+2*r)}function dfe(t,e){for(var r=e.length,i=0;i<r;i++)ffe(e[i],t,i)}function k3(t){return gfe(Ji.getValue(t,"double"))}function cP(t){return[k3(t),k3(t+kd)]}function kV(t){return[k3(t+kd),k3(t)]}function pfe(t,e,r){for(var i=Ji.getValue(t,"i32"),n=t+kd,s=[],a=e?kV:cP,c=0;c<i*2;c+=2)s.push(a(n+kd*c));return r&&s.push(s[0]),s}function Afe(t,e){for(var r=[],i=e?kV:cP,n,s,a,c;t;){for(r.push(n=[]),s=Ji.getValue(t,"i8*");s;){for(n.push(a=[]),c=Ji.getValue(s,"i8*");c;)a.push(i(c)),c=Ji.getValue(c+kd*2,"i8*");e&&a.push(a[0]),s=Ji.getValue(s+EV*2,"i8*")}t=Ji.getValue(t+EV*2,"i8*")}return r}function NV(t){var e=CA(t),r=e[0],i=e[1];return!!$s.isPentagon(r,i)}function zV(t){var e=CA(t),r=e[0],i=e[1];return $s.isValidCell(r,i)?$s.getResolution(r,i):-1}function UV(t,e,r){var i=Ji._malloc(DV);Ji.HEAPF64.set([t,e].map(mfe),i/kd);var n=Ji._malloc(F3);try{return EA($s.latLngToCell(i,r,n)),ofe(cfe(n))}finally{Ji._free(n),Ji._free(i)}}function Dx(t){var e=Ji._malloc(DV),r=CA(t),i=r[0],n=r[1];try{return EA($s.cellToLatLng(i,n,e)),cP(e)}finally{Ji._free(e)}}function VV(t,e){var r=Ji._malloc(ife),i=CA(t),n=i[0],s=i[1];try{return EA($s.cellToBoundary(n,s,r)),pfe(r,e,e)}finally{Ji._free(r)}}function jV(t,e){if(!t||!t.length)return[];var r=t.length,i=Ji._calloc(r,F3);dfe(i,t);var n=Ji._calloc(nfe);try{return EA($s.cellsToLinkedMultiPolygon(i,r,n)),Afe(n,e)}finally{$s.destroyLinkedMultiPolygon(n),Ji._free(n),Ji._free(i)}}function GV(t,e){var r=CA(t),i=r[0],n=r[1],s=CA(e),a=s[0],c=s[1],h=Ji._malloc(rfe);try{return EA($s.gridDistance(i,n,a,c,h)),hfe(h)}finally{Ji._free(h)}}function HV(t,e){sfe(t);var r=Ji._malloc(kd);try{switch(e){case CV.m:EA($s.getHexagonEdgeLengthAvgM(t,r));break;case CV.km:EA($s.getHexagonEdgeLengthAvgKm(t,r));break;default:throw LV(MV,e)}return ufe(r)}finally{Ji._free(r)}}function mfe(t){return t*Math.PI/180}function gfe(t){return t*180/Math.PI}function z3(t,e){e=e===void 0?t[0][0]:e;for(let r of t){let i=r[0]-e;i>180?r[0]-=360:i<-180&&(r[0]+=360)}}function _fe(t,e,r){let[i,n]=Dx(t),s=e.length;z3(e,n);let a=e[0]===e[s-1]?s-1:s;for(let c=0;c<a;c++)e[c][0]=Do(n,e[c][0],r),e[c][1]=Do(i,e[c][1],r)}function WV(t,e,r){let i=t(e,r),[n,s]=Dx(i);return[s,n]}function uP(t,e=1){let r=VV(t,!0);return e!==1?_fe(t,r,e):z3(r),r}function $V(t){let e=new Float64Array(t.length*2),r=0;for(let i of t)e[r++]=i[0],e[r++]=i[1];return e}var yfe=10;function xfe(t,e){let r;return t==null?r=e:typeof t=="object"?r={...t,coverage:e}:r={getHexagon:t,coverage:e},r}var bfe={...Rd.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0},J0=class t extends ss{initializeState(){t._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:r}){if(e.highPrecision!==!0&&(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagon)){let i=this._calculateH3DataProps();this.setState(i)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,r=!1,i=!1,{iterable:n,objectInfo:s}=Ps(this.props.data);for(let a of n){s.index++;let c=this.props.getHexagon(a,s),h=zV(c);if(e<0){if(e=h,!this.props.highPrecision)break}else if(e!==h){i=!0;break}if(NV(c)){r=!0;break}}return{resolution:e,edgeLengthKM:e>=0?HV(e,"km"):0,hasMultipleRes:i,hasPentagon:r}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){let{resolution:e,hasPentagon:r,hasMultipleRes:i}=this.state,{viewport:n}=this.context;return!!n?.resolution||i||r||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;let{resolution:r,edgeLengthKM:i,centerHex:n}=this.state;if(r<0)return;let s=this.props.centerHexagon||UV(e.latitude,e.longitude,r);if(n===s)return;if(n)try{if(GV(n,s)*i<yfe)return}catch{}let{unitsPerMeter:a}=e.distanceScales,c=uP(s),[h,p]=Dx(s),[x,T]=e.projectFlat([p,h]);c=c.map(R=>{let k=e.projectFlat(R);return[(k[0]-x)/a[0],(k[1]-T)/a[1]]}),this.setState({centerHex:s,vertices:c})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){let{elevationScale:e,material:r,coverage:i,extruded:n,wireframe:s,stroked:a,filled:c,lineWidthUnits:h,lineWidthScale:p,lineWidthMinPixels:x,lineWidthMaxPixels:T,getFillColor:R,getElevation:k,getLineColor:j,getLineWidth:q,transitions:X,updateTriggers:re}=this.props;return{elevationScale:e,extruded:n,coverage:i,wireframe:s,stroked:a,filled:c,lineWidthUnits:h,lineWidthScale:p,lineWidthMinPixels:x,lineWidthMaxPixels:T,material:r,getElevation:k,getFillColor:R,getLineColor:j,getLineWidth:q,transitions:X,updateTriggers:{getFillColor:re.getFillColor,getElevation:re.getElevation,getLineColor:re.getLineColor,getLineWidth:re.getLineWidth}}}_renderPolygonLayer(){let{data:e,getHexagon:r,updateTriggers:i,coverage:n}=this.props,s=this.getSubLayerClass("hexagon-cell-hifi",Rd),a=this._getForwardProps();return a.updateTriggers.getPolygon=xfe(i.getHexagon,n),new s(a,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:a.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(c,h)=>{let p=r(c,h);return $V(uP(p,n))}})}_renderColumnLayer(){let{data:e,getHexagon:r,updateTriggers:i}=this.props,n=this.getSubLayerClass("hexagon-cell",Wu),s=this._getForwardProps();return s.updateTriggers.getPosition=i.getHexagon,new n(s,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:s.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:WV.bind(null,r)})}};J0.defaultProps=bfe;J0.layerName="H3HexagonLayer";J0._checkH3Lib=()=>{};var U3=J0;var vfe={getHexagons:{type:"accessor",value:t=>t.hexagons}},Fx=class extends Zu{initializeState(){U3._checkH3Lib()}updateState({props:e,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagons){let{data:i,getHexagons:n}=e,s=[],{iterable:a,objectInfo:c}=Ps(i);for(let h of a){c.index++;let p=n(h,c),x=jV(p,!0);for(let T of x){for(let R of T)z3(R);s.push(this.getSubLayerRow({polygon:T},h,c.index))}}this.setState({polygons:s})}}indexToBounds(){let{getElevation:e,getFillColor:r,getLineColor:i,getLineWidth:n}=this.props;return{data:this.state.polygons,getPolygon:s=>s.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(r),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(n)}}};Fx.layerName="H3ClusterLayer";Fx.defaultProps=vfe;var qV=Fx;var hP=Math.PI/180,V3=new Float32Array(16),ZV=new Float32Array(12);function XV(t,e,r){let i=e[0]*hP,n=e[1]*hP,s=e[2]*hP,a=Math.sin(s),c=Math.sin(i),h=Math.sin(n),p=Math.cos(s),x=Math.cos(i),T=Math.cos(n),R=r[0],k=r[1],j=r[2];t[0]=R*T*x,t[1]=R*h*x,t[2]=R*-c,t[3]=k*(-h*p+T*c*a),t[4]=k*(T*p+h*c*a),t[5]=k*x*a,t[6]=j*(h*a+T*c*p),t[7]=j*(-T*a+h*c*p),t[8]=j*x*p}function YV(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}var j3={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:r}){let{data:i,getOrientation:n,getScale:s,getTranslation:a,getTransformMatrix:c}=this.props,h=Array.isArray(c),p=h&&c.length===16,x=Array.isArray(s),T=Array.isArray(n),R=Array.isArray(a),k=p||!h&&!!c(i[0]);k?t.constant=p:t.constant=T&&x&&R;let j=t.value;if(t.constant){let q;k?(V3.set(c),q=YV(V3)):(q=ZV,XV(q,n,s),q.set(a,9)),t.value=new Float32Array(q)}else{let q=e*t.size,{iterable:X,objectInfo:re}=Ps(i,e,r);for(let te of X){re.index++;let oe;if(k)V3.set(p?c:c(te,re)),oe=YV(V3);else{oe=ZV;let ae=T?n:n(te,re),pe=x?s:s(te,re);XV(oe,ae,pe),oe.set(R?a:a(te,re),9)}j[q++]=oe[0],j[q++]=oe[1],j[q++]=oe[2],j[q++]=oe[3],j[q++]=oe[4],j[q++]=oe[5],j[q++]=oe[6],j[q++]=oe[7],j[q++]=oe[8],j[q++]=oe[9],j[q++]=oe[10],j[q++]=oe[11]}}}};function G3(t,e){return e===Tr.CARTESIAN||e===Tr.METER_OFFSETS||e===Tr.DEFAULT&&!t.isGeospatial}var KV=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,QV={name:"simpleMesh",vs:KV,fs:KV,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}};var JV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var ej=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function fP(t){let e=t.positions||t.POSITION;ur.assert(e,'no "postions" or "POSITION" attribute in mesh');let r=e.value.length/e.size,i=t.COLOR_0||t.colors;i||(i={size:3,value:new Float32Array(r*3).fill(1)});let n=t.NORMAL||t.normals;n||(n={size:3,value:new Float32Array(r*3).fill(0)});let s=t.TEXCOORD_0||t.texCoords;return s||(s={size:2,value:new Float32Array(r*2).fill(0)}),{positions:e,colors:i,normals:n,texCoords:s}}function tj(t){return t instanceof Qi?(t.attributes=fP(t.attributes),t):t.attributes?new Qi({...t,topology:"triangle-list",attributes:fP(t.attributes)}):new Qi({topology:"triangle-list",attributes:fP(t)})}var wfe=[0,0,0,255],Tfe={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:wfe},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}},kx=class extends ln{getShaders(){return super.getShaders({vs:JV,fs:ej,modules:[Li,i0,Sn,QV]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;let{mesh:r}=this.props;if(!r)return null;if(e=r.header?.boundingBox,!e){let{attributes:i}=tj(r);i.POSITION=i.POSITION||i.positions,e=Fh(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:j3}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e;if(r.mesh!==i.mesh||n.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);let s=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==i.texture&&r.texture instanceof sn&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){let{model:r}=this.state;if(!r)return;let{viewport:i,renderPass:n}=this.context,{sizeScale:s,coordinateSystem:a,_instanced:c}=this.props,h={sizeScale:s,composeModelMatrix:!c||G3(i,a),flatShading:!this.state.hasNormals};r.shaderInputs.setProps({simpleMesh:h}),r.draw(n)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){let r=new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:tj(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state,s={sampler:i||n,hasTexture:!!i};return r.shaderInputs.setProps({simpleMesh:s}),r}setTexture(e){let{emptyTexture:r,model:i}=this.state;if(i){let n={sampler:e||r,hasTexture:!!e};i.shaderInputs.setProps({simpleMesh:n})}}};kx.defaultProps=Tfe;kx.layerName="SimpleMeshLayer";var eg=kx;var Nc;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Nc||(Nc={}));function zx(t,e,r,i){let n={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};n.defines.USE_TEX_LOD=1;let{imageBasedLightingEnvironment:s}=i;return s&&(n.bindings.pbr_diffuseEnvSampler=s.diffuseEnvSampler.texture,n.bindings.pbr_specularEnvSampler=s.specularEnvSampler.texture,n.bindings.pbr_BrdfLUT=s.brdfLutTexture.texture,n.uniforms.scaleIBLAmbient=[1,1]),i?.pbrDebug&&(n.defines.PBR_DEBUG=1,n.uniforms.scaleDiffBaseMR=[0,0,0,0],n.uniforms.scaleFGDSpec=[0,0,0,0]),r.NORMAL&&(n.defines.HAS_NORMALS=1),r.TANGENT&&i?.useTangents&&(n.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(n.defines.HAS_UV=1),i?.imageBasedLightingEnvironment&&(n.defines.USE_IBL=1),i?.lights&&(n.defines.USE_LIGHTS=1),e&&Efe(t,e,n),n}function Efe(t,e,r){if(r.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&Cfe(t,e.pbrMetallicRoughness,r),e.normalTexture){Nx(t,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",r);let{scale:i=1}=e.normalTexture;r.uniforms.normalScale=i}if(e.occlusionTexture){Nx(t,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",r);let{strength:i=1}=e.occlusionTexture;r.uniforms.occlusionStrength=i}switch(e.emissiveTexture&&(Nx(t,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":let{alphaCutoff:i=.5}=e;r.defines.ALPHA_CUTOFF=1,r.uniforms.alphaCutoff=i;break;case"BLEND":jt.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=Nc.FUNC_ADD,r.glParameters.blendFunc=[Nc.SRC_ALPHA,Nc.ONE_MINUS_SRC_ALPHA,Nc.ONE,Nc.ONE_MINUS_SRC_ALPHA];break}}function Cfe(t,e,r){e.baseColorTexture&&Nx(t,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&Nx(t,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);let{metallicFactor:i=1,roughnessFactor:n=1}=e;r.uniforms.metallicRoughnessValues=[i,n]}function Nx(t,e,r,i=null,n){let s=e?.texture?.sampler?.parameters||{},a=e.texture.source.image,c,h={};a.compressed?(c=a,h={[Nc.TEXTURE_MIN_FILTER]:a.data.length>1?Nc.LINEAR_MIPMAP_NEAREST:Nc.LINEAR}):c={data:a};let p=t.createTexture({id:e.uniformName||e.id,parameters:{...s,...h},pixelStore:{[Nc.UNPACK_FLIP_Y_WEBGL]:!1},...c});n.bindings[r]=p,i&&(n.defines[i]=1),n.generatedTextures.push(p)}var rj="4.3.2";var H3={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"},ij;async function pP(t){BC(t.modules);let e=LC("basis");return e||(ij||=Sfe(t),await ij)}async function Sfe(t){let e=null,r=null;return[e,r]=await Promise.all([await Tu(H3.TRANSCODER,"textures",t),await Tu(H3.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await Ife(e,r)}function Ife(t,e){let r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{let{BasisFile:s,initializeBasis:a}=n;a(),i({BasisFile:s})})})}var dP;async function AP(t){let e=t.modules||{};return e.basisEncoder?e.basisEncoder:(dP=dP||Mfe(t),await dP)}async function Mfe(t){let e=null,r=null;return[e,r]=await Promise.all([await Tu(H3.ENCODER,"textures",t),await Tu(H3.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await Pfe(e,r)}function Pfe(t,e){let r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{let{BasisFile:s,KTX2File:a,initializeBasis:c,BasisEncoder:h}=n;c(),i({BasisFile:s,KTX2File:a,BasisEncoder:h})})})}var SA={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919};var Rfe=["","WEBKIT_","MOZ_"],nj={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},W3=null;function sj(t){if(!W3){t=t||Bfe()||void 0,W3=new Set;for(let e of Rfe)for(let r in nj)if(t&&t.getExtension(`${e}${r}`)){let i=nj[r];W3.add(i)}}return W3}function Bfe(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var ll=[171,75,84,88,32,50,48,187,13,10,26,10];function oj(t){let e=new Uint8Array(t);return!(e.byteLength<ll.length||e[0]!==ll[0]||e[1]!==ll[1]||e[2]!==ll[2]||e[3]!==ll[3]||e[4]!==ll[4]||e[5]!==ll[5]||e[6]!==ll[6]||e[7]!==ll[7]||e[8]!==ll[8]||e[9]!==ll[9]||e[10]!==ll[10]||e[11]!==ll[11])}var Lfe={etc1:{basisFormat:0,compressed:!0,format:SA.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:SA.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:SA.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:SA.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:SA.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:SA.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function lj(t,e){if(e.basis.containerFormat==="auto"){if(oj(t)){let i=await AP(e);return aj(i.KTX2File,t,e)}let{BasisFile:r}=await pP(e);return mP(r,t,e)}switch(e.basis.module){case"encoder":let r=await AP(e);switch(e.basis.containerFormat){case"ktx2":return aj(r.KTX2File,t,e);case"basis":default:return mP(r.BasisFile,t,e)}case"transcoder":default:let{BasisFile:i}=await pP(e);return mP(i,t,e)}}function mP(t,e,r){let i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");let n=i.getNumImages(),s=[];for(let a=0;a<n;a++){let c=i.getNumLevels(a),h=[];for(let p=0;p<c;p++)h.push(Ofe(i,a,p,r));s.push(h)}return s}finally{i.close(),i.delete()}}function Ofe(t,e,r,i){let n=t.getImageWidth(e,r),s=t.getImageHeight(e,r),a=t.getHasAlpha(),{compressed:c,format:h,basisFormat:p}=cj(i,a),x=t.getImageTranscodedSizeInBytes(e,r,p),T=new Uint8Array(x);if(!t.transcodeImage(T,e,r,p,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:s,data:T,compressed:c,format:h,hasAlpha:a}}function aj(t,e,r){let i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");let n=i.getLevels(),s=[];for(let a=0;a<n;a++)s.push(Dfe(i,a,r));return[s]}finally{i.close(),i.delete()}}function Dfe(t,e,r){let{alphaFlag:i,height:n,width:s}=t.getImageLevelInfo(e,0,0),{compressed:a,format:c,basisFormat:h}=cj(r,i),p=t.getImageTranscodedSizeInBytes(e,0,0,h),x=new Uint8Array(p);if(!t.transcodeImage(x,e,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:n,data:x,compressed:a,levelSize:p,hasAlpha:i,format:c}}function cj(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=$3()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),Lfe[r]}function $3(){let t=sj();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}var uj={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:rj,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},gP={...uj,parse:lj};var Ffe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},kfe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},yP=class{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;let i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:n,target:s,path:a})=>{Gfe(i,n,s,a),zfe(s,s._node)})}},q3=class{animations;constructor(e){this.animations=e.animations.map((r,i)=>{let n=r.name||`Animation-${i}`,s=r.samplers.map(({input:c,interpolation:h="LINEAR",output:p})=>({input:hj(e.accessors[c]),interpolation:h,output:hj(e.accessors[p])})),a=r.channels.map(({sampler:c,target:h})=>({sampler:s[c],target:e.nodes[h.node],path:h.path}));return new yP({name:n,channels:a})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(r=>r.animate(e))}getAnimations(){return this.animations}};function hj(t){if(!t._animation){let e=kfe[t.componentType],r=Ffe[t.type],i=r*t.count,{buffer:n,byteOffset:s}=t.bufferView.data,a=new e(n,s+(t.byteOffset||0),i);if(r===1)t._animation=Array.from(a);else{let c=[];for(let h=0;h<a.length;h+=r)c.push(Array.from(a.slice(h,h+r)));t._animation=c}}return t._animation}var Nfe=new Er;function zfe(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){let r=Nfe.fromQuaternion(t.rotation);e.matrix.multiplyRight(r)}t.scale&&e.matrix.scale(t.scale)}var _P=new Rl;function Ufe(t,e,r,i,n){if(e==="rotation"){_P.slerp({start:r,target:i,ratio:n});for(let s=0;s<_P.length;s++)t[e][s]=_P[s]}else for(let s=0;s<r.length;s++)t[e][s]=n*i[s]+(1-n)*r[s]}function Vfe(t,e,{p0:r,outTangent0:i,inTangent1:n,p1:s,tDiff:a,ratio:c}){for(let h=0;h<t[e].length;h++){let p=i[h]*a,x=n[h]*a;t[e][h]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*r[h]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*p+(-2*Math.pow(c,3)+3*Math.pow(c,2))*s[h]+(Math.pow(c,3)-Math.pow(c,2))*x}}function jfe(t,e,r){for(let i=0;i<r.length;i++)t[e][i]=r[i]}function Gfe(t,{input:e,interpolation:r,output:i},n,s){let a=e[e.length-1],c=t%a,h=e.findIndex(R=>R>=c),p=Math.max(0,h-1);if(!Array.isArray(n[s]))switch(s){case"translation":n[s]=[0,0,0];break;case"rotation":n[s]=[0,0,0,1];break;case"scale":n[s]=[1,1,1];break;default:jt.warn(`Bad animation path ${s}`)()}let x=e[p],T=e[h];switch(r){case"STEP":jfe(n,s,i[p]);break;case"LINEAR":if(T>x){let R=(c-x)/(T-x);Ufe(n,s,i[p],i[h],R)}break;case"CUBICSPLINE":if(T>x){let R=(c-x)/(T-x),k=T-x,j=i[3*p+1],q=i[3*p+2],X=i[3*h+0],re=i[3*h+1];Vfe(n,s,{p0:j,outTangent0:q,inTangent1:X,p1:re,tDiff:k,ratio:R})}break;default:jt.warn(`Interpolation ${r} not supported`)();break}}var Hfe=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,Wfe=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,$fe=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function fj(t,e){let{id:r,geometry:i,material:n,vertexCount:s,materialOptions:a,modelOptions:c}=e,h=zx(t,n,i.attributes,a);jt.info(4,"createGLTFModel defines: ",h.defines)();let p=[],x={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},T={id:r,source:Hfe,vs:Wfe,fs:$fe,geometry:i,topology:i.topology,vertexCount:s,modules:[Qp],...c,defines:{...h.defines,...c.defines},parameters:{...x,...h.parameters,...c.parameters}},R=new di(t,T),{camera:k,...j}={...h.uniforms,...c.uniforms,...h.bindings,...c.bindings};return R.shaderInputs.setProps({pbrMaterial:j,pbrProjection:{camera:k}}),new yd({managedResources:p,model:R})}var IA;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(IA||(IA={}));function dj(t){switch(t){case IA.POINTS:return"point-list";case IA.LINES:return"line-list";case IA.LINE_STRIP:return"line-strip";case IA.TRIANGLES:return"triangle-list";case IA.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(t))}}var qfe={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},Z3=class{device;options;gltf;constructor(e,r={}){this.device=e,this.options={...qfe,...r}}instantiate(e){return this.gltf=xP(e),(this.gltf.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new q3(this.gltf):null}createScene(e){let i=(e.nodes||[]).map(s=>this.createNode(s));return new Wh({id:e.name||e.id,children:i})}createNode(e){if(!e._node){let n=(e.children||[]).map(a=>this.createNode(a));e.mesh&&n.push(this.createMesh(e.mesh));let s=new Wh({id:e.name||e.id,children:n});if(e.matrix)s.setMatrix(e.matrix);else{if(s.matrix.identity(),e.translation&&s.matrix.translate(e.translation),e.rotation){let a=new Er().fromQuaternion(e.rotation);s.matrix.multiplyRight(a)}e.scale&&s.matrix.scale(e.scale)}e._node=s}let r=this.gltf.nodes.find(i=>i.id===e.id);return r._node=e._node,e._node}createMesh(e){if(!e._mesh){let i=(e.primitives||[]).map((s,a)=>this.createPrimitive(s,a,e)),n=new Wh({id:e.name||e.id,children:i});e._mesh=n}return e._mesh}createPrimitive(e,r,i){let n=e.name||`${i.name||i.id}-primitive-${r}`,s=dj(e.mode||4),a=e.indices?e.indices.count:this.getVertexCount(e.attributes),c=fj(this.device,{id:n,geometry:this.createGeometry(n,e,s),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:a});return c.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],c}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,r,i){let n={};for(let[s,a]of Object.entries(r.attributes)){let{components:c,size:h,value:p}=a;n[s]={size:h??c,value:p}}return new Qi({id:e,topology:i,indices:r.indices.value,attributes:n})}createBuffer(e,r){e.bufferView||(e.bufferView={});let{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[r]||(i.lumaBuffers[r]=this.device.createBuffer({id:`from-${i.id}`,data:i.data||e.value})),i.lumaBuffers[r]}createSampler(e){return e}needsPOT(){return!1}};function xP(t){if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof ImageBitmap)return t;if(Array.isArray(t))return t.map(xP);if(t&&typeof t=="object"){let e={};for(let r in t)e[r]=xP(t[r]);return e}return t}function bP(t,e,r){let i=new Z3(t,r),n=i.instantiate(e),s=i.createAnimator();return{scenes:n,animator:s}}var vP={};Es(vP,{createExtMeshFeatures:()=>ude,decode:()=>sde,encode:()=>ode,name:()=>nde});function no(t,e){if(!t)throw new Error(e||"assert failed: gltf")}var X3={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Y3={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};var Zfe=1.33,pj=["SCALAR","VEC2","VEC3","VEC4"],Xfe=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Yfe=new Map(Xfe),Kfe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Qfe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Jfe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function K3(t){return pj[t-1]||pj[0]}function Nd(t){let e=Yfe.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function tg(t,e){let r=Jfe[t.componentType],i=Kfe[t.type],n=Qfe[t.componentType],s=t.count*i,a=t.count*i*n;no(a>=0&&a<=e.byteLength);let c=Y3[t.componentType],h=X3[t.type];return{ArrayType:r,length:s,byteLength:a,componentByteSize:c,numberOfComponentsInElement:h}}function Ux(t){let{images:e,bufferViews:r}=t;e=e||[],r=r||[];let i=e.map(a=>a.bufferView);r=r.filter(a=>!i.includes(a));let n=r.reduce((a,c)=>a+c.byteLength,0),s=e.reduce((a,c)=>{let{width:h,height:p}=c.image;return a+h*p},0);return n+Math.ceil(4*s*Zfe)}function Aj(t,e,r){let i=t.bufferViews[r];no(i);let n=i.buffer,s=e[n];no(s);let a=(i.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,i.byteLength)}function mj(t,e,r){let i=typeof r=="number"?t.accessors?.[r]:r;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);let n=t.bufferViews?.[i.bufferView||0];if(!n)throw new Error(`No gltf buffer view for accessor ${n}`);let{arrayBuffer:s,byteOffset:a}=e[n.buffer],c=(a||0)+(i.byteOffset||0)+(n.byteOffset||0),{ArrayType:h,length:p,componentByteSize:x,numberOfComponentsInElement:T}=tg(i,n),R=x*T,k=n.byteStride||R;if(typeof n.byteStride>"u"||n.byteStride===R)return new h(s,c,p);let j=new h(p);for(let q=0;q<i.count;q++){let X=new h(s,c+q*k,T);j.set(X,q*T)}return j}function ede(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}var en=class{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||ede(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){let r=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof r=="string"||typeof i=="string"}getExtension(e){let r=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return r?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;let i=this.json[e]&&this.json[e][r];if(!i)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);let r=e.buffer,i=this.gltf.buffers[r];no(i);let n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){let r=this.getAccessor(e);return mj(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);let r=this.getBufferView(e.bufferView),n=this.getBuffer(r.buffer).data,s=r.byteOffset||0;return new Uint8Array(n,s,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,i){return e.extensions=e.extensions||{},e.extensions[r]=i,this.registerUsedExtension(r),this}setObjectExtension(e,r,i){let n=e.extensions||{};n[r]=i}removeObjectExtension(e,r){let i=e?.extensions||{};if(i[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let n=this.json.extensionsRemoved;n.includes(r)||n.push(r)}delete i[r]}addExtension(e,r={}){return no(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return no(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){let{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){let{meshIndex:r,matrix:i}=e;this.json.nodes=this.json.nodes||[];let n={mesh:r};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){let{attributes:r,indices:i,material:n,mode:s=4}=e,c={primitives:[{attributes:this._addAttributes(r),mode:s}]};if(i){let h=this._addIndices(i);c.primitives[0].indices=h}return Number.isFinite(n)&&(c.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){let i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,r){let i=kp(e),n=r||i?.mimeType,a={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e,r=0,i=this.byteLength){let n=e.byteLength;no(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);let s={buffer:r,byteOffset:i,byteLength:n};return this.byteLength+=sd(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,r){let i={bufferView:e,type:K3(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){let i=this.addBufferView(e),n={min:r.min,max:r.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,r.size));let s={size:r.size,componentType:Nd(e),count:Math.round(e.length/r.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(s,r))}addTexture(e){let{imageIndex:r}=e,i={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){let e=this.byteLength,r=new ArrayBuffer(e),i=new Uint8Array(r),n=0;for(let s of this.sourceBuffers||[])n=WC(s,i,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r],this.gltf.buffers=[{arrayBuffer:r,byteOffset:0,byteLength:r.byteLength}]}_removeStringFromArray(e,r){let i=!0;for(;i;){let n=e.indexOf(r);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){let r={};for(let i in e){let n=e[i],s=this._getGltfAttributeName(i),a=this.addBinaryBuffer(n.value,n);r[s]=a}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){let i={min:null,max:null};if(e.length<r)return i;i.min=[],i.max=[];let n=e.subarray(0,r);for(let s of n)i.min.push(s),i.max.push(s);for(let s=r;s<e.length;s+=r)for(let a=0;a<r;a++)i.min[0+a]=Math.min(i.min[0+a],e[s+a]),i.max[0+a]=Math.max(i.max[0+a],e[s+a]);return i}};function gj(t){return(t%1+1)%1}var _j={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},tde={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},yj={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Vx(t,e){return yj[e]*_j[t]}function rg(t,e,r,i){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;let n=t.getTypedArrayForBufferView(e),s=ig(n,"SCALAR",r,i+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function ig(t,e,r,i=1){let n=_j[e],s=tde[r],a=yj[r],c=i*n,h=c*a,p=t.buffer,x=t.byteOffset;return x%a!==0&&(p=new Uint8Array(p).slice(x,x+h).buffer,x=0),new s(p,x,c)}function ng(t,e,r){let i=`TEXCOORD_${e.texCoord||0}`,n=r.attributes[i],s=t.getTypedArrayForAccessor(n),a=t.gltf.json,c=e.index,h=a.textures?.[c]?.source;if(typeof h<"u"){let p=a.images?.[h]?.mimeType,x=t.gltf.images?.[h];if(x&&typeof x.width<"u"){let T=[];for(let R=0;R<s.length;R+=2){let k=rde(x,p,s,R,e.channels);T.push(k)}return T}}return[]}function Q3(t,e,r,i,n){if(!r?.length)return;let s=[];for(let x of r){let T=i.findIndex(R=>R===x);T===-1&&(T=i.push(x)-1),s.push(T)}let a=new Uint32Array(s),c=t.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength})-1,h=t.addBufferView(a,c,0),p=t.addAccessor(h,{size:1,componentType:Nd(a),count:a.length});n.attributes[e]=p}function rde(t,e,r,i,n=[0]){let s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},a=r[i],c=r[i+1],h=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(h=4);let p=ide(a,c,t,h),x=0;for(let T of n){let R=typeof T=="number"?Object.values(s)[T]:s[T],k=p+R.offset,j=j_(t);if(j.data.length<=k)throw new Error(`${j.data.length} <= ${k}`);let q=j.data[k];x|=q<<R.shift}return x}function ide(t,e,r,i=1){let n=r.width,s=gj(t)*(n-1),a=Math.round(s),c=r.height,h=gj(e)*(c-1),p=Math.round(h),x=r.components?r.components:i;return(p*n+a)*x}function J3(t,e,r,i,n){let s=[];for(let a=0;a<e;a++){let c=r[a],h=r[a+1]-r[a];if(h+c>i)break;let p=c/n,x=h/n;s.push(t.slice(p,p+x))}return s}function eT(t,e,r){let i=[];for(let n=0;n<e;n++){let s=n*r;i.push(t.slice(s,s+r))}return i}function tT(t,e,r,i){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){let n=[],s=new TextDecoder("utf8"),a=0;for(let c=0;c<t;c++){let h=i[c+1]-i[c];if(h+a<=e.length){let p=e.subarray(a,h+a),x=s.decode(p);n.push(x),a+=h}}return n}return[]}var sg="EXT_mesh_features",nde=sg;async function sde(t,e){let r=new en(t);ade(r,e)}function ode(t,e){let r=new en(t);return cde(r,e),r.createBinaryChunk(),r.gltf}function ade(t,e){let r=t.gltf.json;if(r.meshes)for(let i of r.meshes)for(let n of i.primitives)lde(t,n,e)}function lde(t,e,r){if(!r?.gltf?.loadBuffers)return;let n=e.extensions?.[sg]?.featureIds;if(n)for(let s of n){let a;if(typeof s.attribute<"u"){let c=`_FEATURE_ID_${s.attribute}`,h=e.attributes[c];a=t.getTypedArrayForAccessor(h)}else typeof s.texture<"u"&&r?.gltf?.loadImages?a=ng(t,s.texture,e):a=[];s.data=a}}function cde(t,e){let r=t.gltf.json.meshes;if(r)for(let i of r)for(let n of i.primitives)hde(t,n)}function ude(t,e,r,i){e.extensions||(e.extensions={});let n=e.extensions[sg];n||(n={featureIds:[]},e.extensions[sg]=n);let{featureIds:s}=n,a={featureCount:r.length,propertyTable:i,data:r};s.push(a),t.addObjectExtension(e,sg,n)}function hde(t,e){let r=e.extensions?.[sg];if(!r)return;let i=r.featureIds;i.forEach((n,s)=>{if(n.data){let{accessorKey:a,index:c}=fde(e.attributes),h=new Uint32Array(n.data);i[s]={featureCount:h.length,propertyTable:n.propertyTable,attribute:c},t.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});let p=t.addBufferView(h),x=t.addAccessor(p,{size:1,componentType:Nd(h),count:h.length});e.attributes[a]=x}})}function fde(t){let e="_FEATURE_ID_",r=Object.keys(t).filter(s=>s.indexOf(e)===0),i=-1;for(let s of r){let a=Number(s.substring(e.length));a>i&&(i=a)}return i++,{accessorKey:`${e}${i}`,index:i}}var EP={};Es(EP,{createExtStructuralMetadata:()=>Ode,decode:()=>pde,encode:()=>Ade,name:()=>dde});var og="EXT_structural_metadata",dde=og;async function pde(t,e){let r=new en(t);mde(r,e)}function Ade(t,e){let r=new en(t);return Bde(r,e),r.createBinaryChunk(),r.gltf}function mde(t,e){if(!e.gltf?.loadBuffers)return;let r=t.getExtension(og);r&&(e.gltf?.loadImages&&gde(t,r),_de(t,r))}function gde(t,e){let r=e.propertyTextures,i=t.gltf.json;if(r&&i.meshes)for(let n of i.meshes)for(let s of n.primitives)xde(t,r,s,e)}function _de(t,e){let r=e.schema;if(!r)return;let i=r.classes,n=e.propertyTables;if(i&&n)for(let s in i){let a=yde(n,s);a&&vde(t,r,a)}}function yde(t,e){for(let r of t)if(r.class===e)return r;return null}function xde(t,e,r,i){if(!e)return;let s=r.extensions?.[og]?.propertyTextures;if(s)for(let a of s){let c=e[a];bde(t,c,r,i)}}function bde(t,e,r,i){if(!e.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);let n=e.class;for(let s in e.properties){let a=`${n}_${s}`,c=e.properties?.[s];if(!c)continue;c.data||(c.data=[]);let h=c.data,p=ng(t,c,r);p!==null&&(Q3(t,a,p,h,r),c.data=h,i.dataAttributeNames.push(a))}}function vde(t,e,r){let i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let n=r.count;for(let s in i.properties){let a=i.properties[s],c=r.properties?.[s];if(c){let h=wde(t,e,a,n,c);c.data=h}}}function wde(t,e,r,i,n){let s=[],a=n.values,c=t.getTypedArrayForBufferView(a),h=Tde(t,r,n,i),p=Ede(t,n,i);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=Cde(r,i,c,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{s=tT(i,c,h,p);break}case"ENUM":{s=Sde(e,r,i,c,h);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return s}function Tde(t,e,r,i){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?rg(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",i):null}function Ede(t,e,r){return typeof e.stringOffsets<"u"?rg(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function Cde(t,e,r,i){let n=t.array,s=t.count,a=Vx(t.type,t.componentType),c=r.byteLength/a,h;return t.componentType?h=ig(r,t.type,t.componentType,c):h=r,n?i?J3(h,e,i,r.length,a):s?eT(h,e,s):[]:h}function Sde(t,e,r,i,n){let s=e.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");let a=t.enums?.[s];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);let c=a.valueType||"UINT16",h=Vx(e.type,c),p=i.byteLength/h,x=ig(i,e.type,c,p);if(x||(x=i),e.array){if(n)return Ide({valuesData:x,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i.length,elementSize:h,enumEntry:a});let T=e.count;return T?Mde(x,r,T,a):[]}return TP(x,0,r,a)}function Ide(t){let{valuesData:e,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n,elementSize:s,enumEntry:a}=t,c=[];for(let h=0;h<r;h++){let p=i[h],x=i[h+1]-i[h];if(x+p>n)break;let T=p/s,R=x/s,k=TP(e,T,R,a);c.push(k)}return c}function Mde(t,e,r,i){let n=[];for(let s=0;s<e;s++){let a=r*s,c=TP(t,a,r,i);n.push(c)}return n}function TP(t,e,r,i){let n=[];for(let s=0;s<r;s++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)n.push("");else{let a=t[e+s],c=Pde(i,a);c?n.push(c.name):n.push("")}return n}function Pde(t,e){for(let r of t.values)if(r.value===e)return r;return null}var Rde="schemaClassId";function Bde(t,e){let r=t.getExtension(og);if(r&&r.propertyTables)for(let i of r.propertyTables){let n=i.class,s=r.schema?.classes?.[n];i.properties&&s&&Lde(i,s,t)}}function Lde(t,e,r){for(let i in t.properties){let n=t.properties[i].data;if(n){let s=e.properties[i];if(s){let a=kde(n,s,r);t.properties[i]=a}}}}function Ode(t,e,r=Rde){let i=t.getExtension(og);i||(i=t.addExtension(og)),i.schema=Dde(e,r,i.schema);let n=Fde(e,r,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(n)-1}function Dde(t,e,r){let i=r??{id:"schema_id"},n={properties:{}};for(let s of t){let a={type:s.elementType,componentType:s.componentType};n.properties[s.name]=a}return i.classes={},i.classes[e]=n,i}function Fde(t,e,r){let i={class:e,count:0},n=0,s=r.classes?.[e];for(let a of t){if(n===0&&(n=a.values.length),n!==a.values.length&&a.values.length)throw new Error("Illegal values in attributes");s?.properties[a.name]&&(i.properties||(i.properties={}),i.properties[a.name]={values:0,data:a.values})}return i.count=n,i}function kde(t,e,r){let i={values:0};if(e.type==="STRING"){let{stringData:n,stringOffsets:s}=Ude(t);i.stringOffsets=wP(s,r),i.values=wP(n,r)}else if(e.type==="SCALAR"&&e.componentType){let n=zde(t,e.componentType);i.values=wP(n,r)}return i}var Nde={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function zde(t,e){let r=[];for(let n of t)r.push(Number(n));let i=Nde[e];if(!i)throw new Error("Illegal component type");return new i(r)}function Ude(t){let e=new TextEncoder,r=[],i=0;for(let h of t){let p=e.encode(h);i+=p.length,r.push(p)}let n=new Uint8Array(i),s=[],a=0;for(let h of r)n.set(h,a),s.push(a),a+=h.length;s.push(a);let c=new Uint32Array(s);return{stringData:n,stringOffsets:c}}function wP(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}var CP={};Es(CP,{decode:()=>jde,name:()=>Vde});var xj="EXT_feature_metadata",Vde=xj;async function jde(t,e){let r=new en(t);Gde(r,e)}function Gde(t,e){if(!e.gltf?.loadBuffers)return;let r=t.getExtension(xj);r&&(e.gltf?.loadImages&&Hde(t,r),Wde(t,r))}function Hde(t,e){let r=e.schema;if(!r)return;let i=r.classes,{featureTextures:n}=e;if(i&&n)for(let s in i){let a=i[s],c=qde(n,s);c&&Xde(t,c,a)}}function Wde(t,e){let r=e.schema;if(!r)return;let i=r.classes,n=e.featureTables;if(i&&n)for(let s in i){let a=$de(n,s);a&&Zde(t,r,a)}}function $de(t,e){for(let r in t){let i=t[r];if(i.class===e)return i}return null}function qde(t,e){for(let r in t){let i=t[r];if(i.class===e)return i}return null}function Zde(t,e,r){if(!r.class)return;let i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let n=r.count;for(let s in i.properties){let a=i.properties[s],c=r.properties?.[s];if(c){let h=Yde(t,e,a,n,c);c.data=h}}}function Xde(t,e,r){let i=e.class;for(let n in r.properties){let s=e?.properties?.[n];if(s){let a=tpe(t,s,i);s.data=a}}}function Yde(t,e,r,i,n){let s=[],a=n.bufferView,c=t.getTypedArrayForBufferView(a),h=Kde(t,r,n,i),p=Qde(t,r,n,i);return r.type==="STRING"||r.componentType==="STRING"?s=tT(i,c,h,p):Jde(r)&&(s=epe(r,i,c,h)),s}function Kde(t,e,r,i){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?rg(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",i):null}function Qde(t,e,r,i){return typeof r.stringOffsetBufferView<"u"?rg(t,r.stringOffsetBufferView,r.offsetType||"UINT32",i):null}function Jde(t){let e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function epe(t,e,r,i){let n=t.type==="ARRAY",s=t.componentCount,a="SCALAR",c=t.componentType||t.type,h=Vx(a,c),p=r.byteLength/h,x=ig(r,a,c,p);return n?i?J3(x,e,i,r.length,h):s?eT(x,e,s):[]:x}function tpe(t,e,r){let i=t.gltf.json;if(!i.meshes)return[];let n=[];for(let s of i.meshes)for(let a of s.primitives)rpe(t,r,e,n,a);return n}function rpe(t,e,r,i,n){let s={channels:r.channels,...r.texture},a=ng(t,s,n);a&&Q3(t,e,a,i,n)}var bj="4.3.2";var ag=!0,vj=1735152710,MP=12,rT=8,ipe=1313821514,npe=5130562,spe=0,ope=0,ape=1;function lpe(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function wj(t,e=0,r={}){let i=new DataView(t),{magic:n=vj}=r,s=i.getUint32(e,!1);return s===n||s===vj}function Tj(t,e,r=0,i={}){let n=new DataView(e),s=lpe(n,r+0),a=n.getUint32(r+4,ag),c=n.getUint32(r+8,ag);switch(Object.assign(t,{header:{byteOffset:r,byteLength:c,hasBinChunk:!1},type:s,version:a,json:{},binChunks:[]}),r+=MP,t.version){case 1:return cpe(t,n,r);case 2:return upe(t,n,r,i={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function cpe(t,e,r){Ii(t.header.byteLength>MP+rT);let i=e.getUint32(r+0,ag),n=e.getUint32(r+4,ag);return r+=rT,Ii(n===spe),SP(t,e,r,i),r+=i,r+=IP(t,e,r,t.header.byteLength),r}function upe(t,e,r,i){return Ii(t.header.byteLength>MP+rT),hpe(t,e,r,i),r+t.header.byteLength}function hpe(t,e,r,i){for(;r+8<=t.header.byteLength;){let n=e.getUint32(r+0,ag),s=e.getUint32(r+4,ag);switch(r+=rT,s){case ipe:SP(t,e,r,n);break;case npe:IP(t,e,r,n);break;case ope:i.strict||SP(t,e,r,n);break;case ape:i.strict||IP(t,e,r,n);break;default:break}r+=sd(n,4)}return r}function SP(t,e,r,i){let n=new Uint8Array(e.buffer,r,i),a=new TextDecoder("utf8").decode(n);return t.json=JSON.parse(a),sd(i,4)}function IP(t,e,r,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:i,arrayBuffer:e.buffer}),sd(i,4)}function PP(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;let i=e.baseUri||e.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return i.substr(0,i.lastIndexOf("/")+1)+t}var BP={};Es(BP,{decode:()=>wpe,name:()=>vpe});var fpe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",dpe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",ppe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Ape=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),mpe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},gpe={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Ej(t,e,r,i,n,s="NONE"){let a=await _pe();bpe(a,a.exports[gpe[n]],t,e,r,i,a.exports[mpe[s||"NONE"]])}var RP;async function _pe(){return RP||(RP=ype()),RP}async function ype(){let t=fpe;WebAssembly.validate(ppe)&&(t=dpe,console.log("Warning: meshopt_decoder is using experimental SIMD support"));let e=await WebAssembly.instantiate(xpe(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function xpe(t){let e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){let n=t.charCodeAt(i);e[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let r=0;for(let i=0;i<t.length;++i)e[r++]=e[i]<60?Ape[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,r)}function bpe(t,e,r,i,n,s,a){let c=t.exports.sbrk,h=i+3&-4,p=c(h*n),x=c(s.length),T=new Uint8Array(t.exports.memory.buffer);T.set(s,x);let R=e(p,i,n,x,s.length);if(R===0&&a&&a(p,h,n),r.set(T.subarray(p,p+i*n)),c(p-c(0)),R!==0)throw new Error(`Malformed buffer data: ${R}`)}var iT="EXT_meshopt_compression",vpe=iT;async function wpe(t,e){let r=new en(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;let i=[];for(let n of t.json.bufferViews||[])i.push(Tpe(r,n));await Promise.all(i),r.removeExtension(iT)}async function Tpe(t,e){let r=t.getObjectExtension(e,iT);if(r){let{byteOffset:i=0,byteLength:n=0,byteStride:s,count:a,mode:c,filter:h="NONE",buffer:p}=r,x=t.gltf.buffers[p],T=new Uint8Array(x.arrayBuffer,x.byteOffset+i,n),R=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Ej(R,a,s,T,c,h),t.removeObjectExtension(e,iT)}}var LP={};Es(LP,{name:()=>Epe,preprocess:()=>Cpe});var lg="EXT_texture_webp",Epe=lg;function Cpe(t,e){let r=new en(t);if(!dS("image/webp")){if(r.getRequiredExtensions().includes(lg))throw new Error(`gltf: Required extension ${lg} not supported by browser`);return}let{json:i}=r;for(let n of i.textures||[]){let s=r.getObjectExtension(n,lg);s&&(n.source=s.source),r.removeObjectExtension(n,lg)}r.removeExtension(lg)}var OP={};Es(OP,{name:()=>Spe,preprocess:()=>Ipe});var nT="KHR_texture_basisu",Spe=nT;function Ipe(t,e){let r=new en(t),{json:i}=r;for(let n of i.textures||[]){let s=r.getObjectExtension(n,nT);s&&(n.source=s.source,r.removeObjectExtension(n,nT))}r.removeExtension(nT)}var zP={};Es(zP,{decode:()=>Hpe,encode:()=>Wpe,name:()=>jpe,preprocess:()=>Gpe});var Cj="4.3.2";var Sj={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Cj,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Mj(t,e,r){let i=Pj(e.metadata),n=[],s=Mpe(e.attributes);for(let a in t){let c=t[a],h=Ij(a,c,s[a]);n.push(h)}if(r){let a=Ij("indices",r);n.push(a)}return{fields:n,metadata:i}}function Mpe(t){let e={};for(let r in t){let i=t[r];e[i.name||"undefined"]=i}return e}function Ij(t,e,r){let i=r?Pj(r.metadata):void 0;return aS(t,e,i)}function Pj(t){Object.entries(t);let e={};for(let r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}var Rj={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ppe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Rpe=4,jx=class{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,r={}){let i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(r);let n=this.decoder.GetEncodedGeometryType(i),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(n){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(i,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(i,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){let R=`DRACO decompression failed: ${a.error_msg()}`;throw new Error(R)}let c=this._getDracoLoaderData(s,n,r),h=this._getMeshData(s,c,r),p=Fh(h.attributes),x=Mj(h.attributes,c,h.indices);return{loader:"draco",loaderData:c,header:{vertexCount:s.num_points(),boundingBox:p},...h,schema:x}}finally{this.draco.destroy(i),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,r,i){let n=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,i);return{geometry_type:r,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(e,r){let i={};for(let n=0;n<e.num_attributes();n++){let s=this.decoder.GetAttribute(e,n),a=this._getAttributeMetadata(e,n);i[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:a};let c=this._getQuantizationTransform(s,r);c&&(i[s.unique_id()].quantization_transform=c);let h=this._getOctahedronTransform(s,r);h&&(i[s.unique_id()].octahedron_transform=h)}return i}_getMeshData(e,r,i){let n=this._getMeshAttributes(r,e,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,r,i){let n={};for(let s of Object.values(e.attributes)){let a=this._deduceAttributeName(s,i);s.name=a;let c=this._getAttributeValues(r,s);if(c){let{value:h,size:p}=c;n[a]={value:h,size:p,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return n}_getTriangleListIndices(e){let i=e.num_faces()*3,n=i*Rpe,s=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,s),new Uint32Array(this.draco.HEAPF32.buffer,s,i).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){let r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,r),Ope(r)}finally{this.draco.destroy(r)}}_getAttributeValues(e,r){let i=Ppe[r.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;let n=r.num_components,a=e.num_points()*n,c=a*i.BYTES_PER_ELEMENT,h=Bpe(this.draco,i),p,x=this.draco._malloc(c);try{let T=this.decoder.GetAttribute(e,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,T,h,c,x),p=new i(this.draco.HEAPF32.buffer,x,a).slice()}finally{this.draco._free(x)}return{value:p,size:n}}_deduceAttributeName(e,r){let i=e.unique_id;for(let[a,c]of Object.entries(r.extraAttributes||{}))if(c===i)return a;let n=e.attribute_type;for(let a in Rj)if(this.draco[a]===n)return Rj[a];let s=r.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){let r=this.decoder.GetMetadata(e);return this._getDracoMetadata(r)}_getAttributeMetadata(e,r){let i=this.decoder.GetAttributeMetadata(e,r);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};let r={},i=this.metadataQuerier.NumEntries(e);for(let n=0;n<i;n++){let s=this.metadataQuerier.GetEntryName(e,n);r[s]=this._getDracoMetadataField(e,s)}return r}_getDracoMetadataField(e,r){let i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,r,i);let n=Lpe(i);return{int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){let{quantizedAttributes:r=[],octahedronAttributes:i=[]}=e,n=[...r,...i];for(let s of n)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,r){let{quantizedAttributes:i=[]}=r,n=e.attribute_type();if(i.map(a=>this.decoder[a]).includes(n)){let a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(c=>a.min_value(c))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,r){let{octahedronAttributes:i=[]}=r,n=e.attribute_type();if(i.map(a=>this.decoder[a]).includes(n)){let a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}};function Bpe(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function Lpe(t){let e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}function Ope(t){let e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}var Dpe="1.5.6",Fpe="1.4.1",DP=`https://www.gstatic.com/draco/versioned/decoders/${Dpe}`,La={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},FP={[La.DECODER]:`${DP}/${La.DECODER}`,[La.DECODER_WASM]:`${DP}/${La.DECODER_WASM}`,[La.FALLBACK_DECODER]:`${DP}/${La.FALLBACK_DECODER}`,[La.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Fpe}/javascript/${La.ENCODER}`},kP;async function Bj(t){let e=t.modules||{};return e.draco3d?kP||=e.draco3d.createDecoderModule({}).then(r=>({draco:r})):kP||=kpe(t),await kP}async function kpe(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await Tu(FP[La.FALLBACK_DECODER],"draco",t,La.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await Tu(FP[La.DECODER],"draco",t,La.DECODER),await Tu(FP[La.DECODER_WASM],"draco",t,La.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await Npe(e,r)}function Npe(t,e){let r={};return e&&(r.wasmBinary=e),new Promise(i=>{t({...r,onModuleLoaded:n=>i({draco:n})})})}var sT={...Sj,parse:zpe};async function zpe(t,e){let{draco:r}=await Bj(e),i=new jx(r);try{return i.parseSync(t,e?.draco)}finally{i.destroy()}}function Lj(t){let e={};for(let r in t){let i=t[r];if(r!=="indices"){let n=NP(i);e[r]=n}}return e}function NP(t){let{buffer:e,size:r,count:i}=Upe(t);return{value:e,size:r,byteOffset:0,count:i,type:K3(r),componentType:Nd(e)}}function Upe(t){let e=t,r=1,i=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=Vpe(e,Float32Array)),i=e.length/r),{buffer:e,size:r,count:i}}function Vpe(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}var zd="KHR_draco_mesh_compression",jpe=zd;function Gpe(t,e,r){let i=new en(t);for(let n of Oj(i))i.getObjectExtension(n,zd)}async function Hpe(t,e,r){if(!e?.gltf?.decompressMeshes)return;let i=new en(t),n=[];for(let s of Oj(i))i.getObjectExtension(s,zd)&&n.push($pe(i,s,e,r));await Promise.all(n),i.removeExtension(zd)}function Wpe(t,e={}){let r=new en(t);for(let i of r.json.meshes||[])qpe(i,e),r.addRequiredExtension(zd)}async function $pe(t,e,r,i){let n=t.getObjectExtension(e,zd);if(!n)return;let s=t.getTypedArrayForBufferView(n.bufferView),a=Lp(s.buffer,s.byteOffset),c={...r};delete c["3d-tiles"];let h=await el(a,sT,c,i),p=Lj(h.attributes);for(let[x,T]of Object.entries(p))if(x in e.attributes){let R=e.attributes[x],k=t.getAccessor(R);k?.min&&k?.max&&(T.min=k.min,T.max=k.max)}e.attributes=p,h.indices&&(e.indices=NP(h.indices)),t.removeObjectExtension(e,zd),Zpe(e)}function qpe(t,e,r=4,i,n){if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");let s=i.DracoWriter.encodeSync({attributes:t}),a=n?.parseSync?.({attributes:t}),c=i._addFauxAttributes(a.attributes),h=i.addBufferView(s);return{primitives:[{attributes:c,mode:r,extensions:{[zd]:{bufferView:h,attributes:c}}}]}}function Zpe(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Oj(t){for(let e of t.json.meshes||[])for(let r of e.primitives)yield r}var UP={};Es(UP,{decode:()=>Qpe,name:()=>Xpe});var aT="KHR_texture_transform",Xpe=aT,oT=new st,Ype=new an,Kpe=new an;async function Qpe(t,e){if(!new en(t).hasExtension(aT)||!e.gltf?.loadBuffers)return;let n=t.json.materials||[];for(let s=0;s<n.length;s++)Jpe(s,t)}function Jpe(t,e){let r=e.json.materials?.[t],i=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],n=[];for(let s of i)s&&s?.extensions?.[aT]&&eAe(e,t,s,n)}function eAe(t,e,r,i){let n=tAe(r,i);if(!n)return;let s=t.json.meshes||[];for(let a of s)for(let c of a.primitives){let h=c.material;Number.isFinite(h)&&e===h&&rAe(t,c,n)}}function tAe(t,e){let r=t.extensions?.[aT],{texCoord:i=0}=t,{texCoord:n=i}=r;if(!(e.findIndex(([a,c])=>a===i&&c===n)!==-1)){let a=sAe(r);return i!==n&&(t.texCoord=n),e.push([i,n]),{originalTexCoord:i,texCoord:n,matrix:a}}return null}function rAe(t,e,r){let{originalTexCoord:i,texCoord:n,matrix:s}=r,a=e.attributes[`TEXCOORD_${i}`];if(Number.isFinite(a)){let c=t.json.accessors?.[a];if(c&&c.bufferView){let h=t.json.bufferViews?.[c.bufferView];if(h){let{arrayBuffer:p,byteOffset:x}=t.buffers[h.buffer],T=(x||0)+(c.byteOffset||0)+(h.byteOffset||0),{ArrayType:R,length:k}=tg(c,h),j=Y3[c.componentType],q=X3[c.type],X=h.byteStride||j*q,re=new Float32Array(k);for(let te=0;te<c.count;te++){let oe=new R(p,T+te*X,2);oT.set(oe[0],oe[1],1),oT.transformByMatrix3(s),re.set([oT[0],oT[1]],te*q)}i===n?iAe(c,h,t.buffers,re):nAe(n,c,e,t,re)}}}}function iAe(t,e,r,i){t.componentType=5126,r.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function nAe(t,e,r,i,n){i.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});let s=i.json.bufferViews;if(!s)return;s.push({buffer:i.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});let a=i.json.accessors;a&&(a.push({bufferView:s?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=a.length-1)}function sAe(t){let{offset:e=[0,0],rotation:r=0,scale:i=[1,1]}=t,n=new an().set(1,0,0,0,1,0,e[0],e[1],1),s=Ype.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),a=Kpe.set(i[0],0,0,0,i[1],0,0,0,1);return n.multiplyRight(s).multiplyRight(a)}var VP={};Es(VP,{decode:()=>aAe,encode:()=>lAe,name:()=>oAe});var MA="KHR_lights_punctual",oAe=MA;async function aAe(t){let e=new en(t),{json:r}=e,i=e.getExtension(MA);i&&(e.json.lights=i.lights,e.removeExtension(MA));for(let n of r.nodes||[]){let s=e.getObjectExtension(n,MA);s&&(n.light=s.light),e.removeObjectExtension(n,MA)}}async function lAe(t){let e=new en(t),{json:r}=e;if(r.lights){let i=e.addExtension(MA);no(!i.lights),i.lights=r.lights,delete r.lights}if(e.json.lights){for(let i of e.json.lights){let n=i.node;e.addObjectExtension(n,MA,i)}delete e.json.lights}}var jP={};Es(jP,{decode:()=>uAe,encode:()=>hAe,name:()=>cAe});var Gx="KHR_materials_unlit",cAe=Gx;async function uAe(t){let e=new en(t),{json:r}=e;for(let i of r.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,Gx);e.removeExtension(Gx)}function hAe(t){let e=new en(t),{json:r}=e;if(e.materials)for(let i of r.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,Gx,{}),e.addExtension(Gx))}var GP={};Es(GP,{decode:()=>dAe,encode:()=>pAe,name:()=>fAe});var Hx="KHR_techniques_webgl",fAe=Hx;async function dAe(t){let e=new en(t),{json:r}=e,i=e.getExtension(Hx);if(i){let n=AAe(i,e);for(let s of r.materials||[]){let a=e.getObjectExtension(s,Hx);a&&(s.technique=Object.assign({},a,n[a.technique]),s.technique.values=mAe(s.technique,e)),e.removeObjectExtension(s,Hx)}e.removeExtension(Hx)}}async function pAe(t,e){}function AAe(t,e){let{programs:r=[],shaders:i=[],techniques:n=[]}=t,s=new TextDecoder;return i.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(a=>{a.fragmentShader=i[a.fragmentShader],a.vertexShader=i[a.vertexShader]}),n.forEach(a=>{a.program=r[a.program]}),n}function mAe(t,e){let r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in r)&&(r[i]=t.uniforms[i].value)}),Object.keys(r).forEach(i=>{typeof r[i]=="object"&&r[i].index!==void 0&&(r[i].texture=e.getTexture(r[i].index))}),r}var Dj=[EP,vP,BP,LP,OP,zP,VP,jP,GP,UP,CP];function Fj(t,e={},r){let i=Dj.filter(n=>Nj(n.name,e));for(let n of i)n.preprocess?.(t,e,r)}async function kj(t,e={},r){let i=Dj.filter(n=>Nj(n.name,e));for(let n of i)await n.decode?.(t,e,r)}function Nj(t,e){let r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}var HP="KHR_binary_glTF";function zj(t){let e=new en(t),{json:r}=e;for(let i of r.images||[]){let n=e.getObjectExtension(i,HP);n&&Object.assign(i,n),e.removeObjectExtension(i,HP)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(HP)}var Uj={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},_Ae={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},WP=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,r){this.json=e.json;let i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),zj(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(let r in Uj)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){let i=e[r];if(!(!i||Array.isArray(i))){e[r]=[];for(let n in i){let s=i[n];s.id=s.id||n;let a=e[r].length;e[r].push(s),this.idToIndexMap[r][n]=a}}}_convertObjectIdsToArrayIndices(e){for(let r in Uj)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(let r of e.textures)this._convertTextureIds(r);for(let r of e.meshes)this._convertMeshIds(r);for(let r of e.nodes)this._convertNodeIds(r);for(let r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(let r of e.primitives){let{attributes:i,indices:n,material:s}=r;for(let a in i)i[a]=this._convertIdToIndex(i[a],"accessor");n&&(r.indices=this._convertIdToIndex(n,"accessor")),s&&(r.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(let i of e[r])for(let n in i){let s=i[n],a=this._convertIdToIndex(s,n);i[n]=a}}_convertIdToIndex(e,r){let i=_Ae[r];if(i in this.idToIndexMap){let n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return n}return e}_updateObjects(e){for(let r of this.json.buffers)delete r.type}_updateMaterial(e){for(let r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};let i=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,n=e.textures.findIndex(s=>s.id===i);n!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:n})}}};function Vj(t,e={}){return new WP().normalize(t,e)}async function jj(t,e,r=0,i,n){return yAe(t,e,r,i),Vj(t,{normalize:i?.gltf?.normalize}),Fj(t,i,n),i?.gltf?.loadBuffers&&t.json.buffers&&await xAe(t,i,n),i?.gltf?.loadImages&&await bAe(t,i,n),await kj(t,i,n),t}function yAe(t,e,r,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!wj(e,r,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=jC(e);else if(e instanceof ArrayBuffer){let a={};r=Tj(a,e,r,i.glb),no(a.type==="glTF",`Invalid GLB magic string ${a.type}`),t._glb=a,t.json=a.json}else no(!1,"GLTF: must be ArrayBuffer or string");let n=t.json.buffers||[];if(t.buffers=new Array(n.length).fill(null),t._glb&&t._glb.header.hasBinChunk){let{binChunks:a}=t._glb;t.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}let s=t.json.images||[];t.images=new Array(s.length).fill({})}async function xAe(t,e,r){let i=t.json.buffers||[];for(let n=0;n<i.length;++n){let s=i[n];if(s.uri){let{fetch:a}=r;no(a);let c=PP(s.uri,e),p=await(await r?.fetch?.(c))?.arrayBuffer?.();t.buffers[n]={arrayBuffer:p,byteOffset:0,byteLength:p.byteLength},delete s.uri}else t.buffers[n]===null&&(t.buffers[n]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function bAe(t,e,r){let i=vAe(t),n=t.json.images||[],s=[];for(let a of i)s.push(wAe(t,n[a],a,e,r));return await Promise.all(s)}function vAe(t){let e=new Set,r=t.json.textures||[];for(let i of r)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function wAe(t,e,r,i,n){let s;if(e.uri&&!e.hasOwnProperty("bufferView")){let c=PP(e.uri,i),{fetch:h}=n;s=await(await h(c)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){let c=Aj(t.json,t.buffers,e.bufferView);s=Lp(c.buffer,c.byteOffset,c.byteLength)}no(s,"glTF image has no data");let a=await el(s,[ad,gP],{...i,mimeType:e.mimeType,basis:i.basis||{format:$3()}},n);a&&a[0]&&(a={compressed:!0,mipmaps:!1,width:a[0].width,height:a[0].height,data:a[0]}),t.images=t.images||[],t.images[r]=a}var ef={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:bj,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:TAe,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function TAe(t,e={},r){e={...ef.options,...e},e.gltf={...ef.options.gltf,...e.gltf};let{byteOffset:i=0}=e;return await jj({},t,i,e,r)}var EAe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},CAe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},kl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},SAe={magFilter:kl.TEXTURE_MAG_FILTER,minFilter:kl.TEXTURE_MIN_FILTER,wrapS:kl.TEXTURE_WRAP_S,wrapT:kl.TEXTURE_WRAP_T},IAe={[kl.TEXTURE_MAG_FILTER]:kl.LINEAR,[kl.TEXTURE_MIN_FILTER]:kl.NEAREST_MIPMAP_LINEAR,[kl.TEXTURE_WRAP_S]:kl.REPEAT,[kl.TEXTURE_WRAP_T]:kl.REPEAT};function MAe(){return{id:"default-sampler",parameters:IAe}}function PAe(t){return CAe[t]}function RAe(t){return EAe[t]}var $P=class{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,r={}){let{json:i,buffers:n=[],images:s=[]}=e,{baseUri:a=""}=e;return no(i),this.baseUri=a,this.buffers=n,this.images=s,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,r),this.json}_resolveTree(e,r={}){let i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((n,s)=>this._resolveBufferView(n,s))),e.images&&(i.images=e.images.map((n,s)=>this._resolveImage(n,s))),e.samplers&&(i.samplers=e.samplers.map((n,s)=>this._resolveSampler(n,s))),e.textures&&(i.textures=e.textures.map((n,s)=>this._resolveTexture(n,s))),e.accessors&&(i.accessors=e.accessors.map((n,s)=>this._resolveAccessor(n,s))),e.materials&&(i.materials=e.materials.map((n,s)=>this._resolveMaterial(n,s))),e.meshes&&(i.meshes=e.meshes.map((n,s)=>this._resolveMesh(n,s))),e.nodes&&(i.nodes=e.nodes.map((n,s)=>this._resolveNode(n,s)),i.nodes=i.nodes.map((n,s)=>this._resolveNodeChildren(n))),e.skins&&(i.skins=e.skins.map((n,s)=>this._resolveSkin(n,s))),e.scenes&&(i.scenes=e.scenes.map((n,s)=>this._resolveScene(n,s))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,r){if(typeof r=="object")return r;let i=e&&e[r];return i||console.warn(`glTF file error: Could not find ${e}[${r}]`),i}_resolveScene(e,r){return{...e,id:e.id||`scene-${r}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,r){let i={...e,id:e?.id||`node-${r}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((n,s)=>{let a=this.getMesh(s);return n.id=a.id,n.primitives=n.primitives.concat(a.primitives),n},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(r=>this.getNode(r))),e}_resolveSkin(e,r){let i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${r}`,inverseBindMatrices:i}}_resolveMesh(e,r){let i={...e,id:e.id||`mesh-${r}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(n=>{let s={...n,attributes:{},indices:void 0,material:void 0},a=n.attributes;for(let c in a)s.attributes[c]=this.getAccessor(a[c]);return n.indices!==void 0&&(s.indices=this.getAccessor(n.indices)),n.material!==void 0&&(s.material=this.getMaterial(n.material)),s})),i}_resolveMaterial(e,r){let i={...e,id:e.id||`material-${r}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};let n=i.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,r){let i=PAe(e.componentType),n=RAe(e.type),s=i*n,a={...e,id:e.id||`accessor-${r}`,bytesPerComponent:i,components:n,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(a.bufferView=this.getBufferView(e.bufferView)),a.bufferView){let c=a.bufferView.buffer,{ArrayType:h,byteLength:p}=tg(a,a.bufferView),x=(a.bufferView.byteOffset||0)+(a.byteOffset||0)+c.byteOffset,T=c.arrayBuffer.slice(x,x+p);a.bufferView.byteStride&&(T=this._getValueFromInterleavedBuffer(c,x,a.bufferView.byteStride,a.bytesPerElement,a.count)),a.value=new h(T)}return a}_getValueFromInterleavedBuffer(e,r,i,n,s){let a=new Uint8Array(s*n);for(let c=0;c<s;c++){let h=r+c*i;a.set(new Uint8Array(e.arrayBuffer.slice(h,h+n)),c*n)}return a.buffer}_resolveTexture(e,r){return{...e,id:e.id||`texture-${r}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):MAe(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,r){let i={id:e.id||`sampler-${r}`,...e,parameters:{}};for(let n in i){let s=this._enumSamplerParameter(n);s!==void 0&&(i.parameters[s]=i[n])}return i}_enumSamplerParameter(e){return SAe[e]}_resolveImage(e,r){let i={...e,id:e.id||`image-${r}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},n=this.images[r];return n&&(i.image=n),i}_resolveBufferView(e,r){let i=e.buffer,n=this.buffers[i].arrayBuffer,s=this.buffers[i].byteOffset||0;return e.byteOffset&&(s+=e.byteOffset),{id:`bufferView-${r}`,...e,buffer:this.buffers[i],data:new Uint8Array(n,s,e.byteLength)}}_resolveCamera(e,r){let i={...e,id:e.id||`camera-${r}`};return i.perspective,i.orthographic,i}};function PA(t,e){return new $P().postProcess(t,e)}async function Gj(t){let e=[];return t.scenes.forEach(r=>{r.traverse(i=>{Object.values(i.model.uniforms).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await BAe(()=>e.some(r=>!r.loaded))}async function BAe(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}var Hj=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,Wj={name:"scenegraph",vs:Hj,fs:Hj,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}};var $j=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var qj=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Zj=[255,255,255,255],LAe={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Zj},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[ef]},Wx=class extends ln{getShaders(){let e={},r;this.props._lighting==="pbr"?(r=Qp,e.LIGHTING_PBR=1):r={name:"pbrMaterial"};let i=[Li,Sn,Wj,r];return super.getShaders({defines:e,vs:$j,fs:qj,modules:i})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:Zj,transition:!0},instanceModelMatrix:j3})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e;r.scenegraph!==i.scenegraph?this._updateScenegraph():r._animations!==i._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){let e=this.props,{device:r}=this.context,i=null;if(e.scenegraph instanceof ku)i={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){let c=e.scenegraph,h=c.json?PA(c):c,p=bP(r,h,this._getModelOptions());i={gltf:h,...p},Gj(p).then(()=>{this.setNeedsRedraw()}).catch(x=>{this.raiseError(x,"loading glTF")})}let n={layer:this,device:this.context.device},s=e.getScene(i,n),a=e.getAnimator(i,n);if(s instanceof Wh){this.state.scenegraph?.destroy(),this._applyAnimationsProp(a,e._animations);let c=[];s.traverse(h=>{h instanceof yd&&c.push(h.model)}),this.setState({scenegraph:s,animator:a,models:c}),this.getAttributeManager().invalidateAll()}else s!==null&&ur.warn("invalid scenegraph:",s)()}_applyAnimationsProp(e,r){if(!e||!r)return;let i=e.getAnimations();Object.keys(r).sort().forEach(n=>{let s=r[n];if(n==="*")i.forEach(a=>{Object.assign(a,s)});else if(Number.isFinite(Number(n))){let a=Number(n);a>=0&&a<i.length?Object.assign(i[a],s):ur.warn(`animation ${n} not found`)()}else{let a=i.find(({name:c})=>c===n);a?Object.assign(a,s):ur.warn(`animation ${n} not found`)()}})}_getModelOptions(){let{_imageBasedLightingEnvironment:e}=this.props,r;return e&&(typeof e=="function"?r=e({gl:this.context.gl,layer:this}):r=e),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());let{viewport:r,renderPass:i}=this.context,{sizeScale:n,sizeMinPixels:s,sizeMaxPixels:a,coordinateSystem:c}=this.props,h=this.getNumInstances();this.state.scenegraph.traverse((p,{worldMatrix:x})=>{if(p instanceof yd){let{model:T}=p;T.setInstanceCount(h);let R={camera:T.uniforms.cameraPosition},k={sizeScale:n,sizeMinPixels:s,sizeMaxPixels:a,composeModelMatrix:G3(r,c),sceneModelMatrix:x};T.shaderInputs.setProps({pbrProjection:R,scenegraph:k}),T.draw(i)}})}};Wx.defaultProps=LAe;Wx.layerName="ScenegraphLayer";var qP=Wx;var Xj=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,Yj={name:"mesh",vs:Xj,fs:Xj,uniformTypes:{pickFeatureIds:"f32"}};var Kj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Qj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function OAe(t){let e=t.positions||t.POSITION,r=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}var DAe={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}},$x=class extends eg{getShaders(){let e=super.getShaders();return e.modules.push(Qp,Yj),{...e,vs:Kj,fs:Qj}}initializeState(){let{featureIds:e}=this.props;super.initializeState();let r=this.getAttributeManager();e&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e;r.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(e){let{featureIds:r}=this.props,{model:i}=this.state;if(!i)return;let n={pickFeatureIds:!!r},s={camera:i.uniforms.cameraPosition};i.shaderInputs.setProps({pbrProjection:s,mesh:n}),super.draw(e)}getModel(e){let{id:r}=this.props,i=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:i});let n=this.getShaders();return OAe(e.attributes),new di(this.context.device,{...this.getShaders(),id:r,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...n.defines,...i?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:i?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){let{model:r}=this.state;if(r){let{mesh:i}=this.props,n=this.parseMaterial(e,i);this.setState({parsedPBRMaterial:n});let{pbr_baseColorSampler:s}=n.bindings,{emptyTexture:a}=this.state,c={sampler:s||a,hasTexture:!!s},{camera:h,...p}={...n.bindings,...n.uniforms};r.shaderInputs.setProps({simpleMesh:c,pbrMaterial:p})}}parseMaterial(e,r){let i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return zx(this.context.device,{unlit:i,...e},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){let r=this.props.featureIds,i=new Uint8ClampedArray(r.length*e.size),n=[];for(let s=0;s<r.length;s++)this.encodePickingColor(r[s],n),i[s*3]=n[0],i[s*3+1]=n[1],i[s*3+2]=n[2];e.value=i}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}};$x.layerName="MeshLayer";$x.defaultProps=DAe;var Jj=$x;var tf=6356752314245179e-9,FAe={radii:[6378137,6378137,tf],radiiSquared:[6378137*6378137,6378137*6378137,tf*tf],oneOverRadii:[1/6378137,1/6378137,1/tf],oneOverRadiiSquared:[1/(6378137*6378137),1/(6378137*6378137),1/(tf*tf)],maximumRadius:Math.max(6378137,6378137,tf),centerToleranceSquared:.1};function lT(t){return t}var aXe=new st;function kAe(t,e=[],r=lT){return"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):"x"in t?(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function eG(t,e=[]){return kAe(t,e,On._cartographicRadians?lT:sI)}function NAe(t,e,r=lT){return"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):"x"in e?(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function tG(t,e){return NAe(t,e,On._cartographicRadians?lT:oI)}var rG=1e-14,zAe=new st,iG={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},ZP={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},qx={east:new st,north:new st,up:new st,west:new st,south:new st,down:new st},UAe=new st,VAe=new st,jAe=new st;function XP(t,e,r,i,n,s){let a=iG[e]&&iG[e][r];bo(a&&(!i||i===a));let c,h,p,x=zAe.copy(n);if(Hs(x.x,0,rG)&&Hs(x.y,0,rG)){let R=Math.sign(x.z);c=UAe.fromArray(ZP[e]),e!=="east"&&e!=="west"&&c.scale(R),h=VAe.fromArray(ZP[r]),r!=="east"&&r!=="west"&&h.scale(R),p=jAe.fromArray(ZP[i]),i!=="east"&&i!=="west"&&p.scale(R)}else{let{up:R,east:k,north:j}=qx;k.set(-x.y,x.x,0).normalize(),t.geodeticSurfaceNormal(x,R),j.copy(R).cross(k);let{down:q,west:X,south:re}=qx;q.copy(R).scale(-1),X.copy(k).scale(-1),re.copy(j).scale(-1),c=qx[e],h=qx[r],p=qx[i]}return s[0]=c.x,s[1]=c.y,s[2]=c.z,s[3]=0,s[4]=h.x,s[5]=h.y,s[6]=h.z,s[7]=0,s[8]=p.x,s[9]=p.y,s[10]=p.z,s[11]=0,s[12]=x.x,s[13]=x.y,s[14]=x.z,s[15]=1,s}var cg=new st,GAe=new st,HAe=new st;function nG(t,e,r=[]){let{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:s}=e;cg.from(t);let a=cg.x,c=cg.y,h=cg.z,p=i.x,x=i.y,T=i.z,R=a*a*p*p,k=c*c*x*x,j=h*h*T*T,q=R+k+j,X=Math.sqrt(1/q);if(!Number.isFinite(X))return;let re=GAe;if(re.copy(t).scale(X),q<s)return re.to(r);let te=n.x,oe=n.y,ae=n.z,pe=HAe;pe.set(re.x*te*2,re.y*oe*2,re.z*ae*2);let be=(1-X)*cg.len()/(.5*pe.len()),Fe=0,Y,J,Z,xe;do{be-=Fe,Y=1/(1+be*te),J=1/(1+be*oe),Z=1/(1+be*ae);let _e=Y*Y,Be=J*J,Se=Z*Z,ke=_e*Y,Ye=Be*J,rt=Se*Z;xe=R*_e+k*Be+j*Se-1;let _t=-2*(R*ke*te+k*Ye*oe+j*rt*ae);Fe=xe/_t}while(Math.abs(xe)>Cc.EPSILON12);return cg.scale([Y,J,Z]).to(r)}var cT=new st,sG=new st,qAe=new st,zc=new st,ZAe=new st,uT=new st,Oi=class{constructor(e=0,r=0,i=0){this.centerToleranceSquared=Cc.EPSILON1,bo(e>=0),bo(r>=0),bo(i>=0),this.radii=new st(e,r,i),this.radiiSquared=new st(e*e,r*r,i*i),this.radiiToTheFourth=new st(e*e*e*e,r*r*r*r,i*i*i*i),this.oneOverRadii=new st(e===0?0:1/e,r===0?0:1/r,i===0?0:1/i),this.oneOverRadiiSquared=new st(e===0?0:1/(e*e),r===0?0:1/(r*r),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,r,i),this.maximumRadius=Math.max(e,r,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,r=[0,0,0]){let i=sG,n=qAe,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,i),n.copy(this.radiiSquared).scale(i);let a=Math.sqrt(i.dot(n));return n.scale(1/a),i.scale(s),n.add(i),n.to(r)}cartesianToCartographic(e,r=[0,0,0]){uT.from(e);let i=this.scaleToGeodeticSurface(uT,zc);if(!i)return;let n=this.geodeticSurfaceNormal(i,sG),s=ZAe;s.copy(uT).subtract(i);let a=Math.atan2(n.y,n.x),c=Math.asin(n.z),h=Math.sign(Fo.dot(s,uT))*Fo.length(s);return tG([a,c,h],r)}eastNorthUpToFixedFrame(e,r=new Er){return XP(this,"east","north","up",e,r)}localFrameToFixedFrame(e,r,i,n,s=new Er){return XP(this,e,r,i,n,s)}geocentricSurfaceNormal(e,r=[0,0,0]){return cT.from(e).normalize().to(r)}geodeticSurfaceNormalCartographic(e,r=[0,0,0]){let i=eG(e),n=i[0],s=i[1],a=Math.cos(s);return cT.set(a*Math.cos(n),a*Math.sin(n),Math.sin(s)).normalize(),cT.to(r)}geodeticSurfaceNormal(e,r=[0,0,0]){return cT.from(e).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(e,r){return nG(e,this,r)}scaleToGeocentricSurface(e,r=[0,0,0]){zc.from(e);let i=zc.x,n=zc.y,s=zc.z,a=this.oneOverRadiiSquared,c=1/Math.sqrt(i*i*a.x+n*n*a.y+s*s*a.z);return zc.multiplyScalar(c).to(r)}transformPositionToScaledSpace(e,r=[0,0,0]){return zc.from(e).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(e,r=[0,0,0]){return zc.from(e).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(e,r=0,i=[0,0,0]){bo(Hs(this.radii.x,this.radii.y,Cc.EPSILON15)),bo(this.radii.z>0),zc.from(e);let n=zc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-r))return zc.set(0,0,n).to(i)}};Oi.WGS84=new Oi(6378137,6378137,tf);var hT=class{item;previous;next;constructor(e,r,i){this.item=e,this.previous=r,this.next=i}};var fT=class{head=null;tail=null;_length=0;get length(){return this._length}add(e){let r=new hT(e,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,r){e!==r&&(this.remove(r),this._insert(e,r))}_insert(e,r){let i=e.next;e.next=r,this.tail===e?this.tail=r:i.previous=r,r.next=i,r.previous=e,++this._length}};var dT=class{_list;_sentinel;_trimTiles;constructor(){this._list=new fT,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){let r=e._cacheNode;r&&this._list.splice(this._sentinel,r)}add(e,r,i){r._cacheNode||(r._cacheNode=this._list.add(r),i&&i(e,r))}unloadTile(e,r,i){let n=r._cacheNode;n&&(this._list.remove(n),r._cacheNode=null,i&&i(e,r))}unloadTiles(e,r){let i=this._trimTiles;this._trimTiles=!1;let n=this._list,s=e.maximumMemoryUsage*1024*1024,a=this._sentinel,c=n.head;for(;c!==a&&(e.gpuMemoryUsageInBytes>s||i);){let h=c.item;c=c.next,this.unloadTile(e,h,r)}}trim(){this._trimTiles=!0}};function oG(t,e){Ii(t),Ii(e);let{rtcCenter:r,gltfUpAxis:i}=e,{computedTransform:n,boundingVolume:{center:s}}=t,a=new Er(n);switch(r&&a.translate(r),i){case"Z":break;case"Y":let T=new Er().rotateX(Math.PI/2);a=a.multiplyRight(T);break;case"X":let R=new Er().rotateY(-Math.PI/2);a=a.multiplyRight(R);break;default:break}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);let c=new st(s);e.cartesianModelMatrix=a,e.cartesianOrigin=c;let h=Oi.WGS84.cartesianToCartographic(c,new st),x=Oi.WGS84.eastNorthUpToFixedFrame(c).invert();e.cartographicModelMatrix=x.multiplyRight(a),e.cartographicOrigin=h,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}var aG=new st,YP=new st,KP=new ha([new qo,new qo,new qo,new qo,new qo,new qo]);function cG(t,e){let{cameraDirection:r,cameraUp:i,height:n}=t,{metersPerUnit:s}=t.distanceScales,a=pT(t,t.center),c=Oi.WGS84.eastNorthUpToFixedFrame(a),h=t.unprojectPosition(t.cameraPosition),p=Oi.WGS84.cartographicToCartesian(h,new st),x=new st(c.transformAsVector(new st(r).scale(s))).normalize(),T=new st(c.transformAsVector(new st(i).scale(s))).normalize();XAe(t);let R=t.constructor,{longitude:k,latitude:j,width:q,bearing:X,zoom:re}=t,te=new R({longitude:k,latitude:j,height:n,width:q,bearing:X,zoom:re,pitch:0});return{camera:{position:p,direction:x,up:T},viewport:t,topDownViewport:te,height:n,cullingVolume:KP,frameNumber:e,sseDenominator:1.15}}function uG(t,e,r){if(r===0||t.length<=r)return[t,[]];let i=[],{longitude:n,latitude:s}=e.viewport;for(let[p,x]of t.entries()){let[T,R]=x.header.mbs,k=Math.abs(n-T),j=Math.abs(s-R),q=Math.sqrt(j*j+k*k);i.push([p,q])}let a=i.sort((p,x)=>p[1]-x[1]),c=[];for(let p=0;p<r;p++)c.push(t[a[p][0]]);let h=[];for(let p=r;p<a.length;p++)h.push(t[a[p][0]]);return[c,h]}function XAe(t){let e=t.getFrustumPlanes(),r=lG(e.near,t.cameraPosition),i=pT(t,r),n=pT(t,t.cameraPosition,YP),s=0;KP.planes[s++].fromPointNormal(i,aG.copy(i).subtract(n));for(let a in e){if(a==="near")continue;let c=e[a],h=lG(c,r,YP),p=pT(t,h,YP);KP.planes[s++].fromPointNormal(p,aG.copy(i).subtract(p))}}function lG(t,e,r=new st){let i=t.normal.dot(e);return r.copy(t.normal).scale(t.distance-i).add(e),r}function pT(t,e,r=new st){let i=t.unprojectPosition(e);return Oi.WGS84.cartographicToCartesian(i,r)}var YAe=6378137,KAe=6378137,QP=6356752314245179e-9,ug=new st;function hG(t,e){if(t instanceof Qh){let{halfAxes:r}=t,i=QAe(r);return Math.log2(QP/(i+e[2]))}else if(t instanceof Xu){let{radius:r}=t;return Math.log2(QP/(r+e[2]))}else if(t.width&&t.height){let{width:r,height:i}=t,n=Math.log2(YAe/r),s=Math.log2(KAe/i);return(n+s)/2}return 1}function JP(t,e,r){Oi.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],ug);let i=Math.sqrt(Math.pow(ug[0]-r[0],2)+Math.pow(ug[1]-r[1],2)+Math.pow(ug[2]-r[2],2));return Math.log2(QP/(i+e[2]))}function fG(t,e,r){let[i,n,s,a]=t;return JP({xmin:i,xmax:s,ymin:n,ymax:a,zmin:0,zmax:0},e,r)}function QAe(t){t.getColumn(0,ug);let e=t.getColumn(1),r=t.getColumn(2);return ug.add(e).add(r).len()}var fa={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Xo;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(Xo||(Xo={}));var Nl;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Nl||(Nl={}));var To;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(To||(To={}));var rf;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(rf||(rf={}));var dG={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function gG(t){return t!=null}var Yo=new st,AT=new st,JAe=new st,eme=new st,RA=new st,pG=new st,AG=new st,mG=new st;function mT(t,e,r){if(Ii(t,"3D Tile: boundingVolume must be defined"),t.box)return yG(t.box,e,r);if(t.region)return rme(t.region);if(t.sphere)return tme(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function _G(t,e){if(t.box)return ime(e);if(t.region){let[r,i,n,s,a,c]=t.region;return[[nl(r),nl(i),a],[nl(n),nl(s),c]]}if(t.sphere)return nme(e);throw new Error("Unkown boundingVolume type")}function yG(t,e,r){let i=new st(t[0],t[1],t[2]);e.transform(i,i);let n=[];if(t.length===10){let p=t.slice(3,6),x=new Rl;x.fromArray(t,6);let T=new st([1,0,0]),R=new st([0,1,0]),k=new st([0,0,1]);T.transformByQuaternion(x),T.scale(p[0]),R.transformByQuaternion(x),R.scale(p[1]),k.transformByQuaternion(x),k.scale(p[2]),n=[...T.toArray(),...R.toArray(),...k.toArray()]}else n=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];let s=e.transformAsVector(n.slice(0,3)),a=e.transformAsVector(n.slice(3,6)),c=e.transformAsVector(n.slice(6,9)),h=new an([s[0],s[1],s[2],a[0],a[1],a[2],c[0],c[1],c[2]]);return gG(r)?(r.center=i,r.halfAxes=h,r):new Qh(i,h)}function tme(t,e,r){let i=new st(t[0],t[1],t[2]);e.transform(i,i);let n=e.getScale(AT),s=Math.max(Math.max(n[0],n[1]),n[2]),a=t[3]*s;return gG(r)?(r.center=i,r.radius=a,r):new Xu(i,a)}function rme(t){let[e,r,i,n,s,a]=t,c=Oi.WGS84.cartographicToCartesian([nl(e),nl(n),s],JAe),h=Oi.WGS84.cartographicToCartesian([nl(i),nl(r),a],eme),p=new st().addVectors(c,h).multiplyByScalar(.5);return Oi.WGS84.cartesianToCartographic(p,RA),Oi.WGS84.cartographicToCartesian([nl(i),RA[1],RA[2]],pG),Oi.WGS84.cartographicToCartesian([RA[0],nl(n),RA[2]],AG),Oi.WGS84.cartographicToCartesian([RA[0],RA[1],a],mG),yG([...p,...pG.subtract(p),...AG.subtract(p),...mG.subtract(p)],new Er)}function ime(t){let e=xG(),{halfAxes:r}=t,i=new st(r.getColumn(0)),n=new st(r.getColumn(1)),s=new st(r.getColumn(2));for(let a=0;a<2;a++){for(let c=0;c<2;c++){for(let h=0;h<2;h++)Yo.copy(t.center),Yo.add(i),Yo.add(n),Yo.add(s),bG(e,Yo),s.negate();n.negate()}i.negate()}return e}function nme(t){let e=xG(),{center:r,radius:i}=t,n=Oi.WGS84.scaleToGeodeticSurface(r,Yo),s;n?s=Oi.WGS84.geodeticSurfaceNormal(n):s=new st(0,0,1);let a=new st(s[2],-s[1],0);a.len()>0?a.normalize():a=new st(0,1,0);let c=a.clone().cross(s);for(let h of[a,c,s]){AT.copy(h).scale(i);for(let p=0;p<2;p++)Yo.copy(r),Yo.add(AT),bG(e,Yo),AT.negate()}return e}function xG(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function bG(t,e){Oi.WGS84.cartesianToCartographic(e,Yo),t[0][0]=Math.min(t[0][0],Yo[0]),t[0][1]=Math.min(t[0][1],Yo[1]),t[0][2]=Math.min(t[0][2],Yo[2]),t[1][0]=Math.max(t[1][0],Yo[0]),t[1][1]=Math.max(t[1][1],Yo[1]),t[1][2]=Math.max(t[1][2],Yo[2])}var qXe=new st,ZXe=new st,XXe=new Er,YXe=new st,KXe=new st,QXe=new st;function sme(t,e){let r=t*e;return 1-Math.exp(-(r*r))}function ome(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){let r=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return sme(e,r)*i}return 0}function vG(t,e,r){let i=t.tileset,n=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,s=r?n:t.lodMetricValue;if(s===0)return 0;let a=Math.max(t._distanceToCamera,1e-7),{height:c,sseDenominator:h}=e,{viewDistanceScale:p}=i.options,x=s*c*(p||1)/(a*h);return x-=ome(i,a),x}var e5=new st,wG=new st,Ud=new st,TG=new st,ame=new st,t5=new Er,EG=new Er;function CG(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";let r=2*r5(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function r5(t,e){let{topDownViewport:r}=e,i=t.header.mbs[1],n=t.header.mbs[0],s=t.header.mbs[2],a=t.header.mbs[3],c=[...t.boundingVolume.center],h=r.unprojectPosition(r.cameraPosition);Oi.WGS84.cartographicToCartesian(h,e5),wG.copy(e5).subtract(c).normalize(),Oi.WGS84.eastNorthUpToFixedFrame(c,t5),EG.copy(t5).invert(),Ud.copy(e5).transform(EG);let p=Math.sqrt(Ud[0]*Ud[0]+Ud[1]*Ud[1]),x=p*p/Ud[2];TG.copy([Ud[0],Ud[1],x]);let R=TG.transform(t5).subtract(c).normalize(),j=wG.cross(R).normalize().scale(a).add(c),q=Oi.WGS84.cartesianToCartographic(j),X=r.project([n,i,s]),re=r.project(q);return ame.copy(X).subtract(re).magnitude()}function SG(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}var Zx=class{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ii(e<this._array.length),this._array[e]}set(e,r){Ii(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=r,this._map.set(r,e)}delete(e){let r=this._map.get(e);r>=0&&(this._array.splice(r,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){let r=this.length++;this._array[r]=e,this._map.set(e,r)}}pop(){let e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ii(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ii(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}};var lme={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""},Qu=class{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new Zx;_emptyTraversalStack=new Zx;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...lme,...e}}traverse(e,r,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,r),this._frameNumber=r.frameNumber,this.executeTraversal(e,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,r){let i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){let s=i.pop(),a=!1;this.canTraverse(s,r)&&(this.updateChildTiles(s,r),a=this.updateAndPushChildren(s,r,i,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));let c=s.parent,h=!!(!c||c._shouldRefine),p=!a;s.hasRenderContent?s.refine===Xo.ADD?(this.loadTile(s,r),this.selectTile(s,r)):s.refine===Xo.REPLACE&&(this.loadTile(s,r),p&&this.selectTile(s,r)):(this.emptyTiles[s.id]=s,this.loadTile(s,r),p&&this.selectTile(s,r)),this.touchTile(s,r),s._shouldRefine=a&&h}let n=new Date().getTime();(this.traversalFinished(r)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(r))}updateChildTiles(e,r){let i=e.children;for(let n of i)this.updateTile(n,r)}updateAndPushChildren(e,r,i,n){let{loadSiblings:s,skipLevelOfDetail:a}=this.options,c=e.children;c.sort(this.compareDistanceToCamera.bind(this));let h=e.refine===Xo.REPLACE&&e.hasRenderContent&&!a,p=!1,x=!0;for(let T of c)if(T._selectionDepth=n,T.isVisibleAndInRequestVolume?(i.find(T)&&i.delete(T),i.push(T),p=!0):(h||s)&&(this.loadTile(T,r),this.touchTile(T,r)),h){let R;if(T._inRequestVolume?T.hasRenderContent?R=T.contentAvailable:R=this.executeEmptyTraversal(T,r):R=!1,x=x&&R,!x)return!1}return p||(x=!1),x}updateTile(e,r){this.updateTileVisibility(e,r)}selectTile(e,r){this.shouldSelectTile(e)&&(e._selectedFrame=r.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,r){this.shouldLoadTile(e)&&(e._requestedFrame=r.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,r){e.tileset._cache.touch(e),e._touchedFrame=r.frameNumber}canTraverse(e,r){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,r,i=!1){let n=e._screenSpaceError;return i&&(n=e.getScreenSpaceError(r,!0)),n>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,r){let i=[];if(this.options.viewportTraversersMap)for(let n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===r.viewport.id&&i.push(n);else i.push(r.viewport.id);e.updateVisibility(r,i)}compareDistanceToCamera(e,r){return e._distanceToCamera-r._distanceToCamera}anyChildrenVisible(e,r){let i=!1;for(let n of e.children)n.updateVisibility(r),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,r){let i=!0,n=this._emptyTraversalStack;for(n.push(e);n.length>0;){let s=n.pop(),a=!s.hasRenderContent&&this.canTraverse(s,r),c=!s.hasRenderContent&&s.children.length===0;if(!a&&!s.contentAvailable&&!c&&(i=!1),this.updateTile(s,r),s.isVisibleAndInRequestVolume||(this.loadTile(s,r),this.touchTile(s,r)),a){let h=s.children;for(let p of h)n.push(p)}}return i}};var IG=new st;function cme(t){return t!=null}var BA=class{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=fa.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new Er;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new Qu({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new Er;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,r,i,n=""){this.header=r,this.tileset=e,this.id=n||r.id,this.url=r.url,this.parent=i,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===fa.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===fa.UNLOADED}get contentExpired(){return this.contentState===fa.EXPIRED}get contentFailed(){return this.contentState===fa.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=_G(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,r){switch(this.tileset.type){case To.I3S:return r5(this,e);case To.TILES3D:return vG(this,e,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){let e=this.tileset._traverser,{skipLevelOfDetail:r}=e.options,i=this.refine===Xo.ADD||r;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===fa.UNLOADED)return-1;let n=this.parent,a=n&&(!i||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,c=e.root?e.root._screenSpaceError:0;return Math.max(c-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=fa.LOADING;let r=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!r)return this.contentState=fa.UNLOADED,!1;try{let i=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,s={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await yo(i,n,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=fa.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=fa.FAILED,i}finally{r.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=fa.UNLOADED,!0}updateVisibility(e,r){if(this._frameNumber===e.frameNumber)return;let i=this.parent,n=i?i._visibilityPlaneMask:ha.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){let s=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==ha.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=r}visibility(e,r){let{cullingVolume:i}=e,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,r)}contentVisibility(){return!0}distanceToTile(e){let r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){let r=this.boundingVolume;return IG.subVectors(r.center,e.position),e.direction.dot(IG)}insideViewerRequestVolume(e){let r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(cme(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){let e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=fa.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Er(e.transform):new Er;let r=this.parent,i=this.tileset,n=r&&r.computedTransform?r.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Er(n).multiplyRight(this.transform);let s=r&&r._initialTransform?r._initialTransform.clone():new Er;this._initialTransform=new Er(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=fa.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ha.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Xo.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break;default:}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=mT(e.boundingVolume,this.computedTransform,this.boundingVolume);let r=e.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=mT(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=mT(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Er){let r=e.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return SG(this.tileset.tileset)}}};var gT=class extends Qu{compareDistanceToCamera(e,r){return r._distanceToCamera===0&&e._distanceToCamera===0?r._centerZDepth-e._centerZDepth:r._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,r){if(super.updateTileVisibility(e,r),!e.isVisibleAndInRequestVolume)return;let i=e.children.length>0;if(e.hasTilesetContent&&i){let a=e.children[0];this.updateTileVisibility(a,r),e._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(e,r)){e._visible=!1;return}let n=e.refine===Xo.REPLACE,s=e._optimChildrenWithinParent===dG.USE_OPTIMIZATION;if(n&&s&&i&&!this.anyChildrenVisible(e,r)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,r){let{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==Xo.ADD?!1:!this.shouldRefine(e,r,!0)}};var _T=class{frameNumberMap=new Map;register(e,r){let i=this.frameNumberMap.get(e)||new Map,n=i.get(r)||0;i.set(r,n+1),this.frameNumberMap.set(e,i)}deregister(e,r){let i=this.frameNumberMap.get(e);if(!i)return;let n=i.get(r)||1;i.set(r,n-1)}isZero(e,r){return(this.frameNumberMap.get(e)?.get(r)||0)===0}};var i5={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"},yT=class{_statusMap;pendingTilesRegister=new _T;constructor(){this._statusMap={}}add(e,r,i,n){if(!this._statusMap[r]){let{frameNumber:s,viewport:{id:a}}=n;this._statusMap[r]={request:e,callback:i,key:r,frameState:n,status:i5.REQUESTED},this.pendingTilesRegister.register(a,s),e().then(c=>{this._statusMap[r].status=i5.COMPLETED;let{frameNumber:h,viewport:{id:p}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(p,h),this._statusMap[r].callback(c,n)}).catch(c=>{this._statusMap[r].status=i5.ERROR;let{frameNumber:h,viewport:{id:p}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(p,h),i(c)})}}update(e,r){if(this._statusMap[e]){let{frameNumber:i,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,i);let{frameNumber:s,viewport:{id:a}}=r;this.pendingTilesRegister.register(a,s),this._statusMap[e].frameState=r}}find(e){return this._statusMap[e]}hasPendingTiles(e,r){return!this.pendingTilesRegister.isZero(e,r)}};var xT=class extends Qu{_tileManager;constructor(e){super(e),this._tileManager=new yT}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,r){return e._lodJudge=CG(e,r),e._lodJudge==="DIG"}updateChildTiles(e,r){let i=e.header.children||[],n=e.children,s=e.tileset;for(let a of i){let c=`${a.id}-${r.viewport.id}`,h=n&&n.find(p=>p.id===c);if(h)h&&this.updateTile(h,r);else{let p=()=>this._loadTile(a.id,s);this._tileManager.find(c)?this._tileManager.update(c,r):(s.tileset.nodePages&&(p=()=>s.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(p,c,T=>this._onTileLoad(T,e,c),r))}}return!1}async _loadTile(e,r){let{loader:i}=r,n=r.getTileUrl(`${r.url}/nodes/${e}`),s={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await yo(n,i,s)}_onTileLoad(e,r,i){let n=new BA(r.tileset,e,r,i);r.children.push(n);let s=this._tileManager.find(n.id).frameState;this.updateTile(n,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,s)}};var ume={description:"",ellipsoid:Oi.WGS84,modelMatrix:new Er,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},bT="Tiles In Tileset(s)",n5="Tiles In Memory",MG="Tiles In View",PG="Tiles To Render",RG="Tiles Loaded",s5="Tiles Loading",BG="Tiles Unloaded",LG="Failed Tile Loads",OG="Points/Vertices",o5="Tile Memory Use",DG="Maximum Screen Space Error",Xx=class{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new dT;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,r){this.options={...ume,...r},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||tl.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new od({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Go({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let i=e;return this.queryParams.length&&(i=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;let r=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;let i=[];for(let n of r){let s=n.id;this._needTraverse(s)?i.push(s):this.traverseCounter--}for(let n of r){let s=n.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!i.includes(s))continue;let a=cG(n,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(e){let r=e;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[e]),r===e}_onTraversalEnd(e){let r=e.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});let i=this.frameStateData[r],n=Object.values(this._traverser.selectedTiles),[s,a]=uG(n,e,this.options.maximumTilesSelected);i.selectedTiles=s;for(let c of a)c.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(let e in this.frameStateData){let r=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(let e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,r){if(e.length!==r.length)return!0;let i=new Set(e.map(a=>a.id)),n=new Set(r.map(a=>a.id)),s=e.filter(a=>!n.has(a.id)).length>0;return s=s||r.filter(a=>!i.has(a.id)).length>0,s}_loadTiles(){for(let e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,r)=>e._unloadTile(r))}_updateStats(){let e=0,r=0;for(let i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?r+=i.content.pointCount:r+=i.content.vertexCount);this.stats.get(MG).count=this.selectedTiles.length,this.stats.get(PG).count=e,this.stats.get(OG).count=r,this.stats.get(DG).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===To.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===To.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===To.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){let e=this.tileset.fullExtent;if(e){let{xmin:i,xmax:n,ymin:s,ymax:a,zmin:c,zmax:h}=e;this.cartographicCenter=new st(i+(n-i)/2,s+(a-s)/2,c+(h-c)/2),this.cartesianCenter=new st,Oi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=JP(e,this.cartographicCenter,this.cartesianCenter);return}let r=this.tileset.store?.extent;if(r){let[i,n,s,a]=r;this.cartographicCenter=new st(i+(s-i)/2,n+(a-n)/2,0),this.cartesianCenter=new st,Oi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=fG(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new st,this.zoom=1}calculateViewPropsTiles3D(){let e=this.root,{center:r}=e.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new st,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new st,Oi.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new st(0,0,-Oi.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=hG(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(bT),this.stats.get(s5),this.stats.get(n5),this.stats.get(MG),this.stats.get(PG),this.stats.get(RG),this.stats.get(BG),this.stats.get(LG),this.stats.get(OG),this.stats.get(o5,"memory"),this.stats.get(DG)}_initializeTileHeaders(e,r){let i=new BA(this,e.root,r);if(r&&(r.children.push(i),i.depth=r.depth+1),this.type===To.TILES3D){let n=[];for(n.push(i);n.length>0;){let s=n.pop();this.stats.get(bT).incrementCount();let a=s.header.children||[];for(let c of a){let h=new BA(this,c,s);if(h.contentUrl?.includes("?session=")){let x=new URL(h.contentUrl).searchParams.get("session");x&&(this._queryParams.session=x)}s.children.push(h),h.depth=s.depth+1,n.push(h)}}}return i}_initializeTraverser(){let e;switch(this.type){case To.TILES3D:e=gT;break;case To.I3S:e=xT;break;default:e=Qu}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let r;try{this._onStartTileLoading(),r=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,r)}}_onTileLoadError(e,r){this.stats.get(LG).incrementCount();let i=r.message||r.toString(),n=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,n)}_onTileLoad(e,r){if(r){if(this.type===To.I3S){let i=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(bT).reset(),this.stats.get(bT).addCount(i)}e&&e.content&&oG(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===To.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break;default:}else if(this.type===To.TILES3D){let{extensionsRemoved:r=[]}=e.content?.gltf||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(s5).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(s5).decrementCount()}_addTileToCache(e){this._cache.add(this,e,r=>r._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(RG).incrementCount(),this.stats.get(n5).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(o5).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(n5).decrementCount(),this.stats.get(BG).incrementCount(),this.stats.get(o5).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){let e=[];for(this.root&&e.push(this.root);e.length>0;){let r=e.pop();for(let i of r.children)e.push(i);this._destroyTile(r)}this.root=null}_destroySubtree(e){let r=e,i=[];for(i.push(r);i.length>0;){e=i.pop();for(let n of e.children)i.push(n);e!==r&&this._destroyTile(e)}r.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){let r=new URLSearchParams(e.queryString),i=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}};var vT="4.3.2";var LA={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"},XYe=Object.keys(LA);function a5(t,e,r){Ii(t instanceof ArrayBuffer);let i=new TextDecoder("utf8"),n=new Uint8Array(t,e,r);return i.decode(n)}function FG(t,e=0){let r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}var hme={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Os={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},bi={...hme,...Os};var l5={[Os.DOUBLE]:Float64Array,[Os.FLOAT]:Float32Array,[Os.UNSIGNED_SHORT]:Uint16Array,[Os.UNSIGNED_INT]:Uint32Array,[Os.UNSIGNED_BYTE]:Uint8Array,[Os.BYTE]:Int8Array,[Os.SHORT]:Int16Array,[Os.INT]:Int32Array},fme={DOUBLE:Os.DOUBLE,FLOAT:Os.FLOAT,UNSIGNED_SHORT:Os.UNSIGNED_SHORT,UNSIGNED_INT:Os.UNSIGNED_INT,UNSIGNED_BYTE:Os.UNSIGNED_BYTE,BYTE:Os.BYTE,SHORT:Os.SHORT,INT:Os.INT},c5="Failed to convert GL type",Uc=class t{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(let r in l5)if(l5[r]===e)return r;throw new Error(c5)}static fromName(e){let r=fme[e];if(!r)throw new Error(c5);return r}static getArrayType(e){switch(e){case Os.UNSIGNED_SHORT_5_6_5:case Os.UNSIGNED_SHORT_4_4_4_4:case Os.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:let r=l5[e];if(!r)throw new Error(c5);return r}}static getByteSize(e){return t.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!t.getArrayType(e)}static createTypedArray(e,r,i=0,n){n===void 0&&(n=(r.byteLength-i)/t.getByteSize(e));let s=t.getArrayType(e);return new s(r,i,n)}};function kG(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function u5(t,e=[0,0,0]){let r=t>>11&31,i=t>>5&63,n=t&31;return e[0]=r<<3,e[1]=i<<2,e[2]=n<<3,e}var oKe=1/256;var aKe=new Xp,lKe=new st,cKe=new Xp,uKe=new Xp,hKe=new Uint8Array(1);function NG(t,e=255){return xo(t,0,e)/e*2-1}function zG(t){return t<0?-1:1}function UG(t,e,r,i){if(kG(i),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(i.x=NG(t,r),i.y=NG(e,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){let n=i.x;i.x=(1-Math.abs(i.y))*zG(n),i.y=(1-Math.abs(n))*zG(i.y)}return i.normalize()}function h5(t,e,r){return UG(t,e,255,r)}var nf=class{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,r){this.json=e,this.buffer=r}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,r=bi.UNSIGNED_INT,i=1){let n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,r,i,1,n.byteOffset):n}getPropertyArray(e,r,i){let n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(r=Uc.fromName(n.componentType)),this._getTypedArrayFromBinary(e,r,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,r,n)}getProperty(e,r,i,n,s){let a=this.json[e];if(!a)return a;let c=this.getPropertyArray(e,r,i);if(i===1)return c[n];for(let h=0;h<i;++h)s[h]=c[i*n+h];return s}_getTypedArrayFromBinary(e,r,i,n,s){let a=this._cachedTypedArrays,c=a[e];return c||(c=Uc.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+s,n*i),a[e]=c),c}_getTypedArrayFromArray(e,r,i){let n=this._cachedTypedArrays,s=n[e];return s||(s=Uc.createTypedArray(r,i),n[e]=s),s}};var dme={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pme={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},Ame={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};function VG(t,e,r,i){let{componentType:n}=t;Ii(t.componentType);let s=typeof n=="string"?Uc.fromName(n):n,a=dme[t.type],c=pme[t.type],h=Ame[t.type];return r+=t.byteOffset,{values:Uc.createTypedArray(s,e,r,a*i),type:s,size:a,unpacker:c,packer:h}}var Ju=t=>t!==void 0;function jG(t,e,r){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy"),n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,i=n),i?mme(i,r):null}function mme(t,e){let r,i,n,s=t.instancesLength,a=t.classes,c=t.classIds,h=t.parentCounts,p=t.parentIds,x=s;Ju(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,n=getBinaryAccessor(c),c=n.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,s));let T;if(Ju(h))for(Ju(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,n=getBinaryAccessor(h),h=n.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,s)),T=new Uint16Array(s),x=0,r=0;r<s;++r)T[r]=x,x+=h[r];Ju(p)&&Ju(p.byteOffset)&&(p.componentType=defaultValue(p.componentType,GL.UNSIGNED_SHORT),p.type=AttributeType.SCALAR,n=getBinaryAccessor(p),p=n.createArrayBufferView(e.buffer,e.byteOffset+p.byteOffset,x));let R=a.length;for(r=0;r<R;++r){let X=a[r].length,re=a[r].instances,te=getBinaryProperties(X,re,e);a[r].instances=combine(te,re)}let k=new Array(R).fill(0),j=new Uint16Array(s);for(r=0;r<s;++r)i=c[r],j[r]=k[i],++k[i];let q={classes:a,classIds:c,classIndexes:j,parentCounts:h,parentIndexes:T,parentIds:p};return yme(q),q}function hg(t,e,r){if(!t)return;let i=t.parentCounts;return t.parentIds?r(t,e):i>0?gme(t,e,r):_me(t,e,r)}function gme(t,e,r){let i=t.classIds,n=t.parentCounts,s=t.parentIds,a=t.parentIndexes,c=i.length,h=scratchVisited;h.length=Math.max(h.length,c);let p=++marker,x=scratchStack;for(x.length=0,x.push(e);x.length>0;){if(e=x.pop(),h[e]===p)continue;h[e]=p;let T=r(t,e);if(Ju(T))return T;let R=n[e],k=a[e];for(let j=0;j<R;++j){let q=s[k+j];q!==e&&x.push(q)}}return null}function _me(t,e,r){let i=!0;for(;i;){let n=r(t,e);if(Ju(n))return n;let s=t.parentIds[e];i=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function yme(t){let e=[],i=t.classIds.length;for(let n=0;n<i;++n)GG(t,n,stack)}function GG(t,e,r){let i=t.parentCounts,n=t.parentIds,s=t.parentIndexes,c=t.classIds.length;if(!Ju(n))return;assert(e<c,`Parent index ${e} exceeds the total number of instances: ${c}`),assert(r.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(e);let h=Ju(i)?i[e]:1,p=Ju(i)?s[e]:e;for(let x=0;x<h;++x){let T=n[p+x];T!==e&&GG(t,T,r)}r.pop(e)}function Oa(t){return t!=null}var wT=(t,e)=>t,xme={HIERARCHY:!0,extensions:!0,extras:!0},OA=class{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,r,i,n={}){Ii(i>=0),this.json=e||{},this.binary=r,this.featureCount=i,this._extensions=this.json?.extensions||{},this._properties={};for(let s in this.json)xme[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=jG(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,r){if(this._checkBatchId(e),Ii(typeof r=="string",r),this._hierarchy){let i=hg(this._hierarchy,e,(n,s)=>{let a=n.classIds[s];return n.classes[a].name===r});return Oa(i)}return!1}isExactClass(e,r){return Ii(typeof r=="string",r),this.getExactClassName(e)===r}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){let r=this._hierarchy.classIds[e];return this._hierarchy.classes[r].name}}hasProperty(e,r){return this._checkBatchId(e),Ii(typeof r=="string",r),Oa(this._properties[r])||this._hasPropertyInHierarchy(e,r)}getPropertyNames(e,r){this._checkBatchId(e),r=Oa(r)?r:[],r.length=0;let i=Object.keys(this._properties);return r.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,r),r}getProperty(e,r){if(this._checkBatchId(e),Ii(typeof r=="string",r),this._binaryProperties){let n=this._binaryProperties[r];if(Oa(n))return this._getBinaryProperty(n,e)}let i=this._properties[r];if(Oa(i))return wT(i[e],!0);if(this._hierarchy){let n=this._getHierarchyProperty(e,r);if(Oa(n))return n}}setProperty(e,r,i){let n=this.featureCount;if(this._checkBatchId(e),Ii(typeof r=="string",r),this._binaryProperties){let a=this._binaryProperties[r];if(a){this._setBinaryProperty(a,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,r,i))return;let s=this._properties[r];Oa(s)||(this._properties[r]=new Array(n),s=this._properties[r]),s[e]=wT(i,!0)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,r){return e.unpack(e.typedArray,r)}_setBinaryProperty(e,r,i){e.pack(i,e.typedArray,r)}_initializeBinaryProperties(){let e=null;for(let r in this._properties){let i=this._properties[r],n=this._initializeBinaryProperty(r,i);n&&(e=e||{},e[r]=n)}return e}_initializeBinaryProperty(e,r){if("byteOffset"in r){let i=r;Ii(this.binary,`Property ${e} requires a batch table binary.`),Ii(i.type,`Property ${e} requires a type.`);let n=VG(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,r){if(!this._hierarchy)return!1;let i=hg(this._hierarchy,e,(n,s)=>{let a=n.classIds[s],c=n.classes[a].instances;return Oa(c[r])});return Oa(i)}_getPropertyNamesInHierarchy(e,r){hg(this._hierarchy,e,(i,n)=>{let s=i.classIds[n],a=i.classes[s].instances;for(let c in a)a.hasOwnProperty(c)&&r.indexOf(c)===-1&&r.push(c)})}_getHierarchyProperty(e,r){return hg(this._hierarchy,e,(i,n)=>{let s=i.classIds[n],a=i.classes[s],c=i.classIndexes[n],h=a.instances[r];return Oa(h)?Oa(h.typedArray)?this._getBinaryProperty(h,c):wT(h[c],!0):null})}_setHierarchyProperty(e,r,i,n){let s=hg(this._hierarchy,r,(a,c)=>{let h=a.classIds[c],p=a.classes[h],x=a.classIndexes[c],T=p.instances[i];return Oa(T)?(Ii(c===r,`Inherited property "${i}" is read-only.`),Oa(T.typedArray)?this._setBinaryProperty(T,x,n):T[x]=wT(n,!0),!0):!1});return Oa(s)}};function Vd(t,e,r=0){let i=new DataView(e);if(t.magic=i.getUint32(r,!0),r+=4,t.version=i.getUint32(r,!0),r+=4,t.byteLength=i.getUint32(r,!0),r+=4,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return r}var fg=4,HG="b3dm tile in legacy format.";function dg(t,e,r){let i=new DataView(e),n;t.header=t.header||{};let s=i.getUint32(r,!0);r+=fg;let a=i.getUint32(r,!0);r+=fg;let c=i.getUint32(r,!0);r+=fg;let h=i.getUint32(r,!0);return r+=fg,c>=570425344?(r-=fg*2,n=s,c=a,h=0,s=0,a=0,console.warn(HG)):h>=570425344&&(r-=fg,n=c,c=s,h=a,s=0,a=0,console.warn(HG)),t.header.featureTableJsonByteLength=s,t.header.featureTableBinaryByteLength=a,t.header.batchTableJsonByteLength=c,t.header.batchTableBinaryByteLength=h,t.header.batchLength=n,r}function pg(t,e,r,i){return r=bme(t,e,r,i),r=vme(t,e,r,i),r}function bme(t,e,r,i){let{featureTableJsonByteLength:n,featureTableBinaryByteLength:s,batchLength:a}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:a||0},n&&n>0){let c=a5(e,r,n);t.featureTableJson=JSON.parse(c)}return r+=n||0,t.featureTableBinary=new Uint8Array(e,r,s),r+=s||0,r}function vme(t,e,r,i){let{batchTableJsonByteLength:n,batchTableBinaryByteLength:s}=t.header||{};if(n&&n>0){let a=a5(e,r,n);t.batchTableJson=JSON.parse(a),r+=n,s&&s>0&&(t.batchTableBinary=new Uint8Array(e,r,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=s)}return r}function f5(t,e,r){if(!e&&(!t||!t.batchIds||!r))return null;let{batchIds:i,isRGB565:n,pointCount:s=0}=t;if(i&&r){let a=new Uint8ClampedArray(s*3);for(let c=0;c<s;c++){let h=i[c],x=r.getProperty(h,"dimensions").map(T=>T*255);a[c*3]=x[0],a[c*3+1]=x[1],a[c*3+2]=x[2]}return{type:bi.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(e&&n){let a=new Uint8ClampedArray(s*3);for(let c=0;c<s;c++){let h=u5(e[c]);a[c*3]=h[0],a[c*3+1]=h[1],a[c*3+2]=h[2]}return{type:bi.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return e&&e.length===s*3?{type:bi.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:bi.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}var WG=new st;function $G(t,e){if(!e)return null;if(t.isOctEncoded16P){let r=new Float32Array((t.pointsLength||0)*3);for(let i=0;i<(t.pointsLength||0);i++)h5(e[i*2],e[i*2+1],WG),WG.toArray(r,i*3);return{type:bi.FLOAT,size:2,value:r}}return{type:bi.FLOAT,size:2,value:e}}function qG(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,wme(t,e)):{type:bi.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function wme(t,e){let r=new st,i=new Float32Array(t.pointCount*3);for(let n=0;n<t.pointCount;n++)r.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,n*3);return i}async function ZG(t,e,r,i,n){r=Vd(t,e,r),r=dg(t,e,r),r=pg(t,e,r,i),Tme(t);let{featureTable:s,batchTable:a}=Eme(t);return await Pme(t,s,a,i,n),Cme(t,s,i),Sme(t,s,a),Ime(t,s),r}function Tme(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function Eme(t){let e=new nf(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",bi.FLOAT,3);let i=Mme(t,e);return{featureTable:e,batchTable:i}}function Cme(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",bi.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){let i=e.getPropertyArray("POSITION_QUANTIZED",bi.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",bi.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",bi.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=qG(t,i,r)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Sme(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",bi.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",bi.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",bi.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=f5(t,i,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",bi.UNSIGNED_BYTE,4))}function Ime(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",bi.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",bi.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=$G(t,r)}}function Mme(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",bi.UNSIGNED_SHORT,1),t.batchIds)){let i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");let{batchTableJson:n,batchTableBinary:s}=t;r=new OA(n,s,i)}return r}async function Pme(t,e,r,i,n){let s,a,c,h=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(c=h.properties);let p=e.getExtension("3DTILES_draco_point_compression");if(p){a=p.properties;let T=p.byteOffset,R=p.byteLength;if(!a||!Number.isFinite(T)||!R)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(t.featureTableBinary||[]).slice(T,T+R),t.hasPositions=Number.isFinite(a.POSITION),t.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),t.hasNormals=Number.isFinite(a.NORMAL),t.hasBatchIds=Number.isFinite(a.BATCH_ID),t.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;let x={buffer:s,properties:{...a,...c},featureTableProperties:a,batchTableProperties:c,dequantizeInShader:!1};return await Rme(t,x,i,n)}async function Rme(t,e,r,i){if(!i)return;let n={...r,draco:{...r?.draco,extraAttributes:e.batchTableProperties||{}}};delete n["3d-tiles"];let s=await el(e.buffer,sT,n,i),a=s.attributes.POSITION&&s.attributes.POSITION.value,c=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,h=s.attributes.NORMAL&&s.attributes.NORMAL.value,p=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,x=a&&s.attributes.POSITION.value.quantization,T=h&&s.attributes.NORMAL.value.quantization;if(x){let k=s.POSITION.data.quantization,j=k.range;t.quantizedVolumeScale=new st(j,j,j),t.quantizedVolumeOffset=new st(k.minValues),t.quantizedRange=(1<<k.quantizationBits)-1,t.isQuantizedDraco=!0}T&&(t.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);let R={};if(e.batchTableProperties)for(let k of Object.keys(e.batchTableProperties))s.attributes[k]&&s.attributes[k].value&&(R[k.toLowerCase()]=s.attributes[k].value);t.attributes={positions:a,colors:f5(t,c,void 0),normals:h,batchIds:p,...R}}var TT={URI:0,EMBEDDED:1};function ET(t,e,r,i){t.rotateYtoZ=!0;let n=(t.byteOffset||0)+(t.byteLength||0)-r;if(n===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i?.["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Lp(e,r,n),t.gltfByteOffset=0,t.gltfByteLength=n,r%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function CT(t,e,r,i){let n=r?.["3d-tiles"]||{};if(Bme(t,e,r),n.loadGLTF){if(!i)return;if(t.gltfUrl){let{fetch:s}=i,a=await s(t.gltfUrl,r);t.gltfArrayBuffer=await a.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){let s=await el(t.gltfArrayBuffer,ef,r,i);t.gltf=PA(s),t.gpuMemoryUsageInBytes=Ux(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function Bme(t,e,r){switch(e){case TT.URI:if(t.gltfArrayBuffer){let i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),s=new TextDecoder().decode(i);t.gltfUrl=s.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case TT.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function XG(t,e,r,i,n){r=Lme(t,e,r,i,n),await CT(t,TT.EMBEDDED,i,n);let s=t?.gltf?.extensions;return s&&s.CESIUM_RTC&&(t.rtcCenter=s.CESIUM_RTC.center),r}function Lme(t,e,r,i,n){r=Vd(t,e,r),r=dg(t,e,r),r=pg(t,e,r,i),r=ET(t,e,r,i);let s=new nf(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",bi.FLOAT,3),r}async function YG(t,e,r,i,n){return r=Ome(t,e,r,i,n),await CT(t,t.gltfFormat||0,i,n),r}function Ome(t,e,r,i,n){if(r=Vd(t,e,r),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=dg(t,e,r);let s=new DataView(e);if(t.gltfFormat=s.getUint32(r,!0),r+=4,r=pg(t,e,r,i),r=ET(t,e,r,i),!t?.header?.featureTableJsonByteLength||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");let a=new nf(t.featureTableJson,t.featureTableBinary),c=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=a.getGlobalProperty("RTC_CENTER",bi.FLOAT,3);let h=new OA(t.batchTableJson,t.batchTableBinary,c);return Dme(t,a,h,c),r}function Dme(t,e,r,i){let n=new Array(i),s=new st,a=new st,c=new st,h=new st,p=new an,x=new Rl,T=new st,R={},k=new Er,j=[],q=[],X=[],re=[];for(let te=0;te<i;te++){let oe;if(e.hasProperty("POSITION"))oe=e.getProperty("POSITION",bi.FLOAT,3,te,s);else if(e.hasProperty("POSITION_QUANTIZED")){oe=e.getProperty("POSITION_QUANTIZED",bi.UNSIGNED_SHORT,3,te,s);let Z=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",bi.FLOAT,3);if(!Z)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");let xe=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",bi.FLOAT,3);if(!xe)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");let _e=65535;for(let Be=0;Be<3;Be++)oe[Be]=oe[Be]/_e*xe[Be]+Z[Be]}if(!oe)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");s.copy(oe),R.translation=s,t.normalUp=e.getProperty("NORMAL_UP",bi.FLOAT,3,te,j),t.normalRight=e.getProperty("NORMAL_RIGHT",bi.FLOAT,3,te,q);let ae=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",bi.UNSIGNED_SHORT,2,te,j),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",bi.UNSIGNED_SHORT,2,te,q),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(Oi.WGS84.eastNorthUpToFixedFrame(s,k),k.getRotationMatrix3(p)):p.identity()}ae&&(h.copy(a).cross(c).normalize(),p.setColumn(0,a),p.setColumn(1,c),p.setColumn(2,h)),x.fromMatrix3(p),R.rotation=x,T.set(1,1,1);let pe=e.getProperty("SCALE",bi.FLOAT,1,te,X);Number.isFinite(pe)&&T.multiplyByScalar(pe);let be=e.getProperty("SCALE_NON_UNIFORM",bi.FLOAT,3,te,j);be&&T.scale(be),R.scale=T;let Fe=e.getProperty("BATCH_ID",bi.UNSIGNED_SHORT,1,te,re);Fe===void 0&&(Fe=te);let Y=new Er().fromQuaternion(R.rotation);k.identity(),k.translate(R.translation),k.multiplyRight(Y),k.scale(R.scale);let J=k.clone();n[te]={modelMatrix:J,batchId:Fe}}t.instances=n}async function KG(t,e,r,i,n,s){r=Vd(t,e,r);let a=new DataView(e);for(t.tilesLength=a.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-r>12;){let c={shape:"tile3d"};t.tiles.push(c),r=await s(e,r,i,n,c)}return r}async function QG(t,e,r,i){if(t.rotateYtoZ=!0,t.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!i)return e.byteLength;let n=await el(e,ef,r,i);t.gltf=PA(n),t.gpuMemoryUsageInBytes=Ux(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function d5(t,e=0,r,i,n={shape:"tile3d"}){switch(n.byteOffset=e,n.type=FG(t,e),n.type){case LA.COMPOSITE:return await KG(n,t,e,r,i,d5);case LA.BATCHED_3D_MODEL:return await XG(n,t,e,r,i);case LA.GLTF:return await QG(n,t,r,i);case LA.INSTANCED_3D_MODEL:return await YG(n,t,e,r,i);case LA.POINT_CLOUD:return await ZG(n,t,e,r,i);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}async function p5(t,e,r){if(new Uint32Array(t.slice(0,4))[0]!==1952609651)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==1)throw new Error("Wrong subtree file verson, must be 1");let s=JG(t.slice(8,16)),a=new Uint8Array(t,24,s),h=new TextDecoder("utf8").decode(a),p=JSON.parse(h),x=JG(t.slice(16,24)),T=new ArrayBuffer(0);if(x&&(T=t.slice(24+s)),await ST(p,p.tileAvailability,T,r),Array.isArray(p.contentAvailability))for(let R of p.contentAvailability)await ST(p,R,T,r);else await ST(p,p.contentAvailability,T,r);return await ST(p,p.childSubtreeAvailability,T,r),p}async function ST(t,e,r,i){let n=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof n!="number")return;let s=t.bufferViews[n],a=t.buffers[s.buffer];if(!i?.baseUrl)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(a.uri){let h=`${i?.baseUrl||""}/${a.uri}`,x=await(await i.fetch(h)).arrayBuffer();e.explicitBitstream=new Uint8Array(x,s.byteOffset,s.byteLength);return}let c=t.buffers.slice(0,s.buffer).reduce((h,p)=>h+p.byteLength,0);e.explicitBitstream=new Uint8Array(r.slice(c,c+a.byteLength),s.byteOffset,s.byteLength)}function JG(t){let e=new DataView(t),r=e.getUint32(0,!0),i=e.getUint32(4,!0);return r+2**32*i}var IT={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:vT,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:p5,options:{}};var zl=null;try{zl=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function In(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}In.prototype.__isLong__;Object.defineProperty(In.prototype,"__isLong__",{value:!0});function Ko(t){return(t&&t.__isLong__)===!0}function eH(t){var e=Math.clz32(t&-t);return t?31-e:e}In.isLong=Ko;var tH={},rH={};function DA(t,e){var r,i,n;return e?(t>>>=0,(n=0<=t&&t<256)&&(i=rH[t],i)?i:(r=Ki(t,0,!0),n&&(rH[t]=r),r)):(t|=0,(n=-128<=t&&t<128)&&(i=tH[t],i)?i:(r=Ki(t,t<0?-1:0,!1),n&&(tH[t]=r),r))}In.fromInt=DA;function Ul(t,e){if(isNaN(t))return e?sf:Vc;if(e){if(t<0)return sf;if(t>=oH)return cH}else{if(t<=-nH)return Da;if(t+1>=nH)return lH}return t<0?Ul(-t,e).neg():Ki(t%mg|0,t/mg|0,e)}In.fromNumber=Ul;function Ki(t,e,r){return new In(t,e,r)}In.fromBits=Ki;var MT=Math.pow;function m5(t,e,r){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(r=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?sf:Vc;if(r=r||10,r<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return m5(t.substring(1),e,r).neg();for(var n=Ul(MT(r,8)),s=Vc,a=0;a<t.length;a+=8){var c=Math.min(8,t.length-a),h=parseInt(t.substring(a,a+c),r);if(c<8){var p=Ul(MT(r,c));s=s.mul(p).add(Ul(h))}else s=s.mul(n),s=s.add(Ul(h))}return s.unsigned=e,s}In.fromString=m5;function Vl(t,e){return typeof t=="number"?Ul(t,e):typeof t=="string"?m5(t,e):Ki(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}In.fromValue=Vl;var iH=65536,Fme=1<<24,mg=iH*iH,oH=mg*mg,nH=oH/2,sH=DA(Fme),Vc=DA(0);In.ZERO=Vc;var sf=DA(0,!0);In.UZERO=sf;var Ag=DA(1);In.ONE=Ag;var aH=DA(1,!0);In.UONE=aH;var A5=DA(-1);In.NEG_ONE=A5;var lH=Ki(-1,2147483647,!1);In.MAX_VALUE=lH;var cH=Ki(-1,-1,!0);In.MAX_UNSIGNED_VALUE=cH;var Da=Ki(0,-2147483648,!1);In.MIN_VALUE=Da;var ir=In.prototype;ir.toInt=function(){return this.unsigned?this.low>>>0:this.low};ir.toNumber=function(){return this.unsigned?(this.high>>>0)*mg+(this.low>>>0):this.high*mg+(this.low>>>0)};ir.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Da)){var r=Ul(e),i=this.div(r),n=i.mul(r).sub(this);return i.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=Ul(MT(e,6),this.unsigned),a=this,c="";;){var h=a.div(s),p=a.sub(h.mul(s)).toInt()>>>0,x=p.toString(e);if(a=h,a.isZero())return x+c;for(;x.length<6;)x="0"+x;c=""+x+c}};ir.getHighBits=function(){return this.high};ir.getHighBitsUnsigned=function(){return this.high>>>0};ir.getLowBits=function(){return this.low};ir.getLowBitsUnsigned=function(){return this.low>>>0};ir.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Da)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;r>0&&!(e&1<<r);r--);return this.high!=0?r+33:r+1};ir.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0};ir.isZero=function(){return this.high===0&&this.low===0};ir.eqz=ir.isZero;ir.isNegative=function(){return!this.unsigned&&this.high<0};ir.isPositive=function(){return this.unsigned||this.high>=0};ir.isOdd=function(){return(this.low&1)===1};ir.isEven=function(){return(this.low&1)===0};ir.equals=function(e){return Ko(e)||(e=Vl(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ir.eq=ir.equals;ir.notEquals=function(e){return!this.eq(e)};ir.neq=ir.notEquals;ir.ne=ir.notEquals;ir.lessThan=function(e){return this.comp(e)<0};ir.lt=ir.lessThan;ir.lessThanOrEqual=function(e){return this.comp(e)<=0};ir.lte=ir.lessThanOrEqual;ir.le=ir.lessThanOrEqual;ir.greaterThan=function(e){return this.comp(e)>0};ir.gt=ir.greaterThan;ir.greaterThanOrEqual=function(e){return this.comp(e)>=0};ir.gte=ir.greaterThanOrEqual;ir.ge=ir.greaterThanOrEqual;ir.compare=function(e){if(Ko(e)||(e=Vl(e)),this.eq(e))return 0;var r=this.isNegative(),i=e.isNegative();return r&&!i?-1:!r&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ir.comp=ir.compare;ir.negate=function(){return!this.unsigned&&this.eq(Da)?Da:this.not().add(Ag)};ir.neg=ir.negate;ir.add=function(e){Ko(e)||(e=Vl(e));var r=this.high>>>16,i=this.high&65535,n=this.low>>>16,s=this.low&65535,a=e.high>>>16,c=e.high&65535,h=e.low>>>16,p=e.low&65535,x=0,T=0,R=0,k=0;return k+=s+p,R+=k>>>16,k&=65535,R+=n+h,T+=R>>>16,R&=65535,T+=i+c,x+=T>>>16,T&=65535,x+=r+a,x&=65535,Ki(R<<16|k,x<<16|T,this.unsigned)};ir.subtract=function(e){return Ko(e)||(e=Vl(e)),this.add(e.neg())};ir.sub=ir.subtract;ir.multiply=function(e){if(this.isZero())return this;if(Ko(e)||(e=Vl(e)),zl){var r=zl.mul(this.low,this.high,e.low,e.high);return Ki(r,zl.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?sf:Vc;if(this.eq(Da))return e.isOdd()?Da:Vc;if(e.eq(Da))return this.isOdd()?Da:Vc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(sH)&&e.lt(sH))return Ul(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,n=this.high&65535,s=this.low>>>16,a=this.low&65535,c=e.high>>>16,h=e.high&65535,p=e.low>>>16,x=e.low&65535,T=0,R=0,k=0,j=0;return j+=a*x,k+=j>>>16,j&=65535,k+=s*x,R+=k>>>16,k&=65535,k+=a*p,R+=k>>>16,k&=65535,R+=n*x,T+=R>>>16,R&=65535,R+=s*p,T+=R>>>16,R&=65535,R+=a*h,T+=R>>>16,R&=65535,T+=i*x+n*p+s*h+a*c,T&=65535,Ki(k<<16|j,T<<16|R,this.unsigned)};ir.mul=ir.multiply;ir.divide=function(e){if(Ko(e)||(e=Vl(e)),e.isZero())throw Error("division by zero");if(zl){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?zl.div_u:zl.div_s)(this.low,this.high,e.low,e.high);return Ki(r,zl.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?sf:Vc;var i,n,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return sf;if(e.gt(this.shru(1)))return aH;s=sf}else{if(this.eq(Da)){if(e.eq(Ag)||e.eq(A5))return Da;if(e.eq(Da))return Ag;var a=this.shr(1);return i=a.div(e).shl(1),i.eq(Vc)?e.isNegative()?Ag:A5:(n=this.sub(e.mul(i)),s=i.add(n.div(e)),s)}else if(e.eq(Da))return this.unsigned?sf:Vc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=Vc}for(n=this;n.gte(e);){i=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var c=Math.ceil(Math.log(i)/Math.LN2),h=c<=48?1:MT(2,c-48),p=Ul(i),x=p.mul(e);x.isNegative()||x.gt(n);)i-=h,p=Ul(i,this.unsigned),x=p.mul(e);p.isZero()&&(p=Ag),s=s.add(p),n=n.sub(x)}return s};ir.div=ir.divide;ir.modulo=function(e){if(Ko(e)||(e=Vl(e)),zl){var r=(this.unsigned?zl.rem_u:zl.rem_s)(this.low,this.high,e.low,e.high);return Ki(r,zl.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ir.mod=ir.modulo;ir.rem=ir.modulo;ir.not=function(){return Ki(~this.low,~this.high,this.unsigned)};ir.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};ir.clz=ir.countLeadingZeros;ir.countTrailingZeros=function(){return this.low?eH(this.low):eH(this.high)+32};ir.ctz=ir.countTrailingZeros;ir.and=function(e){return Ko(e)||(e=Vl(e)),Ki(this.low&e.low,this.high&e.high,this.unsigned)};ir.or=function(e){return Ko(e)||(e=Vl(e)),Ki(this.low|e.low,this.high|e.high,this.unsigned)};ir.xor=function(e){return Ko(e)||(e=Vl(e)),Ki(this.low^e.low,this.high^e.high,this.unsigned)};ir.shiftLeft=function(e){return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ki(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Ki(0,this.low<<e-32,this.unsigned)};ir.shl=ir.shiftLeft;ir.shiftRight=function(e){return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ki(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Ki(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ir.shr=ir.shiftRight;ir.shiftRightUnsigned=function(e){return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ki(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Ki(this.high,0,this.unsigned):Ki(this.high>>>e-32,0,this.unsigned)};ir.shru=ir.shiftRightUnsigned;ir.shr_u=ir.shiftRightUnsigned;ir.rotateLeft=function(e){var r;return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ki(this.high,this.low,this.unsigned):e<32?(r=32-e,Ki(this.low<<e|this.high>>>r,this.high<<e|this.low>>>r,this.unsigned)):(e-=32,r=32-e,Ki(this.high<<e|this.low>>>r,this.low<<e|this.high>>>r,this.unsigned))};ir.rotl=ir.rotateLeft;ir.rotateRight=function(e){var r;return Ko(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ki(this.high,this.low,this.unsigned):e<32?(r=32-e,Ki(this.high<<r|this.low>>>e,this.low<<r|this.high>>>e,this.unsigned)):(e-=32,r=32-e,Ki(this.low<<r|this.high>>>e,this.high<<r|this.low>>>e,this.unsigned))};ir.rotr=ir.rotateRight;ir.toSigned=function(){return this.unsigned?Ki(this.low,this.high,!1):this};ir.toUnsigned=function(){return this.unsigned?this:Ki(this.low,this.high,!0)};ir.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ir.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ir.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]};In.fromBytes=function(e,r,i){return i?In.fromBytesLE(e,r):In.fromBytesBE(e,r)};In.fromBytesLE=function(e,r){return new In(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)};In.fromBytesBE=function(e,r){return new In(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)};typeof BigInt=="function"&&(In.fromBigInt=function(e,r){var i=Number(BigInt.asIntN(32,e)),n=Number(BigInt.asIntN(32,e>>BigInt(32)));return Ki(i,n,r)},In.fromValue=function(e,r){return typeof e=="bigint"?fromBigInt(e,r):Vl(e,r)},ir.toBigInt=function(){var e=BigInt(this.low>>>0),r=BigInt(this.unsigned?this.high>>>0:this.high);return r<<BigInt(32)|e});var gg=In;var kme=16;function Yx(t){t==="X"&&(t="");let e=t.padEnd(kme,"0");return gg.fromString(e,!0,16)}function g5(t){if(t.isZero())return"X";let e=t.countTrailingZeros(),r=e%4;e=(e-r)/4;let i=e;e*=4;let s=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-s.length).join("0")+s}function _5(t,e){let r=Nme(t).shiftRightUnsigned(2);return t.add(gg.fromNumber(2*e+1-4).multiply(r))}function Nme(t){return t.and(t.not().add(1))}var zme=3,Ume=30,Vme=2*Ume+1,uH=180/Math.PI;function fH(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);let e=t.split("/"),r=parseInt(e[0],10),i=e[1],n=i.length,s=0,a=[0,0];for(let c=n-1;c>=0;c--){s=n-c;let h=i[c],p=0,x=0;h==="1"?x=1:h==="2"?(p=1,x=1):h==="3"&&(p=1);let T=Math.pow(2,s-1);jme(T,a,p,x),a[0]+=T*p,a[1]+=T*x}if(r%2===1){let c=a[0];a[0]=a[1],a[1]=c}return{face:r,ij:a,level:s}}function dH(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<zme+Vme;)e="0"+e;let r=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,r),s=n.length/2,a=gg.fromString(i,!0,2).toString(10),c="";if(s!==0)for(c=gg.fromString(n,!0,2).toString(4);c.length<s;)c="0"+c;return`${a}/${c}`}function y5(t,e,r){let i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function hH(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function x5(t){return[hH(t[0]),hH(t[1])]}function b5(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function v5([t,e,r]){let i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*uH,i*uH]}function jme(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}function pH(t){let e=y5(t.ij,t.level,[.5,.5]),r=x5(e),i=b5(t.face,r);return v5(i)}var Gme=100;function w5(t){let{face:e,ij:r,level:i}=t,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(Gme*Math.pow(2,-i))),a=new Float64Array(4*s*2+2),c=0,h=0;for(let p=0;p<4;p++){let x=n[p].slice(0),T=n[p+1],R=(T[0]-x[0])/s,k=(T[1]-x[1])/s;for(let j=0;j<s;j++){x[0]+=R,x[1]+=k;let q=y5(r,i,x),X=x5(q),re=b5(e,X),te=v5(re);Math.abs(te[1])>89.999&&(te[0]=h);let oe=te[0]-h;te[0]+=oe>180?-360:oe<-180?360:0,a[c++]=te[0],a[c++]=te[1],h=te[0]}}return a[c++]=a[0],a[c++]=a[1],a}function _g(t){let e=Hme(t);return fH(e)}function Hme(t){if(t.indexOf("/")>0)return t;let e=Yx(t);return dH(e)}function T5(t){let e=_g(t);return pH(e)}function mH(t){let e;if(t.face===2||t.face===5){let r=null,i=0;for(let n=0;n<4;n++){let s=`${t.face}/${n}`,a=_g(s),c=w5(a);(typeof r>"u"||r===null)&&(r=new Float64Array(4*c.length)),r.set(c,i),i+=c.length}e=AH(r)}else{let r=w5(t);e=AH(r)}return e}function AH(t){if(t.length%2!==0)throw new Error("Invalid corners");let e=[],r=[];for(let i=0;i<t.length;i+=2)e.push(t[i]),r.push(t[i+1]);return e.sort((i,n)=>i-n),r.sort((i,n)=>i-n),{west:e[0],east:e[e.length-1],north:r[r.length-1],south:r[0]}}function E5(t,e){let r=e?.minimumHeight||0,i=e?.maximumHeight||0,n=_g(t),s=mH(n),a=s.west,c=s.south,h=s.east,p=s.north,x=[];return x.push(new st(a,p,r)),x.push(new st(h,p,r)),x.push(new st(h,c,r)),x.push(new st(a,c,r)),x.push(new st(a,p,i)),x.push(new st(h,p,i)),x.push(new st(h,c,i)),x.push(new st(a,c,i)),x}function PT(t){let e=t.token,r={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},i=E5(e,r),n=T5(e),s=n[0],a=n[1],c=Oi.WGS84.cartographicToCartesian([s,a,r.maximumHeight]),h=new st(c[0],c[1],c[2]);i.push(h);let p=Px(i);return[...p.center,...p.halfAxes]}var Wme=4,$me=8,qme={QUADTREE:Wme,OCTREE:$me};function Zme(t,e,r){if(t?.box){let i=Yx(t.s2VolumeInfo.token),n=_5(i,e),s=g5(n),a={...t.s2VolumeInfo};switch(a.token=s,r){case"OCTREE":let p=t.s2VolumeInfo,x=p.maximumHeight-p.minimumHeight,T=x/2,R=p.minimumHeight+x/2;p.minimumHeight=R-T,p.maximumHeight=R+T;break;default:break}return{box:PT(a),s2VolumeInfo:a}}}async function S5(t){let{subtree:e,subtreeData:r={level:0,x:0,y:0,z:0},parentData:i={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:n=0,implicitOptions:s,loaderOptions:a,s2VolumeBox:c}=t,{subdivisionScheme:h,subtreeLevels:p,maximumLevel:x,contentUrlTemplate:T,subtreesUriTemplate:R,basePath:k}=s,j={children:[],lodMetricValue:0,contentUrl:""};if(!x)return PC.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${T} won't be loaded...`),j;let q=i.localLevel+1,X=r.level+q;if(X>x)return j;let re=qme[h],te=Math.log2(re),oe=n&1,ae=n>>1&1,pe=n>>2&1,be=FA(i.localX,oe,1),Fe=FA(i.localY,ae,1),Y=FA(i.localZ,pe,1),J=FA(r.x,be,q),Z=FA(r.y,Fe,q),xe=FA(r.z,Y,q),_e=FA(i.mortonIndex,n,te),Be=q===p&&C5(e.childSubtreeAvailability,_e),Se,ke,Ye,rt;if(Be){let Zt=`${k}/${R}`,Vt=RT(Zt,X,J,Z,xe);Se=await yo(Vt,IT,a),rt=0,ke={level:X,x:J,y:Z,z:xe},Ye={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Se=e,rt=(re**q-1)/(re-1)+_e,ke=r,Ye={mortonIndex:_e,localLevel:q,localX:be,localY:Fe,localZ:Y};if(!C5(Se.tileAvailability,rt))return j;C5(Se.contentAvailability,rt)&&(j.contentUrl=RT(T,X,J,Z,xe));for(let Zt=0;Zt<re;Zt++){let Vt=Zme(c,Zt,h),cr=await S5({subtree:Se,subtreeData:ke,parentData:Ye,childIndex:Zt,implicitOptions:s,loaderOptions:a,s2VolumeBox:Vt});(cr.contentUrl||cr.children.length)&&j.children.push(cr)}return j.contentUrl||j.children.length?Xme(j,{level:X,x:J,y:Z,z:xe},s,c):j}function C5(t,e){let r;return Array.isArray(t)?(r=t[0],t.length>1&&PC.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=t,"constant"in r?!!r.constant:r.explicitBitstream?Qme(e,r.explicitBitstream):!1}function Xme(t,e,r,i){let{basePath:n,refine:s,getRefine:a,lodMetricType:c,getTileType:h,rootLodMetricValue:p,rootBoundingVolume:x}=r,T=t.contentUrl&&t.contentUrl.replace(`${n}/`,""),R=p/2**e.level,k=i?.box?{box:i.box}:x,j=Yme(k,e,r.subdivisionScheme);return{children:t.children,contentUrl:t.contentUrl,content:{uri:T},id:t.contentUrl,refine:a(s),type:h(t),lodMetricType:c,lodMetricValue:R,geometricError:R,transform:t.transform,boundingVolume:j}}function Yme(t,e,r){if(t.region){let{level:i,x:n,y:s,z:a}=e,[c,h,p,x,T,R]=t.region,k=2**i,j=(p-c)/k,[q,X]=[c+j*n,c+j*(n+1)],re=(x-h)/k,[te,oe]=[h+re*s,h+re*(s+1)],ae,pe;if(r==="OCTREE"){let be=(R-T)/k;[ae,pe]=[T+be*a,T+be*(a+1)]}else[ae,pe]=[T,R];return{region:[q,te,X,oe,ae,pe]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}function FA(t,e,r){return(t<<r)+e}function RT(t,e,r,i,n){let s=Kme({level:e,x:r,y:i,z:n});return t.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function Kme(t){let e={};for(let r in t)e[`{${r}}`]=t[r];return e}function Qme(t,e){let r=Math.floor(t/8),i=t%8;return(e[r]>>i&1)===1}function M5(t,e=""){if(!e)return Nl.EMPTY;let i=e.split("?")[0].split(".").pop();switch(i){case"pnts":return Nl.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Nl.SCENEGRAPH;default:return i||Nl.EMPTY}}function P5(t){switch(t){case"REPLACE":case"replace":return Xo.REPLACE;case"ADD":case"add":return Xo.ADD;default:return t}}function I5(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){let i=new URL(t,`${e}/`);return decodeURI(i.toString())}else if(t.startsWith("/"))return t;return tl.resolve(e,t)}function gH(t,e){if(!t)return null;let r;if(t.content){let n=t.content.uri||t.content?.url;typeof n<"u"&&(r=I5(n,e))}return{...t,id:r,contentUrl:r,lodMetricType:rf.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:M5(t,r),refine:P5(t.refine)}}async function xH(t,e,r){let i=null,n=yH(t.root);n&&t.root?i=await _H(t.root,t,e,n,r):i=gH(t.root,e);let s=[];for(s.push(i);s.length>0;){let a=s.pop()||{},c=a.children||[],h=[];for(let p of c){let x=yH(p),T;x?T=await _H(p,t,e,x,r):T=gH(p,e),T&&(h.push(T),s.push(T))}a.children=h}return i}async function _H(t,e,r,i,n){let{subdivisionScheme:s,maximumLevel:a,availableLevels:c,subtreeLevels:h,subtrees:{uri:p}}=i,x=RT(p,0,0,0,0),T=I5(x,r),R=await yo(T,IT,n),k=t.content?.uri,j=k?I5(k,r):"",q=e?.root?.refine,X=t.geometricError,re=t.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(re){let pe={box:PT(re),s2VolumeInfo:re};t.boundingVolume=pe}let te=t.boundingVolume,oe={contentUrlTemplate:j,subtreesUriTemplate:p,subdivisionScheme:s,subtreeLevels:h,maximumLevel:Number.isFinite(c)?c-1:a,refine:q,basePath:r,lodMetricType:rf.GEOMETRIC_ERROR,rootLodMetricValue:X,rootBoundingVolume:te,getTileType:M5,getRefine:P5};return await Jme(t,r,R,oe,n)}async function Jme(t,e,r,i,n){if(!t)return null;let{children:s,contentUrl:a}=await S5({subtree:r,implicitOptions:i,loaderOptions:n}),c,h=null;return a&&(c=a,h={uri:a.replace(`${e}/`,"")}),{...t,id:c,contentUrl:c,lodMetricType:rf.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:M5(t,c),refine:P5(t.refine),content:h||t.content,children:s}}function yH(t){return t?.extensions?.["3DTILES_implicit_tiling"]||t?.implicitTiling}var BT={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:vT,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:e0e,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function e0e(t,e={},r){let i=e["3d-tiles"]||{},n;return i.isTileset==="auto"?n=r?.url&&r.url.indexOf(".json")!==-1:n=i.isTileset,n?t0e(t,e,r):r0e(t,e,r)}async function t0e(t,e,r){let i=JSON.parse(new TextDecoder().decode(t)),n=r?.url||"",s=i0e(n),a=await xH(i,s,e||{});return{...i,shape:"tileset3d",loader:BT,url:n,queryString:r?.queryString||"",basePath:s,root:a||i.root,type:To.TILES3D,lodMetricType:rf.GEOMETRIC_ERROR,lodMetricValue:i.root?.geometricError||0}}async function r0e(t,e,r){let i={content:{shape:"tile3d",featureIds:null}};return await d5(t,0,e,r,i.content),i.content}function i0e(t){return tl.dirname(t)}var bH=[0],n0e={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:BT,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,r)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}},Kx=class extends ss{initializeState(){"onTileLoadFail"in this.props&&ur.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:r,changeFlags:i}){if(e.data&&e.data!==r.data&&this._loadTileset(e.data),i.viewportChanged){let{activeViewports:n}=this.state;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(i.propsChanged){let{layerMap:n}=this.state;for(let s in n)n[s].needsUpdate=!0}}activateViewport(e){let{activeViewports:r,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,r[e.id]=e;let n=i?.[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:r}){let i=r&&r.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:r}){let{tile:i}=e.props,{id:n}=r;return i.selected&&i.viewportIds.includes(n)}_updateAutoHighlight(e){let r=e.sourceTile,i=this.state.layerMap[r?.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){let{loadOptions:r={}}=this.props,i=this.props.loader||this.props.loaders,n=Array.isArray(i)?i[0]:i,s={loadOptions:{...r}},a=e;if(n.preload){let p=await n.preload(e,r);p.url&&(a=p.url),p.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:p.headers}),Object.assign(s,p)}let c=await yo(a,n,s.loadOptions),h=new Xx(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:h,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(h)}_onTileLoad(e){let{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(e),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;let{tileset3d:r}=this.state,{timeline:i}=this.context,n=Object.keys(e).length;!i||!n||!r||r.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,r){if(!e.content)return null;switch(e.type){case Nl.POINTCLOUD:return this._makePointCloudLayer(e,r);case Nl.SCENEGRAPH:return this._make3DModelLayer(e);case Nl.MESH:return this._makeSimpleMeshLayer(e,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,r){let{attributes:i,pointCount:n,constantRGBA:s,cartographicOrigin:a,modelMatrix:c}=e.content,{positions:h,normals:p,colors:x}=i;if(!h)return null;let T=r&&r.props.data||{header:{vertexCount:n},attributes:{POSITION:h,NORMAL:p,COLOR_0:x}},{pointSize:R,getPointColor:k}=this.props,j=this.getSubLayerClass("pointcloud",zw);return new j({pointSize:R},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:T,coordinateSystem:Tr.METER_OFFSETS,coordinateOrigin:a,modelMatrix:c,getColor:s||k,_offset:0})}_make3DModelLayer(e){let{gltf:r,instances:i,cartographicOrigin:n,modelMatrix:s}=e.content,a=this.getSubLayerClass("scenegraph",qP);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:i||bH,scenegraph:r,coordinateSystem:Tr.METER_OFFSETS,coordinateOrigin:n,modelMatrix:s,getTransformMatrix:c=>c.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,r){let i=e.content,{attributes:n,indices:s,modelMatrix:a,cartographicOrigin:c,coordinateSystem:h=Tr.METER_OFFSETS,material:p,featureIds:x}=i,{_getMeshColor:T}=this.props,R=r&&r.props.mesh||new Qi({topology:"triangle-list",attributes:s0e(n),indices:s}),k=this.getSubLayerClass("mesh",Jj);return new k(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:R,data:bH,getColor:T(e),pbrMaterial:p,modelMatrix:a,coordinateOrigin:c,coordinateSystem:h,featureIds:x,_offset:0})}renderLayers(){let{tileset3d:e,layerMap:r}=this.state;return e?e.tiles.map(i=>{let n=r[i.id]=r[i.id]||{tile:i},{layer:s}=n;return i.selected&&(s?n.needsUpdate&&(s=this._getSubLayer(i,s),n.needsUpdate=!1):s=this._getSubLayer(i)),n.layer=s,s}).filter(Boolean):null}};Kx.defaultProps=n0e;Kx.layerName="Tile3DLayer";var vH=Kx;function s0e(t){let e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}var o0e=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function R5(t){return t>>1^-(t&1)}function a0e(t){let e=0,r={};for(let[i,n]of o0e){let s=n===8?t.getFloat64:t.getFloat32;r[i]=s.call(t,e,!0),e+=n}return{header:r,headerEndPosition:e}}function l0e(t,e){let r=e,i=3,n=t.getUint32(r,!0),s=new Uint16Array(n*i);r+=Uint32Array.BYTES_PER_ELEMENT;let a=Uint16Array.BYTES_PER_ELEMENT,c=n*a,h=r,p=h+c,x=p+c,T=0,R=0,k=0;for(let j=0;j<n;j++)T+=R5(t.getUint16(h+a*j,!0)),R+=R5(t.getUint16(p+a*j,!0)),k+=R5(t.getUint16(x+a*j,!0)),s[j]=T,s[j+n]=R,s[j+n*2]=k;return r+=c*3,{vertexData:s,vertexDataEndPosition:r}}function Qx(t,e,r,i,n=!0){let s;if(i===2?s=new Uint16Array(t,e,r):s=new Uint32Array(t,e,r),!n)return s;let a=0;for(let c=0;c<s.length;++c){let h=s[c];s[c]=a-h,h===0&&++a}return s}function c0e(t,e,r){let i=r,n=3,a=e.length/n>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;i%a!==0&&(i+=a-i%a);let c=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let h=c*3,p=Qx(t.buffer,i,h,a);return i+=h*a,{triangleIndicesEndPosition:i,triangleIndices:p}}function u0e(t,e,r){let i=r,n=3,a=e.length/n>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,c=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let h=Qx(t.buffer,i,c,a,!1);i+=c*a;let p=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let x=Qx(t.buffer,i,p,a,!1);i+=p*a;let T=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let R=Qx(t.buffer,i,T,a,!1);i+=T*a;let k=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let j=Qx(t.buffer,i,k,a,!1);return i+=k*a,{edgeIndicesEndPosition:i,westIndices:h,southIndices:x,eastIndices:R,northIndices:j}}function h0e(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function f0e(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function d0e(t,e){let r={};if(t.byteLength<=e)return{extensions:r,extensionsEndPosition:e};let i=e;for(;i<t.byteLength;){let n=t.getUint8(i,!0);i+=Uint8Array.BYTES_PER_ELEMENT;let s=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let a=new DataView(t.buffer,i,s);switch(n){case 1:{r.vertexNormals=h0e(a);break}case 2:{r.waterMask=f0e(a);break}default:}i+=s}return{extensions:r,extensionsEndPosition:i}}var kA={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},p0e={maxDecodingStep:kA.extensions};function B5(t,e){let r=Object.assign({},p0e,e),i=new DataView(t),{header:n,headerEndPosition:s}=a0e(i);if(r.maxDecodingStep<kA.vertices)return{header:n};let{vertexData:a,vertexDataEndPosition:c}=l0e(i,s);if(r.maxDecodingStep<kA.triangleIndices)return{header:n,vertexData:a};let{triangleIndices:h,triangleIndicesEndPosition:p}=c0e(i,a,c);if(r.maxDecodingStep<kA.edgeIndices)return{header:n,vertexData:a,triangleIndices:h};let{westIndices:x,southIndices:T,eastIndices:R,northIndices:k,edgeIndicesEndPosition:j}=u0e(i,a,p);if(r.maxDecodingStep<kA.extensions)return{header:n,vertexData:a,triangleIndices:h,westIndices:x,northIndices:k,eastIndices:R,southIndices:T};let{extensions:q}=d0e(i,j);return{header:n,vertexData:a,triangleIndices:h,westIndices:x,northIndices:k,eastIndices:R,southIndices:T,extensions:q}}function LT(t,e,r,i){let n=i?m0e(i,t.POSITION.value):A0e(e),s=new t.POSITION.value.constructor(n.length*6),a=new t.TEXCOORD_0.value.constructor(n.length*4),c=new e.constructor(n.length*6);for(let p=0;p<n.length;p++){let x=n[p];g0e({edge:x,edgeIndex:p,attributes:t,skirtHeight:r,newPosition:s,newTexcoord0:a,newTriangles:c})}t.POSITION.value=O_(t.POSITION.value,s),t.TEXCOORD_0.value=O_(t.TEXCOORD_0.value,a);let h=e instanceof Array?e.concat(c):O_(e,c);return{attributes:t,triangles:h}}function A0e(t){let e=[];for(let n=0;n<t.length;n+=3)e.push([t[n],t[n+1]]),e.push([t[n+1],t[n+2]]),e.push([t[n+2],t[n]]);e.sort((n,s)=>Math.min(...n)-Math.min(...s)||Math.max(...n)-Math.max(...s));let r=[],i=0;for(;i<e.length;)e[i][0]===e[i+1]?.[1]&&e[i][1]===e[i+1]?.[0]?i+=2:(r.push(e[i]),i++);return r}function m0e(t,e){t.westIndices.sort((i,n)=>e[3*i+1]-e[3*n+1]),t.eastIndices.sort((i,n)=>e[3*n+1]-e[3*i+1]),t.southIndices.sort((i,n)=>e[3*n]-e[3*i]),t.northIndices.sort((i,n)=>e[3*i]-e[3*n]);let r=[];for(let i in t){let n=t[i];for(let s=0;s<n.length-1;s++)r.push([n[s],n[s+1]])}return r}function g0e({edge:t,edgeIndex:e,attributes:r,skirtHeight:i,newPosition:n,newTexcoord0:s,newTriangles:a}){let c=r.POSITION.value.length,h=e*2,p=e*2+1;n.set(r.POSITION.value.subarray(t[0]*3,t[0]*3+3),h*3),n[h*3+2]=n[h*3+2]-i,n.set(r.POSITION.value.subarray(t[1]*3,t[1]*3+3),p*3),n[p*3+2]=n[p*3+2]-i,s.set(r.TEXCOORD_0.value.subarray(t[0]*2,t[0]*2+2),h*2),s.set(r.TEXCOORD_0.value.subarray(t[1]*2,t[1]*2+2),p*2);let x=e*2*3;a[x]=t[0],a[x+1]=c/3+p,a[x+2]=t[1],a[x+3]=c/3+p,a[x+4]=t[0],a[x+5]=c/3+h}function L5(t,e={}){let{bounds:r}=e,{header:i,vertexData:n,triangleIndices:s,westIndices:a,northIndices:c,eastIndices:h,southIndices:p}=B5(t,kA.triangleIndices),x=s,T=_0e(n,i,r),R=Fh(T);if(e?.skirtHeight){let{attributes:k,triangles:j}=LT(T,x,e.skirtHeight,{westIndices:a,northIndices:c,eastIndices:h,southIndices:p});T=k,x=j}return{loaderData:{header:{}},header:{vertexCount:x.length,boundingBox:R},schema:void 0,topology:"triangle-list",mode:4,indices:{value:x,size:1},attributes:T}}function _0e(t,e,r){let{minHeight:i,maxHeight:n}=e,[s,a,c,h]=r||[0,0,1,1],p=c-s,x=h-a,T=n-i,R=t.length/3,k=new Float32Array(R*3),j=new Float32Array(R*2);for(let q=0;q<R;q++){let X=t[q]/32767,re=t[q+R]/32767,te=t[q+R*2]/32767;k[3*q+0]=X*p+s,k[3*q+1]=re*x+a,k[3*q+2]=te*T+i,j[2*q+0]=X,j[2*q+1]=re}return{POSITION:{value:k,size:3},TEXCOORD_0:{value:j,size:2}}}var Jx=class{constructor(e=257){this.gridSize=e;let r=e-1;if(r&r-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=r*r*2-2,this.numParentTriangles=this.numTriangles-r*r,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let i=0;i<this.numTriangles;i++){let n=i+2,s=0,a=0,c=0,h=0,p=0,x=0;for(n&1?c=h=p=r:s=a=x=r;(n>>=1)>1;){let R=s+c>>1,k=a+h>>1;n&1?(c=s,h=a,s=p,a=x):(s=c,a=h,c=p,h=x),p=R,x=k}let T=i*4;this.coords[T+0]=s,this.coords[T+1]=a,this.coords[T+2]=c,this.coords[T+3]=h}}createTile(e){return new O5(e,this)}},O5=class{constructor(e,r){let i=r.gridSize;if(e.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${e.length}.`);this.terrain=e,this.martini=r,this.errors=new Float32Array(e.length),this.update()}update(){let{numTriangles:e,numParentTriangles:r,coords:i,gridSize:n}=this.martini,{terrain:s,errors:a}=this;for(let c=e-1;c>=0;c--){let h=c*4,p=i[h+0],x=i[h+1],T=i[h+2],R=i[h+3],k=p+T>>1,j=x+R>>1,q=k+j-x,X=j+p-k,re=(s[x*n+p]+s[R*n+T])/2,te=j*n+k,oe=Math.abs(re-s[te]);if(a[te]=Math.max(a[te],oe),c<r){let ae=(x+X>>1)*n+(p+q>>1),pe=(R+X>>1)*n+(T+q>>1);a[te]=Math.max(a[te],a[ae],a[pe])}}}getMesh(e=0){let{gridSize:r,indices:i}=this.martini,{errors:n}=this,s=0,a=0,c=r-1;i.fill(0);function h(k,j,q,X,re,te){let oe=k+q>>1,ae=j+X>>1;Math.abs(k-re)+Math.abs(j-te)>1&&n[ae*r+oe]>e?(h(re,te,k,j,oe,ae),h(q,X,re,te,oe,ae)):(i[j*r+k]=i[j*r+k]||++s,i[X*r+q]=i[X*r+q]||++s,i[te*r+re]=i[te*r+re]||++s,a++)}h(0,0,c,c,c,0),h(c,c,0,0,0,c);let p=new Uint16Array(s*2),x=new Uint32Array(a*3),T=0;function R(k,j,q,X,re,te){let oe=k+q>>1,ae=j+X>>1;if(Math.abs(k-re)+Math.abs(j-te)>1&&n[ae*r+oe]>e)R(re,te,k,j,oe,ae),R(q,X,re,te,oe,ae);else{let pe=i[j*r+k]-1,be=i[X*r+q]-1,Fe=i[te*r+re]-1;p[2*pe]=k,p[2*pe+1]=j,p[2*be]=q,p[2*be+1]=X,p[2*Fe]=re,p[2*Fe+1]=te,x[T++]=pe,x[T++]=be,x[T++]=Fe}}return R(0,0,c,c,c,0),R(c,c,0,0,0,c),{vertices:p,triangles:x}}};var e2=class{constructor(e,r,i=r){this.data=e,this.width=r,this.height=i,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;let n=r-1,s=i-1,a=this._addPoint(0,0),c=this._addPoint(n,0),h=this._addPoint(0,s),p=this._addPoint(n,s),x=this._addTriangle(p,a,h,-1,-1,-1);this._addTriangle(a,p,c,x,-1,-1),this._flush()}run(e=1){for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,r){return this.data[this.width*r+e]}_flush(){let e=this.coords;for(let r=0;r<this._pendingLen;r++){let i=this._pending[r],n=2*this.triangles[i*3+0],s=2*this.triangles[i*3+1],a=2*this.triangles[i*3+2];this._findCandidate(e[n],e[n+1],e[s],e[s+1],e[a],e[a+1],i)}this._pendingLen=0}_findCandidate(e,r,i,n,s,a,c){let h=Math.min(e,i,s),p=Math.min(r,n,a),x=Math.max(e,i,s),T=Math.max(r,n,a),R=NA(i,n,s,a,h,p),k=NA(s,a,e,r,h,p),j=NA(e,r,i,n,h,p),q=n-r,X=e-i,re=a-n,te=i-s,oe=r-a,ae=s-e,pe=NA(e,r,i,n,s,a),be=this.heightAt(e,r)/pe,Fe=this.heightAt(i,n)/pe,Y=this.heightAt(s,a)/pe,J=0,Z=0,xe=0,_e=0;for(let Be=p;Be<=T;Be++){let Se=0;R<0&&re!==0&&(Se=Math.max(Se,Math.floor(-R/re))),k<0&&oe!==0&&(Se=Math.max(Se,Math.floor(-k/oe))),j<0&&q!==0&&(Se=Math.max(Se,Math.floor(-j/q)));let ke=R+re*Se,Ye=k+oe*Se,rt=j+q*Se,tt=!1;for(let _t=h+Se;_t<=x;_t++){if(ke>=0&&Ye>=0&&rt>=0){tt=!0;let Zt=be*ke+Fe*Ye+Y*rt,Vt=Math.abs(Zt-this.heightAt(_t,Be));_e+=Vt*Vt,Vt>J&&(J=Vt,Z=_t,xe=Be)}else if(tt)break;ke+=re,Ye+=oe,rt+=q}R+=te,k+=ae,j+=X}(Z===e&&xe===r||Z===i&&xe===n||Z===s&&xe===a)&&(J=0),this._candidates[2*c]=Z,this._candidates[2*c+1]=xe,this._rms[c]=_e,this._queuePush(c,J,_e)}_step(){let e=this._queuePop(),r=e*3+0,i=e*3+1,n=e*3+2,s=this.triangles[r],a=this.triangles[i],c=this.triangles[n],h=this.coords[2*s],p=this.coords[2*s+1],x=this.coords[2*a],T=this.coords[2*a+1],R=this.coords[2*c],k=this.coords[2*c+1],j=this._candidates[2*e],q=this._candidates[2*e+1],X=this._addPoint(j,q);if(NA(h,p,x,T,j,q)===0)this._handleCollinear(X,r);else if(NA(x,T,R,k,j,q)===0)this._handleCollinear(X,i);else if(NA(R,k,h,p,j,q)===0)this._handleCollinear(X,n);else{let re=this._halfedges[r],te=this._halfedges[i],oe=this._halfedges[n],ae=this._addTriangle(s,a,X,re,-1,-1,r),pe=this._addTriangle(a,c,X,te,-1,ae+1),be=this._addTriangle(c,s,X,oe,ae+2,pe+1);this._legalize(ae),this._legalize(pe),this._legalize(be)}}_addPoint(e,r){let i=this.coords.length>>1;return this.coords.push(e,r),i}_addTriangle(e,r,i,n,s,a,c=this.triangles.length){let h=c/3;return this.triangles[c+0]=e,this.triangles[c+1]=r,this.triangles[c+2]=i,this._halfedges[c+0]=n,this._halfedges[c+1]=s,this._halfedges[c+2]=a,n>=0&&(this._halfedges[n]=c+0),s>=0&&(this._halfedges[s]=c+1),a>=0&&(this._halfedges[a]=c+2),this._candidates[2*h+0]=0,this._candidates[2*h+1]=0,this._queueIndices[h]=-1,this._rms[h]=0,this._pending[this._pendingLen++]=h,c}_legalize(e){let r=this._halfedges[e];if(r<0)return;let i=e-e%3,n=r-r%3,s=i+(e+1)%3,a=i+(e+2)%3,c=n+(r+2)%3,h=n+(r+1)%3,p=this.triangles[a],x=this.triangles[e],T=this.triangles[s],R=this.triangles[c],k=this.coords;if(!y0e(k[2*p],k[2*p+1],k[2*x],k[2*x+1],k[2*T],k[2*T+1],k[2*R],k[2*R+1]))return;let j=this._halfedges[s],q=this._halfedges[a],X=this._halfedges[c],re=this._halfedges[h];this._queueRemove(i/3),this._queueRemove(n/3);let te=this._addTriangle(p,R,T,-1,X,j,i),oe=this._addTriangle(R,p,x,te,q,re,n);this._legalize(te+1),this._legalize(oe+2)}_handleCollinear(e,r){let i=r-r%3,n=i+(r+1)%3,s=i+(r+2)%3,a=this.triangles[s],c=this.triangles[r],h=this.triangles[n],p=this._halfedges[n],x=this._halfedges[s],T=this._halfedges[r];if(T<0){let be=this._addTriangle(e,a,c,-1,x,-1,i),Fe=this._addTriangle(a,e,h,be,-1,p);this._legalize(be+1),this._legalize(Fe+2);return}let R=T-T%3,k=R+(T+2)%3,j=R+(T+1)%3,q=this.triangles[k],X=this._halfedges[k],re=this._halfedges[j];this._queueRemove(R/3);let te=this._addTriangle(a,c,e,x,-1,-1,i),oe=this._addTriangle(c,q,e,re,-1,te+1,R),ae=this._addTriangle(q,h,e,X,-1,oe+1),pe=this._addTriangle(h,a,e,p,te+2,ae+1);this._legalize(te),this._legalize(oe),this._legalize(ae),this._legalize(pe)}_queuePush(e,r,i){let n=this._queue.length;this._queueIndices[e]=n,this._queue.push(e),this._errors.push(r),this._rmsSum+=i,this._queueUp(n)}_queuePop(){let e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){let e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){let r=this._queueIndices[e];if(r<0){let n=this._pending.indexOf(e);if(n!==-1)this._pending[n]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}let i=this._queue.length-1;i!==r&&(this._queueSwap(r,i),this._queueDown(r,i)||this._queueUp(r)),this._queuePopBack()}_queueLess(e,r){return this._errors[e]>this._errors[r]}_queueSwap(e,r){let i=this._queue[e],n=this._queue[r];this._queue[e]=n,this._queue[r]=i,this._queueIndices[i]=r,this._queueIndices[n]=e;let s=this._errors[e];this._errors[e]=this._errors[r],this._errors[r]=s}_queueUp(e){let r=e;for(;;){let i=r-1>>1;if(i===r||!this._queueLess(r,i))break;this._queueSwap(i,r),r=i}}_queueDown(e,r){let i=e;for(;;){let n=2*i+1;if(n>=r||n<0)break;let s=n+1,a=n;if(s<r&&this._queueLess(s,n)&&(a=s),!this._queueLess(a,i))break;this._queueSwap(i,a),i=a}return i>e}};function NA(t,e,r,i,n,s){return(r-n)*(e-s)-(i-s)*(t-n)}function y0e(t,e,r,i,n,s,a,c){let h=t-a,p=e-c,x=r-a,T=i-c,R=n-a,k=s-c,j=h*h+p*p,q=x*x+T*T,X=R*R+k*k;return h*(T*X-q*k)-p*(x*X-q*R)+j*(x*k-T*R)<0}function EH(t,e){let{meshMaxError:r,bounds:i,elevationDecoder:n}=e,{data:s,width:a,height:c}=t,h,p;switch(e.tesselator){case"martini":h=OT(s,a,c,n,e.tesselator),p=wH(r,a,h);break;case"delatin":h=OT(s,a,c,n,e.tesselator),p=TH(r,a,c,h);break;default:a===c&&!(c&a-1)?(h=OT(s,a,c,n,"martini"),p=wH(r,a,h)):(h=OT(s,a,c,n,"delatin"),p=TH(r,a,c,h));break}let{vertices:x}=p,{triangles:T}=p,R=x0e(x,h,a,c,i),k=Fh(R);if(e.skirtHeight){let{attributes:j,triangles:q}=LT(R,T,e.skirtHeight);R=j,T=q}return{loaderData:{header:{}},header:{vertexCount:T.length,boundingBox:k},mode:4,indices:{value:Uint32Array.from(T),size:1},attributes:R}}function wH(t,e,r){let i=e+1,s=new Jx(i).createTile(r),{vertices:a,triangles:c}=s.getMesh(t);return{vertices:a,triangles:c}}function TH(t,e,r,i){let n=new e2(i,e+1,r+1);n.run(t);let{coords:s,triangles:a}=n;return{vertices:s,triangles:a}}function OT(t,e,r,i,n){let{rScaler:s,bScaler:a,gScaler:c,offset:h}=i,p=new Float32Array((e+1)*(r+1));for(let x=0,T=0;T<r;T++)for(let R=0;R<e;R++,x++){let k=x*4,j=t[k+0],q=t[k+1],X=t[k+2];p[x+T]=j*s+q*c+X*a+h}if(n==="martini"){for(let x=(e+1)*e,T=0;T<e;T++,x++)p[x]=p[x-e-1];for(let x=r,T=0;T<r+1;T++,x+=r+1)p[x]=p[x-1]}return p}function x0e(t,e,r,i,n){let s=r+1,a=t.length/2,c=new Float32Array(a*3),h=new Float32Array(a*2),[p,x,T,R]=n||[0,0,r,i],k=(T-p)/r,j=(R-x)/i;for(let q=0;q<a;q++){let X=t[q*2],re=t[q*2+1],te=re*s+X;c[3*q+0]=X*k+p,c[3*q+1]=-re*j+R,c[3*q+2]=e[te],h[2*q+0]=X/r,h[2*q+1]=re/i}return{POSITION:{value:c,size:3},TEXCOORD_0:{value:h,size:2}}}var DT="4.3.2";var FT={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:DT,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};var CH={dataType:null,batchType:null,name:"Quantized Mesh",id:"quantized-mesh",module:"terrain",version:DT,worker:!0,extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{bounds:[0,0,1,1],skirtHeight:null}}};var b0e={...FT,parse:v0e};async function v0e(t,e,r){let i={...e,mimeType:"application/x.image",image:{...e?.image,type:"data"}},n=await el(t,[],i,r),s={...b0e.options.terrain,...e?.terrain};return EH(n,s)}var vet={...CH,parseSync:(t,e)=>L5(t,e?.["quantized-mesh"]),parse:async(t,e)=>L5(t,e?.["quantized-mesh"])};var SH=[1],w0e={...TA.defaultProps,elevationData:Fd,texture:{...Fd,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[FT]};function IH(t){return Array.isArray(t)?t.join(";"):t||""}var t2=class extends ss{updateState({props:e,oldProps:r}){let i=e.elevationData!==r.elevationData;if(i){let{elevationData:s}=e,a=s&&(Array.isArray(s)||s.includes("{x}")&&s.includes("{y}"));this.setState({isTiled:a})}let n=i||e.meshMaxError!==r.meshMaxError||e.elevationDecoder!==r.elevationDecoder||e.bounds!==r.bounds;if(!this.state.isTiled&&n){let s=this.loadTerrain(e);this.setState({terrain:s})}e.workerUrl&&ur.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:r,elevationDecoder:i,meshMaxError:n,signal:s}){if(!e)return null;let a=this.getLoadOptions();a={...a,terrain:{skirtHeight:this.state.isTiled?n*2:0,...a?.terrain,bounds:r,meshMaxError:n,elevationDecoder:i}};let{fetch:c}=this.props;return c(e,{propName:"elevationData",layer:this,loadOptions:a,signal:s})}getTiledTerrainData(e){let{elevationData:r,fetch:i,texture:n,elevationDecoder:s,meshMaxError:a}=this.props,{viewport:c}=this.context,h=Ku(r,e),p=n&&Ku(n,e),{signal:x}=e,T=[0,0],R=[0,0];if(c.isGeospatial){let X=e.bbox;T=c.projectFlat([X.west,X.south]),R=c.projectFlat([X.east,X.north])}else{let X=e.bbox;T=[X.left,X.bottom],R=[X.right,X.top]}let k=[T[0],T[1],R[0],R[1]],j=this.loadTerrain({elevationData:h,bounds:k,elevationDecoder:s,meshMaxError:a,signal:x}),q=p?i(p,{propName:"texture",layer:this,loaders:[],signal:x}).catch(X=>null):Promise.resolve(null);return Promise.all([j,q])}renderSubLayers(e){let r=this.getSubLayerClass("mesh",eg),{color:i,wireframe:n,material:s}=this.props,{data:a}=e;if(!a)return null;let[c,h]=a;return new r(e,{data:SH,mesh:c,texture:h,_instanced:!1,coordinateSystem:Tr.CARTESIAN,getPosition:p=>[0,0,0],getColor:i,wireframe:n,material:s})}onViewportLoad(e){if(!e)return;let{zRange:r}=this.state,i=e.map(a=>a.content).filter(Boolean).map(a=>a[0].header.boundingBox.map(h=>h[2]));if(i.length===0)return;let n=Math.min(...i.map(a=>a[0])),s=Math.max(...i.map(a=>a[1]));(!r||n<r[0]||s>r[1])&&this.setState({zRange:[n,s]})}renderLayers(){let{color:e,material:r,elevationData:i,texture:n,wireframe:s,meshMaxError:a,elevationDecoder:c,tileSize:h,maxZoom:p,minZoom:x,extent:T,maxRequests:R,onTileLoad:k,onTileUnload:j,onTileError:q,maxCacheSize:X,maxCacheByteSize:re,refinementStrategy:te}=this.props;if(this.state.isTiled)return new TA(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:IH(i),texture:IH(n),meshMaxError:a,elevationDecoder:c}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:h,maxZoom:p,minZoom:x,extent:T,maxRequests:R,onTileLoad:k,onTileUnload:j,onTileError:q,maxCacheSize:X,maxCacheByteSize:re,refinementStrategy:te});if(!i)return null;let oe=this.getSubLayerClass("mesh",eg);return new oe(this.getSubLayerProps({id:"mesh"}),{data:SH,mesh:this.state.terrain,texture:n,_instanced:!1,getPosition:ae=>[0,0,0],getColor:e,material:r,wireframe:s})}};t2.defaultProps=w0e;t2.layerName="TerrainLayer";var MH=t2;var T0e={clipBounds:[0,0,1,1],clipByInstance:void 0},PH=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,E0e={name:"clip",vs:PH,uniformTypes:{bounds:"vec4<f32>"}},C0e={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},S0e={name:"clip",fs:PH,uniformTypes:{bounds:"vec4<f32>"}},I0e={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`},r2=class extends YM{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[E0e],inject:C0e}:{modules:[S0e],inject:I0e}}draw(){let{clipBounds:e}=this.props,r={};if(this.state.clipByInstance)r.bounds=e;else{let i=this.projectPosition([e[0],e[1],0]),n=this.projectPosition([e[2],e[3],0]);r.bounds=[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[0],n[0]),Math.max(i[1],n[1])]}this.setShaderModuleProps({clip:r})}};r2.defaultProps=T0e;r2.extensionName="ClipExtension";var D5=r2;function N5(t,e,r){let i=M0e(t),n=Object.keys(i).filter(s=>i[s]!==Array);return P0e(t,{propArrayTypes:i,...e},{numericPropKeys:r&&r.numericPropKeys||n,PositionDataType:r?r.PositionDataType:Float32Array,triangulate:r?r.triangulate:!0})}function M0e(t){let e={};for(let r of t)if(r.properties)for(let i in r.properties){let n=r.properties[i];e[i]=F0e(n,e[i])}return e}function P0e(t,e,r){let{pointPositionsCount:i,pointFeaturesCount:n,linePositionsCount:s,linePathsCount:a,lineFeaturesCount:c,polygonPositionsCount:h,polygonObjectsCount:p,polygonRingsCount:x,polygonFeaturesCount:T,propArrayTypes:R,coordLength:k}=e,{numericPropKeys:j=[],PositionDataType:q=Float32Array,triangulate:X=!0}=r,re=t[0]&&"id"in t[0],te=t.length>65535?Uint32Array:Uint16Array,oe={type:"Point",positions:new q(i*k),globalFeatureIds:new te(i),featureIds:n>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},ae={type:"LineString",pathIndices:s>65535?new Uint32Array(a+1):new Uint16Array(a+1),positions:new q(s*k),globalFeatureIds:new te(s),featureIds:c>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},pe={type:"Polygon",polygonIndices:h>65535?new Uint32Array(p+1):new Uint16Array(p+1),primitivePolygonIndices:h>65535?new Uint32Array(x+1):new Uint16Array(x+1),positions:new q(h*k),globalFeatureIds:new te(h),featureIds:T>65535?new Uint32Array(h):new Uint16Array(h),numericProps:{},properties:[],fields:[]};X&&(pe.triangles=[]);for(let Fe of[oe,ae,pe])for(let Y of j){let J=R[Y];Fe.numericProps[Y]=new J(Fe.positions.length/k)}ae.pathIndices[a]=s,pe.polygonIndices[p]=h,pe.primitivePolygonIndices[x]=h;let be={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(let Fe of t){let Y=Fe.geometry,J=Fe.properties||{};switch(Y.type){case"Point":R0e(Y,oe,be,k,J),oe.properties.push(k5(J,j)),re&&oe.fields.push({id:Fe.id}),be.pointFeature++;break;case"LineString":B0e(Y,ae,be,k,J),ae.properties.push(k5(J,j)),re&&ae.fields.push({id:Fe.id}),be.lineFeature++;break;case"Polygon":L0e(Y,pe,be,k,J),pe.properties.push(k5(J,j)),re&&pe.fields.push({id:Fe.id}),be.polygonFeature++;break;default:throw new Error("Invalid geometry type")}be.feature++}return D0e(oe,ae,pe,k)}function R0e(t,e,r,i,n){e.positions.set(t.data,r.pointPosition*i);let s=t.data.length/i;z5(e,n,r.pointPosition,s),e.globalFeatureIds.fill(r.feature,r.pointPosition,r.pointPosition+s),e.featureIds.fill(r.pointFeature,r.pointPosition,r.pointPosition+s),r.pointPosition+=s}function B0e(t,e,r,i,n){e.positions.set(t.data,r.linePosition*i);let s=t.data.length/i;z5(e,n,r.linePosition,s),e.globalFeatureIds.fill(r.feature,r.linePosition,r.linePosition+s),e.featureIds.fill(r.lineFeature,r.linePosition,r.linePosition+s);for(let a=0,c=t.indices.length;a<c;++a){let h=t.indices[a],p=a===c-1?t.data.length:t.indices[a+1];e.pathIndices[r.linePath++]=r.linePosition,r.linePosition+=(p-h)/i}}function L0e(t,e,r,i,n){e.positions.set(t.data,r.polygonPosition*i);let s=t.data.length/i;z5(e,n,r.polygonPosition,s),e.globalFeatureIds.fill(r.feature,r.polygonPosition,r.polygonPosition+s),e.featureIds.fill(r.polygonFeature,r.polygonPosition,r.polygonPosition+s);for(let a=0,c=t.indices.length;a<c;++a){let h=r.polygonPosition;e.polygonIndices[r.polygonObject++]=h;let p=t.areas[a],x=t.indices[a],T=t.indices[a+1];for(let k=0,j=x.length;k<j;++k){let q=x[k],X=k===j-1?T===void 0?t.data.length:T[0]:x[k+1];e.primitivePolygonIndices[r.polygonRing++]=r.polygonPosition,r.polygonPosition+=(X-q)/i}let R=r.polygonPosition;O0e(e,p,x,{startPosition:h,endPosition:R,coordLength:i})}}function O0e(t,e,r,{startPosition:i,endPosition:n,coordLength:s}){if(!t.triangles)return;let a=i*s,c=n*s,h=t.positions.subarray(a,c),p=r[0],x=r.slice(1).map(R=>(R-p)/s),T=h4(h,x,s,e);for(let R=0,k=T.length;R<k;++R)t.triangles.push(i+T[R])}function F5(t,e){let r={};for(let i in t)r[i]={value:t[i],size:e};return r}function D0e(t,e,r,i){let n={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:F5(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:F5(e.numericProps,1)},polygons:{...r,positions:{value:r.positions,size:i},polygonIndices:{value:r.polygonIndices,size:1},primitivePolygonIndices:{value:r.primitivePolygonIndices,size:1},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:F5(r.numericProps,1)}};return n.polygons&&r.triangles&&(n.polygons.triangles={value:new Uint32Array(r.triangles),size:1}),n}function z5(t,e,r,i){for(let n in t.numericProps)if(n in e){let s=e[n];t.numericProps[n].fill(s,r,r+i)}}function k5(t,e){let r={};for(let i in t)e.includes(i)||(r[i]=t[i]);return r}function F0e(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function zT(t,e){let r=e?.globalFeatureId;return r!==void 0?k0e(t,r):N0e(t,e?.type)}function k0e(t,e){let r=BH(t);for(let i of r){let n=0,s=i.featureIds.value[0];for(let a=0;a<i.featureIds.value.length;a++){let c=i.featureIds.value[a];if(c!==s){if(e===i.globalFeatureIds.value[n])return kT(i,n,a);n=a,s=c}}if(e===i.globalFeatureIds.value[n])return kT(i,n,i.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function N0e(t,e){let r=BH(t,e);return z0e(r)}function RH(t,e,r){switch(t.type){case"Point":return G0e(t,e,r);case"LineString":return j0e(t,e,r);case"Polygon":return LH(t,e,r);default:let i=t;throw new Error(`Unsupported geometry type: ${i?.type}`)}}function BH(t,e){let r=[];return t.points&&(t.points.type="Point",r.push(t.points)),t.lines&&(t.lines.type="LineString",r.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",r.push(t.polygons)),r}function z0e(t){let e=[];for(let r of t){if(r.featureIds.value.length===0)continue;let i=0,n=r.featureIds.value[0];for(let s=0;s<r.featureIds.value.length;s++){let a=r.featureIds.value[s];a!==n&&(e.push(kT(r,i,s)),i=s,n=a)}e.push(kT(r,i,r.featureIds.value.length))}return e}function kT(t,e,r){let i=RH(t,e,r),n=V0e(t,e,r),s=U0e(t,e,r);return{type:"Feature",geometry:i,properties:n,...s}}function U0e(t,e=0,r){return t.fields&&t.fields[t.featureIds.value[e]]}function V0e(t,e=0,r){let i=Object.assign({},t.properties[t.featureIds.value[e]]);for(let n in t.numericProps)i[n]=t.numericProps[n].value[e];return i}function LH(t,e=-1/0,r=1/0){let{positions:i}=t,n=t.polygonIndices.value.filter(h=>h>=e&&h<=r),s=t.primitivePolygonIndices.value.filter(h=>h>=e&&h<=r);if(!(n.length>2)){let h=[];for(let p=0;p<s.length-1;p++){let x=s[p],T=s[p+1],R=NT(i,x,T);h.push(R)}return{type:"Polygon",coordinates:h}}let c=[];for(let h=0;h<n.length-1;h++){let p=n[h],x=n[h+1],T=LH(t,p,x).coordinates;c.push(T)}return{type:"MultiPolygon",coordinates:c}}function j0e(t,e=-1/0,r=1/0){let{positions:i}=t,n=t.pathIndices.value.filter(c=>c>=e&&c<=r);if(!(n.length>2))return{type:"LineString",coordinates:NT(i,n[0],n[1])};let a=[];for(let c=0;c<n.length-1;c++){let h=NT(i,n[c],n[c+1]);a.push(h)}return{type:"MultiLineString",coordinates:a}}function G0e(t,e,r){let{positions:i}=t,n=NT(i,e,r);return n.length>1?{type:"MultiPoint",coordinates:n}:{type:"Point",coordinates:n[0]}}function NT(t,e,r){e=e||0,r=r||t.value.length/t.size;let i=[];for(let n=e;n<r;n++){let s=Array();for(let a=n*t.size;a<(n+1)*t.size;a++)s.push(Number(t.value[a]));i.push(s)}return i}var W5=_l(UH(),1);function age(t){let e=0;for(let r=0,i=t.length-1,n,s;r<t.length;i=r++)n=t[r],s=t[i],e+=(s[0]-n[0])*(n[1]+s[1]);return e}function j5(t,e){if(Array.isArray(t[0])){for(let i of t)j5(i,e);return}let r=t;r[0]/=e,r[1]/=e}function VH(t,e){for(let r=0;r<t.length;++r)t[r]/=e}function G5(t,e,r){if(typeof t[0][0]!="number"){for(let a of t)G5(a,e,r);return}let i=r*Math.pow(2,e.z),n=r*e.x,s=r*e.y;for(let a=0;a<t.length;a++){let c=t[a];c[0]=(c[0]+n)*360/i-180;let h=180-(c[1]+s)*360/i;c[1]=360/Math.PI*Math.atan(Math.exp(h*Math.PI/180))-90}}function jH(t,e,r){let{x:i,y:n,z:s}=e,a=r*Math.pow(2,s),c=r*i,h=r*n;for(let p=0,x=t.length;p<x;p+=2){t[p]=(t[p]+c)*360/a-180;let T=180-(t[p+1]+h)*360/a;t[p+1]=360/Math.PI*Math.atan(Math.exp(T*Math.PI/180))-90}}function GH(t){let e=t.length;if(e<=1)return[t];let r=[],i,n;for(let s=0;s<e;s++){let a=age(t[s]);a!==0&&(n===void 0&&(n=a<0),n===a<0?(i&&r.push(i),i=[t[s]]):i&&i.push(t[s]))}return i&&r.push(i),r}function HH(t){let e=t.indices.length,r="Polygon";if(e<=1)return{type:r,data:t.data,areas:[[Sd(t.data)]],indices:[t.indices]};let i=[],n=[],s=[],a=[],c,h=0;for(let p,x=0,T;x<e;x++){T=t.indices[x]-h,p=t.indices[x+1]-h||t.data.length;let R=t.data.slice(T,p),k=Sd(R);if(k===0){let j=t.data.slice(0,T),q=t.data.slice(p);t.data=j.concat(q),h+=p-T;continue}c===void 0&&(c=k<0),c===k<0?(a.length&&(i.push(s),n.push(a)),a=[T],s=[k]):(s.push(k),a.push(T))}return s&&i.push(s),a.length&&n.push(a),{type:r,areas:i,indices:n,data:t.data}}var bg=class{properties;extent;type;id;_pbf;_geometry;_keys;_values;_geometryInfo;static types=["Unknown","Point","LineString","Polygon"];constructor(e,r,i,n,s,a){this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=n,this._values=s,this._geometryInfo=a,e.readFields(lge,this,r)}toGeoJSONFeature(e,r){let i=this.loadGeometry();switch(e){case"wgs84":return WH(this,i,n=>G5(n,r,this.extent));default:return WH(this,i,j5)}}toBinaryFeature(e,r){let i=this.loadFlatGeometry();switch(e){case"wgs84":return this._toBinaryCoordinates(i,n=>jH(n,r,this.extent));default:return this._toBinaryCoordinates(i,VH)}}bbox(){let e=this._pbf;e.pos=this._geometry;let r=e.readVarint()+e.pos,i=1,n=0,s=0,a=0,c=1/0,h=-1/0,p=1/0,x=-1/0;for(;e.pos<r;){if(n<=0){let T=e.readVarint();i=T&7,n=T>>3}if(n--,i===1||i===2)s+=e.readSVarint(),a+=e.readSVarint(),s<c&&(c=s),s>h&&(h=s),a<p&&(p=a),a>x&&(x=a);else if(i!==7)throw new Error(`unknown command ${i}`)}return[c,p,h,x]}_toBinaryCoordinates(e,r){let i;r(e.data,this.extent);let n=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=e.indices.length,i={type:"Point",...e};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=e.indices.length,this._geometryInfo.linePositionsCount+=e.data.length/n,i={type:"LineString",...e};break;case 3:i=HH(e),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(let a of i.indices)this._geometryInfo.polygonRingsCount+=a.length;this._geometryInfo.polygonPositionsCount+=i.data.length/n;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}let s={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(s.id=this.id),s}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let r=e.readVarint()+e.pos,i=1,n=0,s=0,a=0,c=[],h;for(;e.pos<r;){if(n<=0){let p=e.readVarint();i=p&7,n=p>>3}switch(n--,i){case 1:case 2:s+=e.readSVarint(),a+=e.readSVarint(),i===1&&(h&&c.push(h),h=[]),h&&h.push([s,a]);break;case 7:h&&h.push(h[0].slice());break;default:throw new Error(`unknown command ${i}`)}}return h&&c.push(h),c}loadFlatGeometry(){let e=this._pbf;e.pos=this._geometry;let r=e.readVarint()+e.pos,i=1,n,s=0,a=0,c=0,h=0,p=[],x=[];for(;e.pos<r;)if(s<=0&&(n=e.readVarint(),i=n&7,s=n>>3),s--,i===1||i===2)a+=e.readSVarint(),c+=e.readSVarint(),i===1&&p.push(h),x.push(a,c),h+=2;else if(i===7){if(h>0){let T=p[p.length-1];x.push(x[T],x[T+1]),h+=2}}else throw new Error(`unknown command ${i}`);return{data:x,indices:p}}};function WH(t,e,r){let i=bg.types[t.type],n,s,a;switch(t.type){case 1:let h=[];for(n=0;n<e.length;n++)h[n]=e[n][0];a=h,r(a,t.extent);break;case 2:for(a=e,n=0;n<a.length;n++)r(a[n],t.extent);break;case 3:for(a=GH(e),n=0;n<a.length;n++)for(s=0;s<a[n].length;s++)r(a[n][s],t.extent);break;default:throw new Error("illegal vector tile type")}a.length===1?a=a[0]:i=`Multi${i}`;let c={type:"Feature",geometry:{type:i,coordinates:a},properties:t.properties};return t.id!==null&&(c.properties||={},c.properties.id=t.id),c}function lge(t,e,r){e&&r&&(t===1?e.id=r.readVarint():t===2?cge(r,e):t===3?e.type=r.readVarint():t===4&&(e._geometry=r.pos))}function cge(t,e){let r=t.readVarint()+t.pos;for(;t.pos<r;){let i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}var jT=class{version;name;extent;length;_pbf;_keys;_values;_features;constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(uge,this,r),this.length=this._features.length}getGeoJSONFeature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let r=this._pbf.readVarint()+this._pbf.pos;return new bg(this._pbf,r,this.extent,this._keys,this._values)}getBinaryFeature(e,r){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let i=this._pbf.readVarint()+this._pbf.pos;return new bg(this._pbf,i,this.extent,this._keys,this._values,r)}};function uge(t,e,r){e&&r&&(t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(hge(r)))}function hge(t){let e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){let i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}var i2=class{layers;constructor(e,r){this.layers=e.readFields(fge,{},r)}};function fge(t,e,r){if(t===3&&r){let i=new jT(r,r.readVarint()+r.pos);i.length&&e&&(e[i.name]=i)}}function $5(t,e){let r=pge(e),i=e?.gis?.format||e?.mvt?.shape||e?.shape;switch(i){case"columnar-table":return{shape:"columnar-table",data:H5(t,r)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:$H(t,r)};case"geojson":return $H(t,r);case"binary-geometry":return H5(t,r);case"binary":return H5(t,r);default:throw new Error(i||"undefined shape")}}function H5(t,e){let[r,i]=dge(t,e),n=N5(r,i);return n.byteLength=t.byteLength,n}function dge(t,e){let r=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[r,i];let n=new i2(new W5.default(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(n.layers)).forEach(a=>{let c=n.layers[a];if(c)for(let h=0;h<c.length;h++){let p=c.getBinaryFeature(h,i),x=mge(p,e,a);r.push(x)}}),[r,i]}function $H(t,e){if(t.byteLength<=0)return[];let r=[],i=new i2(new W5.default(t));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(s=>{let a=i.layers[s];if(a)for(let c=0;c<a.length;c++){let h=a.getGeoJSONFeature(c),p=Age(h,e,s);r.push(p)}}),r}function pge(t){if(!t?.mvt)throw new Error("mvt options required");if(t.mvt?.coordinates==="wgs84"&&!t.mvt.tileIndex)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.gis&&I_.warn('MVTLoader: "options.gis" is deprecated, use "options.mvt.shape" instead')(),t.mvt}function Age(t,e,r){let i=t.toGeoJSONFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&(i.properties||={},i.properties[e.layerProperty]=r),i}function mge(t,e,r){let i=t.toBinaryFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=r),i}var gge="4.3.2",GT={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:gge,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}},_ge={...GT,parse:async(t,e)=>$5(t,e),parseSync:$5,binary:!0};var yge={Point:qH,MultiPoint:xge,LineString:ZH,MultiLineString:bge,Polygon:XH,MultiPolygon:vge};function qH([t,e],[r,i],n){let s=Do(r[0],i[0],t),a=Do(r[1],i[1],e);return n.unprojectFlat([s,a])}function q5(t,e,r){return t.map(i=>qH(i,e,r))}function xge(t,e,r){return q5(t,e,r)}function ZH(t,e,r){return q5(t,e,r)}function bge(t,e,r){return t.map(i=>ZH(i,e,r))}function XH(t,e,r){return t.map(i=>q5(i,e,r))}function vge(t,e,r){return t.map(i=>XH(i,e,r))}function YH(t,e,r){let i=r.projectFlat([e.west,e.north]),n=r.projectFlat([e.east,e.south]),s=[i,n];return{...t,coordinates:yge[t.type](t.coordinates,s,r)}}var wge=["points","lines","polygons"];function Z5(t,e,r,i){for(let n of wge){let s=t[n]&&Tge(t[n],e,r,i);if(s>=0)return s}return-1}function Tge(t,e,r,i){let n=t.featureIds.value;if(!n.length)return-1;let s=0,a=n[n.length-1]+1;if(i){let h=Ege(t,i);if(h)s=h[0],a=h[1]+1;else return-1}let c=-1;if(e in t.numericProps){let h=t.numericProps[e].value.findIndex((p,x)=>p===r&&n[x]>=s&&n[x]<a);return h>=0?t.globalFeatureIds.value[h]:-1}else e?c=KH(t.properties,h=>h[e]===r,s,a):t.fields&&(c=KH(t.fields,h=>h.id===r,s,a));return c>=0?Cge(t,c):-1}function Ege(t,e){if(!t.__layers){let r={},{properties:i}=t;for(let n=0;n<i.length;n++){let{layerName:s}=i[n];s&&(r[s]?r[s][1]=n:r[s]=[n,n])}t.__layers=r}return t.__layers[e]}function Cge(t,e){if(!t.__ids){let r=[],i=t.featureIds.value,n=t.globalFeatureIds.value;for(let s=0;s<i.length;s++)r[i[s]]=n[s];t.__ids=r}return t.__ids[e]}function KH(t,e,r,i){for(let n=r;n<i;n++)if(e(t[n],n))return n;return-1}var X5=512,Sge={..._A.defaultProps,data:Fd,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[GT],binary:!0},n2=class extends TA{initializeState(){super.initializeState();let e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:e,oldProps:r,context:i,changeFlags:n}){n.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:e,oldProps:r,context:i,changeFlags:n}),this._setWGS84PropertyForTiles());let{highlightColor:s}=e;s!==r.highlightColor&&Array.isArray(s)&&this.setState({highlightColor:s})}async _updateTileData(){let e=this.props.data,r=null;if(typeof e=="string"&&!oP(e)){let{onDataLoad:i,fetch:n}=this.props;this.setState({data:null,tileJSON:null});try{r=await n(e,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),e=null}i&&i(r,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(r=e);r&&(e=r.tiles),this.setState({data:e,tileJSON:r})}_getTilesetOptions(){let e=super._getTilesetOptions(),r=this.state.tileJSON,{minZoom:i,maxZoom:n}=this.props;return r&&(Number.isFinite(r.minzoom)&&r.minzoom>i&&(e.minZoom=r.minzoom),Number.isFinite(r.maxzoom)&&(!Number.isFinite(n)||r.maxzoom<n)&&(e.maxZoom=r.maxzoom)),e}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(e){let{data:r,binary:i}=this.state,{index:n,signal:s}=e,a=Ku(r,e);if(!a)return Promise.reject("Invalid URL");let c=this.getLoadOptions(),{fetch:h}=this.props;return c={...c,mimeType:"application/x-protobuf",mvt:{...c?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:n},gis:i?{format:"binary"}:{}},h(a,{propName:"data",layer:this,loadOptions:c,signal:s})}renderSubLayers(e){let{x:r,y:i,z:n}=e.tile.index,s=Math.pow(2,n),a=X5/s,c=-a,h=X5*r/s,p=X5*(1-i/s),x=new Er().scale([a,c,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=x,e.coordinateOrigin=[h,p,0],e.coordinateSystem=Tr.CARTESIAN,e.extensions=[...e.extensions||[],new D5]);let T=super.renderSubLayers(e);return this.state.binary&&!(T instanceof _A)&&ur.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),T}_updateAutoHighlight(e){let{uniqueIdProperty:r}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:n}=this.state,s=e.object,a=null,c=null;s&&(a=Y5(s,r),c=QH(s));let{highlightColor:h}=this.props;typeof h=="function"&&(h=h(e)),(i!==a||n!==c)&&this.setState({highlightColor:h,hoveredFeatureId:a,hoveredFeatureLayerName:c})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){let r=super.getPickingInfo(e);if(this.state.binary&&r.index!==-1){let{data:i}=e.sourceLayer.props;r.object=zT(i,{globalFeatureId:r.index})}return r.object&&!this._isWGS84()&&(r.object=eW(r.object,r.tile.bbox,this.context.viewport)),r}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){let{hoveredFeatureId:r,hoveredFeatureLayerName:i,binary:n}=this.state,{uniqueIdProperty:s,highlightedFeatureId:a}=this.props,c=e.content,h=JH(a);if(!(JH(r)||h))return-1;let x=h?a:r;return Array.isArray(c)?c.findIndex(T=>{let R=Y5(T,s)===x,k=h||QH(T)===i;return R&&k}):c&&n?Z5(c,s,x,h?"":i):-1}_pickObjects(e){let{deck:r,viewport:i}=this.context,n=i.width,s=i.height,a=i.x,c=i.y,h=[this.id];return r.pickObjects({x:a,y:c,width:n,height:s,layerIds:h,maxObjects:e})}getRenderedFeatures(e=null){let r=this._pickObjects(e),i=new Set,n=[];for(let s of r){let a=Y5(s.object,this.props.uniqueIdProperty);a===void 0?n.push(s.object):i.has(a)||(i.add(a),n.push(s.object))}return n}_setWGS84PropertyForTiles(){let e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];let{bbox:n}=i;if(i._contentWGS84===void 0&&aP(n)){let s=this.state.binary?zT(i.content):i.content;i._contentWGS84=s.map(a=>eW(a,n,this.context.viewport))}return i._contentWGS84}})})}};n2.layerName="MVTLayer";n2.defaultProps=Sge;var tW=n2;function Y5(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function QH(t){return t.properties?.layerName||null}function JH(t){return t!=null&&t!==""}function eW(t,e,r){let i={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>YH(t.geometry,e,r).coordinates}),i}var rW="0123456789bcdefghjkmnpqrstuvwxyz",iW={};for(let t=0;t<rW.length;t++)iW[rW.charAt(t)]=t;var Ige=-90,Mge=90,Pge=-180,Rge=180;function Bge(t){let e=!0,r=Mge,i=Ige,n=Rge,s=Pge,a,c=0;for(let h=0,p=t.length;h<p;h++){let x=t[h].toLowerCase();c=iW[x];for(let T=4;T>=0;T--){let R=c>>T&1;e?(a=(n+s)/2,R===1?s=a:n=a):(a=(r+i)/2,R===1?i=a:r=a),e=!e}}return[i,s,r,n]}function nW(t){let[e,r,i,n]=Bge(t);return[n,i,n,e,r,e,r,i,n,i]}var Lge={getGeohash:{type:"accessor",value:t=>t.geohash}},s2=class extends Zu{indexToBounds(){let{data:e,getGeohash:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>nW(r(i,n))}}};s2.layerName="GeohashLayer";s2.defaultProps=Lge;var sW=s2;var Oge=function(t,e){let r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},i={on(s,a,c){if(r[s]===void 0)throw new Error(`Invalid event type: ${s}`);r[s].push({selector:a,fn:c})},render(s){e.store.featureChanged(s)}},n=function(s,a){let c=r[s],h=c.length;for(;h--;){let p=c[h];if(p.selector(a)){p.fn.call(i,a)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(i),{render:t.render,stop(){t.stop&&t.stop()},trash(){t.trash&&(t.trash(),e.store.render())},combineFeatures(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures(){t.uncombineFeatures&&t.uncombineFeatures()},drag(s){n("drag",s)},click(s){n("click",s)},mousemove(s){n("mousemove",s)},mousedown(s){n("mousedown",s)},mouseup(s){n("mouseup",s)},mouseout(s){n("mouseout",s)},keydown(s){n("keydown",s)},keyup(s){n("keyup",s)},touchstart(s){n("touchstart",s)},touchmove(s){n("touchmove",s)},touchend(s){n("touchend",s)},tap(s){n("tap",s)}}},o2=Oge;var fW=_l(uW(),1);var Mn={};Es(Mn,{LAT_MAX:()=>Fge,LAT_MIN:()=>Dge,LAT_RENDERED_MAX:()=>$T,LAT_RENDERED_MIN:()=>WT,LNG_MAX:()=>Nge,LNG_MIN:()=>kge,activeStates:()=>Fn,classes:()=>No,cursors:()=>un,events:()=>gs,geojsonTypes:()=>_r,interactions:()=>tR,meta:()=>Yn,modes:()=>si,sources:()=>da,types:()=>so,updateActions:()=>jd});var No={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},da={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},un={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},so={POLYGON:"polygon",LINE:"line_string",POINT:"point"},_r={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},si={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},gs={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},jd={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},Yn={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Fn={ACTIVE:"true",INACTIVE:"false"},tR=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Dge=-90,WT=-85,Fge=90,$T=85,kge=-270,Nge=270;var hW={Point:0,LineString:1,MultiLineString:1,Polygon:2};function zge(t,e){let r=hW[t.geometry.type]-hW[e.geometry.type];return r===0&&t.geometry.type===_r.POLYGON?t.area-e.area:r}function Uge(t){return t.map(e=>(e.geometry.type===_r.POLYGON&&(e.area=fW.default.geometry({type:_r.FEATURE,property:{},geometry:e.geometry})),e)).sort(zge).map(e=>(delete e.area,e))}var qT=Uge;function Vge(t,e=0){return[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}var ZT=Vge;function vg(t){if(this._items={},this._nums={},this._length=t?t.length:0,!!t)for(let e=0,r=t.length;e<r;e++)this.add(t[e]),t[e]!==void 0&&(typeof t[e]=="string"?this._items[t[e]]=e:this._nums[t[e]]=e)}vg.prototype.add=function(t){return this.has(t)?this:(this._length++,typeof t=="string"?this._items[t]=this._length:this._nums[t]=this._length,this)};vg.prototype.delete=function(t){return this.has(t)===!1?this:(this._length--,delete this._items[t],delete this._nums[t],this)};vg.prototype.has=function(t){return typeof t!="string"&&typeof t!="number"?!1:this._items[t]!==void 0||this._nums[t]!==void 0};vg.prototype.values=function(){let t=[];return Object.keys(this._items).forEach(e=>{t.push({k:e,v:this._items[e]})}),Object.keys(this._nums).forEach(e=>{t.push({k:JSON.parse(e),v:this._nums[e]})}),t.sort((e,r)=>e.v-r.v).map(e=>e.k)};vg.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var jl=vg;var jge=[Yn.FEATURE,Yn.MIDPOINT,Yn.VERTEX],jc={click:Gge,touch:Hge};function Gge(t,e,r){return dW(t,e,r,r.options.clickBuffer)}function Hge(t,e,r){return dW(t,e,r,r.options.touchBuffer)}function dW(t,e,r,i){if(r.map===null)return[];let n=t?ZT(t,i):e,s={};r.options.styles&&(s.layers=r.options.styles.map(p=>p.id).filter(p=>r.map.getLayer(p)!=null));let a=r.map.queryRenderedFeatures(n,s).filter(p=>jge.indexOf(p.properties.meta)!==-1),c=new jl,h=[];return a.forEach(p=>{let x=p.properties.id;c.has(x)||(c.add(x),h.push(p))}),qT(h)}function zA(t,e){let r=jc.click(t,null,e),i={mouse:un.NONE};return r[0]&&(i.mouse=r[0].properties.active===Fn.ACTIVE?un.MOVE:un.POINTER,i.feature=r[0].properties.meta),e.events.currentModeName().indexOf("draw")!==-1&&(i.mouse=un.ADD),e.ui.queueMapClasses(i),e.ui.updateMapClasses(),r[0]}function wg(t,e){let r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}var Wge=4,$ge=12,qge=500;function Tg(t,e,r={}){let i=r.fineTolerance!=null?r.fineTolerance:Wge,n=r.grossTolerance!=null?r.grossTolerance:$ge,s=r.interval!=null?r.interval:qge;t.point=t.point||e.point,t.time=t.time||e.time;let a=wg(t.point,e.point);return a<i||a<n&&e.time-t.time<s}var Zge=25,Xge=250;function Eg(t,e,r={}){let i=r.tolerance!=null?r.tolerance:Zge,n=r.interval!=null?r.interval:Xge;return t.point=t.point||e.point,t.time=t.time||e.time,wg(t.point,e.point)<i&&e.time-t.time<n}var pW=(t,e=21)=>(r=e)=>{let i="",n=r|0;for(;n--;)i+=t[Math.random()*t.length|0];return i};var Yge=pW("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function Cg(){return Yge()}var Gd=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||Cg(),this.type=e.geometry.type};Gd.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};Gd.prototype.incomingCoords=function(t){this.setCoordinates(t)};Gd.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()};Gd.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};Gd.prototype.setProperty=function(t,e){this.properties[t]=e};Gd.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:_r.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};Gd.prototype.internal=function(t){let e={id:this.id,meta:Yn.FEATURE,"meta:type":this.type,active:Fn.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(let r in this.properties)e[`user_${r}`]=this.properties[r];return{type:_r.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Gl=Gd;var a2=function(t,e){Gl.call(this,t,e)};a2.prototype=Object.create(Gl.prototype);a2.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};a2.prototype.updateCoordinate=function(t,e,r){arguments.length===3?this.coordinates=[e,r]:this.coordinates=[t,e],this.changed()};a2.prototype.getCoordinate=function(){return this.getCoordinates()};var UA=a2;var VA=function(t,e){Gl.call(this,t,e)};VA.prototype=Object.create(Gl.prototype);VA.prototype.isValid=function(){return this.coordinates.length>1};VA.prototype.addCoordinate=function(t,e,r){this.changed();let i=parseInt(t,10);this.coordinates.splice(i,0,[e,r])};VA.prototype.getCoordinate=function(t){let e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))};VA.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)};VA.prototype.updateCoordinate=function(t,e,r){let i=parseInt(t,10);this.coordinates[i]=[e,r],this.changed()};var jA=VA;var eh=function(t,e){Gl.call(this,t,e),this.coordinates=this.coordinates.map(r=>r.slice(0,-1))};eh.prototype=Object.create(Gl.prototype);eh.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(t=>t.length>2)};eh.prototype.incomingCoords=function(t){this.coordinates=t.map(e=>e.slice(0,-1)),this.changed()};eh.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()};eh.prototype.addCoordinate=function(t,e,r){this.changed();let i=t.split(".").map(s=>parseInt(s,10));this.coordinates[i[0]].splice(i[1],0,[e,r])};eh.prototype.removeCoordinate=function(t){this.changed();let e=t.split(".").map(i=>parseInt(i,10)),r=this.coordinates[e[0]];r&&(r.splice(e[1],1),r.length<3&&this.coordinates.splice(e[0],1))};eh.prototype.getCoordinate=function(t){let e=t.split(".").map(i=>parseInt(i,10)),r=this.coordinates[e[0]];return JSON.parse(JSON.stringify(r[e[1]]))};eh.prototype.getCoordinates=function(){return this.coordinates.map(t=>t.concat([t[0]]))};eh.prototype.updateCoordinate=function(t,e,r){this.changed();let i=t.split("."),n=parseInt(i[0],10),s=parseInt(i[1],10);this.coordinates[n]===void 0&&(this.coordinates[n]=[]),this.coordinates[n][s]=[e,r]};var GA=eh;var Kge={MultiPoint:UA,MultiLineString:jA,MultiPolygon:GA},XT=(t,e,r,i,n)=>{let s=r.split("."),a=parseInt(s[0],10),c=s[1]?s.slice(1).join("."):null;return t[a][e](c,i,n)},Gc=function(t,e){if(Gl.call(this,t,e),delete this.coordinates,this.model=Kge[e.geometry.type],this.model===void 0)throw new TypeError(`${e.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(e.geometry.coordinates)};Gc.prototype=Object.create(Gl.prototype);Gc.prototype._coordinatesToFeatures=function(t){let e=this.model.bind(this);return t.map(r=>new e(this.ctx,{id:Cg(),type:_r.FEATURE,properties:{},geometry:{coordinates:r,type:this.type.replace("Multi","")}}))};Gc.prototype.isValid=function(){return this.features.every(t=>t.isValid())};Gc.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()};Gc.prototype.getCoordinate=function(t){return XT(this.features,"getCoordinate",t)};Gc.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(t=>t.type===_r.POLYGON?t.getCoordinates():t.coordinates)))};Gc.prototype.updateCoordinate=function(t,e,r){XT(this.features,"updateCoordinate",t,e,r),this.changed()};Gc.prototype.addCoordinate=function(t,e,r){XT(this.features,"addCoordinate",t,e,r),this.changed()};Gc.prototype.removeCoordinate=function(t){XT(this.features,"removeCoordinate",t),this.changed()};Gc.prototype.getFeatures=function(){return this.features};var HA=Gc;function gi(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}gi.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)};gi.prototype.setSelectedCoordinates=function(t){this._ctx.store.setSelectedCoordinates(t),t.reduce((e,r)=>(e[r.feature_id]===void 0&&(e[r.feature_id]=!0,this._ctx.store.get(r.feature_id).changed()),e),{})};gi.prototype.getSelected=function(){return this._ctx.store.getSelected()};gi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};gi.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)};gi.prototype.getFeature=function(t){return this._ctx.store.get(t)};gi.prototype.select=function(t){return this._ctx.store.select(t)};gi.prototype.deselect=function(t){return this._ctx.store.deselect(t)};gi.prototype.deleteFeature=function(t,e={}){return this._ctx.store.delete(t,e)};gi.prototype.addFeature=function(t,e={}){return this._ctx.store.add(t,e)};gi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};gi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};gi.prototype.setActionableState=function(t={}){let e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)};gi.prototype.changeMode=function(t,e={},r={}){return this._ctx.events.changeMode(t,e,r)};gi.prototype.fire=function(t,e){return this._ctx.events.fire(t,e)};gi.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)};gi.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)};gi.prototype.featuresAt=function(t,e,r="click"){if(r!=="click"&&r!=="touch")throw new Error("invalid buffer type");return jc[r](t,e,this._ctx)};gi.prototype.newFeature=function(t){let e=t.geometry.type;return e===_r.POINT?new UA(this._ctx,t):e===_r.LINE_STRING?new jA(this._ctx,t):e===_r.POLYGON?new GA(this._ctx,t):new HA(this._ctx,t)};gi.prototype.isInstanceOf=function(t,e){if(t===_r.POINT)return e instanceof UA;if(t===_r.LINE_STRING)return e instanceof jA;if(t===_r.POLYGON)return e instanceof GA;if(t==="MultiFeature")return e instanceof HA;throw new Error(`Unknown feature class: ${t}`)};gi.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)};var AW=gi;gi.prototype.onSetup=function(){};gi.prototype.onDrag=function(){};gi.prototype.onClick=function(){};gi.prototype.onMouseMove=function(){};gi.prototype.onMouseDown=function(){};gi.prototype.onMouseUp=function(){};gi.prototype.onMouseOut=function(){};gi.prototype.onKeyUp=function(){};gi.prototype.onKeyDown=function(){};gi.prototype.onTouchStart=function(){};gi.prototype.onTouchMove=function(){};gi.prototype.onTouchEnd=function(){};gi.prototype.onTap=function(){};gi.prototype.onStop=function(){};gi.prototype.onTrash=function(){};gi.prototype.onCombineFeature=function(){};gi.prototype.onUncombineFeature=function(){};gi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var mW={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Qge=Object.keys(mW);function gW(t){let e=Object.keys(t);return function(r,i={}){let n={},s=e.reduce((c,h)=>(c[h]=t[h],c),new AW(r));function a(c){return h=>s[c](n,h)}return{start(){n=s.onSetup(i),Qge.forEach(c=>{let h=mW[c],p=()=>!1;t[h]&&(p=()=>!0),this.on(c,p,a(h))})},stop(){s.onStop(n)},trash(){s.onTrash(n)},combineFeatures(){s.onCombineFeatures(n)},uncombineFeatures(){s.onUncombineFeatures(n)},render(c,h){s.toDisplayFeatures(n,c,h)}}}}function _W(t){let e=Object.keys(t.options.modes).reduce((R,k)=>(R[k]=gW(t.options.modes[k]),R),{}),r={},i={},n={},s=null,a=null;n.drag=function(R,k){k({point:R.point,time:new Date().getTime()})?(t.ui.queueMapClasses({mouse:un.DRAG}),a.drag(R)):R.originalEvent.stopPropagation()},n.mousedrag=function(R){n.drag(R,k=>!Tg(r,k))},n.touchdrag=function(R){n.drag(R,k=>!Eg(i,k))},n.mousemove=function(R){if((R.originalEvent.buttons!==void 0?R.originalEvent.buttons:R.originalEvent.which)===1)return n.mousedrag(R);let j=zA(R,t);R.featureTarget=j,a.mousemove(R)},n.mousedown=function(R){r={time:new Date().getTime(),point:R.point};let k=zA(R,t);R.featureTarget=k,a.mousedown(R)},n.mouseup=function(R){let k=zA(R,t);R.featureTarget=k,Tg(r,{point:R.point,time:new Date().getTime()})?a.click(R):a.mouseup(R)},n.mouseout=function(R){a.mouseout(R)},n.touchstart=function(R){if(!t.options.touchEnabled)return;i={time:new Date().getTime(),point:R.point};let k=jc.touch(R,null,t)[0];R.featureTarget=k,a.touchstart(R)},n.touchmove=function(R){if(t.options.touchEnabled)return a.touchmove(R),n.touchdrag(R)},n.touchend=function(R){if(R.originalEvent.preventDefault(),!t.options.touchEnabled)return;let k=jc.touch(R,null,t)[0];R.featureTarget=k,Eg(i,{time:new Date().getTime(),point:R.point})?a.tap(R):a.touchend(R)};let c=R=>!(R===8||R===46||R>=48&&R<=57);n.keydown=function(R){(R.srcElement||R.target).classList.contains(No.CANVAS)&&((R.keyCode===8||R.keyCode===46)&&t.options.controls.trash?(R.preventDefault(),a.trash()):c(R.keyCode)?a.keydown(R):R.keyCode===49&&t.options.controls.point?h(si.DRAW_POINT):R.keyCode===50&&t.options.controls.line_string?h(si.DRAW_LINE_STRING):R.keyCode===51&&t.options.controls.polygon&&h(si.DRAW_POLYGON))},n.keyup=function(R){c(R.keyCode)&&a.keyup(R)},n.zoomend=function(){t.store.changeZoom()},n.data=function(R){if(R.dataType==="style"){let{setup:k,map:j,options:q,store:X}=t;q.styles.some(te=>j.getLayer(te.id))||(k.addLayers(),X.setDirty(),X.render())}};function h(R,k,j={}){a.stop();let q=e[R];if(q===void 0)throw new Error(`${R} is not valid`);s=R;let X=q(t,k);a=o2(X,t),j.silent||t.map.fire(gs.MODE_CHANGE,{mode:R}),t.store.setDirty(),t.store.render()}let p={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function x(R){let k=!1;Object.keys(R).forEach(j=>{if(p[j]===void 0)throw new Error("Invalid action type");p[j]!==R[j]&&(k=!0),p[j]=R[j]}),k&&t.map.fire(gs.ACTIONABLE,{actions:p})}return{start(){s=t.options.defaultMode,a=o2(e[s](t),t)},changeMode:h,actionable:x,currentModeName(){return s},currentModeRender(R,k){return a.render(R,k)},fire(R,k){t.map&&t.map.fire(R,k)},addEventListeners(){t.map.on("mousemove",n.mousemove),t.map.on("mousedown",n.mousedown),t.map.on("mouseup",n.mouseup),t.map.on("data",n.data),t.map.on("touchmove",n.touchmove),t.map.on("touchstart",n.touchstart),t.map.on("touchend",n.touchend),t.container.addEventListener("mouseout",n.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",n.keydown),t.container.addEventListener("keyup",n.keyup))},removeEventListeners(){t.map.off("mousemove",n.mousemove),t.map.off("mousedown",n.mousedown),t.map.off("mouseup",n.mouseup),t.map.off("data",n.data),t.map.off("touchmove",n.touchmove),t.map.off("touchstart",n.touchstart),t.map.off("touchend",n.touchend),t.container.removeEventListener("mouseout",n.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",n.keydown),t.container.removeEventListener("keyup",n.keyup))},trash(R){a.trash(R)},combineFeatures(){a.combineFeatures()},uncombineFeatures(){a.uncombineFeatures()},getMode(){return s}}}function Jge(t){return[].concat(t).filter(e=>e!==void 0)}var WA=Jge;function rR(){let t=this;if(!(t.ctx.map&&t.ctx.map.getSource(da.HOT)!==void 0))return h();let r=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:r});let i=[],n=[];t.isDirty?n=t.getAllIds():(i=t.getChangedIds().filter(p=>t.get(p)!==void 0),n=t.sources.hot.filter(p=>p.properties.id&&i.indexOf(p.properties.id)===-1&&t.get(p.properties.id)!==void 0).map(p=>p.properties.id)),t.sources.hot=[];let s=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(p=>{let x=p.properties.id||p.properties.parent;return i.indexOf(x)===-1});let a=s!==t.sources.cold.length||n.length>0;i.forEach(p=>c(p,"hot")),n.forEach(p=>c(p,"cold"));function c(p,x){let R=t.get(p).internal(r);t.ctx.events.currentModeRender(R,k=>{k.properties.mode=r,t.sources[x].push(k)})}a&&t.ctx.map.getSource(da.COLD).setData({type:_r.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(da.HOT).setData({type:_r.FEATURE_COLLECTION,features:t.sources.hot}),h();function h(){t.isDirty=!1,t.clearChangedIds()}}function Pn(t){this._features={},this._featureIds=new jl,this._selectedFeatureIds=new jl,this._selectedCoordinates=[],this._changedFeatureIds=new jl,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]};let e;this.render=()=>{e||(e=requestAnimationFrame(()=>{e=null,rR.call(this),this._emitSelectionChange&&(this.ctx.events.fire(gs.SELECTION_CHANGE,{features:this.getSelected().map(r=>r.toGeoJSON()),points:this.getSelectedCoordinates().map(r=>({type:_r.FEATURE,properties:{},geometry:{type:_r.POINT,coordinates:r.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(gs.RENDER,{})}))},this.isDirty=!1}Pn.prototype.createRenderBatch=function(){let t=this.render,e=0;return this.render=function(){e++},()=>{this.render=t,e>0&&this.render()}};Pn.prototype.setDirty=function(){return this.isDirty=!0,this};Pn.prototype.featureCreated=function(t,e={}){if(this._changedFeatureIds.add(t),(e.silent!=null?e.silent:this.ctx.options.suppressAPIEvents)!==!0){let i=this.get(t);this.ctx.events.fire(gs.CREATE,{features:[i.toGeoJSON()]})}return this};Pn.prototype.featureChanged=function(t,e={}){return this._changedFeatureIds.add(t),(e.silent!=null?e.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(gs.UPDATE,{action:e.action?e.action:jd.CHANGE_COORDINATES,features:[this.get(t).toGeoJSON()]}),this};Pn.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};Pn.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};Pn.prototype.getAllIds=function(){return this._featureIds.values()};Pn.prototype.add=function(t,e={}){return this._features[t.id]=t,this._featureIds.add(t.id),this.featureCreated(t.id,{silent:e.silent}),this};Pn.prototype.delete=function(t,e={}){let r=[];return WA(t).forEach(i=>{this._featureIds.has(i)&&(this._featureIds.delete(i),this._selectedFeatureIds.delete(i),e.silent||r.indexOf(this._features[i])===-1&&r.push(this._features[i].toGeoJSON()),delete this._features[i],this.isDirty=!0)}),r.length&&this.ctx.events.fire(gs.DELETE,{features:r}),yW(this,e),this};Pn.prototype.get=function(t){return this._features[t]};Pn.prototype.getAll=function(){return Object.keys(this._features).map(t=>this._features[t])};Pn.prototype.select=function(t,e={}){return WA(t).forEach(r=>{this._selectedFeatureIds.has(r)||(this._selectedFeatureIds.add(r),this._changedFeatureIds.add(r),e.silent||(this._emitSelectionChange=!0))}),this};Pn.prototype.deselect=function(t,e={}){return WA(t).forEach(r=>{this._selectedFeatureIds.has(r)&&(this._selectedFeatureIds.delete(r),this._changedFeatureIds.add(r),e.silent||(this._emitSelectionChange=!0))}),yW(this,e),this};Pn.prototype.clearSelected=function(t={}){return this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this};Pn.prototype.setSelected=function(t,e={}){return t=WA(t),this.deselect(this._selectedFeatureIds.values().filter(r=>t.indexOf(r)===-1),{silent:e.silent}),this.select(t.filter(r=>!this._selectedFeatureIds.has(r)),{silent:e.silent}),this};Pn.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this};Pn.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};Pn.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};Pn.prototype.getSelected=function(){return this.getSelectedIds().map(t=>this.get(t))};Pn.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(e=>({coordinates:this.get(e.feature_id).getCoordinate(e.coord_path)}))};Pn.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)};Pn.prototype.setFeatureProperty=function(t,e,r,i={}){this.get(t).setProperty(e,r),this.featureChanged(t,{silent:i.silent,action:jd.CHANGE_PROPERTIES})};function yW(t,e={}){let r=t._selectedCoordinates.filter(i=>t._selectedFeatureIds.has(i.feature_id));t._selectedCoordinates.length!==r.length&&!e.silent&&(t._emitSelectionChange=!0),t._selectedCoordinates=r}Pn.prototype.storeMapConfig=function(){tR.forEach(t=>{this.ctx.map[t]&&(this._mapInitialConfig[t]=this.ctx.map[t].isEnabled())})};Pn.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(t=>{this._mapInitialConfig[t]?this.ctx.map[t].enable():this.ctx.map[t].disable()})};Pn.prototype.getInitialConfigValue=function(t){return this._mapInitialConfig[t]!==void 0?this._mapInitialConfig[t]:!0};var e_e=["mode","feature","mouse"];function xW(t){let e={},r=null,i={mode:null,feature:null,mouse:null},n={mode:null,feature:null,mouse:null};function s(){a({mode:null,feature:null,mouse:null}),c()}function a(k){n=Object.assign(n,k)}function c(){if(!t.container)return;let k=[],j=[];e_e.forEach(q=>{n[q]!==i[q]&&(k.push(`${q}-${i[q]}`),n[q]!==null&&j.push(`${q}-${n[q]}`))}),k.length>0&&t.container.classList.remove(...k),j.length>0&&t.container.classList.add(...j),i=Object.assign(i,n)}function h(k,j={}){let q=document.createElement("button");return q.className=`${No.CONTROL_BUTTON} ${j.className}`,q.setAttribute("title",j.title),j.container.appendChild(q),q.addEventListener("click",X=>{if(X.preventDefault(),X.stopPropagation(),X.target===r){p(),j.onDeactivate();return}x(k),j.onActivate()},!0),q}function p(){r&&(r.classList.remove(No.ACTIVE_BUTTON),r=null)}function x(k){p();let j=e[k];j&&j&&k!=="trash"&&(j.classList.add(No.ACTIVE_BUTTON),r=j)}function T(){let k=t.options.controls,j=document.createElement("div");return j.className=`${No.CONTROL_GROUP} ${No.CONTROL_BASE}`,k&&(k[so.LINE]&&(e[so.LINE]=h(so.LINE,{container:j,className:No.CONTROL_BUTTON_LINE,title:`LineString tool ${t.options.keybindings?"(l)":""}`,onActivate:()=>t.events.changeMode(si.DRAW_LINE_STRING),onDeactivate:()=>t.events.trash()})),k[so.POLYGON]&&(e[so.POLYGON]=h(so.POLYGON,{container:j,className:No.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${t.options.keybindings?"(p)":""}`,onActivate:()=>t.events.changeMode(si.DRAW_POLYGON),onDeactivate:()=>t.events.trash()})),k[so.POINT]&&(e[so.POINT]=h(so.POINT,{container:j,className:No.CONTROL_BUTTON_POINT,title:`Marker tool ${t.options.keybindings?"(m)":""}`,onActivate:()=>t.events.changeMode(si.DRAW_POINT),onDeactivate:()=>t.events.trash()})),k.trash&&(e.trash=h("trash",{container:j,className:No.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{t.events.trash()}})),k.combine_features&&(e.combine_features=h("combineFeatures",{container:j,className:No.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{t.events.combineFeatures()}})),k.uncombine_features&&(e.uncombine_features=h("uncombineFeatures",{container:j,className:No.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{t.events.uncombineFeatures()}}))),j}function R(){Object.keys(e).forEach(k=>{let j=e[k];j.parentNode&&j.parentNode.removeChild(j),delete e[k]})}return{setActiveButton:x,queueMapClasses:a,updateMapClasses:c,clearMapClasses:s,addButtons:T,removeButtons:R}}function bW(t){let e=null,r=null,i={onRemove(){return t.map.off("load",i.connect),clearInterval(r),i.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.boxZoomInitial&&t.map.boxZoom.enable(),t.map=null,t.container=null,t.store=null,e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this},connect(){t.map.off("load",i.connect),clearInterval(r),i.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd(n){if(t.map=n,t.events=_W(t),t.ui=xW(t),t.container=n.getContainer(),t.store=new Pn(t),e=t.ui.addButtons(),t.options.boxSelect){t.boxZoomInitial=n.boxZoom.isEnabled(),n.boxZoom.disable();let s=n.dragPan.isEnabled();n.dragPan.disable(),n.dragPan.enable(),s||n.dragPan.disable()}return n.loaded()?i.connect():(n.on("load",i.connect),r=setInterval(()=>{n.loaded()&&i.connect()},16)),t.events.start(),e},addLayers(){t.map.addSource(da.COLD,{data:{type:_r.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(da.HOT,{data:{type:_r.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach(n=>{t.map.addLayer(n)}),t.store.setDirty(!0),t.store.render()},removeLayers(){t.options.styles.forEach(n=>{t.map.getLayer(n.id)&&t.map.removeLayer(n.id)}),t.map.getSource(da.COLD)&&t.map.removeSource(da.COLD),t.map.getSource(da.HOT)&&t.map.removeSource(da.HOT)}};return t.setup=i,i}var iR="#3bb2d0",l2="#fbb03b",vW="#fff",YT=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],l2,iR],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],l2,iR],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":vW}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],l2,iR]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":vW}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":l2}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":l2}}];var XA={};Es(XA,{isActiveFeature:()=>af,isEnterKey:()=>ZA,isEscapeKey:()=>qA,isFeature:()=>QT,isInactiveFeature:()=>KT,isOfMetaType:()=>Sg,isShiftDown:()=>Mg,isShiftMousedown:()=>nR,isTrue:()=>t_e,isVertex:()=>$A,noTarget:()=>Ig});function Sg(t){return function(e){let r=e.featureTarget;return!r||!r.properties?!1:r.properties.meta===t}}function nR(t){return!t.originalEvent||!t.originalEvent.shiftKey?!1:t.originalEvent.button===0}function af(t){return!t.featureTarget||!t.featureTarget.properties?!1:t.featureTarget.properties.active===Fn.ACTIVE&&t.featureTarget.properties.meta===Yn.FEATURE}function KT(t){return!t.featureTarget||!t.featureTarget.properties?!1:t.featureTarget.properties.active===Fn.INACTIVE&&t.featureTarget.properties.meta===Yn.FEATURE}function Ig(t){return t.featureTarget===void 0}function QT(t){return!t.featureTarget||!t.featureTarget.properties?!1:t.featureTarget.properties.meta===Yn.FEATURE}function $A(t){let e=t.featureTarget;return!e||!e.properties?!1:e.properties.meta===Yn.VERTEX}function Mg(t){return t.originalEvent?t.originalEvent.shiftKey===!0:!1}function qA(t){return t.keyCode===27}function ZA(t){return t.keyCode===13}function t_e(){return!0}function th(t,e){this.x=t,this.y=e}th.prototype={clone(){return new th(this.x,this.y)},add(t){return this.clone()._add(t)},sub(t){return this.clone()._sub(t)},multByPoint(t){return this.clone()._multByPoint(t)},divByPoint(t){return this.clone()._divByPoint(t)},mult(t){return this.clone()._mult(t)},div(t){return this.clone()._div(t)},rotate(t){return this.clone()._rotate(t)},rotateAround(t,e){return this.clone()._rotateAround(t,e)},matMult(t){return this.clone()._matMult(t)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(t){return this.x===t.x&&this.y===t.y},dist(t){return Math.sqrt(this.distSqr(t))},distSqr(t){let e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith(t){return this.angleWithSep(t.x,t.y)},angleWithSep(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult(t){let e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add(t){return this.x+=t.x,this.y+=t.y,this},_sub(t){return this.x-=t.x,this.y-=t.y,this},_mult(t){return this.x*=t,this.y*=t,this},_div(t){return this.x/=t,this.y/=t,this},_multByPoint(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint(t){return this.x/=t.x,this.y/=t.y,this},_unit(){return this._div(this.mag()),this},_perp(){let t=this.y;return this.y=this.x,this.x=-t,this},_rotate(t){let e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround(t,e){let r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),s=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=s,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:th};th.convert=function(t){if(t instanceof th)return t;if(Array.isArray(t))return new th(+t[0],+t[1]);if(t.x!==void 0&&t.y!==void 0)return new th(+t.x,+t.y);throw new Error("Expected [x, y] or {x, y} point format")};function r_e(t,e){let r=e.getBoundingClientRect();return new th(t.clientX-r.left-(e.clientLeft||0),t.clientY-r.top-(e.clientTop||0))}var JT=r_e;function rh(t,e,r,i){return{type:_r.FEATURE,properties:{meta:Yn.VERTEX,parent:t,coord_path:r,active:i?Fn.ACTIVE:Fn.INACTIVE},geometry:{type:_r.POINT,coordinates:e}}}function eE(t,e,r){let i=e.geometry.coordinates,n=r.geometry.coordinates;if(i[1]>$T||i[1]<WT||n[1]>$T||n[1]<WT)return null;let s={lng:(i[0]+n[0])/2,lat:(i[1]+n[1])/2};return{type:_r.FEATURE,properties:{meta:Yn.MIDPOINT,parent:t,lng:s.lng,lat:s.lat,coord_path:r.properties.coord_path},geometry:{type:_r.POINT,coordinates:[s.lng,s.lat]}}}function wW(t,e={},r=null){let{type:i,coordinates:n}=t.geometry,s=t.properties&&t.properties.id,a=[];i===_r.POINT?a.push(rh(s,n,r,h(r))):i===_r.POLYGON?n.forEach((x,T)=>{c(x,r!==null?`${r}.${T}`:String(T))}):i===_r.LINE_STRING?c(n,r):i.indexOf(_r.MULTI_PREFIX)===0&&p();function c(x,T){let R="",k=null;x.forEach((j,q)=>{let X=T!=null?`${T}.${q}`:String(q),re=rh(s,j,X,h(X));if(e.midpoints&&k){let oe=eE(s,k,re);oe&&a.push(oe)}k=re;let te=JSON.stringify(j);R!==te&&a.push(re),q===0&&(R=te)})}function h(x){return e.selectedPaths?e.selectedPaths.indexOf(x)!==-1:!1}function p(){let x=i.replace(_r.MULTI_PREFIX,"");n.forEach((T,R)=>{let k={type:_r.FEATURE,properties:t.properties,geometry:{type:x,coordinates:T}};a=a.concat(wW(k,e,R))})}return a}var Pg=wW;var Qo={enable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},disable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}};var{LAT_MIN:tE,LAT_MAX:rE,LAT_RENDERED_MIN:TW,LAT_RENDERED_MAX:EW,LNG_MIN:CW,LNG_MAX:SW}=Mn;function i_e(t){let e={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[t.geometry.type],r=[t.geometry.coordinates].flat(e),i=r.map(c=>c[0]),n=r.map(c=>c[1]),s=c=>Math.min.apply(null,c),a=c=>Math.max.apply(null,c);return[s(i),s(n),a(i),a(n)]}function Rg(t,e){let r=tE,i=rE,n=tE,s=rE,a=SW,c=CW;t.forEach(p=>{let x=i_e(p),T=x[1],R=x[3],k=x[0],j=x[2];T>r&&(r=T),R<i&&(i=R),R>n&&(n=R),T<s&&(s=T),k<a&&(a=k),j>c&&(c=j)});let h=e;return r+h.lat>EW&&(h.lat=EW-r),n+h.lat>rE&&(h.lat=rE-n),i+h.lat<TW&&(h.lat=TW-i),s+h.lat<tE&&(h.lat=tE-s),a+h.lng<=CW&&(h.lng+=Math.ceil(Math.abs(h.lng)/360)*360),c+h.lng>=SW&&(h.lng-=Math.ceil(Math.abs(h.lng)/360)*360),h}function Bg(t,e){let r=Rg(t.map(i=>i.toGeoJSON()),e);t.forEach(i=>{let n=i.getCoordinates(),s=p=>{let x={lng:p[0]+r.lng,lat:p[1]+r.lat};return[x.lng,x.lat]},a=p=>p.map(x=>s(x)),c=p=>p.map(x=>a(x)),h;i.type===_r.POINT?h=s(n):i.type===_r.LINE_STRING||i.type===_r.MULTI_POINT?h=n.map(s):i.type===_r.POLYGON||i.type===_r.MULTI_LINE_STRING?h=n.map(a):i.type===_r.MULTI_POLYGON&&(h=n.map(c)),i.incomingCoords(h)})}var kn={};kn.onSetup=function(t){let e={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(e.initiallySelectedFeatureIds.filter(r=>this.getFeature(r)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),e};kn.fireUpdate=function(){this.fire(gs.UPDATE,{action:jd.MOVE,features:this.getSelected().map(t=>t.toGeoJSON())})};kn.fireActionable=function(){let t=this.getSelected(),e=t.filter(s=>this.isInstanceOf("MultiFeature",s)),r=!1;if(t.length>1){r=!0;let s=t[0].type.replace("Multi","");t.forEach(a=>{a.type.replace("Multi","")!==s&&(r=!1)})}let i=e.length>0,n=t.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:i,trash:n})};kn.getUniqueIds=function(t){return t.length?t.map(r=>r.properties.id).filter(r=>r!==void 0).reduce((r,i)=>(r.add(i),r),new jl).values():[]};kn.stopExtendedInteractions=function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),(t.canDragMove||t.canBoxSelect)&&t.initialDragPanState===!0&&this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1};kn.onStop=function(){Qo.enable(this)};kn.onMouseMove=function(t,e){return QT(e)&&t.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(t),!0};kn.onMouseOut=function(t){return t.dragMoving?this.fireUpdate():!0};kn.onTap=kn.onClick=function(t,e){if(Ig(e))return this.clickAnywhere(t,e);if(Sg(Yn.VERTEX)(e))return this.clickOnVertex(t,e);if(QT(e))return this.clickOnFeature(t,e)};kn.clickAnywhere=function(t){let e=this.getSelectedIds();e.length&&(this.clearSelectedFeatures(),e.forEach(r=>this.doRender(r))),Qo.enable(this),this.stopExtendedInteractions(t)};kn.clickOnVertex=function(t,e){this.changeMode(si.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:un.MOVE})};kn.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat};kn.clickOnFeature=function(t,e){Qo.disable(this),this.stopExtendedInteractions(t);let r=Mg(e),i=this.getSelectedIds(),n=e.featureTarget.properties.id,s=this.isSelected(n);if(!r&&s&&this.getFeature(n).type!==_r.POINT)return this.changeMode(si.DIRECT_SELECT,{featureId:n});s&&r?(this.deselect(n),this.updateUIClasses({mouse:un.POINTER}),i.length===1&&Qo.enable(this)):!s&&r?(this.select(n),this.updateUIClasses({mouse:un.MOVE})):!s&&!r&&(i.forEach(a=>this.doRender(a)),this.setSelected(n),this.updateUIClasses({mouse:un.MOVE})),this.doRender(n)};kn.onMouseDown=function(t,e){if(t.initialDragPanState=this.map.dragPan.isEnabled(),af(e))return this.startOnActiveFeature(t,e);if(this.drawConfig.boxSelect&&nR(e))return this.startBoxSelect(t,e)};kn.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=JT(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0};kn.onTouchStart=function(t,e){if(af(e))return this.startOnActiveFeature(t,e)};kn.onDrag=function(t,e){if(t.canDragMove)return this.dragMove(t,e);if(this.drawConfig.boxSelect&&t.canBoxSelect)return this.whileBoxSelect(t,e)};kn.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:un.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(No.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));let r=JT(e.originalEvent,this.map.getContainer()),i=Math.min(t.boxSelectStartLocation.x,r.x),n=Math.max(t.boxSelectStartLocation.x,r.x),s=Math.min(t.boxSelectStartLocation.y,r.y),a=Math.max(t.boxSelectStartLocation.y,r.y),c=`translate(${i}px, ${s}px)`;t.boxSelectElement.style.transform=c,t.boxSelectElement.style.WebkitTransform=c,t.boxSelectElement.style.width=`${n-i}px`,t.boxSelectElement.style.height=`${a-s}px`};kn.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();let r={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Bg(this.getSelected(),r),t.dragMoveLocation=e.lngLat};kn.onTouchEnd=kn.onMouseUp=function(t,e){if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){let r=[t.boxSelectStartLocation,JT(e.originalEvent,this.map.getContainer())],i=this.featuresAt(null,r,"click"),n=this.getUniqueIds(i).filter(s=>!this.isSelected(s));n.length&&(this.select(n),n.forEach(s=>this.doRender(s)),this.updateUIClasses({mouse:un.MOVE}))}this.stopExtendedInteractions(t)};kn.toDisplayFeatures=function(t,e,r){e.properties.active=this.isSelected(e.properties.id)?Fn.ACTIVE:Fn.INACTIVE,r(e),this.fireActionable(),!(e.properties.active!==Fn.ACTIVE||e.geometry.type===_r.POINT)&&Pg(e).forEach(r)};kn.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};kn.onCombineFeatures=function(){let t=this.getSelected();if(t.length===0||t.length<2)return;let e=[],r=[],i=t[0].type.replace("Multi","");for(let n=0;n<t.length;n++){let s=t[n];if(s.type.replace("Multi","")!==i)return;s.type.includes("Multi")?s.getCoordinates().forEach(a=>{e.push(a)}):e.push(s.getCoordinates()),r.push(s.toGeoJSON())}if(r.length>1){let n=this.newFeature({type:_r.FEATURE,properties:r[0].properties,geometry:{type:`Multi${i}`,coordinates:e}});this.addFeature(n),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([n.id]),this.fire(gs.COMBINE_FEATURES,{createdFeatures:[n.toGeoJSON()],deletedFeatures:r})}this.fireActionable()};kn.onUncombineFeatures=function(){let t=this.getSelected();if(t.length===0)return;let e=[],r=[];for(let i=0;i<t.length;i++){let n=t[i];this.isInstanceOf("MultiFeature",n)&&(n.getFeatures().forEach(s=>{this.addFeature(s),s.properties=n.properties,e.push(s.toGeoJSON()),this.select([s.id])}),this.deleteFeature(n.id,{silent:!0}),r.push(n.toGeoJSON()))}e.length>1&&this.fire(gs.UNCOMBINE_FEATURES,{createdFeatures:e,deletedFeatures:r}),this.fireActionable()};var IW=kn;var MW=Sg(Yn.VERTEX),PW=Sg(Yn.MIDPOINT),Nn={};Nn.fireUpdate=function(){this.fire(gs.UPDATE,{action:jd.CHANGE_COORDINATES,features:this.getSelected().map(t=>t.toGeoJSON())})};Nn.fireActionable=function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})};Nn.startDragging=function(t,e){t.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat};Nn.stopDragging=function(t){t.canDragMove&&t.initialDragPanState===!0&&this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null};Nn.onVertex=function(t,e){this.startDragging(t,e);let r=e.featureTarget.properties,i=t.selectedCoordPaths.indexOf(r.coord_path);!Mg(e)&&i===-1?t.selectedCoordPaths=[r.coord_path]:Mg(e)&&i===-1&&t.selectedCoordPaths.push(r.coord_path);let n=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(n)};Nn.onMidpoint=function(t,e){this.startDragging(t,e);let r=e.featureTarget.properties;t.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),t.selectedCoordPaths=[r.coord_path]};Nn.pathsToCoordinates=function(t,e){return e.map(r=>({feature_id:t,coord_path:r}))};Nn.onFeature=function(t,e){t.selectedCoordPaths.length===0?this.startDragging(t,e):this.stopDragging(t)};Nn.dragFeature=function(t,e,r){Bg(this.getSelected(),r),t.dragMoveLocation=e.lngLat};Nn.dragVertex=function(t,e,r){let i=t.selectedCoordPaths.map(a=>t.feature.getCoordinate(a)),n=i.map(a=>({type:_r.FEATURE,properties:{},geometry:{type:_r.POINT,coordinates:a}})),s=Rg(n,r);for(let a=0;a<i.length;a++){let c=i[a];t.feature.updateCoordinate(t.selectedCoordPaths[a],c[0]+s.lng,c[1]+s.lat)}};Nn.clickNoTarget=function(){this.changeMode(si.SIMPLE_SELECT)};Nn.clickInactive=function(){this.changeMode(si.SIMPLE_SELECT)};Nn.clickActiveFeature=function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()};Nn.onSetup=function(t){let e=t.featureId,r=this.getFeature(e);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===_r.POINT)throw new TypeError("direct_select mode doesn't handle point features");let i={featureId:e,feature:r,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,i.selectedCoordPaths)),this.setSelected(e),Qo.disable(this),this.setActionableState({trash:!0}),i};Nn.onStop=function(){Qo.enable(this),this.clearSelectedCoordinates()};Nn.toDisplayFeatures=function(t,e,r){t.featureId===e.properties.id?(e.properties.active=Fn.ACTIVE,r(e),Pg(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(r)):(e.properties.active=Fn.INACTIVE,r(e)),this.fireActionable(t)};Nn.onTrash=function(t){t.selectedCoordPaths.sort((e,r)=>r.localeCompare(e,"en",{numeric:!0})).forEach(e=>t.feature.removeCoordinate(e)),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),t.feature.isValid()===!1&&(this.deleteFeature([t.featureId]),this.changeMode(si.SIMPLE_SELECT,{}))};Nn.onMouseMove=function(t,e){let r=af(e),i=MW(e),n=PW(e),s=t.selectedCoordPaths.length===0;return r&&s?this.updateUIClasses({mouse:un.MOVE}):i&&!s?this.updateUIClasses({mouse:un.MOVE}):this.updateUIClasses({mouse:un.NONE}),(i||r||n)&&t.dragMoving&&this.fireUpdate(),this.stopDragging(t),!0};Nn.onMouseOut=function(t){return t.dragMoving&&this.fireUpdate(),!0};Nn.onTouchStart=Nn.onMouseDown=function(t,e){if(MW(e))return this.onVertex(t,e);if(af(e))return this.onFeature(t,e);if(PW(e))return this.onMidpoint(t,e)};Nn.onDrag=function(t,e){if(t.canDragMove!==!0)return;t.dragMoving=!0,e.originalEvent.stopPropagation();let r={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,r):this.dragFeature(t,e,r),t.dragMoveLocation=e.lngLat};Nn.onClick=function(t,e){if(Ig(e))return this.clickNoTarget(t,e);if(af(e))return this.clickActiveFeature(t,e);if(KT(e))return this.clickInactive(t,e);this.stopDragging(t)};Nn.onTap=function(t,e){if(Ig(e))return this.clickNoTarget(t,e);if(af(e))return this.clickActiveFeature(t,e);if(KT(e))return this.clickInactive(t,e)};Nn.onTouchEnd=Nn.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var RW=Nn;var ih={};ih.onSetup=function(){let t=this.newFeature({type:_r.FEATURE,properties:{},geometry:{type:_r.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:un.ADD}),this.activateUIButton(so.POINT),this.setActionableState({trash:!0}),{point:t}};ih.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(si.SIMPLE_SELECT)};ih.onTap=ih.onClick=function(t,e){this.updateUIClasses({mouse:un.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.fire(gs.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(si.SIMPLE_SELECT,{featureIds:[t.point.id]})};ih.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})};ih.toDisplayFeatures=function(t,e,r){let i=e.properties.id===t.point.id;if(e.properties.active=i?Fn.ACTIVE:Fn.INACTIVE,!i)return r(e)};ih.onTrash=ih.stopDrawingAndRemove;ih.onKeyUp=function(t,e){if(qA(e)||ZA(e))return this.stopDrawingAndRemove(t,e)};var BW=ih;function n_e(t,e){return t.lngLat?t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]:!1}var YA=n_e;var Hc={};Hc.onSetup=function(){let t=this.newFeature({type:_r.FEATURE,properties:{},geometry:{type:_r.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),Qo.disable(this),this.updateUIClasses({mouse:un.ADD}),this.activateUIButton(so.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}};Hc.clickAnywhere=function(t,e){if(t.currentVertexPosition>0&&YA(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(si.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:un.ADD}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat)};Hc.clickOnVertex=function(t){return this.changeMode(si.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};Hc.onMouseMove=function(t,e){t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),$A(e)&&this.updateUIClasses({mouse:un.POINTER})};Hc.onTap=Hc.onClick=function(t,e){return $A(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)};Hc.onKeyUp=function(t,e){qA(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(si.SIMPLE_SELECT)):ZA(e)&&this.changeMode(si.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};Hc.onStop=function(t){this.updateUIClasses({mouse:un.NONE}),Qo.enable(this),this.activateUIButton(),this.getFeature(t.polygon.id)!==void 0&&(t.polygon.removeCoordinate(`0.${t.currentVertexPosition}`),t.polygon.isValid()?this.fire(gs.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(si.SIMPLE_SELECT,{},{silent:!0})))};Hc.toDisplayFeatures=function(t,e,r){let i=e.properties.id===t.polygon.id;if(e.properties.active=i?Fn.ACTIVE:Fn.INACTIVE,!i)return r(e);if(e.geometry.coordinates.length===0)return;let n=e.geometry.coordinates[0].length;if(!(n<3)){if(e.properties.meta=Yn.FEATURE,r(rh(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),n>3){let s=e.geometry.coordinates[0].length-3;r(rh(t.polygon.id,e.geometry.coordinates[0][s],`0.${s}`,!1))}if(n<=4){let s=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(r({type:_r.FEATURE,properties:e.properties,geometry:{coordinates:s,type:_r.LINE_STRING}}),n===3)return}return r(e)}};Hc.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(si.SIMPLE_SELECT)};var LW=Hc;var Wc={};Wc.onSetup=function(t){t=t||{};let e=t.featureId,r,i,n="forward";if(e){if(r=this.getFeature(e),!r)throw new Error("Could not find a feature with the provided featureId");let s=t.from;if(s&&s.type==="Feature"&&s.geometry&&s.geometry.type==="Point"&&(s=s.geometry),s&&s.type==="Point"&&s.coordinates&&s.coordinates.length===2&&(s=s.coordinates),!s||!Array.isArray(s))throw new Error("Please use the `from` property to indicate which point to continue the line from");let a=r.coordinates.length-1;if(r.coordinates[a][0]===s[0]&&r.coordinates[a][1]===s[1])i=a+1,r.addCoordinate(i,...r.coordinates[a]);else if(r.coordinates[0][0]===s[0]&&r.coordinates[0][1]===s[1])n="backwards",i=0,r.addCoordinate(i,...r.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else r=this.newFeature({type:_r.FEATURE,properties:{},geometry:{type:_r.LINE_STRING,coordinates:[]}}),i=0,this.addFeature(r);return this.clearSelectedFeatures(),Qo.disable(this),this.updateUIClasses({mouse:un.ADD}),this.activateUIButton(so.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:i,direction:n}};Wc.clickAnywhere=function(t,e){if(t.currentVertexPosition>0&&YA(e,t.line.coordinates[t.currentVertexPosition-1])||t.direction==="backwards"&&YA(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(si.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:un.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.direction==="forward"?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)};Wc.clickOnVertex=function(t){return this.changeMode(si.SIMPLE_SELECT,{featureIds:[t.line.id]})};Wc.onMouseMove=function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),$A(e)&&this.updateUIClasses({mouse:un.POINTER})};Wc.onTap=Wc.onClick=function(t,e){if($A(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)};Wc.onKeyUp=function(t,e){ZA(e)?this.changeMode(si.SIMPLE_SELECT,{featureIds:[t.line.id]}):qA(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(si.SIMPLE_SELECT))};Wc.onStop=function(t){Qo.enable(this),this.activateUIButton(),this.getFeature(t.line.id)!==void 0&&(t.line.removeCoordinate(`${t.currentVertexPosition}`),t.line.isValid()?this.fire(gs.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(si.SIMPLE_SELECT,{},{silent:!0})))};Wc.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(si.SIMPLE_SELECT)};Wc.toDisplayFeatures=function(t,e,r){let i=e.properties.id===t.line.id;if(e.properties.active=i?Fn.ACTIVE:Fn.INACTIVE,!i)return r(e);e.geometry.coordinates.length<2||(e.properties.meta=Yn.FEATURE,r(rh(t.line.id,e.geometry.coordinates[t.direction==="forward"?e.geometry.coordinates.length-2:1],`${t.direction==="forward"?e.geometry.coordinates.length-2:1}`,!1)),r(e))};var OW=Wc;var iE={simple_select:IW,direct_select:RW,draw_point:BW,draw_polygon:LW,draw_line_string:OW};var s_e={defaultMode:si.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:YT,modes:iE,controls:{},userProperties:!1,suppressAPIEvents:!0},o_e={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},a_e={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function DW(t,e){return t.map(r=>r.source?r:Object.assign({},r,{id:`${r.id}.${e}`,source:e==="hot"?da.HOT:da.COLD}))}function FW(t={}){let e=Object.assign({},t);return t.controls||(e.controls={}),t.displayControlsDefault===!1?e.controls=Object.assign({},a_e,t.controls):e.controls=Object.assign({},o_e,t.controls),e=Object.assign({},s_e,e),e.styles=DW(e.styles,"cold").concat(DW(e.styles,"hot")),e}var sR=_l(NW(),1),VW=_l(UW(),1);function nE(t,e){return t.length!==e.length?!1:JSON.stringify(t.map(r=>r).sort())===JSON.stringify(e.map(r=>r).sort())}var u_e={Polygon:GA,LineString:jA,Point:UA,MultiPolygon:HA,MultiLineString:HA,MultiPoint:HA};function jW(t,e){e.modes=si;let r=t.options.suppressAPIEvents!==void 0?!!t.options.suppressAPIEvents:!0;return e.getFeatureIdsAt=function(i){return jc.click({point:i},null,t).map(s=>s.properties.id)},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:_r.FEATURE_COLLECTION,features:t.store.getSelectedIds().map(i=>t.store.get(i)).map(i=>i.toGeoJSON())}},e.getSelectedPoints=function(){return{type:_r.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map(i=>({type:_r.FEATURE,properties:{},geometry:{type:_r.POINT,coordinates:i.coordinates}}))}},e.set=function(i){if(i.type===void 0||i.type!==_r.FEATURE_COLLECTION||!Array.isArray(i.features))throw new Error("Invalid FeatureCollection");let n=t.store.createRenderBatch(),s=t.store.getAllIds().slice(),a=e.add(i),c=new jl(a);return s=s.filter(h=>!c.has(h)),s.length&&e.delete(s),n(),a},e.add=function(i){let s=JSON.parse(JSON.stringify((0,VW.default)(i))).features.map(a=>{if(a.id=a.id||Cg(),a.geometry===null)throw new Error("Invalid geometry: null");if(t.store.get(a.id)===void 0||t.store.get(a.id).type!==a.geometry.type){let c=u_e[a.geometry.type];if(c===void 0)throw new Error(`Invalid geometry type: ${a.geometry.type}.`);let h=new c(t,a);t.store.add(h,{silent:r})}else{let c=t.store.get(a.id),h=c.properties;c.properties=a.properties,(0,sR.default)(h,a.properties)||t.store.featureChanged(c.id,{silent:r}),(0,sR.default)(c.getCoordinates(),a.geometry.coordinates)||c.incomingCoords(a.geometry.coordinates)}return a.id});return t.store.render(),s},e.get=function(i){let n=t.store.get(i);if(n)return n.toGeoJSON()},e.getAll=function(){return{type:_r.FEATURE_COLLECTION,features:t.store.getAll().map(i=>i.toGeoJSON())}},e.delete=function(i){return t.store.delete(i,{silent:r}),e.getMode()===si.DIRECT_SELECT&&!t.store.getSelectedIds().length?t.events.changeMode(si.SIMPLE_SELECT,void 0,{silent:r}):t.store.render(),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:r}),e.getMode()===si.DIRECT_SELECT?t.events.changeMode(si.SIMPLE_SELECT,void 0,{silent:r}):t.store.render(),e},e.changeMode=function(i,n={}){return i===si.SIMPLE_SELECT&&e.getMode()===si.SIMPLE_SELECT?(nE(n.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(n.featureIds,{silent:r}),t.store.render()),e):(i===si.DIRECT_SELECT&&e.getMode()===si.DIRECT_SELECT&&n.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(i,n,{silent:r}),e)},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:r}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:r}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:r}),e},e.setFeatureProperty=function(i,n,s){return t.store.setFeatureProperty(i,n,s,{silent:r}),e},e}var oR={};Es(oR,{CommonSelectors:()=>XA,ModeHandler:()=>o2,StringSet:()=>jl,constrainFeatureMovement:()=>Rg,createMidPoint:()=>eE,createSupplementaryPoints:()=>Pg,createVertex:()=>rh,doubleClickZoom:()=>Qo,euclideanDistance:()=>wg,featuresAt:()=>jc,getFeatureAtAndSetCursors:()=>zA,isClick:()=>Tg,isEventAtCoordinates:()=>YA,isTap:()=>Eg,mapEventToBoundingBox:()=>ZT,moveFeatures:()=>Bg,sortFeatures:()=>qT,stringSetsAreEqual:()=>nE,theme:()=>YT,toDenseArray:()=>WA});var h_e=function(t,e){t=FW(t);let r={options:t};e=jW(r,e),r.api=e;let i=bW(r);return e.onAdd=i.onAdd,e.onRemove=i.onRemove,e.types=so,e.options=t,e};function sE(t){h_e(t,this)}sE.modes=iE;sE.constants=Mn;sE.lib=oR;var c2=sE;c2.constants.classes.CONTROL_BASE="maplibregl-ctrl";c2.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-";c2.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";var GW=c2;function aR(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(x){try{p(i.next(x))}catch(T){a(T)}}function h(x){try{p(i.throw(x))}catch(T){a(T)}}function p(x){x.done?s(x.value):n(x.value).then(c,h)}p((i=i.apply(t,e||[])).next())})}var oE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function uE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var lR,HW;function JW(){if(HW)return lR;HW=1,lR=e;var t=Object.prototype.hasOwnProperty;function e(){for(var r={},i=0;i<arguments.length;i++){var n=arguments[i];for(var s in n)t.call(n,s)&&(r[s]=n[s])}return r}return lR}var cR={exports:{}},WW;function f_e(){return WW||(WW=1,function(t,e){(function(){var r={};t.exports=r,r.simpleFilter=function(i,n){return n.filter(function(s){return r.test(i,s)})},r.test=function(i,n){return r.match(i,n)!==null},r.match=function(i,n,s){s=s||{};var a=0,c=[],h=n.length,p=0,x=0,T=s.pre||"",R=s.post||"",k=s.caseSensitive&&n||n.toLowerCase(),j;i=s.caseSensitive&&i||i.toLowerCase();for(var q=0;q<h;q++)j=n[q],k[q]===i[a]?(j=T+j+R,a+=1,x+=1+x):x=0,p+=x,c[c.length]=j;return a===i.length?(p=k===i?1/0:p,{rendered:c.join(""),score:p}):null},r.filter=function(i,n,s){return!n||n.length===0?[]:typeof i!="string"?n:(s=s||{},n.reduce(function(a,c,h,p){var x=c;s.extract&&(x=s.extract(c));var T=r.match(i,x,s);return T!=null&&(a[a.length]={string:T.rendered,score:T.score,index:h,original:c}),a},[]).sort(function(a,c){var h=c.score-a.score;return h||a.index-c.index}))}})()}(cR)),cR.exports}var uR,$W;function d_e(){if($W)return uR;$W=1;var t=function(e){return this.component=e,this.items=[],this.active=e.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};return t.prototype.show=function(){this.element.style.display="block"},t.prototype.hide=function(){this.element.style.display="none"},t.prototype.add=function(e){this.items.push(e)},t.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},t.prototype.isEmpty=function(){return!this.items.length},t.prototype.isVisible=function(){return this.element.style.display==="block"},t.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()},t.prototype.drawItem=function(e,r){var i=document.createElement("li"),n=document.createElement("a");r&&(i.className+=" active"),n.innerHTML=e.string,i.appendChild(n),this.element.appendChild(i),i.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),i.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))},t.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()},t.prototype.move=function(e){this.active=e,this.draw()},t.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},t.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},t.prototype.drawError=function(e){var r=document.createElement("li");r.innerHTML=e,this.element.appendChild(r),this.show()},uR=t,uR}var hR,qW;function p_e(){if(qW)return hR;qW=1;var t=JW(),e=f_e(),r=d_e(),i=function(n,s,a){return a=a||{},this.options=t({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},a),this.el=n,this.data=s||[],this.list=new r(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(c){this.handleKeyUp(c.keyCode,c)}.bind(this),!1),this.el.addEventListener("keydown",function(c){this.handleKeyDown(c)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(c){this.handlePaste(c)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return i.prototype.handleKeyUp=function(n,s){if(!(n===40||n===38||n===27||n===9)){if(n===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),s.stopPropagation());return}this.handleInputChange(this.el.value)}},i.prototype.handleKeyDown=function(n){switch(n.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&n.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},i.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},i.prototype.handlePaste=function(n){if(n.clipboardData)this.handleInputChange(n.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(n.target.value)},100)}},i.prototype.handleInputChange=function(n){if(this.query=this.normalize(n),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(s){for(var a=0;a<s.length&&(this.list.add(s[a]),a!==this.options.limit-1);a++);this.list.draw()}.bind(this))},i.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},i.prototype.update=function(n){this.data=n,this.handleKeyUp()},i.prototype.clear=function(){this.data=[],this.list.clear()},i.prototype.normalize=function(n){return n=n.toLowerCase(),n},i.prototype.match=function(n,s){return n.indexOf(s)>-1},i.prototype.value=function(n){if(this.selected=n,this.el.value=this.getItemValue(n||{place_name:this.query}),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")},i.prototype.getCandidates=function(n){var s={pre:"<strong>",post:"</strong>",extract:function(c){return this.getItemValue(c)}.bind(this)},a;this.options.filter?(a=e.filter(this.query,this.data,s),a=a.map(function(c){return{original:c.original,string:this.render(c.original,c.string)}}.bind(this))):a=this.data.map(function(c){var h=this.render(c);return{original:c,string:h}}.bind(this)),n(a)},i.prototype.getItemValue=function(n){return n},i.prototype.render=function(n,s){if(s)return s;for(var a=n.original?this.getItemValue(n.original):this.getItemValue(n),c=this.normalize(a),h=c.lastIndexOf(this.query);h>-1;){var p=h+this.query.length;a=a.slice(0,h)+"<strong>"+a.slice(h,p)+"</strong>"+a.slice(p),h=c.slice(0,h).lastIndexOf(this.query)}return a},i.prototype.renderError=function(n){this.list.drawError(n)},hR=i,hR}var fR,ZW;function A_e(){if(ZW)return fR;ZW=1;var t=p_e();return fR=t,typeof window<"u"&&(window.Suggestions=t),fR}var m_e=A_e(),g_e=uE(m_e),lE={exports:{}},__e=lE.exports,XW;function y_e(){return XW||(XW=1,function(t){(function(e,r,i){t.exports?t.exports=i():e[r]=i()})(__e,"subtag",function(){var e="",r=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function i(h){return h.match(r)||[]}function n(h){return i(h).filter(function(p,x){return p&&x})}function s(h){return h=i(h),{language:h[1]||e,extlang:h[2]||e,script:h[3]||e,region:h[4]||e}}function a(h,p,x){Object.defineProperty(h,p,{value:x,enumerable:!0})}function c(h,p,x){function T(R){return i(R)[h]||e}a(T,"pattern",p),a(s,x,T)}return c(1,/^[a-zA-Z]{2,3}$/,"language"),c(2,/^[a-zA-Z]{3}$/,"extlang"),c(3,/^[a-zA-Z]{4}$/,"script"),c(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(s,"split",n),s})}(lE)),lE.exports}var x_e=y_e(),b_e=uE(x_e),dR,YW;function v_e(){if(YW)return dR;YW=1;var t="Expected a function",e=NaN,r="[object Symbol]",i=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,c=parseInt,h=typeof oE=="object"&&oE&&oE.Object===Object&&oE,p=typeof self=="object"&&self&&self.Object===Object&&self,x=h||p||Function("return this")(),T=Object.prototype,R=T.toString,k=Math.max,j=Math.min,q=function(){return x.Date.now()};function X(pe,be,Fe){var Y,J,Z,xe,_e,Be,Se=0,ke=!1,Ye=!1,rt=!0;if(typeof pe!="function")throw new TypeError(t);be=ae(be)||0,re(Fe)&&(ke=!!Fe.leading,Ye="maxWait"in Fe,Z=Ye?k(ae(Fe.maxWait)||0,be):Z,rt="trailing"in Fe?!!Fe.trailing:rt);function tt(dr){var Nr=Y,Ai=J;return Y=J=void 0,Se=dr,xe=pe.apply(Ai,Nr),xe}function _t(dr){return Se=dr,_e=setTimeout(cr,be),ke?tt(dr):xe}function Zt(dr){var Nr=dr-Be,Ai=dr-Se,Wr=be-Nr;return Ye?j(Wr,Z-Ai):Wr}function Vt(dr){var Nr=dr-Be,Ai=dr-Se;return Be===void 0||Nr>=be||Nr<0||Ye&&Ai>=Z}function cr(){var dr=q();if(Vt(dr))return Wt(dr);_e=setTimeout(cr,Zt(dr))}function Wt(dr){return _e=void 0,rt&&Y?tt(dr):(Y=J=void 0,xe)}function Lt(){_e!==void 0&&clearTimeout(_e),Se=0,Y=Be=J=_e=void 0}function vr(){return _e===void 0?xe:Wt(q())}function Pr(){var dr=q(),Nr=Vt(dr);if(Y=arguments,J=this,Be=dr,Nr){if(_e===void 0)return _t(Be);if(Ye)return _e=setTimeout(cr,be),tt(Be)}return _e===void 0&&(_e=setTimeout(cr,be)),xe}return Pr.cancel=Lt,Pr.flush=vr,Pr}function re(pe){var be=typeof pe;return!!pe&&(be=="object"||be=="function")}function te(pe){return!!pe&&typeof pe=="object"}function oe(pe){return typeof pe=="symbol"||te(pe)&&R.call(pe)==r}function ae(pe){if(typeof pe=="number")return pe;if(oe(pe))return e;if(re(pe)){var be=typeof pe.valueOf=="function"?pe.valueOf():pe;pe=re(be)?be+"":be}if(typeof pe!="string")return pe===0?pe:+pe;pe=pe.replace(i,"");var Fe=s.test(pe);return Fe||a.test(pe)?c(pe.slice(2),Fe?2:8):n.test(pe)?e:+pe}return dR=X,dR}var w_e=v_e(),T_e=uE(w_e),E_e=JW(),$c=uE(E_e),aE={exports:{}},KW;function C_e(){if(KW)return aE.exports;KW=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(pe,be,Fe){return Function.prototype.apply.call(pe,be,Fe)},r;t&&typeof t.ownKeys=="function"?r=t.ownKeys:Object.getOwnPropertySymbols?r=function(pe){return Object.getOwnPropertyNames(pe).concat(Object.getOwnPropertySymbols(pe))}:r=function(pe){return Object.getOwnPropertyNames(pe)};function i(ae){console&&console.warn&&console.warn(ae)}var n=Number.isNaN||function(pe){return pe!==pe};function s(){s.init.call(this)}aE.exports=s,aE.exports.once=re,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function c(ae){if(typeof ae!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof ae)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(ae){if(typeof ae!="number"||ae<0||n(ae))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+ae+".");a=ae}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(pe){if(typeof pe!="number"||pe<0||n(pe))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+pe+".");return this._maxListeners=pe,this};function h(ae){return ae._maxListeners===void 0?s.defaultMaxListeners:ae._maxListeners}s.prototype.getMaxListeners=function(){return h(this)},s.prototype.emit=function(pe){for(var be=[],Fe=1;Fe<arguments.length;Fe++)be.push(arguments[Fe]);var Y=pe==="error",J=this._events;if(J!==void 0)Y=Y&&J.error===void 0;else if(!Y)return!1;if(Y){var Z;if(be.length>0&&(Z=be[0]),Z instanceof Error)throw Z;var xe=new Error("Unhandled error."+(Z?" ("+Z.message+")":""));throw xe.context=Z,xe}var _e=J[pe];if(_e===void 0)return!1;if(typeof _e=="function")e(_e,this,be);else for(var Be=_e.length,Se=j(_e,Be),Fe=0;Fe<Be;++Fe)e(Se[Fe],this,be);return!0};function p(ae,pe,be,Fe){var Y,J,Z;if(c(be),J=ae._events,J===void 0?(J=ae._events=Object.create(null),ae._eventsCount=0):(J.newListener!==void 0&&(ae.emit("newListener",pe,be.listener?be.listener:be),J=ae._events),Z=J[pe]),Z===void 0)Z=J[pe]=be,++ae._eventsCount;else if(typeof Z=="function"?Z=J[pe]=Fe?[be,Z]:[Z,be]:Fe?Z.unshift(be):Z.push(be),Y=h(ae),Y>0&&Z.length>Y&&!Z.warned){Z.warned=!0;var xe=new Error("Possible EventEmitter memory leak detected. "+Z.length+" "+String(pe)+" listeners added. Use emitter.setMaxListeners() to increase limit");xe.name="MaxListenersExceededWarning",xe.emitter=ae,xe.type=pe,xe.count=Z.length,i(xe)}return ae}s.prototype.addListener=function(pe,be){return p(this,pe,be,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(pe,be){return p(this,pe,be,!0)};function x(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function T(ae,pe,be){var Fe={fired:!1,wrapFn:void 0,target:ae,type:pe,listener:be},Y=x.bind(Fe);return Y.listener=be,Fe.wrapFn=Y,Y}s.prototype.once=function(pe,be){return c(be),this.on(pe,T(this,pe,be)),this},s.prototype.prependOnceListener=function(pe,be){return c(be),this.prependListener(pe,T(this,pe,be)),this},s.prototype.removeListener=function(pe,be){var Fe,Y,J,Z,xe;if(c(be),Y=this._events,Y===void 0)return this;if(Fe=Y[pe],Fe===void 0)return this;if(Fe===be||Fe.listener===be)--this._eventsCount===0?this._events=Object.create(null):(delete Y[pe],Y.removeListener&&this.emit("removeListener",pe,Fe.listener||be));else if(typeof Fe!="function"){for(J=-1,Z=Fe.length-1;Z>=0;Z--)if(Fe[Z]===be||Fe[Z].listener===be){xe=Fe[Z].listener,J=Z;break}if(J<0)return this;J===0?Fe.shift():q(Fe,J),Fe.length===1&&(Y[pe]=Fe[0]),Y.removeListener!==void 0&&this.emit("removeListener",pe,xe||be)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(pe){var be,Fe,Y;if(Fe=this._events,Fe===void 0)return this;if(Fe.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Fe[pe]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Fe[pe]),this;if(arguments.length===0){var J=Object.keys(Fe),Z;for(Y=0;Y<J.length;++Y)Z=J[Y],Z!=="removeListener"&&this.removeAllListeners(Z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(be=Fe[pe],typeof be=="function")this.removeListener(pe,be);else if(be!==void 0)for(Y=be.length-1;Y>=0;Y--)this.removeListener(pe,be[Y]);return this};function R(ae,pe,be){var Fe=ae._events;if(Fe===void 0)return[];var Y=Fe[pe];return Y===void 0?[]:typeof Y=="function"?be?[Y.listener||Y]:[Y]:be?X(Y):j(Y,Y.length)}s.prototype.listeners=function(pe){return R(this,pe,!0)},s.prototype.rawListeners=function(pe){return R(this,pe,!1)},s.listenerCount=function(ae,pe){return typeof ae.listenerCount=="function"?ae.listenerCount(pe):k.call(ae,pe)},s.prototype.listenerCount=k;function k(ae){var pe=this._events;if(pe!==void 0){var be=pe[ae];if(typeof be=="function")return 1;if(be!==void 0)return be.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function j(ae,pe){for(var be=new Array(pe),Fe=0;Fe<pe;++Fe)be[Fe]=ae[Fe];return be}function q(ae,pe){for(;pe+1<ae.length;pe++)ae[pe]=ae[pe+1];ae.pop()}function X(ae){for(var pe=new Array(ae.length),be=0;be<pe.length;++be)pe[be]=ae[be].listener||ae[be];return pe}function re(ae,pe){return new Promise(function(be,Fe){function Y(Z){ae.removeListener(pe,J),Fe(Z)}function J(){typeof ae.removeListener=="function"&&ae.removeListener("error",Y),be([].slice.call(arguments))}oe(ae,pe,J,{once:!0}),pe!=="error"&&te(ae,Y,{once:!0})})}function te(ae,pe,be){typeof ae.on=="function"&&oe(ae,"error",pe,be)}function oe(ae,pe,be,Fe){if(typeof ae.on=="function")Fe.once?ae.once(pe,be):ae.on(pe,be);else if(typeof ae.addEventListener=="function")ae.addEventListener(pe,function Y(J){Fe.once&&ae.removeEventListener(pe,Y),be(J)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof ae)}return aE.exports}var S_e=C_e(),QW={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},I_e={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},M_e={en:"No results found",de:"Keine Ergebnisse gefunden"},P_e={en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen"},u2={placeholder:I_e,errorNoResults:M_e,errorConnectionFailed:P_e},R_e=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/,cE=class{constructor(e,r){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:i=>i.text!==void 0?i.text:i.place_name,render:function(i){if(!i.geometry){let s=i.text,a=s.toLowerCase().indexOf(this.query.toLowerCase()),c=this.query.length,h=s.substring(0,a),p=s.substring(a,a+c),x=s.substring(a+c);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+h+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+p+"</span>"+x+"</div></div></div>"}let n=i.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+n[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+n.splice(1,n.length).join(",")+"</div></div></div>"},popupRender:i=>{let n=i.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+n[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+n.splice(1,n.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new S_e.EventEmitter,this.options=$c({},this.options,r),this.fresh=!0,this.lastSelected=null,this.geocoderApi=e}addTo(e){function r(i,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");let s=i.onAdd();n.appendChild(s)}if(e instanceof HTMLElement)r(this,e);else if(typeof e=="string"){let i=document.querySelectorAll(e);if(i.length===0)throw new Error("Element "+e+"not found.");if(i.length>1)throw new Error("Geocoder can only be added to a single html element");r(this,i[0])}else if("addControl"in e)e.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);let r=this.container=document.createElement("div");r.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";let i=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",T_e(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);let n=document.createElement("div");n.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";let s=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(s),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),r.appendChild(i),r.appendChild(this._inputEl),r.appendChild(n),this._typeahead=new g_e(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),r}createIcon(e,r){let i=document.createElementNS("http://www.w3.org/2000/svg","svg");if(i.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+e),i.setAttribute("viewBox","0 0 18 18"),i.setAttribute("xml:space","preserve"),i.setAttribute("width","18"),i.setAttribute("height","18"),"innerHTML"in i)i.innerHTML=r;else{let n=document.createElement("div");n.innerHTML="<svg>"+r.valueOf().toString()+"</svg>";let s=n.firstChild,a=s.firstChild;i.appendChild(a)}return i}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(e){let r=(e.clipboardData||window.clipboardData).getData("text");r.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r)}_onKeyDown(e){if(e.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();let s=this._inputEl.value;if(!s)return this.fresh=!0,e.keyCode!==9&&this.clear(e),this._clearEl.style.display="none";if(!(e.metaKey||[9,27,37,39,38,40].indexOf(e.keyCode)!==-1)){if(e.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(s);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(s,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}s.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(s)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()}_onChange(){let e=this._typeahead.selected;if(e&&!e.geometry)e.placeId?this._geocode(e.placeId,!0,!0):this._geocode(e.text,!0);else if(e&&JSON.stringify(e)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let r;if(this._removeResultMarkers(),e.properties&&QW[e.properties.short_code])r=$c({},this.options.flyTo),this._map&&this._map.fitBounds(QW[e.properties.short_code].bbox,r);else if(e.bbox){let i=e.bbox;r=$c({},this.options.flyTo),this._map&&this._map.fitBounds([[i[0],i[1]],[i[2],i[3]]],r)}else{let i={zoom:this.options.zoom};r=$c({},i,this.options.flyTo),e.center?r.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(r.center=e.geometry.coordinates),this._map&&this._map.flyTo(r)}}this.options.marker&&this._maplibregl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:e})}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((i,n)=>(this.options[n]&&(["countries","types","language"].indexOf(n)>-1?i[n]=this.options[n].split(/[\s,]+/):i[n]=this.options[n],n==="proximity"&&this.options[n]&&typeof this.options[n].longitude=="number"&&typeof this.options[n].latitude=="number"&&(i[n]=[this.options[n].longitude,this.options[n].latitude])),i),{})}_geocode(e){return aR(this,arguments,void 0,function*(r,i=!1,n=!1){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:r});let s=this._getConfigForRequest(),a=this._createGeocodeRequest(s,r,i,n),c=this.options.localGeocoder?this.options.localGeocoder(r)||[]:[];try{let h=yield a;yield this._handleGeocodeResponse(h,s,r,i,c)}catch(h){this._handleGeocodeErrorResponse(h,c)}return a})}_createGeocodeRequest(e,r,i,n){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&R_e.test(r)?this._createReverseGeocodeRequest(r,e):(e.query=r,this.geocoderApi.getSuggestions?i?this.geocoderApi.searchByPlaceId&&n?this.geocoderApi.searchByPlaceId(e):this.geocoderApi.forwardGeocode(e):this.geocoderApi.getSuggestions(e):this.geocoderApi.forwardGeocode(e))}_createReverseGeocodeRequest(e,r){let i=e.split(/[\s(,)?]+/).map(n=>parseFloat(n)).reverse();return r.query=i,r.limit=1,"proximity"in r&&delete r.proximity,this.geocoderApi.reverseGeocode(r)}_handleGeocodeResponse(e,r,i,n,s){return aR(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let a={};e?a=e:a={type:"FeatureCollection",features:[]},a.config=r,this.fresh&&(this.fresh=!1),a.features=a.features?s.concat(a.features):s;let c=this.options.externalGeocoder?this.options.externalGeocoder(i,a.features,r)||Promise.resolve([]):Promise.resolve([]);try{let p=yield c;a.features=a.features?p.concat(a.features):p}catch{}this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter));let h=[];"suggestions"in a?h=a.suggestions:"place"in a?h=[a.place]:h=a.features,h.length?(this._clearEl.style.display="block",this._typeahead.update(h),(!this.options.showResultsWhileTyping||n)&&this.options.showResultMarkers&&(a.features.length>0||"place"in a)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",a)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))})}_handleGeocodeErrorResponse(e,r){this._loadingEl.style.display="none",r.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(r)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:r}),this._eventEmitter.emit("error",{error:e})}_clear(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(e){this._clear(e),this._inputEl.focus()}_clearOnBlur(e){e.relatedTarget&&this._clear(e)}_onQueryResult(e){if(!("features"in e)||!e.features.length)return;let r=e.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){let e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(e){return aR(this,void 0,void 0,function*(){let r=yield this._geocode(e);this._onQueryResult(r)})}_renderError(){let e=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(e)}_renderNoResults(){let e=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(e)}_renderMessage(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)}_localize(e){let r=b_e.language(this.options.language.split(",")[0]);return this.options.language&&u2?.[e][r]?u2[e][r]:u2[e].en}_fitBoundsForMarkers(){if(this._typeahead.data.length<1)return;let e=this._typeahead.data.filter(r=>typeof r!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){let i=$c({},{padding:100},this.options.flyTo),n=new this._maplibregl.LngLatBounds;for(let s of e)n.extend(s.geometry.coordinates);this._map.fitBounds(n,i)}return e.length>0&&this._maplibregl&&this._handleResultMarkers(e),this}setInput(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e),this}setProximity(e){return this.options.proximity=e,this}getProximity(){return this.options.proximity}setRenderFunction(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this}getRenderFunction(){return this._typeahead.render}setLanguage(e){return this.options.language=e||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(e){return this.options.zoom=e,this}getFlyTo(){return this.options.flyTo}setFlyTo(e){return this.options.flyTo=e,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(e){return this.placeholder=e||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this}getBbox(){return this.options.bbox}setBbox(e){return this.options.bbox=e,this}getCountries(){return this.options.countries}setCountries(e){return this.options.countries=e,this}getTypes(){return this.options.types}setTypes(e){return this.options.types=e,this}getMinLength(){return this.options.minLength}setMinLength(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this}getLimit(){return this.options.limit}setLimit(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this}getFilter(){return this.options.filter}setFilter(e){return this.options.filter=e,this}setGeocoderApi(e){return this.geocoderApi=e,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(e){if(!this._map)return;this._removeMarker();let i=$c({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(i);let n;if(this.options.popup){let a=$c({},{},this.options.popup);n=new this._maplibregl.Popup(a).setHTML(this.options.popupRender(e))}return e.center?(this.mapMarker.setLngLat(e.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(n)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(e){if(!this._map)return;this._removeResultMarkers();let i=$c({},{color:"#4668F2"},this.options.showResultMarkers);for(let n of e){let s;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(s=this.options.showResultMarkers.element.cloneNode(!0),i=$c(i,{element:s}));let a=new this._maplibregl.Marker($c({},i,{element:s})),c;if(this.options.popup){let p=$c({},{},this.options.popup);c=new this._maplibregl.Popup(p).setHTML(this.options.popupRender(n))}n.center?(a.setLngLat(n.center).addTo(this._map),this.options.popup&&a.setPopup(c)):n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&(a.setLngLat(n.geometry.coordinates).addTo(this._map),this.options.popup&&a.setPopup(c)),this.resultMarkers.push(a)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(e){e.remove()}),this.resultMarkers=[])}on(e,r){return this._eventEmitter.on(e,r),this}once(e){return new Promise(r=>{this._eventEmitter.once(e,r)})}off(e,r){return this._eventEmitter.removeListener(e,r),this}};var B_e=function(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(x){try{p(i.next(x))}catch(T){a(T)}}function h(x){try{p(i.throw(x))}catch(T){a(T)}}function p(x){x.done?s(x.value):n(x.value).then(c,h)}p((i=i.apply(t,e||[])).next())})};function pR(t){let e={forwardGeocode:r=>B_e(this,void 0,void 0,function*(){let i=[];try{let n=`https://nominatim.openstreetmap.org/search?q=${r.query}&format=geojson&polygon_geojson=1&addressdetails=1`,a=yield(yield fetch(n)).json();for(let c of a.features){let h=[c.bbox[0]+(c.bbox[2]-c.bbox[0])/2,c.bbox[1]+(c.bbox[3]-c.bbox[1])/2],p={type:"Feature",geometry:{type:"Point",coordinates:h},place_name:c.properties.display_name,properties:c.properties,text:c.properties.display_name,place_type:["place"],center:h};i.push(p)}}catch(n){console.error("forwardGeocode",n)}return{features:i}})};return new cE(e,t)}var X_e=_l(R2());var L_e=Object.prototype.toString,Og=Array.isArray||function(e){return L_e.call(e)==="[object Array]"};function mR(t){return typeof t=="function"}function O_e(t){return Og(t)?"array":typeof t}function AR(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function e$(t,e){return t!=null&&typeof t=="object"&&e in t}function D_e(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var F_e=RegExp.prototype.test;function k_e(t,e){return F_e.call(t,e)}var N_e=/\S/;function z_e(t){return!k_e(N_e,t)}var U_e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function V_e(t){return String(t).replace(/[&<>"'`=\/]/g,function(r){return U_e[r]})}var j_e=/\s*/,G_e=/\s+/,t$=/\s*=/,H_e=/\s*\}/,W_e=/#|\^|\/|>|\{|&|=|!/;function $_e(t,e){if(!t)return[];var r=!1,i=[],n=[],s=[],a=!1,c=!1,h="",p=0;function x(){if(a&&!c)for(;s.length;)delete n[s.pop()];else s=[];a=!1,c=!1}var T,R,k;function j(Y){if(typeof Y=="string"&&(Y=Y.split(G_e,2)),!Og(Y)||Y.length!==2)throw new Error("Invalid tags: "+Y);T=new RegExp(AR(Y[0])+"\\s*"),R=new RegExp("\\s*"+AR(Y[1])),k=new RegExp("\\s*"+AR("}"+Y[1]))}j(e||Hl.tags);for(var q=new f2(t),X,re,te,oe,ae,pe;!q.eos();){if(X=q.pos,te=q.scanUntil(T),te)for(var be=0,Fe=te.length;be<Fe;++be)oe=te.charAt(be),z_e(oe)?(s.push(n.length),h+=oe):(c=!0,r=!0,h+=" "),n.push(["text",oe,X,X+1]),X+=1,oe===`
`&&(x(),h="",p=0,r=!1);if(!q.scan(T))break;if(a=!0,re=q.scan(W_e)||"name",q.scan(j_e),re==="="?(te=q.scanUntil(t$),q.scan(t$),q.scanUntil(R)):re==="{"?(te=q.scanUntil(k),q.scan(H_e),q.scanUntil(R),re="&"):te=q.scanUntil(R),!q.scan(R))throw new Error("Unclosed tag at "+q.pos);if(re==">"?ae=[re,te,X,q.pos,h,p,r]:ae=[re,te,X,q.pos],p++,n.push(ae),re==="#"||re==="^")i.push(ae);else if(re==="/"){if(pe=i.pop(),!pe)throw new Error('Unopened section "'+te+'" at '+X);if(pe[1]!==te)throw new Error('Unclosed section "'+pe[1]+'" at '+X)}else re==="name"||re==="{"||re==="&"?c=!0:re==="="&&j(te)}if(x(),pe=i.pop(),pe)throw new Error('Unclosed section "'+pe[1]+'" at '+q.pos);return Z_e(q_e(n))}function q_e(t){for(var e=[],r,i,n=0,s=t.length;n<s;++n)r=t[n],r&&(r[0]==="text"&&i&&i[0]==="text"?(i[1]+=r[1],i[3]=r[3]):(e.push(r),i=r));return e}function Z_e(t){for(var e=[],r=e,i=[],n,s,a=0,c=t.length;a<c;++a)switch(n=t[a],n[0]){case"#":case"^":r.push(n),i.push(n),r=n[4]=[];break;case"/":s=i.pop(),s[5]=n[2],r=i.length>0?i[i.length-1][4]:e;break;default:r.push(n)}return e}function f2(t){this.string=t,this.tail=t,this.pos=0}f2.prototype.eos=function(){return this.tail===""};f2.prototype.scan=function(e){var r=this.tail.match(e);if(!r||r.index!==0)return"";var i=r[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i};f2.prototype.scanUntil=function(e){var r=this.tail.search(e),i;switch(r){case-1:i=this.tail,this.tail="";break;case 0:i="";break;default:i=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=i.length,i};function Lg(t,e){this.view=t,this.cache={".":this.view},this.parent=e}Lg.prototype.push=function(e){return new Lg(e,this)};Lg.prototype.lookup=function(e){var r=this.cache,i;if(r.hasOwnProperty(e))i=r[e];else{for(var n=this,s,a,c,h=!1;n;){if(e.indexOf(".")>0)for(s=n.view,a=e.split("."),c=0;s!=null&&c<a.length;)c===a.length-1&&(h=e$(s,a[c])||D_e(s,a[c])),s=s[a[c++]];else s=n.view[e],h=e$(n.view,e);if(h){i=s;break}n=n.parent}r[e]=i}return mR(i)&&(i=i.call(this.view)),i};function pa(){this.templateCache={_cache:{},set:function(e,r){this._cache[e]=r},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}pa.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};pa.prototype.parse=function(e,r){var i=this.templateCache,n=e+":"+(r||Hl.tags).join(":"),s=typeof i<"u",a=s?i.get(n):void 0;return a==null&&(a=$_e(e,r),s&&i.set(n,a)),a};pa.prototype.render=function(e,r,i,n){var s=this.getConfigTags(n),a=this.parse(e,s),c=r instanceof Lg?r:new Lg(r,void 0);return this.renderTokens(a,c,i,e,n)};pa.prototype.renderTokens=function(e,r,i,n,s){for(var a="",c,h,p,x=0,T=e.length;x<T;++x)p=void 0,c=e[x],h=c[0],h==="#"?p=this.renderSection(c,r,i,n,s):h==="^"?p=this.renderInverted(c,r,i,n,s):h===">"?p=this.renderPartial(c,r,i,s):h==="&"?p=this.unescapedValue(c,r):h==="name"?p=this.escapedValue(c,r,s):h==="text"&&(p=this.rawValue(c)),p!==void 0&&(a+=p);return a};pa.prototype.renderSection=function(e,r,i,n,s){var a=this,c="",h=r.lookup(e[1]);function p(R){return a.render(R,r,i,s)}if(h){if(Og(h))for(var x=0,T=h.length;x<T;++x)c+=this.renderTokens(e[4],r.push(h[x]),i,n,s);else if(typeof h=="object"||typeof h=="string"||typeof h=="number")c+=this.renderTokens(e[4],r.push(h),i,n,s);else if(mR(h)){if(typeof n!="string")throw new Error("Cannot use higher-order sections without the original template");h=h.call(r.view,n.slice(e[3],e[5]),p),h!=null&&(c+=h)}else c+=this.renderTokens(e[4],r,i,n,s);return c}};pa.prototype.renderInverted=function(e,r,i,n,s){var a=r.lookup(e[1]);if(!a||Og(a)&&a.length===0)return this.renderTokens(e[4],r,i,n,s)};pa.prototype.indentPartial=function(e,r,i){for(var n=r.replace(/[^ \t]/g,""),s=e.split(`
`),a=0;a<s.length;a++)s[a].length&&(a>0||!i)&&(s[a]=n+s[a]);return s.join(`
`)};pa.prototype.renderPartial=function(e,r,i,n){if(i){var s=this.getConfigTags(n),a=mR(i)?i(e[1]):i[e[1]];if(a!=null){var c=e[6],h=e[5],p=e[4],x=a;h==0&&p&&(x=this.indentPartial(a,p,c));var T=this.parse(x,s);return this.renderTokens(T,r,i,x,n)}}};pa.prototype.unescapedValue=function(e,r){var i=r.lookup(e[1]);if(i!=null)return i};pa.prototype.escapedValue=function(e,r,i){var n=this.getConfigEscape(i)||Hl.escape,s=r.lookup(e[1]);if(s!=null)return typeof s=="number"&&n===Hl.escape?String(s):n(s)};pa.prototype.rawValue=function(e){return e[1]};pa.prototype.getConfigTags=function(e){return Og(e)?e:e&&typeof e=="object"?e.tags:void 0};pa.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Og(e))return e.escape};var Hl={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){h2.templateCache=t},get templateCache(){return h2.templateCache}},h2=new pa;Hl.clearCache=function(){return h2.clearCache()};Hl.parse=function(e,r){return h2.parse(e,r)};Hl.render=function(e,r,i,n){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+O_e(e)+'" was given as the first argument for mustache#render(template, view, partials)');return h2.render(e,r,i,n)};Hl.escape=V_e;Hl.Scanner=f2;Hl.Context=Lg;Hl.Writer=pa;var gR=Hl;function _R(t,e,r){return r!==null?gR.render(r,t.properties):e===null?Object.keys(t.properties).map(n=>`${n}: ${t.properties[n]}`).join("</br>"):t.properties[e]}function yR(t){let e={background:"white",color:"black","border-radius":"3px"};return({layer:r,object:i})=>{if(i){let n=typeof t=="object"?t[r.id]:t;return n&&{html:gR.render(n,i),style:e}}return null}}var Y_e=new S0({configuration:new Hu({layers:K5})});function i$(t,e){let[r,i]=e;console.log(r,i),t[r](...i)}function r$(t){return t.map(e=>Y_e.convert(Object.assign(e,{onHover:({object:r})=>console.log(r)})))}function n$(t,e){let r=null,i=null;return{addTooltip:function(n,s=null,a=null){let c={closeButton:!1,closeOnClick:!1},h=new t.Popup(c);e.on("mousemove",n,p=>{let x=p.features[0],T=_R(x,s,a);h.setLngLat(p.lngLat).setHTML(T).addTo(e)}),e.on("mouseleave",n,()=>{h.remove()})},addControl:function(n,s,a){if(n==="GeocodingControl"){e.addControl(pR(Object.assign(Object.assign({},s),{maplibregl:t})),a);return}n==="MapTilerGeocodingControl"&&(s.maplibregl=t),e.addControl(new t[n](s),a)},addPopup:function(n,s=null,a=null){let c={closeButton:!1},h=new t.Popup(c);e.on("click",n,p=>{let x=p.features[0],T=_R(x,s,a);h.setLngLat(p.lngLat).setHTML(T).addTo(e)})},addMarker:function({lngLat:n,popup:s,options:a}){let c=new t.Marker(a).setLngLat(n);if(s){let h=new t.Popup(s.options).setHTML(s.text);c.setPopup(h)}c.addTo(e)},setSourceData:function(n,s){let a=e.getSource(n);a?.setData(s)},addDeckOverlay:function(n,s=null){let a=r$(n);r=new T0({interleaved:!0,layers:a,getTooltip:s?yR(s):null}),e.addControl(r)},setDeckLayers:function(n,s=null){console.log("Updating Deck.GL layers");let a=r$(n);r.setProps({layers:a,getTooltip:s?yR(s):null})},addMapboxDraw(n,s,a=null){i=new GW(n),e.addControl(i,s),a&&i.add(a)},getMapboxDraw:function(){return i}}}var K_e=new y6;KA.default.addProtocol("pmtiles",K_e.tile);KA.default.MapTilerGeocodingControl=Q2;KA.default.LayerSwitcherControl=C_;KA.default.InfoBoxControl=E_;function Q_e(t){let e="pymaplibregl",r=document.createElement("div");return r.id=e,r.style.height=t.get("height"),r}function xR(t,e){let r={center:e.getCenter(),zoom:e.getZoom(),bounds:e.getBounds(),bearing:e.getBearing(),pitch:e.getPitch()};t.set("view_state",r),t.save_changes()}function J_e(t,e){let r=new KA.default.Map(t);return r.on("mouseover",()=>{r.getCanvas().style.cursor="pointer"}),r.on("mouseout",()=>{r.getCanvas().style.cursor=""}),r.on("click",i=>{e.set("clicked",i.lngLat),e.save_changes()}),r.on("zoomend",i=>{xR(e,r)}),r.on("moveend",i=>{xR(e,r)}),r.once("load",()=>{r.resize(),xR(e,r)}),r.on("draw.selectionchange",i=>{let n=i.features;console.log("selection changed",n),e.set("draw_features_selected",n),e.save_changes()}),r}function e1e({model:t,el:e}){console.log("anywidget","render");let r=Q_e(t),i=Object.assign({container:r},t.get("map_options"));console.log(i);let n=J_e(i,t),s=n$(KA.default,n),a=[{name:"draw.create",destVar:"draw_features_created"},{name:"draw.update",destVar:"draw_features_updated"},{name:"draw.delete",destVar:"draw_features_deleted"}];for(let p of a)n.on(p.name,x=>{let T=s.getMapboxDraw();console.log("all features",T.getAll()),t.set("draw_feature_collection_all",T.getAll()),console.log("event features",x.features),t.set(p.destVar,x.features),t.save_changes()});let c=p=>{p.forEach(x=>{if(Object.keys(s).includes(x[0])){console.log("custom map call",x);let[T,R]=x;s[T](...R);return}i$(n,x)})},h=t.get("calls");n.on("load",()=>{console.log("init calls",h),c(h),t.set("_rendered",!0),t.save_changes()}),t.on("msg:custom",p=>{console.log("custom msg",p),c(p.calls)}),e.appendChild(r)}var Znt={render:e1e};export{Znt as default};
/*! Bundled license information:

maplibre-gl/dist/maplibre-gl.js:
  (**
   * MapLibre GL JS
   * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.3.1/LICENSE.txt
   *)

long/dist/long.js:
  (**
   * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
   * Released under the Apache License, Version 2.0
   * see: https://github.com/dcodeIO/long.js for details
   *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

long/index.js:
  (**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   *)

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)
*/
